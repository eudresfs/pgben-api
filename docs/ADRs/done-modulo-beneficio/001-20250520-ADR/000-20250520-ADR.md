# Registro de Decisão Arquitetural (ADR)

## ADR-001: Implementação de Formulários Específicos Configuráveis para Benefícios

### Status

Proposto - {data}

### Contexto

O Sistema de Gestão de Benefícios Eventuais da SEMTAS precisa gerenciar diversos tipos de benefícios (Auxílio Natalidade, Aluguel Social, e futuramente Auxílio Funeral e Cesta Básica). Cada tipo de benefício exige a coleta de informações específicas através de formulários distintos.

Tradicionalmente, teríamos que criar entidades fixas e estruturas de banco de dados específicas para cada tipo de benefício. Essa abordagem, apesar de oferecer maior tipagem e validações em tempo de compilação, resulta em:

1. Necessidade de alterações de código para mudanças em requisitos de formulários
2. Duplicação de código entre diferentes tipos de benefícios
3. Dificuldade na adição de novos tipos de benefícios no futuro
4. Acoplamento entre camadas de persistência, lógica de negócio e apresentação

Além disso, precisamos considerar que:
- Os requisitos dos formulários podem mudar com atualizações na legislação municipal
- Novos tipos de benefícios podem ser incluídos no futuro
- O custo de manutenção precisa ser minimizado
- Os técnicos da SEMTAS e administradores precisam ter autonomia para ajustar os formulários

### Decisão

Implementaremos um sistema de **Formulários Específicos Configuráveis** que consiste em:

1. Uma entidade `FormularioEspecifico` que define campos dinâmicos para cada tipo de benefício
2. Um mecanismo de renderização dinâmica no frontend
3. Um sistema de validação baseado em regras definidas em JSON
4. APIs para administrar a configuração dos formulários

A estrutura da entidade `FormularioEspecifico` será:

```typescript
interface FormularioEspecifico {
  id: string;
  tipo_beneficio_id: string; // Referência ao tipo de benefício
  nome_campo: string;        // Nome técnico do campo
  descricao_campo: string;   // Label exibida ao usuário
  tipo_campo: TipoCampo;     // Enum de tipos de campo disponíveis
  opcoes?: string[];         // Para campos de seleção
  obrigatorio: boolean;      // Se é campo obrigatório
  validacao?: string;        // Regras em formato JSON
  ordem: number;             // Ordem de exibição
  created_at: Date;
  updated_at: Date;
  removed_at?: Date;
}
```

Os dados capturados pelos formulários serão armazenados em um formato JSON estruturado no módulo de Solicitação, mantendo a separação de responsabilidades entre os módulos.

### Consequências

#### Positivas

1. **Flexibilidade**: Os formulários podem ser modificados sem alterações de código
2. **Manutenibilidade**: Separação entre configuração e código
3. **Extensibilidade**: Novos tipos de benefícios podem ser adicionados sem alterações significativas
4. **Autonomia**: Administradores podem gerenciar formulários via interface administrativa
5. **Consistência**: Abordagem unificada para todos os tipos de benefícios
6. **Desacoplamento**: Clara separação entre definição (Benefício) e coleta/armazenamento (Solicitação)

#### Negativas

1. **Complexidade**: A renderização dinâmica e validação são mais complexas que formulários estáticos
2. **Tipo de dados**: Perdemos a tipagem forte do TypeScript para os dados do formulário
3. **Performance**: Pode haver overhead na renderização dinâmica e nas consultas de banco
4. **Debugging**: Erros em formulários dinâmicos podem ser mais difíceis de rastrear
5. **Migração de dados**: Se a estrutura dos formulários mudar significativamente, pode ser necessário migrar dados existentes

### Alternativas Consideradas

1. **Entidades Específicas**: Criar entidades separadas para cada tipo de benefício (BeneficioNatalidade, BeneficioAluguelSocial, etc.)
   - Prós: Tipagem forte, validações em tempo de compilação
   - Contras: Modificações requerem alterações de código, maior rigidez

2. **JSON Schema**: Usar apenas JSON Schema para definir formulários sem tabelas específicas
   - Prós: Extremamente flexível
   - Contras: Sem controle granular sobre campos individuais, problemas de performance para consultas específicas

3. **Abordagem Híbrida**: Entidades específicas + campos extras em JSON
   - Prós: Balanceamento entre tipagem e flexibilidade
   - Contras: Complexidade de manutenção, possível inconsistência entre abordagens

### Implementação

A implementação seguirá estas etapas:

1. Criação das entidades necessárias no banco de dados
2. Implementação dos endpoints de API para gerenciamento dos formulários
3. Desenvolvimento de componente de renderização dinâmica no frontend
4. Integração com o módulo de Solicitação para coleta e armazenamento dos dados
5. Implementação de interface administrativa para configuração dos formulários
6. Migração de dados existentes, se aplicável

**Tecnologias específicas**:
- Backend: NestJS com TypeORM
- Frontend: Vue 3 com componentes de formulário dinâmicos
- Validação: JSON Schema para definição de regras complexas
- UI: Componentes reutilizáveis para diferentes tipos de campos

### Requisitos de Monitoramento

Devemos monitorar:
1. Tempo de renderização dos formulários dinâmicos
2. Taxa de erros em validações
3. Utilização (quais campos são mais preenchidos/ignorados)
4. Impacto na performance do banco de dados

### Notas Adicionais

Esta abordagem é especialmente valiosa em sistemas de assistência social, onde mudanças na legislação e políticas públicas frequentemente exigem alterações nos formulários e requisitos. A flexibilidade proporcionada permitirá que o sistema evolua sem intervenções constantes da equipe de desenvolvimento.

### Referências

- SEMTAS Lei Municipal 7.205/2021 e Decreto Municipal 12.346/2021
- Patterns of Enterprise Application Architecture (Martin Fowler)
- Domain-Driven Design (Eric Evans)
- JSON Schema specification - https://json-schema.org/