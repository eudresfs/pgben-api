# =============================================================================
# CONFIGURAÇÕES DE RESILIÊNCIA - SISTEMA SEMTAS
# =============================================================================
# Este arquivo contém todas as configurações relacionadas à resiliência do sistema,
# incluindo cache, auditoria, Redis e estratégias de fallback.
# Copie para .env.local e ajuste conforme necessário.

# =============================================================================
# CONFIGURAÇÕES GERAIS DE RESILIÊNCIA
# =============================================================================

# Habilitar/desabilitar estratégias de resiliência globalmente
RESILIENCE_ENABLED=true

# Modo de operação: 'production', 'development', 'test'
RESILIENCE_MODE=production

# Intervalo para verificações de saúde (em milissegundos)
HEALTH_CHECK_INTERVAL=30000

# Timeout para operações críticas (em milissegundos)
CRITICAL_OPERATION_TIMEOUT=5000

# =============================================================================
# CONFIGURAÇÕES DE CACHE HÍBRIDO (L1 + L2)
# =============================================================================

# Cache L1 (Memória Local)
CACHE_L1_ENABLED=true
CACHE_L1_MAX_SIZE=1000
CACHE_L1_TTL_DEFAULT=300000
CACHE_L1_CLEANUP_INTERVAL=60000

# Cache L2 (Redis)
CACHE_L2_ENABLED=true
CACHE_L2_FALLBACK_TO_L1=true
CACHE_DEFAULT_TTL=3600000

# Cache Warming
CACHE_ENABLE_WARMING=true
CACHE_WARMING_INTERVAL=300000
CACHE_WARMING_ON_STARTUP=true
CACHE_WARMING_BATCH_SIZE=50

# Circuit Breaker para Cache
CACHE_CIRCUIT_BREAKER_ENABLED=true
CACHE_CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CACHE_CIRCUIT_BREAKER_TIMEOUT=30000
CACHE_CIRCUIT_BREAKER_RESET_TIMEOUT=60000

# Prevenção de Cache Stampede
CACHE_STAMPEDE_PROTECTION=true
CACHE_STAMPEDE_TIMEOUT=10000

# Métricas de Cache
CACHE_METRICS_ENABLED=true
CACHE_METRICS_RETENTION_HOURS=24

# =============================================================================
# CONFIGURAÇÕES DE REDIS
# =============================================================================

# Conexão Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_USERNAME=

# Configurações de Resiliência Redis
REDIS_RETRY_ATTEMPTS=3
REDIS_RETRY_DELAY=1000
REDIS_CONNECT_TIMEOUT=5000
REDIS_COMMAND_TIMEOUT=3000
REDIS_LAZYCONNECT=true

# Pool de Conexões Redis
REDIS_MAX_RETRIES_PER_REQUEST=3
REDIS_RETRY_DELAY_ON_FAILURE=100
REDIS_ENABLE_READY_CHECK=true
REDIS_MAX_RECONNECT_ATTEMPTS=10

# Fallback quando Redis está indisponível
REDIS_FALLBACK_ENABLED=true
REDIS_HEALTH_CHECK_INTERVAL=15000

# =============================================================================
# CONFIGURAÇÕES DE AUDITORIA RESILIENTE
# =============================================================================

# Auditoria Assíncrona (Fila)
AUDITORIA_QUEUE_ENABLED=true
AUDITORIA_QUEUE_NAME=auditoria-logs
AUDITORIA_QUEUE_CONCURRENCY=5
AUDITORIA_QUEUE_RETRY_ATTEMPTS=3
AUDITORIA_QUEUE_RETRY_DELAY=5000
AUDITORIA_QUEUE_REMOVE_ON_COMPLETE=100
AUDITORIA_QUEUE_REMOVE_ON_FAIL=50

# Fallback Síncrono
AUDITORIA_SYNC_FALLBACK_ENABLED=true
AUDITORIA_SYNC_FALLBACK_TIMEOUT=3000
AUDITORIA_SYNC_FALLBACK_MAX_RETRIES=2

# Fallback para Arquivo
AUDITORIA_FILE_FALLBACK_ENABLED=true
AUDITORIA_FILE_FALLBACK_PATH=./logs/auditoria-backup
AUDITORIA_FILE_FALLBACK_MAX_SIZE=100MB
AUDITORIA_FILE_FALLBACK_ROTATION=daily
AUDITORIA_FILE_FALLBACK_COMPRESS=true

# Recuperação de Logs
AUDITORIA_RECOVERY_ENABLED=true
AUDITORIA_RECOVERY_INTERVAL=600000
AUDITORIA_RECOVERY_BATCH_SIZE=100
AUDITORIA_RECOVERY_MAX_AGE_HOURS=24

# Métricas de Auditoria
AUDITORIA_METRICS_ENABLED=true
AUDITORIA_METRICS_RETENTION_HOURS=48

# =============================================================================
# CONFIGURAÇÕES DE BULL (FILAS)
# =============================================================================

# Configurações Gerais Bull
BULL_REDIS_HOST=${REDIS_HOST}
BULL_REDIS_PORT=${REDIS_PORT}
BULL_REDIS_PASSWORD=${REDIS_PASSWORD}
BULL_REDIS_DB=1

# Resiliência Bull
BULL_RETRY_ATTEMPTS=3
BULL_RETRY_DELAY=2000
BULL_REMOVE_ON_COMPLETE=50
BULL_REMOVE_ON_FAIL=25

# Fallback quando Bull/Redis está indisponível
BULL_FALLBACK_ENABLED=true
BULL_FALLBACK_TO_SYNC=true

# =============================================================================
# CONFIGURAÇÕES DE MONITORAMENTO
# =============================================================================

# Health Checks
HEALTH_CHECK_REDIS_ENABLED=true
HEALTH_CHECK_DATABASE_ENABLED=true
HEALTH_CHECK_QUEUE_ENABLED=true
HEALTH_CHECK_CACHE_ENABLED=true

# Timeouts para Health Checks
HEALTH_CHECK_REDIS_TIMEOUT=2000
HEALTH_CHECK_DATABASE_TIMEOUT=3000
HEALTH_CHECK_QUEUE_TIMEOUT=2000
HEALTH_CHECK_CACHE_TIMEOUT=1000

# Alertas e Notificações
ALERTS_ENABLED=true
ALERTS_WEBHOOK_URL=
ALERTS_EMAIL_ENABLED=false
ALERTS_EMAIL_RECIPIENTS=

# Thresholds para Alertas
ALERT_CACHE_HIT_RATE_THRESHOLD=70
ALERT_AUDITORIA_SUCCESS_RATE_THRESHOLD=95
ALERT_RESPONSE_TIME_THRESHOLD=1000
ALERT_ERROR_RATE_THRESHOLD=5

# =============================================================================
# CONFIGURAÇÕES DE LOGGING
# =============================================================================

# Logs de Resiliência
RESILIENCE_LOG_LEVEL=info
RESILIENCE_LOG_FILE=./logs/resilience.log
RESILIENCE_LOG_MAX_SIZE=50MB
RESILIENCE_LOG_MAX_FILES=5

# Logs de Performance
PERFORMANCE_LOG_ENABLED=true
PERFORMANCE_LOG_SLOW_THRESHOLD=1000
PERFORMANCE_LOG_INCLUDE_STACK_TRACE=false

# =============================================================================
# CONFIGURAÇÕES DE DESENVOLVIMENTO/TESTE
# =============================================================================

# Configurações específicas para desenvolvimento
DEV_DISABLE_CACHE=false
DEV_DISABLE_AUDITORIA=false
DEV_DISABLE_REDIS=false
DEV_MOCK_EXTERNAL_SERVICES=false

# Configurações de Teste
TEST_CACHE_TTL=1000
TEST_AUDITORIA_TIMEOUT=500
TEST_REDIS_TIMEOUT=1000
TEST_CLEANUP_ON_EXIT=true

# =============================================================================
# CONFIGURAÇÕES DE SEGURANÇA
# =============================================================================

# Acesso ao Monitoramento
MONITORING_ENDPOINT_ENABLED=true
MONITORING_REQUIRE_AUTH=true
MONITORING_ALLOWED_ROLES=ADMINISTRADOR,GESTOR

# Rate Limiting para APIs de Monitoramento
MONITORING_RATE_LIMIT_ENABLED=true
MONITORING_RATE_LIMIT_WINDOW=60000
MONITORING_RATE_LIMIT_MAX_REQUESTS=100

# Sanitização de Dados Sensíveis
DATA_SANITIZATION_ENABLED=true
DATA_SANITIZATION_FIELDS=password,cpf,rg,email
DATA_SANITIZATION_REPLACEMENT=***

# =============================================================================
# CONFIGURAÇÕES DE BACKUP E RECUPERAÇÃO
# =============================================================================

# Backup Automático
BACKUP_ENABLED=true
BACKUP_INTERVAL=3600000
BACKUP_RETENTION_DAYS=7
BACKUP_COMPRESSION=true
BACKUP_PATH=./backups

# Recuperação de Desastres
DISASTER_RECOVERY_ENABLED=true
DISASTER_RECOVERY_AUTO_FAILOVER=true
DISASTER_RECOVERY_HEALTH_CHECK_FAILURES=3
DISASTER_RECOVERY_COOLDOWN=300000

# =============================================================================
# CONFIGURAÇÕES AVANÇADAS
# =============================================================================

# Otimizações de Performance
PERFORMANCE_OPTIMIZATION_ENABLED=true
PERFORMANCE_BATCH_OPERATIONS=true
PERFORMANCE_LAZY_LOADING=true
PERFORMANCE_CONNECTION_POOLING=true

# Configurações de Memória
MEMORY_LIMIT_MB=512
MEMORY_WARNING_THRESHOLD=80
MEMORY_CLEANUP_ENABLED=true
MEMORY_CLEANUP_INTERVAL=300000

# Configurações de CPU
CPU_INTENSIVE_OPERATIONS_LIMIT=2
CPU_MONITORING_ENABLED=true
CPU_THROTTLING_ENABLED=true
CPU_THROTTLING_THRESHOLD=90

# =============================================================================
# CONFIGURAÇÕES DE PRODUÇÃO
# =============================================================================

# Otimizações para Produção
PRODUCTION_MODE=false
PRODUCTION_CACHE_AGGRESSIVE=true
PRODUCTION_LOG_LEVEL=warn
PRODUCTION_METRICS_DETAILED=false

# Configurações de Cluster
CLUSTER_ENABLED=false
CLUSTER_NODES=1
CLUSTER_REDIS_SENTINEL=false
CLUSTER_LOAD_BALANCING=round-robin

# =============================================================================
# OBSERVAÇÕES IMPORTANTES
# =============================================================================
# 
# 1. SEGURANÇA:
#    - Nunca commite este arquivo com valores reais de produção
#    - Use variáveis de ambiente ou arquivos .env.local para valores sensíveis
#    - Mantenha senhas e tokens em serviços de secrets management
# 
# 2. PERFORMANCE:
#    - Ajuste os valores de TTL conforme o padrão de uso da aplicação
#    - Monitore o uso de memória e ajuste CACHE_L1_MAX_SIZE conforme necessário
#    - Configure timeouts baseados na latência da sua infraestrutura
# 
# 3. RESILIÊNCIA:
#    - Teste regularmente os cenários de fallback
#    - Monitore as métricas de resiliência em produção
#    - Ajuste os thresholds de alertas baseado no comportamento real
# 
# 4. MANUTENÇÃO:
#    - Revise estas configurações periodicamente
#    - Documente mudanças significativas
#    - Mantenha backups das configurações de produção
# 
# =============================================================================