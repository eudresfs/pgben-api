{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "JWT Automation Configuration Schema",
  "description": "Schema para validação da configuração de automação JWT do Sistema SEMTAS PGBEN",
  "type": "object",
  "required": ["version", "environments", "security", "jwt", "paths"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Referência ao schema JSON"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Versão da configuração (semver)"
    },
    "description": {
      "type": "string",
      "description": "Descrição da configuração"
    },
    "environments": {
      "type": "object",
      "description": "Configurações específicas por ambiente",
      "patternProperties": {
        "^[a-zA-Z][a-zA-Z0-9_-]*$": {
          "type": "object",
          "required": ["enabled", "keySize", "outputFormat"],
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Se o ambiente está habilitado"
            },
            "autoDetect": {
              "type": "boolean",
              "description": "Se deve detectar automaticamente o ambiente"
            },
            "keySize": {
              "type": "integer",
              "enum": [2048, 3072, 4096],
              "description": "Tamanho da chave RSA em bits"
            },
            "outputFormat": {
              "type": "string",
              "enum": ["files", "env", "base64", "compose"],
              "description": "Formato de saída das chaves"
            },
            "envFile": {
              "type": "string",
              "description": "Caminho do arquivo .env"
            },
            "namespace": {
              "type": "string",
              "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
              "description": "Namespace do Kubernetes"
            },
            "secretName": {
              "type": "string",
              "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
              "description": "Nome do secret no Kubernetes"
            },
            "createEnvIfMissing": {
              "type": "boolean",
              "description": "Criar arquivo .env se não existir"
            },
            "createOverride": {
              "type": "boolean",
              "description": "Criar docker-compose.override.yml"
            },
            "createNamespace": {
              "type": "boolean",
              "description": "Criar namespace se não existir"
            },
            "backupExisting": {
              "type": "boolean",
              "description": "Fazer backup de arquivos existentes"
            },
            "validateKeys": {
              "type": "boolean",
              "description": "Validar chaves geradas"
            },
            "validateCluster": {
              "type": "boolean",
              "description": "Validar conectividade com cluster K8s"
            },
            "requireConfirmation": {
              "type": "boolean",
              "description": "Requerer confirmação antes de executar"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "security": {
      "type": "object",
      "required": ["algorithm", "minKeySize", "maxKeySize", "keyFormat"],
      "properties": {
        "algorithm": {
          "type": "string",
          "enum": ["RS256", "RS384", "RS512"],
          "description": "Algoritmo de assinatura JWT"
        },
        "minKeySize": {
          "type": "integer",
          "minimum": 1024,
          "description": "Tamanho mínimo da chave em bits"
        },
        "maxKeySize": {
          "type": "integer",
          "maximum": 8192,
          "description": "Tamanho máximo da chave em bits"
        },
        "keyFormat": {
          "type": "string",
          "enum": ["PEM", "DER"],
          "description": "Formato das chaves"
        },
        "privateKeyPermissions": {
          "type": "string",
          "pattern": "^[0-7]{3}$",
          "description": "Permissões da chave privada (formato octal)"
        },
        "publicKeyPermissions": {
          "type": "string",
          "pattern": "^[0-7]{3}$",
          "description": "Permissões da chave pública (formato octal)"
        },
        "excludeFromGit": {
          "type": "boolean",
          "description": "Excluir chaves do controle de versão"
        },
        "validateKeyPair": {
          "type": "boolean",
          "description": "Validar par de chaves gerado"
        },
        "rotationWarningDays": {
          "type": "integer",
          "minimum": 1,
          "description": "Dias antes de avisar sobre rotação"
        }
      },
      "additionalProperties": false
    },
    "jwt": {
      "type": "object",
      "required": ["accessTokenExpiry", "refreshTokenExpiry"],
      "properties": {
        "accessTokenExpiry": {
          "type": "string",
          "pattern": "^\\d+[smhd]$",
          "description": "Tempo de expiração do token de acesso"
        },
        "refreshTokenExpiry": {
          "type": "string",
          "pattern": "^\\d+[smhd]$",
          "description": "Tempo de expiração do refresh token"
        },
        "issuer": {
          "type": "string",
          "description": "Emissor do token JWT"
        },
        "audience": {
          "type": "string",
          "description": "Audiência do token JWT"
        }
      },
      "additionalProperties": false
    },
    "paths": {
      "type": "object",
      "required": ["keysDirectory", "privateKeyFile", "publicKeyFile"],
      "properties": {
        "keysDirectory": {
          "type": "string",
          "description": "Diretório das chaves"
        },
        "privateKeyFile": {
          "type": "string",
          "description": "Nome do arquivo da chave privada"
        },
        "publicKeyFile": {
          "type": "string",
          "description": "Nome do arquivo da chave pública"
        },
        "privateKeyPem": {
          "type": "string",
          "description": "Nome do arquivo PEM da chave privada"
        },
        "publicKeyPem": {
          "type": "string",
          "description": "Nome do arquivo PEM da chave pública"
        },
        "envFile": {
          "type": "string",
          "description": "Nome do arquivo de ambiente"
        },
        "dockerOverride": {
          "type": "string",
          "description": "Nome do arquivo de override do Docker Compose"
        },
        "gitignore": {
          "type": "string",
          "description": "Nome do arquivo .gitignore"
        }
      },
      "additionalProperties": false
    },
    "logging": {
      "type": "object",
      "properties": {
        "level": {
          "type": "string",
          "enum": ["debug", "info", "warn", "error"],
          "description": "Nível de log"
        },
        "colorOutput": {
          "type": "boolean",
          "description": "Usar cores na saída"
        },
        "saveToFile": {
          "type": "boolean",
          "description": "Salvar logs em arquivo"
        },
        "logFile": {
          "type": "string",
          "description": "Caminho do arquivo de log"
        },
        "maxLogSize": {
          "type": "string",
          "pattern": "^\\d+[KMGT]?B$",
          "description": "Tamanho máximo do arquivo de log"
        },
        "maxLogFiles": {
          "type": "integer",
          "minimum": 1,
          "description": "Número máximo de arquivos de log"
        }
      },
      "additionalProperties": false
    },
    "validation": {
      "type": "object",
      "properties": {
        "checkDependencies": {
          "type": "boolean",
          "description": "Verificar dependências"
        },
        "validateEnvironment": {
          "type": "boolean",
          "description": "Validar ambiente"
        },
        "testKeyGeneration": {
          "type": "boolean",
          "description": "Testar geração de chaves"
        },
        "verifyPermissions": {
          "type": "boolean",
          "description": "Verificar permissões de arquivo"
        },
        "checkClusterAccess": {
          "type": "boolean",
          "description": "Verificar acesso ao cluster"
        }
      },
      "additionalProperties": false
    },
    "automation": {
      "type": "object",
      "properties": {
        "runOnBuild": {
          "type": "boolean",
          "description": "Executar durante o build"
        },
        "runOnDeploy": {
          "type": "boolean",
          "description": "Executar durante o deploy"
        },
        "runOnStart": {
          "type": "boolean",
          "description": "Executar na inicialização"
        },
        "skipIfExists": {
          "type": "boolean",
          "description": "Pular se chaves já existirem"
        },
        "forceRegeneration": {
          "type": "boolean",
          "description": "Forçar regeneração"
        },
        "confirmBeforeOverwrite": {
          "type": "boolean",
          "description": "Confirmar antes de sobrescrever"
        }
      },
      "additionalProperties": false
    },
    "cicd": {
      "type": "object",
      "properties": {
        "githubActions": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Habilitar GitHub Actions"
            },
            "workflowFile": {
              "type": "string",
              "description": "Arquivo de workflow"
            },
            "runOnPush": {
              "type": "boolean",
              "description": "Executar em push"
            },
            "runOnPR": {
              "type": "boolean",
              "description": "Executar em pull request"
            },
            "runOnRelease": {
              "type": "boolean",
              "description": "Executar em release"
            }
          },
          "additionalProperties": false
        },
        "azureDevOps": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Habilitar Azure DevOps"
            },
            "pipelineFile": {
              "type": "string",
              "description": "Arquivo de pipeline"
            },
            "runOnBuild": {
              "type": "boolean",
              "description": "Executar no build"
            },
            "runOnDeploy": {
              "type": "boolean",
              "description": "Executar no deploy"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "monitoring": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Habilitar monitoramento"
        },
        "checkKeyExpiry": {
          "type": "boolean",
          "description": "Verificar expiração de chaves"
        },
        "alertBeforeExpiry": {
          "type": "boolean",
          "description": "Alertar antes da expiração"
        },
        "alertDays": {
          "type": "integer",
          "minimum": 1,
          "description": "Dias antes do alerta"
        },
        "healthCheck": {
          "type": "boolean",
          "description": "Verificação de saúde"
        },
        "metricsCollection": {
          "type": "boolean",
          "description": "Coleta de métricas"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}