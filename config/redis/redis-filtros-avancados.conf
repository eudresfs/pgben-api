# =====================================================
# CONFIGURAÇÃO REDIS PARA FILTROS AVANÇADOS
# =====================================================
# Arquivo: redis-filtros-avancados.conf
# Descrição: Configurações otimizadas do Redis para o sistema de cache
#            dos filtros avançados do PGBEN
# Data: 2024-01-20
# Versão: 1.0
# =====================================================

# =====================================================
# CONFIGURAÇÕES BÁSICAS
# =====================================================

# Porta do Redis (padrão: 6379)
port 6379

# Bind apenas localhost para segurança
bind 127.0.0.1

# Timeout de conexão (0 = sem timeout)
timeout 300

# Keepalive TCP
tcp-keepalive 300

# =====================================================
# CONFIGURAÇÕES DE MEMÓRIA
# =====================================================

# Limite máximo de memória (ajustar conforme ambiente)
# Desenvolvimento: 256MB
# Produção: 2GB ou mais
maxmemory 256mb

# Política de remoção quando atinge limite de memória
# allkeys-lru: Remove chaves menos usadas recentemente
maxmemory-policy allkeys-lru

# Amostras para algoritmo LRU (mais amostras = mais precisão)
maxmemory-samples 5

# =====================================================
# CONFIGURAÇÕES DE PERSISTÊNCIA
# =====================================================

# Desabilitar RDB para cache (dados não críticos)
save ""

# Desabilitar AOF para melhor performance
appendonly no

# =====================================================
# CONFIGURAÇÕES DE PERFORMANCE
# =====================================================

# Hash table resize threshold
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# List compression
list-max-ziplist-size -2
list-compress-depth 0

# Set optimization
set-max-intset-entries 512

# Sorted set optimization
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# HyperLogLog sparse representation
hll-sparse-max-bytes 3000

# =====================================================
# CONFIGURAÇÕES DE REDE
# =====================================================

# Buffer de saída para clientes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Timeout de query (em microssegundos)
# 0 = sem limite
latency-monitor-threshold 100

# =====================================================
# CONFIGURAÇÕES DE SEGURANÇA
# =====================================================

# Desabilitar comandos perigosos
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG ""
rename-command SHUTDOWN ""
rename-command DEBUG ""
rename-command EVAL ""

# Senha para conexão (definir em produção)
# requirepass sua_senha_segura_aqui

# =====================================================
# CONFIGURAÇÕES DE LOG
# =====================================================

# Nível de log
# debug, verbose, notice, warning
loglevel notice

# Arquivo de log
logfile "/var/log/redis/redis-filtros-avancados.log"

# Rotação de log
syslog-enabled yes
syslog-ident redis-filtros
syslog-facility local0

# =====================================================
# CONFIGURAÇÕES ESPECÍFICAS PARA CACHE
# =====================================================

# Configurações para otimizar cache de filtros
# Usar database 1 para filtros avançados
databases 16

# Configurações de expiração
# Verificar chaves expiradas a cada 100ms
hz 10

# =====================================================
# CONFIGURAÇÕES DE MONITORAMENTO
# =====================================================

# Habilitar estatísticas de latência
latency-monitor-threshold 100

# Slow log para queries lentas (em microssegundos)
slowlog-log-slower-than 10000
slowlog-max-len 128

# =====================================================
# CONFIGURAÇÕES AVANÇADAS
# =====================================================

# Otimizações para workload de cache
tcp-backlog 511

# Configurações de threading (Redis 6+)
# io-threads 4
# io-threads-do-reads yes

# Configurações de memory mapping
stop-writes-on-bgsave-error no
rdbcompression yes
rdbchecksum yes

# =====================================================
# CONFIGURAÇÕES DE DESENVOLVIMENTO
# =====================================================

# Apenas para desenvolvimento - remover em produção
# protected-mode no

# =====================================================
# CONFIGURAÇÕES DE PRODUÇÃO
# =====================================================

# Configurações recomendadas para produção
# (descomentar em ambiente de produção)

# protected-mode yes
# requirepass senha_muito_segura_aqui
# maxclients 10000
# tcp-keepalive 300
# timeout 0

# Configurações de cluster (se necessário)
# cluster-enabled yes
# cluster-config-file nodes-6379.conf
# cluster-node-timeout 15000

# =====================================================
# CONFIGURAÇÕES DE BACKUP
# =====================================================

# Para ambientes críticos, habilitar backup
# save 900 1
# save 300 10
# save 60 10000

# =====================================================
# CONFIGURAÇÕES DE MÓDULOS
# =====================================================

# Carregar módulos específicos se necessário
# loadmodule /path/to/module.so

# =====================================================
# CONFIGURAÇÕES DE NOTIFICAÇÕES
# =====================================================

# Notificações de eventos de chaves
# Útil para invalidação de cache
notify-keyspace-events Ex

# =====================================================
# CONFIGURAÇÕES DE OTIMIZAÇÃO ESPECÍFICAS
# =====================================================

# Configurações específicas para padrões de cache
# dos filtros avançados

# Otimizar para muitas operações GET/SET
active-rehashing yes

# Configurações de hash para distribuição uniforme
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# =====================================================
# COMENTÁRIOS E DOCUMENTAÇÃO
# =====================================================

# Esta configuração foi otimizada para:
# - Cache de resultados de filtros avançados
# - Alta frequência de leitura
# - TTL automático de chaves
# - Baixa latência
# - Uso eficiente de memória

# Padrões de chaves utilizados:
# - filtros:entity:hash -> Resultados de queries
# - count:entity:hash -> Contadores de registros
# - stats:entity -> Estatísticas de uso
# - config:cache -> Configurações de cache

# =====================================================
# MONITORAMENTO RECOMENDADO
# =====================================================

# Comandos úteis para monitoramento:
# - INFO memory
# - INFO stats
# - LATENCY LATEST
# - SLOWLOG GET
# - CLIENT LIST
# - MEMORY USAGE key

# =====================================================
# FIM DA CONFIGURAÇÃO
# =====================================================