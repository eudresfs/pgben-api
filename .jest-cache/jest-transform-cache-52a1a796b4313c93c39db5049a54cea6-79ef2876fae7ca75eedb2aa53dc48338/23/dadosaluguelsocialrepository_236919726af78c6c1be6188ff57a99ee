31e8a9b70af4b0fbf04093b5123c1d38
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DadosAluguelSocialRepository = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("typeorm");
const dados_aluguel_social_entity_1 = require("../../../entities/dados-aluguel-social.entity");
/**
 * Repositório customizado para DadosAluguelSocial
 * Extende o repositório base do TypeORM com métodos específicos
 */
let DadosAluguelSocialRepository = class DadosAluguelSocialRepository extends typeorm_1.Repository {
    dataSource;
    constructor(dataSource) {
        super(dados_aluguel_social_entity_1.DadosAluguelSocial, dataSource.createEntityManager());
        this.dataSource = dataSource;
    }
    /**
     * Buscar dados de aluguel social por solicitação com relacionamentos
     */
    async findBySolicitacaoWithRelations(solicitacaoId) {
        return this.findOne({
            where: { solicitacao_id: solicitacaoId },
            relations: [
                'solicitacao',
                'solicitacao.cidadao',
                'solicitacao.tipo_beneficio',
            ],
        });
    }
    /**
     * Buscar dados por público prioritário
     */
    async findByPublicoPrioritario(publicoPrioritario) {
        return this.createQueryBuilder('dados')
            .leftJoinAndSelect('dados.solicitacao', 'solicitacao')
            .leftJoinAndSelect('solicitacao.cidadao', 'cidadao')
            .where('dados.publico_prioritario = :publicoPrioritario', {
            publicoPrioritario,
        })
            .orderBy('dados.created_at', 'DESC')
            .getMany();
    }
    /**
     * Buscar dados por especificação do aluguel
     */
    async findByEspecificacao(especificacao) {
        return this.createQueryBuilder('dados')
            .leftJoinAndSelect('dados.solicitacao', 'solicitacao')
            .leftJoinAndSelect('solicitacao.cidadao', 'cidadao')
            .where('dados.especificacao_aluguel = :especificacao', { especificacao })
            .orderBy('dados.created_at', 'DESC')
            .getMany();
    }
    /**
     * Buscar dados por faixa de valor do aluguel
     */
    async findByFaixaValor(valorMinimo, valorMaximo) {
        return this.createQueryBuilder('dados')
            .leftJoinAndSelect('dados.solicitacao', 'solicitacao')
            .leftJoinAndSelect('solicitacao.cidadao', 'cidadao')
            .where('dados.valor_aluguel BETWEEN :valorMinimo AND :valorMaximo', {
            valorMinimo,
            valorMaximo,
        })
            .orderBy('dados.valor_aluguel', 'ASC')
            .getMany();
    }
    /**
     * Buscar dados por período de início do aluguel
     */
    async findByPeriodoInicio(dataInicio, dataFim) {
        return this.createQueryBuilder('dados')
            .leftJoinAndSelect('dados.solicitacao', 'solicitacao')
            .leftJoinAndSelect('solicitacao.cidadao', 'cidadao')
            .where('dados.data_inicio_aluguel BETWEEN :dataInicio AND :dataFim', {
            dataInicio,
            dataFim,
        })
            .orderBy('dados.data_inicio_aluguel', 'DESC')
            .getMany();
    }
    /**
     * Buscar estatísticas de aluguel social
     */
    async getEstatisticas() {
        const totalSolicitacoes = await this.count();
        // Valor médio e total dos aluguéis
        const valoresResult = await this.createQueryBuilder('dados')
            .select('AVG(dados.valor_aluguel)', 'valorMedio')
            .addSelect('SUM(dados.valor_aluguel)', 'valorTotal')
            .where('dados.valor_aluguel IS NOT NULL')
            .getRawOne();
        const valorMedioAluguel = parseFloat(valoresResult.valorMedio) || 0;
        const valorTotalAlugueis = parseFloat(valoresResult.valorTotal) || 0;
        // Estatísticas por público prioritário
        const porPublicoResult = await this.createQueryBuilder('dados')
            .select('dados.publico_prioritario', 'publico')
            .addSelect('COUNT(*)', 'quantidade')
            .groupBy('dados.publico_prioritario')
            .getRawMany();
        const porPublicoPrioritario = porPublicoResult.reduce((acc, item) => {
            acc[item.publico] = parseInt(item.quantidade);
            return acc;
        }, {});
        // Estatísticas por especificação
        const porEspecificacaoResult = await this.createQueryBuilder('dados')
            .select('dados.especificacao_aluguel', 'especificacao')
            .addSelect('COUNT(*)', 'quantidade')
            .groupBy('dados.especificacao_aluguel')
            .getRawMany();
        const porEspecificacao = porEspecificacaoResult.reduce((acc, item) => {
            acc[item.especificacao] = parseInt(item.quantidade);
            return acc;
        }, {});
        // Estatísticas por faixa de valor
        const porFaixaValorResult = await this.createQueryBuilder('dados')
            .select(`CASE 
          WHEN dados.valor_aluguel <= 500 THEN 'Até R$ 500'
          WHEN dados.valor_aluguel <= 1000 THEN 'R$ 501 - R$ 1.000'
          WHEN dados.valor_aluguel <= 1500 THEN 'R$ 1.001 - R$ 1.500'
          WHEN dados.valor_aluguel <= 2000 THEN 'R$ 1.501 - R$ 2.000'
          ELSE 'Acima de R$ 2.000'
        END`, 'faixa')
            .addSelect('COUNT(*)', 'quantidade')
            .where('dados.valor_aluguel IS NOT NULL')
            .groupBy('faixa')
            .getRawMany();
        const porFaixaValor = porFaixaValorResult.reduce((acc, item) => {
            acc[item.faixa] = parseInt(item.quantidade);
            return acc;
        }, {});
        return {
            totalSolicitacoes,
            valorMedioAluguel,
            valorTotalAlugueis,
            porPublicoPrioritario,
            porEspecificacao,
            porFaixaValor,
        };
    }
    /**
     * Verificar duplicatas por endereço
     */
    async findDuplicatesByEndereco(endereco, excludeId) {
        const query = this.createQueryBuilder('dados')
            .leftJoinAndSelect('dados.solicitacao', 'solicitacao')
            .where('LOWER(dados.endereco_imovel) = LOWER(:endereco)', { endereco });
        if (excludeId) {
            query.andWhere('dados.id != :excludeId', { excludeId });
        }
        return query.getMany();
    }
    /**
     * Buscar dados de aluguel social com filtros avançados
     */
    async findWithFilters(filters) {
        const query = this.createQueryBuilder('dados')
            .leftJoinAndSelect('dados.solicitacao', 'solicitacao')
            .leftJoinAndSelect('solicitacao.cidadao', 'cidadao');
        if (filters.publicoPrioritario) {
            query.andWhere('dados.publico_prioritario = :publicoPrioritario', {
                publicoPrioritario: filters.publicoPrioritario,
            });
        }
        if (filters.especificacao) {
            query.andWhere('dados.especificacao_aluguel = :especificacao', {
                especificacao: filters.especificacao,
            });
        }
        if (filters.valorMinimo) {
            query.andWhere('dados.valor_aluguel >= :valorMinimo', {
                valorMinimo: filters.valorMinimo,
            });
        }
        if (filters.valorMaximo) {
            query.andWhere('dados.valor_aluguel <= :valorMaximo', {
                valorMaximo: filters.valorMaximo,
            });
        }
        if (filters.dataInicioMin && filters.dataInicioMax) {
            query.andWhere('dados.data_inicio_aluguel BETWEEN :dataInicioMin AND :dataInicioMax', {
                dataInicioMin: filters.dataInicioMin,
                dataInicioMax: filters.dataInicioMax,
            });
        }
        if (filters.endereco) {
            query.andWhere('LOWER(dados.endereco_imovel) LIKE LOWER(:endereco)', {
                endereco: `%${filters.endereco}%`,
            });
        }
        const total = await query.getCount();
        if (filters.page && filters.limit) {
            query.skip((filters.page - 1) * filters.limit).take(filters.limit);
        }
        query.orderBy('dados.created_at', 'DESC');
        const data = await query.getMany();
        return { data, total };
    }
};
exports.DadosAluguelSocialRepository = DadosAluguelSocialRepository;
exports.DadosAluguelSocialRepository = DadosAluguelSocialRepository = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object])
], DadosAluguelSocialRepository);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGJlbmVmaWNpb1xccmVwb3NpdG9yaWVzXFxkYWRvcy1hbHVndWVsLXNvY2lhbC5yZXBvc2l0b3J5LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBNEM7QUFDNUMscUNBQWlEO0FBQ2pELCtGQUFtRjtBQUduRjs7O0dBR0c7QUFFSSxJQUFNLDRCQUE0QixHQUFsQyxNQUFNLDRCQUE2QixTQUFRLG9CQUE4QjtJQUMxRDtJQUFwQixZQUFvQixVQUFzQjtRQUN4QyxLQUFLLENBQUMsZ0RBQWtCLEVBQUUsVUFBVSxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQztRQUQxQyxlQUFVLEdBQVYsVUFBVSxDQUFZO0lBRTFDLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyw4QkFBOEIsQ0FDbEMsYUFBcUI7UUFFckIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ2xCLEtBQUssRUFBRSxFQUFFLGNBQWMsRUFBRSxhQUFhLEVBQUU7WUFDeEMsU0FBUyxFQUFFO2dCQUNULGFBQWE7Z0JBQ2IscUJBQXFCO2dCQUNyQiw0QkFBNEI7YUFDN0I7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsd0JBQXdCLENBQzVCLGtCQUE2QztRQUU3QyxPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUM7YUFDcEMsaUJBQWlCLENBQUMsbUJBQW1CLEVBQUUsYUFBYSxDQUFDO2FBQ3JELGlCQUFpQixDQUFDLHFCQUFxQixFQUFFLFNBQVMsQ0FBQzthQUNuRCxLQUFLLENBQUMsaURBQWlELEVBQUU7WUFDeEQsa0JBQWtCO1NBQ25CLENBQUM7YUFDRCxPQUFPLENBQUMsa0JBQWtCLEVBQUUsTUFBTSxDQUFDO2FBQ25DLE9BQU8sRUFBRSxDQUFDO0lBQ2YsQ0FBQztJQUVEOztPQUVHO0lB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QThQeEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGJlbmVmaWNpb1xccmVwb3NpdG9yaWVzXFxkYWRvcy1hbHVndWVsLXNvY2lhbC5yZXBvc2l0b3J5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBEYXRhU291cmNlLCBSZXBvc2l0b3J5IH0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQgeyBEYWRvc0FsdWd1ZWxTb2NpYWwgfSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy9kYWRvcy1hbHVndWVsLXNvY2lhbC5lbnRpdHknO1xuaW1wb3J0IHsgUHVibGljb1ByaW9yaXRhcmlvQWx1Z3VlbCwgRXNwZWNpZmljYWNhb0FsdWd1ZWwgfSBmcm9tICdAL2VudW1zJztcblxuLyoqXG4gKiBSZXBvc2l0w7NyaW8gY3VzdG9taXphZG8gcGFyYSBEYWRvc0FsdWd1ZWxTb2NpYWxcbiAqIEV4dGVuZGUgbyByZXBvc2l0w7NyaW8gYmFzZSBkbyBUeXBlT1JNIGNvbSBtw6l0b2RvcyBlc3BlY8OtZmljb3NcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIERhZG9zQWx1Z3VlbFNvY2lhbFJlcG9zaXRvcnkgZXh0ZW5kcyBSZXBvc2l0b3J5PERhZG9zQWx1Z3VlbFNvY2lhbD4ge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRhdGFTb3VyY2U6IERhdGFTb3VyY2UpIHtcbiAgICBzdXBlcihEYWRvc0FsdWd1ZWxTb2NpYWwsIGRhdGFTb3VyY2UuY3JlYXRlRW50aXR5TWFuYWdlcigpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdXNjYXIgZGFkb3MgZGUgYWx1Z3VlbCBzb2NpYWwgcG9yIHNvbGljaXRhw6fDo28gY29tIHJlbGFjaW9uYW1lbnRvc1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5U29saWNpdGFjYW9XaXRoUmVsYXRpb25zKFxuICAgIHNvbGljaXRhY2FvSWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxEYWRvc0FsdWd1ZWxTb2NpYWwgfCBudWxsPiB7XG4gICAgcmV0dXJuIHRoaXMuZmluZE9uZSh7XG4gICAgICB3aGVyZTogeyBzb2xpY2l0YWNhb19pZDogc29saWNpdGFjYW9JZCB9LFxuICAgICAgcmVsYXRpb25zOiBbXG4gICAgICAgICdzb2xpY2l0YWNhbycsXG4gICAgICAgICdzb2xpY2l0YWNhby5jaWRhZGFvJyxcbiAgICAgICAgJ3NvbGljaXRhY2FvLnRpcG9fYmVuZWZpY2lvJyxcbiAgICAgIF0sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2FyIGRhZG9zIHBvciBww7pibGljbyBwcmlvcml0w6FyaW9cbiAgICovXG4gIGFzeW5jIGZpbmRCeVB1YmxpY29Qcmlvcml0YXJpbyhcbiAgICBwdWJsaWNvUHJpb3JpdGFyaW86IFB1YmxpY29Qcmlvcml0YXJpb0FsdWd1ZWwsXG4gICk6IFByb21pc2U8RGFkb3NBbHVndWVsU29jaWFsW10+IHtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGVRdWVyeUJ1aWxkZXIoJ2RhZG9zJylcbiAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdCgnZGFkb3Muc29saWNpdGFjYW8nLCAnc29saWNpdGFjYW8nKVxuICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KCdzb2xpY2l0YWNhby5jaWRhZGFvJywgJ2NpZGFkYW8nKVxuICAgICAgLndoZXJlKCdkYWRvcy5wdWJsaWNvX3ByaW9yaXRhcmlvID0gOnB1YmxpY29Qcmlvcml0YXJpbycsIHtcbiAgICAgICAgcHVibGljb1ByaW9yaXRhcmlvLFxuICAgICAgfSlcbiAgICAgIC5vcmRlckJ5KCdkYWRvcy5jcmVhdGVkX2F0JywgJ0RFU0MnKVxuICAgICAgLmdldE1hbnkoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdXNjYXIgZGFkb3MgcG9yIGVzcGVjaWZpY2HDp8OjbyBkbyBhbHVndWVsXG4gICAqL1xuICBhc3luYyBmaW5kQnlFc3BlY2lmaWNhY2FvKFxuICAgIGVzcGVjaWZpY2FjYW86IEVzcGVjaWZpY2FjYW9BbHVndWVsLFxuICApOiBQcm9taXNlPERhZG9zQWx1Z3VlbFNvY2lhbFtdPiB7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlUXVlcnlCdWlsZGVyKCdkYWRvcycpXG4gICAgICAubGVmdEpvaW5BbmRTZWxlY3QoJ2RhZG9zLnNvbGljaXRhY2FvJywgJ3NvbGljaXRhY2FvJylcbiAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdCgnc29saWNpdGFjYW8uY2lkYWRhbycsICdjaWRhZGFvJylcbiAgICAgIC53aGVyZSgnZGFkb3MuZXNwZWNpZmljYWNhb19hbHVndWVsID0gOmVzcGVjaWZpY2FjYW8nLCB7IGVzcGVjaWZpY2FjYW8gfSlcbiAgICAgIC5vcmRlckJ5KCdkYWRvcy5jcmVhdGVkX2F0JywgJ0RFU0MnKVxuICAgICAgLmdldE1hbnkoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdXNjYXIgZGFkb3MgcG9yIGZhaXhhIGRlIHZhbG9yIGRvIGFsdWd1ZWxcbiAgICovXG4gIGFzeW5jIGZpbmRCeUZhaXhhVmFsb3IoXG4gICAgdmFsb3JNaW5pbW86IG51bWJlcixcbiAgICB2YWxvck1heGltbzogbnVtYmVyLFxuICApOiBQcm9taXNlPERhZG9zQWx1Z3VlbFNvY2lhbFtdPiB7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlUXVlcnlCdWlsZGVyKCdkYWRvcycpXG4gICAgICAubGVmdEpvaW5BbmRTZWxlY3QoJ2RhZG9zLnNvbGljaXRhY2FvJywgJ3NvbGljaXRhY2FvJylcbiAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdCgnc29saWNpdGFjYW8uY2lkYWRhbycsICdjaWRhZGFvJylcbiAgICAgIC53aGVyZSgnZGFkb3MudmFsb3JfYWx1Z3VlbCBCRVRXRUVOIDp2YWxvck1pbmltbyBBTkQgOnZhbG9yTWF4aW1vJywge1xuICAgICAgICB2YWxvck1pbmltbyxcbiAgICAgICAgdmFsb3JNYXhpbW8sXG4gICAgICB9KVxuICAgICAgLm9yZGVyQnkoJ2RhZG9zLnZhbG9yX2FsdWd1ZWwnLCAnQVNDJylcbiAgICAgIC5nZXRNYW55KCk7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2FyIGRhZG9zIHBvciBwZXLDrW9kbyBkZSBpbsOtY2lvIGRvIGFsdWd1ZWxcbiAgICovXG4gIGFzeW5jIGZpbmRCeVBlcmlvZG9JbmljaW8oXG4gICAgZGF0YUluaWNpbzogRGF0ZSxcbiAgICBkYXRhRmltOiBEYXRlLFxuICApOiBQcm9taXNlPERhZG9zQWx1Z3VlbFNvY2lhbFtdPiB7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlUXVlcnlCdWlsZGVyKCdkYWRvcycpXG4gICAgICAubGVmdEpvaW5BbmRTZWxlY3QoJ2RhZG9zLnNvbGljaXRhY2FvJywgJ3NvbGljaXRhY2FvJylcbiAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdCgnc29saWNpdGFjYW8uY2lkYWRhbycsICdjaWRhZGFvJylcbiAgICAgIC53aGVyZSgnZGFkb3MuZGF0YV9pbmljaW9fYWx1Z3VlbCBCRVRXRUVOIDpkYXRhSW5pY2lvIEFORCA6ZGF0YUZpbScsIHtcbiAgICAgICAgZGF0YUluaWNpbyxcbiAgICAgICAgZGF0YUZpbSxcbiAgICAgIH0pXG4gICAgICAub3JkZXJCeSgnZGFkb3MuZGF0YV9pbmljaW9fYWx1Z3VlbCcsICdERVNDJylcbiAgICAgIC5nZXRNYW55KCk7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2FyIGVzdGF0w61zdGljYXMgZGUgYWx1Z3VlbCBzb2NpYWxcbiAgICovXG4gIGFzeW5jIGdldEVzdGF0aXN0aWNhcygpOiBQcm9taXNlPHtcbiAgICB0b3RhbFNvbGljaXRhY29lczogbnVtYmVyO1xuICAgIHZhbG9yTWVkaW9BbHVndWVsOiBudW1iZXI7XG4gICAgdmFsb3JUb3RhbEFsdWd1ZWlzOiBudW1iZXI7XG4gICAgcG9yUHVibGljb1ByaW9yaXRhcmlvOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+O1xuICAgIHBvckVzcGVjaWZpY2FjYW86IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gICAgcG9yRmFpeGFWYWxvcjogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgfT4ge1xuICAgIGNvbnN0IHRvdGFsU29saWNpdGFjb2VzID0gYXdhaXQgdGhpcy5jb3VudCgpO1xuXG4gICAgLy8gVmFsb3IgbcOpZGlvIGUgdG90YWwgZG9zIGFsdWd1w6lpc1xuICAgIGNvbnN0IHZhbG9yZXNSZXN1bHQgPSBhd2FpdCB0aGlzLmNyZWF0ZVF1ZXJ5QnVpbGRlcignZGFkb3MnKVxuICAgICAgLnNlbGVjdCgnQVZHKGRhZG9zLnZhbG9yX2FsdWd1ZWwpJywgJ3ZhbG9yTWVkaW8nKVxuICAgICAgLmFkZFNlbGVjdCgnU1VNKGRhZG9zLnZhbG9yX2FsdWd1ZWwpJywgJ3ZhbG9yVG90YWwnKVxuICAgICAgLndoZXJlKCdkYWRvcy52YWxvcl9hbHVndWVsIElTIE5PVCBOVUxMJylcbiAgICAgIC5nZXRSYXdPbmUoKTtcblxuICAgIGNvbnN0IHZhbG9yTWVkaW9BbHVndWVsID0gcGFyc2VGbG9hdCh2YWxvcmVzUmVzdWx0LnZhbG9yTWVkaW8pIHx8IDA7XG4gICAgY29uc3QgdmFsb3JUb3RhbEFsdWd1ZWlzID0gcGFyc2VGbG9hdCh2YWxvcmVzUmVzdWx0LnZhbG9yVG90YWwpIHx8IDA7XG5cbiAgICAvLyBFc3RhdMOtc3RpY2FzIHBvciBww7pibGljbyBwcmlvcml0w6FyaW9cbiAgICBjb25zdCBwb3JQdWJsaWNvUmVzdWx0ID0gYXdhaXQgdGhpcy5jcmVhdGVRdWVyeUJ1aWxkZXIoJ2RhZG9zJylcbiAgICAgIC5zZWxlY3QoJ2RhZG9zLnB1YmxpY29fcHJpb3JpdGFyaW8nLCAncHVibGljbycpXG4gICAgICAuYWRkU2VsZWN0KCdDT1VOVCgqKScsICdxdWFudGlkYWRlJylcbiAgICAgIC5ncm91cEJ5KCdkYWRvcy5wdWJsaWNvX3ByaW9yaXRhcmlvJylcbiAgICAgIC5nZXRSYXdNYW55KCk7XG5cbiAgICBjb25zdCBwb3JQdWJsaWNvUHJpb3JpdGFyaW8gPSBwb3JQdWJsaWNvUmVzdWx0LnJlZHVjZSgoYWNjLCBpdGVtKSA9PiB7XG4gICAgICBhY2NbaXRlbS5wdWJsaWNvXSA9IHBhcnNlSW50KGl0ZW0ucXVhbnRpZGFkZSk7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9KTtcblxuICAgIC8vIEVzdGF0w61zdGljYXMgcG9yIGVzcGVjaWZpY2HDp8Ojb1xuICAgIGNvbnN0IHBvckVzcGVjaWZpY2FjYW9SZXN1bHQgPSBhd2FpdCB0aGlzLmNyZWF0ZVF1ZXJ5QnVpbGRlcignZGFkb3MnKVxuICAgICAgLnNlbGVjdCgnZGFkb3MuZXNwZWNpZmljYWNhb19hbHVndWVsJywgJ2VzcGVjaWZpY2FjYW8nKVxuICAgICAgLmFkZFNlbGVjdCgnQ09VTlQoKiknLCAncXVhbnRpZGFkZScpXG4gICAgICAuZ3JvdXBCeSgnZGFkb3MuZXNwZWNpZmljYWNhb19hbHVndWVsJylcbiAgICAgIC5nZXRSYXdNYW55KCk7XG5cbiAgICBjb25zdCBwb3JFc3BlY2lmaWNhY2FvID0gcG9yRXNwZWNpZmljYWNhb1Jlc3VsdC5yZWR1Y2UoKGFjYywgaXRlbSkgPT4ge1xuICAgICAgYWNjW2l0ZW0uZXNwZWNpZmljYWNhb10gPSBwYXJzZUludChpdGVtLnF1YW50aWRhZGUpO1xuICAgICAgcmV0dXJuIGFjYztcbiAgICB9LCB7fSk7XG5cbiAgICAvLyBFc3RhdMOtc3RpY2FzIHBvciBmYWl4YSBkZSB2YWxvclxuICAgIGNvbnN0IHBvckZhaXhhVmFsb3JSZXN1bHQgPSBhd2FpdCB0aGlzLmNyZWF0ZVF1ZXJ5QnVpbGRlcignZGFkb3MnKVxuICAgICAgLnNlbGVjdChcbiAgICAgICAgYENBU0UgXG4gICAgICAgICAgV0hFTiBkYWRvcy52YWxvcl9hbHVndWVsIDw9IDUwMCBUSEVOICdBdMOpIFIkIDUwMCdcbiAgICAgICAgICBXSEVOIGRhZG9zLnZhbG9yX2FsdWd1ZWwgPD0gMTAwMCBUSEVOICdSJCA1MDEgLSBSJCAxLjAwMCdcbiAgICAgICAgICBXSEVOIGRhZG9zLnZhbG9yX2FsdWd1ZWwgPD0gMTUwMCBUSEVOICdSJCAxLjAwMSAtIFIkIDEuNTAwJ1xuICAgICAgICAgIFdIRU4gZGFkb3MudmFsb3JfYWx1Z3VlbCA8PSAyMDAwIFRIRU4gJ1IkIDEuNTAxIC0gUiQgMi4wMDAnXG4gICAgICAgICAgRUxTRSAnQWNpbWEgZGUgUiQgMi4wMDAnXG4gICAgICAgIEVORGAsXG4gICAgICAgICdmYWl4YScsXG4gICAgICApXG4gICAgICAuYWRkU2VsZWN0KCdDT1VOVCgqKScsICdxdWFudGlkYWRlJylcbiAgICAgIC53aGVyZSgnZGFkb3MudmFsb3JfYWx1Z3VlbCBJUyBOT1QgTlVMTCcpXG4gICAgICAuZ3JvdXBCeSgnZmFpeGEnKVxuICAgICAgLmdldFJhd01hbnkoKTtcblxuICAgIGNvbnN0IHBvckZhaXhhVmFsb3IgPSBwb3JGYWl4YVZhbG9yUmVzdWx0LnJlZHVjZSgoYWNjLCBpdGVtKSA9PiB7XG4gICAgICBhY2NbaXRlbS5mYWl4YV0gPSBwYXJzZUludChpdGVtLnF1YW50aWRhZGUpO1xuICAgICAgcmV0dXJuIGFjYztcbiAgICB9LCB7fSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxTb2xpY2l0YWNvZXMsXG4gICAgICB2YWxvck1lZGlvQWx1Z3VlbCxcbiAgICAgIHZhbG9yVG90YWxBbHVndWVpcyxcbiAgICAgIHBvclB1YmxpY29Qcmlvcml0YXJpbyxcbiAgICAgIHBvckVzcGVjaWZpY2FjYW8sXG4gICAgICBwb3JGYWl4YVZhbG9yLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2FyIGR1cGxpY2F0YXMgcG9yIGVuZGVyZcOnb1xuICAgKi9cbiAgYXN5bmMgZmluZER1cGxpY2F0ZXNCeUVuZGVyZWNvKFxuICAgIGVuZGVyZWNvOiBzdHJpbmcsXG4gICAgZXhjbHVkZUlkPzogc3RyaW5nLFxuICApOiBQcm9taXNlPERhZG9zQWx1Z3VlbFNvY2lhbFtdPiB7XG4gICAgY29uc3QgcXVlcnkgPSB0aGlzLmNyZWF0ZVF1ZXJ5QnVpbGRlcignZGFkb3MnKVxuICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KCdkYWRvcy5zb2xpY2l0YWNhbycsICdzb2xpY2l0YWNhbycpXG4gICAgICAud2hlcmUoJ0xPV0VSKGRhZG9zLmVuZGVyZWNvX2ltb3ZlbCkgPSBMT1dFUig6ZW5kZXJlY28pJywgeyBlbmRlcmVjbyB9KTtcblxuICAgIGlmIChleGNsdWRlSWQpIHtcbiAgICAgIHF1ZXJ5LmFuZFdoZXJlKCdkYWRvcy5pZCAhPSA6ZXhjbHVkZUlkJywgeyBleGNsdWRlSWQgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHF1ZXJ5LmdldE1hbnkoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdXNjYXIgZGFkb3MgZGUgYWx1Z3VlbCBzb2NpYWwgY29tIGZpbHRyb3MgYXZhbsOnYWRvc1xuICAgKi9cbiAgYXN5bmMgZmluZFdpdGhGaWx0ZXJzKGZpbHRlcnM6IHtcbiAgICBwdWJsaWNvUHJpb3JpdGFyaW8/OiBQdWJsaWNvUHJpb3JpdGFyaW9BbHVndWVsO1xuICAgIGVzcGVjaWZpY2FjYW8/OiBFc3BlY2lmaWNhY2FvQWx1Z3VlbDtcbiAgICB2YWxvck1pbmltbz86IG51bWJlcjtcbiAgICB2YWxvck1heGltbz86IG51bWJlcjtcbiAgICBkYXRhSW5pY2lvTWluPzogRGF0ZTtcbiAgICBkYXRhSW5pY2lvTWF4PzogRGF0ZTtcbiAgICBlbmRlcmVjbz86IHN0cmluZztcbiAgICBwYWdlPzogbnVtYmVyO1xuICAgIGxpbWl0PzogbnVtYmVyO1xuICB9KTogUHJvbWlzZTx7IGRhdGE6IERhZG9zQWx1Z3VlbFNvY2lhbFtdOyB0b3RhbDogbnVtYmVyIH0+IHtcbiAgICBjb25zdCBxdWVyeSA9IHRoaXMuY3JlYXRlUXVlcnlCdWlsZGVyKCdkYWRvcycpXG4gICAgICAubGVmdEpvaW5BbmRTZWxlY3QoJ2RhZG9zLnNvbGljaXRhY2FvJywgJ3NvbGljaXRhY2FvJylcbiAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdCgnc29saWNpdGFjYW8uY2lkYWRhbycsICdjaWRhZGFvJyk7XG5cbiAgICBpZiAoZmlsdGVycy5wdWJsaWNvUHJpb3JpdGFyaW8pIHtcbiAgICAgIHF1ZXJ5LmFuZFdoZXJlKCdkYWRvcy5wdWJsaWNvX3ByaW9yaXRhcmlvID0gOnB1YmxpY29Qcmlvcml0YXJpbycsIHtcbiAgICAgICAgcHVibGljb1ByaW9yaXRhcmlvOiBmaWx0ZXJzLnB1YmxpY29Qcmlvcml0YXJpbyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChmaWx0ZXJzLmVzcGVjaWZpY2FjYW8pIHtcbiAgICAgIHF1ZXJ5LmFuZFdoZXJlKCdkYWRvcy5lc3BlY2lmaWNhY2FvX2FsdWd1ZWwgPSA6ZXNwZWNpZmljYWNhbycsIHtcbiAgICAgICAgZXNwZWNpZmljYWNhbzogZmlsdGVycy5lc3BlY2lmaWNhY2FvLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGZpbHRlcnMudmFsb3JNaW5pbW8pIHtcbiAgICAgIHF1ZXJ5LmFuZFdoZXJlKCdkYWRvcy52YWxvcl9hbHVndWVsID49IDp2YWxvck1pbmltbycsIHtcbiAgICAgICAgdmFsb3JNaW5pbW86IGZpbHRlcnMudmFsb3JNaW5pbW8sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoZmlsdGVycy52YWxvck1heGltbykge1xuICAgICAgcXVlcnkuYW5kV2hlcmUoJ2RhZG9zLnZhbG9yX2FsdWd1ZWwgPD0gOnZhbG9yTWF4aW1vJywge1xuICAgICAgICB2YWxvck1heGltbzogZmlsdGVycy52YWxvck1heGltbyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChmaWx0ZXJzLmRhdGFJbmljaW9NaW4gJiYgZmlsdGVycy5kYXRhSW5pY2lvTWF4KSB7XG4gICAgICBxdWVyeS5hbmRXaGVyZShcbiAgICAgICAgJ2RhZG9zLmRhdGFfaW5pY2lvX2FsdWd1ZWwgQkVUV0VFTiA6ZGF0YUluaWNpb01pbiBBTkQgOmRhdGFJbmljaW9NYXgnLFxuICAgICAgICB7XG4gICAgICAgICAgZGF0YUluaWNpb01pbjogZmlsdGVycy5kYXRhSW5pY2lvTWluLFxuICAgICAgICAgIGRhdGFJbmljaW9NYXg6IGZpbHRlcnMuZGF0YUluaWNpb01heCxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGZpbHRlcnMuZW5kZXJlY28pIHtcbiAgICAgIHF1ZXJ5LmFuZFdoZXJlKCdMT1dFUihkYWRvcy5lbmRlcmVjb19pbW92ZWwpIExJS0UgTE9XRVIoOmVuZGVyZWNvKScsIHtcbiAgICAgICAgZW5kZXJlY286IGAlJHtmaWx0ZXJzLmVuZGVyZWNvfSVgLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgdG90YWwgPSBhd2FpdCBxdWVyeS5nZXRDb3VudCgpO1xuXG4gICAgaWYgKGZpbHRlcnMucGFnZSAmJiBmaWx0ZXJzLmxpbWl0KSB7XG4gICAgICBxdWVyeS5za2lwKChmaWx0ZXJzLnBhZ2UgLSAxKSAqIGZpbHRlcnMubGltaXQpLnRha2UoZmlsdGVycy5saW1pdCk7XG4gICAgfVxuXG4gICAgcXVlcnkub3JkZXJCeSgnZGFkb3MuY3JlYXRlZF9hdCcsICdERVNDJyk7XG5cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcXVlcnkuZ2V0TWFueSgpO1xuXG4gICAgcmV0dXJuIHsgZGF0YSwgdG90YWwgfTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9