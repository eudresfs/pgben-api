e6515afb558ce1e3b41288f6077fc885
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var DashboardService_1;
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DashboardService = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const solicitacao_entity_1 = require("../../../entities/solicitacao.entity");
const recurso_entity_1 = require("../../../entities/recurso.entity");
const tipo_beneficio_entity_1 = require("../../../entities/tipo-beneficio.entity");
const unidade_entity_1 = require("../../../entities/unidade.entity");
/**
 * Serviço responsável por fornecer dados para o dashboard
 */
let DashboardService = DashboardService_1 = class DashboardService {
    solicitacaoRepository;
    recursoRepository;
    tipoBeneficioRepository;
    unidadeRepository;
    logger = new common_1.Logger(DashboardService_1.name);
    constructor(solicitacaoRepository, recursoRepository, tipoBeneficioRepository, unidadeRepository) {
        this.solicitacaoRepository = solicitacaoRepository;
        this.recursoRepository = recursoRepository;
        this.tipoBeneficioRepository = tipoBeneficioRepository;
        this.unidadeRepository = unidadeRepository;
        this.logger.log('Serviço de Dashboard inicializado');
    }
    /**
     * Obtém o resumo para o dashboard
     * @returns Resumo do dashboard
     */
    async obterResumo() {
        // Contagem de solicitações por status
        const solicitacoesTotal = await this.solicitacaoRepository.count();
        const solicitacoesPendentes = await this.solicitacaoRepository.count({
            where: { status: solicitacao_entity_1.StatusSolicitacao.PENDENTE },
        });
        const solicitacoesEmAnalise = await this.solicitacaoRepository.count({
            where: { status: solicitacao_entity_1.StatusSolicitacao.EM_ANALISE },
        });
        const solicitacoesAprovadas = await this.solicitacaoRepository.count({
            where: { status: solicitacao_entity_1.StatusSolicitacao.APROVADA },
        });
        const solicitacoesReprovadas = await this.solicitacaoRepository.count({
            where: { status: solicitacao_entity_1.StatusSolicitacao.INDEFERIDA },
        });
        const solicitacoesLiberadas = await this.solicitacaoRepository.count({
            where: { status: solicitacao_entity_1.StatusSolicitacao.LIBERADA },
        });
        const solicitacoesCanceladas = await this.solicitacaoRepository.count({
            where: { status: solicitacao_entity_1.StatusSolicitacao.CANCELADA },
        });
        // Contagem de recursos por status
        const recursosTotal = await this.recursoRepository.count();
        const recursosPendentes = await this.recursoRepository.count({
            where: { status: recurso_entity_1.StatusRecurso.PENDENTE },
        });
        const recursosEmAnalise = await this.recursoRepository.count({
            where: { status: recurso_entity_1.StatusRecurso.EM_ANALISE },
        });
        const recursosDeferidos = await this.recursoRepository.count({
            where: { status: recurso_entity_1.StatusRecurso.DEFERIDO },
        });
        const recursosIndeferidos = await this.recursoRepository.count({
            where: { status: recurso_entity_1.StatusRecurso.INDEFERIDO },
        });
        // Contagem de benefícios por tipo
        const beneficiosPorTipo = await this.tipoBeneficioRepository
            .createQueryBuilder('tipo')
            .select('tipo.nome', 'tipo')
            .addSelect('COUNT(solicitacao.id)', 'quantidade')
            .leftJoin('tipo.solicitacoes', 'solicitacao')
            .where('solicitacao.status = :status', {
            status: solicitacao_entity_1.StatusSolicitacao.LIBERADA,
        })
            .groupBy('tipo.id')
            .orderBy('quantidade', 'DESC')
            .limit(5)
            .getRawMany();
        // Unidades mais ativas
        const unidadesMaisAtivas = await this.unidadeRepository
            .createQueryBuilder('unidade')
            .select('unidade.nome', 'nome')
            .addSelect('COUNT(solicitacao.id)', 'solicitacoes')
            .leftJoin('unidade.solicitacoes', 'solicitacao')
            .groupBy('unidade.id')
            .orderBy('solicitacoes', 'DESC')
            .limit(5)
            .getRawMany();
        return {
            solicitacoes: {
                total: solicitacoesTotal,
                pendentes: solicitacoesPendentes,
                emAnalise: solicitacoesEmAnalise,
                aprovadas: solicitacoesAprovadas,
                reprovadas: solicitacoesReprovadas,
                liberadas: solicitacoesLiberadas,
                canceladas: solicitacoesCanceladas,
            },
            recursos: {
                total: recursosTotal,
                pendentes: recursosPendentes,
                emAnalise: recursosEmAnalise,
                deferidos: recursosDeferidos,
                indeferidos: recursosIndeferidos,
            },
            beneficios: {
                total: solicitacoesLiberadas,
                porTipo: beneficiosPorTipo,
            },
            unidades: {
                total: await this.unidadeRepository.count(),
                maisAtivas: unidadesMaisAtivas,
            },
        };
    }
    /**
     * Obtém os KPIs para o dashboard
     * @returns KPIs do dashboard
     */
    async obterKPIs() {
        // Tempo médio de análise (em dias)
        const tempoMedioAnaliseResult = await this.solicitacaoRepository
            .createQueryBuilder('solicitacao')
            .select('AVG(EXTRACT(EPOCH FROM (solicitacao.data_aprovacao - solicitacao.data_abertura)) / 86400)', 'media')
            .where('solicitacao.status IN (:...status)', {
            status: [solicitacao_entity_1.StatusSolicitacao.APROVADA, solicitacao_entity_1.StatusSolicitacao.INDEFERIDA],
        })
            .andWhere('solicitacao.data_aprovacao IS NOT NULL')
            .getRawOne();
        const tempoMedioAnalise = tempoMedioAnaliseResult?.media || 0;
        // Taxa de aprovação
        const totalAnalisadas = await this.solicitacaoRepository.count({
            where: [
                { status: solicitacao_entity_1.StatusSolicitacao.APROVADA },
                { status: solicitacao_entity_1.StatusSolicitacao.INDEFERIDA },
            ],
        });
        const totalAprovadas = await this.solicitacaoRepository.count({
            where: { status: solicitacao_entity_1.StatusSolicitacao.APROVADA },
        });
        const taxaAprovacao = totalAnalisadas > 0 ? (totalAprovadas / totalAnalisadas) * 100 : 0;
        // Taxa de recurso
        const totalReprovadas = await this.solicitacaoRepository.count({
            where: { status: solicitacao_entity_1.StatusSolicitacao.INDEFERIDA },
        });
        const totalRecursos = await this.recursoRepository.count();
        const taxaRecurso = totalReprovadas > 0 ? (totalRecursos / totalReprovadas) * 100 : 0;
        // Taxa de deferimento
        const totalRecursosAnalisados = await this.recursoRepository.count({
            where: [
                { status: recurso_entity_1.StatusRecurso.DEFERIDO },
                { status: recurso_entity_1.StatusRecurso.INDEFERIDO },
            ],
        });
        const totalDeferidos = await this.recursoRepository.count({
            where: { status: recurso_entity_1.StatusRecurso.DEFERIDO },
        });
        const taxaDeferimento = totalRecursosAnalisados > 0
            ? (totalDeferidos / totalRecursosAnalisados) * 100
            : 0;
        // Solicitações por dia (últimos 30 dias)
        const dataInicio = new Date();
        dataInicio.setDate(dataInicio.getDate() - 30);
        const totalSolicitacoes30Dias = await this.solicitacaoRepository.count({
            where: {
                data_abertura: (0, typeorm_2.Between)(dataInicio, new Date()),
            },
        });
        const solicitacoesPorDia = totalSolicitacoes30Dias / 30;
        // Benefícios por dia (últimos 30 dias)
        const totalBeneficios30Dias = await this.solicitacaoRepository.count({
            where: {
                status: solicitacao_entity_1.StatusSolicitacao.LIBERADA,
                data_liberacao: (0, typeorm_2.Between)(dataInicio, new Date()),
            },
        });
        const beneficiosPorDia = totalBeneficios30Dias / 30;
        return {
            tempoMedioAnalise,
            taxaAprovacao,
            taxaRecurso,
            taxaDeferimento,
            solicitacoesPorDia,
            beneficiosPorDia,
        };
    }
    /**
     * Obtém dados para gráficos do dashboard
     * @param periodo Período para filtrar os dados (em dias)
     * @returns Dados para gráficos
     */
    async obterGraficos(periodo = 30) {
        const dataInicio = new Date();
        dataInicio.setDate(dataInicio.getDate() - periodo);
        // Solicitações por período (agrupadas por dia)
        const solicitacoesPorPeriodo = await this.solicitacaoRepository
            .createQueryBuilder('solicitacao')
            .select("TO_CHAR(solicitacao.data_abertura, 'YYYY-MM-DD')", 'data')
            .addSelect('COUNT(solicitacao.id)', 'quantidade')
            .where('solicitacao.data_abertura >= :dataInicio', { dataInicio })
            .groupBy('data')
            .orderBy('data', 'ASC')
            .getRawMany();
        // Solicitações por status
        const solicitacoesPorStatus = await this.solicitacaoRepository
            .createQueryBuilder('solicitacao')
            .select('solicitacao.status', 'status')
            .addSelect('COUNT(solicitacao.id)', 'quantidade')
            .groupBy('solicitacao.status')
            .orderBy('quantidade', 'DESC')
            .getRawMany();
        // Solicitações por unidade
        const solicitacoesPorUnidade = await this.solicitacaoRepository
            .createQueryBuilder('solicitacao')
            .select('unidade.nome', 'unidade')
            .addSelect('COUNT(solicitacao.id)', 'quantidade')
            .leftJoin('solicitacao.unidade', 'unidade')
            .groupBy('unidade.id')
            .orderBy('quantidade', 'DESC')
            .limit(10)
            .getRawMany();
        // Solicitações por tipo de benefício
        const solicitacoesPorBeneficio = await this.solicitacaoRepository
            .createQueryBuilder('solicitacao')
            .select('tipo.nome', 'beneficio')
            .addSelect('COUNT(solicitacao.id)', 'quantidade')
            .leftJoin('solicitacao.tipo_beneficio', 'tipo')
            .groupBy('tipo.id')
            .orderBy('quantidade', 'DESC')
            .getRawMany();
        return {
            solicitacoesPorPeriodo,
            solicitacoesPorStatus,
            solicitacoesPorUnidade,
            solicitacoesPorBeneficio,
        };
    }
};
exports.DashboardService = DashboardService;
exports.DashboardService = DashboardService = DashboardService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(solicitacao_entity_1.Solicitacao)),
    __param(1, (0, typeorm_1.InjectRepository)(recurso_entity_1.Recurso)),
    __param(2, (0, typeorm_1.InjectRepository)(tipo_beneficio_entity_1.TipoBeneficio)),
    __param(3, (0, typeorm_1.InjectRepository)(unidade_entity_1.Unidade)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object, typeof (_d = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _d : Object])
], DashboardService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXG1ldHJpY2FzXFxzZXJ2aWNlc1xcZGFzaGJvYXJkLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBb0Q7QUFDcEQsNkNBQW1EO0FBQ25ELHFDQUE4QztBQUM5Qyw2RUFHOEM7QUFDOUMscUVBQTBFO0FBQzFFLG1GQUF3RTtBQUN4RSxxRUFBMkQ7QUF5RTNEOztHQUVHO0FBRUksSUFBTSxnQkFBZ0Isd0JBQXRCLE1BQU0sZ0JBQWdCO0lBS2pCO0lBR0E7SUFHQTtJQUdBO0lBYk8sTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLGtCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTVELFlBRVUscUJBQThDLEVBRzlDLGlCQUFzQyxFQUd0Qyx1QkFBa0QsRUFHbEQsaUJBQXNDO1FBVHRDLDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBeUI7UUFHOUMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFxQjtRQUd0Qyw0QkFBdUIsR0FBdkIsdUJBQXVCLENBQTJCO1FBR2xELHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBcUI7UUFFOUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsbUNBQW1DLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLFdBQVc7UUFDZixzQ0FBc0M7UUFDdEMsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNuRSxNQUFNLHFCQUFxQixHQUFHLE1BQU0sSUFBSSxDQUFDLHFCQUFxQixDQUFDLEtBQUssQ0FBQztZQUNuRSxLQUFLLEVBQUUsRUFBRSxNQUFNLEVBQUUsc0NBQWlCLENBQUMsUUFBUSxFQUFFO1NBQzlDLENBQUMsQ0FBQztRQUNILE1BQU0scUJBQXFCLEdBQUcsTUFBTSxJQUFJLENB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b0JBQVU7R0FkNUIsZ0JBQWdCLENBc1E1QiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xcbWV0cmljYXNcXHNlcnZpY2VzXFxkYXNoYm9hcmQuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBMb2dnZXIgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBJbmplY3RSZXBvc2l0b3J5IH0gZnJvbSAnQG5lc3Rqcy90eXBlb3JtJztcbmltcG9ydCB7IFJlcG9zaXRvcnksIEJldHdlZW4gfSBmcm9tICd0eXBlb3JtJztcbmltcG9ydCB7XG4gIFNvbGljaXRhY2FvLFxuICBTdGF0dXNTb2xpY2l0YWNhbyxcbn0gZnJvbSAnLi4vLi4vLi4vZW50aXRpZXMvc29saWNpdGFjYW8uZW50aXR5JztcbmltcG9ydCB7IFJlY3Vyc28sIFN0YXR1c1JlY3Vyc28gfSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy9yZWN1cnNvLmVudGl0eSc7XG5pbXBvcnQgeyBUaXBvQmVuZWZpY2lvIH0gZnJvbSAnLi4vLi4vLi4vZW50aXRpZXMvdGlwby1iZW5lZmljaW8uZW50aXR5JztcbmltcG9ydCB7IFVuaWRhZGUgfSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy91bmlkYWRlLmVudGl0eSc7XG5pbXBvcnQgeyBVc3VhcmlvIH0gZnJvbSAnLi4vLi4vLi4vZW50aXRpZXMvdXN1YXJpby5lbnRpdHknO1xuXG4vKipcbiAqIEludGVyZmFjZSBwYXJhIG8gcmVzdW1vIGRvIGRhc2hib2FyZFxuICovXG5leHBvcnQgaW50ZXJmYWNlIFJlc3Vtb0Rhc2hib2FyZCB7XG4gIHNvbGljaXRhY29lczoge1xuICAgIHRvdGFsOiBudW1iZXI7XG4gICAgcGVuZGVudGVzOiBudW1iZXI7XG4gICAgZW1BbmFsaXNlOiBudW1iZXI7XG4gICAgYXByb3ZhZGFzOiBudW1iZXI7XG4gICAgcmVwcm92YWRhczogbnVtYmVyO1xuICAgIGxpYmVyYWRhczogbnVtYmVyO1xuICAgIGNhbmNlbGFkYXM6IG51bWJlcjtcbiAgfTtcbiAgcmVjdXJzb3M6IHtcbiAgICB0b3RhbDogbnVtYmVyO1xuICAgIHBlbmRlbnRlczogbnVtYmVyO1xuICAgIGVtQW5hbGlzZTogbnVtYmVyO1xuICAgIGRlZmVyaWRvczogbnVtYmVyO1xuICAgIGluZGVmZXJpZG9zOiBudW1iZXI7XG4gIH07XG4gIGJlbmVmaWNpb3M6IHtcbiAgICB0b3RhbDogbnVtYmVyO1xuICAgIHBvclRpcG86IEFycmF5PHtcbiAgICAgIHRpcG86IHN0cmluZztcbiAgICAgIHF1YW50aWRhZGU6IG51bWJlcjtcbiAgICB9PjtcbiAgfTtcbiAgdW5pZGFkZXM6IHtcbiAgICB0b3RhbDogbnVtYmVyO1xuICAgIG1haXNBdGl2YXM6IEFycmF5PHtcbiAgICAgIG5vbWU6IHN0cmluZztcbiAgICAgIHNvbGljaXRhY29lczogbnVtYmVyO1xuICAgIH0+O1xuICB9O1xufVxuXG4vKipcbiAqIEludGVyZmFjZSBwYXJhIG9zIEtQSXMgZG8gZGFzaGJvYXJkXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgS3Bpc0Rhc2hib2FyZCB7XG4gIHRlbXBvTWVkaW9BbmFsaXNlOiBudW1iZXI7XG4gIHRheGFBcHJvdmFjYW86IG51bWJlcjtcbiAgdGF4YVJlY3Vyc286IG51bWJlcjtcbiAgdGF4YURlZmVyaW1lbnRvOiBudW1iZXI7XG4gIHNvbGljaXRhY29lc1BvckRpYTogbnVtYmVyO1xuICBiZW5lZmljaW9zUG9yRGlhOiBudW1iZXI7XG59XG5cbi8qKlxuICogSW50ZXJmYWNlIHBhcmEgb3MgZ3LDoWZpY29zIGRvIGRhc2hib2FyZFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEdyYWZpY29zRGFzaGJvYXJkIHtcbiAgc29saWNpdGFjb2VzUG9yUGVyaW9kbzogQXJyYXk8e1xuICAgIGRhdGE6IHN0cmluZztcbiAgICBxdWFudGlkYWRlOiBudW1iZXI7XG4gIH0+O1xuICBzb2xpY2l0YWNvZXNQb3JTdGF0dXM6IEFycmF5PHtcbiAgICBzdGF0dXM6IHN0cmluZztcbiAgICBxdWFudGlkYWRlOiBudW1iZXI7XG4gIH0+O1xuICBzb2xpY2l0YWNvZXNQb3JVbmlkYWRlOiBBcnJheTx7XG4gICAgdW5pZGFkZTogc3RyaW5nO1xuICAgIHF1YW50aWRhZGU6IG51bWJlcjtcbiAgfT47XG4gIHNvbGljaXRhY29lc1BvckJlbmVmaWNpbzogQXJyYXk8e1xuICAgIGJlbmVmaWNpbzogc3RyaW5nO1xuICAgIHF1YW50aWRhZGU6IG51bWJlcjtcbiAgfT47XG59XG5cbi8qKlxuICogU2VydmnDp28gcmVzcG9uc8OhdmVsIHBvciBmb3JuZWNlciBkYWRvcyBwYXJhIG8gZGFzaGJvYXJkXG4gKi9cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBEYXNoYm9hcmRTZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKERhc2hib2FyZFNlcnZpY2UubmFtZSk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdFJlcG9zaXRvcnkoU29saWNpdGFjYW8pXG4gICAgcHJpdmF0ZSBzb2xpY2l0YWNhb1JlcG9zaXRvcnk6IFJlcG9zaXRvcnk8U29saWNpdGFjYW8+LFxuXG4gICAgQEluamVjdFJlcG9zaXRvcnkoUmVjdXJzbylcbiAgICBwcml2YXRlIHJlY3Vyc29SZXBvc2l0b3J5OiBSZXBvc2l0b3J5PFJlY3Vyc28+LFxuXG4gICAgQEluamVjdFJlcG9zaXRvcnkoVGlwb0JlbmVmaWNpbylcbiAgICBwcml2YXRlIHRpcG9CZW5lZmljaW9SZXBvc2l0b3J5OiBSZXBvc2l0b3J5PFRpcG9CZW5lZmljaW8+LFxuXG4gICAgQEluamVjdFJlcG9zaXRvcnkoVW5pZGFkZSlcbiAgICBwcml2YXRlIHVuaWRhZGVSZXBvc2l0b3J5OiBSZXBvc2l0b3J5PFVuaWRhZGU+LFxuICApIHtcbiAgICB0aGlzLmxvZ2dlci5sb2coJ1NlcnZpw6dvIGRlIERhc2hib2FyZCBpbmljaWFsaXphZG8nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gbyByZXN1bW8gcGFyYSBvIGRhc2hib2FyZFxuICAgKiBAcmV0dXJucyBSZXN1bW8gZG8gZGFzaGJvYXJkXG4gICAqL1xuICBhc3luYyBvYnRlclJlc3VtbygpOiBQcm9taXNlPFJlc3Vtb0Rhc2hib2FyZD4ge1xuICAgIC8vIENvbnRhZ2VtIGRlIHNvbGljaXRhw6fDtWVzIHBvciBzdGF0dXNcbiAgICBjb25zdCBzb2xpY2l0YWNvZXNUb3RhbCA9IGF3YWl0IHRoaXMuc29saWNpdGFjYW9SZXBvc2l0b3J5LmNvdW50KCk7XG4gICAgY29uc3Qgc29saWNpdGFjb2VzUGVuZGVudGVzID0gYXdhaXQgdGhpcy5zb2xpY2l0YWNhb1JlcG9zaXRvcnkuY291bnQoe1xuICAgICAgd2hlcmU6IHsgc3RhdHVzOiBTdGF0dXNTb2xpY2l0YWNhby5QRU5ERU5URSB9LFxuICAgIH0pO1xuICAgIGNvbnN0IHNvbGljaXRhY29lc0VtQW5hbGlzZSA9IGF3YWl0IHRoaXMuc29saWNpdGFjYW9SZXBvc2l0b3J5LmNvdW50KHtcbiAgICAgIHdoZXJlOiB7IHN0YXR1czogU3RhdHVzU29saWNpdGFjYW8uRU1fQU5BTElTRSB9LFxuICAgIH0pO1xuICAgIGNvbnN0IHNvbGljaXRhY29lc0Fwcm92YWRhcyA9IGF3YWl0IHRoaXMuc29saWNpdGFjYW9SZXBvc2l0b3J5LmNvdW50KHtcbiAgICAgIHdoZXJlOiB7IHN0YXR1czogU3RhdHVzU29saWNpdGFjYW8uQVBST1ZBREEgfSxcbiAgICB9KTtcbiAgICBjb25zdCBzb2xpY2l0YWNvZXNSZXByb3ZhZGFzID0gYXdhaXQgdGhpcy5zb2xpY2l0YWNhb1JlcG9zaXRvcnkuY291bnQoe1xuICAgICAgd2hlcmU6IHsgc3RhdHVzOiBTdGF0dXNTb2xpY2l0YWNhby5JTkRFRkVSSURBIH0sXG4gICAgfSk7XG4gICAgY29uc3Qgc29saWNpdGFjb2VzTGliZXJhZGFzID0gYXdhaXQgdGhpcy5zb2xpY2l0YWNhb1JlcG9zaXRvcnkuY291bnQoe1xuICAgICAgd2hlcmU6IHsgc3RhdHVzOiBTdGF0dXNTb2xpY2l0YWNhby5MSUJFUkFEQSB9LFxuICAgIH0pO1xuICAgIGNvbnN0IHNvbGljaXRhY29lc0NhbmNlbGFkYXMgPSBhd2FpdCB0aGlzLnNvbGljaXRhY2FvUmVwb3NpdG9yeS5jb3VudCh7XG4gICAgICB3aGVyZTogeyBzdGF0dXM6IFN0YXR1c1NvbGljaXRhY2FvLkNBTkNFTEFEQSB9LFxuICAgIH0pO1xuXG4gICAgLy8gQ29udGFnZW0gZGUgcmVjdXJzb3MgcG9yIHN0YXR1c1xuICAgIGNvbnN0IHJlY3Vyc29zVG90YWwgPSBhd2FpdCB0aGlzLnJlY3Vyc29SZXBvc2l0b3J5LmNvdW50KCk7XG4gICAgY29uc3QgcmVjdXJzb3NQZW5kZW50ZXMgPSBhd2FpdCB0aGlzLnJlY3Vyc29SZXBvc2l0b3J5LmNvdW50KHtcbiAgICAgIHdoZXJlOiB7IHN0YXR1czogU3RhdHVzUmVjdXJzby5QRU5ERU5URSB9LFxuICAgIH0pO1xuICAgIGNvbnN0IHJlY3Vyc29zRW1BbmFsaXNlID0gYXdhaXQgdGhpcy5yZWN1cnNvUmVwb3NpdG9yeS5jb3VudCh7XG4gICAgICB3aGVyZTogeyBzdGF0dXM6IFN0YXR1c1JlY3Vyc28uRU1fQU5BTElTRSB9LFxuICAgIH0pO1xuICAgIGNvbnN0IHJlY3Vyc29zRGVmZXJpZG9zID0gYXdhaXQgdGhpcy5yZWN1cnNvUmVwb3NpdG9yeS5jb3VudCh7XG4gICAgICB3aGVyZTogeyBzdGF0dXM6IFN0YXR1c1JlY3Vyc28uREVGRVJJRE8gfSxcbiAgICB9KTtcbiAgICBjb25zdCByZWN1cnNvc0luZGVmZXJpZG9zID0gYXdhaXQgdGhpcy5yZWN1cnNvUmVwb3NpdG9yeS5jb3VudCh7XG4gICAgICB3aGVyZTogeyBzdGF0dXM6IFN0YXR1c1JlY3Vyc28uSU5ERUZFUklETyB9LFxuICAgIH0pO1xuXG4gICAgLy8gQ29udGFnZW0gZGUgYmVuZWbDrWNpb3MgcG9yIHRpcG9cbiAgICBjb25zdCBiZW5lZmljaW9zUG9yVGlwbyA9IGF3YWl0IHRoaXMudGlwb0JlbmVmaWNpb1JlcG9zaXRvcnlcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoJ3RpcG8nKVxuICAgICAgLnNlbGVjdCgndGlwby5ub21lJywgJ3RpcG8nKVxuICAgICAgLmFkZFNlbGVjdCgnQ09VTlQoc29saWNpdGFjYW8uaWQpJywgJ3F1YW50aWRhZGUnKVxuICAgICAgLmxlZnRKb2luKCd0aXBvLnNvbGljaXRhY29lcycsICdzb2xpY2l0YWNhbycpXG4gICAgICAud2hlcmUoJ3NvbGljaXRhY2FvLnN0YXR1cyA9IDpzdGF0dXMnLCB7XG4gICAgICAgIHN0YXR1czogU3RhdHVzU29saWNpdGFjYW8uTElCRVJBREEsXG4gICAgICB9KVxuICAgICAgLmdyb3VwQnkoJ3RpcG8uaWQnKVxuICAgICAgLm9yZGVyQnkoJ3F1YW50aWRhZGUnLCAnREVTQycpXG4gICAgICAubGltaXQoNSlcbiAgICAgIC5nZXRSYXdNYW55KCk7XG5cbiAgICAvLyBVbmlkYWRlcyBtYWlzIGF0aXZhc1xuICAgIGNvbnN0IHVuaWRhZGVzTWFpc0F0aXZhcyA9IGF3YWl0IHRoaXMudW5pZGFkZVJlcG9zaXRvcnlcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoJ3VuaWRhZGUnKVxuICAgICAgLnNlbGVjdCgndW5pZGFkZS5ub21lJywgJ25vbWUnKVxuICAgICAgLmFkZFNlbGVjdCgnQ09VTlQoc29saWNpdGFjYW8uaWQpJywgJ3NvbGljaXRhY29lcycpXG4gICAgICAubGVmdEpvaW4oJ3VuaWRhZGUuc29saWNpdGFjb2VzJywgJ3NvbGljaXRhY2FvJylcbiAgICAgIC5ncm91cEJ5KCd1bmlkYWRlLmlkJylcbiAgICAgIC5vcmRlckJ5KCdzb2xpY2l0YWNvZXMnLCAnREVTQycpXG4gICAgICAubGltaXQoNSlcbiAgICAgIC5nZXRSYXdNYW55KCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc29saWNpdGFjb2VzOiB7XG4gICAgICAgIHRvdGFsOiBzb2xpY2l0YWNvZXNUb3RhbCxcbiAgICAgICAgcGVuZGVudGVzOiBzb2xpY2l0YWNvZXNQZW5kZW50ZXMsXG4gICAgICAgIGVtQW5hbGlzZTogc29saWNpdGFjb2VzRW1BbmFsaXNlLFxuICAgICAgICBhcHJvdmFkYXM6IHNvbGljaXRhY29lc0Fwcm92YWRhcyxcbiAgICAgICAgcmVwcm92YWRhczogc29saWNpdGFjb2VzUmVwcm92YWRhcyxcbiAgICAgICAgbGliZXJhZGFzOiBzb2xpY2l0YWNvZXNMaWJlcmFkYXMsXG4gICAgICAgIGNhbmNlbGFkYXM6IHNvbGljaXRhY29lc0NhbmNlbGFkYXMsXG4gICAgICB9LFxuICAgICAgcmVjdXJzb3M6IHtcbiAgICAgICAgdG90YWw6IHJlY3Vyc29zVG90YWwsXG4gICAgICAgIHBlbmRlbnRlczogcmVjdXJzb3NQZW5kZW50ZXMsXG4gICAgICAgIGVtQW5hbGlzZTogcmVjdXJzb3NFbUFuYWxpc2UsXG4gICAgICAgIGRlZmVyaWRvczogcmVjdXJzb3NEZWZlcmlkb3MsXG4gICAgICAgIGluZGVmZXJpZG9zOiByZWN1cnNvc0luZGVmZXJpZG9zLFxuICAgICAgfSxcbiAgICAgIGJlbmVmaWNpb3M6IHtcbiAgICAgICAgdG90YWw6IHNvbGljaXRhY29lc0xpYmVyYWRhcyxcbiAgICAgICAgcG9yVGlwbzogYmVuZWZpY2lvc1BvclRpcG8sXG4gICAgICB9LFxuICAgICAgdW5pZGFkZXM6IHtcbiAgICAgICAgdG90YWw6IGF3YWl0IHRoaXMudW5pZGFkZVJlcG9zaXRvcnkuY291bnQoKSxcbiAgICAgICAgbWFpc0F0aXZhczogdW5pZGFkZXNNYWlzQXRpdmFzLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIE9idMOpbSBvcyBLUElzIHBhcmEgbyBkYXNoYm9hcmRcbiAgICogQHJldHVybnMgS1BJcyBkbyBkYXNoYm9hcmRcbiAgICovXG4gIGFzeW5jIG9idGVyS1BJcygpOiBQcm9taXNlPEtwaXNEYXNoYm9hcmQ+IHtcbiAgICAvLyBUZW1wbyBtw6lkaW8gZGUgYW7DoWxpc2UgKGVtIGRpYXMpXG4gICAgY29uc3QgdGVtcG9NZWRpb0FuYWxpc2VSZXN1bHQgPSBhd2FpdCB0aGlzLnNvbGljaXRhY2FvUmVwb3NpdG9yeVxuICAgICAgLmNyZWF0ZVF1ZXJ5QnVpbGRlcignc29saWNpdGFjYW8nKVxuICAgICAgLnNlbGVjdChcbiAgICAgICAgJ0FWRyhFWFRSQUNUKEVQT0NIIEZST00gKHNvbGljaXRhY2FvLmRhdGFfYXByb3ZhY2FvIC0gc29saWNpdGFjYW8uZGF0YV9hYmVydHVyYSkpIC8gODY0MDApJyxcbiAgICAgICAgJ21lZGlhJyxcbiAgICAgIClcbiAgICAgIC53aGVyZSgnc29saWNpdGFjYW8uc3RhdHVzIElOICg6Li4uc3RhdHVzKScsIHtcbiAgICAgICAgc3RhdHVzOiBbU3RhdHVzU29saWNpdGFjYW8uQVBST1ZBREEsIFN0YXR1c1NvbGljaXRhY2FvLklOREVGRVJJREFdLFxuICAgICAgfSlcbiAgICAgIC5hbmRXaGVyZSgnc29saWNpdGFjYW8uZGF0YV9hcHJvdmFjYW8gSVMgTk9UIE5VTEwnKVxuICAgICAgLmdldFJhd09uZSgpO1xuXG4gICAgY29uc3QgdGVtcG9NZWRpb0FuYWxpc2UgPSB0ZW1wb01lZGlvQW5hbGlzZVJlc3VsdD8ubWVkaWEgfHwgMDtcblxuICAgIC8vIFRheGEgZGUgYXByb3Zhw6fDo29cbiAgICBjb25zdCB0b3RhbEFuYWxpc2FkYXMgPSBhd2FpdCB0aGlzLnNvbGljaXRhY2FvUmVwb3NpdG9yeS5jb3VudCh7XG4gICAgICB3aGVyZTogW1xuICAgICAgICB7IHN0YXR1czogU3RhdHVzU29saWNpdGFjYW8uQVBST1ZBREEgfSxcbiAgICAgICAgeyBzdGF0dXM6IFN0YXR1c1NvbGljaXRhY2FvLklOREVGRVJJREEgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBjb25zdCB0b3RhbEFwcm92YWRhcyA9IGF3YWl0IHRoaXMuc29saWNpdGFjYW9SZXBvc2l0b3J5LmNvdW50KHtcbiAgICAgIHdoZXJlOiB7IHN0YXR1czogU3RhdHVzU29saWNpdGFjYW8uQVBST1ZBREEgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHRheGFBcHJvdmFjYW8gPVxuICAgICAgdG90YWxBbmFsaXNhZGFzID4gMCA/ICh0b3RhbEFwcm92YWRhcyAvIHRvdGFsQW5hbGlzYWRhcykgKiAxMDAgOiAwO1xuXG4gICAgLy8gVGF4YSBkZSByZWN1cnNvXG4gICAgY29uc3QgdG90YWxSZXByb3ZhZGFzID0gYXdhaXQgdGhpcy5zb2xpY2l0YWNhb1JlcG9zaXRvcnkuY291bnQoe1xuICAgICAgd2hlcmU6IHsgc3RhdHVzOiBTdGF0dXNTb2xpY2l0YWNhby5JTkRFRkVSSURBIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCB0b3RhbFJlY3Vyc29zID0gYXdhaXQgdGhpcy5yZWN1cnNvUmVwb3NpdG9yeS5jb3VudCgpO1xuICAgIGNvbnN0IHRheGFSZWN1cnNvID1cbiAgICAgIHRvdGFsUmVwcm92YWRhcyA+IDAgPyAodG90YWxSZWN1cnNvcyAvIHRvdGFsUmVwcm92YWRhcykgKiAxMDAgOiAwO1xuXG4gICAgLy8gVGF4YSBkZSBkZWZlcmltZW50b1xuICAgIGNvbnN0IHRvdGFsUmVjdXJzb3NBbmFsaXNhZG9zID0gYXdhaXQgdGhpcy5yZWN1cnNvUmVwb3NpdG9yeS5jb3VudCh7XG4gICAgICB3aGVyZTogW1xuICAgICAgICB7IHN0YXR1czogU3RhdHVzUmVjdXJzby5ERUZFUklETyB9LFxuICAgICAgICB7IHN0YXR1czogU3RhdHVzUmVjdXJzby5JTkRFRkVSSURPIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgY29uc3QgdG90YWxEZWZlcmlkb3MgPSBhd2FpdCB0aGlzLnJlY3Vyc29SZXBvc2l0b3J5LmNvdW50KHtcbiAgICAgIHdoZXJlOiB7IHN0YXR1czogU3RhdHVzUmVjdXJzby5ERUZFUklETyB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgdGF4YURlZmVyaW1lbnRvID1cbiAgICAgIHRvdGFsUmVjdXJzb3NBbmFsaXNhZG9zID4gMFxuICAgICAgICA/ICh0b3RhbERlZmVyaWRvcyAvIHRvdGFsUmVjdXJzb3NBbmFsaXNhZG9zKSAqIDEwMFxuICAgICAgICA6IDA7XG5cbiAgICAvLyBTb2xpY2l0YcOnw7VlcyBwb3IgZGlhICjDumx0aW1vcyAzMCBkaWFzKVxuICAgIGNvbnN0IGRhdGFJbmljaW8gPSBuZXcgRGF0ZSgpO1xuICAgIGRhdGFJbmljaW8uc2V0RGF0ZShkYXRhSW5pY2lvLmdldERhdGUoKSAtIDMwKTtcblxuICAgIGNvbnN0IHRvdGFsU29saWNpdGFjb2VzMzBEaWFzID0gYXdhaXQgdGhpcy5zb2xpY2l0YWNhb1JlcG9zaXRvcnkuY291bnQoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgZGF0YV9hYmVydHVyYTogQmV0d2VlbihkYXRhSW5pY2lvLCBuZXcgRGF0ZSgpKSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBzb2xpY2l0YWNvZXNQb3JEaWEgPSB0b3RhbFNvbGljaXRhY29lczMwRGlhcyAvIDMwO1xuXG4gICAgLy8gQmVuZWbDrWNpb3MgcG9yIGRpYSAow7psdGltb3MgMzAgZGlhcylcbiAgICBjb25zdCB0b3RhbEJlbmVmaWNpb3MzMERpYXMgPSBhd2FpdCB0aGlzLnNvbGljaXRhY2FvUmVwb3NpdG9yeS5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBzdGF0dXM6IFN0YXR1c1NvbGljaXRhY2FvLkxJQkVSQURBLFxuICAgICAgICBkYXRhX2xpYmVyYWNhbzogQmV0d2VlbihkYXRhSW5pY2lvLCBuZXcgRGF0ZSgpKSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBiZW5lZmljaW9zUG9yRGlhID0gdG90YWxCZW5lZmljaW9zMzBEaWFzIC8gMzA7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdGVtcG9NZWRpb0FuYWxpc2UsXG4gICAgICB0YXhhQXByb3ZhY2FvLFxuICAgICAgdGF4YVJlY3Vyc28sXG4gICAgICB0YXhhRGVmZXJpbWVudG8sXG4gICAgICBzb2xpY2l0YWNvZXNQb3JEaWEsXG4gICAgICBiZW5lZmljaW9zUG9yRGlhLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogT2J0w6ltIGRhZG9zIHBhcmEgZ3LDoWZpY29zIGRvIGRhc2hib2FyZFxuICAgKiBAcGFyYW0gcGVyaW9kbyBQZXLDrW9kbyBwYXJhIGZpbHRyYXIgb3MgZGFkb3MgKGVtIGRpYXMpXG4gICAqIEByZXR1cm5zIERhZG9zIHBhcmEgZ3LDoWZpY29zXG4gICAqL1xuICBhc3luYyBvYnRlckdyYWZpY29zKHBlcmlvZG86IG51bWJlciA9IDMwKTogUHJvbWlzZTxHcmFmaWNvc0Rhc2hib2FyZD4ge1xuICAgIGNvbnN0IGRhdGFJbmljaW8gPSBuZXcgRGF0ZSgpO1xuICAgIGRhdGFJbmljaW8uc2V0RGF0ZShkYXRhSW5pY2lvLmdldERhdGUoKSAtIHBlcmlvZG8pO1xuXG4gICAgLy8gU29saWNpdGHDp8O1ZXMgcG9yIHBlcsOtb2RvIChhZ3J1cGFkYXMgcG9yIGRpYSlcbiAgICBjb25zdCBzb2xpY2l0YWNvZXNQb3JQZXJpb2RvID0gYXdhaXQgdGhpcy5zb2xpY2l0YWNhb1JlcG9zaXRvcnlcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoJ3NvbGljaXRhY2FvJylcbiAgICAgIC5zZWxlY3QoXCJUT19DSEFSKHNvbGljaXRhY2FvLmRhdGFfYWJlcnR1cmEsICdZWVlZLU1NLUREJylcIiwgJ2RhdGEnKVxuICAgICAgLmFkZFNlbGVjdCgnQ09VTlQoc29saWNpdGFjYW8uaWQpJywgJ3F1YW50aWRhZGUnKVxuICAgICAgLndoZXJlKCdzb2xpY2l0YWNhby5kYXRhX2FiZXJ0dXJhID49IDpkYXRhSW5pY2lvJywgeyBkYXRhSW5pY2lvIH0pXG4gICAgICAuZ3JvdXBCeSgnZGF0YScpXG4gICAgICAub3JkZXJCeSgnZGF0YScsICdBU0MnKVxuICAgICAgLmdldFJhd01hbnkoKTtcblxuICAgIC8vIFNvbGljaXRhw6fDtWVzIHBvciBzdGF0dXNcbiAgICBjb25zdCBzb2xpY2l0YWNvZXNQb3JTdGF0dXMgPSBhd2FpdCB0aGlzLnNvbGljaXRhY2FvUmVwb3NpdG9yeVxuICAgICAgLmNyZWF0ZVF1ZXJ5QnVpbGRlcignc29saWNpdGFjYW8nKVxuICAgICAgLnNlbGVjdCgnc29saWNpdGFjYW8uc3RhdHVzJywgJ3N0YXR1cycpXG4gICAgICAuYWRkU2VsZWN0KCdDT1VOVChzb2xpY2l0YWNhby5pZCknLCAncXVhbnRpZGFkZScpXG4gICAgICAuZ3JvdXBCeSgnc29saWNpdGFjYW8uc3RhdHVzJylcbiAgICAgIC5vcmRlckJ5KCdxdWFudGlkYWRlJywgJ0RFU0MnKVxuICAgICAgLmdldFJhd01hbnkoKTtcblxuICAgIC8vIFNvbGljaXRhw6fDtWVzIHBvciB1bmlkYWRlXG4gICAgY29uc3Qgc29saWNpdGFjb2VzUG9yVW5pZGFkZSA9IGF3YWl0IHRoaXMuc29saWNpdGFjYW9SZXBvc2l0b3J5XG4gICAgICAuY3JlYXRlUXVlcnlCdWlsZGVyKCdzb2xpY2l0YWNhbycpXG4gICAgICAuc2VsZWN0KCd1bmlkYWRlLm5vbWUnLCAndW5pZGFkZScpXG4gICAgICAuYWRkU2VsZWN0KCdDT1VOVChzb2xpY2l0YWNhby5pZCknLCAncXVhbnRpZGFkZScpXG4gICAgICAubGVmdEpvaW4oJ3NvbGljaXRhY2FvLnVuaWRhZGUnLCAndW5pZGFkZScpXG4gICAgICAuZ3JvdXBCeSgndW5pZGFkZS5pZCcpXG4gICAgICAub3JkZXJCeSgncXVhbnRpZGFkZScsICdERVNDJylcbiAgICAgIC5saW1pdCgxMClcbiAgICAgIC5nZXRSYXdNYW55KCk7XG5cbiAgICAvLyBTb2xpY2l0YcOnw7VlcyBwb3IgdGlwbyBkZSBiZW5lZsOtY2lvXG4gICAgY29uc3Qgc29saWNpdGFjb2VzUG9yQmVuZWZpY2lvID0gYXdhaXQgdGhpcy5zb2xpY2l0YWNhb1JlcG9zaXRvcnlcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoJ3NvbGljaXRhY2FvJylcbiAgICAgIC5zZWxlY3QoJ3RpcG8ubm9tZScsICdiZW5lZmljaW8nKVxuICAgICAgLmFkZFNlbGVjdCgnQ09VTlQoc29saWNpdGFjYW8uaWQpJywgJ3F1YW50aWRhZGUnKVxuICAgICAgLmxlZnRKb2luKCdzb2xpY2l0YWNhby50aXBvX2JlbmVmaWNpbycsICd0aXBvJylcbiAgICAgIC5ncm91cEJ5KCd0aXBvLmlkJylcbiAgICAgIC5vcmRlckJ5KCdxdWFudGlkYWRlJywgJ0RFU0MnKVxuICAgICAgLmdldFJhd01hbnkoKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzb2xpY2l0YWNvZXNQb3JQZXJpb2RvLFxuICAgICAgc29saWNpdGFjb2VzUG9yU3RhdHVzLFxuICAgICAgc29saWNpdGFjb2VzUG9yVW5pZGFkZSxcbiAgICAgIHNvbGljaXRhY29lc1BvckJlbmVmaWNpbyxcbiAgICB9O1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=