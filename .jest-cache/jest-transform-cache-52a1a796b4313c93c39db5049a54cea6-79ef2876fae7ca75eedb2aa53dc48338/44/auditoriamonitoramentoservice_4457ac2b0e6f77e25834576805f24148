b82fd2e0385df9e353d030b166de4282
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var AuditoriaMonitoramentoService_1;
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuditoriaMonitoramentoService = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const log_auditoria_entity_1 = require("../../../entities/log-auditoria.entity");
const config_1 = require("@nestjs/config");
const tipo_operacao_enum_1 = require("../../../enums/tipo-operacao.enum");
const schedule_adapter_service_1 = require("../../../shared/schedule/schedule-adapter.service");
/**
 * Serviço para monitoramento do módulo de auditoria
 */
let AuditoriaMonitoramentoService = AuditoriaMonitoramentoService_1 = class AuditoriaMonitoramentoService {
    logAuditoriaRepository;
    dataSource;
    configService;
    scheduleAdapter;
    logger = new common_1.Logger(AuditoriaMonitoramentoService_1.name);
    estatisticas;
    metricas;
    constructor(logAuditoriaRepository, dataSource, configService, scheduleAdapter) {
        this.logAuditoriaRepository = logAuditoriaRepository;
        this.dataSource = dataSource;
        this.configService = configService;
        this.scheduleAdapter = scheduleAdapter;
        // Inicializar métricas
        this.metricas = {
            temposInsercao: [],
            temposConsulta: [],
            erros: 0,
            totalOperacoes: 0,
        };
        // Inicializar estatísticas
        this.estatisticas = {
            totalLogs: 0,
            logsPorTipoOperacao: {},
            logsPorEntidade: {},
            logsComDadosSensiveis: 0,
            logsPorPeriodo: {
                ultimas24h: 0,
                ultimos7dias: 0,
                ultimos30dias: 0,
            },
            tamanhoEstimadoBD: {
                tamanhoTotal: '0 KB',
                tamanhoIndices: '0 KB',
                tamanhoTabelas: '0 KB',
            },
            metricas: {
                tempoMedioInsercao: 0,
                tempoMedioConsulta: 0,
                taxaErros: 0,
            },
            dataAtualizacao: new Date(),
        };
        // Estatísticas serão atualizadas pelo agendamento configurado no onModuleInit
    }
    /**
     * Registra tempo de inserção
     *
     * @param tempoMs Tempo em milissegundos
     */
    registrarTempoInsercao(tempoMs) {
        this.metricas.temposInsercao.push(tempoMs);
        this.metricas.totalOperacoes++;
        // Limitar o tamanho do array para evitar consumo excessivo de memória
        if (this.metricas.temposInsercao.length > 1000) {
            this.metricas.temposInsercao.shift();
        }
    }
    /**
     * Registra tempo de consulta
     *
     * @param tempoMs Tempo em milissegundos
     */
    registrarTempoConsulta(tempoMs) {
        this.metricas.temposConsulta.push(tempoMs);
        this.metricas.totalOperacoes++;
        // Limitar o tamanho do array para evitar consumo excessivo de memória
        if (this.metricas.temposConsulta.length > 1000) {
            this.metricas.temposConsulta.shift();
        }
    }
    /**
     * Registra erro
     */
    registrarErro() {
        this.metricas.erros++;
        this.metricas.totalOperacoes++;
    }
    /**
     * Obtém estatísticas atualizadas
     *
     * @returns Estatísticas de auditoria
     */
    getEstatisticas() {
        return this.estatisticas;
    }
    /**
     * Configura o agendamento quando o módulo é inicializado
     */
    async onModuleInit() {
        try {
            // TEMPORARIAMENTE DESABILITADO: Executar uma vez inicialmente (sem await para não bloquear a inicialização)
            // this.atualizarEstatisticas().catch(error => {
            //   this.logger.error(`Erro na atualização inicial de estatísticas: ${error.message}`);
            // });
            // Configurar a atualização de estatísticas a cada 15 minutos (reduzir frequência)
            this.scheduleAdapter.scheduleInterval('atualizar_estatisticas_auditoria', 15 * 60 * 1000, // 15 minutos em milissegundos
            () => this.atualizarEstatisticas());
            this.logger.log('Agendamento de estatísticas de auditoria configurado com sucesso (execução inicial desabilitada)');
        }
        catch (error) {
            this.logger.error(`Erro ao configurar agendamento de estatísticas: ${error.message}`);
        }
    }
    /**
     * Atualiza estatísticas periodicamente
     */
    async atualizarEstatisticas() {
        try {
            this.logger.debug('Atualizando estatísticas de auditoria...');
            // Atualizar totais
            this.estatisticas.totalLogs = await this.logAuditoriaRepository.count();
            // Atualizar logs por tipo de operação
            const tiposOperacao = Object.values(tipo_operacao_enum_1.TipoOperacao);
            for (const tipo of tiposOperacao) {
                const count = await this.logAuditoriaRepository.count({
                    where: { tipo_operacao: tipo },
                });
                this.estatisticas.logsPorTipoOperacao[tipo] = count;
            }
            // Atualizar logs por entidade (top 10)
            const entidadesResult = await this.dataSource.query(`
          SELECT entidade_afetada, COUNT(*) as total
          FROM logs_auditoria
          GROUP BY entidade_afetada
          ORDER BY total DESC
          LIMIT 10
        `);
            this.estatisticas.logsPorEntidade = {};
            for (const row of entidadesResult) {
                if (row.entidade_afetada) {
                    this.estatisticas.logsPorEntidade[row.entidade_afetada] =
                        parseInt(row.total, 10) || 0;
                }
            }
            // Atualizar logs com dados sensíveis
            try {
                this.estatisticas.logsComDadosSensiveis =
                    await this.logAuditoriaRepository.count({
                        where: {
                            dados_sensiveis_acessados: (0, typeorm_2.Not)((0, typeorm_2.IsNull)()),
                        },
                    });
            }
            catch (error) {
                this.logger.warn(`Erro ao contar logs com dados sensíveis: ${error.message}`);
                this.estatisticas.logsComDadosSensiveis = 0;
            }
            // Atualizar logs por período
            const agora = new Date();
            try {
                // Últimas 24 horas
                const ultimas24h = new Date(agora);
                ultimas24h.setHours(agora.getHours() - 24);
                this.estatisticas.logsPorPeriodo.ultimas24h =
                    await this.logAuditoriaRepository.count({
                        where: {
                            created_at: (0, typeorm_2.MoreThanOrEqual)(ultimas24h),
                        },
                    });
                // Últimos 7 dias
                const ultimos7dias = new Date(agora);
                ultimos7dias.setDate(agora.getDate() - 7);
                this.estatisticas.logsPorPeriodo.ultimos7dias =
                    await this.logAuditoriaRepository.count({
                        where: {
                            created_at: (0, typeorm_2.MoreThanOrEqual)(ultimos7dias),
                        },
                    });
                // Últimos 30 dias
                const ultimos30dias = new Date(agora);
                ultimos30dias.setDate(agora.getDate() - 30);
                this.estatisticas.logsPorPeriodo.ultimos30dias =
                    await this.logAuditoriaRepository.count({
                        where: {
                            created_at: (0, typeorm_2.MoreThanOrEqual)(ultimos30dias),
                        },
                    });
            }
            catch (error) {
                this.logger.warn(`Erro ao contar logs por período: ${error.message}`);
                this.estatisticas.logsPorPeriodo = {
                    ultimas24h: 0,
                    ultimos7dias: 0,
                    ultimos30dias: 0,
                };
            }
            // Atualizar tamanho estimado do banco de dados
            const tamanhoResult = await this.dataSource.query(`
        SELECT
          pg_size_pretty(pg_total_relation_size('logs_auditoria')) as tamanho_total,
          pg_size_pretty(pg_indexes_size('logs_auditoria')) as tamanho_indices,
          pg_size_pretty(pg_relation_size('logs_auditoria')) as tamanho_tabela
      `);
            if (tamanhoResult.length > 0) {
                this.estatisticas.tamanhoEstimadoBD = {
                    tamanhoTotal: tamanhoResult[0].tamanho_total,
                    tamanhoIndices: tamanhoResult[0].tamanho_indices,
                    tamanhoTabelas: tamanhoResult[0].tamanho_tabela,
                };
            }
            // Atualizar métricas
            const tempoMedioInsercao = this.metricas.temposInsercao.length > 0
                ? this.metricas.temposInsercao.reduce((a, b) => a + b, 0) /
                    this.metricas.temposInsercao.length
                : 0;
            const tempoMedioConsulta = this.metricas.temposConsulta.length > 0
                ? this.metricas.temposConsulta.reduce((a, b) => a + b, 0) /
                    this.metricas.temposConsulta.length
                : 0;
            const taxaErros = this.metricas.totalOperacoes > 0
                ? (this.metricas.erros / this.metricas.totalOperacoes) * 100
                : 0;
            this.estatisticas.metricas = {
                tempoMedioInsercao,
                tempoMedioConsulta,
                taxaErros,
            };
            // Atualizar data de atualização
            this.estatisticas.dataAtualizacao = new Date();
            this.logger.log('Estatísticas de auditoria atualizadas com sucesso');
            // Verificar alertas
            this.verificarAlertas();
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Erro desconhecido';
            const errorStack = error instanceof Error ? error.stack : undefined;
            this.logger.error(`Erro ao atualizar estatísticas: ${errorMessage}`, errorStack);
        }
    }
    /**
     * Verifica condições para alertas
     */
    verificarAlertas() {
        try {
            // Verificar taxa de erros
            const limiteErros = this.configService.get('AUDITORIA_LIMITE_TAXA_ERROS', 5);
            if (this.estatisticas.metricas.taxaErros > limiteErros) {
                this.logger.warn(`ALERTA: Taxa de erros acima do limite (${this.estatisticas.metricas.taxaErros.toFixed(2)}%)`);
            }
            // Verificar tempo médio de inserção
            const limiteTempoInsercao = this.configService.get('AUDITORIA_LIMITE_TEMPO_INSERCAO', 500);
            if (this.estatisticas.metricas.tempoMedioInsercao > limiteTempoInsercao) {
                this.logger.warn(`ALERTA: Tempo médio de inserção acima do limite (${this.estatisticas.metricas.tempoMedioInsercao.toFixed(2)}ms)`);
            }
            // Verificar tempo médio de consulta
            const limiteTempoConsulta = this.configService.get('AUDITORIA_LIMITE_TEMPO_CONSULTA', 1000);
            if (this.estatisticas.metricas.tempoMedioConsulta > limiteTempoConsulta) {
                this.logger.warn(`ALERTA: Tempo médio de consulta acima do limite (${this.estatisticas.metricas.tempoMedioConsulta.toFixed(2)}ms)`);
            }
            // Verificar crescimento rápido
            const crescimentoDiario = this.estatisticas.logsPorPeriodo.ultimas24h;
            const limiteCrescimentoDiario = this.configService.get('AUDITORIA_LIMITE_CRESCIMENTO_DIARIO', 10000);
            if (crescimentoDiario > limiteCrescimentoDiario) {
                this.logger.warn(`ALERTA: Crescimento diário acima do limite (${crescimentoDiario} logs nas últimas 24h)`);
            }
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Erro desconhecido';
            const errorStack = error instanceof Error ? error.stack : undefined;
            this.logger.error(`Erro ao verificar alertas: ${errorMessage}`, errorStack);
        }
    }
    /**
     * Gera relatório de saúde do módulo de auditoria
     *
     * @returns Relatório de saúde
     */
    async gerarRelatorioSaude() {
        try {
            // Atualizar estatísticas para garantir dados recentes
            await this.atualizarEstatisticas();
            // Verificar partições
            const particoesResult = await this.dataSource.query(`
        SELECT
          child.relname AS nome_particao,
          pg_size_pretty(pg_relation_size(child.oid)) AS tamanho,
          pg_stat_get_numscans(child.oid) AS num_scans
        FROM pg_inherits
        JOIN pg_class parent ON pg_inherits.inhparent = parent.oid
        JOIN pg_class child ON pg_inherits.inhrelid = child.oid
        JOIN pg_namespace nmsp_child ON nmsp_child.oid = child.relnamespace
        JOIN pg_namespace nmsp_parent ON nmsp_parent.oid = parent.relnamespace
        WHERE parent.relname = 'logs_auditoria'
        ORDER BY child.relname
      `);
            // Verificar índices
            const indicesResult = await this.dataSource.query(`
        SELECT
          indexname AS nome_indice,
          indexdef AS definicao,
          idx_scan AS num_scans,
          idx_tup_read AS tuplas_lidas,
          idx_tup_fetch AS tuplas_buscadas
        FROM pg_stat_user_indexes
        JOIN pg_indexes ON pg_stat_user_indexes.indexrelname = pg_indexes.indexname
        WHERE tablename = 'logs_auditoria'
        ORDER BY idx_scan DESC
      `);
            // Verificar operações lentas
            const operacoesLentasResult = await this.dataSource.query(`
        SELECT
          query,
          calls,
          total_time / calls AS avg_time,
          rows
        FROM pg_stat_statements
        WHERE query ILIKE '%logs_auditoria%'
        ORDER BY avg_time DESC
        LIMIT 5
      `);
            // Calcular saúde geral (0-100%)
            let saudeGeral = 100;
            // Penalizar por alta taxa de erros
            if (this.estatisticas.metricas.taxaErros > 0) {
                saudeGeral -= Math.min(50, this.estatisticas.metricas.taxaErros * 5);
            }
            // Penalizar por tempos de resposta altos
            const tempoInsercaoIdeal = 100; // ms
            const tempoConsultaIdeal = 200; // ms
            if (this.estatisticas.metricas.tempoMedioInsercao > tempoInsercaoIdeal) {
                const penalidade = Math.min(25, ((this.estatisticas.metricas.tempoMedioInsercao -
                    tempoInsercaoIdeal) /
                    tempoInsercaoIdeal) *
                    10);
                saudeGeral -= penalidade;
            }
            if (this.estatisticas.metricas.tempoMedioConsulta > tempoConsultaIdeal) {
                const penalidade = Math.min(25, ((this.estatisticas.metricas.tempoMedioConsulta -
                    tempoConsultaIdeal) /
                    tempoConsultaIdeal) *
                    10);
                saudeGeral -= penalidade;
            }
            // Garantir que a saúde não seja negativa
            saudeGeral = Math.max(0, saudeGeral);
            // Determinar status com base na saúde
            let status = 'Ótimo';
            if (saudeGeral < 60) {
                status = 'Crítico';
            }
            else if (saudeGeral < 80) {
                status = 'Alerta';
            }
            else if (saudeGeral < 90) {
                status = 'Bom';
            }
            // Gerar recomendações
            const recomendacoes = [];
            if (this.estatisticas.metricas.taxaErros > 5) {
                recomendacoes.push('Investigar e corrigir erros frequentes no módulo de auditoria');
            }
            if (this.estatisticas.metricas.tempoMedioInsercao > 500) {
                recomendacoes.push('Otimizar processo de inserção de logs');
            }
            if (this.estatisticas.metricas.tempoMedioConsulta > 1000) {
                recomendacoes.push('Revisar índices e otimizar consultas');
            }
            // Verificar índices não utilizados
            const indicesNaoUtilizados = indicesResult.filter((indice) => indice.num_scans === '0');
            if (indicesNaoUtilizados.length > 0) {
                recomendacoes.push(`Considerar remover índices não utilizados: ${indicesNaoUtilizados.map((i) => i.nome_indice).join(', ')}`);
            }
            return {
                saudeGeral: {
                    pontuacao: Math.round(saudeGeral),
                    status,
                    dataAvaliacao: new Date(),
                },
                estatisticas: this.estatisticas,
                detalhes: {
                    particoes: particoesResult,
                    indices: indicesResult,
                    operacoesLentas: operacoesLentasResult,
                },
                recomendacoes,
            };
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Erro desconhecido';
            const errorStack = error instanceof Error ? error.stack : undefined;
            this.logger.error(`Erro ao gerar relatório de saúde: ${errorMessage}`, errorStack);
            throw error;
        }
    }
};
exports.AuditoriaMonitoramentoService = AuditoriaMonitoramentoService;
exports.AuditoriaMonitoramentoService = AuditoriaMonitoramentoService = AuditoriaMonitoramentoService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(log_auditoria_entity_1.LogAuditoria)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _b : Object, typeof (_c = typeof config_1.ConfigService !== "undefined" && config_1.ConfigService) === "function" ? _c : Object, typeof (_d = typeof schedule_adapter_service_1.ScheduleAdapterService !== "undefined" && schedule_adapter_service_1.ScheduleAdapterService) === "function" ? _d : Object])
], AuditoriaMonitoramentoService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGF1ZGl0b3JpYVxcc2VydmljZXNcXGF1ZGl0b3JpYS1tb25pdG9yYW1lbnRvLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBa0U7QUFDbEUsNkNBQW1EO0FBQ25ELHFDQU9pQjtBQUNqQixpRkFBc0U7QUFDdEUsMkNBQStDO0FBQy9DLDBFQUFpRTtBQUNqRSxnR0FBMkY7QUEyRDNGOztHQUVHO0FBRUksSUFBTSw2QkFBNkIscUNBQW5DLE1BQU0sNkJBQTZCO0lBWXJCO0lBQ0E7SUFDQTtJQUNBO0lBZEYsTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLCtCQUE2QixDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2pFLFlBQVksQ0FBd0I7SUFDcEMsUUFBUSxDQUtkO0lBRUYsWUFFbUIsc0JBQWdELEVBQ2hELFVBQXNCLEVBQ3RCLGFBQTRCLEVBQzVCLGVBQXVDO1FBSHZDLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBMEI7UUFDaEQsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QixvQkFBZSxHQUFmLGVBQWUsQ0FBd0I7UUFFeEQsdUJBQXVCO1FBQ3ZCLElBQUksQ0FBQyxRQUFRLEdBQUc7WUFDZCxjQUFjLEVBQUUsRUFBRTtZQUNsQixjQUFjLEVBQUUsRUFBRTtZQUNsQixLQUFLLEVBQUUsQ0FBQztZQUNSLGNBQWMsRUFBRSxDQUFDO1NBQ2xCLENBQUM7UUFFRiwyQkFBMkI7UUFDM0IsSUFBSSxDQUFDLFlBQVksR0FBRztZQUNsQixTQUFTLEVBQUUsQ0FBQztZQUNaLG1CQUFtQixFQUFFLEVBQUU7WUFDdkIsZUFBZSxFQUFFLEVBQUU7WUFDbkIscUJBQXFCLEVBQUUsQ0FBQztZQUN4QixjQUFjLEVBQUU7Z0JBQ2QsVUFBVSxFQUFFLENBQUM7Z0JBQ2IsWUFBWSxF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QztJQUNILENBQUM7Q0FDRixDQUFBO0FBdmZZLHNFQUE2Qjt3Q0FBN0IsNkJBQTZCO0lBRHpDLElBQUEsbUJBQVUsR0FBRTtJQVlSLFdBQUEsSUFBQSwwQkFBZ0IsRUFBQyxtQ0FBWSxDQUFDLENBQUE7eURBQ1Usb0JBQVUsb0JBQVYsb0JBQVUsb0RBQ3RCLG9CQUFVLG9CQUFWLG9CQUFVLG9EQUNQLHNCQUFhLG9CQUFiLHNCQUFhLG9EQUNYLGlEQUFzQixvQkFBdEIsaURBQXNCO0dBZi9DLDZCQUE2QixDQXVmekMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGF1ZGl0b3JpYVxcc2VydmljZXNcXGF1ZGl0b3JpYS1tb25pdG9yYW1lbnRvLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTG9nZ2VyLCBPbk1vZHVsZUluaXQgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBJbmplY3RSZXBvc2l0b3J5IH0gZnJvbSAnQG5lc3Rqcy90eXBlb3JtJztcbmltcG9ydCB7XG4gIFJlcG9zaXRvcnksXG4gIERhdGFTb3VyY2UsXG4gIFJhdyxcbiAgTm90LFxuICBJc051bGwsXG4gIE1vcmVUaGFuT3JFcXVhbCxcbn0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQgeyBMb2dBdWRpdG9yaWEgfSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy9sb2ctYXVkaXRvcmlhLmVudGl0eSc7XG5pbXBvcnQgeyBDb25maWdTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9jb25maWcnO1xuaW1wb3J0IHsgVGlwb09wZXJhY2FvIH0gZnJvbSAnLi4vLi4vLi4vZW51bXMvdGlwby1vcGVyYWNhby5lbnVtJztcbmltcG9ydCB7IFNjaGVkdWxlQWRhcHRlclNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvc2NoZWR1bGUvc2NoZWR1bGUtYWRhcHRlci5zZXJ2aWNlJztcblxuLyoqXG4gKiBJbnRlcmZhY2UgcGFyYSBlc3RhdMOtc3RpY2FzIGRlIGF1ZGl0b3JpYVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEVzdGF0aXN0aWNhc0F1ZGl0b3JpYSB7XG4gIC8qKlxuICAgKiBUb3RhbCBkZSBsb2dzXG4gICAqL1xuICB0b3RhbExvZ3M6IG51bWJlcjtcblxuICAvKipcbiAgICogVG90YWwgZGUgbG9ncyBwb3IgdGlwbyBkZSBvcGVyYcOnw6NvXG4gICAqL1xuICBsb2dzUG9yVGlwb09wZXJhY2FvOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+O1xuXG4gIC8qKlxuICAgKiBUb3RhbCBkZSBsb2dzIHBvciBlbnRpZGFkZVxuICAgKi9cbiAgbG9nc1BvckVudGlkYWRlOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+O1xuXG4gIC8qKlxuICAgKiBUb3RhbCBkZSBsb2dzIGNvbSBkYWRvcyBzZW5zw612ZWlzXG4gICAqL1xuICBsb2dzQ29tRGFkb3NTZW5zaXZlaXM6IG51bWJlcjtcblxuICAvKipcbiAgICogVG90YWwgZGUgbG9ncyBwb3IgcGVyw61vZG8gKMO6bHRpbWFzIDI0aCwgNyBkaWFzLCAzMCBkaWFzKVxuICAgKi9cbiAgbG9nc1BvclBlcmlvZG86IHtcbiAgICB1bHRpbWFzMjRoOiBudW1iZXI7XG4gICAgdWx0aW1vczdkaWFzOiBudW1iZXI7XG4gICAgdWx0aW1vczMwZGlhczogbnVtYmVyO1xuICB9O1xuXG4gIC8qKlxuICAgKiBUYW1hbmhvIGVzdGltYWRvIGRvIGJhbmNvIGRlIGRhZG9zIGRlIGF1ZGl0b3JpYVxuICAgKi9cbiAgdGFtYW5ob0VzdGltYWRvQkQ6IHtcbiAgICB0YW1hbmhvVG90YWw6IHN0cmluZztcbiAgICB0YW1hbmhvSW5kaWNlczogc3RyaW5nO1xuICAgIHRhbWFuaG9UYWJlbGFzOiBzdHJpbmc7XG4gIH07XG5cbiAgLyoqXG4gICAqIE3DqXRyaWNhcyBkZSBwZXJmb3JtYW5jZVxuICAgKi9cbiAgbWV0cmljYXM6IHtcbiAgICB0ZW1wb01lZGlvSW5zZXJjYW86IG51bWJlcjtcbiAgICB0ZW1wb01lZGlvQ29uc3VsdGE6IG51bWJlcjtcbiAgICB0YXhhRXJyb3M6IG51bWJlcjtcbiAgfTtcblxuICAvKipcbiAgICogRGF0YSBkYSDDumx0aW1hIGF0dWFsaXphw6fDo29cbiAgICovXG4gIGRhdGFBdHVhbGl6YWNhbzogRGF0ZTtcbn1cblxuLyoqXG4gKiBTZXJ2acOnbyBwYXJhIG1vbml0b3JhbWVudG8gZG8gbcOzZHVsbyBkZSBhdWRpdG9yaWFcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEF1ZGl0b3JpYU1vbml0b3JhbWVudG9TZXJ2aWNlIGltcGxlbWVudHMgT25Nb2R1bGVJbml0IHtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKEF1ZGl0b3JpYU1vbml0b3JhbWVudG9TZXJ2aWNlLm5hbWUpO1xuICBwcml2YXRlIGVzdGF0aXN0aWNhczogRXN0YXRpc3RpY2FzQXVkaXRvcmlhO1xuICBwcml2YXRlIG1ldHJpY2FzOiB7XG4gICAgdGVtcG9zSW5zZXJjYW86IG51bWJlcltdO1xuICAgIHRlbXBvc0NvbnN1bHRhOiBudW1iZXJbXTtcbiAgICBlcnJvczogbnVtYmVyO1xuICAgIHRvdGFsT3BlcmFjb2VzOiBudW1iZXI7XG4gIH07XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdFJlcG9zaXRvcnkoTG9nQXVkaXRvcmlhKVxuICAgIHByaXZhdGUgcmVhZG9ubHkgbG9nQXVkaXRvcmlhUmVwb3NpdG9yeTogUmVwb3NpdG9yeTxMb2dBdWRpdG9yaWE+LFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGF0YVNvdXJjZTogRGF0YVNvdXJjZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNvbmZpZ1NlcnZpY2U6IENvbmZpZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBzY2hlZHVsZUFkYXB0ZXI6IFNjaGVkdWxlQWRhcHRlclNlcnZpY2UsXG4gICkge1xuICAgIC8vIEluaWNpYWxpemFyIG3DqXRyaWNhc1xuICAgIHRoaXMubWV0cmljYXMgPSB7XG4gICAgICB0ZW1wb3NJbnNlcmNhbzogW10sXG4gICAgICB0ZW1wb3NDb25zdWx0YTogW10sXG4gICAgICBlcnJvczogMCxcbiAgICAgIHRvdGFsT3BlcmFjb2VzOiAwLFxuICAgIH07XG5cbiAgICAvLyBJbmljaWFsaXphciBlc3RhdMOtc3RpY2FzXG4gICAgdGhpcy5lc3RhdGlzdGljYXMgPSB7XG4gICAgICB0b3RhbExvZ3M6IDAsXG4gICAgICBsb2dzUG9yVGlwb09wZXJhY2FvOiB7fSxcbiAgICAgIGxvZ3NQb3JFbnRpZGFkZToge30sXG4gICAgICBsb2dzQ29tRGFkb3NTZW5zaXZlaXM6IDAsXG4gICAgICBsb2dzUG9yUGVyaW9kbzoge1xuICAgICAgICB1bHRpbWFzMjRoOiAwLFxuICAgICAgICB1bHRpbW9zN2RpYXM6IDAsXG4gICAgICAgIHVsdGltb3MzMGRpYXM6IDAsXG4gICAgICB9LFxuICAgICAgdGFtYW5ob0VzdGltYWRvQkQ6IHtcbiAgICAgICAgdGFtYW5ob1RvdGFsOiAnMCBLQicsXG4gICAgICAgIHRhbWFuaG9JbmRpY2VzOiAnMCBLQicsXG4gICAgICAgIHRhbWFuaG9UYWJlbGFzOiAnMCBLQicsXG4gICAgICB9LFxuICAgICAgbWV0cmljYXM6IHtcbiAgICAgICAgdGVtcG9NZWRpb0luc2VyY2FvOiAwLFxuICAgICAgICB0ZW1wb01lZGlvQ29uc3VsdGE6IDAsXG4gICAgICAgIHRheGFFcnJvczogMCxcbiAgICAgIH0sXG4gICAgICBkYXRhQXR1YWxpemFjYW86IG5ldyBEYXRlKCksXG4gICAgfTtcblxuICAgIC8vIEVzdGF0w61zdGljYXMgc2Vyw6NvIGF0dWFsaXphZGFzIHBlbG8gYWdlbmRhbWVudG8gY29uZmlndXJhZG8gbm8gb25Nb2R1bGVJbml0XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0cmEgdGVtcG8gZGUgaW5zZXLDp8Ojb1xuICAgKlxuICAgKiBAcGFyYW0gdGVtcG9NcyBUZW1wbyBlbSBtaWxpc3NlZ3VuZG9zXG4gICAqL1xuICByZWdpc3RyYXJUZW1wb0luc2VyY2FvKHRlbXBvTXM6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMubWV0cmljYXMudGVtcG9zSW5zZXJjYW8ucHVzaCh0ZW1wb01zKTtcbiAgICB0aGlzLm1ldHJpY2FzLnRvdGFsT3BlcmFjb2VzKys7XG5cbiAgICAvLyBMaW1pdGFyIG8gdGFtYW5obyBkbyBhcnJheSBwYXJhIGV2aXRhciBjb25zdW1vIGV4Y2Vzc2l2byBkZSBtZW3Ds3JpYVxuICAgIGlmICh0aGlzLm1ldHJpY2FzLnRlbXBvc0luc2VyY2FvLmxlbmd0aCA+IDEwMDApIHtcbiAgICAgIHRoaXMubWV0cmljYXMudGVtcG9zSW5zZXJjYW8uc2hpZnQoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0cmEgdGVtcG8gZGUgY29uc3VsdGFcbiAgICpcbiAgICogQHBhcmFtIHRlbXBvTXMgVGVtcG8gZW0gbWlsaXNzZWd1bmRvc1xuICAgKi9cbiAgcmVnaXN0cmFyVGVtcG9Db25zdWx0YSh0ZW1wb01zOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLm1ldHJpY2FzLnRlbXBvc0NvbnN1bHRhLnB1c2godGVtcG9Ncyk7XG4gICAgdGhpcy5tZXRyaWNhcy50b3RhbE9wZXJhY29lcysrO1xuXG4gICAgLy8gTGltaXRhciBvIHRhbWFuaG8gZG8gYXJyYXkgcGFyYSBldml0YXIgY29uc3VtbyBleGNlc3Npdm8gZGUgbWVtw7NyaWFcbiAgICBpZiAodGhpcy5tZXRyaWNhcy50ZW1wb3NDb25zdWx0YS5sZW5ndGggPiAxMDAwKSB7XG4gICAgICB0aGlzLm1ldHJpY2FzLnRlbXBvc0NvbnN1bHRhLnNoaWZ0KCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdHJhIGVycm9cbiAgICovXG4gIHJlZ2lzdHJhckVycm8oKTogdm9pZCB7XG4gICAgdGhpcy5tZXRyaWNhcy5lcnJvcysrO1xuICAgIHRoaXMubWV0cmljYXMudG90YWxPcGVyYWNvZXMrKztcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gZXN0YXTDrXN0aWNhcyBhdHVhbGl6YWRhc1xuICAgKlxuICAgKiBAcmV0dXJucyBFc3RhdMOtc3RpY2FzIGRlIGF1ZGl0b3JpYVxuICAgKi9cbiAgZ2V0RXN0YXRpc3RpY2FzKCk6IEVzdGF0aXN0aWNhc0F1ZGl0b3JpYSB7XG4gICAgcmV0dXJuIHRoaXMuZXN0YXRpc3RpY2FzO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbmZpZ3VyYSBvIGFnZW5kYW1lbnRvIHF1YW5kbyBvIG3Ds2R1bG8gw6kgaW5pY2lhbGl6YWRvXG4gICAqL1xuICBhc3luYyBvbk1vZHVsZUluaXQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFRFTVBPUkFSSUFNRU5URSBERVNBQklMSVRBRE86IEV4ZWN1dGFyIHVtYSB2ZXogaW5pY2lhbG1lbnRlIChzZW0gYXdhaXQgcGFyYSBuw6NvIGJsb3F1ZWFyIGEgaW5pY2lhbGl6YcOnw6NvKVxuICAgICAgLy8gdGhpcy5hdHVhbGl6YXJFc3RhdGlzdGljYXMoKS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAvLyAgIHRoaXMubG9nZ2VyLmVycm9yKGBFcnJvIG5hIGF0dWFsaXphw6fDo28gaW5pY2lhbCBkZSBlc3RhdMOtc3RpY2FzOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAvLyB9KTtcblxuICAgICAgLy8gQ29uZmlndXJhciBhIGF0dWFsaXphw6fDo28gZGUgZXN0YXTDrXN0aWNhcyBhIGNhZGEgMTUgbWludXRvcyAocmVkdXppciBmcmVxdcOqbmNpYSlcbiAgICAgIHRoaXMuc2NoZWR1bGVBZGFwdGVyLnNjaGVkdWxlSW50ZXJ2YWwoXG4gICAgICAgICdhdHVhbGl6YXJfZXN0YXRpc3RpY2FzX2F1ZGl0b3JpYScsXG4gICAgICAgIDE1ICogNjAgKiAxMDAwLCAvLyAxNSBtaW51dG9zIGVtIG1pbGlzc2VndW5kb3NcbiAgICAgICAgKCkgPT4gdGhpcy5hdHVhbGl6YXJFc3RhdGlzdGljYXMoKSxcbiAgICAgICk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgICAgJ0FnZW5kYW1lbnRvIGRlIGVzdGF0w61zdGljYXMgZGUgYXVkaXRvcmlhIGNvbmZpZ3VyYWRvIGNvbSBzdWNlc3NvIChleGVjdcOnw6NvIGluaWNpYWwgZGVzYWJpbGl0YWRhKScsXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gY29uZmlndXJhciBhZ2VuZGFtZW50byBkZSBlc3RhdMOtc3RpY2FzOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEF0dWFsaXphIGVzdGF0w61zdGljYXMgcGVyaW9kaWNhbWVudGVcbiAgICovXG4gIGFzeW5jIGF0dWFsaXphckVzdGF0aXN0aWNhcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoJ0F0dWFsaXphbmRvIGVzdGF0w61zdGljYXMgZGUgYXVkaXRvcmlhLi4uJyk7XG5cbiAgICAgIC8vIEF0dWFsaXphciB0b3RhaXNcbiAgICAgIHRoaXMuZXN0YXRpc3RpY2FzLnRvdGFsTG9ncyA9IGF3YWl0IHRoaXMubG9nQXVkaXRvcmlhUmVwb3NpdG9yeS5jb3VudCgpO1xuXG4gICAgICAvLyBBdHVhbGl6YXIgbG9ncyBwb3IgdGlwbyBkZSBvcGVyYcOnw6NvXG4gICAgICBjb25zdCB0aXBvc09wZXJhY2FvID0gT2JqZWN0LnZhbHVlcyhUaXBvT3BlcmFjYW8pO1xuICAgICAgZm9yIChjb25zdCB0aXBvIG9mIHRpcG9zT3BlcmFjYW8pIHtcbiAgICAgICAgY29uc3QgY291bnQgPSBhd2FpdCB0aGlzLmxvZ0F1ZGl0b3JpYVJlcG9zaXRvcnkuY291bnQoe1xuICAgICAgICAgIHdoZXJlOiB7IHRpcG9fb3BlcmFjYW86IHRpcG8gYXMgVGlwb09wZXJhY2FvIH0sXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmVzdGF0aXN0aWNhcy5sb2dzUG9yVGlwb09wZXJhY2FvW3RpcG9dID0gY291bnQ7XG4gICAgICB9XG5cbiAgICAgIC8vIEF0dWFsaXphciBsb2dzIHBvciBlbnRpZGFkZSAodG9wIDEwKVxuICAgICAgY29uc3QgZW50aWRhZGVzUmVzdWx0OiBBcnJheTx7XG4gICAgICAgIGVudGlkYWRlX2FmZXRhZGE6IHN0cmluZztcbiAgICAgICAgdG90YWw6IHN0cmluZztcbiAgICAgIH0+ID0gYXdhaXQgdGhpcy5kYXRhU291cmNlLnF1ZXJ5KGBcbiAgICAgICAgICBTRUxFQ1QgZW50aWRhZGVfYWZldGFkYSwgQ09VTlQoKikgYXMgdG90YWxcbiAgICAgICAgICBGUk9NIGxvZ3NfYXVkaXRvcmlhXG4gICAgICAgICAgR1JPVVAgQlkgZW50aWRhZGVfYWZldGFkYVxuICAgICAgICAgIE9SREVSIEJZIHRvdGFsIERFU0NcbiAgICAgICAgICBMSU1JVCAxMFxuICAgICAgICBgKTtcblxuICAgICAgdGhpcy5lc3RhdGlzdGljYXMubG9nc1BvckVudGlkYWRlID0ge307XG4gICAgICBmb3IgKGNvbnN0IHJvdyBvZiBlbnRpZGFkZXNSZXN1bHQpIHtcbiAgICAgICAgaWYgKHJvdy5lbnRpZGFkZV9hZmV0YWRhKSB7XG4gICAgICAgICAgdGhpcy5lc3RhdGlzdGljYXMubG9nc1BvckVudGlkYWRlW3Jvdy5lbnRpZGFkZV9hZmV0YWRhXSA9XG4gICAgICAgICAgICBwYXJzZUludChyb3cudG90YWwsIDEwKSB8fCAwO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEF0dWFsaXphciBsb2dzIGNvbSBkYWRvcyBzZW5zw612ZWlzXG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLmVzdGF0aXN0aWNhcy5sb2dzQ29tRGFkb3NTZW5zaXZlaXMgPVxuICAgICAgICAgIGF3YWl0IHRoaXMubG9nQXVkaXRvcmlhUmVwb3NpdG9yeS5jb3VudCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICBkYWRvc19zZW5zaXZlaXNfYWNlc3NhZG9zOiBOb3QoSXNOdWxsKCkpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgICAgYEVycm8gYW8gY29udGFyIGxvZ3MgY29tIGRhZG9zIHNlbnPDrXZlaXM6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICApO1xuICAgICAgICB0aGlzLmVzdGF0aXN0aWNhcy5sb2dzQ29tRGFkb3NTZW5zaXZlaXMgPSAwO1xuICAgICAgfVxuXG4gICAgICAvLyBBdHVhbGl6YXIgbG9ncyBwb3IgcGVyw61vZG9cbiAgICAgIGNvbnN0IGFnb3JhID0gbmV3IERhdGUoKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gw5psdGltYXMgMjQgaG9yYXNcbiAgICAgICAgY29uc3QgdWx0aW1hczI0aCA9IG5ldyBEYXRlKGFnb3JhKTtcbiAgICAgICAgdWx0aW1hczI0aC5zZXRIb3VycyhhZ29yYS5nZXRIb3VycygpIC0gMjQpO1xuXG4gICAgICAgIHRoaXMuZXN0YXRpc3RpY2FzLmxvZ3NQb3JQZXJpb2RvLnVsdGltYXMyNGggPVxuICAgICAgICAgIGF3YWl0IHRoaXMubG9nQXVkaXRvcmlhUmVwb3NpdG9yeS5jb3VudCh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICBjcmVhdGVkX2F0OiBNb3JlVGhhbk9yRXF1YWwodWx0aW1hczI0aCksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIMOabHRpbW9zIDcgZGlhc1xuICAgICAgICBjb25zdCB1bHRpbW9zN2RpYXMgPSBuZXcgRGF0ZShhZ29yYSk7XG4gICAgICAgIHVsdGltb3M3ZGlhcy5zZXREYXRlKGFnb3JhLmdldERhdGUoKSAtIDcpO1xuXG4gICAgICAgIHRoaXMuZXN0YXRpc3RpY2FzLmxvZ3NQb3JQZXJpb2RvLnVsdGltb3M3ZGlhcyA9XG4gICAgICAgICAgYXdhaXQgdGhpcy5sb2dBdWRpdG9yaWFSZXBvc2l0b3J5LmNvdW50KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgIGNyZWF0ZWRfYXQ6IE1vcmVUaGFuT3JFcXVhbCh1bHRpbW9zN2RpYXMpLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAvLyDDmmx0aW1vcyAzMCBkaWFzXG4gICAgICAgIGNvbnN0IHVsdGltb3MzMGRpYXMgPSBuZXcgRGF0ZShhZ29yYSk7XG4gICAgICAgIHVsdGltb3MzMGRpYXMuc2V0RGF0ZShhZ29yYS5nZXREYXRlKCkgLSAzMCk7XG5cbiAgICAgICAgdGhpcy5lc3RhdGlzdGljYXMubG9nc1BvclBlcmlvZG8udWx0aW1vczMwZGlhcyA9XG4gICAgICAgICAgYXdhaXQgdGhpcy5sb2dBdWRpdG9yaWFSZXBvc2l0b3J5LmNvdW50KHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgIGNyZWF0ZWRfYXQ6IE1vcmVUaGFuT3JFcXVhbCh1bHRpbW9zMzBkaWFzKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKGBFcnJvIGFvIGNvbnRhciBsb2dzIHBvciBwZXLDrW9kbzogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB0aGlzLmVzdGF0aXN0aWNhcy5sb2dzUG9yUGVyaW9kbyA9IHtcbiAgICAgICAgICB1bHRpbWFzMjRoOiAwLFxuICAgICAgICAgIHVsdGltb3M3ZGlhczogMCxcbiAgICAgICAgICB1bHRpbW9zMzBkaWFzOiAwLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBBdHVhbGl6YXIgdGFtYW5obyBlc3RpbWFkbyBkbyBiYW5jbyBkZSBkYWRvc1xuICAgICAgY29uc3QgdGFtYW5ob1Jlc3VsdCA9IGF3YWl0IHRoaXMuZGF0YVNvdXJjZS5xdWVyeShgXG4gICAgICAgIFNFTEVDVFxuICAgICAgICAgIHBnX3NpemVfcHJldHR5KHBnX3RvdGFsX3JlbGF0aW9uX3NpemUoJ2xvZ3NfYXVkaXRvcmlhJykpIGFzIHRhbWFuaG9fdG90YWwsXG4gICAgICAgICAgcGdfc2l6ZV9wcmV0dHkocGdfaW5kZXhlc19zaXplKCdsb2dzX2F1ZGl0b3JpYScpKSBhcyB0YW1hbmhvX2luZGljZXMsXG4gICAgICAgICAgcGdfc2l6ZV9wcmV0dHkocGdfcmVsYXRpb25fc2l6ZSgnbG9nc19hdWRpdG9yaWEnKSkgYXMgdGFtYW5ob190YWJlbGFcbiAgICAgIGApO1xuXG4gICAgICBpZiAodGFtYW5ob1Jlc3VsdC5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRoaXMuZXN0YXRpc3RpY2FzLnRhbWFuaG9Fc3RpbWFkb0JEID0ge1xuICAgICAgICAgIHRhbWFuaG9Ub3RhbDogdGFtYW5ob1Jlc3VsdFswXS50YW1hbmhvX3RvdGFsLFxuICAgICAgICAgIHRhbWFuaG9JbmRpY2VzOiB0YW1hbmhvUmVzdWx0WzBdLnRhbWFuaG9faW5kaWNlcyxcbiAgICAgICAgICB0YW1hbmhvVGFiZWxhczogdGFtYW5ob1Jlc3VsdFswXS50YW1hbmhvX3RhYmVsYSxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQXR1YWxpemFyIG3DqXRyaWNhc1xuICAgICAgY29uc3QgdGVtcG9NZWRpb0luc2VyY2FvID1cbiAgICAgICAgdGhpcy5tZXRyaWNhcy50ZW1wb3NJbnNlcmNhby5sZW5ndGggPiAwXG4gICAgICAgICAgPyB0aGlzLm1ldHJpY2FzLnRlbXBvc0luc2VyY2FvLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApIC9cbiAgICAgICAgICAgIHRoaXMubWV0cmljYXMudGVtcG9zSW5zZXJjYW8ubGVuZ3RoXG4gICAgICAgICAgOiAwO1xuXG4gICAgICBjb25zdCB0ZW1wb01lZGlvQ29uc3VsdGEgPVxuICAgICAgICB0aGlzLm1ldHJpY2FzLnRlbXBvc0NvbnN1bHRhLmxlbmd0aCA+IDBcbiAgICAgICAgICA/IHRoaXMubWV0cmljYXMudGVtcG9zQ29uc3VsdGEucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgL1xuICAgICAgICAgICAgdGhpcy5tZXRyaWNhcy50ZW1wb3NDb25zdWx0YS5sZW5ndGhcbiAgICAgICAgICA6IDA7XG5cbiAgICAgIGNvbnN0IHRheGFFcnJvcyA9XG4gICAgICAgIHRoaXMubWV0cmljYXMudG90YWxPcGVyYWNvZXMgPiAwXG4gICAgICAgICAgPyAodGhpcy5tZXRyaWNhcy5lcnJvcyAvIHRoaXMubWV0cmljYXMudG90YWxPcGVyYWNvZXMpICogMTAwXG4gICAgICAgICAgOiAwO1xuXG4gICAgICB0aGlzLmVzdGF0aXN0aWNhcy5tZXRyaWNhcyA9IHtcbiAgICAgICAgdGVtcG9NZWRpb0luc2VyY2FvLFxuICAgICAgICB0ZW1wb01lZGlvQ29uc3VsdGEsXG4gICAgICAgIHRheGFFcnJvcyxcbiAgICAgIH07XG5cbiAgICAgIC8vIEF0dWFsaXphciBkYXRhIGRlIGF0dWFsaXphw6fDo29cbiAgICAgIHRoaXMuZXN0YXRpc3RpY2FzLmRhdGFBdHVhbGl6YWNhbyA9IG5ldyBEYXRlKCk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmxvZygnRXN0YXTDrXN0aWNhcyBkZSBhdWRpdG9yaWEgYXR1YWxpemFkYXMgY29tIHN1Y2Vzc28nKTtcblxuICAgICAgLy8gVmVyaWZpY2FyIGFsZXJ0YXNcbiAgICAgIHRoaXMudmVyaWZpY2FyQWxlcnRhcygpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiB1bmtub3duKSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPVxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdFcnJvIGRlc2NvbmhlY2lkbyc7XG4gICAgICBjb25zdCBlcnJvclN0YWNrID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogdW5kZWZpbmVkO1xuXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gYXR1YWxpemFyIGVzdGF0w61zdGljYXM6ICR7ZXJyb3JNZXNzYWdlfWAsXG4gICAgICAgIGVycm9yU3RhY2ssXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBjb25kacOnw7VlcyBwYXJhIGFsZXJ0YXNcbiAgICovXG4gIHByaXZhdGUgdmVyaWZpY2FyQWxlcnRhcygpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgLy8gVmVyaWZpY2FyIHRheGEgZGUgZXJyb3NcbiAgICAgIGNvbnN0IGxpbWl0ZUVycm9zID0gdGhpcy5jb25maWdTZXJ2aWNlLmdldDxudW1iZXI+KFxuICAgICAgICAnQVVESVRPUklBX0xJTUlURV9UQVhBX0VSUk9TJyxcbiAgICAgICAgNSxcbiAgICAgICk7XG5cbiAgICAgIGlmICh0aGlzLmVzdGF0aXN0aWNhcy5tZXRyaWNhcy50YXhhRXJyb3MgPiBsaW1pdGVFcnJvcykge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgICAgIGBBTEVSVEE6IFRheGEgZGUgZXJyb3MgYWNpbWEgZG8gbGltaXRlICgke3RoaXMuZXN0YXRpc3RpY2FzLm1ldHJpY2FzLnRheGFFcnJvcy50b0ZpeGVkKDIpfSUpYCxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gVmVyaWZpY2FyIHRlbXBvIG3DqWRpbyBkZSBpbnNlcsOnw6NvXG4gICAgICBjb25zdCBsaW1pdGVUZW1wb0luc2VyY2FvID0gdGhpcy5jb25maWdTZXJ2aWNlLmdldDxudW1iZXI+KFxuICAgICAgICAnQVVESVRPUklBX0xJTUlURV9URU1QT19JTlNFUkNBTycsXG4gICAgICAgIDUwMCxcbiAgICAgICk7XG5cbiAgICAgIGlmICh0aGlzLmVzdGF0aXN0aWNhcy5tZXRyaWNhcy50ZW1wb01lZGlvSW5zZXJjYW8gPiBsaW1pdGVUZW1wb0luc2VyY2FvKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgICAgYEFMRVJUQTogVGVtcG8gbcOpZGlvIGRlIGluc2Vyw6fDo28gYWNpbWEgZG8gbGltaXRlICgke3RoaXMuZXN0YXRpc3RpY2FzLm1ldHJpY2FzLnRlbXBvTWVkaW9JbnNlcmNhby50b0ZpeGVkKDIpfW1zKWAsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZlcmlmaWNhciB0ZW1wbyBtw6lkaW8gZGUgY29uc3VsdGFcbiAgICAgIGNvbnN0IGxpbWl0ZVRlbXBvQ29uc3VsdGEgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0PG51bWJlcj4oXG4gICAgICAgICdBVURJVE9SSUFfTElNSVRFX1RFTVBPX0NPTlNVTFRBJyxcbiAgICAgICAgMTAwMCxcbiAgICAgICk7XG5cbiAgICAgIGlmICh0aGlzLmVzdGF0aXN0aWNhcy5tZXRyaWNhcy50ZW1wb01lZGlvQ29uc3VsdGEgPiBsaW1pdGVUZW1wb0NvbnN1bHRhKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgICAgYEFMRVJUQTogVGVtcG8gbcOpZGlvIGRlIGNvbnN1bHRhIGFjaW1hIGRvIGxpbWl0ZSAoJHt0aGlzLmVzdGF0aXN0aWNhcy5tZXRyaWNhcy50ZW1wb01lZGlvQ29uc3VsdGEudG9GaXhlZCgyKX1tcylgLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBWZXJpZmljYXIgY3Jlc2NpbWVudG8gcsOhcGlkb1xuICAgICAgY29uc3QgY3Jlc2NpbWVudG9EaWFyaW8gPSB0aGlzLmVzdGF0aXN0aWNhcy5sb2dzUG9yUGVyaW9kby51bHRpbWFzMjRoO1xuICAgICAgY29uc3QgbGltaXRlQ3Jlc2NpbWVudG9EaWFyaW8gPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0PG51bWJlcj4oXG4gICAgICAgICdBVURJVE9SSUFfTElNSVRFX0NSRVNDSU1FTlRPX0RJQVJJTycsXG4gICAgICAgIDEwMDAwLFxuICAgICAgKTtcblxuICAgICAgaWYgKGNyZXNjaW1lbnRvRGlhcmlvID4gbGltaXRlQ3Jlc2NpbWVudG9EaWFyaW8pIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybihcbiAgICAgICAgICBgQUxFUlRBOiBDcmVzY2ltZW50byBkacOhcmlvIGFjaW1hIGRvIGxpbWl0ZSAoJHtjcmVzY2ltZW50b0RpYXJpb30gbG9ncyBuYXMgw7psdGltYXMgMjRoKWAsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0Vycm8gZGVzY29uaGVjaWRvJztcbiAgICAgIGNvbnN0IGVycm9yU3RhY2sgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiB1bmRlZmluZWQ7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJybyBhbyB2ZXJpZmljYXIgYWxlcnRhczogJHtlcnJvck1lc3NhZ2V9YCxcbiAgICAgICAgZXJyb3JTdGFjayxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdlcmEgcmVsYXTDs3JpbyBkZSBzYcO6ZGUgZG8gbcOzZHVsbyBkZSBhdWRpdG9yaWFcbiAgICpcbiAgICogQHJldHVybnMgUmVsYXTDs3JpbyBkZSBzYcO6ZGVcbiAgICovXG4gIGFzeW5jIGdlcmFyUmVsYXRvcmlvU2F1ZGUoKTogUHJvbWlzZTxhbnk+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQXR1YWxpemFyIGVzdGF0w61zdGljYXMgcGFyYSBnYXJhbnRpciBkYWRvcyByZWNlbnRlc1xuICAgICAgYXdhaXQgdGhpcy5hdHVhbGl6YXJFc3RhdGlzdGljYXMoKTtcblxuICAgICAgLy8gVmVyaWZpY2FyIHBhcnRpw6fDtWVzXG4gICAgICBjb25zdCBwYXJ0aWNvZXNSZXN1bHQgPSBhd2FpdCB0aGlzLmRhdGFTb3VyY2UucXVlcnkoYFxuICAgICAgICBTRUxFQ1RcbiAgICAgICAgICBjaGlsZC5yZWxuYW1lIEFTIG5vbWVfcGFydGljYW8sXG4gICAgICAgICAgcGdfc2l6ZV9wcmV0dHkocGdfcmVsYXRpb25fc2l6ZShjaGlsZC5vaWQpKSBBUyB0YW1hbmhvLFxuICAgICAgICAgIHBnX3N0YXRfZ2V0X251bXNjYW5zKGNoaWxkLm9pZCkgQVMgbnVtX3NjYW5zXG4gICAgICAgIEZST00gcGdfaW5oZXJpdHNcbiAgICAgICAgSk9JTiBwZ19jbGFzcyBwYXJlbnQgT04gcGdfaW5oZXJpdHMuaW5ocGFyZW50ID0gcGFyZW50Lm9pZFxuICAgICAgICBKT0lOIHBnX2NsYXNzIGNoaWxkIE9OIHBnX2luaGVyaXRzLmluaHJlbGlkID0gY2hpbGQub2lkXG4gICAgICAgIEpPSU4gcGdfbmFtZXNwYWNlIG5tc3BfY2hpbGQgT04gbm1zcF9jaGlsZC5vaWQgPSBjaGlsZC5yZWxuYW1lc3BhY2VcbiAgICAgICAgSk9JTiBwZ19uYW1lc3BhY2Ugbm1zcF9wYXJlbnQgT04gbm1zcF9wYXJlbnQub2lkID0gcGFyZW50LnJlbG5hbWVzcGFjZVxuICAgICAgICBXSEVSRSBwYXJlbnQucmVsbmFtZSA9ICdsb2dzX2F1ZGl0b3JpYSdcbiAgICAgICAgT1JERVIgQlkgY2hpbGQucmVsbmFtZVxuICAgICAgYCk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciDDrW5kaWNlc1xuICAgICAgY29uc3QgaW5kaWNlc1Jlc3VsdCA9IGF3YWl0IHRoaXMuZGF0YVNvdXJjZS5xdWVyeShgXG4gICAgICAgIFNFTEVDVFxuICAgICAgICAgIGluZGV4bmFtZSBBUyBub21lX2luZGljZSxcbiAgICAgICAgICBpbmRleGRlZiBBUyBkZWZpbmljYW8sXG4gICAgICAgICAgaWR4X3NjYW4gQVMgbnVtX3NjYW5zLFxuICAgICAgICAgIGlkeF90dXBfcmVhZCBBUyB0dXBsYXNfbGlkYXMsXG4gICAgICAgICAgaWR4X3R1cF9mZXRjaCBBUyB0dXBsYXNfYnVzY2FkYXNcbiAgICAgICAgRlJPTSBwZ19zdGF0X3VzZXJfaW5kZXhlc1xuICAgICAgICBKT0lOIHBnX2luZGV4ZXMgT04gcGdfc3RhdF91c2VyX2luZGV4ZXMuaW5kZXhyZWxuYW1lID0gcGdfaW5kZXhlcy5pbmRleG5hbWVcbiAgICAgICAgV0hFUkUgdGFibGVuYW1lID0gJ2xvZ3NfYXVkaXRvcmlhJ1xuICAgICAgICBPUkRFUiBCWSBpZHhfc2NhbiBERVNDXG4gICAgICBgKTtcblxuICAgICAgLy8gVmVyaWZpY2FyIG9wZXJhw6fDtWVzIGxlbnRhc1xuICAgICAgY29uc3Qgb3BlcmFjb2VzTGVudGFzUmVzdWx0ID0gYXdhaXQgdGhpcy5kYXRhU291cmNlLnF1ZXJ5KGBcbiAgICAgICAgU0VMRUNUXG4gICAgICAgICAgcXVlcnksXG4gICAgICAgICAgY2FsbHMsXG4gICAgICAgICAgdG90YWxfdGltZSAvIGNhbGxzIEFTIGF2Z190aW1lLFxuICAgICAgICAgIHJvd3NcbiAgICAgICAgRlJPTSBwZ19zdGF0X3N0YXRlbWVudHNcbiAgICAgICAgV0hFUkUgcXVlcnkgSUxJS0UgJyVsb2dzX2F1ZGl0b3JpYSUnXG4gICAgICAgIE9SREVSIEJZIGF2Z190aW1lIERFU0NcbiAgICAgICAgTElNSVQgNVxuICAgICAgYCk7XG5cbiAgICAgIC8vIENhbGN1bGFyIHNhw7pkZSBnZXJhbCAoMC0xMDAlKVxuICAgICAgbGV0IHNhdWRlR2VyYWwgPSAxMDA7XG5cbiAgICAgIC8vIFBlbmFsaXphciBwb3IgYWx0YSB0YXhhIGRlIGVycm9zXG4gICAgICBpZiAodGhpcy5lc3RhdGlzdGljYXMubWV0cmljYXMudGF4YUVycm9zID4gMCkge1xuICAgICAgICBzYXVkZUdlcmFsIC09IE1hdGgubWluKDUwLCB0aGlzLmVzdGF0aXN0aWNhcy5tZXRyaWNhcy50YXhhRXJyb3MgKiA1KTtcbiAgICAgIH1cblxuICAgICAgLy8gUGVuYWxpemFyIHBvciB0ZW1wb3MgZGUgcmVzcG9zdGEgYWx0b3NcbiAgICAgIGNvbnN0IHRlbXBvSW5zZXJjYW9JZGVhbCA9IDEwMDsgLy8gbXNcbiAgICAgIGNvbnN0IHRlbXBvQ29uc3VsdGFJZGVhbCA9IDIwMDsgLy8gbXNcblxuICAgICAgaWYgKHRoaXMuZXN0YXRpc3RpY2FzLm1ldHJpY2FzLnRlbXBvTWVkaW9JbnNlcmNhbyA+IHRlbXBvSW5zZXJjYW9JZGVhbCkge1xuICAgICAgICBjb25zdCBwZW5hbGlkYWRlID0gTWF0aC5taW4oXG4gICAgICAgICAgMjUsXG4gICAgICAgICAgKCh0aGlzLmVzdGF0aXN0aWNhcy5tZXRyaWNhcy50ZW1wb01lZGlvSW5zZXJjYW8gLVxuICAgICAgICAgICAgdGVtcG9JbnNlcmNhb0lkZWFsKSAvXG4gICAgICAgICAgICB0ZW1wb0luc2VyY2FvSWRlYWwpICpcbiAgICAgICAgICAgIDEwLFxuICAgICAgICApO1xuICAgICAgICBzYXVkZUdlcmFsIC09IHBlbmFsaWRhZGU7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmVzdGF0aXN0aWNhcy5tZXRyaWNhcy50ZW1wb01lZGlvQ29uc3VsdGEgPiB0ZW1wb0NvbnN1bHRhSWRlYWwpIHtcbiAgICAgICAgY29uc3QgcGVuYWxpZGFkZSA9IE1hdGgubWluKFxuICAgICAgICAgIDI1LFxuICAgICAgICAgICgodGhpcy5lc3RhdGlzdGljYXMubWV0cmljYXMudGVtcG9NZWRpb0NvbnN1bHRhIC1cbiAgICAgICAgICAgIHRlbXBvQ29uc3VsdGFJZGVhbCkgL1xuICAgICAgICAgICAgdGVtcG9Db25zdWx0YUlkZWFsKSAqXG4gICAgICAgICAgICAxMCxcbiAgICAgICAgKTtcbiAgICAgICAgc2F1ZGVHZXJhbCAtPSBwZW5hbGlkYWRlO1xuICAgICAgfVxuXG4gICAgICAvLyBHYXJhbnRpciBxdWUgYSBzYcO6ZGUgbsOjbyBzZWphIG5lZ2F0aXZhXG4gICAgICBzYXVkZUdlcmFsID0gTWF0aC5tYXgoMCwgc2F1ZGVHZXJhbCk7XG5cbiAgICAgIC8vIERldGVybWluYXIgc3RhdHVzIGNvbSBiYXNlIG5hIHNhw7pkZVxuICAgICAgbGV0IHN0YXR1cyA9ICfDk3RpbW8nO1xuXG4gICAgICBpZiAoc2F1ZGVHZXJhbCA8IDYwKSB7XG4gICAgICAgIHN0YXR1cyA9ICdDcsOtdGljbyc7XG4gICAgICB9IGVsc2UgaWYgKHNhdWRlR2VyYWwgPCA4MCkge1xuICAgICAgICBzdGF0dXMgPSAnQWxlcnRhJztcbiAgICAgIH0gZWxzZSBpZiAoc2F1ZGVHZXJhbCA8IDkwKSB7XG4gICAgICAgIHN0YXR1cyA9ICdCb20nO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXJhciByZWNvbWVuZGHDp8O1ZXNcbiAgICAgIGNvbnN0IHJlY29tZW5kYWNvZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICAgIGlmICh0aGlzLmVzdGF0aXN0aWNhcy5tZXRyaWNhcy50YXhhRXJyb3MgPiA1KSB7XG4gICAgICAgIHJlY29tZW5kYWNvZXMucHVzaChcbiAgICAgICAgICAnSW52ZXN0aWdhciBlIGNvcnJpZ2lyIGVycm9zIGZyZXF1ZW50ZXMgbm8gbcOzZHVsbyBkZSBhdWRpdG9yaWEnLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5lc3RhdGlzdGljYXMubWV0cmljYXMudGVtcG9NZWRpb0luc2VyY2FvID4gNTAwKSB7XG4gICAgICAgIHJlY29tZW5kYWNvZXMucHVzaCgnT3RpbWl6YXIgcHJvY2Vzc28gZGUgaW5zZXLDp8OjbyBkZSBsb2dzJyk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmVzdGF0aXN0aWNhcy5tZXRyaWNhcy50ZW1wb01lZGlvQ29uc3VsdGEgPiAxMDAwKSB7XG4gICAgICAgIHJlY29tZW5kYWNvZXMucHVzaCgnUmV2aXNhciDDrW5kaWNlcyBlIG90aW1pemFyIGNvbnN1bHRhcycpO1xuICAgICAgfVxuXG4gICAgICAvLyBWZXJpZmljYXIgw61uZGljZXMgbsOjbyB1dGlsaXphZG9zXG4gICAgICBjb25zdCBpbmRpY2VzTmFvVXRpbGl6YWRvcyA9IChcbiAgICAgICAgaW5kaWNlc1Jlc3VsdCBhcyBBcnJheTx7IG51bV9zY2Fuczogc3RyaW5nOyBub21lX2luZGljZTogc3RyaW5nIH0+XG4gICAgICApLmZpbHRlcigoaW5kaWNlKSA9PiBpbmRpY2UubnVtX3NjYW5zID09PSAnMCcpO1xuXG4gICAgICBpZiAoaW5kaWNlc05hb1V0aWxpemFkb3MubGVuZ3RoID4gMCkge1xuICAgICAgICByZWNvbWVuZGFjb2VzLnB1c2goXG4gICAgICAgICAgYENvbnNpZGVyYXIgcmVtb3ZlciDDrW5kaWNlcyBuw6NvIHV0aWxpemFkb3M6ICR7aW5kaWNlc05hb1V0aWxpemFkb3MubWFwKChpKSA9PiBpLm5vbWVfaW5kaWNlKS5qb2luKCcsICcpfWAsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNhdWRlR2VyYWw6IHtcbiAgICAgICAgICBwb250dWFjYW86IE1hdGgucm91bmQoc2F1ZGVHZXJhbCksXG4gICAgICAgICAgc3RhdHVzLFxuICAgICAgICAgIGRhdGFBdmFsaWFjYW86IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICAgIGVzdGF0aXN0aWNhczogdGhpcy5lc3RhdGlzdGljYXMsXG4gICAgICAgIGRldGFsaGVzOiB7XG4gICAgICAgICAgcGFydGljb2VzOiBwYXJ0aWNvZXNSZXN1bHQsXG4gICAgICAgICAgaW5kaWNlczogaW5kaWNlc1Jlc3VsdCxcbiAgICAgICAgICBvcGVyYWNvZXNMZW50YXM6IG9wZXJhY29lc0xlbnRhc1Jlc3VsdCxcbiAgICAgICAgfSxcbiAgICAgICAgcmVjb21lbmRhY29lcyxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IHVua25vd24pIHtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0Vycm8gZGVzY29uaGVjaWRvJztcbiAgICAgIGNvbnN0IGVycm9yU3RhY2sgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiB1bmRlZmluZWQ7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJybyBhbyBnZXJhciByZWxhdMOzcmlvIGRlIHNhw7pkZTogJHtlcnJvck1lc3NhZ2V9YCxcbiAgICAgICAgZXJyb3JTdGFjayxcbiAgICAgICk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==