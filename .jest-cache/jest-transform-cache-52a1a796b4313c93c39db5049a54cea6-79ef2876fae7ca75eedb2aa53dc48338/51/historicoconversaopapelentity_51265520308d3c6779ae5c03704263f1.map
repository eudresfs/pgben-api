{"file":"C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\entities\\historico-conversao-papel.entity.ts","mappings":";;;;;;;;;;;;;AAAA,qCAQiB;AACjB,qDAA2C;AAC3C,8DAAgE;AAEhE;;;;;GAKG;AAGI,IAAM,uBAAuB,GAA7B,MAAM,uBAAuB;IAElC,EAAE,CAAS;IAGX,UAAU,CAAS;IAInB,OAAO,CAAU;IAQjB,cAAc,CAAY;IAQ1B,UAAU,CAAY;IAGtB,sBAAsB,CAAS;IAG/B,UAAU,CAAS;IAGnB,aAAa,CAAS;IAGtB,mBAAmB,CAAU;IAG7B,qBAAqB,CAAS;IAG9B,UAAU,CAAO;IAEjB,oBAAoB;IACpB,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,UAAU,CAAC;IACzB,CAAC;IAED,IAAI,SAAS,CAAC,KAAa;QACzB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;IAC1B,CAAC;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,UAAU,CAAC;IACzB,CAAC;IAED,IAAI,SAAS,CAAC,KAAa;QACzB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;IAC1B,CAAC;IAED,IAAI,oBAAoB;QACtB,OAAO,IAAI,CAAC,sBAAsB,CAAC;IACrC,CAAC;IAED,IAAI,oBAAoB,CAAC,KAAa;QACpC,IAAI,CAAC,sBAAsB,GAAG,KAAK,CAAC;IACtC,CAAC;IAED,IAAI,mBAAmB;QACrB,OAAO,IAAI,CAAC,qBAAqB,CAAC;IACpC,CAAC;IAED,IAAI,mBAAmB,CAAC,KAAa;QACnC,IAAI,CAAC,qBAAqB,GAAG,KAAK,CAAC;IACrC,CAAC;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,UAAU,CAAC;IACzB,CAAC;IAED,sBAAsB;IAEtB;;OAEG;IACH,oBAAoB;QAClB,MAAM,KAAK,GAAG,IAAI,IAAI,EAAE,CAAC;QACzB,MAAM,UAAU,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;QACnE,OAAO,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;IACtC,CAAC;IAED;;OAEG;IACH,sBAAsB;QACpB,MAAM,KAAK,GAAG,IAAI,IAAI,EAAE,CAAC;QACzB,MAAM,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC,CAAC;QACvE,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,CAAC,IAAI,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;IACrD,CAAC;IAED;;OAEG;IACH,oBAAoB;QAClB,OAAO,IAAI,CAAC,mBAAmB,CAAC;IAClC,CAAC;IAED;;OAEG;IACH,oBAAoB;QAClB,OAAO,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC;IACtC,CAAC;IAED;;OAEG;IACH,qBAAqB;QACnB,OAAO,CAAC,CAAC,IAAI,CAAC,sBAAsB,CAAC;IACvC,CAAC;IAED;;OAEG;IACH,UAAU;QACR,MAAM,UAAU,GAAG;YACjB,CAAC,2BAAS,CAAC,UAAU,CAAC,EAAE,CAAC;YACzB,CAAC,2BAAS,CAAC,YAAY,CAAC,EAAE,CAAC;YAC3B,CAAC,2BAAS,CAAC,mBAAmB,CAAC,EAAE,CAAC;YAClC,CAAC,2BAAS,CAAC,UAAU,CAAC,EAAE,CAAC;SAC1B,CAAC;QAEF,OAAO,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IACvE,CAAC;IAED;;OAEG;IACH,SAAS;QACP,MAAM,UAAU,GAAG;YACjB,CAAC,2BAAS,CAAC,UAAU,CAAC,EAAE,CAAC;YACzB,CAAC,2BAAS,CAAC,YAAY,CAAC,EAAE,CAAC;YAC3B,CAAC,2BAAS,CAAC,mBAAmB,CAAC,EAAE,CAAC;YAClC,CAAC,2BAAS,CAAC,UAAU,CAAC,EAAE,CAAC;SAC1B,CAAC;QAEF,OAAO,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IACvE,CAAC;IAED;;OAEG;IACH,gBAAgB;QACd,OAAO,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC;IACjD,CAAC;IAED;;OAEG;IACH,yBAAyB;QACvB,MAAM,UAAU,GAAG;YACjB,CAAC,2BAAS,CAAC,UAAU,CAAC,EAAE,sBAAsB;YAC9C,CAAC,2BAAS,CAAC,YAAY,CAAC,EAAE,cAAc;YACxC,CAAC,2BAAS,CAAC,mBAAmB,CAAC,EAAE,qBAAqB;YACtD,CAAC,2BAAS,CAAC,UAAU,CAAC,EAAE,YAAY;SACrC,CAAC;QACF,OAAO,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,IAAI,CAAC,cAAc,CAAC;IAChE,CAAC;IAED;;OAEG;IACH,qBAAqB;QACnB,MAAM,UAAU,GAAG;YACjB,CAAC,2BAAS,CAAC,UAAU,CAAC,EAAE,sBAAsB;YAC9C,CAAC,2BAAS,CAAC,YAAY,CAAC,EAAE,cAAc;YACxC,CAAC,2BAAS,CAAC,mBAAmB,CAAC,EAAE,qBAAqB;YACtD,CAAC,2BAAS,CAAC,UAAU,CAAC,EAAE,YAAY;SACrC,CAAC;QACF,OAAO,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC,UAAU,CAAC;IACxD,CAAC;IAED;;OAEG;IACH,mBAAmB;QACjB,MAAM,QAAQ,GAAG,IAAI,CAAC,yBAAyB,EAAE,CAAC;QAClD,MAAM,IAAI,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC;QAE1C,IAAI,IAAI,CAAC,UAAU,EAAE,EAAE,CAAC;YACtB,OAAO,aAAa,QAAQ,MAAM,IAAI,EAAE,CAAC;QAC3C,CAAC;aAAM,IAAI,IAAI,CAAC,SAAS,EAAE,EAAE,CAAC;YAC5B,OAAO,YAAY,QAAQ,MAAM,IAAI,EAAE,CAAC;QAC1C,CAAC;aAAM,CAAC;YACN,OAAO,YAAY,QAAQ,MAAM,IAAI,EAAE,CAAC;QAC1C,CAAC;IACH,CAAC;IAED;;OAEG;IACH,iBAAiB,CAAC,SAAiB;QACjC,OAAO,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC;IACvC,CAAC;IAED;;OAEG;IACH,sBAAsB,CAAC,SAAiB;QACtC,OAAO,IAAI,CAAC,UAAU,KAAK,SAAS,CAAC;IACvC,CAAC;IAED;;OAEG;IACH,mBAAmB,CAAC,SAAiB;QACnC,OAAO,IAAI,CAAC,qBAAqB,KAAK,SAAS,CAAC;IAClD,CAAC;IAED;;OAEG;IACH,UAAU;QACR,MAAM,OAAO,GAAG,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3C,MAAM,IAAI,GAAG,IAAI,CAAC,mBAAmB,EAAE,CAAC;QACxC,MAAM,WAAW,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,EAAE,CAAC;QACvE,OAAO,GAAG,OAAO,OAAO,IAAI,GAAG,WAAW,EAAE,CAAC;IAC/C,CAAC;IAED;;OAEG;IACH,YAAY;QACV,OAAO,aAAa,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE,CAAC;IACrE,CAAC;IAED;;OAEG;IACH,aAAa;QACX,0BAA0B;QAC1B,IAAI,CAAC,IAAI,CAAC,UAAU;YAAE,OAAO,KAAK,CAAC;QAEnC,0BAA0B;QAC1B,IAAI,CAAC,IAAI,CAAC,UAAU;YAAE,OAAO,KAAK,CAAC;QAEnC,iCAAiC;QACjC,IAAI,CAAC,IAAI,CAAC,cAAc,IAAI,CAAC,IAAI,CAAC,UAAU;YAAE,OAAO,KAAK,CAAC;QAE3D,uCAAuC;QACvC,IAAI,IAAI,CAAC,cAAc,KAAK,IAAI,CAAC,UAAU;YAAE,OAAO,KAAK,CAAC;QAE1D,gCAAgC;QAChC,IAAI,CAAC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,aAAa,CAAC,IAAI,EAAE,CAAC,MAAM,KAAK,CAAC;YAAE,OAAO,KAAK,CAAC;QAEhF,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;OAEG;IACH,KAAK;QACH,OAAO;YACL,UAAU,EAAE,IAAI,CAAC,UAAU;YAC3B,cAAc,EAAE,IAAI,CAAC,cAAc;YACnC,UAAU,EAAE,IAAI,CAAC,UAAU;YAC3B,sBAAsB,EAAE,IAAI,CAAC,sBAAsB;YACnD,UAAU,EAAE,IAAI,CAAC,UAAU;YAC3B,aAAa,EAAE,IAAI,CAAC,aAAa;YACjC,mBAAmB,EAAE,IAAI,CAAC,mBAAmB;YAC7C,qBAAqB,EAAE,IAAI,CAAC,qBAAqB;SAClD,CAAC;IACJ,CAAC;IAED;;OAEG;IACH,SAAS;QACP,oDAAoD;QACpD,IAAI,IAAI,CAAC,UAAU,KAAK,2BAAS,CAAC,UAAU;YAAE,OAAO,IAAI,CAAC;QAE1D,4CAA4C;QAC5C,IAAI,IAAI,CAAC,cAAc,KAAK,2BAAS,CAAC,UAAU;YAAE,OAAO,IAAI,CAAC;QAE9D,mDAAmD;QACnD,IAAI,IAAI,CAAC,oBAAoB,EAAE,IAAI,CAAC,IAAI,CAAC,oBAAoB,EAAE;YAAE,OAAO,IAAI,CAAC;QAE7E,OAAO,KAAK,CAAC;IACf,CAAC;IAED;;OAEG;IACH,eAAe;QACb,wDAAwD;QACxD,IAAI,IAAI,CAAC,UAAU,KAAK,2BAAS,CAAC,UAAU;YAAE,OAAO,IAAI,CAAC;QAE1D,uCAAuC;QACvC,IAAI,IAAI,CAAC,SAAS,EAAE;YAAE,OAAO,IAAI,CAAC;QAElC,OAAO,KAAK,CAAC;IACf,CAAC;IAED;;OAEG;IACH,cAAc;QACZ,IAAI,IAAI,CAAC,SAAS,EAAE;YAAE,OAAO,MAAM,CAAC;QACpC,IAAI,IAAI,CAAC,eAAe,EAAE;YAAE,OAAO,OAAO,CAAC;QAC3C,OAAO,OAAO,CAAC;IACjB,CAAC;IAED;;OAEG;IACH,mBAAmB;QACjB,OAAO,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAC,OAAO,EAAE;YACjD,IAAI,EAAE,SAAS;YACf,KAAK,EAAE,SAAS;YAChB,GAAG,EAAE,SAAS;YACd,IAAI,EAAE,SAAS;YACf,MAAM,EAAE,SAAS;SAClB,CAAC,CAAC;IACL,CAAC;IAED;;OAEG;IACH,SAAS;QACP,OAAO;YACL,EAAE,EAAE,IAAI,CAAC,EAAE;YACX,cAAc,EAAE,IAAI,CAAC,cAAc;YACnC,UAAU,EAAE,IAAI,CAAC,UAAU;YAC3B,mBAAmB,EAAE,IAAI,CAAC,mBAAmB;YAC7C,UAAU,EAAE,IAAI,CAAC,UAAU;SAC5B,CAAC;IACJ,CAAC;IAED;;OAEG;IACH,6BAA6B;QAC3B,IAAI,IAAI,CAAC,oBAAoB,EAAE;YAAE,OAAO,KAAK,CAAC;QAE9C,MAAM,aAAa,GAAG,IAAI,IAAI,EAAE,CAAC;QACjC,aAAa,CAAC,OAAO,CAAC,aAAa,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC,CAAC;QACnD,OAAO,IAAI,CAAC,UAAU,GAAG,aAAa,CAAC;IACzC,CAAC;IAED;;OAEG;IACH,gBAAgB;QACd,MAAM,SAAS,GAAa,EAAE,CAAC;QAE/B,IAAI,CAAC,IAAI,CAAC,oBAAoB,EAAE,EAAE,CAAC;YACjC,SAAS,CAAC,IAAI,CAAC,sCAAsC,CAAC,CAAC;QACzD,CAAC;QAED,IAAI,IAAI,CAAC,6BAA6B,EAAE,EAAE,CAAC;YACzC,SAAS,CAAC,IAAI,CAAC,6DAA6D,CAAC,CAAC;QAChF,CAAC;QAED,IAAI,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,oBAAoB,EAAE,EAAE,CAAC;YACrD,SAAS,CAAC,IAAI,CAAC,mDAAmD,CAAC,CAAC;QACtE,CAAC;QAED,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,EAAE,CAAC;YAC1B,SAAS,CAAC,IAAI,CAAC,+CAA+C,CAAC,CAAC;QAClE,CAAC;QAED,OAAO,SAAS,CAAC;IACnB,CAAC;IAED;;OAEG;IACH,eAAe;QACb,OAAO,IAAI,CAAC,aAAa,EAAE,IAAI,IAAI,CAAC,sBAAsB,EAAE,IAAI,CAAC,CAAC;IACpE,CAAC;IAED;;OAEG;IACH,eAAe;QAMb,OAAO;YACL,YAAY,EAAE,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,SAAS;YACvF,OAAO,EAAE,IAAI,CAAC,cAAc,EAAE;YAC9B,oBAAoB,EAAE,IAAI,CAAC,sBAAsB,EAAE;YACnD,kBAAkB,EAAE,IAAI,CAAC,oBAAoB,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,UAAU;SACzE,CAAC;IACJ,CAAC;CACF,CAAA;AA/YY,0DAAuB;AAElC;IADC,IAAA,gCAAsB,EAAC,MAAM,CAAC;;mDACpB;AAGX;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,YAAY,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;;2DAC1B;AAInB;IAFC,IAAA,mBAAS,EAAC,GAAG,EAAE,CAAC,wBAAO,EAAE,EAAE,QAAQ,EAAE,SAAS,EAAE,CAAC;IACjD,IAAA,oBAAU,EAAC,EAAE,IAAI,EAAE,YAAY,EAAE,CAAC;kDAC1B,wBAAO,oBAAP,wBAAO;wDAAC;AAQjB;IANC,IAAA,gBAAM,EAAC;QACN,IAAI,EAAE,gBAAgB;QACtB,IAAI,EAAE,MAAM;QACZ,IAAI,EAAE,2BAAS;QACf,QAAQ,EAAE,YAAY;KACvB,CAAC;kDACc,2BAAS,oBAAT,2BAAS;+DAAC;AAQ1B;IANC,IAAA,gBAAM,EAAC;QACN,IAAI,EAAE,YAAY;QAClB,IAAI,EAAE,MAAM;QACZ,IAAI,EAAE,2BAAS;QACf,QAAQ,EAAE,YAAY;KACvB,CAAC;kDACU,2BAAS,oBAAT,2BAAS;2DAAC;AAGtB;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,wBAAwB,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;;uEAC1C;AAG/B;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,YAAY,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;;2DAC1B;AAGnB;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,eAAe,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;;8DAC1B;AAGtB;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,qBAAqB,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC;;oEAC5C;AAG7B;IADC,IAAA,gBAAM,EAAC,EAAE,IAAI,EAAE,uBAAuB,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC;;sEAC1C;AAG9B;IADC,IAAA,0BAAgB,EAAC,EAAE,IAAI,EAAE,YAAY,EAAE,CAAC;kDAC7B,IAAI,oBAAJ,IAAI;2DAAC;kCA3CN,uBAAuB;IAFnC,IAAA,gBAAM,EAAC,2BAA2B,CAAC;IACnC,IAAA,eAAK,EAAC,CAAC,YAAY,EAAE,YAAY,CAAC,CAAC;GACvB,uBAAuB,CA+YnC","names":[],"sources":["C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\entities\\historico-conversao-papel.entity.ts"],"sourcesContent":["import {\n  Entity,\n  PrimaryGeneratedColumn,\n  Column,\n  CreateDateColumn,\n  ManyToOne,\n  JoinColumn,\n  Index,\n} from 'typeorm';\nimport { Cidadao } from './cidadao.entity';\nimport { TipoPapel, PaperType } from '../enums/tipo-papel.enum';\n\n/**\n * Entidade de Histórico de Conversão de Papel\n *\n * Registra o histórico de conversões de papéis de cidadãos no sistema,\n * permitindo rastrear quando um cidadão foi convertido de um papel para outro.\n */\n@Entity('historico_conversao_papel')\n@Index(['cidadao_id', 'created_at'])\nexport class HistoricoConversaoPapel {\n  @PrimaryGeneratedColumn('uuid')\n  id: string;\n\n  @Column({ name: 'cidadao_id', type: 'uuid' })\n  cidadao_id: string;\n\n  @ManyToOne(() => Cidadao, { onDelete: 'CASCADE' })\n  @JoinColumn({ name: 'cidadao_id' })\n  cidadao: Cidadao;\n\n  @Column({\n    name: 'papel_anterior',\n    type: 'enum',\n    enum: TipoPapel,\n    enumName: 'tipo_papel',\n  })\n  papel_anterior: PaperType;\n\n  @Column({\n    name: 'papel_novo',\n    type: 'enum',\n    enum: TipoPapel,\n    enumName: 'tipo_papel',\n  })\n  papel_novo: PaperType;\n\n  @Column({ name: 'composicao_familiar_id', type: 'uuid', nullable: true })\n  composicao_familiar_id: string;\n\n  @Column({ name: 'usuario_id', type: 'uuid' })\n  usuario_id: string;\n\n  @Column({ name: 'justificativa', type: 'text' })\n  justificativa: string;\n\n  @Column({ name: 'notificacao_enviada', type: 'boolean', default: false })\n  notificacao_enviada: boolean;\n\n  @Column({ name: 'tecnico_notificado_id', type: 'uuid', nullable: true })\n  tecnico_notificado_id: string;\n\n  @CreateDateColumn({ name: 'created_at' })\n  created_at: Date;\n\n  // Getters e Setters\n  get cidadaoId(): string {\n    return this.cidadao_id;\n  }\n\n  set cidadaoId(value: string) {\n    this.cidadao_id = value;\n  }\n\n  get usuarioId(): string {\n    return this.usuario_id;\n  }\n\n  set usuarioId(value: string) {\n    this.usuario_id = value;\n  }\n\n  get composicaoFamiliarId(): string {\n    return this.composicao_familiar_id;\n  }\n\n  set composicaoFamiliarId(value: string) {\n    this.composicao_familiar_id = value;\n  }\n\n  get tecnicoNotificadoId(): string {\n    return this.tecnico_notificado_id;\n  }\n\n  set tecnicoNotificadoId(value: string) {\n    this.tecnico_notificado_id = value;\n  }\n\n  get createdAt(): Date {\n    return this.created_at;\n  }\n\n  // Métodos Utilitários\n\n  /**\n   * Verifica se a conversão foi criada recentemente (últimas 24 horas)\n   */\n  isCriadoRecentemente(): boolean {\n    const agora = new Date();\n    const umDiaAtras = new Date(agora.getTime() - 24 * 60 * 60 * 1000);\n    return this.created_at > umDiaAtras;\n  }\n\n  /**\n   * Calcula a idade do registro em dias\n   */\n  getIdadeRegistroEmDias(): number {\n    const agora = new Date();\n    const diffTime = Math.abs(agora.getTime() - this.created_at.getTime());\n    return Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n  }\n\n  /**\n   * Verifica se a notificação foi enviada\n   */\n  isNotificacaoEnviada(): boolean {\n    return this.notificacao_enviada;\n  }\n\n  /**\n   * Verifica se tem técnico notificado\n   */\n  temTecnicoNotificado(): boolean {\n    return !!this.tecnico_notificado_id;\n  }\n\n  /**\n   * Verifica se tem composição familiar associada\n   */\n  temComposicaoFamiliar(): boolean {\n    return !!this.composicao_familiar_id;\n  }\n\n  /**\n   * Verifica se é uma promoção (papel novo é \"superior\" ao anterior)\n   */\n  isPromocao(): boolean {\n    const hierarquia = {\n      [TipoPapel.DEPENDENTE]: 1,\n      [TipoPapel.BENEFICIARIO]: 2,\n      [TipoPapel.REPRESENTANTE_LEGAL]: 3,\n      [TipoPapel.REQUERENTE]: 4,\n    };\n    \n    return hierarquia[this.papel_novo] > hierarquia[this.papel_anterior];\n  }\n\n  /**\n   * Verifica se é uma redução de papel\n   */\n  isReducao(): boolean {\n    const hierarquia = {\n      [TipoPapel.DEPENDENTE]: 1,\n      [TipoPapel.BENEFICIARIO]: 2,\n      [TipoPapel.REPRESENTANTE_LEGAL]: 3,\n      [TipoPapel.REQUERENTE]: 4,\n    };\n    \n    return hierarquia[this.papel_novo] < hierarquia[this.papel_anterior];\n  }\n\n  /**\n   * Verifica se é uma mudança lateral (mesmo nível hierárquico)\n   */\n  isMudancaLateral(): boolean {\n    return !this.isPromocao() && !this.isReducao();\n  }\n\n  /**\n   * Obtém a descrição do papel anterior\n   */\n  getDescricaoPapelAnterior(): string {\n    const descricoes = {\n      [TipoPapel.REQUERENTE]: 'Responsável Familiar',\n      [TipoPapel.BENEFICIARIO]: 'Beneficiário',\n      [TipoPapel.REPRESENTANTE_LEGAL]: 'Representante Legal',\n      [TipoPapel.DEPENDENTE]: 'Dependente',\n    };\n    return descricoes[this.papel_anterior] || this.papel_anterior;\n  }\n\n  /**\n   * Obtém a descrição do papel novo\n   */\n  getDescricaoPapelNovo(): string {\n    const descricoes = {\n      [TipoPapel.REQUERENTE]: 'Responsável Familiar',\n      [TipoPapel.BENEFICIARIO]: 'Beneficiário',\n      [TipoPapel.REPRESENTANTE_LEGAL]: 'Representante Legal',\n      [TipoPapel.DEPENDENTE]: 'Dependente',\n    };\n    return descricoes[this.papel_novo] || this.papel_novo;\n  }\n\n  /**\n   * Obtém a descrição da mudança\n   */\n  getDescricaoMudanca(): string {\n    const anterior = this.getDescricaoPapelAnterior();\n    const novo = this.getDescricaoPapelNovo();\n    \n    if (this.isPromocao()) {\n      return `Promoção: ${anterior} → ${novo}`;\n    } else if (this.isReducao()) {\n      return `Redução: ${anterior} → ${novo}`;\n    } else {\n      return `Mudança: ${anterior} → ${novo}`;\n    }\n  }\n\n  /**\n   * Verifica se pertence a um cidadão específico\n   */\n  pertenceAoCidadao(cidadaoId: string): boolean {\n    return this.cidadao_id === cidadaoId;\n  }\n\n  /**\n   * Verifica se foi executado por um usuário específico\n   */\n  foiExecutadoPorUsuario(usuarioId: string): boolean {\n    return this.usuario_id === usuarioId;\n  }\n\n  /**\n   * Verifica se o técnico notificado é específico\n   */\n  tecnicoNotificadoEh(tecnicoId: string): boolean {\n    return this.tecnico_notificado_id === tecnicoId;\n  }\n\n  /**\n   * Obtém um resumo da conversão\n   */\n  getSummary(): string {\n    const mudanca = this.getDescricaoMudanca();\n    const data = this.getCriacaoFormatada();\n    const notificacao = this.isNotificacaoEnviada() ? ' (Notificado)' : '';\n    return `${mudanca} em ${data}${notificacao}`;\n  }\n\n  /**\n   * Gera uma chave única para o histórico\n   */\n  getUniqueKey(): string {\n    return `historico_${this.cidadao_id}_${this.created_at.getTime()}`;\n  }\n\n  /**\n   * Verifica se o histórico é consistente\n   */\n  isConsistente(): boolean {\n    // Verifica se tem cidadão\n    if (!this.cidadao_id) return false;\n    \n    // Verifica se tem usuário\n    if (!this.usuario_id) return false;\n    \n    // Verifica se tem papéis válidos\n    if (!this.papel_anterior || !this.papel_novo) return false;\n    \n    // Verifica se os papéis são diferentes\n    if (this.papel_anterior === this.papel_novo) return false;\n    \n    // Verifica se tem justificativa\n    if (!this.justificativa || this.justificativa.trim().length === 0) return false;\n    \n    return true;\n  }\n\n  /**\n   * Clona o histórico (sem ID)\n   */\n  clone(): Partial<HistoricoConversaoPapel> {\n    return {\n      cidadao_id: this.cidadao_id,\n      papel_anterior: this.papel_anterior,\n      papel_novo: this.papel_novo,\n      composicao_familiar_id: this.composicao_familiar_id,\n      usuario_id: this.usuario_id,\n      justificativa: this.justificativa,\n      notificacao_enviada: this.notificacao_enviada,\n      tecnico_notificado_id: this.tecnico_notificado_id,\n    };\n  }\n\n  /**\n   * Verifica se é uma conversão crítica (requer atenção especial)\n   */\n  isCritico(): boolean {\n    // Conversões para responsável familiar são críticas\n    if (this.papel_novo === TipoPapel.REQUERENTE) return true;\n    \n    // Remoção de responsável familiar é crítica\n    if (this.papel_anterior === TipoPapel.REQUERENTE) return true;\n    \n    // Conversões recentes sem notificação são críticas\n    if (this.isCriadoRecentemente() && !this.isNotificacaoEnviada()) return true;\n    \n    return false;\n  }\n\n  /**\n   * Verifica se requer aprovação adicional\n   */\n  requerAprovacao(): boolean {\n    // Mudanças para responsável familiar requerem aprovação\n    if (this.papel_novo === TipoPapel.REQUERENTE) return true;\n    \n    // Reduções de papel requerem aprovação\n    if (this.isReducao()) return true;\n    \n    return false;\n  }\n\n  /**\n   * Obtém o tipo de impacto da conversão\n   */\n  getTipoImpacto(): 'ALTO' | 'MEDIO' | 'BAIXO' {\n    if (this.isCritico()) return 'ALTO';\n    if (this.requerAprovacao()) return 'MEDIO';\n    return 'BAIXO';\n  }\n\n  /**\n   * Formata a data de criação\n   */\n  getCriacaoFormatada(): string {\n    return this.created_at.toLocaleDateString('pt-BR', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  }\n\n  /**\n   * Remove informações sensíveis para logs\n   */\n  toSafeLog(): Partial<HistoricoConversaoPapel> {\n    return {\n      id: this.id,\n      papel_anterior: this.papel_anterior,\n      papel_novo: this.papel_novo,\n      notificacao_enviada: this.notificacao_enviada,\n      created_at: this.created_at,\n    };\n  }\n\n  /**\n   * Verifica se a notificação está pendente há muito tempo\n   */\n  notificacaoPendenteMuitoTempo(): boolean {\n    if (this.isNotificacaoEnviada()) return false;\n    \n    const seteDiasAtras = new Date();\n    seteDiasAtras.setDate(seteDiasAtras.getDate() - 7);\n    return this.created_at < seteDiasAtras;\n  }\n\n  /**\n   * Obtém sugestões de ação para o histórico\n   */\n  getSugestoesAcao(): string[] {\n    const sugestoes: string[] = [];\n    \n    if (!this.isNotificacaoEnviada()) {\n      sugestoes.push('Enviar notificação sobre a conversão');\n    }\n    \n    if (this.notificacaoPendenteMuitoTempo()) {\n      sugestoes.push('Notificação pendente há mais de 7 dias - verificar urgência');\n    }\n    \n    if (this.isCritico() && !this.temTecnicoNotificado()) {\n      sugestoes.push('Conversão crítica - notificar técnico responsável');\n    }\n    \n    if (!this.isConsistente()) {\n      sugestoes.push('Verificar consistência dos dados do histórico');\n    }\n    \n    return sugestoes;\n  }\n\n  /**\n   * Verifica se pode ser auditado\n   */\n  podeSerAuditado(): boolean {\n    return this.isConsistente() && this.getIdadeRegistroEmDias() >= 1;\n  }\n\n  /**\n   * Obtém estatísticas da conversão\n   */\n  getEstatisticas(): {\n    tipo_mudanca: string;\n    impacto: string;\n    dias_desde_conversao: number;\n    notificacao_status: string;\n  } {\n    return {\n      tipo_mudanca: this.isPromocao() ? 'PROMOCAO' : this.isReducao() ? 'REDUCAO' : 'LATERAL',\n      impacto: this.getTipoImpacto(),\n      dias_desde_conversao: this.getIdadeRegistroEmDias(),\n      notificacao_status: this.isNotificacaoEnviada() ? 'ENVIADA' : 'PENDENTE'\n    };\n  }\n}\n"],"version":3}