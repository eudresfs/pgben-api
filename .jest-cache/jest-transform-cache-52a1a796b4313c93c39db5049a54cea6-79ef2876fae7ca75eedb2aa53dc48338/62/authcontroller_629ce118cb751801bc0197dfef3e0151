73825ad33984f30c13f27dbae10dc811
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var AuthController_1;
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuthController = void 0;
const common_1 = require("@nestjs/common");
const swagger_1 = require("@nestjs/swagger");
const base_api_response_dto_1 = require("../../shared/dtos/base-api-response.dto");
const logger_service_1 = require("../../shared/logger/logger.service");
const req_context_decorator_1 = require("../../shared/request-context/req-context.decorator");
const request_context_dto_1 = require("../../shared/request-context/request-context.dto");
const auth_login_input_dto_1 = require("../dtos/auth-login-input.dto");
const auth_refresh_token_input_dto_1 = require("../dtos/auth-refresh-token-input.dto");
const auth_token_output_dto_1 = require("../dtos/auth-token-output.dto");
const jwt_refresh_guard_1 = require("../guards/jwt-refresh.guard");
const local_auth_guard_1 = require("../guards/local-auth.guard");
const auth_service_1 = require("../services/auth.service");
const public_decorator_1 = require("../decorators/public.decorator");
let AuthController = AuthController_1 = class AuthController {
    authService;
    logger;
    constructor(authService, logger) {
        this.authService = authService;
        this.logger = logger;
        this.logger.setContext(AuthController_1.name);
    }
    async login(ctx, credential) {
        this.logger.log(ctx, `${this.login.name} was called`);
        const authToken = await this.authService.login(ctx);
        // Converter para o formato BaseApiResponse
        const response = new base_api_response_dto_1.BaseApiResponse();
        response.data = authToken;
        response.meta = {};
        return response;
    }
    async refreshToken(ctx, credential) {
        this.logger.log(ctx, `${this.refreshToken.name} was called`);
        const authToken = await this.authService.refreshToken(ctx, credential);
        // Converter para o formato BaseApiResponse
        const response = new base_api_response_dto_1.BaseApiResponse();
        response.data = authToken;
        response.meta = {};
        return response;
    }
    getStatus() {
        return {
            status: 'online',
            message: 'Serviço de autenticação está funcionando',
            timestamp: new Date().toISOString(),
        };
    }
};
exports.AuthController = AuthController;
__decorate([
    (0, common_1.Post)('login'),
    (0, public_decorator_1.Public)(),
    (0, swagger_1.ApiOperation)({
        summary: 'Fazer login',
        description: 'Autentica um usuário no sistema usando credenciais (username/password)',
        requestBody: {
            description: 'Credenciais de login',
            required: true,
            content: {
                'application/json': {
                    schema: {
                        $ref: '#/components/schemas/LoginInput',
                    },
                    examples: {
                        'usuario-admin': {
                            summary: 'Login de Administrador',
                            description: 'Exemplo de login para usuário administrador',
                            value: {
                                username: 'admin@semtas.gov.br',
                                password: 'senha123',
                            },
                        },
                        'usuario-assistente': {
                            summary: 'Login de Assistente Social',
                            description: 'Exemplo de login para assistente social',
                            value: {
                                username: 'maria.silva@semtas.gov.br',
                                password: 'minhasenha456',
                            },
                        },
                        'usuario-coordenador': {
                            summary: 'Login de Coordenador',
                            description: 'Exemplo de login para coordenador de unidade',
                            value: {
                                username: 'joao.santos@semtas.gov.br',
                                password: 'coordenador789',
                            },
                        },
                    },
                },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({
        status: common_1.HttpStatus.OK,
        type: (0, base_api_response_dto_1.SwaggerBaseApiResponse)(auth_token_output_dto_1.AuthTokenOutput),
    }),
    (0, swagger_1.ApiResponse)({
        status: common_1.HttpStatus.UNAUTHORIZED,
        type: base_api_response_dto_1.BaseApiErrorResponse,
    }),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, common_1.UseGuards)(local_auth_guard_1.LocalAuthGuard),
    (0, common_1.UseInterceptors)(common_1.ClassSerializerInterceptor),
    __param(0, (0, req_context_decorator_1.ReqContext)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof request_context_dto_1.RequestContext !== "undefined" && request_context_dto_1.RequestContext) === "function" ? _c : Object, typeof (_d = typeof auth_login_input_dto_1.LoginInput !== "undefined" && auth_login_input_dto_1.LoginInput) === "function" ? _d : Object]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], AuthController.prototype, "login", null);
__decorate([
    (0, common_1.Post)('refresh-token'),
    (0, swagger_1.ApiOperation)({
        summary: 'Atualizar token da api',
        description: 'Renova o token de acesso usando um refresh token válido',
        requestBody: {
            description: 'Refresh token para renovação',
            required: true,
            content: {
                'application/json': {
                    schema: {
                        $ref: '#/components/schemas/RefreshTokenInput',
                    },
                    examples: {
                        'refresh-token': {
                            summary: 'Renovação de Token',
                            description: 'Exemplo de renovação usando refresh token',
                            value: {
                                refreshToken: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c',
                            },
                        },
                    },
                },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({
        status: common_1.HttpStatus.OK,
        type: (0, base_api_response_dto_1.SwaggerBaseApiResponse)(auth_token_output_dto_1.AuthTokenOutput),
    }),
    (0, swagger_1.ApiResponse)({
        status: common_1.HttpStatus.UNAUTHORIZED,
        type: base_api_response_dto_1.BaseApiErrorResponse,
    }),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, common_1.UseGuards)(jwt_refresh_guard_1.JwtRefreshGuard),
    (0, common_1.UseInterceptors)(common_1.ClassSerializerInterceptor),
    __param(0, (0, req_context_decorator_1.ReqContext)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof request_context_dto_1.RequestContext !== "undefined" && request_context_dto_1.RequestContext) === "function" ? _f : Object, typeof (_g = typeof auth_refresh_token_input_dto_1.RefreshTokenInput !== "undefined" && auth_refresh_token_input_dto_1.RefreshTokenInput) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], AuthController.prototype, "refreshToken", null);
__decorate([
    (0, common_1.Get)('status'),
    (0, public_decorator_1.Public)(),
    (0, swagger_1.ApiOperation)({
        summary: 'Verificar status do serviço de autenticação',
    }),
    (0, swagger_1.ApiResponse)({
        status: common_1.HttpStatus.OK,
        schema: {
            type: 'object',
            properties: {
                status: { type: 'string', example: 'online' },
                message: {
                    type: 'string',
                    example: 'Serviço de autenticação está funcionando',
                },
                timestamp: {
                    type: 'string',
                    format: 'date-time',
                    example: '2023-01-01T00:00:00.000Z',
                },
            },
        },
    }),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Object)
], AuthController.prototype, "getStatus", null);
exports.AuthController = AuthController = AuthController_1 = __decorate([
    (0, swagger_1.ApiTags)('Autenticação'),
    (0, common_1.Controller)('auth'),
    __metadata("design:paramtypes", [typeof (_a = typeof auth_service_1.AuthService !== "undefined" && auth_service_1.AuthService) === "function" ? _a : Object, typeof (_b = typeof logger_service_1.AppLogger !== "undefined" && logger_service_1.AppLogger) === "function" ? _b : Object])
], AuthController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGF1dGhcXGNvbnRyb2xsZXJzXFxhdXRoLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FVd0I7QUFDeEIsNkNBQXFFO0FBRXJFLG1GQUlpRDtBQUNqRCx1RUFBK0Q7QUFDL0QsOEZBQWdGO0FBQ2hGLDBGQUFrRjtBQUNsRix1RUFBMEQ7QUFDMUQsdUZBQXlFO0FBQ3pFLHlFQUFnRTtBQUNoRSxtRUFBOEQ7QUFDOUQsaUVBQTREO0FBQzVELDJEQUF1RDtBQUN2RCxxRUFBd0Q7QUFJakQsSUFBTSxjQUFjLHNCQUFwQixNQUFNLGNBQWM7SUFFTjtJQUNBO0lBRm5CLFlBQ21CLFdBQXdCLEVBQ3hCLE1BQWlCO1FBRGpCLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQ3hCLFdBQU0sR0FBTixNQUFNLENBQVc7UUFFbEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsZ0JBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBd0RLLEFBQU4sS0FBSyxDQUFDLEtBQUssQ0FDSyxHQUFtQixFQUN6QixVQUFzQjtRQUU5QixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksYUFBYSxDQUFDLENBQUM7UUFFdEQsTUFBTSxTQUFTLEdBQUcsTUFBTSxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUVwRCwyQ0FBMkM7UUFDM0MsTUFBTSxRQUFRLEdBQUcsSUFBSSx1Q0FBZSxFQUFtQixDQUFDO1FBQ3hELFFBQVEsQ0FBQyxJQUFJLEdBQUcsU0FBUyxDQUFDO1FBQzFCLFFBQVEsQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBRW5CLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUF1Q0ssQUFBTixL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VSxDQUFDLEVBQUU7UUFDckIsTUFBTSxFQUFFO1lBQ04sSUFBSSxFQUFFLFFBQVE7WUFDZCxVQUFVLEVBQUU7Z0JBQ1YsTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFO2dCQUM3QyxPQUFPLEVBQUU7b0JBQ1AsSUFBSSxFQUFFLFFBQVE7b0JBQ2QsT0FBTyxFQUFFLDBDQUEwQztpQkFDcEQ7Z0JBQ0QsU0FBUyxFQUFFO29CQUNULElBQUksRUFBRSxRQUFRO29CQUNkLE1BQU0sRUFBRSxXQUFXO29CQUNuQixPQUFPLEVBQUUsMEJBQTBCO2lCQUNwQzthQUNGO1NBQ0Y7S0FDRixDQUFDO0lBQ0QsSUFBQSxpQkFBUSxFQUFDLG1CQUFVLENBQUMsRUFBRSxDQUFDOzs7OytDQU92Qjt5QkFqS1UsY0FBYztJQUYxQixJQUFBLGlCQUFPLEVBQUMsY0FBYyxDQUFDO0lBQ3ZCLElBQUEsbUJBQVUsRUFBQyxNQUFNLENBQUM7eURBR2UsMEJBQVcsb0JBQVgsMEJBQVcsb0RBQ2hCLDBCQUFTLG9CQUFULDBCQUFTO0dBSHpCLGNBQWMsQ0FrSzFCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxhdXRoXFxjb250cm9sbGVyc1xcYXV0aC5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEJvZHksXG4gIENsYXNzU2VyaWFsaXplckludGVyY2VwdG9yLFxuICBDb250cm9sbGVyLFxuICBHZXQsXG4gIEh0dHBDb2RlLFxuICBIdHRwU3RhdHVzLFxuICBQb3N0LFxuICBVc2VHdWFyZHMsXG4gIFVzZUludGVyY2VwdG9ycyxcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgQXBpT3BlcmF0aW9uLCBBcGlSZXNwb25zZSwgQXBpVGFncyB9IGZyb20gJ0BuZXN0anMvc3dhZ2dlcic7XG5cbmltcG9ydCB7XG4gIEJhc2VBcGlFcnJvclJlc3BvbnNlLFxuICBCYXNlQXBpUmVzcG9uc2UsXG4gIFN3YWdnZXJCYXNlQXBpUmVzcG9uc2UsXG59IGZyb20gJy4uLy4uL3NoYXJlZC9kdG9zL2Jhc2UtYXBpLXJlc3BvbnNlLmR0byc7XG5pbXBvcnQgeyBBcHBMb2dnZXIgfSBmcm9tICcuLi8uLi9zaGFyZWQvbG9nZ2VyL2xvZ2dlci5zZXJ2aWNlJztcbmltcG9ydCB7IFJlcUNvbnRleHQgfSBmcm9tICcuLi8uLi9zaGFyZWQvcmVxdWVzdC1jb250ZXh0L3JlcS1jb250ZXh0LmRlY29yYXRvcic7XG5pbXBvcnQgeyBSZXF1ZXN0Q29udGV4dCB9IGZyb20gJy4uLy4uL3NoYXJlZC9yZXF1ZXN0LWNvbnRleHQvcmVxdWVzdC1jb250ZXh0LmR0byc7XG5pbXBvcnQgeyBMb2dpbklucHV0IH0gZnJvbSAnLi4vZHRvcy9hdXRoLWxvZ2luLWlucHV0LmR0byc7XG5pbXBvcnQgeyBSZWZyZXNoVG9rZW5JbnB1dCB9IGZyb20gJy4uL2R0b3MvYXV0aC1yZWZyZXNoLXRva2VuLWlucHV0LmR0byc7XG5pbXBvcnQgeyBBdXRoVG9rZW5PdXRwdXQgfSBmcm9tICcuLi9kdG9zL2F1dGgtdG9rZW4tb3V0cHV0LmR0byc7XG5pbXBvcnQgeyBKd3RSZWZyZXNoR3VhcmQgfSBmcm9tICcuLi9ndWFyZHMvand0LXJlZnJlc2guZ3VhcmQnO1xuaW1wb3J0IHsgTG9jYWxBdXRoR3VhcmQgfSBmcm9tICcuLi9ndWFyZHMvbG9jYWwtYXV0aC5ndWFyZCc7XG5pbXBvcnQgeyBBdXRoU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2F1dGguc2VydmljZSc7XG5pbXBvcnQgeyBQdWJsaWMgfSBmcm9tICcuLi9kZWNvcmF0b3JzL3B1YmxpYy5kZWNvcmF0b3InO1xuXG5AQXBpVGFncygnQXV0ZW50aWNhw6fDo28nKVxuQENvbnRyb2xsZXIoJ2F1dGgnKVxuZXhwb3J0IGNsYXNzIEF1dGhDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBhdXRoU2VydmljZTogQXV0aFNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXI6IEFwcExvZ2dlcixcbiAgKSB7XG4gICAgdGhpcy5sb2dnZXIuc2V0Q29udGV4dChBdXRoQ29udHJvbGxlci5uYW1lKTtcbiAgfVxuICBAUG9zdCgnbG9naW4nKVxuICBAUHVibGljKClcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0ZhemVyIGxvZ2luJyxcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgICdBdXRlbnRpY2EgdW0gdXN1w6FyaW8gbm8gc2lzdGVtYSB1c2FuZG8gY3JlZGVuY2lhaXMgKHVzZXJuYW1lL3Bhc3N3b3JkKScsXG4gICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiAnQ3JlZGVuY2lhaXMgZGUgbG9naW4nLFxuICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICBjb250ZW50OiB7XG4gICAgICAgICdhcHBsaWNhdGlvbi9qc29uJzoge1xuICAgICAgICAgIHNjaGVtYToge1xuICAgICAgICAgICAgJHJlZjogJyMvY29tcG9uZW50cy9zY2hlbWFzL0xvZ2luSW5wdXQnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXhhbXBsZXM6IHtcbiAgICAgICAgICAgICd1c3VhcmlvLWFkbWluJzoge1xuICAgICAgICAgICAgICBzdW1tYXJ5OiAnTG9naW4gZGUgQWRtaW5pc3RyYWRvcicsXG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRXhlbXBsbyBkZSBsb2dpbiBwYXJhIHVzdcOhcmlvIGFkbWluaXN0cmFkb3InLFxuICAgICAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiAnYWRtaW5Ac2VtdGFzLmdvdi5icicsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICdzZW5oYTEyMycsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ3VzdWFyaW8tYXNzaXN0ZW50ZSc6IHtcbiAgICAgICAgICAgICAgc3VtbWFyeTogJ0xvZ2luIGRlIEFzc2lzdGVudGUgU29jaWFsJyxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdFeGVtcGxvIGRlIGxvZ2luIHBhcmEgYXNzaXN0ZW50ZSBzb2NpYWwnLFxuICAgICAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiAnbWFyaWEuc2lsdmFAc2VtdGFzLmdvdi5icicsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICdtaW5oYXNlbmhhNDU2JyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAndXN1YXJpby1jb29yZGVuYWRvcic6IHtcbiAgICAgICAgICAgICAgc3VtbWFyeTogJ0xvZ2luIGRlIENvb3JkZW5hZG9yJyxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdFeGVtcGxvIGRlIGxvZ2luIHBhcmEgY29vcmRlbmFkb3IgZGUgdW5pZGFkZScsXG4gICAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6ICdqb2FvLnNhbnRvc0BzZW10YXMuZ292LmJyJyxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogJ2Nvb3JkZW5hZG9yNzg5JyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IEh0dHBTdGF0dXMuT0ssXG4gICAgdHlwZTogU3dhZ2dlckJhc2VBcGlSZXNwb25zZShBdXRoVG9rZW5PdXRwdXQpLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogSHR0cFN0YXR1cy5VTkFVVEhPUklaRUQsXG4gICAgdHlwZTogQmFzZUFwaUVycm9yUmVzcG9uc2UsXG4gIH0pXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk9LKVxuICBAVXNlR3VhcmRzKExvY2FsQXV0aEd1YXJkKVxuICBAVXNlSW50ZXJjZXB0b3JzKENsYXNzU2VyaWFsaXplckludGVyY2VwdG9yKVxuICBhc3luYyBsb2dpbihcbiAgICBAUmVxQ29udGV4dCgpIGN0eDogUmVxdWVzdENvbnRleHQsXG4gICAgQEJvZHkoKSBjcmVkZW50aWFsOiBMb2dpbklucHV0LFxuICApOiBQcm9taXNlPEJhc2VBcGlSZXNwb25zZTxBdXRoVG9rZW5PdXRwdXQ+PiB7XG4gICAgdGhpcy5sb2dnZXIubG9nKGN0eCwgYCR7dGhpcy5sb2dpbi5uYW1lfSB3YXMgY2FsbGVkYCk7XG5cbiAgICBjb25zdCBhdXRoVG9rZW4gPSBhd2FpdCB0aGlzLmF1dGhTZXJ2aWNlLmxvZ2luKGN0eCk7XG5cbiAgICAvLyBDb252ZXJ0ZXIgcGFyYSBvIGZvcm1hdG8gQmFzZUFwaVJlc3BvbnNlXG4gICAgY29uc3QgcmVzcG9uc2UgPSBuZXcgQmFzZUFwaVJlc3BvbnNlPEF1dGhUb2tlbk91dHB1dD4oKTtcbiAgICByZXNwb25zZS5kYXRhID0gYXV0aFRva2VuO1xuICAgIHJlc3BvbnNlLm1ldGEgPSB7fTtcblxuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuXG4gIEBQb3N0KCdyZWZyZXNoLXRva2VuJylcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0F0dWFsaXphciB0b2tlbiBkYSBhcGknLFxuICAgIGRlc2NyaXB0aW9uOiAnUmVub3ZhIG8gdG9rZW4gZGUgYWNlc3NvIHVzYW5kbyB1bSByZWZyZXNoIHRva2VuIHbDoWxpZG8nLFxuICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICBkZXNjcmlwdGlvbjogJ1JlZnJlc2ggdG9rZW4gcGFyYSByZW5vdmHDp8OjbycsXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgJ2FwcGxpY2F0aW9uL2pzb24nOiB7XG4gICAgICAgICAgc2NoZW1hOiB7XG4gICAgICAgICAgICAkcmVmOiAnIy9jb21wb25lbnRzL3NjaGVtYXMvUmVmcmVzaFRva2VuSW5wdXQnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXhhbXBsZXM6IHtcbiAgICAgICAgICAgICdyZWZyZXNoLXRva2VuJzoge1xuICAgICAgICAgICAgICBzdW1tYXJ5OiAnUmVub3Zhw6fDo28gZGUgVG9rZW4nLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0V4ZW1wbG8gZGUgcmVub3Zhw6fDo28gdXNhbmRvIHJlZnJlc2ggdG9rZW4nLFxuICAgICAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgICAgIHJlZnJlc2hUb2tlbjpcbiAgICAgICAgICAgICAgICAgICdleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKemRXSWlPaUl4TWpNME5UWTNPRGt3SWl3aWJtRnRaU0k2SWtwdmFHNGdSRzlsSWl3aWFXRjBJam94TlRFMk1qTTVNREl5ZlEuU2ZsS3h3UkpTTWVLS0YyUVQ0ZndwTWVKZjM2UE9rNnlKVl9hZFFzc3c1YycsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiBIdHRwU3RhdHVzLk9LLFxuICAgIHR5cGU6IFN3YWdnZXJCYXNlQXBpUmVzcG9uc2UoQXV0aFRva2VuT3V0cHV0KSxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IEh0dHBTdGF0dXMuVU5BVVRIT1JJWkVELFxuICAgIHR5cGU6IEJhc2VBcGlFcnJvclJlc3BvbnNlLFxuICB9KVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgQFVzZUd1YXJkcyhKd3RSZWZyZXNoR3VhcmQpXG4gIEBVc2VJbnRlcmNlcHRvcnMoQ2xhc3NTZXJpYWxpemVySW50ZXJjZXB0b3IpXG4gIGFzeW5jIHJlZnJlc2hUb2tlbihcbiAgICBAUmVxQ29udGV4dCgpIGN0eDogUmVxdWVzdENvbnRleHQsXG4gICAgQEJvZHkoKSBjcmVkZW50aWFsOiBSZWZyZXNoVG9rZW5JbnB1dCxcbiAgKTogUHJvbWlzZTxCYXNlQXBpUmVzcG9uc2U8QXV0aFRva2VuT3V0cHV0Pj4ge1xuICAgIHRoaXMubG9nZ2VyLmxvZyhjdHgsIGAke3RoaXMucmVmcmVzaFRva2VuLm5hbWV9IHdhcyBjYWxsZWRgKTtcblxuICAgIGNvbnN0IGF1dGhUb2tlbiA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UucmVmcmVzaFRva2VuKGN0eCwgY3JlZGVudGlhbCk7XG5cbiAgICAvLyBDb252ZXJ0ZXIgcGFyYSBvIGZvcm1hdG8gQmFzZUFwaVJlc3BvbnNlXG4gICAgY29uc3QgcmVzcG9uc2UgPSBuZXcgQmFzZUFwaVJlc3BvbnNlPEF1dGhUb2tlbk91dHB1dD4oKTtcbiAgICByZXNwb25zZS5kYXRhID0gYXV0aFRva2VuO1xuICAgIHJlc3BvbnNlLm1ldGEgPSB7fTtcblxuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuXG4gIEBHZXQoJ3N0YXR1cycpXG4gIEBQdWJsaWMoKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnVmVyaWZpY2FyIHN0YXR1cyBkbyBzZXJ2acOnbyBkZSBhdXRlbnRpY2HDp8OjbycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiBIdHRwU3RhdHVzLk9LLFxuICAgIHNjaGVtYToge1xuICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHN0YXR1czogeyB0eXBlOiAnc3RyaW5nJywgZXhhbXBsZTogJ29ubGluZScgfSxcbiAgICAgICAgbWVzc2FnZToge1xuICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgIGV4YW1wbGU6ICdTZXJ2acOnbyBkZSBhdXRlbnRpY2HDp8OjbyBlc3TDoSBmdW5jaW9uYW5kbycsXG4gICAgICAgIH0sXG4gICAgICAgIHRpbWVzdGFtcDoge1xuICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgIGZvcm1hdDogJ2RhdGUtdGltZScsXG4gICAgICAgICAgZXhhbXBsZTogJzIwMjMtMDEtMDFUMDA6MDA6MDAuMDAwWicsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk9LKVxuICBnZXRTdGF0dXMoKTogeyBzdGF0dXM6IHN0cmluZzsgbWVzc2FnZTogc3RyaW5nOyB0aW1lc3RhbXA6IHN0cmluZyB9IHtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhdHVzOiAnb25saW5lJyxcbiAgICAgIG1lc3NhZ2U6ICdTZXJ2acOnbyBkZSBhdXRlbnRpY2HDp8OjbyBlc3TDoSBmdW5jaW9uYW5kbycsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9O1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=