c75208a22fb76bd09fd1cf807da5cff6
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var AuditoriaExportacaoService_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuditoriaExportacaoService = exports.FormatoExportacao = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const log_auditoria_entity_1 = require("../../../entities/log-auditoria.entity");
const config_1 = require("@nestjs/config");
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const zlib = __importStar(require("zlib"));
const sanitize_filename_1 = __importDefault(require("sanitize-filename"));
/**
 * Formatos de exportação suportados para os logs de auditoria - Versão MVP
 *
 * @enum {string}
 * @property {string} JSON - Formato JSON (JavaScript Object Notation)
 * @property {string} CSV - Formato CSV (Comma-Separated Values)
 * @note Formatos Excel e PDF foram adiados para versões futuras do sistema
 */
var FormatoExportacao;
(function (FormatoExportacao) {
    /** Formato JSON (JavaScript Object Notation) */
    FormatoExportacao["JSON"] = "json";
    /** Formato CSV (Comma-Separated Values) */
    FormatoExportacao["CSV"] = "csv";
})(FormatoExportacao || (exports.FormatoExportacao = FormatoExportacao = {}));
/**
 * Serviço responsável por exportar logs de auditoria - Versão MVP
 *
 * Implementação simplificada para MVP com suporte apenas a formatos essenciais (JSON, CSV).
 * Formatos avançados (Excel, PDF) e funcionalidades complexas foram adiados para versões futuras.
 */
let AuditoriaExportacaoService = AuditoriaExportacaoService_1 = class AuditoriaExportacaoService {
    logAuditoriaRepository;
    configService;
    /** Logger para registro de eventos do serviço */
    logger = new common_1.Logger(AuditoriaExportacaoService_1.name);
    /** Diretório base para armazenar os arquivos exportados */
    diretorioExportacao;
    /** Tamanho máximo de registros para exportação em lote */
    MAX_REGISTROS_POR_LOTE;
    /** Tamanho máximo de arquivo permitido em bytes */
    TAMANHO_MAXIMO_ARQUIVO;
    /** Timeout para operações de exportação */
    TIMEOUT_EXPORTACAO = 5 * 60 * 1000; // 5 minutos
    constructor(logAuditoriaRepository, configService) {
        this.logAuditoriaRepository = logAuditoriaRepository;
        this.configService = configService;
        // Configurar limites
        this.MAX_REGISTROS_POR_LOTE = Math.min(Math.max(1, Number(this.configService.get('AUDITORIA_MAX_EXPORT_RECORDS') ||
            10000)), 50000);
        // Configurar tamanho máximo do arquivo (em MB, padrão 100MB)
        this.TAMANHO_MAXIMO_ARQUIVO =
            Math.min(Math.max(1, Number(this.configService.get('AUDITORIA_MAX_FILE_SIZE_MB') || 100)), 500) *
                1024 *
                1024; // Converter para bytes
        // Configurar diretório de exportação
        const exportDir = this.configService.get('AUDITORIA_EXPORT_DIR');
        this.diretorioExportacao =
            exportDir || path.join(process.cwd(), 'exports', 'auditoria');
        // Garantir que o diretório existe
        if (!fs.existsSync(this.diretorioExportacao)) {
            fs.mkdirSync(this.diretorioExportacao, { recursive: true });
            this.logger.log(`Diretório de exportação criado: ${this.diretorioExportacao}`);
        }
    }
    /**
     * Exporta logs de auditoria com base nos filtros fornecidos - Versão MVP
     *
     * @param filtros - Critérios de filtragem para os logs
     * @param opcoes - Configurações para a exportação (apenas JSON e CSV no MVP)
     * @returns Informações sobre o arquivo gerado
     * @throws {Error} Quando ocorre um erro durante a exportação
     */
    async exportarLogs(filtros, opcoes) {
        const exportId = Math.random().toString(36).substring(2, 10);
        this.logger.log(`[${exportId}] Iniciando exportação de logs no formato ${opcoes.formato}`);
        // Verificar se o formato solicitado é suportado no MVP
        if (opcoes.formato !== FormatoExportacao.JSON &&
            opcoes.formato !== FormatoExportacao.CSV) {
            throw new Error(`Formato ${opcoes.formato} não suportado no MVP. Use apenas JSON ou CSV.`);
        }
        // Validar opções de exportação
        this.validarOpcoesExportacao(opcoes);
        // Buscar logs para exportação
        const logs = await this.buscarLogsParaExportacao(filtros);
        if (logs.length === 0) {
            throw new Error('Nenhum log encontrado para os critérios fornecidos');
        }
        if (logs.length > this.MAX_REGISTROS_POR_LOTE) {
            this.logger.warn(`Limite de registros excedido: ${logs.length}. A exportação será limitada a ${this.MAX_REGISTROS_POR_LOTE} registros.`);
        }
        // Processar campos conforme solicitação
        const registros = this.processarCampos(logs.slice(0, this.MAX_REGISTROS_POR_LOTE), opcoes.campos);
        // Gerar nome do arquivo
        const nomeArquivo = opcoes.nomeArquivo
            ? (0, sanitize_filename_1.default)(opcoes.nomeArquivo)
            : this.gerarNomeArquivo(opcoes);
        // Definir caminho do arquivo
        const dirBase = opcoes.caminho || this.diretorioExportacao;
        const caminho = path.resolve(dirBase, nomeArquivo);
        // Validar caminho do arquivo
        const caminhoArquivo = this.validarCaminhoArquivo(caminho);
        // Exportar no formato solicitado (apenas JSON ou CSV no MVP)
        let tamanhoArquivo = 0;
        const startTime = Date.now();
        try {
            switch (opcoes.formato) {
                case FormatoExportacao.JSON:
                    tamanhoArquivo = await this.exportarJSON(registros, caminhoArquivo, opcoes.comprimido);
                    break;
                case FormatoExportacao.CSV:
                    tamanhoArquivo = await this.exportarCSV(registros, caminhoArquivo, opcoes.comprimido);
                    break;
                default:
                    throw new Error(`Formato de exportação não suportado: ${opcoes.formato}`);
            }
            const duration = Date.now() - startTime;
            this.logger.log(`Exportação concluída em ${duration}ms: ${registros.length} registros, ${tamanhoArquivo} bytes`);
            return {
                caminhoArquivo,
                registrosExportados: registros.length,
                tamanhoArquivo,
                dataHora: new Date(),
                formato: opcoes.formato,
            };
        }
        catch (error) {
            // Tentar limpar arquivo em caso de erro
            try {
                if (fs.existsSync(caminhoArquivo)) {
                    fs.unlinkSync(caminhoArquivo);
                    this.logger.debug(`Arquivo temporário removido: ${caminhoArquivo}`);
                }
            }
            catch (cleanupError) {
                this.logger.error(`Erro ao limpar arquivo após falha: ${cleanupError instanceof Error ? cleanupError.message : 'Erro desconhecido'}`);
            }
            throw error;
        }
    }
    /**
     * Busca logs de auditoria com base nos filtros fornecidos
     *
     * @param filtros - Critérios de filtragem para a consulta
     * @returns Lista de logs de auditoria que atendem aos critérios
     * @private
     */
    async buscarLogsParaExportacao(filtros) {
        const whereClause = {};
        // Filtrar por tipo de operação
        if (filtros.tipo_operacao) {
            whereClause.tipo_operacao = filtros.tipo_operacao;
        }
        // Filtrar por entidade afetada
        if (filtros.entidade_afetada) {
            whereClause.entidade_afetada = (0, typeorm_2.ILike)(`%${filtros.entidade_afetada}%`);
        }
        // Filtrar por ID da entidade
        if (filtros.entidade_id) {
            whereClause.entidade_id = filtros.entidade_id;
        }
        // Filtrar por ID do usuário
        if (filtros.usuario_id) {
            whereClause.usuario_id = filtros.usuario_id;
        }
        // Filtrar por período de data
        if (filtros.data_inicial) {
            const dataInicial = new Date(filtros.data_inicial);
            if (filtros.data_final) {
                const dataFinal = new Date(filtros.data_final);
                dataFinal.setHours(23, 59, 59, 999); // Ajustar para o fim do dia
                whereClause.created_at = (0, typeorm_2.Between)(dataInicial, dataFinal);
            }
            else {
                // Se não tiver data final, usar apenas a data inicial
                const fimDoDia = new Date(dataInicial);
                fimDoDia.setHours(23, 59, 59, 999); // Ajustar para o fim do dia
                whereClause.created_at = (0, typeorm_2.Between)(dataInicial, fimDoDia);
            }
        }
        else if (filtros.data_final) {
            // Se tiver apenas data final, buscar tudo até essa data
            const dataFinal = new Date(filtros.data_final);
            dataFinal.setHours(23, 59, 59, 999); // Ajustar para o fim do dia
            whereClause.created_at = (0, typeorm_2.Between)(new Date(0), dataFinal);
        }
        // Filtrar por método HTTP
        if (filtros.metodo_http) {
            whereClause.metodo_http = filtros.metodo_http;
        }
        // Filtrar por endpoint
        if (filtros.endpoint) {
            whereClause.endpoint = (0, typeorm_2.ILike)(`%${filtros.endpoint}%`);
        }
        // Executar consulta com parâmetros de paginação e ordenação
        return await this.logAuditoriaRepository.find({
            where: whereClause,
            order: {
                created_at: 'DESC',
            },
            take: this.MAX_REGISTROS_POR_LOTE,
        });
    }
    /**
     * Processa e filtra campos dos logs de auditoria
     *
     * @param logs - Lista de logs a processar
     * @param campos - Lista opcional de campos a incluir
     * @returns Array de objetos com os campos processados
     * @private
     */
    processarCampos(logs, campos) {
        return logs.map((log) => {
            const resultado = {};
            // Determine quais campos incluir
            const camposParaIncluir = campos?.length ? campos : Object.keys(log);
            // Adicionar campos no resultado
            for (const campo of camposParaIncluir) {
                if (campo in log) {
                    resultado[campo] = log[campo];
                }
            }
            return resultado;
        });
    }
    /**
     * Valida as opções de exportação
     *
     * @param opcoes - Opções de exportação a validar
     * @throws {Error} Se as opções forem inválidas
     * @private
     */
    validarOpcoesExportacao(opcoes) {
        // Verificar se o formato é suportado
        if (!Object.values(FormatoExportacao).includes(opcoes.formato)) {
            throw new Error(`Formato de exportação inválido: ${opcoes.formato}`);
        }
        // Verificar caminho personalizado
        if (opcoes.caminho && !fs.existsSync(opcoes.caminho)) {
            throw new Error(`Caminho de destino não encontrado: ${opcoes.caminho}`);
        }
        // Validar nome de arquivo
        if (opcoes.nomeArquivo) {
            const sanitizedName = (0, sanitize_filename_1.default)(opcoes.nomeArquivo);
            if (sanitizedName !== opcoes.nomeArquivo) {
                this.logger.warn(`Nome de arquivo sanitizado: ${opcoes.nomeArquivo} -> ${sanitizedName}`);
            }
        }
    }
    /**
     * Gera um nome de arquivo seguro para exportação
     *
     * @param opcoes - Opções de exportação
     * @returns Nome de arquivo gerado
     * @private
     */
    gerarNomeArquivo(opcoes) {
        // Se um nome for fornecido, sanitizar e usar
        if (opcoes.nomeArquivo) {
            const nomeBase = (0, sanitize_filename_1.default)(opcoes.nomeArquivo);
            return `${nomeBase}.${opcoes.formato}${opcoes.comprimido ? '.gz' : ''}`;
        }
        // Gerar nome padrão com timestamp
        const dataAtual = new Date();
        const timestamp = dataAtual
            .toISOString()
            .replace(/[:.]/g, '-')
            .replace('T', '_')
            .split('Z')[0];
        return `auditoria_${timestamp}.${opcoes.formato}${opcoes.comprimido ? '.gz' : ''}`;
    }
    /**
     * Valida caminho do arquivo para garantir segurança
     *
     * @param caminhoArquivo - Caminho a validar
     * @returns Caminho validado
     * @throws {Error} Se o caminho for inválido ou inseguro
     * @private
     */
    validarCaminhoArquivo(caminhoArquivo) {
        // Verificar se o caminho é absoluto
        if (!path.isAbsolute(caminhoArquivo)) {
            throw new Error('Caminho do arquivo deve ser absoluto');
        }
        // Normalizar caminho para evitar path traversal
        const caminhoNormalizado = path.normalize(caminhoArquivo);
        // Verificar se está dentro de um diretório permitido (diretório de exportação ou personalizado)
        const isDentroDoPermitido = caminhoNormalizado.startsWith(this.diretorioExportacao);
        if (!isDentroDoPermitido) {
            throw new Error('Caminho do arquivo inválido');
        }
        // Verificar se o diretório de destino existe
        const diretorio = path.dirname(caminhoNormalizado);
        if (!fs.existsSync(diretorio)) {
            fs.mkdirSync(diretorio, { recursive: true });
        }
        return caminhoNormalizado;
    }
    /**
     * Sanitiza dados para exportação
     *
     * @param dados - Array de dados a sanitizar
     * @returns Array sanitizado
     * @private
     */
    sanitizarDadosParaExportacao(dados) {
        if (!Array.isArray(dados)) {
            this.logger.warn('Dados fornecidos não são um array. Retornando array vazio.');
            return [];
        }
        try {
            return dados.map((item) => {
                if (!item || typeof item !== 'object') {
                    return {};
                }
                const resultado = {};
                // Lista de campos que devem preservar sua estrutura original
                const camposEstruturados = [
                    'dados_anteriores',
                    'dados_novos',
                    'dados_sensiveis_acessados',
                ];
                // Processar cada campo
                Object.entries(item).forEach(([chave, valor]) => {
                    // Preservar estrutura para campos específicos que contêm objetos ou arrays
                    if (camposEstruturados.includes(chave) &&
                        valor !== null &&
                        typeof valor === 'object') {
                        resultado[chave] = valor;
                        return;
                    }
                    // Processamento normal para outros tipos de dados
                    if (typeof valor === 'string') {
                        // Sanitizar strings para evitar injeção
                        resultado[chave] = valor
                            .replace(/[\x00-\x1F\x7F-\x9F\uFFFD]/g, '')
                            .replace(/[\u200B-\u200D\uFEFF]/g, '');
                    }
                    else if (valor instanceof Date) {
                        // Converter datas para formato ISO
                        resultado[chave] = valor.toISOString();
                    }
                    else if (valor === null ||
                        valor === undefined ||
                        typeof valor === 'number' ||
                        typeof valor === 'boolean') {
                        // Manter tipos primitivos
                        resultado[chave] = valor;
                    }
                    else if (typeof valor === 'object') {
                        // Para objetos complexos que não estão na lista de exceções
                        try {
                            // Tentativa de preservar a estrutura do objeto
                            if (Array.isArray(valor)) {
                                resultado[chave] = valor;
                            }
                            else {
                                resultado[chave] = valor;
                            }
                        }
                        catch {
                            resultado[chave] = '[Objeto complexo]';
                        }
                    }
                    else {
                        // Para outros tipos, converter para string
                        resultado[chave] = String(valor);
                    }
                });
                return resultado;
            });
        }
        catch (error) {
            this.logger.error(`Erro ao sanitizar dados: ${error instanceof Error ? error.message : 'Erro desconhecido'}`);
            return [];
        }
    }
    /**
     * Exporta logs para formato JSON
     *
     * @param logs - Dados a exportar
     * @param caminhoArquivo - Caminho do arquivo de destino
     * @param comprimido - Se o arquivo deve ser compactado
     * @returns Tamanho do arquivo em bytes
     * @private
     */
    async exportarJSON(logs, caminhoArquivo, comprimido) {
        // Sanitizar dados
        const dadosSanitizados = this.sanitizarDadosParaExportacao(logs);
        // Verificar se há dados para exportar
        if (dadosSanitizados.length === 0) {
            this.logger.warn('Nenhum dado válido para exportar para JSON');
            return 0;
        }
        try {
            // Converter para JSON formatado
            const jsonContent = JSON.stringify(dadosSanitizados, null, 2);
            if (comprimido) {
                // Exportar compactado
                await new Promise((resolve, reject) => {
                    const gzip = zlib.createGzip();
                    const output = fs.createWriteStream(caminhoArquivo);
                    output.on('finish', resolve);
                    output.on('error', reject);
                    gzip.pipe(output);
                    gzip.write(jsonContent);
                    gzip.end();
                });
            }
            else {
                // Exportar sem compressão
                await fs.promises.writeFile(caminhoArquivo, jsonContent, 'utf8');
            }
            // Obter tamanho do arquivo
            const stats = fs.statSync(caminhoArquivo);
            return stats.size;
        }
        catch (error) {
            this.logger.error(`Erro ao exportar para JSON: ${error instanceof Error ? error.message : 'Erro desconhecido'}`);
            throw new Error(`Falha ao exportar para JSON: ${error instanceof Error ? error.message : 'Erro desconhecido'}`);
        }
    }
    /**
     * Escapa valor para CSV
     *
     * @param valor - Valor a escapar
     * @returns Valor escapado
     * @private
     */
    escaparValorCSV(valor) {
        if (valor === null || valor === undefined) {
            return '';
        }
        // Tratar objetos ou arrays para serialização correta
        if (typeof valor === 'object' && valor !== null) {
            // Para datas, usar formato ISO
            if (valor instanceof Date) {
                return this.escaparValorCSV(valor.toISOString());
            }
            // Para arrays e objetos, converter para JSON formatado
            try {
                const jsonStr = JSON.stringify(valor);
                return this.escaparValorCSV(jsonStr);
            }
            catch {
                return this.escaparValorCSV('[Objeto complexo]');
            }
        }
        const str = String(valor);
        // Escapar aspas duplicando-as e colocar entre aspas se contiver caracteres especiais
        if (str.includes('"') || str.includes(',') || str.includes('\n')) {
            return `"${str.replace(/"/g, '""')}"`;
        }
        return str;
    }
    /**
     * Exporta logs para formato CSV
     *
     * @param logs - Dados a exportar
     * @param caminhoArquivo - Caminho do arquivo de destino
     * @param comprimido - Se o arquivo deve ser compactado
     * @returns Tamanho do arquivo em bytes
     * @private
     */
    async exportarCSV(logs, caminhoArquivo, comprimido) {
        // Sanitizar dados
        const dadosSanitizados = this.sanitizarDadosParaExportacao(logs);
        // Verificar se há dados para exportar
        if (dadosSanitizados.length === 0) {
            this.logger.warn('Nenhum dado válido para exportar para CSV');
            return 0;
        }
        try {
            // Obter cabeçalhos (todas as chaves únicas presentes nos objetos)
            const headers = Array.from(new Set(dadosSanitizados.flatMap((obj) => Object.keys(obj))));
            // Criar linha de cabeçalho
            const headerRow = headers.map(this.escaparValorCSV).join(',');
            // Criar linhas de dados
            const dataRows = dadosSanitizados.map((item) => {
                return headers
                    .map((header) => {
                    return this.escaparValorCSV(item[header]);
                })
                    .join(',');
            });
            // Compor conteúdo CSV
            const csvContent = [headerRow, ...dataRows].join('\n');
            if (comprimido) {
                // Exportar compactado
                await new Promise((resolve, reject) => {
                    const gzip = zlib.createGzip();
                    const output = fs.createWriteStream(caminhoArquivo);
                    output.on('finish', resolve);
                    output.on('error', reject);
                    gzip.pipe(output);
                    gzip.write(csvContent);
                    gzip.end();
                });
            }
            else {
                // Exportar sem compressão
                await fs.promises.writeFile(caminhoArquivo, csvContent, 'utf8');
            }
            // Obter tamanho do arquivo
            const stats = fs.statSync(caminhoArquivo);
            return stats.size;
        }
        catch (error) {
            this.logger.error(`Erro ao exportar para CSV: ${error instanceof Error ? error.message : 'Erro desconhecido'}`);
            throw new Error(`Falha ao exportar para CSV: ${error instanceof Error ? error.message : 'Erro desconhecido'}`);
        }
    }
};
exports.AuditoriaExportacaoService = AuditoriaExportacaoService;
exports.AuditoriaExportacaoService = AuditoriaExportacaoService = AuditoriaExportacaoService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(log_auditoria_entity_1.LogAuditoria)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object, typeof (_b = typeof config_1.ConfigService !== "undefined" && config_1.ConfigService) === "function" ? _b : Object])
], AuditoriaExportacaoService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGF1ZGl0b3JpYVxcc2VydmljZXNcXGF1ZGl0b3JpYS1leHBvcnRhY2FvLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBb0Q7QUFDcEQsNkNBQW1EO0FBQ25ELHFDQUFxRDtBQUNyRCxpRkFBc0U7QUFFdEUsMkNBQStDO0FBQy9DLHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUFDN0IsMkNBQTZCO0FBQzdCLDBFQUFpRDtBQUVqRDs7Ozs7OztHQU9HO0FBQ0gsSUFBWSxpQkFLWDtBQUxELFdBQVksaUJBQWlCO0lBQzNCLGdEQUFnRDtJQUNoRCxrQ0FBYSxDQUFBO0lBQ2IsMkNBQTJDO0lBQzNDLGdDQUFXLENBQUE7QUFDYixDQUFDLEVBTFcsaUJBQWlCLGlDQUFqQixpQkFBaUIsUUFLNUI7QUF5REQ7Ozs7O0dBS0c7QUFFSSxJQUFNLDBCQUEwQixrQ0FBaEMsTUFBTSwwQkFBMEI7SUFrQmxCO0lBQ0E7SUFsQm5CLGlEQUFpRDtJQUNoQyxNQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsNEJBQTBCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFdEUsMkRBQTJEO0lBQzFDLG1CQUFtQixDQUFTO0lBRTdDLDBEQUEwRDtJQUN6QyxzQkFBc0IsQ0FBUztJQUVoRCxtREFBbUQ7SUFDbEMsc0JBQXNCLENBQVM7SUFFaEQsMkNBQTJDO0lBQzFCLGtCQUFrQixHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUMsWUFBWTtJQUVqRSxZQUVtQixzQkFBZ0QsRUFDaEQsYUFBNEI7UUFENUIsMkJBQXNCLEdBQXRCLHNCQUFzQixDQUEwQjtRQUNoRCxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUU3QyxxQkFBcUI7UUFDckIsSUFBSSxDQUFDLHNCQUFz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QzdGLENBQUM7WUFDRixNQUFNLElBQUksS0FBSyxDQUNiLCtCQUErQixLQUFLLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxtQkFBbUIsRUFBRSxDQUM5RixDQUFDO1FBQ0osQ0FBQztJQUNILENBQUM7Q0FDRixDQUFBO0FBeG5CWSxnRUFBMEI7cUNBQTFCLDBCQUEwQjtJQUR0QyxJQUFBLG1CQUFVLEdBQUU7SUFrQlIsV0FBQSxJQUFBLDBCQUFnQixFQUFDLG1DQUFZLENBQUMsQ0FBQTt5REFDVSxvQkFBVSxvQkFBVixvQkFBVSxvREFDbkIsc0JBQWEsb0JBQWIsc0JBQWE7R0FuQnBDLDBCQUEwQixDQXduQnRDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxtb2R1bGVzXFxhdWRpdG9yaWFcXHNlcnZpY2VzXFxhdWRpdG9yaWEtZXhwb3J0YWNhby5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIExvZ2dlciB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IEluamVjdFJlcG9zaXRvcnkgfSBmcm9tICdAbmVzdGpzL3R5cGVvcm0nO1xuaW1wb3J0IHsgUmVwb3NpdG9yeSwgQmV0d2VlbiwgSUxpa2UgfSBmcm9tICd0eXBlb3JtJztcbmltcG9ydCB7IExvZ0F1ZGl0b3JpYSB9IGZyb20gJy4uLy4uLy4uL2VudGl0aWVzL2xvZy1hdWRpdG9yaWEuZW50aXR5JztcbmltcG9ydCB7IFF1ZXJ5TG9nQXVkaXRvcmlhRHRvIH0gZnJvbSAnLi4vZHRvL3F1ZXJ5LWxvZy1hdWRpdG9yaWEuZHRvJztcbmltcG9ydCB7IENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZyc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0ICogYXMgemxpYiBmcm9tICd6bGliJztcbmltcG9ydCBzYW5pdGl6ZUZpbGVuYW1lIGZyb20gJ3Nhbml0aXplLWZpbGVuYW1lJztcblxuLyoqXG4gKiBGb3JtYXRvcyBkZSBleHBvcnRhw6fDo28gc3Vwb3J0YWRvcyBwYXJhIG9zIGxvZ3MgZGUgYXVkaXRvcmlhIC0gVmVyc8OjbyBNVlBcbiAqXG4gKiBAZW51bSB7c3RyaW5nfVxuICogQHByb3BlcnR5IHtzdHJpbmd9IEpTT04gLSBGb3JtYXRvIEpTT04gKEphdmFTY3JpcHQgT2JqZWN0IE5vdGF0aW9uKVxuICogQHByb3BlcnR5IHtzdHJpbmd9IENTViAtIEZvcm1hdG8gQ1NWIChDb21tYS1TZXBhcmF0ZWQgVmFsdWVzKVxuICogQG5vdGUgRm9ybWF0b3MgRXhjZWwgZSBQREYgZm9yYW0gYWRpYWRvcyBwYXJhIHZlcnPDtWVzIGZ1dHVyYXMgZG8gc2lzdGVtYVxuICovXG5leHBvcnQgZW51bSBGb3JtYXRvRXhwb3J0YWNhbyB7XG4gIC8qKiBGb3JtYXRvIEpTT04gKEphdmFTY3JpcHQgT2JqZWN0IE5vdGF0aW9uKSAqL1xuICBKU09OID0gJ2pzb24nLFxuICAvKiogRm9ybWF0byBDU1YgKENvbW1hLVNlcGFyYXRlZCBWYWx1ZXMpICovXG4gIENTViA9ICdjc3YnLFxufVxuXG4vKipcbiAqIE9ww6fDtWVzIGRlIGV4cG9ydGHDp8OjbyBwYXJhIG9zIGxvZ3MgZGUgYXVkaXRvcmlhIC0gVmVyc8OjbyBNVlBcbiAqXG4gKiBDb25maWd1cmHDp8O1ZXMgc2ltcGxpZmljYWRhcyBwYXJhIGV4cG9ydGHDp8OjbyBkZSBsb2dzIG5vIE1WUFxuICovXG5leHBvcnQgaW50ZXJmYWNlIE9wY29lc0V4cG9ydGFjYW8ge1xuICAvKipcbiAgICogRm9ybWF0byBkZSBleHBvcnRhw6fDo28gKGFwZW5hcyBKU09OIG91IENTViBubyBNVlApXG4gICAqL1xuICBmb3JtYXRvOiBGb3JtYXRvRXhwb3J0YWNhbztcblxuICAvKipcbiAgICogQ2FtaW5obyBwYXJhIHNhbHZhciBvIGFycXVpdm8gKG9wY2lvbmFsKVxuICAgKiBTZSBuw6NvIGZvciBmb3JuZWNpZG8sIHNlcsOhIHVzYWRvIG8gZGlyZXTDs3JpbyBwYWRyw6NvXG4gICAqL1xuICBjYW1pbmhvPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBOb21lIGRvIGFycXVpdm8gKG9wY2lvbmFsKVxuICAgKiBTZSBuw6NvIGZvciBmb3JuZWNpZG8sIHNlcsOhIGdlcmFkbyBhdXRvbWF0aWNhbWVudGVcbiAgICovXG4gIG5vbWVBcnF1aXZvPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBJbmRpY2Egc2UgbyBhcnF1aXZvIGRldmUgc2VyIGNvbXByaW1pZG9cbiAgICovXG4gIGNvbXByaW1pZG8/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBDYW1wb3MgYSBzZXJlbSBpbmNsdcOtZG9zIG5hIGV4cG9ydGHDp8Ojb1xuICAgKiBTZSBuw6NvIGZvciBmb3JuZWNpZG8sIHRvZG9zIG9zIGNhbXBvcyBzZXLDo28gaW5jbHXDrWRvc1xuICAgKi9cbiAgY2FtcG9zPzogc3RyaW5nW107XG59XG5cbi8qKlxuICogUmVzdWx0YWRvIGRhIG9wZXJhw6fDo28gZGUgZXhwb3J0YcOnw6NvIC0gVmVyc8OjbyBNVlBcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBSZXN1bHRhZG9FeHBvcnRhY2FvIHtcbiAgLyoqIENhbWluaG8gY29tcGxldG8gZG8gYXJxdWl2byBnZXJhZG8gKi9cbiAgY2FtaW5ob0FycXVpdm86IHN0cmluZztcblxuICAvKiogUXVhbnRpZGFkZSBkZSByZWdpc3Ryb3MgZXhwb3J0YWRvcyAqL1xuICByZWdpc3Ryb3NFeHBvcnRhZG9zOiBudW1iZXI7XG5cbiAgLyoqIFRhbWFuaG8gZG8gYXJxdWl2byBlbSBieXRlcyAqL1xuICB0YW1hbmhvQXJxdWl2bzogbnVtYmVyO1xuXG4gIC8qKiBEYXRhIGUgaG9yYSBkYSBleHBvcnRhw6fDo28gKi9cbiAgZGF0YUhvcmE6IERhdGU7XG5cbiAgLyoqIEZvcm1hdG8gZGEgZXhwb3J0YcOnw6NvICovXG4gIGZvcm1hdG86IEZvcm1hdG9FeHBvcnRhY2FvO1xufVxuXG4vKipcbiAqIFNlcnZpw6dvIHJlc3BvbnPDoXZlbCBwb3IgZXhwb3J0YXIgbG9ncyBkZSBhdWRpdG9yaWEgLSBWZXJzw6NvIE1WUFxuICpcbiAqIEltcGxlbWVudGHDp8OjbyBzaW1wbGlmaWNhZGEgcGFyYSBNVlAgY29tIHN1cG9ydGUgYXBlbmFzIGEgZm9ybWF0b3MgZXNzZW5jaWFpcyAoSlNPTiwgQ1NWKS5cbiAqIEZvcm1hdG9zIGF2YW7Dp2Fkb3MgKEV4Y2VsLCBQREYpIGUgZnVuY2lvbmFsaWRhZGVzIGNvbXBsZXhhcyBmb3JhbSBhZGlhZG9zIHBhcmEgdmVyc8O1ZXMgZnV0dXJhcy5cbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEF1ZGl0b3JpYUV4cG9ydGFjYW9TZXJ2aWNlIHtcbiAgLyoqIExvZ2dlciBwYXJhIHJlZ2lzdHJvIGRlIGV2ZW50b3MgZG8gc2VydmnDp28gKi9cbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKEF1ZGl0b3JpYUV4cG9ydGFjYW9TZXJ2aWNlLm5hbWUpO1xuXG4gIC8qKiBEaXJldMOzcmlvIGJhc2UgcGFyYSBhcm1hemVuYXIgb3MgYXJxdWl2b3MgZXhwb3J0YWRvcyAqL1xuICBwcml2YXRlIHJlYWRvbmx5IGRpcmV0b3Jpb0V4cG9ydGFjYW86IHN0cmluZztcblxuICAvKiogVGFtYW5obyBtw6F4aW1vIGRlIHJlZ2lzdHJvcyBwYXJhIGV4cG9ydGHDp8OjbyBlbSBsb3RlICovXG4gIHByaXZhdGUgcmVhZG9ubHkgTUFYX1JFR0lTVFJPU19QT1JfTE9URTogbnVtYmVyO1xuXG4gIC8qKiBUYW1hbmhvIG3DoXhpbW8gZGUgYXJxdWl2byBwZXJtaXRpZG8gZW0gYnl0ZXMgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBUQU1BTkhPX01BWElNT19BUlFVSVZPOiBudW1iZXI7XG5cbiAgLyoqIFRpbWVvdXQgcGFyYSBvcGVyYcOnw7VlcyBkZSBleHBvcnRhw6fDo28gKi9cbiAgcHJpdmF0ZSByZWFkb25seSBUSU1FT1VUX0VYUE9SVEFDQU8gPSA1ICogNjAgKiAxMDAwOyAvLyA1IG1pbnV0b3NcblxuICBjb25zdHJ1Y3RvcihcbiAgICBASW5qZWN0UmVwb3NpdG9yeShMb2dBdWRpdG9yaWEpXG4gICAgcHJpdmF0ZSByZWFkb25seSBsb2dBdWRpdG9yaWFSZXBvc2l0b3J5OiBSZXBvc2l0b3J5PExvZ0F1ZGl0b3JpYT4sXG4gICAgcHJpdmF0ZSByZWFkb25seSBjb25maWdTZXJ2aWNlOiBDb25maWdTZXJ2aWNlLFxuICApIHtcbiAgICAvLyBDb25maWd1cmFyIGxpbWl0ZXNcbiAgICB0aGlzLk1BWF9SRUdJU1RST1NfUE9SX0xPVEUgPSBNYXRoLm1pbihcbiAgICAgIE1hdGgubWF4KFxuICAgICAgICAxLFxuICAgICAgICBOdW1iZXIoXG4gICAgICAgICAgdGhpcy5jb25maWdTZXJ2aWNlLmdldDxudW1iZXI+KCdBVURJVE9SSUFfTUFYX0VYUE9SVF9SRUNPUkRTJykgfHxcbiAgICAgICAgICAgIDEwMDAwLFxuICAgICAgICApLFxuICAgICAgKSxcbiAgICAgIDUwMDAwLCAvLyBMaW1pdGUgYWJzb2x1dG8gZGUgNTAuMDAwIHJlZ2lzdHJvc1xuICAgICk7XG5cbiAgICAvLyBDb25maWd1cmFyIHRhbWFuaG8gbcOheGltbyBkbyBhcnF1aXZvIChlbSBNQiwgcGFkcsOjbyAxMDBNQilcbiAgICB0aGlzLlRBTUFOSE9fTUFYSU1PX0FSUVVJVk8gPVxuICAgICAgTWF0aC5taW4oXG4gICAgICAgIE1hdGgubWF4KFxuICAgICAgICAgIDEsXG4gICAgICAgICAgTnVtYmVyKFxuICAgICAgICAgICAgdGhpcy5jb25maWdTZXJ2aWNlLmdldDxudW1iZXI+KCdBVURJVE9SSUFfTUFYX0ZJTEVfU0laRV9NQicpIHx8IDEwMCxcbiAgICAgICAgICApLFxuICAgICAgICApLFxuICAgICAgICA1MDAsIC8vIExpbWl0ZSBhYnNvbHV0byBkZSA1MDBNQlxuICAgICAgKSAqXG4gICAgICAxMDI0ICpcbiAgICAgIDEwMjQ7IC8vIENvbnZlcnRlciBwYXJhIGJ5dGVzXG5cbiAgICAvLyBDb25maWd1cmFyIGRpcmV0w7NyaW8gZGUgZXhwb3J0YcOnw6NvXG4gICAgY29uc3QgZXhwb3J0RGlyID0gdGhpcy5jb25maWdTZXJ2aWNlLmdldDxzdHJpbmc+KCdBVURJVE9SSUFfRVhQT1JUX0RJUicpO1xuICAgIHRoaXMuZGlyZXRvcmlvRXhwb3J0YWNhbyA9XG4gICAgICBleHBvcnREaXIgfHwgcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdleHBvcnRzJywgJ2F1ZGl0b3JpYScpO1xuXG4gICAgLy8gR2FyYW50aXIgcXVlIG8gZGlyZXTDs3JpbyBleGlzdGVcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmModGhpcy5kaXJldG9yaW9FeHBvcnRhY2FvKSkge1xuICAgICAgZnMubWtkaXJTeW5jKHRoaXMuZGlyZXRvcmlvRXhwb3J0YWNhbywgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgIGBEaXJldMOzcmlvIGRlIGV4cG9ydGHDp8OjbyBjcmlhZG86ICR7dGhpcy5kaXJldG9yaW9FeHBvcnRhY2FvfWAsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBvcnRhIGxvZ3MgZGUgYXVkaXRvcmlhIGNvbSBiYXNlIG5vcyBmaWx0cm9zIGZvcm5lY2lkb3MgLSBWZXJzw6NvIE1WUFxuICAgKlxuICAgKiBAcGFyYW0gZmlsdHJvcyAtIENyaXTDqXJpb3MgZGUgZmlsdHJhZ2VtIHBhcmEgb3MgbG9nc1xuICAgKiBAcGFyYW0gb3Bjb2VzIC0gQ29uZmlndXJhw6fDtWVzIHBhcmEgYSBleHBvcnRhw6fDo28gKGFwZW5hcyBKU09OIGUgQ1NWIG5vIE1WUClcbiAgICogQHJldHVybnMgSW5mb3JtYcOnw7VlcyBzb2JyZSBvIGFycXVpdm8gZ2VyYWRvXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBRdWFuZG8gb2NvcnJlIHVtIGVycm8gZHVyYW50ZSBhIGV4cG9ydGHDp8Ojb1xuICAgKi9cbiAgYXN5bmMgZXhwb3J0YXJMb2dzKFxuICAgIGZpbHRyb3M6IFF1ZXJ5TG9nQXVkaXRvcmlhRHRvLFxuICAgIG9wY29lczogT3Bjb2VzRXhwb3J0YWNhbyxcbiAgKTogUHJvbWlzZTxSZXN1bHRhZG9FeHBvcnRhY2FvPiB7XG4gICAgY29uc3QgZXhwb3J0SWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgMTApO1xuICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgIGBbJHtleHBvcnRJZH1dIEluaWNpYW5kbyBleHBvcnRhw6fDo28gZGUgbG9ncyBubyBmb3JtYXRvICR7b3Bjb2VzLmZvcm1hdG99YCxcbiAgICApO1xuXG4gICAgLy8gVmVyaWZpY2FyIHNlIG8gZm9ybWF0byBzb2xpY2l0YWRvIMOpIHN1cG9ydGFkbyBubyBNVlBcbiAgICBpZiAoXG4gICAgICBvcGNvZXMuZm9ybWF0byAhPT0gRm9ybWF0b0V4cG9ydGFjYW8uSlNPTiAmJlxuICAgICAgb3Bjb2VzLmZvcm1hdG8gIT09IEZvcm1hdG9FeHBvcnRhY2FvLkNTVlxuICAgICkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgRm9ybWF0byAke29wY29lcy5mb3JtYXRvfSBuw6NvIHN1cG9ydGFkbyBubyBNVlAuIFVzZSBhcGVuYXMgSlNPTiBvdSBDU1YuYCxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhciBvcMOnw7VlcyBkZSBleHBvcnRhw6fDo29cbiAgICB0aGlzLnZhbGlkYXJPcGNvZXNFeHBvcnRhY2FvKG9wY29lcyk7XG5cbiAgICAvLyBCdXNjYXIgbG9ncyBwYXJhIGV4cG9ydGHDp8Ojb1xuICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCB0aGlzLmJ1c2NhckxvZ3NQYXJhRXhwb3J0YWNhbyhmaWx0cm9zKTtcblxuICAgIGlmIChsb2dzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdOZW5odW0gbG9nIGVuY29udHJhZG8gcGFyYSBvcyBjcml0w6lyaW9zIGZvcm5lY2lkb3MnKTtcbiAgICB9XG5cbiAgICBpZiAobG9ncy5sZW5ndGggPiB0aGlzLk1BWF9SRUdJU1RST1NfUE9SX0xPVEUpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgIGBMaW1pdGUgZGUgcmVnaXN0cm9zIGV4Y2VkaWRvOiAke2xvZ3MubGVuZ3RofS4gQSBleHBvcnRhw6fDo28gc2Vyw6EgbGltaXRhZGEgYSAke3RoaXMuTUFYX1JFR0lTVFJPU19QT1JfTE9URX0gcmVnaXN0cm9zLmAsXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFByb2Nlc3NhciBjYW1wb3MgY29uZm9ybWUgc29saWNpdGHDp8Ojb1xuICAgIGNvbnN0IHJlZ2lzdHJvcyA9IHRoaXMucHJvY2Vzc2FyQ2FtcG9zKFxuICAgICAgbG9ncy5zbGljZSgwLCB0aGlzLk1BWF9SRUdJU1RST1NfUE9SX0xPVEUpLFxuICAgICAgb3Bjb2VzLmNhbXBvcyxcbiAgICApO1xuXG4gICAgLy8gR2VyYXIgbm9tZSBkbyBhcnF1aXZvXG4gICAgY29uc3Qgbm9tZUFycXVpdm8gPSBvcGNvZXMubm9tZUFycXVpdm9cbiAgICAgID8gc2FuaXRpemVGaWxlbmFtZShvcGNvZXMubm9tZUFycXVpdm8pXG4gICAgICA6IHRoaXMuZ2VyYXJOb21lQXJxdWl2byhvcGNvZXMpO1xuXG4gICAgLy8gRGVmaW5pciBjYW1pbmhvIGRvIGFycXVpdm9cbiAgICBjb25zdCBkaXJCYXNlID0gb3Bjb2VzLmNhbWluaG8gfHwgdGhpcy5kaXJldG9yaW9FeHBvcnRhY2FvO1xuICAgIGNvbnN0IGNhbWluaG8gPSBwYXRoLnJlc29sdmUoZGlyQmFzZSwgbm9tZUFycXVpdm8pO1xuXG4gICAgLy8gVmFsaWRhciBjYW1pbmhvIGRvIGFycXVpdm9cbiAgICBjb25zdCBjYW1pbmhvQXJxdWl2byA9IHRoaXMudmFsaWRhckNhbWluaG9BcnF1aXZvKGNhbWluaG8pO1xuXG4gICAgLy8gRXhwb3J0YXIgbm8gZm9ybWF0byBzb2xpY2l0YWRvIChhcGVuYXMgSlNPTiBvdSBDU1Ygbm8gTVZQKVxuICAgIGxldCB0YW1hbmhvQXJxdWl2byA9IDA7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgIHRyeSB7XG4gICAgICBzd2l0Y2ggKG9wY29lcy5mb3JtYXRvKSB7XG4gICAgICAgIGNhc2UgRm9ybWF0b0V4cG9ydGFjYW8uSlNPTjpcbiAgICAgICAgICB0YW1hbmhvQXJxdWl2byA9IGF3YWl0IHRoaXMuZXhwb3J0YXJKU09OKFxuICAgICAgICAgICAgcmVnaXN0cm9zLFxuICAgICAgICAgICAgY2FtaW5ob0FycXVpdm8sXG4gICAgICAgICAgICBvcGNvZXMuY29tcHJpbWlkbyxcbiAgICAgICAgICApO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEZvcm1hdG9FeHBvcnRhY2FvLkNTVjpcbiAgICAgICAgICB0YW1hbmhvQXJxdWl2byA9IGF3YWl0IHRoaXMuZXhwb3J0YXJDU1YoXG4gICAgICAgICAgICByZWdpc3Ryb3MsXG4gICAgICAgICAgICBjYW1pbmhvQXJxdWl2byxcbiAgICAgICAgICAgIG9wY29lcy5jb21wcmltaWRvLFxuICAgICAgICAgICk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEZvcm1hdG8gZGUgZXhwb3J0YcOnw6NvIG7Do28gc3Vwb3J0YWRvOiAke29wY29lcy5mb3JtYXRvfWAsXG4gICAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgICBgRXhwb3J0YcOnw6NvIGNvbmNsdcOtZGEgZW0gJHtkdXJhdGlvbn1tczogJHtyZWdpc3Ryb3MubGVuZ3RofSByZWdpc3Ryb3MsICR7dGFtYW5ob0FycXVpdm99IGJ5dGVzYCxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNhbWluaG9BcnF1aXZvLFxuICAgICAgICByZWdpc3Ryb3NFeHBvcnRhZG9zOiByZWdpc3Ryb3MubGVuZ3RoLFxuICAgICAgICB0YW1hbmhvQXJxdWl2byxcbiAgICAgICAgZGF0YUhvcmE6IG5ldyBEYXRlKCksXG4gICAgICAgIGZvcm1hdG86IG9wY29lcy5mb3JtYXRvLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gVGVudGFyIGxpbXBhciBhcnF1aXZvIGVtIGNhc28gZGUgZXJyb1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoY2FtaW5ob0FycXVpdm8pKSB7XG4gICAgICAgICAgZnMudW5saW5rU3luYyhjYW1pbmhvQXJxdWl2byk7XG4gICAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoYEFycXVpdm8gdGVtcG9yw6FyaW8gcmVtb3ZpZG86ICR7Y2FtaW5ob0FycXVpdm99YCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGNsZWFudXBFcnJvcikge1xuICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgICBgRXJybyBhbyBsaW1wYXIgYXJxdWl2byBhcMOzcyBmYWxoYTogJHtjbGVhbnVwRXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGNsZWFudXBFcnJvci5tZXNzYWdlIDogJ0Vycm8gZGVzY29uaGVjaWRvJ31gLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQnVzY2EgbG9ncyBkZSBhdWRpdG9yaWEgY29tIGJhc2Ugbm9zIGZpbHRyb3MgZm9ybmVjaWRvc1xuICAgKlxuICAgKiBAcGFyYW0gZmlsdHJvcyAtIENyaXTDqXJpb3MgZGUgZmlsdHJhZ2VtIHBhcmEgYSBjb25zdWx0YVxuICAgKiBAcmV0dXJucyBMaXN0YSBkZSBsb2dzIGRlIGF1ZGl0b3JpYSBxdWUgYXRlbmRlbSBhb3MgY3JpdMOpcmlvc1xuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBidXNjYXJMb2dzUGFyYUV4cG9ydGFjYW8oXG4gICAgZmlsdHJvczogUXVlcnlMb2dBdWRpdG9yaWFEdG8sXG4gICk6IFByb21pc2U8TG9nQXVkaXRvcmlhW10+IHtcbiAgICBjb25zdCB3aGVyZUNsYXVzZTogYW55ID0ge307XG5cbiAgICAvLyBGaWx0cmFyIHBvciB0aXBvIGRlIG9wZXJhw6fDo29cbiAgICBpZiAoZmlsdHJvcy50aXBvX29wZXJhY2FvKSB7XG4gICAgICB3aGVyZUNsYXVzZS50aXBvX29wZXJhY2FvID0gZmlsdHJvcy50aXBvX29wZXJhY2FvO1xuICAgIH1cblxuICAgIC8vIEZpbHRyYXIgcG9yIGVudGlkYWRlIGFmZXRhZGFcbiAgICBpZiAoZmlsdHJvcy5lbnRpZGFkZV9hZmV0YWRhKSB7XG4gICAgICB3aGVyZUNsYXVzZS5lbnRpZGFkZV9hZmV0YWRhID0gSUxpa2UoYCUke2ZpbHRyb3MuZW50aWRhZGVfYWZldGFkYX0lYCk7XG4gICAgfVxuXG4gICAgLy8gRmlsdHJhciBwb3IgSUQgZGEgZW50aWRhZGVcbiAgICBpZiAoZmlsdHJvcy5lbnRpZGFkZV9pZCkge1xuICAgICAgd2hlcmVDbGF1c2UuZW50aWRhZGVfaWQgPSBmaWx0cm9zLmVudGlkYWRlX2lkO1xuICAgIH1cblxuICAgIC8vIEZpbHRyYXIgcG9yIElEIGRvIHVzdcOhcmlvXG4gICAgaWYgKGZpbHRyb3MudXN1YXJpb19pZCkge1xuICAgICAgd2hlcmVDbGF1c2UudXN1YXJpb19pZCA9IGZpbHRyb3MudXN1YXJpb19pZDtcbiAgICB9XG5cbiAgICAvLyBGaWx0cmFyIHBvciBwZXLDrW9kbyBkZSBkYXRhXG4gICAgaWYgKGZpbHRyb3MuZGF0YV9pbmljaWFsKSB7XG4gICAgICBjb25zdCBkYXRhSW5pY2lhbCA9IG5ldyBEYXRlKGZpbHRyb3MuZGF0YV9pbmljaWFsKTtcblxuICAgICAgaWYgKGZpbHRyb3MuZGF0YV9maW5hbCkge1xuICAgICAgICBjb25zdCBkYXRhRmluYWwgPSBuZXcgRGF0ZShmaWx0cm9zLmRhdGFfZmluYWwpO1xuICAgICAgICBkYXRhRmluYWwuc2V0SG91cnMoMjMsIDU5LCA1OSwgOTk5KTsgLy8gQWp1c3RhciBwYXJhIG8gZmltIGRvIGRpYVxuXG4gICAgICAgIHdoZXJlQ2xhdXNlLmNyZWF0ZWRfYXQgPSBCZXR3ZWVuKGRhdGFJbmljaWFsLCBkYXRhRmluYWwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gU2UgbsOjbyB0aXZlciBkYXRhIGZpbmFsLCB1c2FyIGFwZW5hcyBhIGRhdGEgaW5pY2lhbFxuICAgICAgICBjb25zdCBmaW1Eb0RpYSA9IG5ldyBEYXRlKGRhdGFJbmljaWFsKTtcbiAgICAgICAgZmltRG9EaWEuc2V0SG91cnMoMjMsIDU5LCA1OSwgOTk5KTsgLy8gQWp1c3RhciBwYXJhIG8gZmltIGRvIGRpYVxuXG4gICAgICAgIHdoZXJlQ2xhdXNlLmNyZWF0ZWRfYXQgPSBCZXR3ZWVuKGRhdGFJbmljaWFsLCBmaW1Eb0RpYSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChmaWx0cm9zLmRhdGFfZmluYWwpIHtcbiAgICAgIC8vIFNlIHRpdmVyIGFwZW5hcyBkYXRhIGZpbmFsLCBidXNjYXIgdHVkbyBhdMOpIGVzc2EgZGF0YVxuICAgICAgY29uc3QgZGF0YUZpbmFsID0gbmV3IERhdGUoZmlsdHJvcy5kYXRhX2ZpbmFsKTtcbiAgICAgIGRhdGFGaW5hbC5zZXRIb3VycygyMywgNTksIDU5LCA5OTkpOyAvLyBBanVzdGFyIHBhcmEgbyBmaW0gZG8gZGlhXG5cbiAgICAgIHdoZXJlQ2xhdXNlLmNyZWF0ZWRfYXQgPSBCZXR3ZWVuKG5ldyBEYXRlKDApLCBkYXRhRmluYWwpO1xuICAgIH1cblxuICAgIC8vIEZpbHRyYXIgcG9yIG3DqXRvZG8gSFRUUFxuICAgIGlmIChmaWx0cm9zLm1ldG9kb19odHRwKSB7XG4gICAgICB3aGVyZUNsYXVzZS5tZXRvZG9faHR0cCA9IGZpbHRyb3MubWV0b2RvX2h0dHA7XG4gICAgfVxuXG4gICAgLy8gRmlsdHJhciBwb3IgZW5kcG9pbnRcbiAgICBpZiAoZmlsdHJvcy5lbmRwb2ludCkge1xuICAgICAgd2hlcmVDbGF1c2UuZW5kcG9pbnQgPSBJTGlrZShgJSR7ZmlsdHJvcy5lbmRwb2ludH0lYCk7XG4gICAgfVxuXG4gICAgLy8gRXhlY3V0YXIgY29uc3VsdGEgY29tIHBhcsOibWV0cm9zIGRlIHBhZ2luYcOnw6NvIGUgb3JkZW5hw6fDo29cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5sb2dBdWRpdG9yaWFSZXBvc2l0b3J5LmZpbmQoe1xuICAgICAgd2hlcmU6IHdoZXJlQ2xhdXNlLFxuICAgICAgb3JkZXI6IHtcbiAgICAgICAgY3JlYXRlZF9hdDogJ0RFU0MnLFxuICAgICAgfSxcbiAgICAgIHRha2U6IHRoaXMuTUFYX1JFR0lTVFJPU19QT1JfTE9URSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNzYSBlIGZpbHRyYSBjYW1wb3MgZG9zIGxvZ3MgZGUgYXVkaXRvcmlhXG4gICAqXG4gICAqIEBwYXJhbSBsb2dzIC0gTGlzdGEgZGUgbG9ncyBhIHByb2Nlc3NhclxuICAgKiBAcGFyYW0gY2FtcG9zIC0gTGlzdGEgb3BjaW9uYWwgZGUgY2FtcG9zIGEgaW5jbHVpclxuICAgKiBAcmV0dXJucyBBcnJheSBkZSBvYmpldG9zIGNvbSBvcyBjYW1wb3MgcHJvY2Vzc2Fkb3NcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgcHJvY2Vzc2FyQ2FtcG9zKFxuICAgIGxvZ3M6IExvZ0F1ZGl0b3JpYVtdLFxuICAgIGNhbXBvcz86IHN0cmluZ1tdLFxuICApOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPltdIHtcbiAgICByZXR1cm4gbG9ncy5tYXAoKGxvZykgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0YWRvOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9O1xuXG4gICAgICAvLyBEZXRlcm1pbmUgcXVhaXMgY2FtcG9zIGluY2x1aXJcbiAgICAgIGNvbnN0IGNhbXBvc1BhcmFJbmNsdWlyID0gY2FtcG9zPy5sZW5ndGggPyBjYW1wb3MgOiBPYmplY3Qua2V5cyhsb2cpO1xuXG4gICAgICAvLyBBZGljaW9uYXIgY2FtcG9zIG5vIHJlc3VsdGFkb1xuICAgICAgZm9yIChjb25zdCBjYW1wbyBvZiBjYW1wb3NQYXJhSW5jbHVpcikge1xuICAgICAgICBpZiAoY2FtcG8gaW4gbG9nKSB7XG4gICAgICAgICAgcmVzdWx0YWRvW2NhbXBvXSA9IChsb2cgYXMgYW55KVtjYW1wb107XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdGFkbztcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGEgYXMgb3DDp8O1ZXMgZGUgZXhwb3J0YcOnw6NvXG4gICAqXG4gICAqIEBwYXJhbSBvcGNvZXMgLSBPcMOnw7VlcyBkZSBleHBvcnRhw6fDo28gYSB2YWxpZGFyXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBTZSBhcyBvcMOnw7VlcyBmb3JlbSBpbnbDoWxpZGFzXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIHZhbGlkYXJPcGNvZXNFeHBvcnRhY2FvKG9wY29lczogT3Bjb2VzRXhwb3J0YWNhbyk6IHZvaWQge1xuICAgIC8vIFZlcmlmaWNhciBzZSBvIGZvcm1hdG8gw6kgc3Vwb3J0YWRvXG4gICAgaWYgKCFPYmplY3QudmFsdWVzKEZvcm1hdG9FeHBvcnRhY2FvKS5pbmNsdWRlcyhvcGNvZXMuZm9ybWF0bykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRm9ybWF0byBkZSBleHBvcnRhw6fDo28gaW52w6FsaWRvOiAke29wY29lcy5mb3JtYXRvfWApO1xuICAgIH1cblxuICAgIC8vIFZlcmlmaWNhciBjYW1pbmhvIHBlcnNvbmFsaXphZG9cbiAgICBpZiAob3Bjb2VzLmNhbWluaG8gJiYgIWZzLmV4aXN0c1N5bmMob3Bjb2VzLmNhbWluaG8pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbWluaG8gZGUgZGVzdGlubyBuw6NvIGVuY29udHJhZG86ICR7b3Bjb2VzLmNhbWluaG99YCk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhciBub21lIGRlIGFycXVpdm9cbiAgICBpZiAob3Bjb2VzLm5vbWVBcnF1aXZvKSB7XG4gICAgICBjb25zdCBzYW5pdGl6ZWROYW1lID0gc2FuaXRpemVGaWxlbmFtZShvcGNvZXMubm9tZUFycXVpdm8pO1xuICAgICAgaWYgKHNhbml0aXplZE5hbWUgIT09IG9wY29lcy5ub21lQXJxdWl2bykge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgICAgIGBOb21lIGRlIGFycXVpdm8gc2FuaXRpemFkbzogJHtvcGNvZXMubm9tZUFycXVpdm99IC0+ICR7c2FuaXRpemVkTmFtZX1gLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXJhIHVtIG5vbWUgZGUgYXJxdWl2byBzZWd1cm8gcGFyYSBleHBvcnRhw6fDo29cbiAgICpcbiAgICogQHBhcmFtIG9wY29lcyAtIE9ww6fDtWVzIGRlIGV4cG9ydGHDp8Ojb1xuICAgKiBAcmV0dXJucyBOb21lIGRlIGFycXVpdm8gZ2VyYWRvXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIGdlcmFyTm9tZUFycXVpdm8ob3Bjb2VzOiBPcGNvZXNFeHBvcnRhY2FvKTogc3RyaW5nIHtcbiAgICAvLyBTZSB1bSBub21lIGZvciBmb3JuZWNpZG8sIHNhbml0aXphciBlIHVzYXJcbiAgICBpZiAob3Bjb2VzLm5vbWVBcnF1aXZvKSB7XG4gICAgICBjb25zdCBub21lQmFzZSA9IHNhbml0aXplRmlsZW5hbWUob3Bjb2VzLm5vbWVBcnF1aXZvKTtcbiAgICAgIHJldHVybiBgJHtub21lQmFzZX0uJHtvcGNvZXMuZm9ybWF0b30ke29wY29lcy5jb21wcmltaWRvID8gJy5neicgOiAnJ31gO1xuICAgIH1cblxuICAgIC8vIEdlcmFyIG5vbWUgcGFkcsOjbyBjb20gdGltZXN0YW1wXG4gICAgY29uc3QgZGF0YUF0dWFsID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBkYXRhQXR1YWxcbiAgICAgIC50b0lTT1N0cmluZygpXG4gICAgICAucmVwbGFjZSgvWzouXS9nLCAnLScpXG4gICAgICAucmVwbGFjZSgnVCcsICdfJylcbiAgICAgIC5zcGxpdCgnWicpWzBdO1xuXG4gICAgcmV0dXJuIGBhdWRpdG9yaWFfJHt0aW1lc3RhbXB9LiR7b3Bjb2VzLmZvcm1hdG99JHtvcGNvZXMuY29tcHJpbWlkbyA/ICcuZ3onIDogJyd9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGEgY2FtaW5obyBkbyBhcnF1aXZvIHBhcmEgZ2FyYW50aXIgc2VndXJhbsOnYVxuICAgKlxuICAgKiBAcGFyYW0gY2FtaW5ob0FycXVpdm8gLSBDYW1pbmhvIGEgdmFsaWRhclxuICAgKiBAcmV0dXJucyBDYW1pbmhvIHZhbGlkYWRvXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBTZSBvIGNhbWluaG8gZm9yIGludsOhbGlkbyBvdSBpbnNlZ3Vyb1xuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGFyQ2FtaW5ob0FycXVpdm8oY2FtaW5ob0FycXVpdm86IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gVmVyaWZpY2FyIHNlIG8gY2FtaW5obyDDqSBhYnNvbHV0b1xuICAgIGlmICghcGF0aC5pc0Fic29sdXRlKGNhbWluaG9BcnF1aXZvKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW1pbmhvIGRvIGFycXVpdm8gZGV2ZSBzZXIgYWJzb2x1dG8nKTtcbiAgICB9XG5cbiAgICAvLyBOb3JtYWxpemFyIGNhbWluaG8gcGFyYSBldml0YXIgcGF0aCB0cmF2ZXJzYWxcbiAgICBjb25zdCBjYW1pbmhvTm9ybWFsaXphZG8gPSBwYXRoLm5vcm1hbGl6ZShjYW1pbmhvQXJxdWl2byk7XG5cbiAgICAvLyBWZXJpZmljYXIgc2UgZXN0w6EgZGVudHJvIGRlIHVtIGRpcmV0w7NyaW8gcGVybWl0aWRvIChkaXJldMOzcmlvIGRlIGV4cG9ydGHDp8OjbyBvdSBwZXJzb25hbGl6YWRvKVxuICAgIGNvbnN0IGlzRGVudHJvRG9QZXJtaXRpZG8gPSBjYW1pbmhvTm9ybWFsaXphZG8uc3RhcnRzV2l0aChcbiAgICAgIHRoaXMuZGlyZXRvcmlvRXhwb3J0YWNhbyxcbiAgICApO1xuXG4gICAgaWYgKCFpc0RlbnRyb0RvUGVybWl0aWRvKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhbWluaG8gZG8gYXJxdWl2byBpbnbDoWxpZG8nKTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZmljYXIgc2UgbyBkaXJldMOzcmlvIGRlIGRlc3Rpbm8gZXhpc3RlXG4gICAgY29uc3QgZGlyZXRvcmlvID0gcGF0aC5kaXJuYW1lKGNhbWluaG9Ob3JtYWxpemFkbyk7XG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKGRpcmV0b3JpbykpIHtcbiAgICAgIGZzLm1rZGlyU3luYyhkaXJldG9yaW8sIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBjYW1pbmhvTm9ybWFsaXphZG87XG4gIH1cblxuICAvKipcbiAgICogU2FuaXRpemEgZGFkb3MgcGFyYSBleHBvcnRhw6fDo29cbiAgICpcbiAgICogQHBhcmFtIGRhZG9zIC0gQXJyYXkgZGUgZGFkb3MgYSBzYW5pdGl6YXJcbiAgICogQHJldHVybnMgQXJyYXkgc2FuaXRpemFkb1xuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcHJpdmF0ZSBzYW5pdGl6YXJEYWRvc1BhcmFFeHBvcnRhY2FvKFxuICAgIGRhZG9zOiB1bmtub3duW10sXG4gICk6IFJlY29yZDxzdHJpbmcsIHVua25vd24+W10ge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShkYWRvcykpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgICdEYWRvcyBmb3JuZWNpZG9zIG7Do28gc8OjbyB1bSBhcnJheS4gUmV0b3JuYW5kbyBhcnJheSB2YXppby4nLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGRhZG9zLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICBpZiAoIWl0ZW0gfHwgdHlwZW9mIGl0ZW0gIT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVzdWx0YWRvOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9O1xuXG4gICAgICAgIC8vIExpc3RhIGRlIGNhbXBvcyBxdWUgZGV2ZW0gcHJlc2VydmFyIHN1YSBlc3RydXR1cmEgb3JpZ2luYWxcbiAgICAgICAgY29uc3QgY2FtcG9zRXN0cnV0dXJhZG9zID0gW1xuICAgICAgICAgICdkYWRvc19hbnRlcmlvcmVzJyxcbiAgICAgICAgICAnZGFkb3Nfbm92b3MnLFxuICAgICAgICAgICdkYWRvc19zZW5zaXZlaXNfYWNlc3NhZG9zJyxcbiAgICAgICAgXTtcblxuICAgICAgICAvLyBQcm9jZXNzYXIgY2FkYSBjYW1wb1xuICAgICAgICBPYmplY3QuZW50cmllcyhpdGVtIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5mb3JFYWNoKFxuICAgICAgICAgIChbY2hhdmUsIHZhbG9yXSkgPT4ge1xuICAgICAgICAgICAgLy8gUHJlc2VydmFyIGVzdHJ1dHVyYSBwYXJhIGNhbXBvcyBlc3BlY8OtZmljb3MgcXVlIGNvbnTDqm0gb2JqZXRvcyBvdSBhcnJheXNcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgY2FtcG9zRXN0cnV0dXJhZG9zLmluY2x1ZGVzKGNoYXZlKSAmJlxuICAgICAgICAgICAgICB2YWxvciAhPT0gbnVsbCAmJlxuICAgICAgICAgICAgICB0eXBlb2YgdmFsb3IgPT09ICdvYmplY3QnXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgcmVzdWx0YWRvW2NoYXZlXSA9IHZhbG9yO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFByb2Nlc3NhbWVudG8gbm9ybWFsIHBhcmEgb3V0cm9zIHRpcG9zIGRlIGRhZG9zXG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbG9yID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAvLyBTYW5pdGl6YXIgc3RyaW5ncyBwYXJhIGV2aXRhciBpbmplw6fDo29cbiAgICAgICAgICAgICAgcmVzdWx0YWRvW2NoYXZlXSA9IHZhbG9yXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcXHgwMC1cXHgxRlxceDdGLVxceDlGXFx1RkZGRF0vZywgJycpXG4gICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcXHUyMDBCLVxcdTIwMERcXHVGRUZGXS9nLCAnJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZhbG9yIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICAgICAgICAvLyBDb252ZXJ0ZXIgZGF0YXMgcGFyYSBmb3JtYXRvIElTT1xuICAgICAgICAgICAgICByZXN1bHRhZG9bY2hhdmVdID0gdmFsb3IudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICAgIHZhbG9yID09PSBudWxsIHx8XG4gICAgICAgICAgICAgIHZhbG9yID09PSB1bmRlZmluZWQgfHxcbiAgICAgICAgICAgICAgdHlwZW9mIHZhbG9yID09PSAnbnVtYmVyJyB8fFxuICAgICAgICAgICAgICB0eXBlb2YgdmFsb3IgPT09ICdib29sZWFuJ1xuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIC8vIE1hbnRlciB0aXBvcyBwcmltaXRpdm9zXG4gICAgICAgICAgICAgIHJlc3VsdGFkb1tjaGF2ZV0gPSB2YWxvcjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbG9yID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAvLyBQYXJhIG9iamV0b3MgY29tcGxleG9zIHF1ZSBuw6NvIGVzdMOjbyBuYSBsaXN0YSBkZSBleGNlw6fDtWVzXG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgLy8gVGVudGF0aXZhIGRlIHByZXNlcnZhciBhIGVzdHJ1dHVyYSBkbyBvYmpldG9cbiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWxvcikpIHtcbiAgICAgICAgICAgICAgICAgIHJlc3VsdGFkb1tjaGF2ZV0gPSB2YWxvcjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgcmVzdWx0YWRvW2NoYXZlXSA9IHZhbG9yO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICAgICAgcmVzdWx0YWRvW2NoYXZlXSA9ICdbT2JqZXRvIGNvbXBsZXhvXSc7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIFBhcmEgb3V0cm9zIHRpcG9zLCBjb252ZXJ0ZXIgcGFyYSBzdHJpbmdcbiAgICAgICAgICAgICAgcmVzdWx0YWRvW2NoYXZlXSA9IFN0cmluZyh2YWxvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gcmVzdWx0YWRvO1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJybyBhbyBzYW5pdGl6YXIgZGFkb3M6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRXJybyBkZXNjb25oZWNpZG8nfWAsXG4gICAgICApO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBvcnRhIGxvZ3MgcGFyYSBmb3JtYXRvIEpTT05cbiAgICpcbiAgICogQHBhcmFtIGxvZ3MgLSBEYWRvcyBhIGV4cG9ydGFyXG4gICAqIEBwYXJhbSBjYW1pbmhvQXJxdWl2byAtIENhbWluaG8gZG8gYXJxdWl2byBkZSBkZXN0aW5vXG4gICAqIEBwYXJhbSBjb21wcmltaWRvIC0gU2UgbyBhcnF1aXZvIGRldmUgc2VyIGNvbXBhY3RhZG9cbiAgICogQHJldHVybnMgVGFtYW5obyBkbyBhcnF1aXZvIGVtIGJ5dGVzXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGV4cG9ydGFySlNPTihcbiAgICBsb2dzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPltdLFxuICAgIGNhbWluaG9BcnF1aXZvOiBzdHJpbmcsXG4gICAgY29tcHJpbWlkbz86IGJvb2xlYW4sXG4gICk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgLy8gU2FuaXRpemFyIGRhZG9zXG4gICAgY29uc3QgZGFkb3NTYW5pdGl6YWRvcyA9IHRoaXMuc2FuaXRpemFyRGFkb3NQYXJhRXhwb3J0YWNhbyhsb2dzKTtcblxuICAgIC8vIFZlcmlmaWNhciBzZSBow6EgZGFkb3MgcGFyYSBleHBvcnRhclxuICAgIGlmIChkYWRvc1Nhbml0aXphZG9zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy5sb2dnZXIud2FybignTmVuaHVtIGRhZG8gdsOhbGlkbyBwYXJhIGV4cG9ydGFyIHBhcmEgSlNPTicpO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIENvbnZlcnRlciBwYXJhIEpTT04gZm9ybWF0YWRvXG4gICAgICBjb25zdCBqc29uQ29udGVudCA9IEpTT04uc3RyaW5naWZ5KGRhZG9zU2FuaXRpemFkb3MsIG51bGwsIDIpO1xuXG4gICAgICBpZiAoY29tcHJpbWlkbykge1xuICAgICAgICAvLyBFeHBvcnRhciBjb21wYWN0YWRvXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICBjb25zdCBnemlwID0gemxpYi5jcmVhdGVHemlwKCk7XG4gICAgICAgICAgY29uc3Qgb3V0cHV0ID0gZnMuY3JlYXRlV3JpdGVTdHJlYW0oY2FtaW5ob0FycXVpdm8pO1xuXG4gICAgICAgICAgb3V0cHV0Lm9uKCdmaW5pc2gnLCByZXNvbHZlKTtcbiAgICAgICAgICBvdXRwdXQub24oJ2Vycm9yJywgcmVqZWN0KTtcblxuICAgICAgICAgIGd6aXAucGlwZShvdXRwdXQpO1xuICAgICAgICAgIGd6aXAud3JpdGUoanNvbkNvbnRlbnQpO1xuICAgICAgICAgIGd6aXAuZW5kKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRXhwb3J0YXIgc2VtIGNvbXByZXNzw6NvXG4gICAgICAgIGF3YWl0IGZzLnByb21pc2VzLndyaXRlRmlsZShjYW1pbmhvQXJxdWl2bywganNvbkNvbnRlbnQsICd1dGY4Jyk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9idGVyIHRhbWFuaG8gZG8gYXJxdWl2b1xuICAgICAgY29uc3Qgc3RhdHMgPSBmcy5zdGF0U3luYyhjYW1pbmhvQXJxdWl2byk7XG4gICAgICByZXR1cm4gc3RhdHMuc2l6ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvIGFvIGV4cG9ydGFyIHBhcmEgSlNPTjogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdFcnJvIGRlc2NvbmhlY2lkbyd9YCxcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBGYWxoYSBhbyBleHBvcnRhciBwYXJhIEpTT046ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRXJybyBkZXNjb25oZWNpZG8nfWAsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFc2NhcGEgdmFsb3IgcGFyYSBDU1ZcbiAgICpcbiAgICogQHBhcmFtIHZhbG9yIC0gVmFsb3IgYSBlc2NhcGFyXG4gICAqIEByZXR1cm5zIFZhbG9yIGVzY2FwYWRvXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIGVzY2FwYXJWYWxvckNTVih2YWxvcjogdW5rbm93bik6IHN0cmluZyB7XG4gICAgaWYgKHZhbG9yID09PSBudWxsIHx8IHZhbG9yID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbiAgICAvLyBUcmF0YXIgb2JqZXRvcyBvdSBhcnJheXMgcGFyYSBzZXJpYWxpemHDp8OjbyBjb3JyZXRhXG4gICAgaWYgKHR5cGVvZiB2YWxvciA9PT0gJ29iamVjdCcgJiYgdmFsb3IgIT09IG51bGwpIHtcbiAgICAgIC8vIFBhcmEgZGF0YXMsIHVzYXIgZm9ybWF0byBJU09cbiAgICAgIGlmICh2YWxvciBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXNjYXBhclZhbG9yQ1NWKHZhbG9yLnRvSVNPU3RyaW5nKCkpO1xuICAgICAgfVxuXG4gICAgICAvLyBQYXJhIGFycmF5cyBlIG9iamV0b3MsIGNvbnZlcnRlciBwYXJhIEpTT04gZm9ybWF0YWRvXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBqc29uU3RyID0gSlNPTi5zdHJpbmdpZnkodmFsb3IpO1xuICAgICAgICByZXR1cm4gdGhpcy5lc2NhcGFyVmFsb3JDU1YoanNvblN0cik7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXNjYXBhclZhbG9yQ1NWKCdbT2JqZXRvIGNvbXBsZXhvXScpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHN0ciA9IFN0cmluZyh2YWxvcik7XG5cbiAgICAvLyBFc2NhcGFyIGFzcGFzIGR1cGxpY2FuZG8tYXMgZSBjb2xvY2FyIGVudHJlIGFzcGFzIHNlIGNvbnRpdmVyIGNhcmFjdGVyZXMgZXNwZWNpYWlzXG4gICAgaWYgKHN0ci5pbmNsdWRlcygnXCInKSB8fCBzdHIuaW5jbHVkZXMoJywnKSB8fCBzdHIuaW5jbHVkZXMoJ1xcbicpKSB7XG4gICAgICByZXR1cm4gYFwiJHtzdHIucmVwbGFjZSgvXCIvZywgJ1wiXCInKX1cImA7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0cjtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBvcnRhIGxvZ3MgcGFyYSBmb3JtYXRvIENTVlxuICAgKlxuICAgKiBAcGFyYW0gbG9ncyAtIERhZG9zIGEgZXhwb3J0YXJcbiAgICogQHBhcmFtIGNhbWluaG9BcnF1aXZvIC0gQ2FtaW5obyBkbyBhcnF1aXZvIGRlIGRlc3Rpbm9cbiAgICogQHBhcmFtIGNvbXByaW1pZG8gLSBTZSBvIGFycXVpdm8gZGV2ZSBzZXIgY29tcGFjdGFkb1xuICAgKiBAcmV0dXJucyBUYW1hbmhvIGRvIGFycXVpdm8gZW0gYnl0ZXNcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhwb3J0YXJDU1YoXG4gICAgbG9nczogUmVjb3JkPHN0cmluZywgdW5rbm93bj5bXSxcbiAgICBjYW1pbmhvQXJxdWl2bzogc3RyaW5nLFxuICAgIGNvbXByaW1pZG8/OiBib29sZWFuLFxuICApOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIC8vIFNhbml0aXphciBkYWRvc1xuICAgIGNvbnN0IGRhZG9zU2FuaXRpemFkb3MgPSB0aGlzLnNhbml0aXphckRhZG9zUGFyYUV4cG9ydGFjYW8obG9ncyk7XG5cbiAgICAvLyBWZXJpZmljYXIgc2UgaMOhIGRhZG9zIHBhcmEgZXhwb3J0YXJcbiAgICBpZiAoZGFkb3NTYW5pdGl6YWRvcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ05lbmh1bSBkYWRvIHbDoWxpZG8gcGFyYSBleHBvcnRhciBwYXJhIENTVicpO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIE9idGVyIGNhYmXDp2FsaG9zICh0b2RhcyBhcyBjaGF2ZXMgw7puaWNhcyBwcmVzZW50ZXMgbm9zIG9iamV0b3MpXG4gICAgICBjb25zdCBoZWFkZXJzID0gQXJyYXkuZnJvbShcbiAgICAgICAgbmV3IFNldChkYWRvc1Nhbml0aXphZG9zLmZsYXRNYXAoKG9iaikgPT4gT2JqZWN0LmtleXMob2JqKSkpLFxuICAgICAgKTtcblxuICAgICAgLy8gQ3JpYXIgbGluaGEgZGUgY2FiZcOnYWxob1xuICAgICAgY29uc3QgaGVhZGVyUm93ID0gaGVhZGVycy5tYXAodGhpcy5lc2NhcGFyVmFsb3JDU1YpLmpvaW4oJywnKTtcblxuICAgICAgLy8gQ3JpYXIgbGluaGFzIGRlIGRhZG9zXG4gICAgICBjb25zdCBkYXRhUm93cyA9IGRhZG9zU2FuaXRpemFkb3MubWFwKChpdGVtKSA9PiB7XG4gICAgICAgIHJldHVybiBoZWFkZXJzXG4gICAgICAgICAgLm1hcCgoaGVhZGVyKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lc2NhcGFyVmFsb3JDU1YoaXRlbVtoZWFkZXJdKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5qb2luKCcsJyk7XG4gICAgICB9KTtcblxuICAgICAgLy8gQ29tcG9yIGNvbnRlw7pkbyBDU1ZcbiAgICAgIGNvbnN0IGNzdkNvbnRlbnQgPSBbaGVhZGVyUm93LCAuLi5kYXRhUm93c10uam9pbignXFxuJyk7XG5cbiAgICAgIGlmIChjb21wcmltaWRvKSB7XG4gICAgICAgIC8vIEV4cG9ydGFyIGNvbXBhY3RhZG9cbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGd6aXAgPSB6bGliLmNyZWF0ZUd6aXAoKTtcbiAgICAgICAgICBjb25zdCBvdXRwdXQgPSBmcy5jcmVhdGVXcml0ZVN0cmVhbShjYW1pbmhvQXJxdWl2byk7XG5cbiAgICAgICAgICBvdXRwdXQub24oJ2ZpbmlzaCcsIHJlc29sdmUpO1xuICAgICAgICAgIG91dHB1dC5vbignZXJyb3InLCByZWplY3QpO1xuXG4gICAgICAgICAgZ3ppcC5waXBlKG91dHB1dCk7XG4gICAgICAgICAgZ3ppcC53cml0ZShjc3ZDb250ZW50KTtcbiAgICAgICAgICBnemlwLmVuZCgpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEV4cG9ydGFyIHNlbSBjb21wcmVzc8Ojb1xuICAgICAgICBhd2FpdCBmcy5wcm9taXNlcy53cml0ZUZpbGUoY2FtaW5ob0FycXVpdm8sIGNzdkNvbnRlbnQsICd1dGY4Jyk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9idGVyIHRhbWFuaG8gZG8gYXJxdWl2b1xuICAgICAgY29uc3Qgc3RhdHMgPSBmcy5zdGF0U3luYyhjYW1pbmhvQXJxdWl2byk7XG4gICAgICByZXR1cm4gc3RhdHMuc2l6ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvIGFvIGV4cG9ydGFyIHBhcmEgQ1NWOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0Vycm8gZGVzY29uaGVjaWRvJ31gLFxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEZhbGhhIGFvIGV4cG9ydGFyIHBhcmEgQ1NWOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ0Vycm8gZGVzY29uaGVjaWRvJ31gLFxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==