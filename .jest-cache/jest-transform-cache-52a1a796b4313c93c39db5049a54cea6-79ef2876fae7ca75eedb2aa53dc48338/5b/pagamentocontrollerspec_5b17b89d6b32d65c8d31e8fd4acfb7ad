cbc0f85fd27e6543dc79867231ed4584
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const pagamento_controller_1 = require("../../../controllers/pagamento.controller");
const pagamento_service_1 = require("../../../services/pagamento.service");
const integracao_cidadao_service_1 = require("../../../services/integracao-cidadao.service");
const status_pagamento_enum_1 = require("../../../enums/status-pagamento.enum");
const common_1 = require("@nestjs/common");
/**
 * Testes unitários para PagamentoController
 *
 * Valida o comportamento dos endpoints de pagamento, garantindo que os controladores
 * interagem corretamente com os serviços subjacentes e retornam as respostas esperadas.
 */
describe('PagamentoController', () => {
    let controller;
    let pagamentoService;
    let integracaoCidadaoService;
    // Mock de um pagamento para ser utilizado nos testes
    const pagamentoMock = {
        id: 'pagamento-id-1',
        solicitacaoId: 'solicitacao-id-1',
        valor: 500,
        status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
        metodoPagamento: 'pix',
        infoBancariaId: 'info-bancaria-id-1',
        dataLiberacao: new Date(),
        dataCriacao: new Date(),
        dataAtualizacao: new Date(),
        liberadoPor: 'usuario-id-1',
        observacoes: 'Pagamento de benefício eventual',
    };
    // Mock da lista de pagamentos
    const pagamentosListMock = [
        pagamentoMock,
        {
            ...pagamentoMock,
            id: 'pagamento-id-2',
            solicitacaoId: 'solicitacao-id-2',
            valor: 300,
        },
    ];
    // Mock de resposta paginada
    const paginatedResponseMock = {
        items: pagamentosListMock,
        total: pagamentosListMock.length,
        page: 1,
        limit: 10,
    };
    // Mock das informações bancárias
    const infoBancariasMock = [
        {
            id: 'info-bancaria-id-1',
            banco: '001',
            nomeBanco: 'Banco do Brasil',
            agencia: '1234',
            conta: '12345-6',
            tipoConta: 'Corrente',
            principal: true,
        },
        {
            id: 'info-bancaria-id-2',
            pixTipo: 'email',
            pixChave: 'u***@e***.com',
            principal: false,
        },
    ];
    // Mock do request para simular o usuário autenticado
    const mockRequest = {
        user: {
            id: 'usuario-id-1',
            nome: 'Usuário Teste',
            perfil: 'operador',
        },
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            controllers: [pagamento_controller_1.PagamentoController],
            providers: [
                {
                    provide: pagamento_service_1.PagamentoService,
                    useValue: {
                        createPagamento: jest.fn().mockResolvedValue(pagamentoMock),
                        findOne: jest.fn().mockResolvedValue(pagamentoMock),
                        findOneWithRelations: jest.fn().mockResolvedValue(pagamentoMock),
                        findAll: jest.fn().mockResolvedValue(paginatedResponseMock),
                        findPendentes: jest.fn().mockResolvedValue(paginatedResponseMock),
                        atualizarStatus: jest.fn().mockResolvedValue({
                            ...pagamentoMock,
                            status: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO,
                        }),
                        cancelarPagamento: jest.fn().mockResolvedValue({
                            ...pagamentoMock,
                            status: status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO,
                            motivoCancelamento: 'Cancelado a pedido do beneficiário',
                            dataCancelamento: new Date(),
                        }),
                    },
                },
                {
                    provide: integracao_cidadao_service_1.IntegracaoCidadaoService,
                    useValue: {
                        obterInformacoesBancarias: jest
                            .fn()
                            .mockResolvedValue(infoBancariasMock),
                    },
                },
            ],
        }).compile();
        controller = module.get(pagamento_controller_1.PagamentoController);
        pagamentoService = module.get(pagamento_service_1.PagamentoService);
        integracaoCidadaoService = module.get(integracao_cidadao_service_1.IntegracaoCidadaoService);
    });
    it('deve estar definido', () => {
        expect(controller).toBeDefined();
    });
    describe('createPagamento', () => {
        it('deve criar um pagamento com sucesso', async () => {
            // Arrange
            const solicitacaoId = 'solicitacao-id-1';
            const createDto = {
                infoBancariaId: 'info-bancaria-id-1',
                valor: 500,
                dataLiberacao: new Date(),
                metodoPagamento: 'pix',
                observacoes: 'Pagamento teste',
            };
            // Act
            const resultado = await controller.createPagamento(solicitacaoId, createDto, mockRequest);
            // Assert
            expect(resultado).toEqual(pagamentoMock);
            expect(pagamentoService.createPagamento).toHaveBeenCalledWith(solicitacaoId, createDto, mockRequest.user.id);
        });
        it('deve lançar erro quando o serviço falha na criação', async () => {
            // Arrange
            const solicitacaoId = 'solicitacao-id-1';
            const createDto = {
                infoBancariaId: 'info-bancaria-id-1',
                valor: 500,
                dataLiberacao: new Date(),
                metodoPagamento: 'pix',
                observacoes: 'Pagamento teste',
            };
            jest
                .spyOn(pagamentoService, 'createPagamento')
                .mockRejectedValue(new common_1.ConflictException('Erro ao criar pagamento'));
            // Act & Assert
            await expect(controller.createPagamento(solicitacaoId, createDto, mockRequest)).rejects.toThrow(common_1.ConflictException);
        });
    });
    describe('getPagamento', () => {
        it('deve retornar um pagamento pelo ID', async () => {
            // Arrange
            const pagamentoId = 'pagamento-id-1';
            // Act
            const resultado = await controller.getPagamento(pagamentoId);
            // Assert
            expect(resultado).toEqual(pagamentoMock);
            expect(pagamentoService.findOneWithRelations).toHaveBeenCalledWith(pagamentoId);
        });
        it('deve lançar erro quando o pagamento não existe', async () => {
            // Arrange
            const pagamentoId = 'pagamento-inexistente';
            jest
                .spyOn(pagamentoService, 'findOneWithRelations')
                .mockResolvedValue(null);
            // Act & Assert
            await expect(controller.getPagamento(pagamentoId)).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('listarPagamentos', () => {
        it('deve retornar lista paginada de pagamentos', async () => {
            // Arrange
            const filterDto = {
                status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
                page: 1,
                limit: 10,
            };
            // Act
            const resultado = await controller.listarPagamentos(filterDto);
            // Assert
            expect(resultado).toEqual(paginatedResponseMock);
            expect(pagamentoService.findAll).toHaveBeenCalledWith(filterDto);
        });
    });
    describe('listarPagamentosPendentes', () => {
        it('deve retornar lista paginada de pagamentos pendentes', async () => {
            // Arrange
            const query = {
                unidadeId: 'unidade-id-1',
                tipoBeneficioId: 'tipo-beneficio-id-1',
                page: 1,
                limit: 10,
            };
            // Act
            const resultado = await controller.listarPagamentosPendentes(query);
            // Assert
            expect(resultado).toEqual(paginatedResponseMock);
            expect(pagamentoService.findPendentes).toHaveBeenCalledWith(query);
        });
    });
    describe('atualizarStatus', () => {
        it('deve atualizar o status de um pagamento', async () => {
            // Arrange
            const pagamentoId = 'pagamento-id-1';
            const updateDto = {
                status: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO,
            };
            const pagamentoAtualizado = {
                ...pagamentoMock,
                status: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO,
            };
            // Act
            const resultado = await controller.atualizarStatus(pagamentoId, updateDto, mockRequest);
            // Assert
            expect(resultado).toEqual(pagamentoAtualizado);
            expect(pagamentoService.atualizarStatus).toHaveBeenCalledWith(pagamentoId, updateDto.status, mockRequest.user.id);
        });
        it('deve lançar erro quando o pagamento não existe', async () => {
            // Arrange
            const pagamentoId = 'pagamento-inexistente';
            const updateDto = {
                status: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO,
            };
            jest
                .spyOn(pagamentoService, 'atualizarStatus')
                .mockRejectedValue(new common_1.NotFoundException('Pagamento não encontrado'));
            // Act & Assert
            await expect(controller.atualizarStatus(pagamentoId, updateDto, mockRequest)).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('cancelarPagamento', () => {
        it('deve cancelar um pagamento com sucesso', async () => {
            // Arrange
            const pagamentoId = 'pagamento-id-1';
            const cancelarDto = {
                motivoCancelamento: 'Cancelado a pedido do beneficiário',
            };
            const pagamentoCancelado = {
                ...pagamentoMock,
                status: status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO,
                motivoCancelamento: 'Cancelado a pedido do beneficiário',
                dataCancelamento: expect.any(Date),
            };
            // Act
            const resultado = await controller.cancelarPagamento(pagamentoId, cancelarDto, mockRequest);
            // Assert
            expect(resultado).toEqual(pagamentoCancelado);
            expect(pagamentoService.cancelarPagamento).toHaveBeenCalledWith(pagamentoId, mockRequest.user.id, cancelarDto.motivoCancelamento);
        });
    });
    describe('getInfoBancarias', () => {
        it('deve retornar informações bancárias de um beneficiário', async () => {
            // Arrange
            const beneficiarioId = 'beneficiario-id-1';
            // Act
            const resultado = await controller.getInfoBancarias(beneficiarioId);
            // Assert
            expect(resultado).toEqual(infoBancariasMock);
            expect(integracaoCidadaoService.obterInformacoesBancarias).toHaveBeenCalledWith(beneficiarioId);
        });
        it('deve lançar erro quando o beneficiário não existe', async () => {
            // Arrange
            const beneficiarioId = 'beneficiario-inexistente';
            jest
                .spyOn(integracaoCidadaoService, 'obterInformacoesBancarias')
                .mockRejectedValue(new common_1.NotFoundException('Beneficiário não encontrado'));
            // Act & Assert
            await expect(controller.getInfoBancarias(beneficiarioId)).rejects.toThrow(common_1.NotFoundException);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcdGVzdHNcXHVuaXRcXGNvbnRyb2xsZXJzXFxwYWdhbWVudG8uY29udHJvbGxlci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELG9GQUFnRjtBQUNoRiwyRUFBdUU7QUFDdkUsNkZBQXdGO0FBQ3hGLGdGQUEyRTtBQUMzRSwyQ0FBc0U7QUFNdEU7Ozs7O0dBS0c7QUFDSCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBQ25DLElBQUksVUFBK0IsQ0FBQztJQUNwQyxJQUFJLGdCQUFrQyxDQUFDO0lBQ3ZDLElBQUksd0JBQWtELENBQUM7SUFFdkQscURBQXFEO0lBQ3JELE1BQU0sYUFBYSxHQUFHO1FBQ3BCLEVBQUUsRUFBRSxnQkFBZ0I7UUFDcEIsYUFBYSxFQUFFLGtCQUFrQjtRQUNqQyxLQUFLLEVBQUUsR0FBRztRQUNWLE1BQU0sRUFBRSwyQ0FBbUIsQ0FBQyxRQUFRO1FBQ3BDLGVBQWUsRUFBRSxLQUFLO1FBQ3RCLGNBQWMsRUFBRSxvQkFBb0I7UUFDcEMsYUFBYSxFQUFFLElBQUksSUFBSSxFQUFFO1FBQ3pCLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRTtRQUN2QixlQUFlLEVBQUUsSUFBSSxJQUFJLEVBQUU7UUFDM0IsV0FBVyxFQUFFLGNBQWM7UUFDM0IsV0FBVyxFQUFFLGlDQUFpQztLQUMvQyxDQUFDO0lBRUYsOEJBQThCO0lBQzlCLE1BQU0sa0JBQWtCLEdBQUc7UUFDekIsYUFBYTtRQUNiO1lBQ0UsR0FBRyxhQUFhO1lBQ2hCLEVBQUUsRUFBRSxnQkFBZ0I7WUFDcEIsYUFBYSxFQUFFLGtCQUFrQjtZQUNqQyxLQUFLLEVBQUUsR0FBRztTQUNYO0tBQ0YsQ0FBQztJQUVGLDRCQUE0QjtJQUM1QixNQUFNLHFCQUFxQixHQUFHO1FBQzVCLEtBQUssRUFBRSxrQkFBa0I7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QyxjQUFjLENBQUMsQ0FBQztZQUVwRSxTQUFTO1lBQ1QsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1lBQzdDLE1BQU0sQ0FDSix3QkFBd0IsQ0FBQyx5QkFBeUIsQ0FDbkQsQ0FBQyxvQkFBb0IsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxtREFBbUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNqRSxVQUFVO1lBQ1YsTUFBTSxjQUFjLEdBQUcsMEJBQTBCLENBQUM7WUFFbEQsSUFBSTtpQkFDRCxLQUFLLENBQUMsd0JBQXdCLEVBQUUsMkJBQTJCLENBQUM7aUJBQzVELGlCQUFpQixDQUNoQixJQUFJLDBCQUFpQixDQUFDLDZCQUE2QixDQUFDLENBQ3JELENBQUM7WUFFSixlQUFlO1lBQ2YsTUFBTSxNQUFNLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FDdkUsMEJBQWlCLENBQ2xCLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcdGVzdHNcXHVuaXRcXGNvbnRyb2xsZXJzXFxwYWdhbWVudG8uY29udHJvbGxlci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgUGFnYW1lbnRvQ29udHJvbGxlciB9IGZyb20gJy4uLy4uLy4uL2NvbnRyb2xsZXJzL3BhZ2FtZW50by5jb250cm9sbGVyJztcbmltcG9ydCB7IFBhZ2FtZW50b1NlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9wYWdhbWVudG8uc2VydmljZSc7XG5pbXBvcnQgeyBJbnRlZ3JhY2FvQ2lkYWRhb1NlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9pbnRlZ3JhY2FvLWNpZGFkYW8uc2VydmljZSc7XG5pbXBvcnQgeyBTdGF0dXNQYWdhbWVudG9FbnVtIH0gZnJvbSAnLi4vLi4vLi4vZW51bXMvc3RhdHVzLXBhZ2FtZW50by5lbnVtJztcbmltcG9ydCB7IE5vdEZvdW5kRXhjZXB0aW9uLCBDb25mbGljdEV4Y2VwdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IFBhZ2FtZW50b0NyZWF0ZUR0byB9IGZyb20gJy4uLy4uLy4uL2R0b3MvcGFnYW1lbnRvLWNyZWF0ZS5kdG8nO1xuaW1wb3J0IHsgQXR1YWxpemFyU3RhdHVzRHRvIH0gZnJvbSAnLi4vLi4vLi4vZHRvcy9hdHVhbGl6YXItc3RhdHVzLmR0byc7XG5pbXBvcnQgeyBDYW5jZWxhclBhZ2FtZW50b0R0byB9IGZyb20gJy4uLy4uLy4uL2R0b3MvY2FuY2VsYXItcGFnYW1lbnRvLmR0byc7XG5pbXBvcnQgeyBGaWx0ZXJQYWdhbWVudG9EdG8gfSBmcm9tICcuLi8uLi8uLi9kdG9zL2ZpbHRlci1wYWdhbWVudG8uZHRvJztcblxuLyoqXG4gKiBUZXN0ZXMgdW5pdMOhcmlvcyBwYXJhIFBhZ2FtZW50b0NvbnRyb2xsZXJcbiAqXG4gKiBWYWxpZGEgbyBjb21wb3J0YW1lbnRvIGRvcyBlbmRwb2ludHMgZGUgcGFnYW1lbnRvLCBnYXJhbnRpbmRvIHF1ZSBvcyBjb250cm9sYWRvcmVzXG4gKiBpbnRlcmFnZW0gY29ycmV0YW1lbnRlIGNvbSBvcyBzZXJ2acOnb3Mgc3ViamFjZW50ZXMgZSByZXRvcm5hbSBhcyByZXNwb3N0YXMgZXNwZXJhZGFzLlxuICovXG5kZXNjcmliZSgnUGFnYW1lbnRvQ29udHJvbGxlcicsICgpID0+IHtcbiAgbGV0IGNvbnRyb2xsZXI6IFBhZ2FtZW50b0NvbnRyb2xsZXI7XG4gIGxldCBwYWdhbWVudG9TZXJ2aWNlOiBQYWdhbWVudG9TZXJ2aWNlO1xuICBsZXQgaW50ZWdyYWNhb0NpZGFkYW9TZXJ2aWNlOiBJbnRlZ3JhY2FvQ2lkYWRhb1NlcnZpY2U7XG5cbiAgLy8gTW9jayBkZSB1bSBwYWdhbWVudG8gcGFyYSBzZXIgdXRpbGl6YWRvIG5vcyB0ZXN0ZXNcbiAgY29uc3QgcGFnYW1lbnRvTW9jayA9IHtcbiAgICBpZDogJ3BhZ2FtZW50by1pZC0xJyxcbiAgICBzb2xpY2l0YWNhb0lkOiAnc29saWNpdGFjYW8taWQtMScsXG4gICAgdmFsb3I6IDUwMCxcbiAgICBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE8sXG4gICAgbWV0b2RvUGFnYW1lbnRvOiAncGl4JyxcbiAgICBpbmZvQmFuY2FyaWFJZDogJ2luZm8tYmFuY2FyaWEtaWQtMScsXG4gICAgZGF0YUxpYmVyYWNhbzogbmV3IERhdGUoKSxcbiAgICBkYXRhQ3JpYWNhbzogbmV3IERhdGUoKSxcbiAgICBkYXRhQXR1YWxpemFjYW86IG5ldyBEYXRlKCksXG4gICAgbGliZXJhZG9Qb3I6ICd1c3VhcmlvLWlkLTEnLFxuICAgIG9ic2VydmFjb2VzOiAnUGFnYW1lbnRvIGRlIGJlbmVmw61jaW8gZXZlbnR1YWwnLFxuICB9O1xuXG4gIC8vIE1vY2sgZGEgbGlzdGEgZGUgcGFnYW1lbnRvc1xuICBjb25zdCBwYWdhbWVudG9zTGlzdE1vY2sgPSBbXG4gICAgcGFnYW1lbnRvTW9jayxcbiAgICB7XG4gICAgICAuLi5wYWdhbWVudG9Nb2NrLFxuICAgICAgaWQ6ICdwYWdhbWVudG8taWQtMicsXG4gICAgICBzb2xpY2l0YWNhb0lkOiAnc29saWNpdGFjYW8taWQtMicsXG4gICAgICB2YWxvcjogMzAwLFxuICAgIH0sXG4gIF07XG5cbiAgLy8gTW9jayBkZSByZXNwb3N0YSBwYWdpbmFkYVxuICBjb25zdCBwYWdpbmF0ZWRSZXNwb25zZU1vY2sgPSB7XG4gICAgaXRlbXM6IHBhZ2FtZW50b3NMaXN0TW9jayxcbiAgICB0b3RhbDogcGFnYW1lbnRvc0xpc3RNb2NrLmxlbmd0aCxcbiAgICBwYWdlOiAxLFxuICAgIGxpbWl0OiAxMCxcbiAgfTtcblxuICAvLyBNb2NrIGRhcyBpbmZvcm1hw6fDtWVzIGJhbmPDoXJpYXNcbiAgY29uc3QgaW5mb0JhbmNhcmlhc01vY2sgPSBbXG4gICAge1xuICAgICAgaWQ6ICdpbmZvLWJhbmNhcmlhLWlkLTEnLFxuICAgICAgYmFuY286ICcwMDEnLFxuICAgICAgbm9tZUJhbmNvOiAnQmFuY28gZG8gQnJhc2lsJyxcbiAgICAgIGFnZW5jaWE6ICcxMjM0JyxcbiAgICAgIGNvbnRhOiAnMTIzNDUtNicsXG4gICAgICB0aXBvQ29udGE6ICdDb3JyZW50ZScsXG4gICAgICBwcmluY2lwYWw6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBpZDogJ2luZm8tYmFuY2FyaWEtaWQtMicsXG4gICAgICBwaXhUaXBvOiAnZW1haWwnLFxuICAgICAgcGl4Q2hhdmU6ICd1KioqQGUqKiouY29tJyxcbiAgICAgIHByaW5jaXBhbDogZmFsc2UsXG4gICAgfSxcbiAgXTtcblxuICAvLyBNb2NrIGRvIHJlcXVlc3QgcGFyYSBzaW11bGFyIG8gdXN1w6FyaW8gYXV0ZW50aWNhZG9cbiAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgdXNlcjoge1xuICAgICAgaWQ6ICd1c3VhcmlvLWlkLTEnLFxuICAgICAgbm9tZTogJ1VzdcOhcmlvIFRlc3RlJyxcbiAgICAgIHBlcmZpbDogJ29wZXJhZG9yJyxcbiAgICB9LFxuICB9O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBjb250cm9sbGVyczogW1BhZ2FtZW50b0NvbnRyb2xsZXJdLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQYWdhbWVudG9TZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICBjcmVhdGVQYWdhbWVudG86IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShwYWdhbWVudG9Nb2NrKSxcbiAgICAgICAgICAgIGZpbmRPbmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShwYWdhbWVudG9Nb2NrKSxcbiAgICAgICAgICAgIGZpbmRPbmVXaXRoUmVsYXRpb25zOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUocGFnYW1lbnRvTW9jayksXG4gICAgICAgICAgICBmaW5kQWxsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUocGFnaW5hdGVkUmVzcG9uc2VNb2NrKSxcbiAgICAgICAgICAgIGZpbmRQZW5kZW50ZXM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShwYWdpbmF0ZWRSZXNwb25zZU1vY2spLFxuICAgICAgICAgICAgYXR1YWxpemFyU3RhdHVzOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAgICAgICAuLi5wYWdhbWVudG9Nb2NrLFxuICAgICAgICAgICAgICBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uQ09ORklSTUFETyxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY2FuY2VsYXJQYWdhbWVudG86IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgICAgIC4uLnBhZ2FtZW50b01vY2ssXG4gICAgICAgICAgICAgIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5DQU5DRUxBRE8sXG4gICAgICAgICAgICAgIG1vdGl2b0NhbmNlbGFtZW50bzogJ0NhbmNlbGFkbyBhIHBlZGlkbyBkbyBiZW5lZmljacOhcmlvJyxcbiAgICAgICAgICAgICAgZGF0YUNhbmNlbGFtZW50bzogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBJbnRlZ3JhY2FvQ2lkYWRhb1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIG9idGVySW5mb3JtYWNvZXNCYW5jYXJpYXM6IGplc3RcbiAgICAgICAgICAgICAgLmZuKClcbiAgICAgICAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKGluZm9CYW5jYXJpYXNNb2NrKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBjb250cm9sbGVyID0gbW9kdWxlLmdldDxQYWdhbWVudG9Db250cm9sbGVyPihQYWdhbWVudG9Db250cm9sbGVyKTtcbiAgICBwYWdhbWVudG9TZXJ2aWNlID0gbW9kdWxlLmdldDxQYWdhbWVudG9TZXJ2aWNlPihQYWdhbWVudG9TZXJ2aWNlKTtcbiAgICBpbnRlZ3JhY2FvQ2lkYWRhb1NlcnZpY2UgPSBtb2R1bGUuZ2V0PEludGVncmFjYW9DaWRhZGFvU2VydmljZT4oXG4gICAgICBJbnRlZ3JhY2FvQ2lkYWRhb1NlcnZpY2UsXG4gICAgKTtcbiAgfSk7XG5cbiAgaXQoJ2RldmUgZXN0YXIgZGVmaW5pZG8nLCAoKSA9PiB7XG4gICAgZXhwZWN0KGNvbnRyb2xsZXIpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVQYWdhbWVudG8nLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgY3JpYXIgdW0gcGFnYW1lbnRvIGNvbSBzdWNlc3NvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qgc29saWNpdGFjYW9JZCA9ICdzb2xpY2l0YWNhby1pZC0xJztcbiAgICAgIGNvbnN0IGNyZWF0ZUR0bzogUGFnYW1lbnRvQ3JlYXRlRHRvID0ge1xuICAgICAgICBpbmZvQmFuY2FyaWFJZDogJ2luZm8tYmFuY2FyaWEtaWQtMScsXG4gICAgICAgIHZhbG9yOiA1MDAsXG4gICAgICAgIGRhdGFMaWJlcmFjYW86IG5ldyBEYXRlKCksXG4gICAgICAgIG1ldG9kb1BhZ2FtZW50bzogJ3BpeCcsXG4gICAgICAgIG9ic2VydmFjb2VzOiAnUGFnYW1lbnRvIHRlc3RlJyxcbiAgICAgIH07XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0YWRvID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVQYWdhbWVudG8oXG4gICAgICAgIHNvbGljaXRhY2FvSWQsXG4gICAgICAgIGNyZWF0ZUR0byxcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0YWRvKS50b0VxdWFsKHBhZ2FtZW50b01vY2spO1xuICAgICAgZXhwZWN0KHBhZ2FtZW50b1NlcnZpY2UuY3JlYXRlUGFnYW1lbnRvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgc29saWNpdGFjYW9JZCxcbiAgICAgICAgY3JlYXRlRHRvLFxuICAgICAgICBtb2NrUmVxdWVzdC51c2VyLmlkLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGxhbsOnYXIgZXJybyBxdWFuZG8gbyBzZXJ2acOnbyBmYWxoYSBuYSBjcmlhw6fDo28nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBzb2xpY2l0YWNhb0lkID0gJ3NvbGljaXRhY2FvLWlkLTEnO1xuICAgICAgY29uc3QgY3JlYXRlRHRvOiBQYWdhbWVudG9DcmVhdGVEdG8gPSB7XG4gICAgICAgIGluZm9CYW5jYXJpYUlkOiAnaW5mby1iYW5jYXJpYS1pZC0xJyxcbiAgICAgICAgdmFsb3I6IDUwMCxcbiAgICAgICAgZGF0YUxpYmVyYWNhbzogbmV3IERhdGUoKSxcbiAgICAgICAgbWV0b2RvUGFnYW1lbnRvOiAncGl4JyxcbiAgICAgICAgb2JzZXJ2YWNvZXM6ICdQYWdhbWVudG8gdGVzdGUnLFxuICAgICAgfTtcblxuICAgICAgamVzdFxuICAgICAgICAuc3B5T24ocGFnYW1lbnRvU2VydmljZSwgJ2NyZWF0ZVBhZ2FtZW50bycpXG4gICAgICAgIC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgQ29uZmxpY3RFeGNlcHRpb24oJ0Vycm8gYW8gY3JpYXIgcGFnYW1lbnRvJykpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5jcmVhdGVQYWdhbWVudG8oXG4gICAgICAgICAgc29saWNpdGFjYW9JZCxcbiAgICAgICAgICBjcmVhdGVEdG8sXG4gICAgICAgICAgbW9ja1JlcXVlc3QgYXMgYW55LFxuICAgICAgICApLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQ29uZmxpY3RFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UGFnYW1lbnRvJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIHVtIHBhZ2FtZW50byBwZWxvIElEJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcGFnYW1lbnRvSWQgPSAncGFnYW1lbnRvLWlkLTEnO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdGFkbyA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0UGFnYW1lbnRvKHBhZ2FtZW50b0lkKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0YWRvKS50b0VxdWFsKHBhZ2FtZW50b01vY2spO1xuICAgICAgZXhwZWN0KHBhZ2FtZW50b1NlcnZpY2UuZmluZE9uZVdpdGhSZWxhdGlvbnMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBwYWdhbWVudG9JZCxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIGVycm8gcXVhbmRvIG8gcGFnYW1lbnRvIG7Do28gZXhpc3RlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcGFnYW1lbnRvSWQgPSAncGFnYW1lbnRvLWluZXhpc3RlbnRlJztcblxuICAgICAgamVzdFxuICAgICAgICAuc3B5T24ocGFnYW1lbnRvU2VydmljZSwgJ2ZpbmRPbmVXaXRoUmVsYXRpb25zJylcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmdldFBhZ2FtZW50byhwYWdhbWVudG9JZCkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgTm90Rm91bmRFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbGlzdGFyUGFnYW1lbnRvcycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSByZXRvcm5hciBsaXN0YSBwYWdpbmFkYSBkZSBwYWdhbWVudG9zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgZmlsdGVyRHRvOiBGaWx0ZXJQYWdhbWVudG9EdG8gPSB7XG4gICAgICAgIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETyxcbiAgICAgICAgcGFnZTogMSxcbiAgICAgICAgbGltaXQ6IDEwLFxuICAgICAgfTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHRhZG8gPSBhd2FpdCBjb250cm9sbGVyLmxpc3RhclBhZ2FtZW50b3MoZmlsdGVyRHRvKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0YWRvKS50b0VxdWFsKHBhZ2luYXRlZFJlc3BvbnNlTW9jayk7XG4gICAgICBleHBlY3QocGFnYW1lbnRvU2VydmljZS5maW5kQWxsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChmaWx0ZXJEdG8pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbGlzdGFyUGFnYW1lbnRvc1BlbmRlbnRlcycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSByZXRvcm5hciBsaXN0YSBwYWdpbmFkYSBkZSBwYWdhbWVudG9zIHBlbmRlbnRlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHF1ZXJ5ID0ge1xuICAgICAgICB1bmlkYWRlSWQ6ICd1bmlkYWRlLWlkLTEnLFxuICAgICAgICB0aXBvQmVuZWZpY2lvSWQ6ICd0aXBvLWJlbmVmaWNpby1pZC0xJyxcbiAgICAgICAgcGFnZTogMSxcbiAgICAgICAgbGltaXQ6IDEwLFxuICAgICAgfTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHRhZG8gPSBhd2FpdCBjb250cm9sbGVyLmxpc3RhclBhZ2FtZW50b3NQZW5kZW50ZXMocXVlcnkpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHRhZG8pLnRvRXF1YWwocGFnaW5hdGVkUmVzcG9uc2VNb2NrKTtcbiAgICAgIGV4cGVjdChwYWdhbWVudG9TZXJ2aWNlLmZpbmRQZW5kZW50ZXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHF1ZXJ5KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2F0dWFsaXphclN0YXR1cycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBhdHVhbGl6YXIgbyBzdGF0dXMgZGUgdW0gcGFnYW1lbnRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcGFnYW1lbnRvSWQgPSAncGFnYW1lbnRvLWlkLTEnO1xuICAgICAgY29uc3QgdXBkYXRlRHRvOiBBdHVhbGl6YXJTdGF0dXNEdG8gPSB7XG4gICAgICAgIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5DT05GSVJNQURPLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcGFnYW1lbnRvQXR1YWxpemFkbyA9IHtcbiAgICAgICAgLi4ucGFnYW1lbnRvTW9jayxcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkNPTkZJUk1BRE8sXG4gICAgICB9O1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdGFkbyA9IGF3YWl0IGNvbnRyb2xsZXIuYXR1YWxpemFyU3RhdHVzKFxuICAgICAgICBwYWdhbWVudG9JZCxcbiAgICAgICAgdXBkYXRlRHRvLFxuICAgICAgICBtb2NrUmVxdWVzdCBhcyBhbnksXG4gICAgICApO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHRhZG8pLnRvRXF1YWwocGFnYW1lbnRvQXR1YWxpemFkbyk7XG4gICAgICBleHBlY3QocGFnYW1lbnRvU2VydmljZS5hdHVhbGl6YXJTdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBwYWdhbWVudG9JZCxcbiAgICAgICAgdXBkYXRlRHRvLnN0YXR1cyxcbiAgICAgICAgbW9ja1JlcXVlc3QudXNlci5pZCxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIGVycm8gcXVhbmRvIG8gcGFnYW1lbnRvIG7Do28gZXhpc3RlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcGFnYW1lbnRvSWQgPSAncGFnYW1lbnRvLWluZXhpc3RlbnRlJztcbiAgICAgIGNvbnN0IHVwZGF0ZUR0bzogQXR1YWxpemFyU3RhdHVzRHRvID0ge1xuICAgICAgICBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uQ09ORklSTUFETyxcbiAgICAgIH07XG5cbiAgICAgIGplc3RcbiAgICAgICAgLnNweU9uKHBhZ2FtZW50b1NlcnZpY2UsICdhdHVhbGl6YXJTdGF0dXMnKVxuICAgICAgICAubW9ja1JlamVjdGVkVmFsdWUobmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdQYWdhbWVudG8gbsOjbyBlbmNvbnRyYWRvJykpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5hdHVhbGl6YXJTdGF0dXMocGFnYW1lbnRvSWQsIHVwZGF0ZUR0bywgbW9ja1JlcXVlc3QgYXMgYW55KSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NhbmNlbGFyUGFnYW1lbnRvJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGNhbmNlbGFyIHVtIHBhZ2FtZW50byBjb20gc3VjZXNzbycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHBhZ2FtZW50b0lkID0gJ3BhZ2FtZW50by1pZC0xJztcbiAgICAgIGNvbnN0IGNhbmNlbGFyRHRvOiBDYW5jZWxhclBhZ2FtZW50b0R0byA9IHtcbiAgICAgICAgbW90aXZvQ2FuY2VsYW1lbnRvOiAnQ2FuY2VsYWRvIGEgcGVkaWRvIGRvIGJlbmVmaWNpw6FyaW8nLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcGFnYW1lbnRvQ2FuY2VsYWRvID0ge1xuICAgICAgICAuLi5wYWdhbWVudG9Nb2NrLFxuICAgICAgICBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPLFxuICAgICAgICBtb3Rpdm9DYW5jZWxhbWVudG86ICdDYW5jZWxhZG8gYSBwZWRpZG8gZG8gYmVuZWZpY2nDoXJpbycsXG4gICAgICAgIGRhdGFDYW5jZWxhbWVudG86IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICB9O1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdGFkbyA9IGF3YWl0IGNvbnRyb2xsZXIuY2FuY2VsYXJQYWdhbWVudG8oXG4gICAgICAgIHBhZ2FtZW50b0lkLFxuICAgICAgICBjYW5jZWxhckR0byxcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgYW55LFxuICAgICAgKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0YWRvKS50b0VxdWFsKHBhZ2FtZW50b0NhbmNlbGFkbyk7XG4gICAgICBleHBlY3QocGFnYW1lbnRvU2VydmljZS5jYW5jZWxhclBhZ2FtZW50bykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIHBhZ2FtZW50b0lkLFxuICAgICAgICBtb2NrUmVxdWVzdC51c2VyLmlkLFxuICAgICAgICBjYW5jZWxhckR0by5tb3Rpdm9DYW5jZWxhbWVudG8sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0SW5mb0JhbmNhcmlhcycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSByZXRvcm5hciBpbmZvcm1hw6fDtWVzIGJhbmPDoXJpYXMgZGUgdW0gYmVuZWZpY2nDoXJpbycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGJlbmVmaWNpYXJpb0lkID0gJ2JlbmVmaWNpYXJpby1pZC0xJztcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHRhZG8gPSBhd2FpdCBjb250cm9sbGVyLmdldEluZm9CYW5jYXJpYXMoYmVuZWZpY2lhcmlvSWQpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHRhZG8pLnRvRXF1YWwoaW5mb0JhbmNhcmlhc01vY2spO1xuICAgICAgZXhwZWN0KFxuICAgICAgICBpbnRlZ3JhY2FvQ2lkYWRhb1NlcnZpY2Uub2J0ZXJJbmZvcm1hY29lc0JhbmNhcmlhcyxcbiAgICAgICkudG9IYXZlQmVlbkNhbGxlZFdpdGgoYmVuZWZpY2lhcmlvSWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbGFuw6dhciBlcnJvIHF1YW5kbyBvIGJlbmVmaWNpw6FyaW8gbsOjbyBleGlzdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBiZW5lZmljaWFyaW9JZCA9ICdiZW5lZmljaWFyaW8taW5leGlzdGVudGUnO1xuXG4gICAgICBqZXN0XG4gICAgICAgIC5zcHlPbihpbnRlZ3JhY2FvQ2lkYWRhb1NlcnZpY2UsICdvYnRlckluZm9ybWFjb2VzQmFuY2FyaWFzJylcbiAgICAgICAgLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICAgIG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignQmVuZWZpY2nDoXJpbyBuw6NvIGVuY29udHJhZG8nKSxcbiAgICAgICAgKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5nZXRJbmZvQmFuY2FyaWFzKGJlbmVmaWNpYXJpb0lkKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=