52119314d3767401e65d6596a9b1c59b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const rxjs_1 = require("rxjs");
const validation_error_interceptor_1 = require("./validation-error.interceptor");
describe('ValidationErrorInterceptor', () => {
    let interceptor;
    let mockExecutionContext;
    let mockCallHandler;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [validation_error_interceptor_1.ValidationErrorInterceptor],
        }).compile();
        interceptor = module.get(validation_error_interceptor_1.ValidationErrorInterceptor);
        mockExecutionContext = {
            switchToHttp: jest.fn(),
            getClass: jest.fn(),
            getHandler: jest.fn(),
            getArgs: jest.fn(),
            getArgByIndex: jest.fn(),
            switchToRpc: jest.fn(),
            switchToWs: jest.fn(),
            getType: jest.fn(),
        };
        mockCallHandler = {
            handle: jest.fn(),
        };
    });
    describe('intercept', () => {
        it('deve passar erros não relacionados à validação sem modificação', (done) => {
            const nonValidationError = new Error('Erro genérico');
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => nonValidationError));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    expect(error).toBe(nonValidationError);
                    done();
                },
            });
        });
        it('deve passar BadRequestException não relacionado à validação', (done) => {
            const nonValidationBadRequest = new common_1.BadRequestException('Erro customizado');
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => nonValidationBadRequest));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    expect(error).toBeInstanceOf(common_1.BadRequestException);
                    expect(error.getResponse()).toBe('Erro customizado');
                    done();
                },
            });
        });
        it('deve melhorar erros de validação do class-validator', (done) => {
            const validationError = new common_1.BadRequestException({
                error: 'Bad Request',
                message: [
                    'nome must be a string',
                    'email must be an email',
                    'idade must not be less than 18',
                ],
                statusCode: 400,
            });
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => validationError));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    try {
                        expect(error).toBeInstanceOf(common_1.BadRequestException);
                        const response = error.getResponse();
                        expect(response).toHaveProperty('error', 'Erro de Validação');
                        expect(response).toHaveProperty('message', 'Os dados fornecidos contêm erros de validação');
                        expect(response).toHaveProperty('details');
                        expect(response).toHaveProperty('timestamp');
                        expect(response).toHaveProperty('statusCode', 400);
                        done();
                    }
                    catch (e) {
                        done(e);
                    }
                },
            });
        });
        it('deve agrupar erros por campo', (done) => {
            const validationError = new common_1.BadRequestException({
                error: 'Bad Request',
                message: [
                    'nome must be a string',
                    'nome must be longer than 2 characters',
                    'email must be an email',
                ],
                statusCode: 400,
            });
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => validationError));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    try {
                        const response = error.getResponse();
                        const details = response.details;
                        expect(details).toHaveProperty('nome');
                        expect(details).toHaveProperty('email');
                        expect(details.nome).toHaveLength(2); // Dois erros para o campo nome
                        expect(details.email).toHaveLength(1); // Um erro para o campo email
                        done();
                    }
                    catch (e) {
                        done(e);
                    }
                },
            });
        });
        it('deve melhorar mensagens de erro de enum', async () => {
            const enumError = new common_1.BadRequestException({
                error: 'Bad Request',
                message: [
                    'status must be one of the following values [ATIVO, INATIVO, PENDENTE]',
                ],
                statusCode: 400,
            });
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => enumError));
            try {
                await interceptor.intercept(mockExecutionContext, mockCallHandler).toPromise();
            }
            catch (error) {
                const response = error.getResponse();
                const details = response.details;
                expect(details.status[0]).toContain('deve ser um dos seguintes valores');
                expect(details.status[0]).toContain('ATIVO, INATIVO, PENDENTE');
            }
        });
        it('deve melhorar mensagens de erro de tipo', async () => {
            const typeError = new common_1.BadRequestException({
                error: 'Bad Request',
                message: [
                    'idade must be a number',
                    'ativo must be a boolean',
                ],
                statusCode: 400,
            });
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => typeError));
            try {
                await interceptor.intercept(mockExecutionContext, mockCallHandler).toPromise();
            }
            catch (error) {
                const response = error.getResponse();
                const details = response.details;
                expect(details.idade[0]).toContain('deve ser um número');
                expect(details.ativo[0]).toContain('deve ser um verdadeiro ou falso');
            }
        });
        it('deve melhorar mensagens de erro de tamanho', (done) => {
            const lengthError = new common_1.BadRequestException({
                error: 'Bad Request',
                message: [
                    'nome must be longer than 2 characters',
                    'descricao must be shorter than 100 characters',
                ],
                statusCode: 400,
            });
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => lengthError));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    try {
                        const response = error.getResponse();
                        const details = response.details;
                        expect(details.nome[0]).toContain('deve ter mais de 2 caracteres');
                        expect(details.descricao[0]).toContain('deve ter menos de 100 caracteres');
                        done();
                    }
                    catch (e) {
                        done(e);
                    }
                },
            });
        });
        it('deve melhorar mensagens de erro numérico', (done) => {
            const numericError = new common_1.BadRequestException({
                error: 'Bad Request',
                message: [
                    'idade must not be less than 18',
                    'salario must not be greater than 50000',
                ],
                statusCode: 400,
            });
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => numericError));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    try {
                        const response = error.getResponse();
                        const details = response.details;
                        expect(details.idade[0]).toContain('deve ser maior ou igual a 18');
                        expect(details.salario[0]).toContain('deve ser menor ou igual a 50000');
                        done();
                    }
                    catch (e) {
                        done(e);
                    }
                },
            });
        });
        it('deve passar dados válidos sem modificação', (done) => {
            const validData = { id: 1, nome: 'Teste' };
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.of)(validData));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                next: (data) => {
                    expect(data).toBe(validData);
                    done();
                },
            });
        });
    });
});
describe('ValidationMessageHelper', () => {
    describe('required', () => {
        it('deve criar mensagem para campo obrigatório', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.required('nome');
            expect(message).toBe("O campo 'nome' é obrigatório");
        });
    });
    describe('invalidType', () => {
        it('deve criar mensagem para tipo inválido', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidType('idade', 'number');
            expect(message).toBe("O campo 'idade' deve ser número");
        });
        it('deve mapear tipos em inglês para português', () => {
            expect(validation_error_interceptor_1.ValidationMessageHelper.invalidType('campo', 'string'))
                .toBe("O campo 'campo' deve ser texto");
            expect(validation_error_interceptor_1.ValidationMessageHelper.invalidType('campo', 'boolean'))
                .toBe("O campo 'campo' deve ser verdadeiro ou falso");
            expect(validation_error_interceptor_1.ValidationMessageHelper.invalidType('campo', 'email'))
                .toBe("O campo 'campo' deve ser email válido");
        });
    });
    describe('invalidLength', () => {
        it('deve criar mensagem para tamanho com min e max', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidLength('nome', 2, 50);
            expect(message).toBe("O campo 'nome' deve ter entre 2 e 50 caracteres");
        });
        it('deve criar mensagem apenas para mínimo', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidLength('nome', 2);
            expect(message).toBe("O campo 'nome' deve ter pelo menos 2 caracteres");
        });
        it('deve criar mensagem apenas para máximo', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidLength('nome', undefined, 50);
            expect(message).toBe("O campo 'nome' deve ter no máximo 50 caracteres");
        });
        it('deve criar mensagem genérica quando não há limites', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidLength('nome');
            expect(message).toBe("O campo 'nome' tem tamanho inválido");
        });
    });
    describe('invalidRange', () => {
        it('deve criar mensagem para intervalo com min e max', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidRange('idade', 18, 65);
            expect(message).toBe("O campo 'idade' deve estar entre 18 e 65");
        });
        it('deve criar mensagem apenas para mínimo', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidRange('idade', 18);
            expect(message).toBe("O campo 'idade' deve ser maior ou igual a 18");
        });
        it('deve criar mensagem apenas para máximo', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidRange('idade', undefined, 65);
            expect(message).toBe("O campo 'idade' deve ser menor ou igual a 65");
        });
    });
    describe('invalidFormat', () => {
        it('deve criar mensagem para formato inválido', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidFormat('email', 'email');
            expect(message).toBe("O campo 'email' deve ter o formato: email válido (exemplo: usuario@dominio.com)");
        });
        it('deve mapear formatos conhecidos', () => {
            expect(validation_error_interceptor_1.ValidationMessageHelper.invalidFormat('cpf', 'cpf'))
                .toContain('CPF válido (exemplo: 123.456.789-00)');
            expect(validation_error_interceptor_1.ValidationMessageHelper.invalidFormat('telefone', 'phone'))
                .toContain('telefone válido (exemplo: (11) 99999-9999)');
        });
        it('deve usar formato original se não mapeado', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidFormat('campo', 'formato_customizado');
            expect(message).toBe("O campo 'campo' deve ter o formato: formato_customizado");
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXHNoYXJlZFxcaW50ZXJjZXB0b3JzXFx2YWxpZGF0aW9uLWVycm9yLmludGVyY2VwdG9yLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsMkNBQW9GO0FBQ3BGLCtCQUFzQztBQUN0QyxpRkFBcUc7QUFFckcsUUFBUSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRTtJQUMxQyxJQUFJLFdBQXVDLENBQUM7SUFDNUMsSUFBSSxvQkFBc0MsQ0FBQztJQUMzQyxJQUFJLGVBQTRCLENBQUM7SUFFakMsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUUsQ0FBQyx5REFBMEIsQ0FBQztTQUN4QyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixXQUFXLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBNkIseURBQTBCLENBQUMsQ0FBQztRQUVqRixvQkFBb0IsR0FBRztZQUNyQixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN2QixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNuQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNyQixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNsQixhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN4QixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN0QixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNyQixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNuQixDQUFDO1FBRUYsZUFBZSxHQUFHO1lBQ2hCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ2xCLENBQUM7SUFDSixDQUFDLENB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QUVILEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxHQUFHLEVBQUU7WUFDekMsTUFBTSxDQUFDLHNEQUF1QixDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7aUJBQ3hELFNBQVMsQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO1lBQ3JELE1BQU0sQ0FBQyxzREFBdUIsQ0FBQyxhQUFhLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO2lCQUMvRCxTQUFTLENBQUMsNENBQTRDLENBQUMsQ0FBQztRQUM3RCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyQ0FBMkMsRUFBRSxHQUFHLEVBQUU7WUFDbkQsTUFBTSxPQUFPLEdBQUcsc0RBQXVCLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO1lBQ3RGLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMseURBQXlELENBQUMsQ0FBQztRQUNsRixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXHNoYXJlZFxcaW50ZXJjZXB0b3JzXFx2YWxpZGF0aW9uLWVycm9yLmludGVyY2VwdG9yLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBCYWRSZXF1ZXN0RXhjZXB0aW9uLCBFeGVjdXRpb25Db250ZXh0LCBDYWxsSGFuZGxlciB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IG9mLCB0aHJvd0Vycm9yIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBWYWxpZGF0aW9uRXJyb3JJbnRlcmNlcHRvciwgVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXIgfSBmcm9tICcuL3ZhbGlkYXRpb24tZXJyb3IuaW50ZXJjZXB0b3InO1xuXG5kZXNjcmliZSgnVmFsaWRhdGlvbkVycm9ySW50ZXJjZXB0b3InLCAoKSA9PiB7XG4gIGxldCBpbnRlcmNlcHRvcjogVmFsaWRhdGlvbkVycm9ySW50ZXJjZXB0b3I7XG4gIGxldCBtb2NrRXhlY3V0aW9uQ29udGV4dDogRXhlY3V0aW9uQ29udGV4dDtcbiAgbGV0IG1vY2tDYWxsSGFuZGxlcjogQ2FsbEhhbmRsZXI7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1ZhbGlkYXRpb25FcnJvckludGVyY2VwdG9yXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBpbnRlcmNlcHRvciA9IG1vZHVsZS5nZXQ8VmFsaWRhdGlvbkVycm9ySW50ZXJjZXB0b3I+KFZhbGlkYXRpb25FcnJvckludGVyY2VwdG9yKTtcbiAgICBcbiAgICBtb2NrRXhlY3V0aW9uQ29udGV4dCA9IHtcbiAgICAgIHN3aXRjaFRvSHR0cDogamVzdC5mbigpLFxuICAgICAgZ2V0Q2xhc3M6IGplc3QuZm4oKSxcbiAgICAgIGdldEhhbmRsZXI6IGplc3QuZm4oKSxcbiAgICAgIGdldEFyZ3M6IGplc3QuZm4oKSxcbiAgICAgIGdldEFyZ0J5SW5kZXg6IGplc3QuZm4oKSxcbiAgICAgIHN3aXRjaFRvUnBjOiBqZXN0LmZuKCksXG4gICAgICBzd2l0Y2hUb1dzOiBqZXN0LmZuKCksXG4gICAgICBnZXRUeXBlOiBqZXN0LmZuKCksXG4gICAgfTtcblxuICAgIG1vY2tDYWxsSGFuZGxlciA9IHtcbiAgICAgIGhhbmRsZTogamVzdC5mbigpLFxuICAgIH07XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbnRlcmNlcHQnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcGFzc2FyIGVycm9zIG7Do28gcmVsYWNpb25hZG9zIMOgIHZhbGlkYcOnw6NvIHNlbSBtb2RpZmljYcOnw6NvJywgKGRvbmUpID0+IHtcbiAgICAgIGNvbnN0IG5vblZhbGlkYXRpb25FcnJvciA9IG5ldyBFcnJvcignRXJybyBnZW7DqXJpY28nKTtcbiAgICAgIG1vY2tDYWxsSGFuZGxlci5oYW5kbGUgPSBqZXN0LmZuKCgpID0+IHRocm93RXJyb3IoKCkgPT4gbm9uVmFsaWRhdGlvbkVycm9yKSk7XG5cbiAgICAgIGludGVyY2VwdG9yLmludGVyY2VwdChtb2NrRXhlY3V0aW9uQ29udGV4dCwgbW9ja0NhbGxIYW5kbGVyKS5zdWJzY3JpYmUoe1xuICAgICAgICBlcnJvcjogKGVycm9yKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KGVycm9yKS50b0JlKG5vblZhbGlkYXRpb25FcnJvcik7XG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBwYXNzYXIgQmFkUmVxdWVzdEV4Y2VwdGlvbiBuw6NvIHJlbGFjaW9uYWRvIMOgIHZhbGlkYcOnw6NvJywgKGRvbmUpID0+IHtcbiAgICAgIGNvbnN0IG5vblZhbGlkYXRpb25CYWRSZXF1ZXN0ID0gbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0Vycm8gY3VzdG9taXphZG8nKTtcbiAgICAgIG1vY2tDYWxsSGFuZGxlci5oYW5kbGUgPSBqZXN0LmZuKCgpID0+IHRocm93RXJyb3IoKCkgPT4gbm9uVmFsaWRhdGlvbkJhZFJlcXVlc3QpKTtcblxuICAgICAgaW50ZXJjZXB0b3IuaW50ZXJjZXB0KG1vY2tFeGVjdXRpb25Db250ZXh0LCBtb2NrQ2FsbEhhbmRsZXIpLnN1YnNjcmliZSh7XG4gICAgICAgIGVycm9yOiAoZXJyb3IpID0+IHtcbiAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvQmVJbnN0YW5jZU9mKEJhZFJlcXVlc3RFeGNlcHRpb24pO1xuICAgICAgICAgIGV4cGVjdChlcnJvci5nZXRSZXNwb25zZSgpKS50b0JlKCdFcnJvIGN1c3RvbWl6YWRvJyk7XG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBtZWxob3JhciBlcnJvcyBkZSB2YWxpZGHDp8OjbyBkbyBjbGFzcy12YWxpZGF0b3InLCAoZG9uZSkgPT4ge1xuICAgICAgY29uc3QgdmFsaWRhdGlvbkVycm9yID0gbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oe1xuICAgICAgICBlcnJvcjogJ0JhZCBSZXF1ZXN0JyxcbiAgICAgICAgbWVzc2FnZTogW1xuICAgICAgICAgICdub21lIG11c3QgYmUgYSBzdHJpbmcnLFxuICAgICAgICAgICdlbWFpbCBtdXN0IGJlIGFuIGVtYWlsJyxcbiAgICAgICAgICAnaWRhZGUgbXVzdCBub3QgYmUgbGVzcyB0aGFuIDE4JyxcbiAgICAgICAgXSxcbiAgICAgICAgc3RhdHVzQ29kZTogNDAwLFxuICAgICAgfSk7XG5cbiAgICAgIG1vY2tDYWxsSGFuZGxlci5oYW5kbGUgPSBqZXN0LmZuKCgpID0+IHRocm93RXJyb3IoKCkgPT4gdmFsaWRhdGlvbkVycm9yKSk7XG5cbiAgICAgIGludGVyY2VwdG9yLmludGVyY2VwdChtb2NrRXhlY3V0aW9uQ29udGV4dCwgbW9ja0NhbGxIYW5kbGVyKS5zdWJzY3JpYmUoe1xuICAgICAgICBlcnJvcjogKGVycm9yKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGV4cGVjdChlcnJvcikudG9CZUluc3RhbmNlT2YoQmFkUmVxdWVzdEV4Y2VwdGlvbik7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGVycm9yLmdldFJlc3BvbnNlKCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChyZXNwb25zZSkudG9IYXZlUHJvcGVydHkoJ2Vycm9yJywgJ0Vycm8gZGUgVmFsaWRhw6fDo28nKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXNwb25zZSkudG9IYXZlUHJvcGVydHkoJ21lc3NhZ2UnLCAnT3MgZGFkb3MgZm9ybmVjaWRvcyBjb250w6ptIGVycm9zIGRlIHZhbGlkYcOnw6NvJyk7XG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2UpLnRvSGF2ZVByb3BlcnR5KCdkZXRhaWxzJyk7XG4gICAgICAgICAgICBleHBlY3QocmVzcG9uc2UpLnRvSGF2ZVByb3BlcnR5KCd0aW1lc3RhbXAnKTtcbiAgICAgICAgICAgIGV4cGVjdChyZXNwb25zZSkudG9IYXZlUHJvcGVydHkoJ3N0YXR1c0NvZGUnLCA0MDApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZG9uZShlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGFncnVwYXIgZXJyb3MgcG9yIGNhbXBvJywgKGRvbmUpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRpb25FcnJvciA9IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKHtcbiAgICAgICAgZXJyb3I6ICdCYWQgUmVxdWVzdCcsXG4gICAgICAgIG1lc3NhZ2U6IFtcbiAgICAgICAgICAnbm9tZSBtdXN0IGJlIGEgc3RyaW5nJyxcbiAgICAgICAgICAnbm9tZSBtdXN0IGJlIGxvbmdlciB0aGFuIDIgY2hhcmFjdGVycycsXG4gICAgICAgICAgJ2VtYWlsIG11c3QgYmUgYW4gZW1haWwnLFxuICAgICAgICBdLFxuICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXG4gICAgICB9KTtcblxuICAgICAgbW9ja0NhbGxIYW5kbGVyLmhhbmRsZSA9IGplc3QuZm4oKCkgPT4gdGhyb3dFcnJvcigoKSA9PiB2YWxpZGF0aW9uRXJyb3IpKTtcblxuICAgICAgaW50ZXJjZXB0b3IuaW50ZXJjZXB0KG1vY2tFeGVjdXRpb25Db250ZXh0LCBtb2NrQ2FsbEhhbmRsZXIpLnN1YnNjcmliZSh7XG4gICAgICAgIGVycm9yOiAoZXJyb3IpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBlcnJvci5nZXRSZXNwb25zZSgpO1xuICAgICAgICAgICAgY29uc3QgZGV0YWlscyA9IHJlc3BvbnNlLmRldGFpbHM7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChkZXRhaWxzKS50b0hhdmVQcm9wZXJ0eSgnbm9tZScpO1xuICAgICAgICAgICAgZXhwZWN0KGRldGFpbHMpLnRvSGF2ZVByb3BlcnR5KCdlbWFpbCcpO1xuICAgICAgICAgICAgZXhwZWN0KGRldGFpbHMubm9tZSkudG9IYXZlTGVuZ3RoKDIpOyAvLyBEb2lzIGVycm9zIHBhcmEgbyBjYW1wbyBub21lXG4gICAgICAgICAgICBleHBlY3QoZGV0YWlscy5lbWFpbCkudG9IYXZlTGVuZ3RoKDEpOyAvLyBVbSBlcnJvIHBhcmEgbyBjYW1wbyBlbWFpbFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZG9uZShlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIG1lbGhvcmFyIG1lbnNhZ2VucyBkZSBlcnJvIGRlIGVudW0nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbnVtRXJyb3IgPSBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbih7XG4gICAgICAgIGVycm9yOiAnQmFkIFJlcXVlc3QnLFxuICAgICAgICBtZXNzYWdlOiBbXG4gICAgICAgICAgJ3N0YXR1cyBtdXN0IGJlIG9uZSBvZiB0aGUgZm9sbG93aW5nIHZhbHVlcyBbQVRJVk8sIElOQVRJVk8sIFBFTkRFTlRFXScsXG4gICAgICAgIF0sXG4gICAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrQ2FsbEhhbmRsZXIuaGFuZGxlID0gamVzdC5mbigoKSA9PiB0aHJvd0Vycm9yKCgpID0+IGVudW1FcnJvcikpO1xuXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBpbnRlcmNlcHRvci5pbnRlcmNlcHQobW9ja0V4ZWN1dGlvbkNvbnRleHQsIG1vY2tDYWxsSGFuZGxlcikudG9Qcm9taXNlKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGVycm9yLmdldFJlc3BvbnNlKCk7XG4gICAgICAgIGNvbnN0IGRldGFpbHMgPSByZXNwb25zZS5kZXRhaWxzO1xuICAgICAgICBcbiAgICAgICAgZXhwZWN0KGRldGFpbHMuc3RhdHVzWzBdKS50b0NvbnRhaW4oJ2RldmUgc2VyIHVtIGRvcyBzZWd1aW50ZXMgdmFsb3JlcycpO1xuICAgICAgICBleHBlY3QoZGV0YWlscy5zdGF0dXNbMF0pLnRvQ29udGFpbignQVRJVk8sIElOQVRJVk8sIFBFTkRFTlRFJyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBtZWxob3JhciBtZW5zYWdlbnMgZGUgZXJybyBkZSB0aXBvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdHlwZUVycm9yID0gbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oe1xuICAgICAgICBlcnJvcjogJ0JhZCBSZXF1ZXN0JyxcbiAgICAgICAgbWVzc2FnZTogW1xuICAgICAgICAgICdpZGFkZSBtdXN0IGJlIGEgbnVtYmVyJyxcbiAgICAgICAgICAnYXRpdm8gbXVzdCBiZSBhIGJvb2xlYW4nLFxuICAgICAgICBdLFxuICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXG4gICAgICB9KTtcblxuICAgICAgbW9ja0NhbGxIYW5kbGVyLmhhbmRsZSA9IGplc3QuZm4oKCkgPT4gdGhyb3dFcnJvcigoKSA9PiB0eXBlRXJyb3IpKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgaW50ZXJjZXB0b3IuaW50ZXJjZXB0KG1vY2tFeGVjdXRpb25Db250ZXh0LCBtb2NrQ2FsbEhhbmRsZXIpLnRvUHJvbWlzZSgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBlcnJvci5nZXRSZXNwb25zZSgpO1xuICAgICAgICBjb25zdCBkZXRhaWxzID0gcmVzcG9uc2UuZGV0YWlscztcbiAgICAgICAgXG4gICAgICAgIGV4cGVjdChkZXRhaWxzLmlkYWRlWzBdKS50b0NvbnRhaW4oJ2RldmUgc2VyIHVtIG7Dum1lcm8nKTtcbiAgICAgICAgZXhwZWN0KGRldGFpbHMuYXRpdm9bMF0pLnRvQ29udGFpbignZGV2ZSBzZXIgdW0gdmVyZGFkZWlybyBvdSBmYWxzbycpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbWVsaG9yYXIgbWVuc2FnZW5zIGRlIGVycm8gZGUgdGFtYW5obycsIChkb25lKSA9PiB7XG4gICAgICBjb25zdCBsZW5ndGhFcnJvciA9IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKHtcbiAgICAgICAgZXJyb3I6ICdCYWQgUmVxdWVzdCcsXG4gICAgICAgIG1lc3NhZ2U6IFtcbiAgICAgICAgICAnbm9tZSBtdXN0IGJlIGxvbmdlciB0aGFuIDIgY2hhcmFjdGVycycsXG4gICAgICAgICAgJ2Rlc2NyaWNhbyBtdXN0IGJlIHNob3J0ZXIgdGhhbiAxMDAgY2hhcmFjdGVycycsXG4gICAgICAgIF0sXG4gICAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrQ2FsbEhhbmRsZXIuaGFuZGxlID0gamVzdC5mbigoKSA9PiB0aHJvd0Vycm9yKCgpID0+IGxlbmd0aEVycm9yKSk7XG5cbiAgICAgIGludGVyY2VwdG9yLmludGVyY2VwdChtb2NrRXhlY3V0aW9uQ29udGV4dCwgbW9ja0NhbGxIYW5kbGVyKS5zdWJzY3JpYmUoe1xuICAgICAgICBlcnJvcjogKGVycm9yKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gZXJyb3IuZ2V0UmVzcG9uc2UoKTtcbiAgICAgICAgICAgIGNvbnN0IGRldGFpbHMgPSByZXNwb25zZS5kZXRhaWxzO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QoZGV0YWlscy5ub21lWzBdKS50b0NvbnRhaW4oJ2RldmUgdGVyIG1haXMgZGUgMiBjYXJhY3RlcmVzJyk7XG4gICAgICAgICAgICBleHBlY3QoZGV0YWlscy5kZXNjcmljYW9bMF0pLnRvQ29udGFpbignZGV2ZSB0ZXIgbWVub3MgZGUgMTAwIGNhcmFjdGVyZXMnKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGRvbmUoZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBtZWxob3JhciBtZW5zYWdlbnMgZGUgZXJybyBudW3DqXJpY28nLCAoZG9uZSkgPT4ge1xuICAgICAgY29uc3QgbnVtZXJpY0Vycm9yID0gbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oe1xuICAgICAgICBlcnJvcjogJ0JhZCBSZXF1ZXN0JyxcbiAgICAgICAgbWVzc2FnZTogW1xuICAgICAgICAgICdpZGFkZSBtdXN0IG5vdCBiZSBsZXNzIHRoYW4gMTgnLFxuICAgICAgICAgICdzYWxhcmlvIG11c3Qgbm90IGJlIGdyZWF0ZXIgdGhhbiA1MDAwMCcsXG4gICAgICAgIF0sXG4gICAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrQ2FsbEhhbmRsZXIuaGFuZGxlID0gamVzdC5mbigoKSA9PiB0aHJvd0Vycm9yKCgpID0+IG51bWVyaWNFcnJvcikpO1xuXG4gICAgICBpbnRlcmNlcHRvci5pbnRlcmNlcHQobW9ja0V4ZWN1dGlvbkNvbnRleHQsIG1vY2tDYWxsSGFuZGxlcikuc3Vic2NyaWJlKHtcbiAgICAgICAgZXJyb3I6IChlcnJvcikgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGVycm9yLmdldFJlc3BvbnNlKCk7XG4gICAgICAgICAgICBjb25zdCBkZXRhaWxzID0gcmVzcG9uc2UuZGV0YWlscztcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KGRldGFpbHMuaWRhZGVbMF0pLnRvQ29udGFpbignZGV2ZSBzZXIgbWFpb3Igb3UgaWd1YWwgYSAxOCcpO1xuICAgICAgICAgICAgZXhwZWN0KGRldGFpbHMuc2FsYXJpb1swXSkudG9Db250YWluKCdkZXZlIHNlciBtZW5vciBvdSBpZ3VhbCBhIDUwMDAwJyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBkb25lKGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcGFzc2FyIGRhZG9zIHbDoWxpZG9zIHNlbSBtb2RpZmljYcOnw6NvJywgKGRvbmUpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkRGF0YSA9IHsgaWQ6IDEsIG5vbWU6ICdUZXN0ZScgfTtcbiAgICAgIG1vY2tDYWxsSGFuZGxlci5oYW5kbGUgPSBqZXN0LmZuKCgpID0+IG9mKHZhbGlkRGF0YSkpO1xuXG4gICAgICBpbnRlcmNlcHRvci5pbnRlcmNlcHQobW9ja0V4ZWN1dGlvbkNvbnRleHQsIG1vY2tDYWxsSGFuZGxlcikuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKGRhdGEpID0+IHtcbiAgICAgICAgICBleHBlY3QoZGF0YSkudG9CZSh2YWxpZERhdGEpO1xuICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXInLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdyZXF1aXJlZCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBjcmlhciBtZW5zYWdlbSBwYXJhIGNhbXBvIG9icmlnYXTDs3JpbycsICgpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBWYWxpZGF0aW9uTWVzc2FnZUhlbHBlci5yZXF1aXJlZCgnbm9tZScpO1xuICAgICAgZXhwZWN0KG1lc3NhZ2UpLnRvQmUoXCJPIGNhbXBvICdub21lJyDDqSBvYnJpZ2F0w7NyaW9cIik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbnZhbGlkVHlwZScsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBjcmlhciBtZW5zYWdlbSBwYXJhIHRpcG8gaW52w6FsaWRvJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IFZhbGlkYXRpb25NZXNzYWdlSGVscGVyLmludmFsaWRUeXBlKCdpZGFkZScsICdudW1iZXInKTtcbiAgICAgIGV4cGVjdChtZXNzYWdlKS50b0JlKFwiTyBjYW1wbyAnaWRhZGUnIGRldmUgc2VyIG7Dum1lcm9cIik7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBtYXBlYXIgdGlwb3MgZW0gaW5nbMOqcyBwYXJhIHBvcnR1Z3XDqnMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXIuaW52YWxpZFR5cGUoJ2NhbXBvJywgJ3N0cmluZycpKVxuICAgICAgICAudG9CZShcIk8gY2FtcG8gJ2NhbXBvJyBkZXZlIHNlciB0ZXh0b1wiKTtcbiAgICAgIGV4cGVjdChWYWxpZGF0aW9uTWVzc2FnZUhlbHBlci5pbnZhbGlkVHlwZSgnY2FtcG8nLCAnYm9vbGVhbicpKVxuICAgICAgICAudG9CZShcIk8gY2FtcG8gJ2NhbXBvJyBkZXZlIHNlciB2ZXJkYWRlaXJvIG91IGZhbHNvXCIpO1xuICAgICAgZXhwZWN0KFZhbGlkYXRpb25NZXNzYWdlSGVscGVyLmludmFsaWRUeXBlKCdjYW1wbycsICdlbWFpbCcpKVxuICAgICAgICAudG9CZShcIk8gY2FtcG8gJ2NhbXBvJyBkZXZlIHNlciBlbWFpbCB2w6FsaWRvXCIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaW52YWxpZExlbmd0aCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBjcmlhciBtZW5zYWdlbSBwYXJhIHRhbWFuaG8gY29tIG1pbiBlIG1heCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBWYWxpZGF0aW9uTWVzc2FnZUhlbHBlci5pbnZhbGlkTGVuZ3RoKCdub21lJywgMiwgNTApO1xuICAgICAgZXhwZWN0KG1lc3NhZ2UpLnRvQmUoXCJPIGNhbXBvICdub21lJyBkZXZlIHRlciBlbnRyZSAyIGUgNTAgY2FyYWN0ZXJlc1wiKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGNyaWFyIG1lbnNhZ2VtIGFwZW5hcyBwYXJhIG3DrW5pbW8nLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXIuaW52YWxpZExlbmd0aCgnbm9tZScsIDIpO1xuICAgICAgZXhwZWN0KG1lc3NhZ2UpLnRvQmUoXCJPIGNhbXBvICdub21lJyBkZXZlIHRlciBwZWxvIG1lbm9zIDIgY2FyYWN0ZXJlc1wiKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGNyaWFyIG1lbnNhZ2VtIGFwZW5hcyBwYXJhIG3DoXhpbW8nLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXIuaW52YWxpZExlbmd0aCgnbm9tZScsIHVuZGVmaW5lZCwgNTApO1xuICAgICAgZXhwZWN0KG1lc3NhZ2UpLnRvQmUoXCJPIGNhbXBvICdub21lJyBkZXZlIHRlciBubyBtw6F4aW1vIDUwIGNhcmFjdGVyZXNcIik7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBjcmlhciBtZW5zYWdlbSBnZW7DqXJpY2EgcXVhbmRvIG7Do28gaMOhIGxpbWl0ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXIuaW52YWxpZExlbmd0aCgnbm9tZScpO1xuICAgICAgZXhwZWN0KG1lc3NhZ2UpLnRvQmUoXCJPIGNhbXBvICdub21lJyB0ZW0gdGFtYW5obyBpbnbDoWxpZG9cIik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbnZhbGlkUmFuZ2UnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgY3JpYXIgbWVuc2FnZW0gcGFyYSBpbnRlcnZhbG8gY29tIG1pbiBlIG1heCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBWYWxpZGF0aW9uTWVzc2FnZUhlbHBlci5pbnZhbGlkUmFuZ2UoJ2lkYWRlJywgMTgsIDY1KTtcbiAgICAgIGV4cGVjdChtZXNzYWdlKS50b0JlKFwiTyBjYW1wbyAnaWRhZGUnIGRldmUgZXN0YXIgZW50cmUgMTggZSA2NVwiKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGNyaWFyIG1lbnNhZ2VtIGFwZW5hcyBwYXJhIG3DrW5pbW8nLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXIuaW52YWxpZFJhbmdlKCdpZGFkZScsIDE4KTtcbiAgICAgIGV4cGVjdChtZXNzYWdlKS50b0JlKFwiTyBjYW1wbyAnaWRhZGUnIGRldmUgc2VyIG1haW9yIG91IGlndWFsIGEgMThcIik7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBjcmlhciBtZW5zYWdlbSBhcGVuYXMgcGFyYSBtw6F4aW1vJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IFZhbGlkYXRpb25NZXNzYWdlSGVscGVyLmludmFsaWRSYW5nZSgnaWRhZGUnLCB1bmRlZmluZWQsIDY1KTtcbiAgICAgIGV4cGVjdChtZXNzYWdlKS50b0JlKFwiTyBjYW1wbyAnaWRhZGUnIGRldmUgc2VyIG1lbm9yIG91IGlndWFsIGEgNjVcIik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbnZhbGlkRm9ybWF0JywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGNyaWFyIG1lbnNhZ2VtIHBhcmEgZm9ybWF0byBpbnbDoWxpZG8nLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXIuaW52YWxpZEZvcm1hdCgnZW1haWwnLCAnZW1haWwnKTtcbiAgICAgIGV4cGVjdChtZXNzYWdlKS50b0JlKFwiTyBjYW1wbyAnZW1haWwnIGRldmUgdGVyIG8gZm9ybWF0bzogZW1haWwgdsOhbGlkbyAoZXhlbXBsbzogdXN1YXJpb0Bkb21pbmlvLmNvbSlcIik7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBtYXBlYXIgZm9ybWF0b3MgY29uaGVjaWRvcycsICgpID0+IHtcbiAgICAgIGV4cGVjdChWYWxpZGF0aW9uTWVzc2FnZUhlbHBlci5pbnZhbGlkRm9ybWF0KCdjcGYnLCAnY3BmJykpXG4gICAgICAgIC50b0NvbnRhaW4oJ0NQRiB2w6FsaWRvIChleGVtcGxvOiAxMjMuNDU2Ljc4OS0wMCknKTtcbiAgICAgIGV4cGVjdChWYWxpZGF0aW9uTWVzc2FnZUhlbHBlci5pbnZhbGlkRm9ybWF0KCd0ZWxlZm9uZScsICdwaG9uZScpKVxuICAgICAgICAudG9Db250YWluKCd0ZWxlZm9uZSB2w6FsaWRvIChleGVtcGxvOiAoMTEpIDk5OTk5LTk5OTkpJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSB1c2FyIGZvcm1hdG8gb3JpZ2luYWwgc2UgbsOjbyBtYXBlYWRvJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IFZhbGlkYXRpb25NZXNzYWdlSGVscGVyLmludmFsaWRGb3JtYXQoJ2NhbXBvJywgJ2Zvcm1hdG9fY3VzdG9taXphZG8nKTtcbiAgICAgIGV4cGVjdChtZXNzYWdlKS50b0JlKFwiTyBjYW1wbyAnY2FtcG8nIGRldmUgdGVyIG8gZm9ybWF0bzogZm9ybWF0b19jdXN0b21pemFkb1wiKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=