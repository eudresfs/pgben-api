{"file":"C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\shared\\modules\\resilience.module.ts","mappings":"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","names":[],"sources":["C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\shared\\modules\\resilience.module.ts"],"sourcesContent":["import { Global, Module, forwardRef } from '@nestjs/common';\nimport { ConfigModule } from '@nestjs/config';\nimport { ScheduleModule } from '@nestjs/schedule';\nimport { ResilientAuditoriaService } from '../services/resilient-auditoria.service';\nimport { HybridCacheService } from '../services/hybrid-cache.service';\nimport { HealthCheckService } from '../services/health-check.service';\nimport { CacheModule } from '../cache/cache.module';\n/**\n * Módulo de Resiliência\n *\n * Centraliza todos os serviços relacionados à resiliência do sistema:\n * - Cache híbrido com múltiplas camadas\n * - Auditoria resiliente com fallbacks\n * - Health checks e monitoramento\n * - Configurações de resiliência\n *\n * Este módulo é global para estar disponível em toda a aplicação\n */\n@Global()\n@Module({\n  imports: [\n    ConfigModule,\n    ScheduleModule.forRoot(), // Para jobs de recuperação e cache warming\n    CacheModule,\n  ],\n  providers: [\n    HealthCheckService,\n    HybridCacheService,\n    ResilientAuditoriaService,\n    {\n      provide: 'RESILIENCE_CONFIG',\n      useFactory: () => ({\n        // Configurações de Cache\n        cache: {\n          l1MaxSize: parseInt(process.env.CACHE_L1_MAX_SIZE || '1000'),\n          defaultTtl: parseInt(process.env.CACHE_DEFAULT_TTL || '300000'), // 5 minutos\n          enableL2: process.env.CACHE_ENABLE_L2 !== 'false',\n          enableWarming: process.env.CACHE_ENABLE_WARMING !== 'false',\n          warmingInterval: parseInt(\n            process.env.CACHE_WARMING_INTERVAL || '60000',\n          ), // 1 minuto\n        },\n\n        // Configurações de Auditoria\n        auditoria: {\n          enableSyncFallback:\n            process.env.AUDITORIA_ENABLE_SYNC_FALLBACK !== 'false',\n          enableFileBackup:\n            process.env.AUDITORIA_ENABLE_FILE_BACKUP !== 'false',\n          backupPath:\n            process.env.AUDITORIA_BACKUP_PATH || './logs/audit-backup',\n          maxRetries: parseInt(process.env.AUDITORIA_MAX_RETRIES || '3'),\n          retryDelay: parseInt(process.env.AUDITORIA_RETRY_DELAY || '1000'),\n          recoveryInterval:\n            process.env.AUDITORIA_RECOVERY_INTERVAL || '0 */5 * * * *', // A cada 5 minutos\n        },\n\n        // Configurações de Health Check\n        healthCheck: {\n          redisTimeout: parseInt(process.env.HEALTH_REDIS_TIMEOUT || '5000'),\n          dbTimeout: parseInt(process.env.HEALTH_DB_TIMEOUT || '10000'),\n          checkInterval: parseInt(process.env.HEALTH_CHECK_INTERVAL || '30000'), // 30 segundos\n          enableDetailedChecks:\n            process.env.HEALTH_ENABLE_DETAILED_CHECKS !== 'false',\n        },\n\n        // Configurações de Circuit Breaker\n        circuitBreaker: {\n          failureThreshold: parseInt(\n            process.env.CIRCUIT_BREAKER_FAILURE_THRESHOLD || '5',\n          ),\n          recoveryTimeout: parseInt(\n            process.env.CIRCUIT_BREAKER_RECOVERY_TIMEOUT || '60000',\n          ), // 1 minuto\n          monitoringPeriod: parseInt(\n            process.env.CIRCUIT_BREAKER_MONITORING_PERIOD || '10000',\n          ), // 10 segundos\n        },\n\n        // Configurações de Monitoramento\n        monitoring: {\n          enableMetrics: process.env.MONITORING_ENABLE_METRICS !== 'false',\n          metricsInterval: parseInt(\n            process.env.MONITORING_METRICS_INTERVAL || '60000',\n          ), // 1 minuto\n          enableAlerts: process.env.MONITORING_ENABLE_ALERTS !== 'false',\n          alertThresholds: {\n            cacheHitRate: parseFloat(\n              process.env.ALERT_CACHE_HIT_RATE_THRESHOLD || '0.8',\n            ), // 80%\n            auditoriaFailureRate: parseFloat(\n              process.env.ALERT_AUDITORIA_FAILURE_RATE_THRESHOLD || '0.1',\n            ), // 10%\n            redisAvailability: parseFloat(\n              process.env.ALERT_REDIS_AVAILABILITY_THRESHOLD || '0.95',\n            ), // 95%\n          },\n        },\n      }),\n    },\n  ],\n  exports: [\n    HealthCheckService,\n    HybridCacheService,\n    ResilientAuditoriaService,\n    'RESILIENCE_CONFIG',\n  ],\n})\nexport class ResilienceModule {}\n"],"version":3}