85e91c0c1fe80b8dc77ecfa363aee76c
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuthModule = void 0;
// src/auth/auth.module.ts
const common_1 = require("@nestjs/common");
const typeorm_1 = require("@nestjs/typeorm");
const jwt_1 = require("@nestjs/jwt");
const config_1 = require("@nestjs/config");
const cache_manager_1 = require("@nestjs/cache-manager");
const passport_1 = require("@nestjs/passport");
// Controllers
const auth_controller_1 = require("./controllers/auth.controller");
const password_reset_controller_1 = require("./controllers/password-reset.controller");
const jwt_blacklist_controller_1 = require("./controllers/jwt-blacklist.controller");
// Services
const auth_service_1 = require("./services/auth.service");
const refresh_token_service_1 = require("./services/refresh-token.service");
const password_reset_service_1 = require("./services/password-reset.service");
const jwt_blacklist_service_1 = require("./services/jwt-blacklist.service");
const permission_service_1 = require("./services/permission.service");
// Entities
const refresh_token_entity_1 = require("../entities/refresh-token.entity");
const password_reset_token_entity_1 = require("../entities/password-reset-token.entity");
const jwt_blacklist_entity_1 = require("../entities/jwt-blacklist.entity");
// Strategies
const jwt_auth_strategy_1 = require("./strategies/jwt-auth.strategy");
const jwt_refresh_strategy_1 = require("./strategies/jwt-refresh.strategy");
const local_strategy_1 = require("./strategies/local.strategy");
// Guards
const jwt_auth_guard_1 = require("./guards/jwt-auth.guard");
const roles_guard_1 = require("./guards/roles.guard");
const permission_guard_1 = require("./guards/permission.guard");
// Config
const jwt_config_1 = require("../config/jwt.config");
// Modules
const usuario_module_1 = require("../modules/usuario/usuario.module");
const common_2 = require("@nestjs/common");
const audit_module_1 = require("../audit/audit.module");
const logger_module_1 = require("../shared/logger/logger.module");
const permission_module_1 = require("./permission.module");
/**
 * Módulo de Autenticação e Autorização
 *
 * Responsável por:
 * - Autenticação JWT e local
 * - Gerenciamento de tokens de refresh
 * - Recuperação e reset de senhas
 * - Controle de permissões e roles
 * - Blacklist de tokens JWT
 */
let AuthModule = class AuthModule {
    configService;
    /**
     * Configuração opcional para desenvolvimento
     * Remove logs sensíveis em produção
     */
    constructor(configService) {
        this.configService = configService;
        const isDevelopment = this.configService.get('NODE_ENV') !== 'production';
        if (isDevelopment) {
            console.log('AuthModule initialized');
            console.log('Available guards: JWT, Roles, Permission');
            console.log('Available strategies: Local, JWT, Refresh');
        }
    }
};
exports.AuthModule = AuthModule;
exports.AuthModule = AuthModule = __decorate([
    (0, common_1.Module)({
        imports: [
            // Configuração do Passport
            passport_1.PassportModule.register({
                defaultStrategy: 'jwt',
                property: 'user',
                session: false
            }),
            // Entidades do TypeORM
            typeorm_1.TypeOrmModule.forFeature([
                refresh_token_entity_1.RefreshToken,
                password_reset_token_entity_1.PasswordResetToken,
                jwt_blacklist_entity_1.JwtBlacklist,
            ]),
            // Configuração assíncrona do JWT
            jwt_1.JwtModule.registerAsync({
                imports: [config_1.ConfigModule],
                inject: [config_1.ConfigService],
                useFactory: jwt_config_1.createJwtConfig,
                global: true, // Disponibiliza o JwtService globalmente
            }),
            // Configuração do Cache com configurações otimizadas
            cache_manager_1.CacheModule.registerAsync({
                imports: [config_1.ConfigModule],
                inject: [config_1.ConfigService],
                useFactory: (configService) => ({
                    isGlobal: true,
                    ttl: configService.get('CACHE_TTL', 5 * 60 * 1000), // 5 minutos padrão
                    max: configService.get('CACHE_MAX_ITEMS', 1000), // 1000 itens padrão
                    store: 'memory', // Explicitamente definido para clareza
                }),
            }),
            // Módulos da aplicação
            config_1.ConfigModule,
            (0, common_2.forwardRef)(() => usuario_module_1.UsuarioModule),
            (0, common_2.forwardRef)(() => audit_module_1.AuditModule),
            logger_module_1.AppLoggerModule,
            permission_module_1.PermissionModule,
        ],
        controllers: [
            auth_controller_1.AuthController,
            password_reset_controller_1.PasswordResetController,
            jwt_blacklist_controller_1.JwtBlacklistController,
        ],
        providers: [
            // Estratégias (o NestJS gerencia automaticamente com @Injectable)
            local_strategy_1.LocalStrategy,
            jwt_auth_strategy_1.JwtAuthStrategy,
            jwt_refresh_strategy_1.JwtRefreshStrategy,
            // Guards
            jwt_auth_guard_1.JwtAuthGuard,
            roles_guard_1.RolesGuard,
            permission_guard_1.PermissionGuard,
            // Serviços principais
            auth_service_1.AuthService,
            refresh_token_service_1.RefreshTokenService,
            password_reset_service_1.PasswordResetService,
            jwt_blacklist_service_1.JwtBlacklistService,
            permission_service_1.PermissionService,
        ],
        exports: [
            // Serviços essenciais para outros módulos
            auth_service_1.AuthService,
            permission_service_1.PermissionService,
            jwt_blacklist_service_1.JwtBlacklistService,
            // Guards para uso em outros módulos
            jwt_auth_guard_1.JwtAuthGuard,
            roles_guard_1.RolesGuard,
            permission_guard_1.PermissionGuard,
            // Estratégias para extensibilidade
            jwt_auth_strategy_1.JwtAuthStrategy,
            jwt_refresh_strategy_1.JwtRefreshStrategy,
            local_strategy_1.LocalStrategy,
            // Módulo JWT para uso externo
            jwt_1.JwtModule,
            // Passport para configurações avançadas
            passport_1.PassportModule,
        ],
    }),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigService !== "undefined" && config_1.ConfigService) === "function" ? _a : Object])
], AuthModule);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGF1dGhcXGF1dGgubW9kdWxlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSwwQkFBMEI7QUFDMUIsMkNBQXdDO0FBQ3hDLDZDQUFnRDtBQUNoRCxxQ0FBd0M7QUFDeEMsMkNBQTZEO0FBQzdELHlEQUFvRDtBQUNwRCwrQ0FBa0Q7QUFFbEQsY0FBYztBQUNkLG1FQUErRDtBQUMvRCx1RkFBa0Y7QUFDbEYscUZBQWdGO0FBRWhGLFdBQVc7QUFDWCwwREFBc0Q7QUFDdEQsNEVBQXVFO0FBQ3ZFLDhFQUF5RTtBQUN6RSw0RUFBdUU7QUFDdkUsc0VBQWtFO0FBRWxFLFdBQVc7QUFDWCwyRUFBZ0U7QUFDaEUseUZBQTZFO0FBQzdFLDJFQUFnRTtBQUVoRSxhQUFhO0FBQ2Isc0VBQWlFO0FBQ2pFLDRFQUF1RTtBQUN2RSxnRUFBNEQ7QUFFNUQsU0FBUztBQUNULDREQUF1RDtBQUN2RCxzREFBa0Q7QUFDbEQsZ0VBQTREO0FBRTVELFNBQVM7QUFDVCxxREFBdUQ7QUFFdkQsVUFBVTtBQUNWLHNFQUFrRTtBQUNsRSwyQ0FBNEM7QUFDNUMsd0RBQW9EO0FBQ3BELGtFQUFpRTtBQUNqRSwyREFBdUQ7QUFFdkQ7Ozs7Ozs7OztHQVNHO0FBNkZJLElBQU0sVUFBVSxHQUFoQixNQUFNLFVBQVU7SUFLUTtJQUo3Qjs7O09BR0c7SUFDSCxZQUE2QixhQUE0QjtRQUE1QixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUN2RCxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxZQUFZLENBQUM7UUFFMUUsSUFBSSxhQUFhLEVBQUUsQ0FBQztZQUNsQixPQUFPLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLENBQUM7WUFDdEMsT0FBTyxDQUFDLEdBQUcsQ0FBQywwQ0FBMEMsQ0FBQyxDQUFDO1lBQ3hELE9BQU8sQ0FBQyxHQUFHLENBQUMsMkNBQTJDLENBQUMsQ0FBQztRQUMzRCxDQUFDO0lBQ0gsQ0FBQztDQUNGLENBQUE7QUFkWSxnQ0FBVTtxQkFBVixVQUFVO0lBNUZ0QixJQUFBLGVBQU0sRUFBQztRQUNOLE9BQU8sRUFBRTtZQUNQLDJCQUEyQjtZQUMzQix5QkFBYyxDQUFDLFFBQVEsQ0FBQztnQkFDdEIsZUFBZSxFQUFFLEtBQUs7Z0JBQ3RCLFFBQVEsRUFBRSxNQUFNO2dCQUNoQixPQUFPLEVBQUUsS0FBSzthQUNmLENBQUM7WUFFRix1QkFBdUI7WUFDdkIsdUJBQWEsQ0FBQyxVQUFVLENBQUM7Z0JBQ3ZCLG1DQUFZO2dCQUNaLGdEQUFrQjtnQkFDbEIsbUNBQVk7YUFDYixDQUFDO1lBRUYsaUNBQWlDO1lBQ2pDLGVBQVMsQ0FBQyxhQUFhLENBQUM7Z0JBQ3RCLE9BQU8sRUFBRSxDQUFDLHFCQUFZLENBQUM7Z0JBQ3ZCLE1BQU0sRUFBRSxDQUFDLHNCQUFhLENBQUM7Z0JBQ3ZCLFVBQVUsRUFBRSw0QkFBZTtnQkFDM0IsTUFBTSxFQUFFLElBQUksRUFBRSx5Q0FBeUM7YUFDeEQsQ0FBQztZQUVGLHFEQUFxRDtZQUNyRCwyQkFBVyxDQUFDLGFBQWEsQ0FBQztnQkFDeEIsT0FBTyxFQUFFLENBQUMscUJBQVksQ0FBQztnQkFDdkIsTUFBTSxFQUFFLENBQUMsc0JBQWEsQ0FBQztnQkFDdkIsVUFBVSxFQUFFLENBQUMsYUFBNEIsRUFBRSxFQUFFLENBQUMsQ0FBQztvQkFDN0MsUUFBUSxFQUFFLElBQUk7b0JBQ2QsR0FBRyxFQUFFLGFBQWEsQ0FBQyxHQUFHLENBQVMsV0FBVyxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsbUJBQW1CO29CQUMvRSxHQUFHLEVBQUUsYUFBYSxDQUFDLEdBQUcsQ0FBUyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsRUFBRSxvQkFBb0I7b0JBQzdFLEtBQUssRUFBRSxRQUFRLEVBQUUsdUNBQXVDO2lCQUN6RCxDQUFDO2FBQ0gsQ0FBQztZQUVGLHVCQUF1QjtZQUN2QixxQkFBWTtZQUNaLElBQUEsbUJBQVUsRUFBQyxHQUFHLEVBQUUsQ0FBQyw4QkFBYSxDQUFDO1lBQy9CLElBQUEsbUJBQVUsRUFBQyxHQUFHLEVBQUUsQ0FBQywwQkFBVyxDQUFDO1lBQzdCLCtCQUFlO1lBQ2Ysb0NBQWdCO1NBQ2pCO1FBRUQsV0FBVyxFQUFFO1lBQ1gsZ0NBQWM7WUFDZCxtREFBdUI7WUFDdkIsaURBQXNCO1NBQ3ZCO1FBRUQsU0FBUyxFQUFFO1lBQ1Qsa0VBQWtFO1lBQ2xFLDhCQUFhO1lBQ2IsbUNBQWU7WUFDZix5Q0FBa0I7WUFFbEIsU0FBUztZQUNULDZCQUFZO1lBQ1osd0JBQVU7WUFDVixrQ0FBZTtZQUVmLHNCQUFzQjtZQUN0QiwwQkFBVztZQUNYLDJDQUFtQjtZQUNuQiw2Q0FBb0I7WUFDcEIsMkNBQW1CO1lBQ25CLHNDQUFpQjtTQUNsQjtRQUVELE9BQU8sRUFBRTtZQUNQLDBDQUEwQztZQUMxQywwQkFBVztZQUNYLHNDQUFpQjtZQUNqQiwyQ0FBbUI7WUFFbkIsb0NBQW9DO1lBQ3BDLDZCQUFZO1lBQ1osd0JBQVU7WUFDVixrQ0FBZTtZQUVmLG1DQUFtQztZQUNuQyxtQ0FBZTtZQUNmLHlDQUFrQjtZQUNsQiw4QkFBYTtZQUViLDhCQUE4QjtZQUM5QixlQUFTO1lBRVQsd0NBQXdDO1lBQ3hDLHlCQUFjO1NBQ2Y7S0FDRixDQUFDO3lEQU00QyxzQkFBYSxvQkFBYixzQkFBYTtHQUw5QyxVQUFVLENBY3RCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxhdXRoXFxhdXRoLm1vZHVsZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvYXV0aC9hdXRoLm1vZHVsZS50c1xuaW1wb3J0IHsgTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgVHlwZU9ybU1vZHVsZSB9IGZyb20gJ0BuZXN0anMvdHlwZW9ybSc7XG5pbXBvcnQgeyBKd3RNb2R1bGUgfSBmcm9tICdAbmVzdGpzL2p3dCc7XG5pbXBvcnQgeyBDb25maWdNb2R1bGUsIENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZyc7XG5pbXBvcnQgeyBDYWNoZU1vZHVsZSB9IGZyb20gJ0BuZXN0anMvY2FjaGUtbWFuYWdlcic7XG5pbXBvcnQgeyBQYXNzcG9ydE1vZHVsZSB9IGZyb20gJ0BuZXN0anMvcGFzc3BvcnQnO1xuXG4vLyBDb250cm9sbGVyc1xuaW1wb3J0IHsgQXV0aENvbnRyb2xsZXIgfSBmcm9tICcuL2NvbnRyb2xsZXJzL2F1dGguY29udHJvbGxlcic7XG5pbXBvcnQgeyBQYXNzd29yZFJlc2V0Q29udHJvbGxlciB9IGZyb20gJy4vY29udHJvbGxlcnMvcGFzc3dvcmQtcmVzZXQuY29udHJvbGxlcic7XG5pbXBvcnQgeyBKd3RCbGFja2xpc3RDb250cm9sbGVyIH0gZnJvbSAnLi9jb250cm9sbGVycy9qd3QtYmxhY2tsaXN0LmNvbnRyb2xsZXInO1xuXG4vLyBTZXJ2aWNlc1xuaW1wb3J0IHsgQXV0aFNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL2F1dGguc2VydmljZSc7XG5pbXBvcnQgeyBSZWZyZXNoVG9rZW5TZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9yZWZyZXNoLXRva2VuLnNlcnZpY2UnO1xuaW1wb3J0IHsgUGFzc3dvcmRSZXNldFNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL3Bhc3N3b3JkLXJlc2V0LnNlcnZpY2UnO1xuaW1wb3J0IHsgSnd0QmxhY2tsaXN0U2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvand0LWJsYWNrbGlzdC5zZXJ2aWNlJztcbmltcG9ydCB7IFBlcm1pc3Npb25TZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9wZXJtaXNzaW9uLnNlcnZpY2UnO1xuXG4vLyBFbnRpdGllc1xuaW1wb3J0IHsgUmVmcmVzaFRva2VuIH0gZnJvbSAnLi4vZW50aXRpZXMvcmVmcmVzaC10b2tlbi5lbnRpdHknO1xuaW1wb3J0IHsgUGFzc3dvcmRSZXNldFRva2VuIH0gZnJvbSAnLi4vZW50aXRpZXMvcGFzc3dvcmQtcmVzZXQtdG9rZW4uZW50aXR5JztcbmltcG9ydCB7IEp3dEJsYWNrbGlzdCB9IGZyb20gJy4uL2VudGl0aWVzL2p3dC1ibGFja2xpc3QuZW50aXR5JztcblxuLy8gU3RyYXRlZ2llc1xuaW1wb3J0IHsgSnd0QXV0aFN0cmF0ZWd5IH0gZnJvbSAnLi9zdHJhdGVnaWVzL2p3dC1hdXRoLnN0cmF0ZWd5JztcbmltcG9ydCB7IEp3dFJlZnJlc2hTdHJhdGVneSB9IGZyb20gJy4vc3RyYXRlZ2llcy9qd3QtcmVmcmVzaC5zdHJhdGVneSc7XG5pbXBvcnQgeyBMb2NhbFN0cmF0ZWd5IH0gZnJvbSAnLi9zdHJhdGVnaWVzL2xvY2FsLnN0cmF0ZWd5JztcblxuLy8gR3VhcmRzXG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuL2d1YXJkcy9qd3QtYXV0aC5ndWFyZCc7XG5pbXBvcnQgeyBSb2xlc0d1YXJkIH0gZnJvbSAnLi9ndWFyZHMvcm9sZXMuZ3VhcmQnO1xuaW1wb3J0IHsgUGVybWlzc2lvbkd1YXJkIH0gZnJvbSAnLi9ndWFyZHMvcGVybWlzc2lvbi5ndWFyZCc7XG5cbi8vIENvbmZpZ1xuaW1wb3J0IHsgY3JlYXRlSnd0Q29uZmlnIH0gZnJvbSAnLi4vY29uZmlnL2p3dC5jb25maWcnO1xuXG4vLyBNb2R1bGVzXG5pbXBvcnQgeyBVc3VhcmlvTW9kdWxlIH0gZnJvbSAnLi4vbW9kdWxlcy91c3VhcmlvL3VzdWFyaW8ubW9kdWxlJztcbmltcG9ydCB7IGZvcndhcmRSZWYgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBBdWRpdE1vZHVsZSB9IGZyb20gJy4uL2F1ZGl0L2F1ZGl0Lm1vZHVsZSc7XG5pbXBvcnQgeyBBcHBMb2dnZXJNb2R1bGUgfSBmcm9tICcuLi9zaGFyZWQvbG9nZ2VyL2xvZ2dlci5tb2R1bGUnO1xuaW1wb3J0IHsgUGVybWlzc2lvbk1vZHVsZSB9IGZyb20gJy4vcGVybWlzc2lvbi5tb2R1bGUnO1xuXG4vKipcbiAqIE3Ds2R1bG8gZGUgQXV0ZW50aWNhw6fDo28gZSBBdXRvcml6YcOnw6NvXG4gKiBcbiAqIFJlc3BvbnPDoXZlbCBwb3I6XG4gKiAtIEF1dGVudGljYcOnw6NvIEpXVCBlIGxvY2FsXG4gKiAtIEdlcmVuY2lhbWVudG8gZGUgdG9rZW5zIGRlIHJlZnJlc2hcbiAqIC0gUmVjdXBlcmHDp8OjbyBlIHJlc2V0IGRlIHNlbmhhc1xuICogLSBDb250cm9sZSBkZSBwZXJtaXNzw7VlcyBlIHJvbGVzXG4gKiAtIEJsYWNrbGlzdCBkZSB0b2tlbnMgSldUXG4gKi9cbkBNb2R1bGUoe1xuICBpbXBvcnRzOiBbXG4gICAgLy8gQ29uZmlndXJhw6fDo28gZG8gUGFzc3BvcnRcbiAgICBQYXNzcG9ydE1vZHVsZS5yZWdpc3Rlcih7IFxuICAgICAgZGVmYXVsdFN0cmF0ZWd5OiAnand0JyxcbiAgICAgIHByb3BlcnR5OiAndXNlcicsXG4gICAgICBzZXNzaW9uOiBmYWxzZSBcbiAgICB9KSxcblxuICAgIC8vIEVudGlkYWRlcyBkbyBUeXBlT1JNXG4gICAgVHlwZU9ybU1vZHVsZS5mb3JGZWF0dXJlKFtcbiAgICAgIFJlZnJlc2hUb2tlbixcbiAgICAgIFBhc3N3b3JkUmVzZXRUb2tlbixcbiAgICAgIEp3dEJsYWNrbGlzdCxcbiAgICBdKSxcblxuICAgIC8vIENvbmZpZ3VyYcOnw6NvIGFzc8OtbmNyb25hIGRvIEpXVFxuICAgIEp3dE1vZHVsZS5yZWdpc3RlckFzeW5jKHtcbiAgICAgIGltcG9ydHM6IFtDb25maWdNb2R1bGVdLFxuICAgICAgaW5qZWN0OiBbQ29uZmlnU2VydmljZV0sXG4gICAgICB1c2VGYWN0b3J5OiBjcmVhdGVKd3RDb25maWcsXG4gICAgICBnbG9iYWw6IHRydWUsIC8vIERpc3BvbmliaWxpemEgbyBKd3RTZXJ2aWNlIGdsb2JhbG1lbnRlXG4gICAgfSksXG5cbiAgICAvLyBDb25maWd1cmHDp8OjbyBkbyBDYWNoZSBjb20gY29uZmlndXJhw6fDtWVzIG90aW1pemFkYXNcbiAgICBDYWNoZU1vZHVsZS5yZWdpc3RlckFzeW5jKHtcbiAgICAgIGltcG9ydHM6IFtDb25maWdNb2R1bGVdLFxuICAgICAgaW5qZWN0OiBbQ29uZmlnU2VydmljZV0sXG4gICAgICB1c2VGYWN0b3J5OiAoY29uZmlnU2VydmljZTogQ29uZmlnU2VydmljZSkgPT4gKHtcbiAgICAgICAgaXNHbG9iYWw6IHRydWUsXG4gICAgICAgIHR0bDogY29uZmlnU2VydmljZS5nZXQ8bnVtYmVyPignQ0FDSEVfVFRMJywgNSAqIDYwICogMTAwMCksIC8vIDUgbWludXRvcyBwYWRyw6NvXG4gICAgICAgIG1heDogY29uZmlnU2VydmljZS5nZXQ8bnVtYmVyPignQ0FDSEVfTUFYX0lURU1TJywgMTAwMCksIC8vIDEwMDAgaXRlbnMgcGFkcsOjb1xuICAgICAgICBzdG9yZTogJ21lbW9yeScsIC8vIEV4cGxpY2l0YW1lbnRlIGRlZmluaWRvIHBhcmEgY2xhcmV6YVxuICAgICAgfSksXG4gICAgfSksXG5cbiAgICAvLyBNw7NkdWxvcyBkYSBhcGxpY2HDp8Ojb1xuICAgIENvbmZpZ01vZHVsZSxcbiAgICBmb3J3YXJkUmVmKCgpID0+IFVzdWFyaW9Nb2R1bGUpLFxuICAgIGZvcndhcmRSZWYoKCkgPT4gQXVkaXRNb2R1bGUpLFxuICAgIEFwcExvZ2dlck1vZHVsZSxcbiAgICBQZXJtaXNzaW9uTW9kdWxlLFxuICBdLFxuXG4gIGNvbnRyb2xsZXJzOiBbXG4gICAgQXV0aENvbnRyb2xsZXIsXG4gICAgUGFzc3dvcmRSZXNldENvbnRyb2xsZXIsXG4gICAgSnd0QmxhY2tsaXN0Q29udHJvbGxlcixcbiAgXSxcblxuICBwcm92aWRlcnM6IFtcbiAgICAvLyBFc3RyYXTDqWdpYXMgKG8gTmVzdEpTIGdlcmVuY2lhIGF1dG9tYXRpY2FtZW50ZSBjb20gQEluamVjdGFibGUpXG4gICAgTG9jYWxTdHJhdGVneSxcbiAgICBKd3RBdXRoU3RyYXRlZ3ksXG4gICAgSnd0UmVmcmVzaFN0cmF0ZWd5LFxuXG4gICAgLy8gR3VhcmRzXG4gICAgSnd0QXV0aEd1YXJkLFxuICAgIFJvbGVzR3VhcmQsXG4gICAgUGVybWlzc2lvbkd1YXJkLFxuXG4gICAgLy8gU2VydmnDp29zIHByaW5jaXBhaXNcbiAgICBBdXRoU2VydmljZSxcbiAgICBSZWZyZXNoVG9rZW5TZXJ2aWNlLFxuICAgIFBhc3N3b3JkUmVzZXRTZXJ2aWNlLFxuICAgIEp3dEJsYWNrbGlzdFNlcnZpY2UsXG4gICAgUGVybWlzc2lvblNlcnZpY2UsXG4gIF0sXG5cbiAgZXhwb3J0czogW1xuICAgIC8vIFNlcnZpw6dvcyBlc3NlbmNpYWlzIHBhcmEgb3V0cm9zIG3Ds2R1bG9zXG4gICAgQXV0aFNlcnZpY2UsXG4gICAgUGVybWlzc2lvblNlcnZpY2UsXG4gICAgSnd0QmxhY2tsaXN0U2VydmljZSxcblxuICAgIC8vIEd1YXJkcyBwYXJhIHVzbyBlbSBvdXRyb3MgbcOzZHVsb3NcbiAgICBKd3RBdXRoR3VhcmQsXG4gICAgUm9sZXNHdWFyZCxcbiAgICBQZXJtaXNzaW9uR3VhcmQsXG5cbiAgICAvLyBFc3RyYXTDqWdpYXMgcGFyYSBleHRlbnNpYmlsaWRhZGVcbiAgICBKd3RBdXRoU3RyYXRlZ3ksXG4gICAgSnd0UmVmcmVzaFN0cmF0ZWd5LFxuICAgIExvY2FsU3RyYXRlZ3ksXG5cbiAgICAvLyBNw7NkdWxvIEpXVCBwYXJhIHVzbyBleHRlcm5vXG4gICAgSnd0TW9kdWxlLFxuXG4gICAgLy8gUGFzc3BvcnQgcGFyYSBjb25maWd1cmHDp8O1ZXMgYXZhbsOnYWRhc1xuICAgIFBhc3Nwb3J0TW9kdWxlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBBdXRoTW9kdWxlIHtcbiAgLyoqXG4gICAqIENvbmZpZ3VyYcOnw6NvIG9wY2lvbmFsIHBhcmEgZGVzZW52b2x2aW1lbnRvXG4gICAqIFJlbW92ZSBsb2dzIHNlbnPDrXZlaXMgZW0gcHJvZHXDp8Ojb1xuICAgKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBjb25maWdTZXJ2aWNlOiBDb25maWdTZXJ2aWNlKSB7XG4gICAgY29uc3QgaXNEZXZlbG9wbWVudCA9IHRoaXMuY29uZmlnU2VydmljZS5nZXQoJ05PREVfRU5WJykgIT09ICdwcm9kdWN0aW9uJztcbiAgICBcbiAgICBpZiAoaXNEZXZlbG9wbWVudCkge1xuICAgICAgY29uc29sZS5sb2coJ0F1dGhNb2R1bGUgaW5pdGlhbGl6ZWQnKTtcbiAgICAgIGNvbnNvbGUubG9nKCdBdmFpbGFibGUgZ3VhcmRzOiBKV1QsIFJvbGVzLCBQZXJtaXNzaW9uJyk7XG4gICAgICBjb25zb2xlLmxvZygnQXZhaWxhYmxlIHN0cmF0ZWdpZXM6IExvY2FsLCBKV1QsIFJlZnJlc2gnKTtcbiAgICB9XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=