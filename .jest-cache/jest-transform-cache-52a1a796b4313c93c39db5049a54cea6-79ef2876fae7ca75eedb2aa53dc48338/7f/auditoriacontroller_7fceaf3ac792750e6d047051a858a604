a8dc992457838fb014e5366ce3f002ba
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuditoriaController = void 0;
const common_1 = require("@nestjs/common");
const swagger_1 = require("@nestjs/swagger");
const auditoria_service_1 = require("../services/auditoria.service");
const create_log_auditoria_dto_1 = require("../dto/create-log-auditoria.dto");
const query_log_auditoria_dto_1 = require("../dto/query-log-auditoria.dto");
const jwt_auth_guard_1 = require("../../../auth/guards/jwt-auth.guard");
const permission_guard_1 = require("../../../auth/guards/permission.guard");
const requires_permission_decorator_1 = require("../../../auth/decorators/requires-permission.decorator");
const user_permission_entity_1 = require("../../../entities/user-permission.entity");
/**
 * Controlador de Auditoria
 *
 * Responsável por expor as funcionalidades de auditoria via API REST.
 * Permite consultar logs de auditoria e gerar relatórios.
 */
let AuditoriaController = class AuditoriaController {
    auditoriaService;
    constructor(auditoriaService) {
        this.auditoriaService = auditoriaService;
    }
    /**
     * Cria um novo log de auditoria manualmente
     * Normalmente os logs são criados automaticamente pelo middleware
     */
    create(createLogAuditoriaDto, req) {
        // Adiciona informações do usuário logado
        if (!createLogAuditoriaDto.usuario_id && req.user) {
            createLogAuditoriaDto.usuario_id = req.user.id;
        }
        // Adiciona informações da requisição
        if (!createLogAuditoriaDto.ip_origem) {
            createLogAuditoriaDto.ip_origem = req.ip;
        }
        if (!createLogAuditoriaDto.user_agent) {
            createLogAuditoriaDto.user_agent = req.headers['user-agent'];
        }
        return this.auditoriaService.create(createLogAuditoriaDto);
    }
    /**
     * Busca logs de auditoria com base nos filtros fornecidos
     */
    findAll(queryParams) {
        return this.auditoriaService.findAll(queryParams);
    }
    /**
     * Busca um log de auditoria pelo ID
     */
    findOne(id) {
        return this.auditoriaService.findOne(id);
    }
    /**
     * Busca logs de auditoria por entidade
     */
    findByEntidade(entidade, id) {
        return this.auditoriaService.findByEntidade(entidade, id);
    }
    /**
     * Busca logs de auditoria por usuário
     */
    findByUsuario(id) {
        return this.auditoriaService.findByUsuario(id);
    }
    /**
     * Gera relatório de acessos a dados sensíveis por período
     */
    relatorioAcessosDadosSensiveis(dataInicial, dataFinal) {
        return this.auditoriaService.relatorioAcessosDadosSensiveis(new Date(dataInicial), new Date(dataFinal));
    }
};
exports.AuditoriaController = AuditoriaController;
__decorate([
    (0, common_1.Post)(),
    (0, requires_permission_decorator_1.RequiresPermission)({
        permissionName: 'auditoria.log.criar',
        scopeType: user_permission_entity_1.ScopeType.GLOBAL
    }),
    (0, swagger_1.ApiOperation)({ summary: 'Cria um novo log de auditoria manualmente' }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Log de auditoria criado com sucesso',
    }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' }),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, common_1.Req)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof create_log_auditoria_dto_1.CreateLogAuditoriaDto !== "undefined" && create_log_auditoria_dto_1.CreateLogAuditoriaDto) === "function" ? _b : Object, Object]),
    __metadata("design:returntype", void 0)
], AuditoriaController.prototype, "create", null);
__decorate([
    (0, common_1.Get)(),
    (0, requires_permission_decorator_1.RequiresPermission)({
        permissionName: 'auditoria.log.listar',
        scopeType: user_permission_entity_1.ScopeType.GLOBAL
    }),
    (0, swagger_1.ApiOperation)({ summary: 'Busca logs de auditoria' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Lista de logs de auditoria' }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' }),
    __param(0, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof query_log_auditoria_dto_1.QueryLogAuditoriaDto !== "undefined" && query_log_auditoria_dto_1.QueryLogAuditoriaDto) === "function" ? _c : Object]),
    __metadata("design:returntype", void 0)
], AuditoriaController.prototype, "findAll", null);
__decorate([
    (0, common_1.Get)(':id'),
    (0, requires_permission_decorator_1.RequiresPermission)({
        permissionName: 'auditoria.log.visualizar',
        scopeType: user_permission_entity_1.ScopeType.GLOBAL
    }),
    (0, swagger_1.ApiOperation)({ summary: 'Busca um log de auditoria pelo ID' }),
    (0, swagger_1.ApiParam)({ name: 'id', description: 'ID do log de auditoria' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Log de auditoria encontrado' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Log de auditoria não encontrado' }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' }),
    __param(0, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], AuditoriaController.prototype, "findOne", null);
__decorate([
    (0, common_1.Get)('entidade/:entidade/:id'),
    (0, requires_permission_decorator_1.RequiresPermission)({
        permissionName: 'auditoria.log.entidade.visualizar',
        scopeType: user_permission_entity_1.ScopeType.GLOBAL
    }),
    (0, swagger_1.ApiOperation)({ summary: 'Busca logs de auditoria por entidade' }),
    (0, swagger_1.ApiParam)({ name: 'entidade', description: 'Nome da entidade' }),
    (0, swagger_1.ApiParam)({ name: 'id', description: 'ID da entidade' }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Lista de logs de auditoria da entidade',
    }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' }),
    __param(0, (0, common_1.Param)('entidade')),
    __param(1, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", void 0)
], AuditoriaController.prototype, "findByEntidade", null);
__decorate([
    (0, common_1.Get)('usuario/:id'),
    (0, requires_permission_decorator_1.RequiresPermission)({
        permissionName: 'auditoria.log.usuario.visualizar',
        scopeType: user_permission_entity_1.ScopeType.GLOBAL
    }),
    (0, swagger_1.ApiOperation)({ summary: 'Busca logs de auditoria por usuário' }),
    (0, swagger_1.ApiParam)({ name: 'id', description: 'ID do usuário' }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Lista de logs de auditoria do usuário',
    }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' }),
    __param(0, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], AuditoriaController.prototype, "findByUsuario", null);
__decorate([
    (0, common_1.Get)('relatorios/dados-sensiveis'),
    (0, requires_permission_decorator_1.RequiresPermission)({
        permissionName: 'auditoria.relatorio.dados-sensiveis',
        scopeType: user_permission_entity_1.ScopeType.GLOBAL
    }),
    (0, swagger_1.ApiOperation)({
        summary: 'Gera relatório de acessos a dados sensíveis por período',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'data_inicial',
        description: 'Data inicial (formato ISO)',
        required: true,
    }),
    (0, swagger_1.ApiQuery)({
        name: 'data_final',
        description: 'Data final (formato ISO)',
        required: true,
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Relatório de acessos a dados sensíveis',
    }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' }),
    __param(0, (0, common_1.Query)('data_inicial')),
    __param(1, (0, common_1.Query)('data_final')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, String]),
    __metadata("design:returntype", void 0)
], AuditoriaController.prototype, "relatorioAcessosDadosSensiveis", null);
exports.AuditoriaController = AuditoriaController = __decorate([
    (0, swagger_1.ApiTags)('Auditoria'),
    (0, common_1.Controller)('auditoria'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, permission_guard_1.PermissionGuard),
    (0, swagger_1.ApiBearerAuth)(),
    __metadata("design:paramtypes", [typeof (_a = typeof auditoria_service_1.AuditoriaService !== "undefined" && auditoria_service_1.AuditoriaService) === "function" ? _a : Object])
], AuditoriaController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGF1ZGl0b3JpYVxcY29udHJvbGxlcnNcXGF1ZGl0b3JpYS5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FVd0I7QUFDeEIsNkNBT3lCO0FBQ3pCLHFFQUFpRTtBQUNqRSw4RUFBd0U7QUFDeEUsNEVBQXNFO0FBQ3RFLHdFQUFtRTtBQUNuRSw0RUFBd0U7QUFDeEUsMEdBQTRGO0FBQzVGLHFGQUFxRTtBQUVyRTs7Ozs7R0FLRztBQUtJLElBQU0sbUJBQW1CLEdBQXpCLE1BQU0sbUJBQW1CO0lBQ0Q7SUFBN0IsWUFBNkIsZ0JBQWtDO1FBQWxDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7SUFBRyxDQUFDO0lBRW5FOzs7T0FHRztJQVlILE1BQU0sQ0FBUyxxQkFBNEMsRUFBUyxHQUFHO1FBQ3JFLHlDQUF5QztRQUN6QyxJQUFJLENBQUMscUJBQXFCLENBQUMsVUFBVSxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNsRCxxQkFBcUIsQ0FBQyxVQUFVLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDakQsQ0FBQztRQUVELHFDQUFxQztRQUNyQyxJQUFJLENBQUMscUJBQXFCLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDckMscUJBQXFCLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQyxFQUFFLENBQUM7UUFDM0MsQ0FBQztRQUVELElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUN0QyxxQkFBcUIsQ0FBQyxVQUFVLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUMvRCxDQUFDO1FBRUQsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLHFCQUFxQixDQUFDLENBQUM7SUFDN0QsQ0FBQztJQUVEOztPQUVH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QUEsaUJBQU8sRUFBQyxXQUFXLENBQUM7SUFDcEIsSUFBQSxtQkFBVSxFQUFDLFdBQVcsQ0FBQztJQUN2QixJQUFBLGtCQUFTLEVBQUMsNkJBQVksRUFBRSxrQ0FBZSxDQUFDO0lBQ3hDLElBQUEsdUJBQWEsR0FBRTt5REFFaUMsb0NBQWdCLG9CQUFoQixvQ0FBZ0I7R0FEcEQsbUJBQW1CLENBOEkvQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xcYXVkaXRvcmlhXFxjb250cm9sbGVyc1xcYXVkaXRvcmlhLmNvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29udHJvbGxlcixcbiAgR2V0LFxuICBQb3N0LFxuICBCb2R5LFxuICBQYXJhbSxcbiAgUGFyc2VVVUlEUGlwZSxcbiAgUXVlcnksXG4gIFVzZUd1YXJkcyxcbiAgUmVxLFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQge1xuICBBcGlUYWdzLFxuICBBcGlPcGVyYXRpb24sXG4gIEFwaVJlc3BvbnNlLFxuICBBcGlCZWFyZXJBdXRoLFxuICBBcGlQYXJhbSxcbiAgQXBpUXVlcnksXG59IGZyb20gJ0BuZXN0anMvc3dhZ2dlcic7XG5pbXBvcnQgeyBBdWRpdG9yaWFTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvYXVkaXRvcmlhLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ3JlYXRlTG9nQXVkaXRvcmlhRHRvIH0gZnJvbSAnLi4vZHRvL2NyZWF0ZS1sb2ctYXVkaXRvcmlhLmR0byc7XG5pbXBvcnQgeyBRdWVyeUxvZ0F1ZGl0b3JpYUR0byB9IGZyb20gJy4uL2R0by9xdWVyeS1sb2ctYXVkaXRvcmlhLmR0byc7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi8uLi8uLi9hdXRoL2d1YXJkcy9qd3QtYXV0aC5ndWFyZCc7XG5pbXBvcnQgeyBQZXJtaXNzaW9uR3VhcmQgfSBmcm9tICcuLi8uLi8uLi9hdXRoL2d1YXJkcy9wZXJtaXNzaW9uLmd1YXJkJztcbmltcG9ydCB7IFJlcXVpcmVzUGVybWlzc2lvbiB9IGZyb20gJy4uLy4uLy4uL2F1dGgvZGVjb3JhdG9ycy9yZXF1aXJlcy1wZXJtaXNzaW9uLmRlY29yYXRvcic7XG5pbXBvcnQgeyBTY29wZVR5cGUgfSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy91c2VyLXBlcm1pc3Npb24uZW50aXR5JztcblxuLyoqXG4gKiBDb250cm9sYWRvciBkZSBBdWRpdG9yaWFcbiAqXG4gKiBSZXNwb25zw6F2ZWwgcG9yIGV4cG9yIGFzIGZ1bmNpb25hbGlkYWRlcyBkZSBhdWRpdG9yaWEgdmlhIEFQSSBSRVNULlxuICogUGVybWl0ZSBjb25zdWx0YXIgbG9ncyBkZSBhdWRpdG9yaWEgZSBnZXJhciByZWxhdMOzcmlvcy5cbiAqL1xuQEFwaVRhZ3MoJ0F1ZGl0b3JpYScpXG5AQ29udHJvbGxlcignYXVkaXRvcmlhJylcbkBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkLCBQZXJtaXNzaW9uR3VhcmQpXG5AQXBpQmVhcmVyQXV0aCgpXG5leHBvcnQgY2xhc3MgQXVkaXRvcmlhQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgYXVkaXRvcmlhU2VydmljZTogQXVkaXRvcmlhU2VydmljZSkge31cblxuICAvKipcbiAgICogQ3JpYSB1bSBub3ZvIGxvZyBkZSBhdWRpdG9yaWEgbWFudWFsbWVudGVcbiAgICogTm9ybWFsbWVudGUgb3MgbG9ncyBzw6NvIGNyaWFkb3MgYXV0b21hdGljYW1lbnRlIHBlbG8gbWlkZGxld2FyZVxuICAgKi9cbiAgQFBvc3QoKVxuICBAUmVxdWlyZXNQZXJtaXNzaW9uKHtcbiAgICBwZXJtaXNzaW9uTmFtZTogJ2F1ZGl0b3JpYS5sb2cuY3JpYXInLFxuICAgIHNjb3BlVHlwZTogU2NvcGVUeXBlLkdMT0JBTFxuICB9KVxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0NyaWEgdW0gbm92byBsb2cgZGUgYXVkaXRvcmlhIG1hbnVhbG1lbnRlJyB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAxLFxuICAgIGRlc2NyaXB0aW9uOiAnTG9nIGRlIGF1ZGl0b3JpYSBjcmlhZG8gY29tIHN1Y2Vzc28nLFxuICB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMywgZGVzY3JpcHRpb246ICdBY2Vzc28gbmVnYWRvJyB9KVxuICBjcmVhdGUoQEJvZHkoKSBjcmVhdGVMb2dBdWRpdG9yaWFEdG86IENyZWF0ZUxvZ0F1ZGl0b3JpYUR0bywgQFJlcSgpIHJlcSkge1xuICAgIC8vIEFkaWNpb25hIGluZm9ybWHDp8O1ZXMgZG8gdXN1w6FyaW8gbG9nYWRvXG4gICAgaWYgKCFjcmVhdGVMb2dBdWRpdG9yaWFEdG8udXN1YXJpb19pZCAmJiByZXEudXNlcikge1xuICAgICAgY3JlYXRlTG9nQXVkaXRvcmlhRHRvLnVzdWFyaW9faWQgPSByZXEudXNlci5pZDtcbiAgICB9XG5cbiAgICAvLyBBZGljaW9uYSBpbmZvcm1hw6fDtWVzIGRhIHJlcXVpc2nDp8Ojb1xuICAgIGlmICghY3JlYXRlTG9nQXVkaXRvcmlhRHRvLmlwX29yaWdlbSkge1xuICAgICAgY3JlYXRlTG9nQXVkaXRvcmlhRHRvLmlwX29yaWdlbSA9IHJlcS5pcDtcbiAgICB9XG5cbiAgICBpZiAoIWNyZWF0ZUxvZ0F1ZGl0b3JpYUR0by51c2VyX2FnZW50KSB7XG4gICAgICBjcmVhdGVMb2dBdWRpdG9yaWFEdG8udXNlcl9hZ2VudCA9IHJlcS5oZWFkZXJzWyd1c2VyLWFnZW50J107XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuYXVkaXRvcmlhU2VydmljZS5jcmVhdGUoY3JlYXRlTG9nQXVkaXRvcmlhRHRvKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdXNjYSBsb2dzIGRlIGF1ZGl0b3JpYSBjb20gYmFzZSBub3MgZmlsdHJvcyBmb3JuZWNpZG9zXG4gICAqL1xuICBAR2V0KClcbiAgQFJlcXVpcmVzUGVybWlzc2lvbih7XG4gICAgcGVybWlzc2lvbk5hbWU6ICdhdWRpdG9yaWEubG9nLmxpc3RhcicsXG4gICAgc2NvcGVUeXBlOiBTY29wZVR5cGUuR0xPQkFMXG4gIH0pXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnQnVzY2EgbG9ncyBkZSBhdWRpdG9yaWEnIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogMjAwLCBkZXNjcmlwdGlvbjogJ0xpc3RhIGRlIGxvZ3MgZGUgYXVkaXRvcmlhJyB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMywgZGVzY3JpcHRpb246ICdBY2Vzc28gbmVnYWRvJyB9KVxuICBmaW5kQWxsKEBRdWVyeSgpIHF1ZXJ5UGFyYW1zOiBRdWVyeUxvZ0F1ZGl0b3JpYUR0bykge1xuICAgIHJldHVybiB0aGlzLmF1ZGl0b3JpYVNlcnZpY2UuZmluZEFsbChxdWVyeVBhcmFtcyk7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2EgdW0gbG9nIGRlIGF1ZGl0b3JpYSBwZWxvIElEXG4gICAqL1xuICBAR2V0KCc6aWQnKVxuICBAUmVxdWlyZXNQZXJtaXNzaW9uKHtcbiAgICBwZXJtaXNzaW9uTmFtZTogJ2F1ZGl0b3JpYS5sb2cudmlzdWFsaXphcicsXG4gICAgc2NvcGVUeXBlOiBTY29wZVR5cGUuR0xPQkFMXG4gIH0pXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnQnVzY2EgdW0gbG9nIGRlIGF1ZGl0b3JpYSBwZWxvIElEJyB9KVxuICBAQXBpUGFyYW0oeyBuYW1lOiAnaWQnLCBkZXNjcmlwdGlvbjogJ0lEIGRvIGxvZyBkZSBhdWRpdG9yaWEnIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogMjAwLCBkZXNjcmlwdGlvbjogJ0xvZyBkZSBhdWRpdG9yaWEgZW5jb250cmFkbycgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDQsIGRlc2NyaXB0aW9uOiAnTG9nIGRlIGF1ZGl0b3JpYSBuw6NvIGVuY29udHJhZG8nIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAzLCBkZXNjcmlwdGlvbjogJ0FjZXNzbyBuZWdhZG8nIH0pXG4gIGZpbmRPbmUoQFBhcmFtKCdpZCcsIFBhcnNlVVVJRFBpcGUpIGlkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5hdWRpdG9yaWFTZXJ2aWNlLmZpbmRPbmUoaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhIGxvZ3MgZGUgYXVkaXRvcmlhIHBvciBlbnRpZGFkZVxuICAgKi9cbiAgQEdldCgnZW50aWRhZGUvOmVudGlkYWRlLzppZCcpXG4gIEBSZXF1aXJlc1Blcm1pc3Npb24oe1xuICAgIHBlcm1pc3Npb25OYW1lOiAnYXVkaXRvcmlhLmxvZy5lbnRpZGFkZS52aXN1YWxpemFyJyxcbiAgICBzY29wZVR5cGU6IFNjb3BlVHlwZS5HTE9CQUxcbiAgfSlcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdCdXNjYSBsb2dzIGRlIGF1ZGl0b3JpYSBwb3IgZW50aWRhZGUnIH0pXG4gIEBBcGlQYXJhbSh7IG5hbWU6ICdlbnRpZGFkZScsIGRlc2NyaXB0aW9uOiAnTm9tZSBkYSBlbnRpZGFkZScgfSlcbiAgQEFwaVBhcmFtKHsgbmFtZTogJ2lkJywgZGVzY3JpcHRpb246ICdJRCBkYSBlbnRpZGFkZScgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBkZXNjcmlwdGlvbjogJ0xpc3RhIGRlIGxvZ3MgZGUgYXVkaXRvcmlhIGRhIGVudGlkYWRlJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDMsIGRlc2NyaXB0aW9uOiAnQWNlc3NvIG5lZ2FkbycgfSlcbiAgZmluZEJ5RW50aWRhZGUoQFBhcmFtKCdlbnRpZGFkZScpIGVudGlkYWRlOiBzdHJpbmcsIEBQYXJhbSgnaWQnLCBQYXJzZVVVSURQaXBlKSBpZDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuYXVkaXRvcmlhU2VydmljZS5maW5kQnlFbnRpZGFkZShlbnRpZGFkZSwgaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhIGxvZ3MgZGUgYXVkaXRvcmlhIHBvciB1c3XDoXJpb1xuICAgKi9cbiAgQEdldCgndXN1YXJpby86aWQnKVxuICBAUmVxdWlyZXNQZXJtaXNzaW9uKHtcbiAgICBwZXJtaXNzaW9uTmFtZTogJ2F1ZGl0b3JpYS5sb2cudXN1YXJpby52aXN1YWxpemFyJyxcbiAgICBzY29wZVR5cGU6IFNjb3BlVHlwZS5HTE9CQUxcbiAgfSlcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdCdXNjYSBsb2dzIGRlIGF1ZGl0b3JpYSBwb3IgdXN1w6FyaW8nIH0pXG4gIEBBcGlQYXJhbSh7IG5hbWU6ICdpZCcsIGRlc2NyaXB0aW9uOiAnSUQgZG8gdXN1w6FyaW8nIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgZGVzY3JpcHRpb246ICdMaXN0YSBkZSBsb2dzIGRlIGF1ZGl0b3JpYSBkbyB1c3XDoXJpbycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAzLCBkZXNjcmlwdGlvbjogJ0FjZXNzbyBuZWdhZG8nIH0pXG4gIGZpbmRCeVVzdWFyaW8oQFBhcmFtKCdpZCcsIFBhcnNlVVVJRFBpcGUpIGlkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5hdWRpdG9yaWFTZXJ2aWNlLmZpbmRCeVVzdWFyaW8oaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlcmEgcmVsYXTDs3JpbyBkZSBhY2Vzc29zIGEgZGFkb3Mgc2Vuc8OtdmVpcyBwb3IgcGVyw61vZG9cbiAgICovXG4gIEBHZXQoJ3JlbGF0b3Jpb3MvZGFkb3Mtc2Vuc2l2ZWlzJylcbiAgQFJlcXVpcmVzUGVybWlzc2lvbih7XG4gICAgcGVybWlzc2lvbk5hbWU6ICdhdWRpdG9yaWEucmVsYXRvcmlvLmRhZG9zLXNlbnNpdmVpcycsXG4gICAgc2NvcGVUeXBlOiBTY29wZVR5cGUuR0xPQkFMXG4gIH0pXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdHZXJhIHJlbGF0w7NyaW8gZGUgYWNlc3NvcyBhIGRhZG9zIHNlbnPDrXZlaXMgcG9yIHBlcsOtb2RvJyxcbiAgfSlcbiAgQEFwaVF1ZXJ5KHtcbiAgICBuYW1lOiAnZGF0YV9pbmljaWFsJyxcbiAgICBkZXNjcmlwdGlvbjogJ0RhdGEgaW5pY2lhbCAoZm9ybWF0byBJU08pJyxcbiAgICByZXF1aXJlZDogdHJ1ZSxcbiAgfSlcbiAgQEFwaVF1ZXJ5KHtcbiAgICBuYW1lOiAnZGF0YV9maW5hbCcsXG4gICAgZGVzY3JpcHRpb246ICdEYXRhIGZpbmFsIChmb3JtYXRvIElTTyknLFxuICAgIHJlcXVpcmVkOiB0cnVlLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnUmVsYXTDs3JpbyBkZSBhY2Vzc29zIGEgZGFkb3Mgc2Vuc8OtdmVpcycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAzLCBkZXNjcmlwdGlvbjogJ0FjZXNzbyBuZWdhZG8nIH0pXG4gIHJlbGF0b3Jpb0FjZXNzb3NEYWRvc1NlbnNpdmVpcyhcbiAgICBAUXVlcnkoJ2RhdGFfaW5pY2lhbCcpIGRhdGFJbmljaWFsOiBzdHJpbmcsXG4gICAgQFF1ZXJ5KCdkYXRhX2ZpbmFsJykgZGF0YUZpbmFsOiBzdHJpbmcsXG4gICkge1xuICAgIHJldHVybiB0aGlzLmF1ZGl0b3JpYVNlcnZpY2UucmVsYXRvcmlvQWNlc3Nvc0RhZG9zU2Vuc2l2ZWlzKFxuICAgICAgbmV3IERhdGUoZGF0YUluaWNpYWwpLFxuICAgICAgbmV3IERhdGUoZGF0YUZpbmFsKSxcbiAgICApO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=