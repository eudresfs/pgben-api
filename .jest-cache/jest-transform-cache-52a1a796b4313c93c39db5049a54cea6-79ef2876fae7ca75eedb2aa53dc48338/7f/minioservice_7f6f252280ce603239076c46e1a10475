d8a89416e9bc407e6153ba147df84a9b
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var MinioService_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.MinioService = void 0;
const common_1 = require("@nestjs/common");
const config_1 = require("@nestjs/config");
const Minio = __importStar(require("minio"));
const criptografia_service_1 = require("./criptografia.service");
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const os = __importStar(require("os"));
const crypto = __importStar(require("crypto"));
/**
 * Serviço de integração com MinIO
 *
 * Responsável por gerenciar o armazenamento de documentos no MinIO,
 * com suporte a criptografia para dados sensíveis.
 */
let MinioService = MinioService_1 = class MinioService {
    configService;
    criptografiaService;
    logger = new common_1.Logger(MinioService_1.name);
    minioClient;
    bucketName;
    tempDir;
    // Removida lista de documentos sensíveis - agora usa a lista centralizada no CriptografiaService
    constructor(configService, criptografiaService) {
        this.configService = configService;
        this.criptografiaService = criptografiaService;
        // Configuração do cliente MinIO
        const useSSL = this.configService.get('MINIO_USE_SSL') === 'true';
        this.logger.log(`Configurando MinIO com SSL: ${useSSL}`);
        this.minioClient = new Minio.Client({
            endPoint: this.configService.get('MINIO_ENDPOINT', 'localhost'),
            port: this.configService.get('MINIO_PORT', 9000),
            useSSL: useSSL,
            accessKey: this.configService.get('MINIO_ACCESS_KEY', 'minioadmin'),
            secretKey: this.configService.get('MINIO_SECRET_KEY', 'minioadmin'),
        });
        // Nome do bucket para armazenamento de documentos
        this.bucketName = this.configService.get('MINIO_BUCKET_NAME', 'pgben-documentos');
        this.logger.log(`Usando bucket: ${this.bucketName}`);
        // Diretório temporário para arquivos em processamento
        this.tempDir = path.join(os.tmpdir(), 'pgben-temp');
        if (!fs.existsSync(this.tempDir)) {
            fs.mkdirSync(this.tempDir, { recursive: true });
        }
    }
    /**
     * Inicialização do módulo
     * Verifica se o bucket existe e cria se necessário
     */
    async onModuleInit() {
        try {
            const bucketExists = await this.minioClient.bucketExists(this.bucketName);
            if (!bucketExists) {
                await this.minioClient.makeBucket(this.bucketName, 'us-east-1');
                this.logger.log(`Bucket '${this.bucketName}' criado com sucesso`);
            }
            else {
                this.logger.log(`Bucket '${this.bucketName}' já existe`);
            }
        }
        catch (error) {
            this.logger.error(`Erro ao verificar/criar bucket: ${error.message}`);
        }
    }
    /**
     * Verifica se um tipo de documento deve ser criptografado
     * @param tipoDocumento Tipo do documento
     * @returns true se o documento deve ser criptografado, false caso contrário
     */
    documentoRequerCriptografia(tipoDocumento) {
        return this.criptografiaService.deveSerCriptografado(tipoDocumento);
    }
    /**
     * Gera um nome único para o arquivo no MinIO
     * @param nomeOriginal Nome original do arquivo
     * @param solicitacaoId ID da solicitação
     * @param tipoDocumento Tipo do documento
     * @returns Nome único para o arquivo
     */
    gerarNomeArquivo(nomeOriginal, solicitacaoId, tipoDocumento) {
        const extensao = path.extname(nomeOriginal);
        const timestamp = Date.now();
        const randomString = crypto.randomBytes(8).toString('hex');
        return `${solicitacaoId}/${tipoDocumento}/${timestamp}-${randomString}${extensao}`;
    }
    /**
     * Faz upload de um arquivo para o MinIO
     * @param arquivo Buffer do arquivo
     * @param nomeOriginal Nome original do arquivo
     * @param solicitacaoId ID da solicitação
     * @param tipoDocumento Tipo do documento
     * @returns Metadados do arquivo armazenado
     */
    async uploadArquivo(arquivo, nomeOriginal, solicitacaoId, tipoDocumento) {
        // Gerar nome único para o arquivo
        const nomeArquivo = this.gerarNomeArquivo(nomeOriginal, solicitacaoId, tipoDocumento);
        // Calcular hash do arquivo original para verificação de integridade
        const hash = this.criptografiaService.gerarHash(arquivo);
        // Verificar se o documento deve ser criptografado
        const criptografar = this.documentoRequerCriptografia(tipoDocumento);
        let arquivoFinal = arquivo;
        const metadados = {
            'Content-Type': this.detectarMimeType(nomeOriginal),
            'X-Amz-Meta-Original-Name': nomeOriginal,
            'X-Amz-Meta-Hash': hash,
            'X-Amz-Meta-Encrypted': criptografar ? 'true' : 'false',
        };
        // Se o documento for sensível, criptografar
        if (criptografar) {
            try {
                // Criptografar o arquivo
                const { dadosCriptografados, iv, authTag } = this.criptografiaService.criptografarBuffer(arquivo);
                // Usar o arquivo criptografado
                arquivoFinal = dadosCriptografados;
                // Adicionar metadados de criptografia
                metadados['X-Amz-Meta-IV'] = iv.toString('base64');
                metadados['X-Amz-Meta-AuthTag'] = authTag.toString('base64');
                this.logger.log(`Arquivo ${nomeArquivo} criptografado com sucesso`);
            }
            catch (error) {
                this.logger.error(`Erro ao criptografar arquivo: ${error.message}`);
                throw new Error(`Falha ao criptografar documento: ${error.message}`);
            }
        }
        try {
            // Fazer upload do arquivo para o MinIO
            await this.minioClient.putObject(this.bucketName, nomeArquivo, arquivoFinal, arquivoFinal.length, metadados);
            this.logger.log(`Arquivo ${nomeArquivo} enviado para o MinIO com sucesso`);
            return {
                nomeArquivo,
                tamanho: arquivo.length, // Tamanho original, não o criptografado
                hash,
                criptografado: criptografar,
                metadados: {
                    tipoDocumento,
                    solicitacaoId,
                    nomeOriginal,
                },
            };
        }
        catch (error) {
            this.logger.error(`Erro ao enviar arquivo para o MinIO: ${error.message}`);
            throw new Error(`Falha ao armazenar documento: ${error.message}`);
        }
    }
    /**
     * Baixa um arquivo do MinIO
     * @param nomeArquivo Nome do arquivo no MinIO
     * @returns Buffer com o conteúdo original do arquivo (descriptografado se necessário)
     */
    async downloadArquivo(nomeArquivo) {
        try {
            // Obter metadados do arquivo
            const stat = await this.minioClient.statObject(this.bucketName, nomeArquivo);
            // Criar arquivo temporário para download
            const tempFilePath = path.join(this.tempDir, `download-${Date.now()}-${path.basename(nomeArquivo)}`);
            // Baixar arquivo do MinIO
            await this.minioClient.fGetObject(this.bucketName, nomeArquivo, tempFilePath);
            // Ler arquivo baixado
            const arquivoCriptografado = fs.readFileSync(tempFilePath);
            // Verificar se o arquivo está criptografado
            const criptografado = stat.metaData['x-amz-meta-encrypted'] === 'true';
            let arquivoFinal = arquivoCriptografado;
            // Se estiver criptografado, descriptografar
            if (criptografado) {
                const iv = Buffer.from(stat.metaData['x-amz-meta-iv'], 'base64');
                const authTag = Buffer.from(stat.metaData['x-amz-meta-authtag'], 'base64');
                try {
                    arquivoFinal = this.criptografiaService.descriptografarBuffer(arquivoCriptografado, iv, authTag);
                    this.logger.log(`Arquivo ${nomeArquivo} descriptografado com sucesso`);
                }
                catch (error) {
                    this.logger.error(`Erro ao descriptografar arquivo: ${error.message}`);
                    throw new Error(`Falha ao descriptografar documento: ${error.message}`);
                }
            }
            // Verificar integridade do arquivo
            const hashOriginal = stat.metaData['x-amz-meta-hash'];
            const hashCalculado = this.criptografiaService.gerarHash(arquivoFinal);
            if (hashOriginal !== hashCalculado) {
                this.logger.error(`Integridade do arquivo ${nomeArquivo} comprometida`);
                throw new Error('A integridade do documento foi comprometida. O hash não corresponde ao original.');
            }
            // Remover arquivo temporário
            fs.unlinkSync(tempFilePath);
            return {
                arquivo: arquivoFinal,
                metadados: {
                    nomeOriginal: stat.metaData['x-amz-meta-original-name'],
                    contentType: stat.metaData['content-type'],
                    tamanho: arquivoFinal.length,
                    criptografado,
                },
            };
        }
        catch (error) {
            this.logger.error(`Erro ao baixar arquivo do MinIO: ${error.message}`);
            throw new Error(`Falha ao recuperar documento: ${error.message}`);
        }
    }
    /**
     * Remove um arquivo do MinIO
     * @param nomeArquivo Nome do arquivo no MinIO
     */
    async removerArquivo(nomeArquivo) {
        try {
            await this.minioClient.removeObject(this.bucketName, nomeArquivo);
            this.logger.log(`Arquivo ${nomeArquivo} removido do MinIO com sucesso`);
        }
        catch (error) {
            this.logger.error(`Erro ao remover arquivo do MinIO: ${error.message}`);
            throw new Error(`Falha ao remover documento: ${error.message}`);
        }
    }
    /**
     * Detecta o tipo MIME de um arquivo com base na extensão
     * @param nomeArquivo Nome do arquivo
     * @returns Tipo MIME do arquivo
     */
    detectarMimeType(nomeArquivo) {
        const extensao = path.extname(nomeArquivo).toLowerCase();
        const mimeTypes = {
            '.pdf': 'application/pdf',
            '.jpg': 'image/jpeg',
            '.jpeg': 'image/jpeg',
            '.png': 'image/png',
            '.gif': 'image/gif',
            '.tiff': 'image/tiff',
            '.tif': 'image/tiff',
            '.doc': 'application/msword',
            '.docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
            '.xls': 'application/vnd.ms-excel',
            '.xlsx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            '.ppt': 'application/vnd.ms-powerpoint',
            '.pptx': 'application/vnd.openxmlformats-officedocument.presentationml.presentation',
            '.txt': 'text/plain',
            '.zip': 'application/zip',
            '.rar': 'application/x-rar-compressed',
            '.7z': 'application/x-7z-compressed',
            '.tar': 'application/x-tar',
            '.gz': 'application/gzip',
        };
        return mimeTypes[extensao] || 'application/octet-stream';
    }
    /**
     * Gera uma URL pré-assinada para acesso temporário a um arquivo
     * @param nomeArquivo Nome do arquivo no MinIO
     * @param expiracaoSegundos Tempo de expiração da URL em segundos
     * @returns URL pré-assinada
     */
    async gerarUrlPreAssinada(nomeArquivo, expiracaoSegundos = 3600) {
        try {
            return await this.minioClient.presignedGetObject(this.bucketName, nomeArquivo, expiracaoSegundos);
        }
        catch (error) {
            this.logger.error(`Erro ao gerar URL pré-assinada: ${error.message}`);
            throw new Error(`Falha ao gerar URL para acesso ao documento: ${error.message}`);
        }
    }
};
exports.MinioService = MinioService;
exports.MinioService = MinioService = MinioService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigService !== "undefined" && config_1.ConfigService) === "function" ? _a : Object, typeof (_b = typeof criptografia_service_1.CriptografiaService !== "undefined" && criptografia_service_1.CriptografiaService) === "function" ? _b : Object])
], MinioService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXHNoYXJlZFxcc2VydmljZXNcXG1pbmlvLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBa0U7QUFDbEUsMkNBQStDO0FBQy9DLDZDQUErQjtBQUMvQixpRUFBNkQ7QUFDN0QsdUNBQXlCO0FBQ3pCLDJDQUE2QjtBQUM3Qix1Q0FBeUI7QUFDekIsK0NBQWlDO0FBRWpDOzs7OztHQUtHO0FBRUksSUFBTSxZQUFZLG9CQUFsQixNQUFNLFlBQVk7SUFTYjtJQUNBO0lBVE8sTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLGNBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoRCxXQUFXLENBQWU7SUFDakIsVUFBVSxDQUFTO0lBQ25CLE9BQU8sQ0FBUztJQUVqQyxpR0FBaUc7SUFFakcsWUFDVSxhQUE0QixFQUM1QixtQkFBd0M7UUFEeEMsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDNUIsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtRQUVoRCxnQ0FBZ0M7UUFDaEMsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLEtBQUssTUFBTSxDQUFDO1FBQ2xFLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLCtCQUErQixNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBRXpELElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDO1lBQ2xDLFFBQVEsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBUyxnQkFBZ0IsRUFBRSxXQUFXLENBQUM7WUFDdkUsSUFBSSxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFTLFlBQVksRUFBRSxJQUFJLENBQUM7WUFDeEQsTUFBTSxFQUFFLE1BQU07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QUcsSUFBSTtRQUV4QixJQUFJLENBQUM7WUFDSCxPQUFPLE1BQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsQ0FDOUMsSUFBSSxDQUFDLFVBQVUsRUFDZixXQUFXLEVBQ1gsaUJBQWlCLENBQ2xCLENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLG1DQUFtQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUN0RSxNQUFNLElBQUksS0FBSyxDQUNiLGdEQUFnRCxLQUFLLENBQUMsT0FBTyxFQUFFLENBQ2hFLENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQztDQUNGLENBQUE7QUEvVlksb0NBQVk7dUJBQVosWUFBWTtJQUR4QixJQUFBLG1CQUFVLEdBQUU7eURBVWMsc0JBQWEsb0JBQWIsc0JBQWEsb0RBQ1AsMENBQW1CLG9CQUFuQiwwQ0FBbUI7R0FWdkMsWUFBWSxDQStWeEIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXHNoYXJlZFxcc2VydmljZXNcXG1pbmlvLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTG9nZ2VyLCBPbk1vZHVsZUluaXQgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBDb25maWdTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9jb25maWcnO1xuaW1wb3J0ICogYXMgTWluaW8gZnJvbSAnbWluaW8nO1xuaW1wb3J0IHsgQ3JpcHRvZ3JhZmlhU2VydmljZSB9IGZyb20gJy4vY3JpcHRvZ3JhZmlhLnNlcnZpY2UnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIG9zIGZyb20gJ29zJztcbmltcG9ydCAqIGFzIGNyeXB0byBmcm9tICdjcnlwdG8nO1xuXG4vKipcbiAqIFNlcnZpw6dvIGRlIGludGVncmHDp8OjbyBjb20gTWluSU9cbiAqXG4gKiBSZXNwb25zw6F2ZWwgcG9yIGdlcmVuY2lhciBvIGFybWF6ZW5hbWVudG8gZGUgZG9jdW1lbnRvcyBubyBNaW5JTyxcbiAqIGNvbSBzdXBvcnRlIGEgY3JpcHRvZ3JhZmlhIHBhcmEgZGFkb3Mgc2Vuc8OtdmVpcy5cbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE1pbmlvU2VydmljZSBpbXBsZW1lbnRzIE9uTW9kdWxlSW5pdCB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihNaW5pb1NlcnZpY2UubmFtZSk7XG4gIHByaXZhdGUgbWluaW9DbGllbnQ6IE1pbmlvLkNsaWVudDtcbiAgcHJpdmF0ZSByZWFkb25seSBidWNrZXROYW1lOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgdGVtcERpcjogc3RyaW5nO1xuXG4gIC8vIFJlbW92aWRhIGxpc3RhIGRlIGRvY3VtZW50b3Mgc2Vuc8OtdmVpcyAtIGFnb3JhIHVzYSBhIGxpc3RhIGNlbnRyYWxpemFkYSBubyBDcmlwdG9ncmFmaWFTZXJ2aWNlXG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjb25maWdTZXJ2aWNlOiBDb25maWdTZXJ2aWNlLFxuICAgIHByaXZhdGUgY3JpcHRvZ3JhZmlhU2VydmljZTogQ3JpcHRvZ3JhZmlhU2VydmljZSxcbiAgKSB7XG4gICAgLy8gQ29uZmlndXJhw6fDo28gZG8gY2xpZW50ZSBNaW5JT1xuICAgIGNvbnN0IHVzZVNTTCA9IHRoaXMuY29uZmlnU2VydmljZS5nZXQoJ01JTklPX1VTRV9TU0wnKSA9PT0gJ3RydWUnO1xuICAgIHRoaXMubG9nZ2VyLmxvZyhgQ29uZmlndXJhbmRvIE1pbklPIGNvbSBTU0w6ICR7dXNlU1NMfWApO1xuICAgIFxuICAgIHRoaXMubWluaW9DbGllbnQgPSBuZXcgTWluaW8uQ2xpZW50KHtcbiAgICAgIGVuZFBvaW50OiB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0PHN0cmluZz4oJ01JTklPX0VORFBPSU5UJywgJ2xvY2FsaG9zdCcpLFxuICAgICAgcG9ydDogdGhpcy5jb25maWdTZXJ2aWNlLmdldDxudW1iZXI+KCdNSU5JT19QT1JUJywgOTAwMCksXG4gICAgICB1c2VTU0w6IHVzZVNTTCxcbiAgICAgIGFjY2Vzc0tleTogdGhpcy5jb25maWdTZXJ2aWNlLmdldDxzdHJpbmc+KFxuICAgICAgICAnTUlOSU9fQUNDRVNTX0tFWScsXG4gICAgICAgICdtaW5pb2FkbWluJyxcbiAgICAgICksXG4gICAgICBzZWNyZXRLZXk6IHRoaXMuY29uZmlnU2VydmljZS5nZXQ8c3RyaW5nPihcbiAgICAgICAgJ01JTklPX1NFQ1JFVF9LRVknLFxuICAgICAgICAnbWluaW9hZG1pbicsXG4gICAgICApLFxuICAgIH0pO1xuXG4gICAgLy8gTm9tZSBkbyBidWNrZXQgcGFyYSBhcm1hemVuYW1lbnRvIGRlIGRvY3VtZW50b3NcbiAgICB0aGlzLmJ1Y2tldE5hbWUgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0PHN0cmluZz4oXG4gICAgICAnTUlOSU9fQlVDS0VUX05BTUUnLFxuICAgICAgJ3BnYmVuLWRvY3VtZW50b3MnLFxuICAgICk7XG4gICAgdGhpcy5sb2dnZXIubG9nKGBVc2FuZG8gYnVja2V0OiAke3RoaXMuYnVja2V0TmFtZX1gKTtcblxuICAgIC8vIERpcmV0w7NyaW8gdGVtcG9yw6FyaW8gcGFyYSBhcnF1aXZvcyBlbSBwcm9jZXNzYW1lbnRvXG4gICAgdGhpcy50ZW1wRGlyID0gcGF0aC5qb2luKG9zLnRtcGRpcigpLCAncGdiZW4tdGVtcCcpO1xuICAgIGlmICghZnMuZXhpc3RzU3luYyh0aGlzLnRlbXBEaXIpKSB7XG4gICAgICBmcy5ta2RpclN5bmModGhpcy50ZW1wRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5pY2lhbGl6YcOnw6NvIGRvIG3Ds2R1bG9cbiAgICogVmVyaWZpY2Egc2UgbyBidWNrZXQgZXhpc3RlIGUgY3JpYSBzZSBuZWNlc3PDoXJpb1xuICAgKi9cbiAgYXN5bmMgb25Nb2R1bGVJbml0KCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBidWNrZXRFeGlzdHMgPSBhd2FpdCB0aGlzLm1pbmlvQ2xpZW50LmJ1Y2tldEV4aXN0cyh0aGlzLmJ1Y2tldE5hbWUpO1xuICAgICAgaWYgKCFidWNrZXRFeGlzdHMpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5taW5pb0NsaWVudC5tYWtlQnVja2V0KHRoaXMuYnVja2V0TmFtZSwgJ3VzLWVhc3QtMScpO1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2coYEJ1Y2tldCAnJHt0aGlzLmJ1Y2tldE5hbWV9JyBjcmlhZG8gY29tIHN1Y2Vzc29gKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZyhgQnVja2V0ICcke3RoaXMuYnVja2V0TmFtZX0nIGrDoSBleGlzdGVgKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm8gYW8gdmVyaWZpY2FyL2NyaWFyIGJ1Y2tldDogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSB1bSB0aXBvIGRlIGRvY3VtZW50byBkZXZlIHNlciBjcmlwdG9ncmFmYWRvXG4gICAqIEBwYXJhbSB0aXBvRG9jdW1lbnRvIFRpcG8gZG8gZG9jdW1lbnRvXG4gICAqIEByZXR1cm5zIHRydWUgc2UgbyBkb2N1bWVudG8gZGV2ZSBzZXIgY3JpcHRvZ3JhZmFkbywgZmFsc2UgY2FzbyBjb250csOhcmlvXG4gICAqL1xuICBwcml2YXRlIGRvY3VtZW50b1JlcXVlckNyaXB0b2dyYWZpYSh0aXBvRG9jdW1lbnRvOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jcmlwdG9ncmFmaWFTZXJ2aWNlLmRldmVTZXJDcmlwdG9ncmFmYWRvKHRpcG9Eb2N1bWVudG8pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlcmEgdW0gbm9tZSDDum5pY28gcGFyYSBvIGFycXVpdm8gbm8gTWluSU9cbiAgICogQHBhcmFtIG5vbWVPcmlnaW5hbCBOb21lIG9yaWdpbmFsIGRvIGFycXVpdm9cbiAgICogQHBhcmFtIHNvbGljaXRhY2FvSWQgSUQgZGEgc29saWNpdGHDp8Ojb1xuICAgKiBAcGFyYW0gdGlwb0RvY3VtZW50byBUaXBvIGRvIGRvY3VtZW50b1xuICAgKiBAcmV0dXJucyBOb21lIMO6bmljbyBwYXJhIG8gYXJxdWl2b1xuICAgKi9cbiAgcHJpdmF0ZSBnZXJhck5vbWVBcnF1aXZvKFxuICAgIG5vbWVPcmlnaW5hbDogc3RyaW5nLFxuICAgIHNvbGljaXRhY2FvSWQ6IHN0cmluZyxcbiAgICB0aXBvRG9jdW1lbnRvOiBzdHJpbmcsXG4gICk6IHN0cmluZyB7XG4gICAgY29uc3QgZXh0ZW5zYW8gPSBwYXRoLmV4dG5hbWUobm9tZU9yaWdpbmFsKTtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHJhbmRvbVN0cmluZyA9IGNyeXB0by5yYW5kb21CeXRlcyg4KS50b1N0cmluZygnaGV4Jyk7XG4gICAgcmV0dXJuIGAke3NvbGljaXRhY2FvSWR9LyR7dGlwb0RvY3VtZW50b30vJHt0aW1lc3RhbXB9LSR7cmFuZG9tU3RyaW5nfSR7ZXh0ZW5zYW99YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGYXogdXBsb2FkIGRlIHVtIGFycXVpdm8gcGFyYSBvIE1pbklPXG4gICAqIEBwYXJhbSBhcnF1aXZvIEJ1ZmZlciBkbyBhcnF1aXZvXG4gICAqIEBwYXJhbSBub21lT3JpZ2luYWwgTm9tZSBvcmlnaW5hbCBkbyBhcnF1aXZvXG4gICAqIEBwYXJhbSBzb2xpY2l0YWNhb0lkIElEIGRhIHNvbGljaXRhw6fDo29cbiAgICogQHBhcmFtIHRpcG9Eb2N1bWVudG8gVGlwbyBkbyBkb2N1bWVudG9cbiAgICogQHJldHVybnMgTWV0YWRhZG9zIGRvIGFycXVpdm8gYXJtYXplbmFkb1xuICAgKi9cbiAgYXN5bmMgdXBsb2FkQXJxdWl2byhcbiAgICBhcnF1aXZvOiBCdWZmZXIsXG4gICAgbm9tZU9yaWdpbmFsOiBzdHJpbmcsXG4gICAgc29saWNpdGFjYW9JZDogc3RyaW5nLFxuICAgIHRpcG9Eb2N1bWVudG86IHN0cmluZyxcbiAgKTogUHJvbWlzZTx7XG4gICAgbm9tZUFycXVpdm86IHN0cmluZztcbiAgICB0YW1hbmhvOiBudW1iZXI7XG4gICAgaGFzaDogc3RyaW5nO1xuICAgIGNyaXB0b2dyYWZhZG86IGJvb2xlYW47XG4gICAgbWV0YWRhZG9zOiBhbnk7XG4gIH0+IHtcbiAgICAvLyBHZXJhciBub21lIMO6bmljbyBwYXJhIG8gYXJxdWl2b1xuICAgIGNvbnN0IG5vbWVBcnF1aXZvID0gdGhpcy5nZXJhck5vbWVBcnF1aXZvKFxuICAgICAgbm9tZU9yaWdpbmFsLFxuICAgICAgc29saWNpdGFjYW9JZCxcbiAgICAgIHRpcG9Eb2N1bWVudG8sXG4gICAgKTtcblxuICAgIC8vIENhbGN1bGFyIGhhc2ggZG8gYXJxdWl2byBvcmlnaW5hbCBwYXJhIHZlcmlmaWNhw6fDo28gZGUgaW50ZWdyaWRhZGVcbiAgICBjb25zdCBoYXNoID0gdGhpcy5jcmlwdG9ncmFmaWFTZXJ2aWNlLmdlcmFySGFzaChhcnF1aXZvKTtcblxuICAgIC8vIFZlcmlmaWNhciBzZSBvIGRvY3VtZW50byBkZXZlIHNlciBjcmlwdG9ncmFmYWRvXG4gICAgY29uc3QgY3JpcHRvZ3JhZmFyID0gdGhpcy5kb2N1bWVudG9SZXF1ZXJDcmlwdG9ncmFmaWEodGlwb0RvY3VtZW50byk7XG5cbiAgICBsZXQgYXJxdWl2b0ZpbmFsID0gYXJxdWl2bztcbiAgICBjb25zdCBtZXRhZGFkb3M6IGFueSA9IHtcbiAgICAgICdDb250ZW50LVR5cGUnOiB0aGlzLmRldGVjdGFyTWltZVR5cGUobm9tZU9yaWdpbmFsKSxcbiAgICAgICdYLUFtei1NZXRhLU9yaWdpbmFsLU5hbWUnOiBub21lT3JpZ2luYWwsXG4gICAgICAnWC1BbXotTWV0YS1IYXNoJzogaGFzaCxcbiAgICAgICdYLUFtei1NZXRhLUVuY3J5cHRlZCc6IGNyaXB0b2dyYWZhciA/ICd0cnVlJyA6ICdmYWxzZScsXG4gICAgfTtcblxuICAgIC8vIFNlIG8gZG9jdW1lbnRvIGZvciBzZW5zw612ZWwsIGNyaXB0b2dyYWZhclxuICAgIGlmIChjcmlwdG9ncmFmYXIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIENyaXB0b2dyYWZhciBvIGFycXVpdm9cbiAgICAgICAgY29uc3QgeyBkYWRvc0NyaXB0b2dyYWZhZG9zLCBpdiwgYXV0aFRhZyB9ID1cbiAgICAgICAgICB0aGlzLmNyaXB0b2dyYWZpYVNlcnZpY2UuY3JpcHRvZ3JhZmFyQnVmZmVyKGFycXVpdm8pO1xuXG4gICAgICAgIC8vIFVzYXIgbyBhcnF1aXZvIGNyaXB0b2dyYWZhZG9cbiAgICAgICAgYXJxdWl2b0ZpbmFsID0gZGFkb3NDcmlwdG9ncmFmYWRvcztcblxuICAgICAgICAvLyBBZGljaW9uYXIgbWV0YWRhZG9zIGRlIGNyaXB0b2dyYWZpYVxuICAgICAgICBtZXRhZGFkb3NbJ1gtQW16LU1ldGEtSVYnXSA9IGl2LnRvU3RyaW5nKCdiYXNlNjQnKTtcbiAgICAgICAgbWV0YWRhZG9zWydYLUFtei1NZXRhLUF1dGhUYWcnXSA9IGF1dGhUYWcudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuXG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZyhgQXJxdWl2byAke25vbWVBcnF1aXZvfSBjcmlwdG9ncmFmYWRvIGNvbSBzdWNlc3NvYCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJybyBhbyBjcmlwdG9ncmFmYXIgYXJxdWl2bzogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhbGhhIGFvIGNyaXB0b2dyYWZhciBkb2N1bWVudG86ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gRmF6ZXIgdXBsb2FkIGRvIGFycXVpdm8gcGFyYSBvIE1pbklPXG4gICAgICBhd2FpdCB0aGlzLm1pbmlvQ2xpZW50LnB1dE9iamVjdChcbiAgICAgICAgdGhpcy5idWNrZXROYW1lLFxuICAgICAgICBub21lQXJxdWl2byxcbiAgICAgICAgYXJxdWl2b0ZpbmFsLFxuICAgICAgICBhcnF1aXZvRmluYWwubGVuZ3RoLFxuICAgICAgICBtZXRhZGFkb3MsXG4gICAgICApO1xuXG4gICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgIGBBcnF1aXZvICR7bm9tZUFycXVpdm99IGVudmlhZG8gcGFyYSBvIE1pbklPIGNvbSBzdWNlc3NvYCxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5vbWVBcnF1aXZvLFxuICAgICAgICB0YW1hbmhvOiBhcnF1aXZvLmxlbmd0aCwgLy8gVGFtYW5obyBvcmlnaW5hbCwgbsOjbyBvIGNyaXB0b2dyYWZhZG9cbiAgICAgICAgaGFzaCxcbiAgICAgICAgY3JpcHRvZ3JhZmFkbzogY3JpcHRvZ3JhZmFyLFxuICAgICAgICBtZXRhZGFkb3M6IHtcbiAgICAgICAgICB0aXBvRG9jdW1lbnRvLFxuICAgICAgICAgIHNvbGljaXRhY2FvSWQsXG4gICAgICAgICAgbm9tZU9yaWdpbmFsLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvIGFvIGVudmlhciBhcnF1aXZvIHBhcmEgbyBNaW5JTzogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWxoYSBhbyBhcm1hemVuYXIgZG9jdW1lbnRvOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEJhaXhhIHVtIGFycXVpdm8gZG8gTWluSU9cbiAgICogQHBhcmFtIG5vbWVBcnF1aXZvIE5vbWUgZG8gYXJxdWl2byBubyBNaW5JT1xuICAgKiBAcmV0dXJucyBCdWZmZXIgY29tIG8gY29udGXDumRvIG9yaWdpbmFsIGRvIGFycXVpdm8gKGRlc2NyaXB0b2dyYWZhZG8gc2UgbmVjZXNzw6FyaW8pXG4gICAqL1xuICBhc3luYyBkb3dubG9hZEFycXVpdm8obm9tZUFycXVpdm86IHN0cmluZyk6IFByb21pc2U8e1xuICAgIGFycXVpdm86IEJ1ZmZlcjtcbiAgICBtZXRhZGFkb3M6IGFueTtcbiAgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBPYnRlciBtZXRhZGFkb3MgZG8gYXJxdWl2b1xuICAgICAgY29uc3Qgc3RhdCA9IGF3YWl0IHRoaXMubWluaW9DbGllbnQuc3RhdE9iamVjdChcbiAgICAgICAgdGhpcy5idWNrZXROYW1lLFxuICAgICAgICBub21lQXJxdWl2byxcbiAgICAgICk7XG5cbiAgICAgIC8vIENyaWFyIGFycXVpdm8gdGVtcG9yw6FyaW8gcGFyYSBkb3dubG9hZFxuICAgICAgY29uc3QgdGVtcEZpbGVQYXRoID0gcGF0aC5qb2luKFxuICAgICAgICB0aGlzLnRlbXBEaXIsXG4gICAgICAgIGBkb3dubG9hZC0ke0RhdGUubm93KCl9LSR7cGF0aC5iYXNlbmFtZShub21lQXJxdWl2byl9YCxcbiAgICAgICk7XG5cbiAgICAgIC8vIEJhaXhhciBhcnF1aXZvIGRvIE1pbklPXG4gICAgICBhd2FpdCB0aGlzLm1pbmlvQ2xpZW50LmZHZXRPYmplY3QoXG4gICAgICAgIHRoaXMuYnVja2V0TmFtZSxcbiAgICAgICAgbm9tZUFycXVpdm8sXG4gICAgICAgIHRlbXBGaWxlUGF0aCxcbiAgICAgICk7XG5cbiAgICAgIC8vIExlciBhcnF1aXZvIGJhaXhhZG9cbiAgICAgIGNvbnN0IGFycXVpdm9DcmlwdG9ncmFmYWRvID0gZnMucmVhZEZpbGVTeW5jKHRlbXBGaWxlUGF0aCk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciBzZSBvIGFycXVpdm8gZXN0w6EgY3JpcHRvZ3JhZmFkb1xuICAgICAgY29uc3QgY3JpcHRvZ3JhZmFkbyA9IHN0YXQubWV0YURhdGFbJ3gtYW16LW1ldGEtZW5jcnlwdGVkJ10gPT09ICd0cnVlJztcblxuICAgICAgbGV0IGFycXVpdm9GaW5hbCA9IGFycXVpdm9DcmlwdG9ncmFmYWRvO1xuXG4gICAgICAvLyBTZSBlc3RpdmVyIGNyaXB0b2dyYWZhZG8sIGRlc2NyaXB0b2dyYWZhclxuICAgICAgaWYgKGNyaXB0b2dyYWZhZG8pIHtcbiAgICAgICAgY29uc3QgaXYgPSBCdWZmZXIuZnJvbShzdGF0Lm1ldGFEYXRhWyd4LWFtei1tZXRhLWl2J10sICdiYXNlNjQnKTtcbiAgICAgICAgY29uc3QgYXV0aFRhZyA9IEJ1ZmZlci5mcm9tKFxuICAgICAgICAgIHN0YXQubWV0YURhdGFbJ3gtYW16LW1ldGEtYXV0aHRhZyddLFxuICAgICAgICAgICdiYXNlNjQnLFxuICAgICAgICApO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXJxdWl2b0ZpbmFsID0gdGhpcy5jcmlwdG9ncmFmaWFTZXJ2aWNlLmRlc2NyaXB0b2dyYWZhckJ1ZmZlcihcbiAgICAgICAgICAgIGFycXVpdm9DcmlwdG9ncmFmYWRvLFxuICAgICAgICAgICAgaXYsXG4gICAgICAgICAgICBhdXRoVGFnLFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgICAgICBgQXJxdWl2byAke25vbWVBcnF1aXZvfSBkZXNjcmlwdG9ncmFmYWRvIGNvbSBzdWNlc3NvYCxcbiAgICAgICAgICApO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICAgICAgYEVycm8gYW8gZGVzY3JpcHRvZ3JhZmFyIGFycXVpdm86ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICAgICk7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEZhbGhhIGFvIGRlc2NyaXB0b2dyYWZhciBkb2N1bWVudG86ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gVmVyaWZpY2FyIGludGVncmlkYWRlIGRvIGFycXVpdm9cbiAgICAgIGNvbnN0IGhhc2hPcmlnaW5hbCA9IHN0YXQubWV0YURhdGFbJ3gtYW16LW1ldGEtaGFzaCddO1xuICAgICAgY29uc3QgaGFzaENhbGN1bGFkbyA9IHRoaXMuY3JpcHRvZ3JhZmlhU2VydmljZS5nZXJhckhhc2goYXJxdWl2b0ZpbmFsKTtcblxuICAgICAgaWYgKGhhc2hPcmlnaW5hbCAhPT0gaGFzaENhbGN1bGFkbykge1xuICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihgSW50ZWdyaWRhZGUgZG8gYXJxdWl2byAke25vbWVBcnF1aXZvfSBjb21wcm9tZXRpZGFgKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdBIGludGVncmlkYWRlIGRvIGRvY3VtZW50byBmb2kgY29tcHJvbWV0aWRhLiBPIGhhc2ggbsOjbyBjb3JyZXNwb25kZSBhbyBvcmlnaW5hbC4nLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBSZW1vdmVyIGFycXVpdm8gdGVtcG9yw6FyaW9cbiAgICAgIGZzLnVubGlua1N5bmModGVtcEZpbGVQYXRoKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXJxdWl2bzogYXJxdWl2b0ZpbmFsLFxuICAgICAgICBtZXRhZGFkb3M6IHtcbiAgICAgICAgICBub21lT3JpZ2luYWw6IHN0YXQubWV0YURhdGFbJ3gtYW16LW1ldGEtb3JpZ2luYWwtbmFtZSddLFxuICAgICAgICAgIGNvbnRlbnRUeXBlOiBzdGF0Lm1ldGFEYXRhWydjb250ZW50LXR5cGUnXSxcbiAgICAgICAgICB0YW1hbmhvOiBhcnF1aXZvRmluYWwubGVuZ3RoLFxuICAgICAgICAgIGNyaXB0b2dyYWZhZG8sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJybyBhbyBiYWl4YXIgYXJxdWl2byBkbyBNaW5JTzogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWxoYSBhbyByZWN1cGVyYXIgZG9jdW1lbnRvOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSB1bSBhcnF1aXZvIGRvIE1pbklPXG4gICAqIEBwYXJhbSBub21lQXJxdWl2byBOb21lIGRvIGFycXVpdm8gbm8gTWluSU9cbiAgICovXG4gIGFzeW5jIHJlbW92ZXJBcnF1aXZvKG5vbWVBcnF1aXZvOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5taW5pb0NsaWVudC5yZW1vdmVPYmplY3QodGhpcy5idWNrZXROYW1lLCBub21lQXJxdWl2byk7XG4gICAgICB0aGlzLmxvZ2dlci5sb2coYEFycXVpdm8gJHtub21lQXJxdWl2b30gcmVtb3ZpZG8gZG8gTWluSU8gY29tIHN1Y2Vzc29gKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm8gYW8gcmVtb3ZlciBhcnF1aXZvIGRvIE1pbklPOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhbGhhIGFvIHJlbW92ZXIgZG9jdW1lbnRvOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERldGVjdGEgbyB0aXBvIE1JTUUgZGUgdW0gYXJxdWl2byBjb20gYmFzZSBuYSBleHRlbnPDo29cbiAgICogQHBhcmFtIG5vbWVBcnF1aXZvIE5vbWUgZG8gYXJxdWl2b1xuICAgKiBAcmV0dXJucyBUaXBvIE1JTUUgZG8gYXJxdWl2b1xuICAgKi9cbiAgcHJpdmF0ZSBkZXRlY3Rhck1pbWVUeXBlKG5vbWVBcnF1aXZvOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGV4dGVuc2FvID0gcGF0aC5leHRuYW1lKG5vbWVBcnF1aXZvKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgY29uc3QgbWltZVR5cGVzID0ge1xuICAgICAgJy5wZGYnOiAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAgICcuanBnJzogJ2ltYWdlL2pwZWcnLFxuICAgICAgJy5qcGVnJzogJ2ltYWdlL2pwZWcnLFxuICAgICAgJy5wbmcnOiAnaW1hZ2UvcG5nJyxcbiAgICAgICcuZ2lmJzogJ2ltYWdlL2dpZicsXG4gICAgICAnLnRpZmYnOiAnaW1hZ2UvdGlmZicsXG4gICAgICAnLnRpZic6ICdpbWFnZS90aWZmJyxcbiAgICAgICcuZG9jJzogJ2FwcGxpY2F0aW9uL21zd29yZCcsXG4gICAgICAnLmRvY3gnOlxuICAgICAgICAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQnLFxuICAgICAgJy54bHMnOiAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsJyxcbiAgICAgICcueGxzeCc6XG4gICAgICAgICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCcsXG4gICAgICAnLnBwdCc6ICdhcHBsaWNhdGlvbi92bmQubXMtcG93ZXJwb2ludCcsXG4gICAgICAnLnBwdHgnOlxuICAgICAgICAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnByZXNlbnRhdGlvbm1sLnByZXNlbnRhdGlvbicsXG4gICAgICAnLnR4dCc6ICd0ZXh0L3BsYWluJyxcbiAgICAgICcuemlwJzogJ2FwcGxpY2F0aW9uL3ppcCcsXG4gICAgICAnLnJhcic6ICdhcHBsaWNhdGlvbi94LXJhci1jb21wcmVzc2VkJyxcbiAgICAgICcuN3onOiAnYXBwbGljYXRpb24veC03ei1jb21wcmVzc2VkJyxcbiAgICAgICcudGFyJzogJ2FwcGxpY2F0aW9uL3gtdGFyJyxcbiAgICAgICcuZ3onOiAnYXBwbGljYXRpb24vZ3ppcCcsXG4gICAgfTtcblxuICAgIHJldHVybiBtaW1lVHlwZXNbZXh0ZW5zYW9dIHx8ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlcmEgdW1hIFVSTCBwcsOpLWFzc2luYWRhIHBhcmEgYWNlc3NvIHRlbXBvcsOhcmlvIGEgdW0gYXJxdWl2b1xuICAgKiBAcGFyYW0gbm9tZUFycXVpdm8gTm9tZSBkbyBhcnF1aXZvIG5vIE1pbklPXG4gICAqIEBwYXJhbSBleHBpcmFjYW9TZWd1bmRvcyBUZW1wbyBkZSBleHBpcmHDp8OjbyBkYSBVUkwgZW0gc2VndW5kb3NcbiAgICogQHJldHVybnMgVVJMIHByw6ktYXNzaW5hZGFcbiAgICovXG4gIGFzeW5jIGdlcmFyVXJsUHJlQXNzaW5hZGEoXG4gICAgbm9tZUFycXVpdm86IHN0cmluZyxcbiAgICBleHBpcmFjYW9TZWd1bmRvcyA9IDM2MDAsXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLm1pbmlvQ2xpZW50LnByZXNpZ25lZEdldE9iamVjdChcbiAgICAgICAgdGhpcy5idWNrZXROYW1lLFxuICAgICAgICBub21lQXJxdWl2byxcbiAgICAgICAgZXhwaXJhY2FvU2VndW5kb3MsXG4gICAgICApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJybyBhbyBnZXJhciBVUkwgcHLDqS1hc3NpbmFkYTogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgRmFsaGEgYW8gZ2VyYXIgVVJMIHBhcmEgYWNlc3NvIGFvIGRvY3VtZW50bzogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9