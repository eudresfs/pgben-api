c75e147e8791487b213865249abab289
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.ComprovanteController = void 0;
const common_1 = require("@nestjs/common");
const platform_express_1 = require("@nestjs/platform-express");
const swagger_1 = require("@nestjs/swagger");
const comprovante_service_1 = require("../services/comprovante.service");
const comprovante_upload_dto_1 = require("../dtos/comprovante-upload.dto");
const comprovante_response_dto_1 = require("../dtos/comprovante-response.dto");
const express_1 = require("express");
/**
 * Controller para gerenciamento de comprovantes de pagamento
 *
 * Implementa endpoints para upload, visualização e remoção de
 * documentos comprobatórios anexados aos pagamentos.
 *
 * @author Equipe PGBen
 */
let ComprovanteController = class ComprovanteController {
    comprovanteService;
    constructor(comprovanteService) {
        this.comprovanteService = comprovanteService;
    }
    /**
     * Lista todos os comprovantes associados a um pagamento
     */
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    async findAll(pagamentoId) {
        const comprovantes = await this.comprovanteService.findAllByPagamento(pagamentoId);
        // Mapear para DTO de resposta
        return comprovantes.map(comprovante => ({
            id: comprovante.id,
            pagamentoId: comprovante.pagamento_id,
            tipoDocumento: comprovante.tipo_documento,
            nomeArquivo: comprovante.nome_arquivo,
            tamanho: comprovante.tamanho,
            mimeType: comprovante.mime_type,
            dataUpload: comprovante.data_upload,
            uploadedPor: {
                id: comprovante.uploaded_por,
                nome: 'Usuário Responsável' // seria obtido da entidade Usuario
            }
        }));
    }
    /**
     * Realiza o upload de um comprovante para um pagamento
     */
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    async uploadComprovante(pagamentoId, file, uploadDto) {
        if (!file) {
            throw new common_1.BadRequestException('Nenhum arquivo enviado');
        }
        // Usar o ID do usuário atual
        const usuarioId = 'placeholder'; // usuario.id;
        const comprovante = await this.comprovanteService.uploadComprovante(pagamentoId, file, uploadDto, usuarioId);
        // Mapear para DTO de resposta
        return {
            id: comprovante.id,
            pagamentoId: comprovante.pagamento_id,
            tipoDocumento: comprovante.tipo_documento,
            nomeArquivo: comprovante.nome_arquivo,
            tamanho: comprovante.tamanho,
            mimeType: comprovante.mime_type,
            dataUpload: comprovante.data_upload,
            uploadedPor: {
                id: usuarioId,
                nome: 'Usuário Responsável' // seria obtido da entidade Usuario
            }
        };
    }
    /**
     * Obtém um comprovante específico para download
     */
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    async downloadComprovante(id, res) {
        const { buffer, fileName, mimeType } = await this.comprovanteService.getComprovanteContent(id);
        res.set({
            'Content-Type': mimeType,
            'Content-Disposition': `attachment; filename="${encodeURIComponent(fileName)}"`,
            'Content-Length': buffer.length.toString()
        });
        res.end(buffer);
    }
    /**
     * Busca um comprovante pelo ID
     */
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    async findOne(id) {
        const comprovante = await this.comprovanteService.findOne(id);
        if (!comprovante) {
            throw new common_1.NotFoundException('Comprovante não encontrado');
        }
        // Mapear para DTO de resposta
        return {
            id: comprovante.id,
            pagamentoId: comprovante.pagamento_id,
            tipoDocumento: comprovante.tipo_documento,
            nomeArquivo: comprovante.nome_arquivo,
            tamanho: comprovante.tamanho,
            mimeType: comprovante.mime_type,
            dataUpload: comprovante.data_upload,
            uploadedPor: {
                id: comprovante.uploaded_por,
                nome: 'Usuário Responsável' // seria obtido da entidade Usuario
            }
        };
    }
    /**
     * Remove um comprovante
     */
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    async remove(id) {
        // Usar o ID do usuário atual
        const usuarioId = 'placeholder'; // usuario.id;
        await this.comprovanteService.removeComprovante(id, usuarioId);
        return { message: 'Comprovante removido com sucesso' };
    }
};
exports.ComprovanteController = ComprovanteController;
__decorate([
    (0, common_1.Get)(),
    (0, swagger_1.ApiOperation)({ summary: 'Lista comprovantes para um determinado pagamento' }),
    (0, swagger_1.ApiParam)({ name: 'pagamentoId', type: 'string', description: 'ID do pagamento' }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Lista de comprovantes',
        type: [comprovante_response_dto_1.ComprovanteResponseDto]
    }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Pagamento não encontrado' }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' })
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    ,
    __param(0, (0, common_1.Param)('pagamentoId', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], ComprovanteController.prototype, "findAll", null);
__decorate([
    (0, common_1.Post)(),
    (0, common_1.UseInterceptors)((0, platform_express_1.FileInterceptor)('file')),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, swagger_1.ApiOperation)({ summary: 'Realiza upload de um comprovante para um pagamento' }),
    (0, swagger_1.ApiParam)({ name: 'pagamentoId', type: 'string', description: 'ID do pagamento' }),
    (0, swagger_1.ApiResponse)({ status: 201, description: 'Comprovante enviado com sucesso', type: comprovante_response_dto_1.ComprovanteResponseDto }),
    (0, swagger_1.ApiResponse)({ status: 400, description: 'Arquivo inválido ou dados incorretos' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Pagamento não encontrado' }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' })
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    ,
    __param(0, (0, common_1.Param)('pagamentoId', common_1.ParseUUIDPipe)),
    __param(1, (0, common_1.UploadedFile)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object, typeof (_b = typeof comprovante_upload_dto_1.ComprovanteUploadDto !== "undefined" && comprovante_upload_dto_1.ComprovanteUploadDto) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], ComprovanteController.prototype, "uploadComprovante", null);
__decorate([
    (0, common_1.Get)(':id/download'),
    (0, swagger_1.ApiOperation)({ summary: 'Faz download de um comprovante' }),
    (0, swagger_1.ApiParam)({ name: 'pagamentoId', type: 'string', description: 'ID do pagamento' }),
    (0, swagger_1.ApiParam)({ name: 'id', type: 'string', description: 'ID do comprovante' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Arquivo enviado com sucesso' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Comprovante não encontrado' }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' })
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    ,
    __param(0, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __param(1, (0, common_1.Res)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, typeof (_c = typeof express_1.Response !== "undefined" && express_1.Response) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ComprovanteController.prototype, "downloadComprovante", null);
__decorate([
    (0, common_1.Get)(':id'),
    (0, swagger_1.ApiOperation)({ summary: 'Busca um comprovante pelo ID' }),
    (0, swagger_1.ApiParam)({ name: 'pagamentoId', type: 'string', description: 'ID do pagamento' }),
    (0, swagger_1.ApiParam)({ name: 'id', type: 'string', description: 'ID do comprovante' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Comprovante encontrado', type: comprovante_response_dto_1.ComprovanteResponseDto }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Comprovante não encontrado' }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' })
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    ,
    __param(0, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], ComprovanteController.prototype, "findOne", null);
__decorate([
    (0, common_1.Delete)(':id'),
    (0, swagger_1.ApiOperation)({ summary: 'Remove um comprovante' }),
    (0, swagger_1.ApiParam)({ name: 'pagamentoId', type: 'string', description: 'ID do pagamento' }),
    (0, swagger_1.ApiParam)({ name: 'id', type: 'string', description: 'ID do comprovante' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Comprovante removido com sucesso' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Comprovante não encontrado' }),
    (0, swagger_1.ApiResponse)({ status: 409, description: 'Comprovante não pode ser removido' }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' })
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    ,
    __param(0, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], ComprovanteController.prototype, "remove", null);
exports.ComprovanteController = ComprovanteController = __decorate([
    (0, swagger_1.ApiTags)('Pagamentos'),
    (0, common_1.Controller)('pagamentos/:pagamentoId/comprovantes'),
    __metadata("design:paramtypes", [typeof (_a = typeof comprovante_service_1.ComprovanteService !== "undefined" && comprovante_service_1.ComprovanteService) === "function" ? _a : Object])
], ComprovanteController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcY29udHJvbGxlcnNcXGNvbXByb3ZhbnRlLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQWN3QjtBQUN4QiwrREFBMkQ7QUFDM0QsNkNBQTRGO0FBQzVGLHlFQUFxRTtBQUNyRSwyRUFBc0U7QUFDdEUsK0VBQTBFO0FBQzFFLHFDQUFtQztBQUVuQzs7Ozs7OztHQU9HO0FBR0ksSUFBTSxxQkFBcUIsR0FBM0IsTUFBTSxxQkFBcUI7SUFDSDtJQUE3QixZQUE2QixrQkFBc0M7UUFBdEMsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtJQUFHLENBQUM7SUFFdkU7O09BRUc7SUFhRyxBQUZOLHlCQUF5QjtJQUN6Qiw4Q0FBOEM7SUFDOUMsS0FBSyxDQUFDLE9BQU8sQ0FBc0MsV0FBbUI7UUFDcEUsTUFBTSxZQUFZLEdBQUcsTUFBTSxJQUFJLENBQUMsa0JBQWtCLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLENBQUM7UUFFbkYsOEJBQThCO1FBQzlCLE9BQU8sWUFBWSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDdEMsRUFBRSxFQUFFLFdBQVcsQ0FBQyxFQUFFO1lBQ2xCLFdBQVcsRUFBRSxXQUFXLENBQUMsWUFBWTtZQUNyQyxhQUFhLEVBQUUsV0FBVyxDQUFDLGNBQWM7WUFDekMsV0FBVyxFQUFFLFdBQVcsQ0FBQyxZQUFZO1lBQ3JDLE9BQU8sRUFBRSxXQUFXLENBQUMsT0FBTztZQUM1QixRQUFRLEVBQUUsV0FBVyxDQUFDLFNBQVM7WUFDL0IsVUFBVSxFQUFFLFdBQVcsQ0FBQyxXQUFXO1lBQ25DLFdBQVcsRUFBRTtnQkFDWCxFQUFFLEVBQUUsV0FBVyxDQUFDLFlBQVk7Z0JBQzVCLElBQUksRUFBRSxxQkFBcUIsQ0FBQyxtQ0FBbUM7YUFD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LElBQUEsZUFBTSxFQUFDLEtBQUssQ0FBQztJQUNiLElBQUEsc0JBQVksRUFBQyxFQUFFLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxDQUFDO0lBQ2xELElBQUEsa0JBQVEsRUFBQyxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQztJQUNqRixJQUFBLGtCQUFRLEVBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLG1CQUFtQixFQUFFLENBQUM7SUFDMUUsSUFBQSxxQkFBVyxFQUFDLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsa0NBQWtDLEVBQUUsQ0FBQztJQUM3RSxJQUFBLHFCQUFXLEVBQUMsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSw0QkFBNEIsRUFBRSxDQUFDO0lBQ3ZFLElBQUEscUJBQVcsRUFBQyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLG1DQUFtQyxFQUFFLENBQUM7SUFDOUUsSUFBQSxxQkFBVyxFQUFDLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsZUFBZSxFQUFFLENBQUM7SUFDM0QseUJBQXlCO0lBQ3pCLDhDQUE4Qzs7SUFFM0MsV0FBQSxJQUFBLGNBQUssRUFBQyxJQUFJLEVBQUUsc0JBQWEsQ0FBQyxDQUFBOzs7O21EQVM1QjtnQ0E1S1UscUJBQXFCO0lBRmpDLElBQUEsaUJBQU8sRUFBQyxZQUFZLENBQUM7SUFDckIsSUFBQSxtQkFBVSxFQUFDLHNDQUFzQyxDQUFDO3lEQUVBLHdDQUFrQixvQkFBbEIsd0NBQWtCO0dBRHhELHFCQUFxQixDQTZLakMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcY29udHJvbGxlcnNcXGNvbXByb3ZhbnRlLmNvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgXG4gIENvbnRyb2xsZXIsIFxuICBHZXQsIFxuICBQb3N0LCBcbiAgRGVsZXRlLCBcbiAgUGFyYW0sIFxuICBQYXJzZVVVSURQaXBlLCBcbiAgVXNlSW50ZXJjZXB0b3JzLCBcbiAgVXBsb2FkZWRGaWxlLCBcbiAgQmFkUmVxdWVzdEV4Y2VwdGlvbiwgXG4gIEJvZHksIFxuICBSZXMsXG4gIFVzZUd1YXJkcyxcbiAgTm90Rm91bmRFeGNlcHRpb25cbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgRmlsZUludGVyY2VwdG9yIH0gZnJvbSAnQG5lc3Rqcy9wbGF0Zm9ybS1leHByZXNzJztcbmltcG9ydCB7IEFwaUNvbnN1bWVzLCBBcGlPcGVyYXRpb24sIEFwaVBhcmFtLCBBcGlSZXNwb25zZSwgQXBpVGFncyB9IGZyb20gJ0BuZXN0anMvc3dhZ2dlcic7XG5pbXBvcnQgeyBDb21wcm92YW50ZVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9jb21wcm92YW50ZS5zZXJ2aWNlJztcbmltcG9ydCB7IENvbXByb3ZhbnRlVXBsb2FkRHRvIH0gZnJvbSAnLi4vZHRvcy9jb21wcm92YW50ZS11cGxvYWQuZHRvJztcbmltcG9ydCB7IENvbXByb3ZhbnRlUmVzcG9uc2VEdG8gfSBmcm9tICcuLi9kdG9zL2NvbXByb3ZhbnRlLXJlc3BvbnNlLmR0byc7XG5pbXBvcnQgeyBSZXNwb25zZSB9IGZyb20gJ2V4cHJlc3MnO1xuXG4vKipcbiAqIENvbnRyb2xsZXIgcGFyYSBnZXJlbmNpYW1lbnRvIGRlIGNvbXByb3ZhbnRlcyBkZSBwYWdhbWVudG9cbiAqIFxuICogSW1wbGVtZW50YSBlbmRwb2ludHMgcGFyYSB1cGxvYWQsIHZpc3VhbGl6YcOnw6NvIGUgcmVtb8Onw6NvIGRlXG4gKiBkb2N1bWVudG9zIGNvbXByb2JhdMOzcmlvcyBhbmV4YWRvcyBhb3MgcGFnYW1lbnRvcy5cbiAqIFxuICogQGF1dGhvciBFcXVpcGUgUEdCZW5cbiAqL1xuQEFwaVRhZ3MoJ1BhZ2FtZW50b3MnKVxuQENvbnRyb2xsZXIoJ3BhZ2FtZW50b3MvOnBhZ2FtZW50b0lkL2NvbXByb3ZhbnRlcycpXG5leHBvcnQgY2xhc3MgQ29tcHJvdmFudGVDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBjb21wcm92YW50ZVNlcnZpY2U6IENvbXByb3ZhbnRlU2VydmljZSkge31cblxuICAvKipcbiAgICogTGlzdGEgdG9kb3Mgb3MgY29tcHJvdmFudGVzIGFzc29jaWFkb3MgYSB1bSBwYWdhbWVudG9cbiAgICovXG4gIEBHZXQoKVxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0xpc3RhIGNvbXByb3ZhbnRlcyBwYXJhIHVtIGRldGVybWluYWRvIHBhZ2FtZW50bycgfSlcbiAgQEFwaVBhcmFtKHsgbmFtZTogJ3BhZ2FtZW50b0lkJywgdHlwZTogJ3N0cmluZycsIGRlc2NyaXB0aW9uOiAnSUQgZG8gcGFnYW1lbnRvJyB9KVxuICBAQXBpUmVzcG9uc2UoeyBcbiAgICBzdGF0dXM6IDIwMCwgXG4gICAgZGVzY3JpcHRpb246ICdMaXN0YSBkZSBjb21wcm92YW50ZXMnLCBcbiAgICB0eXBlOiBbQ29tcHJvdmFudGVSZXNwb25zZUR0b10gXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDA0LCBkZXNjcmlwdGlvbjogJ1BhZ2FtZW50byBuw6NvIGVuY29udHJhZG8nIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAzLCBkZXNjcmlwdGlvbjogJ0FjZXNzbyBuZWdhZG8nIH0pXG4gIC8vIEBVc2VHdWFyZHMoUm9sZXNHdWFyZClcbiAgLy8gQFJvbGVzKCdhZG1pbicsICdnZXN0b3Jfc2VtdGFzJywgJ3RlY25pY28nKVxuICBhc3luYyBmaW5kQWxsKEBQYXJhbSgncGFnYW1lbnRvSWQnLCBQYXJzZVVVSURQaXBlKSBwYWdhbWVudG9JZDogc3RyaW5nKSB7XG4gICAgY29uc3QgY29tcHJvdmFudGVzID0gYXdhaXQgdGhpcy5jb21wcm92YW50ZVNlcnZpY2UuZmluZEFsbEJ5UGFnYW1lbnRvKHBhZ2FtZW50b0lkKTtcbiAgICBcbiAgICAvLyBNYXBlYXIgcGFyYSBEVE8gZGUgcmVzcG9zdGFcbiAgICByZXR1cm4gY29tcHJvdmFudGVzLm1hcChjb21wcm92YW50ZSA9PiAoe1xuICAgICAgaWQ6IGNvbXByb3ZhbnRlLmlkLFxuICAgICAgcGFnYW1lbnRvSWQ6IGNvbXByb3ZhbnRlLnBhZ2FtZW50b19pZCxcbiAgICAgIHRpcG9Eb2N1bWVudG86IGNvbXByb3ZhbnRlLnRpcG9fZG9jdW1lbnRvLFxuICAgICAgbm9tZUFycXVpdm86IGNvbXByb3ZhbnRlLm5vbWVfYXJxdWl2byxcbiAgICAgIHRhbWFuaG86IGNvbXByb3ZhbnRlLnRhbWFuaG8sXG4gICAgICBtaW1lVHlwZTogY29tcHJvdmFudGUubWltZV90eXBlLFxuICAgICAgZGF0YVVwbG9hZDogY29tcHJvdmFudGUuZGF0YV91cGxvYWQsXG4gICAgICB1cGxvYWRlZFBvcjoge1xuICAgICAgICBpZDogY29tcHJvdmFudGUudXBsb2FkZWRfcG9yLFxuICAgICAgICBub21lOiAnVXN1w6FyaW8gUmVzcG9uc8OhdmVsJyAvLyBzZXJpYSBvYnRpZG8gZGEgZW50aWRhZGUgVXN1YXJpb1xuICAgICAgfVxuICAgIH0pKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWFsaXphIG8gdXBsb2FkIGRlIHVtIGNvbXByb3ZhbnRlIHBhcmEgdW0gcGFnYW1lbnRvXG4gICAqL1xuICBAUG9zdCgpXG4gIEBVc2VJbnRlcmNlcHRvcnMoRmlsZUludGVyY2VwdG9yKCdmaWxlJykpXG4gIEBBcGlDb25zdW1lcygnbXVsdGlwYXJ0L2Zvcm0tZGF0YScpXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnUmVhbGl6YSB1cGxvYWQgZGUgdW0gY29tcHJvdmFudGUgcGFyYSB1bSBwYWdhbWVudG8nIH0pXG4gIEBBcGlQYXJhbSh7IG5hbWU6ICdwYWdhbWVudG9JZCcsIHR5cGU6ICdzdHJpbmcnLCBkZXNjcmlwdGlvbjogJ0lEIGRvIHBhZ2FtZW50bycgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiAyMDEsIGRlc2NyaXB0aW9uOiAnQ29tcHJvdmFudGUgZW52aWFkbyBjb20gc3VjZXNzbycsIHR5cGU6IENvbXByb3ZhbnRlUmVzcG9uc2VEdG8gfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDAsIGRlc2NyaXB0aW9uOiAnQXJxdWl2byBpbnbDoWxpZG8gb3UgZGFkb3MgaW5jb3JyZXRvcycgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDQsIGRlc2NyaXB0aW9uOiAnUGFnYW1lbnRvIG7Do28gZW5jb250cmFkbycgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDMsIGRlc2NyaXB0aW9uOiAnQWNlc3NvIG5lZ2FkbycgfSlcbiAgLy8gQFVzZUd1YXJkcyhSb2xlc0d1YXJkKVxuICAvLyBAUm9sZXMoJ2FkbWluJywgJ2dlc3Rvcl9zZW10YXMnLCAndGVjbmljbycpXG4gIGFzeW5jIHVwbG9hZENvbXByb3ZhbnRlKFxuICAgIEBQYXJhbSgncGFnYW1lbnRvSWQnLCBQYXJzZVVVSURQaXBlKSBwYWdhbWVudG9JZDogc3RyaW5nLFxuICAgIEBVcGxvYWRlZEZpbGUoKSBmaWxlOiBhbnksXG4gICAgQEJvZHkoKSB1cGxvYWREdG86IENvbXByb3ZhbnRlVXBsb2FkRHRvLFxuICAgIC8vIEBDdXJyZW50VXNlcigpIHVzdWFyaW86IFVzdWFyaW9cbiAgKSB7XG4gICAgaWYgKCFmaWxlKSB7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignTmVuaHVtIGFycXVpdm8gZW52aWFkbycpO1xuICAgIH1cblxuICAgIC8vIFVzYXIgbyBJRCBkbyB1c3XDoXJpbyBhdHVhbFxuICAgIGNvbnN0IHVzdWFyaW9JZCA9ICdwbGFjZWhvbGRlcic7IC8vIHVzdWFyaW8uaWQ7XG4gICAgXG4gICAgY29uc3QgY29tcHJvdmFudGUgPSBhd2FpdCB0aGlzLmNvbXByb3ZhbnRlU2VydmljZS51cGxvYWRDb21wcm92YW50ZShcbiAgICAgIHBhZ2FtZW50b0lkLFxuICAgICAgZmlsZSxcbiAgICAgIHVwbG9hZER0byxcbiAgICAgIHVzdWFyaW9JZFxuICAgICk7XG5cbiAgICAvLyBNYXBlYXIgcGFyYSBEVE8gZGUgcmVzcG9zdGFcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGNvbXByb3ZhbnRlLmlkLFxuICAgICAgcGFnYW1lbnRvSWQ6IGNvbXByb3ZhbnRlLnBhZ2FtZW50b19pZCxcbiAgICAgIHRpcG9Eb2N1bWVudG86IGNvbXByb3ZhbnRlLnRpcG9fZG9jdW1lbnRvLFxuICAgICAgbm9tZUFycXVpdm86IGNvbXByb3ZhbnRlLm5vbWVfYXJxdWl2byxcbiAgICAgIHRhbWFuaG86IGNvbXByb3ZhbnRlLnRhbWFuaG8sXG4gICAgICBtaW1lVHlwZTogY29tcHJvdmFudGUubWltZV90eXBlLFxuICAgICAgZGF0YVVwbG9hZDogY29tcHJvdmFudGUuZGF0YV91cGxvYWQsXG4gICAgICB1cGxvYWRlZFBvcjoge1xuICAgICAgICBpZDogdXN1YXJpb0lkLFxuICAgICAgICBub21lOiAnVXN1w6FyaW8gUmVzcG9uc8OhdmVsJyAvLyBzZXJpYSBvYnRpZG8gZGEgZW50aWRhZGUgVXN1YXJpb1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogT2J0w6ltIHVtIGNvbXByb3ZhbnRlIGVzcGVjw61maWNvIHBhcmEgZG93bmxvYWRcbiAgICovXG4gIEBHZXQoJzppZC9kb3dubG9hZCcpXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnRmF6IGRvd25sb2FkIGRlIHVtIGNvbXByb3ZhbnRlJyB9KVxuICBAQXBpUGFyYW0oeyBuYW1lOiAncGFnYW1lbnRvSWQnLCB0eXBlOiAnc3RyaW5nJywgZGVzY3JpcHRpb246ICdJRCBkbyBwYWdhbWVudG8nIH0pXG4gIEBBcGlQYXJhbSh7IG5hbWU6ICdpZCcsIHR5cGU6ICdzdHJpbmcnLCBkZXNjcmlwdGlvbjogJ0lEIGRvIGNvbXByb3ZhbnRlJyB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDIwMCwgZGVzY3JpcHRpb246ICdBcnF1aXZvIGVudmlhZG8gY29tIHN1Y2Vzc28nIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDA0LCBkZXNjcmlwdGlvbjogJ0NvbXByb3ZhbnRlIG7Do28gZW5jb250cmFkbycgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDMsIGRlc2NyaXB0aW9uOiAnQWNlc3NvIG5lZ2FkbycgfSlcbiAgLy8gQFVzZUd1YXJkcyhSb2xlc0d1YXJkKVxuICAvLyBAUm9sZXMoJ2FkbWluJywgJ2dlc3Rvcl9zZW10YXMnLCAndGVjbmljbycpXG4gIGFzeW5jIGRvd25sb2FkQ29tcHJvdmFudGUoXG4gICAgQFBhcmFtKCdpZCcsIFBhcnNlVVVJRFBpcGUpIGlkOiBzdHJpbmcsXG4gICAgQFJlcygpIHJlczogUmVzcG9uc2VcbiAgKSB7XG4gICAgY29uc3QgeyBidWZmZXIsIGZpbGVOYW1lLCBtaW1lVHlwZSB9ID0gYXdhaXQgdGhpcy5jb21wcm92YW50ZVNlcnZpY2UuZ2V0Q29tcHJvdmFudGVDb250ZW50KGlkKTtcbiAgICBcbiAgICByZXMuc2V0KHtcbiAgICAgICdDb250ZW50LVR5cGUnOiBtaW1lVHlwZSxcbiAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uJzogYGF0dGFjaG1lbnQ7IGZpbGVuYW1lPVwiJHtlbmNvZGVVUklDb21wb25lbnQoZmlsZU5hbWUpfVwiYCxcbiAgICAgICdDb250ZW50LUxlbmd0aCc6IGJ1ZmZlci5sZW5ndGgudG9TdHJpbmcoKVxuICAgIH0pO1xuICAgIFxuICAgIHJlcy5lbmQoYnVmZmVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdXNjYSB1bSBjb21wcm92YW50ZSBwZWxvIElEXG4gICAqL1xuICBAR2V0KCc6aWQnKVxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0J1c2NhIHVtIGNvbXByb3ZhbnRlIHBlbG8gSUQnIH0pXG4gIEBBcGlQYXJhbSh7IG5hbWU6ICdwYWdhbWVudG9JZCcsIHR5cGU6ICdzdHJpbmcnLCBkZXNjcmlwdGlvbjogJ0lEIGRvIHBhZ2FtZW50bycgfSlcbiAgQEFwaVBhcmFtKHsgbmFtZTogJ2lkJywgdHlwZTogJ3N0cmluZycsIGRlc2NyaXB0aW9uOiAnSUQgZG8gY29tcHJvdmFudGUnIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogMjAwLCBkZXNjcmlwdGlvbjogJ0NvbXByb3ZhbnRlIGVuY29udHJhZG8nLCB0eXBlOiBDb21wcm92YW50ZVJlc3BvbnNlRHRvIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDA0LCBkZXNjcmlwdGlvbjogJ0NvbXByb3ZhbnRlIG7Do28gZW5jb250cmFkbycgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDMsIGRlc2NyaXB0aW9uOiAnQWNlc3NvIG5lZ2FkbycgfSlcbiAgLy8gQFVzZUd1YXJkcyhSb2xlc0d1YXJkKVxuICAvLyBAUm9sZXMoJ2FkbWluJywgJ2dlc3Rvcl9zZW10YXMnLCAndGVjbmljbycpXG4gIGFzeW5jIGZpbmRPbmUoQFBhcmFtKCdpZCcsIFBhcnNlVVVJRFBpcGUpIGlkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBjb21wcm92YW50ZSA9IGF3YWl0IHRoaXMuY29tcHJvdmFudGVTZXJ2aWNlLmZpbmRPbmUoaWQpO1xuICAgIFxuICAgIGlmICghY29tcHJvdmFudGUpIHtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignQ29tcHJvdmFudGUgbsOjbyBlbmNvbnRyYWRvJyk7XG4gICAgfVxuXG4gICAgLy8gTWFwZWFyIHBhcmEgRFRPIGRlIHJlc3Bvc3RhXG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBjb21wcm92YW50ZS5pZCxcbiAgICAgIHBhZ2FtZW50b0lkOiBjb21wcm92YW50ZS5wYWdhbWVudG9faWQsXG4gICAgICB0aXBvRG9jdW1lbnRvOiBjb21wcm92YW50ZS50aXBvX2RvY3VtZW50byxcbiAgICAgIG5vbWVBcnF1aXZvOiBjb21wcm92YW50ZS5ub21lX2FycXVpdm8sXG4gICAgICB0YW1hbmhvOiBjb21wcm92YW50ZS50YW1hbmhvLFxuICAgICAgbWltZVR5cGU6IGNvbXByb3ZhbnRlLm1pbWVfdHlwZSxcbiAgICAgIGRhdGFVcGxvYWQ6IGNvbXByb3ZhbnRlLmRhdGFfdXBsb2FkLFxuICAgICAgdXBsb2FkZWRQb3I6IHtcbiAgICAgICAgaWQ6IGNvbXByb3ZhbnRlLnVwbG9hZGVkX3BvcixcbiAgICAgICAgbm9tZTogJ1VzdcOhcmlvIFJlc3BvbnPDoXZlbCcgLy8gc2VyaWEgb2J0aWRvIGRhIGVudGlkYWRlIFVzdWFyaW9cbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSB1bSBjb21wcm92YW50ZVxuICAgKi9cbiAgQERlbGV0ZSgnOmlkJylcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdSZW1vdmUgdW0gY29tcHJvdmFudGUnIH0pXG4gIEBBcGlQYXJhbSh7IG5hbWU6ICdwYWdhbWVudG9JZCcsIHR5cGU6ICdzdHJpbmcnLCBkZXNjcmlwdGlvbjogJ0lEIGRvIHBhZ2FtZW50bycgfSlcbiAgQEFwaVBhcmFtKHsgbmFtZTogJ2lkJywgdHlwZTogJ3N0cmluZycsIGRlc2NyaXB0aW9uOiAnSUQgZG8gY29tcHJvdmFudGUnIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogMjAwLCBkZXNjcmlwdGlvbjogJ0NvbXByb3ZhbnRlIHJlbW92aWRvIGNvbSBzdWNlc3NvJyB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwNCwgZGVzY3JpcHRpb246ICdDb21wcm92YW50ZSBuw6NvIGVuY29udHJhZG8nIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDA5LCBkZXNjcmlwdGlvbjogJ0NvbXByb3ZhbnRlIG7Do28gcG9kZSBzZXIgcmVtb3ZpZG8nIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDAzLCBkZXNjcmlwdGlvbjogJ0FjZXNzbyBuZWdhZG8nIH0pXG4gIC8vIEBVc2VHdWFyZHMoUm9sZXNHdWFyZClcbiAgLy8gQFJvbGVzKCdhZG1pbicsICdnZXN0b3Jfc2VtdGFzJywgJ3RlY25pY28nKVxuICBhc3luYyByZW1vdmUoXG4gICAgQFBhcmFtKCdpZCcsIFBhcnNlVVVJRFBpcGUpIGlkOiBzdHJpbmcsXG4gICAgLy8gQEN1cnJlbnRVc2VyKCkgdXN1YXJpbzogVXN1YXJpb1xuICApIHtcbiAgICAvLyBVc2FyIG8gSUQgZG8gdXN1w6FyaW8gYXR1YWxcbiAgICBjb25zdCB1c3VhcmlvSWQgPSAncGxhY2Vob2xkZXInOyAvLyB1c3VhcmlvLmlkO1xuICAgIFxuICAgIGF3YWl0IHRoaXMuY29tcHJvdmFudGVTZXJ2aWNlLnJlbW92ZUNvbXByb3ZhbnRlKGlkLCB1c3VhcmlvSWQpO1xuICAgIFxuICAgIHJldHVybiB7IG1lc3NhZ2U6ICdDb21wcm92YW50ZSByZW1vdmlkbyBjb20gc3VjZXNzbycgfTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9