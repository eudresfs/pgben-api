f36b71da93f7cdbe1f1c7a5b950e77d0
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var VerificacaoPapelService_1;
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", { value: true });
exports.VerificacaoPapelService = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const cidadao_entity_1 = require("../../../entities/cidadao.entity");
const papel_cidadao_entity_1 = require("../../../entities/papel-cidadao.entity");
const tipo_papel_enum_1 = require("../../../enums/tipo-papel.enum");
const composicao_familiar_entity_1 = require("../../../entities/composicao-familiar.entity");
const historico_conversao_papel_service_1 = require("./historico-conversao-papel.service");
const papel_cidadao_service_1 = require("./papel-cidadao.service");
/**
 * Serviço de Verificação de Papel
 *
 * Responsável por verificar conflitos de papéis e realizar conversões
 * de papéis de cidadãos no sistema.
 */
let VerificacaoPapelService = VerificacaoPapelService_1 = class VerificacaoPapelService {
    cidadaoRepository;
    papelCidadaoRepository;
    composicaoFamiliarRepository;
    historicoService;
    papelCidadaoService;
    dataSource;
    logger = new common_1.Logger(VerificacaoPapelService_1.name);
    constructor(cidadaoRepository, papelCidadaoRepository, composicaoFamiliarRepository, historicoService, papelCidadaoService, dataSource) {
        this.cidadaoRepository = cidadaoRepository;
        this.papelCidadaoRepository = papelCidadaoRepository;
        this.composicaoFamiliarRepository = composicaoFamiliarRepository;
        this.historicoService = historicoService;
        this.papelCidadaoService = papelCidadaoService;
        this.dataSource = dataSource;
    }
    /**
     * Converte um cidadão para beneficiário
     * @param cidadaoId ID do cidadão
     * @param motivoConversao Motivo da conversão
     * @returns Resultado da conversão
     */
    async converterParaBeneficiario(cidadaoId, motivoConversao) {
        this.logger.log(`Iniciando conversão para beneficiário: ${cidadaoId}`);
        return this.dataSource.transaction(async (manager) => {
            // Verificar se o cidadão existe
            const cidadao = await manager.findOne(cidadao_entity_1.Cidadao, {
                where: { id: cidadaoId },
                relations: ['papeis'],
            });
            if (!cidadao) {
                throw new common_1.NotFoundException('Cidadão não encontrado');
            }
            // Verificar se já é beneficiário
            const jaBeneficiario = cidadao.papeis?.some((papel) => papel.tipo_papel === 'beneficiario' && papel.ativo);
            if (jaBeneficiario) {
                throw new common_1.ConflictException('Cidadão já é beneficiário');
            }
            // Verificar conflitos
            const conflitos = await this.verificarConflitoPapeis(cidadao.cpf);
            if (conflitos.temConflito) {
                // Registrar histórico de tentativa de conversão
                await this.historicoService.criarHistorico({
                    cidadao_id: cidadaoId,
                    papel_anterior: conflitos.tipoPapelAtual || 'membro_composicao',
                    papel_novo: 'beneficiario',
                    justificativa: `Conversão bloqueada: ${conflitos.detalhes}`,
                }, 'sistema');
                return {
                    sucesso: false,
                    mensagem: conflitos.detalhes || 'Conflito de papel detectado',
                };
            }
            // Desativar papéis conflitantes se necessário
            const papeisAtivos = cidadao.papeis?.filter((papel) => papel.ativo) || [];
            for (const papel of papeisAtivos) {
                if (papel.tipo_papel === 'membro_composicao') {
                    papel.ativo = false;
                    await manager.save(papel);
                }
            }
            // Criar papel de beneficiário
            const novoPapel = manager.create(papel_cidadao_entity_1.PapelCidadao, {
                cidadao_id: cidadaoId,
                tipo_papel: 'beneficiario',
                ativo: true,
                metadados: {},
            });
            await manager.save(novoPapel);
            // Registrar no histórico
            const historico = await this.historicoService.criarHistorico({
                cidadao_id: cidadaoId,
                papel_anterior: conflitos.tipoPapelAtual || 'membro_composicao',
                papel_novo: 'beneficiario',
                justificativa: motivoConversao,
            }, 'sistema');
            return {
                sucesso: true,
                mensagem: 'Conversão para beneficiário realizada com sucesso',
                historicoId: historico.id,
            };
        });
    }
    /**
     * Converte um membro de composição familiar para cidadão beneficiário
     * @param cpf CPF do membro de composição familiar
     * @param dadosCidadao Dados para criação do novo cidadão
     * @param justificativa Justificativa para a conversão
     * @param usuarioId ID do usuário que está realizando a conversão
     * @returns Resultado da conversão
     * @throws BadRequestException se os dados do cidadão forem inválidos
     * @throws ConflictException se o cidadão já for beneficiário
     * @throws NotFoundException se o membro não for encontrado
     * @throws InternalServerErrorException se ocorrer um erro durante a conversão
     */
    async converterMembroParaBeneficiario(cpf, dadosCidadao, justificativa, usuarioId) {
        this.logger.log(`Iniciando conversão para beneficiário: CPF ${cpf}`);
        // Validar dados do cidadão
        if (!dadosCidadao.nome) {
            this.logger.warn(`Tentativa de conversão com dados inválidos: CPF ${cpf}`);
            throw new common_1.BadRequestException('Nome do cidadão é obrigatório');
        }
        const queryRunner = this.dataSource.createQueryRunner();
        await queryRunner.connect();
        await queryRunner.startTransaction();
        this.logger.debug(`Transação iniciada para conversão: CPF ${cpf}`);
        try {
            // Remover formatação do CPF
            const cpfLimpo = cpf.replace(/\D/g, '');
            // Verificar se já existe um cidadão com este CPF
            const cidadaoExistente = await this.cidadaoRepository.findOne({
                where: { cpf: cpfLimpo },
            });
            // Se já existir um cidadão com este CPF, verificar se já é beneficiário
            if (cidadaoExistente) {
                this.logger.debug(`Cidadão existente encontrado: ID ${cidadaoExistente.id}`);
                const papelBeneficiario = await this.papelCidadaoRepository.findOne({
                    where: {
                        cidadao_id: cidadaoExistente.id,
                        tipo_papel: tipo_papel_enum_1.TipoPapel.BENEFICIARIO,
                        ativo: true,
                    },
                });
                if (papelBeneficiario) {
                    this.logger.warn(`Cidadão já é beneficiário: ID ${cidadaoExistente.id}`);
                    throw new common_1.ConflictException('Cidadão já é beneficiário');
                }
            }
            // Verificar se o membro está em alguma composição familiar
            const composicaoFamiliar = await this.composicaoFamiliarRepository.findOne({
                where: { cpf: cpfLimpo },
                relations: ['cidadao'],
            });
            if (!composicaoFamiliar) {
                this.logger.warn(`Membro não encontrado em composição familiar: CPF ${cpfLimpo}`);
                throw new common_1.BadRequestException('Membro não encontrado em nenhuma composição familiar');
            }
            this.logger.debug(`Composição familiar encontrada: ID ${composicaoFamiliar.id}`);
            let cidadao;
            let novoPapel;
            // Se o cidadão já existe, apenas adicionar o papel de beneficiário
            if (cidadaoExistente) {
                this.logger.debug(`Usando cidadão existente: ID ${cidadaoExistente.id}`);
                cidadao = cidadaoExistente;
                // Adicionar papel de beneficiário
                novoPapel = await this.papelCidadaoService.criarPapel(cidadao.id, tipo_papel_enum_1.TipoPapel.BENEFICIARIO, {});
            }
            else {
                // Criar um novo cidadão com os dados fornecidos
                this.logger.debug(`Criando novo cidadão para CPF: ${cpfLimpo}`);
                const dadosCidadaoCompletos = {
                    ...dadosCidadao,
                    cpf: cpfLimpo,
                    nome: dadosCidadao.nome || composicaoFamiliar.nome, // Usar o nome da composição se não for fornecido
                    papeis: [
                        {
                            tipo_papel: tipo_papel_enum_1.TipoPapel.BENEFICIARIO,
                            metadados: {},
                        },
                    ],
                };
                // Criar o cidadão usando o serviço de cidadão
                const cidadaoCriado = await queryRunner.manager.save(this.cidadaoRepository.create(dadosCidadaoCompletos));
                cidadao = cidadaoCriado;
                // Criar papel de beneficiário para o novo cidadão
                novoPapel = await queryRunner.manager.save(this.papelCidadaoRepository.create({
                    cidadao_id: cidadao.id,
                    tipo_papel: tipo_papel_enum_1.TipoPapel.BENEFICIARIO,
                    ativo: true,
                }));
            }
            // Soft delete da composição familiar (marcar como removido)
            this.logger.debug(`Realizando soft delete da composição familiar: ID ${composicaoFamiliar.id}`);
            await queryRunner.manager.softRemove(composicaoFamiliar);
            // Registrar histórico de conversão
            const historico = await this.historicoService.criarHistorico({
                cidadao_id: cidadao.id,
                papel_anterior: tipo_papel_enum_1.TipoPapel.MEMBRO_COMPOSICAO,
                papel_novo: tipo_papel_enum_1.TipoPapel.BENEFICIARIO,
                justificativa,
            }, usuarioId);
            await queryRunner.commitTransaction();
            return {
                sucesso: true,
                mensagem: 'Membro convertido para cidadão beneficiário com sucesso',
                historicoId: historico.id,
            };
        }
        catch (error) {
            this.logger.warn(`Erro durante a conversão para beneficiário: ${error.message}`);
            await queryRunner.rollbackTransaction();
            this.logger.debug('Transação revertida após erro');
            if (error instanceof common_1.NotFoundException ||
                error instanceof common_1.ConflictException ||
                error instanceof common_1.BadRequestException) {
                throw error;
            }
            // Registrar detalhes do erro para facilitar a depuração
            const errorDetails = {
                message: error.message,
                stack: error.stack,
                cpf,
                nome: dadosCidadao?.nome,
                timestamp: new Date().toISOString(),
            };
            this.logger.error(`Erro ao converter para beneficiário: ${JSON.stringify(errorDetails)}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao converter membro para cidadão beneficiário');
        }
        finally {
            await queryRunner.release();
        }
    }
    /**
     * Converte um cidadão beneficiário para membro de composição familiar
     * @param cpf CPF do cidadão beneficiário
     * @param cidadaoAlvoId ID do cidadão que terá o membro adicionado à sua composição familiar
     * @param dadosComposicao Dados da composição familiar
     * @param justificativa Justificativa para a conversão
     * @param usuarioId ID do usuário que está realizando a conversão
     * @returns Resultado da conversão
     * @throws BadRequestException se o cidadão não for beneficiário
     * @throws ConflictException se o cidadão já estiver em uma composição familiar
     * @throws NotFoundException se o cidadão ou o cidadão alvo não forem encontrados
     * @throws InternalServerErrorException se ocorrer um erro durante a conversão
     */
    async converterParaComposicaoFamiliar(cpf, cidadaoAlvoId, dadosComposicao, justificativa, usuarioId) {
        this.logger.log(`Iniciando conversão para composição familiar: CPF ${cpf}`);
        // Validar dados da composição familiar
        if (!dadosComposicao || !cidadaoAlvoId) {
            this.logger.warn(`Tentativa de conversão com dados inválidos: CPF ${cpf}`);
            throw new common_1.BadRequestException('Dados da composição familiar e ID do cidadão alvo são obrigatórios');
        }
        const queryRunner = this.dataSource.createQueryRunner();
        await queryRunner.connect();
        await queryRunner.startTransaction();
        this.logger.debug(`Transação iniciada para conversão: CPF ${cpf}`);
        try {
            // Remover formatação do CPF
            const cpfLimpo = cpf.replace(/\D/g, '');
            // Verificar se o cidadão existe
            const cidadao = await this.cidadaoRepository.findOne({
                where: { cpf: cpfLimpo },
            });
            if (!cidadao) {
                this.logger.warn(`Cidadão não encontrado: CPF ${cpfLimpo}`);
                throw new common_1.NotFoundException('Cidadão não encontrado');
            }
            this.logger.debug(`Cidadão encontrado: ID ${cidadao.id}`);
            // Verificar se o cidadão alvo existe
            const cidadaoAlvo = await this.cidadaoRepository.findOne({
                where: { id: cidadaoAlvoId },
            });
            if (!cidadaoAlvo) {
                this.logger.warn(`Cidadão alvo não encontrado: ID ${cidadaoAlvoId}`);
                throw new common_1.NotFoundException('Cidadão alvo não encontrado');
            }
            this.logger.debug(`Cidadão alvo encontrado: ID ${cidadaoAlvo.id}`);
            // Verificar se o cidadão é beneficiário
            const papelBeneficiario = await this.papelCidadaoRepository.findOne({
                where: {
                    cidadao_id: cidadao.id,
                    tipo_papel: tipo_papel_enum_1.TipoPapel.BENEFICIARIO,
                    ativo: true,
                },
            });
            if (!papelBeneficiario) {
                this.logger.warn(`Cidadão não é beneficiário: ID ${cidadao.id}`);
                throw new common_1.BadRequestException('Cidadão não é beneficiário');
            }
            this.logger.debug(`Papel beneficiário encontrado: ID ${papelBeneficiario.id}`);
            // Verificar se o cidadão já está em alguma composição familiar
            const composicaoExistente = await this.composicaoFamiliarRepository.findOne({
                where: { cpf: cpfLimpo },
            });
            if (composicaoExistente) {
                this.logger.warn(`Cidadão já está em uma composição familiar: ID ${composicaoExistente.id}`);
                throw new common_1.ConflictException('Cidadão já está em uma composição familiar');
            }
            this.logger.debug('Cidadão não está em nenhuma composição familiar');
            // Criar composição familiar
            this.logger.debug(`Criando nova composição familiar para o cidadão: ID ${cidadao.id}`);
            const novaComposicao = this.composicaoFamiliarRepository.create({
                ...dadosComposicao,
                cpf: cpfLimpo,
                cidadao_id: cidadaoAlvoId,
                nome: cidadao.nome, // Usar o nome do cidadão
            });
            await queryRunner.manager.save(novaComposicao);
            this.logger.debug(`Nova composição familiar criada: ID ${novaComposicao.id}`);
            // Soft delete do cidadão (marcar como removido)
            this.logger.debug(`Realizando soft delete do cidadão: ID ${cidadao.id}`);
            await queryRunner.manager.softRemove(cidadao);
            // Registrar histórico de conversão
            const historico = await this.historicoService.criarHistorico({
                cidadao_id: cidadao.id,
                papel_anterior: tipo_papel_enum_1.TipoPapel.BENEFICIARIO,
                papel_novo: tipo_papel_enum_1.TipoPapel.MEMBRO_COMPOSICAO,
                justificativa,
                composicao_familiar_id: novaComposicao.id,
            }, usuarioId);
            await queryRunner.commitTransaction();
            return {
                sucesso: true,
                mensagem: 'Cidadão convertido para membro de composição familiar com sucesso',
                historicoId: historico.id,
            };
        }
        catch (error) {
            this.logger.warn(`Erro durante a conversão para composição familiar: ${error.message}`);
            await queryRunner.rollbackTransaction();
            this.logger.debug('Transação revertida após erro');
            if (error instanceof common_1.NotFoundException ||
                error instanceof common_1.ConflictException ||
                error instanceof common_1.BadRequestException) {
                throw error;
            }
            // Registrar detalhes do erro para facilitar a depuração
            const errorDetails = {
                message: error.message,
                stack: error.stack,
                cpf,
                cidadaoAlvoId,
                timestamp: new Date().toISOString(),
            };
            this.logger.error(`Erro ao converter para composição familiar: ${JSON.stringify(errorDetails)}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao converter cidadão para membro de composição familiar');
        }
        finally {
            await queryRunner.release();
        }
    }
    /**
     * Verifica se existem conflitos entre papéis para um cidadão
     * @param cidadaoId ID do cidadão
     * @param papelIds Lista de IDs de papéis a serem verificados
     * @returns Resultado da verificação
     */
    async verificarPapeisConflitantes(cidadaoId, papelIds) {
        try {
            // Verificar se o cidadão existe
            const cidadao = await this.cidadaoRepository.findOne({
                where: { id: cidadaoId },
            });
            if (!cidadao) {
                throw new common_1.NotFoundException('Cidadão não encontrado');
            }
            // Buscar papéis atuais do cidadão
            const papeisCidadao = await this.papelCidadaoRepository.find({
                where: { cidadao_id: cidadaoId, ativo: true },
            });
            // Simular a lista de papéis que o cidadão teria
            const todosPapeis = [...papeisCidadao.map((p) => p.id), ...papelIds];
            // Verificar conflitos com base nas regras de negócio
            const regrasConflito = await this.listarRegrasConflito();
            const conflitos = [];
            // Verificar cada regra de conflito
            for (const regra of regrasConflito) {
                if (!regra.ativo) {
                    continue;
                }
                // Verificar se a regra se aplica aos papéis do cidadão
                const temPapelOrigem = todosPapeis.includes(regra.papel_origem_id);
                const temPapelDestino = todosPapeis.includes(regra.papel_destino_id);
                if (temPapelOrigem && temPapelDestino) {
                    conflitos.push({
                        papel_id: papelIds.includes(regra.papel_origem_id)
                            ? regra.papel_origem_id
                            : regra.papel_destino_id,
                        nome_papel: papelIds.includes(regra.papel_origem_id)
                            ? regra.papel_origem_nome
                            : regra.papel_destino_nome,
                        regra_conflito: regra.descricao,
                    });
                }
            }
            return {
                possui_conflito: conflitos.length > 0,
                papeis_conflitantes: conflitos,
            };
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            this.logger.error(`Erro ao verificar papéis conflitantes: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao verificar papéis conflitantes');
        }
    }
    /**
     * Verifica papéis conflitantes para um cidadão específico
     * @param cidadaoId ID do cidadão
     * @returns Resultado da verificação
     */
    async verificarPapeisConflitantesCidadao(cidadaoId) {
        try {
            // Verificar se o cidadão existe
            const cidadao = await this.cidadaoRepository.findOne({
                where: { id: cidadaoId },
            });
            if (!cidadao) {
                throw new common_1.NotFoundException('Cidadão não encontrado');
            }
            // Buscar papéis atuais do cidadão
            const papeisCidadao = await this.papelCidadaoRepository.find({
                where: { cidadao_id: cidadaoId, ativo: true },
            });
            // Verificar conflitos com base nas regras de negócio
            const regrasConflito = await this.listarRegrasConflito();
            const conflitos = [];
            // Verificar cada regra de conflito
            for (const regra of regrasConflito) {
                if (!regra.ativo) {
                    continue;
                }
                // Verificar se a regra se aplica aos papéis do cidadão
                const temPapelOrigem = papeisCidadao.some((p) => p.id === regra.papel_origem_id);
                const temPapelDestino = papeisCidadao.some((p) => p.id === regra.papel_destino_id);
                if (temPapelOrigem && temPapelDestino) {
                    conflitos.push({
                        papel_id: regra.papel_destino_id,
                        nome_papel: regra.papel_destino_nome,
                        regra_conflito: regra.descricao,
                    });
                }
            }
            return {
                possui_conflito: conflitos.length > 0,
                papeis_conflitantes: conflitos,
            };
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            this.logger.error(`Erro ao verificar papéis conflitantes do cidadão: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao verificar papéis conflitantes do cidadão');
        }
    }
    /**
     * Lista as regras de conflito entre papéis
     * @returns Lista de regras de conflito
     */
    async listarRegrasConflito() {
        try {
            // Simulação de regras de conflito - em um ambiente real, estas viriam do banco de dados
            return [
                {
                    id: '1',
                    papel_origem_id: '1',
                    papel_origem_nome: 'Beneficiário',
                    papel_destino_id: '2',
                    papel_destino_nome: 'Membro de Composição Familiar',
                    descricao: 'Um cidadão não pode ser beneficiário e membro de composição familiar ao mesmo tempo',
                    ativo: true,
                },
                {
                    id: '2',
                    papel_origem_id: '3',
                    papel_origem_nome: 'Responsável Familiar',
                    papel_destino_id: '4',
                    papel_destino_nome: 'Dependente',
                    descricao: 'Um cidadão não pode ser responsável familiar e dependente ao mesmo tempo',
                    ativo: true,
                },
                {
                    id: '3',
                    papel_origem_id: '5',
                    papel_origem_nome: 'Servidor Público',
                    papel_destino_id: '1',
                    papel_destino_nome: 'Beneficiário',
                    descricao: 'Um servidor público não pode ser beneficiário de programas sociais',
                    ativo: true,
                },
            ];
        }
        catch (error) {
            this.logger.error(`Erro ao listar regras de conflito: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao listar regras de conflito');
        }
    }
    /**
     * Verifica se há conflito entre papéis de um cidadão
     * @param cpf CPF do cidadão
     * @returns Resultado da verificação
     */
    async verificarConflitoPapeis(cpf) {
        try {
            // Buscar cidadão pelo CPF
            const cidadao = await this.cidadaoRepository.findOne({
                where: { cpf },
                relations: ['papeis'],
            });
            if (!cidadao) {
                return {
                    temConflito: false,
                    detalhes: 'Cidadão não encontrado',
                };
            }
            // Verificar papéis ativos
            const papeisAtivos = cidadao.papeis?.filter((papel) => papel.ativo) || [];
            if (papeisAtivos.length === 0) {
                return {
                    temConflito: false,
                    detalhes: 'Nenhum papel ativo encontrado',
                };
            }
            // Verificar se há conflito (exemplo: beneficiário não pode ser requerente)
            const temBeneficiario = papeisAtivos.some((papel) => papel.tipo_papel === 'beneficiario');
            const temRequerente = papeisAtivos.some((papel) => papel.tipo_papel === 'requerente');
            if (temBeneficiario && temRequerente) {
                return {
                    temConflito: true,
                    tipoPapelAtual: 'beneficiario',
                    cidadaoId: cidadao.id,
                    detalhes: 'Cidadão não pode ser beneficiário e requerente simultaneamente',
                };
            }
            return {
                temConflito: false,
                tipoPapelAtual: papeisAtivos[0]?.tipo_papel,
                cidadaoId: cidadao.id,
                detalhes: 'Nenhum conflito detectado',
            };
        }
        catch (error) {
            this.logger.error(`Erro ao verificar conflito de papéis: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao verificar conflito de papéis');
        }
    }
};
exports.VerificacaoPapelService = VerificacaoPapelService;
exports.VerificacaoPapelService = VerificacaoPapelService = VerificacaoPapelService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(cidadao_entity_1.Cidadao)),
    __param(1, (0, typeorm_1.InjectRepository)(papel_cidadao_entity_1.PapelCidadao)),
    __param(2, (0, typeorm_1.InjectRepository)(composicao_familiar_entity_1.ComposicaoFamiliar)),
    __param(4, (0, common_1.Inject)((0, common_1.forwardRef)(() => papel_cidadao_service_1.PapelCidadaoService))),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object, typeof (_d = typeof historico_conversao_papel_service_1.HistoricoConversaoPapelService !== "undefined" && historico_conversao_papel_service_1.HistoricoConversaoPapelService) === "function" ? _d : Object, typeof (_e = typeof papel_cidadao_service_1.PapelCidadaoService !== "undefined" && papel_cidadao_service_1.PapelCidadaoService) === "function" ? _e : Object, typeof (_f = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _f : Object])
], VerificacaoPapelService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGNpZGFkYW9cXHNlcnZpY2VzXFx2ZXJpZmljYWNhby1wYXBlbC5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBU3dCO0FBQ3hCLDZDQUFtRDtBQUNuRCxxQ0FBaUQ7QUFDakQscUVBQTJEO0FBQzNELGlGQUFzRTtBQUN0RSxvRUFBc0U7QUFDdEUsNkZBQWtGO0FBQ2xGLDJGQUFxRjtBQUNyRixtRUFBOEQ7QUFxRDlEOzs7OztHQUtHO0FBRUksSUFBTSx1QkFBdUIsK0JBQTdCLE1BQU0sdUJBQXVCO0lBS2Y7SUFFQTtJQUVBO0lBQ0E7SUFFQTtJQUNBO0lBWkYsTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLHlCQUF1QixDQUFDLElBQUksQ0FBQyxDQUFDO0lBRW5FLFlBRW1CLGlCQUFzQyxFQUV0QyxzQkFBZ0QsRUFFaEQsNEJBQTRELEVBQzVELGdCQUFnRCxFQUVoRCxtQkFBd0MsRUFDeEMsVUFBc0I7UUFSdEIsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFxQjtRQUV0QywyQkFBc0IsR0FBdEIsc0JBQXNCLENBQTBCO1FBRWhELGlDQUE0QixHQUE1Qiw0QkFBNEIsQ0FBZ0M7UUFDNUQscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFnQztRQUVoRCx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO1FBQ3hDLGVBQVUsR0FBVixVQUFVLENBQVk7SUFDdEMsQ0FBQztJQUVKOzs7OztPQUtHO0lBQ0gsS0FBSyxDQUFDLHlCQUF5QixDQUM3QixTQUFpQixFQUNqQixlQUF1QjtRQUV2QixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQywwQ0FBMEMsU0FBUyxFQUFFLENBQUMsQ0FBQztRQUV2RSxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsRUFBRTtZQUNuRCxn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LE1BQU0sQ0FBQyxLQUFLLENBQ2YseUNBQXlDLEtBQUssQ0FBQyxPQUFPLEVBQUUsRUFDeEQsS0FBSyxDQUFDLEtBQUssQ0FDWixDQUFDO1lBQ0YsTUFBTSxJQUFJLHFDQUE0QixDQUNwQyxzQ0FBc0MsQ0FDdkMsQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0NBQ0YsQ0FBQTtBQS90QlksMERBQXVCO2tDQUF2Qix1QkFBdUI7SUFEbkMsSUFBQSxtQkFBVSxHQUFFO0lBS1IsV0FBQSxJQUFBLDBCQUFnQixFQUFDLHdCQUFPLENBQUMsQ0FBQTtJQUV6QixXQUFBLElBQUEsMEJBQWdCLEVBQUMsbUNBQVksQ0FBQyxDQUFBO0lBRTlCLFdBQUEsSUFBQSwwQkFBZ0IsRUFBQywrQ0FBa0IsQ0FBQyxDQUFBO0lBR3BDLFdBQUEsSUFBQSxlQUFNLEVBQUMsSUFBQSxtQkFBVSxFQUFDLEdBQUcsRUFBRSxDQUFDLDJDQUFtQixDQUFDLENBQUMsQ0FBQTt5REFOVixvQkFBVSxvQkFBVixvQkFBVSxvREFFTCxvQkFBVSxvQkFBVixvQkFBVSxvREFFSixvQkFBVSxvQkFBVixvQkFBVSxvREFDdEIsa0VBQThCLG9CQUE5QixrRUFBOEIsb0RBRTNCLDJDQUFtQixvQkFBbkIsMkNBQW1CLG9EQUM1QixvQkFBVSxvQkFBVixvQkFBVTtHQWI5Qix1QkFBdUIsQ0ErdEJuQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xcY2lkYWRhb1xcc2VydmljZXNcXHZlcmlmaWNhY2FvLXBhcGVsLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgSW5qZWN0YWJsZSxcbiAgTm90Rm91bmRFeGNlcHRpb24sXG4gIENvbmZsaWN0RXhjZXB0aW9uLFxuICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxuICBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uLFxuICBMb2dnZXIsXG4gIEluamVjdCxcbiAgZm9yd2FyZFJlZixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgSW5qZWN0UmVwb3NpdG9yeSB9IGZyb20gJ0BuZXN0anMvdHlwZW9ybSc7XG5pbXBvcnQgeyBSZXBvc2l0b3J5LCBEYXRhU291cmNlIH0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQgeyBDaWRhZGFvIH0gZnJvbSAnLi4vLi4vLi4vZW50aXRpZXMvY2lkYWRhby5lbnRpdHknO1xuaW1wb3J0IHsgUGFwZWxDaWRhZGFvIH0gZnJvbSAnLi4vLi4vLi4vZW50aXRpZXMvcGFwZWwtY2lkYWRhby5lbnRpdHknO1xuaW1wb3J0IHsgVGlwb1BhcGVsLCBQYXBlclR5cGUgfSBmcm9tICcuLi8uLi8uLi9lbnVtcy90aXBvLXBhcGVsLmVudW0nO1xuaW1wb3J0IHsgQ29tcG9zaWNhb0ZhbWlsaWFyIH0gZnJvbSAnLi4vLi4vLi4vZW50aXRpZXMvY29tcG9zaWNhby1mYW1pbGlhci5lbnRpdHknO1xuaW1wb3J0IHsgSGlzdG9yaWNvQ29udmVyc2FvUGFwZWxTZXJ2aWNlIH0gZnJvbSAnLi9oaXN0b3JpY28tY29udmVyc2FvLXBhcGVsLnNlcnZpY2UnO1xuaW1wb3J0IHsgUGFwZWxDaWRhZGFvU2VydmljZSB9IGZyb20gJy4vcGFwZWwtY2lkYWRhby5zZXJ2aWNlJztcbmltcG9ydCB7IENyZWF0ZUNpZGFkYW9EdG8gfSBmcm9tICcuLi9kdG8vY3JlYXRlLWNpZGFkYW8uZHRvJztcblxuLyoqXG4gKiBJbnRlcmZhY2UgcGFyYSBvIHJlc3VsdGFkbyBkYSB2ZXJpZmljYcOnw6NvIGRlIGNvbmZsaXRvIGRlIHBhcMOpaXNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBSZXN1bHRhZG9WZXJpZmljYWNhb0NvbmZsaXRvIHtcbiAgdGVtQ29uZmxpdG86IGJvb2xlYW47XG4gIHRpcG9QYXBlbEF0dWFsPzogUGFwZXJUeXBlO1xuICBjb21wb3NpY2FvRmFtaWxpYXJJZD86IHN0cmluZztcbiAgY2lkYWRhb0lkPzogc3RyaW5nO1xuICBkZXRhbGhlcz86IHN0cmluZztcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgcGFyYSBvIHJlc3VsdGFkbyBkYSBjb252ZXJzw6NvIGRlIHBhcGVsXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUmVzdWx0YWRvQ29udmVyc2FvUGFwZWwge1xuICBzdWNlc3NvOiBib29sZWFuO1xuICBtZW5zYWdlbTogc3RyaW5nO1xuICBoaXN0b3JpY29JZD86IHN0cmluZztcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgcGFyYSBwYXBlbCBjb25mbGl0YW50ZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFBhcGVsQ29uZmxpdGFudGUge1xuICBwYXBlbF9pZDogc3RyaW5nO1xuICBub21lX3BhcGVsOiBzdHJpbmc7XG4gIHJlZ3JhX2NvbmZsaXRvOiBzdHJpbmc7XG59XG5cbi8qKlxuICogSW50ZXJmYWNlIHBhcmEgcmVzdWx0YWRvIGRlIHZlcmlmaWNhw6fDo28gZGUgY29uZmxpdG9zXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUmVzdWx0YWRvVmVyaWZpY2FjYW9Db25mbGl0b3Mge1xuICBwb3NzdWlfY29uZmxpdG86IGJvb2xlYW47XG4gIHBhcGVpc19jb25mbGl0YW50ZXM6IFBhcGVsQ29uZmxpdGFudGVbXTtcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgcGFyYSByZWdyYSBkZSBjb25mbGl0b1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFJlZ3JhQ29uZmxpdG8ge1xuICBpZDogc3RyaW5nO1xuICBwYXBlbF9vcmlnZW1faWQ6IHN0cmluZztcbiAgcGFwZWxfb3JpZ2VtX25vbWU6IHN0cmluZztcbiAgcGFwZWxfZGVzdGlub19pZDogc3RyaW5nO1xuICBwYXBlbF9kZXN0aW5vX25vbWU6IHN0cmluZztcbiAgZGVzY3JpY2FvOiBzdHJpbmc7XG4gIGF0aXZvOiBib29sZWFuO1xufVxuXG4vKipcbiAqIFNlcnZpw6dvIGRlIFZlcmlmaWNhw6fDo28gZGUgUGFwZWxcbiAqXG4gKiBSZXNwb25zw6F2ZWwgcG9yIHZlcmlmaWNhciBjb25mbGl0b3MgZGUgcGFww6lpcyBlIHJlYWxpemFyIGNvbnZlcnPDtWVzXG4gKiBkZSBwYXDDqWlzIGRlIGNpZGFkw6NvcyBubyBzaXN0ZW1hLlxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgVmVyaWZpY2FjYW9QYXBlbFNlcnZpY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IGxvZ2dlciA9IG5ldyBMb2dnZXIoVmVyaWZpY2FjYW9QYXBlbFNlcnZpY2UubmFtZSk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdFJlcG9zaXRvcnkoQ2lkYWRhbylcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNpZGFkYW9SZXBvc2l0b3J5OiBSZXBvc2l0b3J5PENpZGFkYW8+LFxuICAgIEBJbmplY3RSZXBvc2l0b3J5KFBhcGVsQ2lkYWRhbylcbiAgICBwcml2YXRlIHJlYWRvbmx5IHBhcGVsQ2lkYWRhb1JlcG9zaXRvcnk6IFJlcG9zaXRvcnk8UGFwZWxDaWRhZGFvPixcbiAgICBASW5qZWN0UmVwb3NpdG9yeShDb21wb3NpY2FvRmFtaWxpYXIpXG4gICAgcHJpdmF0ZSByZWFkb25seSBjb21wb3NpY2FvRmFtaWxpYXJSZXBvc2l0b3J5OiBSZXBvc2l0b3J5PENvbXBvc2ljYW9GYW1pbGlhcj4sXG4gICAgcHJpdmF0ZSByZWFkb25seSBoaXN0b3JpY29TZXJ2aWNlOiBIaXN0b3JpY29Db252ZXJzYW9QYXBlbFNlcnZpY2UsXG4gICAgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IFBhcGVsQ2lkYWRhb1NlcnZpY2UpKVxuICAgIHByaXZhdGUgcmVhZG9ubHkgcGFwZWxDaWRhZGFvU2VydmljZTogUGFwZWxDaWRhZGFvU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGRhdGFTb3VyY2U6IERhdGFTb3VyY2UsXG4gICkge31cblxuICAvKipcbiAgICogQ29udmVydGUgdW0gY2lkYWTDo28gcGFyYSBiZW5lZmljacOhcmlvXG4gICAqIEBwYXJhbSBjaWRhZGFvSWQgSUQgZG8gY2lkYWTDo29cbiAgICogQHBhcmFtIG1vdGl2b0NvbnZlcnNhbyBNb3Rpdm8gZGEgY29udmVyc8Ojb1xuICAgKiBAcmV0dXJucyBSZXN1bHRhZG8gZGEgY29udmVyc8Ojb1xuICAgKi9cbiAgYXN5bmMgY29udmVydGVyUGFyYUJlbmVmaWNpYXJpbyhcbiAgICBjaWRhZGFvSWQ6IHN0cmluZyxcbiAgICBtb3Rpdm9Db252ZXJzYW86IHN0cmluZyxcbiAgKTogUHJvbWlzZTxSZXN1bHRhZG9Db252ZXJzYW9QYXBlbD4ge1xuICAgIHRoaXMubG9nZ2VyLmxvZyhgSW5pY2lhbmRvIGNvbnZlcnPDo28gcGFyYSBiZW5lZmljacOhcmlvOiAke2NpZGFkYW9JZH1gKTtcblxuICAgIHJldHVybiB0aGlzLmRhdGFTb3VyY2UudHJhbnNhY3Rpb24oYXN5bmMgKG1hbmFnZXIpID0+IHtcbiAgICAgIC8vIFZlcmlmaWNhciBzZSBvIGNpZGFkw6NvIGV4aXN0ZVxuICAgICAgY29uc3QgY2lkYWRhbyA9IGF3YWl0IG1hbmFnZXIuZmluZE9uZShDaWRhZGFvLCB7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBjaWRhZGFvSWQgfSxcbiAgICAgICAgcmVsYXRpb25zOiBbJ3BhcGVpcyddLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghY2lkYWRhbykge1xuICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ0NpZGFkw6NvIG7Do28gZW5jb250cmFkbycpO1xuICAgICAgfVxuXG4gICAgICAvLyBWZXJpZmljYXIgc2UgasOhIMOpIGJlbmVmaWNpw6FyaW9cbiAgICAgIGNvbnN0IGphQmVuZWZpY2lhcmlvID0gY2lkYWRhby5wYXBlaXM/LnNvbWUoXG4gICAgICAgIChwYXBlbCkgPT4gcGFwZWwudGlwb19wYXBlbCA9PT0gJ2JlbmVmaWNpYXJpbycgJiYgcGFwZWwuYXRpdm8sXG4gICAgICApO1xuXG4gICAgICBpZiAoamFCZW5lZmljaWFyaW8pIHtcbiAgICAgICAgdGhyb3cgbmV3IENvbmZsaWN0RXhjZXB0aW9uKCdDaWRhZMOjbyBqw6Egw6kgYmVuZWZpY2nDoXJpbycpO1xuICAgICAgfVxuXG4gICAgICAvLyBWZXJpZmljYXIgY29uZmxpdG9zXG4gICAgICBjb25zdCBjb25mbGl0b3MgPSBhd2FpdCB0aGlzLnZlcmlmaWNhckNvbmZsaXRvUGFwZWlzKGNpZGFkYW8uY3BmKTtcblxuICAgICAgaWYgKGNvbmZsaXRvcy50ZW1Db25mbGl0bykge1xuICAgICAgICAvLyBSZWdpc3RyYXIgaGlzdMOzcmljbyBkZSB0ZW50YXRpdmEgZGUgY29udmVyc8Ojb1xuICAgICAgICBhd2FpdCB0aGlzLmhpc3Rvcmljb1NlcnZpY2UuY3JpYXJIaXN0b3JpY28oXG4gICAgICAgICAge1xuICAgICAgICAgICAgY2lkYWRhb19pZDogY2lkYWRhb0lkLFxuICAgICAgICAgICAgcGFwZWxfYW50ZXJpb3I6IGNvbmZsaXRvcy50aXBvUGFwZWxBdHVhbCB8fCAnbWVtYnJvX2NvbXBvc2ljYW8nLFxuICAgICAgICAgICAgcGFwZWxfbm92bzogJ2JlbmVmaWNpYXJpbycsXG4gICAgICAgICAgICBqdXN0aWZpY2F0aXZhOiBgQ29udmVyc8OjbyBibG9xdWVhZGE6ICR7Y29uZmxpdG9zLmRldGFsaGVzfWAsXG4gICAgICAgICAgfSxcbiAgICAgICAgICAnc2lzdGVtYScsXG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNlc3NvOiBmYWxzZSxcbiAgICAgICAgICBtZW5zYWdlbTogY29uZmxpdG9zLmRldGFsaGVzIHx8ICdDb25mbGl0byBkZSBwYXBlbCBkZXRlY3RhZG8nLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBEZXNhdGl2YXIgcGFww6lpcyBjb25mbGl0YW50ZXMgc2UgbmVjZXNzw6FyaW9cbiAgICAgIGNvbnN0IHBhcGVpc0F0aXZvcyA9IGNpZGFkYW8ucGFwZWlzPy5maWx0ZXIoKHBhcGVsKSA9PiBwYXBlbC5hdGl2bykgfHwgW107XG4gICAgICBmb3IgKGNvbnN0IHBhcGVsIG9mIHBhcGVpc0F0aXZvcykge1xuICAgICAgICBpZiAocGFwZWwudGlwb19wYXBlbCA9PT0gJ21lbWJyb19jb21wb3NpY2FvJykge1xuICAgICAgICAgIHBhcGVsLmF0aXZvID0gZmFsc2U7XG4gICAgICAgICAgYXdhaXQgbWFuYWdlci5zYXZlKHBhcGVsKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDcmlhciBwYXBlbCBkZSBiZW5lZmljacOhcmlvXG4gICAgICBjb25zdCBub3ZvUGFwZWwgPSBtYW5hZ2VyLmNyZWF0ZShQYXBlbENpZGFkYW8sIHtcbiAgICAgICAgY2lkYWRhb19pZDogY2lkYWRhb0lkLFxuICAgICAgICB0aXBvX3BhcGVsOiAnYmVuZWZpY2lhcmlvJyxcbiAgICAgICAgYXRpdm86IHRydWUsXG4gICAgICAgIG1ldGFkYWRvczoge30sXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgbWFuYWdlci5zYXZlKG5vdm9QYXBlbCk7XG5cbiAgICAgIC8vIFJlZ2lzdHJhciBubyBoaXN0w7NyaWNvXG4gICAgICBjb25zdCBoaXN0b3JpY28gPSBhd2FpdCB0aGlzLmhpc3Rvcmljb1NlcnZpY2UuY3JpYXJIaXN0b3JpY28oXG4gICAgICAgIHtcbiAgICAgICAgICBjaWRhZGFvX2lkOiBjaWRhZGFvSWQsXG4gICAgICAgICAgcGFwZWxfYW50ZXJpb3I6IGNvbmZsaXRvcy50aXBvUGFwZWxBdHVhbCB8fCAnbWVtYnJvX2NvbXBvc2ljYW8nLFxuICAgICAgICAgIHBhcGVsX25vdm86ICdiZW5lZmljaWFyaW8nLFxuICAgICAgICAgIGp1c3RpZmljYXRpdmE6IG1vdGl2b0NvbnZlcnNhbyxcbiAgICAgICAgfSxcbiAgICAgICAgJ3Npc3RlbWEnLFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjZXNzbzogdHJ1ZSxcbiAgICAgICAgbWVuc2FnZW06ICdDb252ZXJzw6NvIHBhcmEgYmVuZWZpY2nDoXJpbyByZWFsaXphZGEgY29tIHN1Y2Vzc28nLFxuICAgICAgICBoaXN0b3JpY29JZDogaGlzdG9yaWNvLmlkLFxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZXJ0ZSB1bSBtZW1icm8gZGUgY29tcG9zacOnw6NvIGZhbWlsaWFyIHBhcmEgY2lkYWTDo28gYmVuZWZpY2nDoXJpb1xuICAgKiBAcGFyYW0gY3BmIENQRiBkbyBtZW1icm8gZGUgY29tcG9zacOnw6NvIGZhbWlsaWFyXG4gICAqIEBwYXJhbSBkYWRvc0NpZGFkYW8gRGFkb3MgcGFyYSBjcmlhw6fDo28gZG8gbm92byBjaWRhZMOjb1xuICAgKiBAcGFyYW0ganVzdGlmaWNhdGl2YSBKdXN0aWZpY2F0aXZhIHBhcmEgYSBjb252ZXJzw6NvXG4gICAqIEBwYXJhbSB1c3VhcmlvSWQgSUQgZG8gdXN1w6FyaW8gcXVlIGVzdMOhIHJlYWxpemFuZG8gYSBjb252ZXJzw6NvXG4gICAqIEByZXR1cm5zIFJlc3VsdGFkbyBkYSBjb252ZXJzw6NvXG4gICAqIEB0aHJvd3MgQmFkUmVxdWVzdEV4Y2VwdGlvbiBzZSBvcyBkYWRvcyBkbyBjaWRhZMOjbyBmb3JlbSBpbnbDoWxpZG9zXG4gICAqIEB0aHJvd3MgQ29uZmxpY3RFeGNlcHRpb24gc2UgbyBjaWRhZMOjbyBqw6EgZm9yIGJlbmVmaWNpw6FyaW9cbiAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBzZSBvIG1lbWJybyBuw6NvIGZvciBlbmNvbnRyYWRvXG4gICAqIEB0aHJvd3MgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbiBzZSBvY29ycmVyIHVtIGVycm8gZHVyYW50ZSBhIGNvbnZlcnPDo29cbiAgICovXG4gIGFzeW5jIGNvbnZlcnRlck1lbWJyb1BhcmFCZW5lZmljaWFyaW8oXG4gICAgY3BmOiBzdHJpbmcsXG4gICAgZGFkb3NDaWRhZGFvOiBDcmVhdGVDaWRhZGFvRHRvLFxuICAgIGp1c3RpZmljYXRpdmE6IHN0cmluZyxcbiAgICB1c3VhcmlvSWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxSZXN1bHRhZG9Db252ZXJzYW9QYXBlbD4ge1xuICAgIHRoaXMubG9nZ2VyLmxvZyhgSW5pY2lhbmRvIGNvbnZlcnPDo28gcGFyYSBiZW5lZmljacOhcmlvOiBDUEYgJHtjcGZ9YCk7XG5cbiAgICAvLyBWYWxpZGFyIGRhZG9zIGRvIGNpZGFkw6NvXG4gICAgaWYgKCFkYWRvc0NpZGFkYW8ubm9tZSkge1xuICAgICAgdGhpcy5sb2dnZXIud2FybihcbiAgICAgICAgYFRlbnRhdGl2YSBkZSBjb252ZXJzw6NvIGNvbSBkYWRvcyBpbnbDoWxpZG9zOiBDUEYgJHtjcGZ9YCxcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignTm9tZSBkbyBjaWRhZMOjbyDDqSBvYnJpZ2F0w7NyaW8nKTtcbiAgICB9XG5cbiAgICBjb25zdCBxdWVyeVJ1bm5lciA9IHRoaXMuZGF0YVNvdXJjZS5jcmVhdGVRdWVyeVJ1bm5lcigpO1xuICAgIGF3YWl0IHF1ZXJ5UnVubmVyLmNvbm5lY3QoKTtcbiAgICBhd2FpdCBxdWVyeVJ1bm5lci5zdGFydFRyYW5zYWN0aW9uKCk7XG5cbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgVHJhbnNhw6fDo28gaW5pY2lhZGEgcGFyYSBjb252ZXJzw6NvOiBDUEYgJHtjcGZ9YCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gUmVtb3ZlciBmb3JtYXRhw6fDo28gZG8gQ1BGXG4gICAgICBjb25zdCBjcGZMaW1wbyA9IGNwZi5yZXBsYWNlKC9cXEQvZywgJycpO1xuXG4gICAgICAvLyBWZXJpZmljYXIgc2UgasOhIGV4aXN0ZSB1bSBjaWRhZMOjbyBjb20gZXN0ZSBDUEZcbiAgICAgIGNvbnN0IGNpZGFkYW9FeGlzdGVudGUgPSBhd2FpdCB0aGlzLmNpZGFkYW9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZTogeyBjcGY6IGNwZkxpbXBvIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gU2UgasOhIGV4aXN0aXIgdW0gY2lkYWTDo28gY29tIGVzdGUgQ1BGLCB2ZXJpZmljYXIgc2UgasOhIMOpIGJlbmVmaWNpw6FyaW9cbiAgICAgIGlmIChjaWRhZGFvRXhpc3RlbnRlKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKFxuICAgICAgICAgIGBDaWRhZMOjbyBleGlzdGVudGUgZW5jb250cmFkbzogSUQgJHtjaWRhZGFvRXhpc3RlbnRlLmlkfWAsXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHBhcGVsQmVuZWZpY2lhcmlvID0gYXdhaXQgdGhpcy5wYXBlbENpZGFkYW9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICBjaWRhZGFvX2lkOiBjaWRhZGFvRXhpc3RlbnRlLmlkLFxuICAgICAgICAgICAgdGlwb19wYXBlbDogVGlwb1BhcGVsLkJFTkVGSUNJQVJJTyxcbiAgICAgICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChwYXBlbEJlbmVmaWNpYXJpbykge1xuICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgICAgICBgQ2lkYWTDo28gasOhIMOpIGJlbmVmaWNpw6FyaW86IElEICR7Y2lkYWRhb0V4aXN0ZW50ZS5pZH1gLFxuICAgICAgICAgICk7XG4gICAgICAgICAgdGhyb3cgbmV3IENvbmZsaWN0RXhjZXB0aW9uKCdDaWRhZMOjbyBqw6Egw6kgYmVuZWZpY2nDoXJpbycpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFZlcmlmaWNhciBzZSBvIG1lbWJybyBlc3TDoSBlbSBhbGd1bWEgY29tcG9zacOnw6NvIGZhbWlsaWFyXG4gICAgICBjb25zdCBjb21wb3NpY2FvRmFtaWxpYXIgPVxuICAgICAgICBhd2FpdCB0aGlzLmNvbXBvc2ljYW9GYW1pbGlhclJlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICAgICAgd2hlcmU6IHsgY3BmOiBjcGZMaW1wbyB9LFxuICAgICAgICAgIHJlbGF0aW9uczogWydjaWRhZGFvJ10sXG4gICAgICAgIH0pO1xuXG4gICAgICBpZiAoIWNvbXBvc2ljYW9GYW1pbGlhcikge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgICAgIGBNZW1icm8gbsOjbyBlbmNvbnRyYWRvIGVtIGNvbXBvc2nDp8OjbyBmYW1pbGlhcjogQ1BGICR7Y3BmTGltcG99YCxcbiAgICAgICAgKTtcbiAgICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oXG4gICAgICAgICAgJ01lbWJybyBuw6NvIGVuY29udHJhZG8gZW0gbmVuaHVtYSBjb21wb3Npw6fDo28gZmFtaWxpYXInLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgYENvbXBvc2nDp8OjbyBmYW1pbGlhciBlbmNvbnRyYWRhOiBJRCAke2NvbXBvc2ljYW9GYW1pbGlhci5pZH1gLFxuICAgICAgKTtcblxuICAgICAgbGV0IGNpZGFkYW87XG4gICAgICBsZXQgbm92b1BhcGVsO1xuXG4gICAgICAvLyBTZSBvIGNpZGFkw6NvIGrDoSBleGlzdGUsIGFwZW5hcyBhZGljaW9uYXIgbyBwYXBlbCBkZSBiZW5lZmljacOhcmlvXG4gICAgICBpZiAoY2lkYWRhb0V4aXN0ZW50ZSkge1xuICAgICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgICBgVXNhbmRvIGNpZGFkw6NvIGV4aXN0ZW50ZTogSUQgJHtjaWRhZGFvRXhpc3RlbnRlLmlkfWAsXG4gICAgICAgICk7XG4gICAgICAgIGNpZGFkYW8gPSBjaWRhZGFvRXhpc3RlbnRlO1xuXG4gICAgICAgIC8vIEFkaWNpb25hciBwYXBlbCBkZSBiZW5lZmljacOhcmlvXG4gICAgICAgIG5vdm9QYXBlbCA9IGF3YWl0IHRoaXMucGFwZWxDaWRhZGFvU2VydmljZS5jcmlhclBhcGVsKFxuICAgICAgICAgIGNpZGFkYW8uaWQsXG4gICAgICAgICAgVGlwb1BhcGVsLkJFTkVGSUNJQVJJTyxcbiAgICAgICAgICB7fSxcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIENyaWFyIHVtIG5vdm8gY2lkYWTDo28gY29tIG9zIGRhZG9zIGZvcm5lY2lkb3NcbiAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoYENyaWFuZG8gbm92byBjaWRhZMOjbyBwYXJhIENQRjogJHtjcGZMaW1wb31gKTtcbiAgICAgICAgY29uc3QgZGFkb3NDaWRhZGFvQ29tcGxldG9zID0ge1xuICAgICAgICAgIC4uLmRhZG9zQ2lkYWRhbyxcbiAgICAgICAgICBjcGY6IGNwZkxpbXBvLFxuICAgICAgICAgIG5vbWU6IGRhZG9zQ2lkYWRhby5ub21lIHx8IGNvbXBvc2ljYW9GYW1pbGlhci5ub21lLCAvLyBVc2FyIG8gbm9tZSBkYSBjb21wb3Npw6fDo28gc2UgbsOjbyBmb3IgZm9ybmVjaWRvXG4gICAgICAgICAgcGFwZWlzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHRpcG9fcGFwZWw6IFRpcG9QYXBlbC5CRU5FRklDSUFSSU8sXG4gICAgICAgICAgICAgIG1ldGFkYWRvczoge30sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQ3JpYXIgbyBjaWRhZMOjbyB1c2FuZG8gbyBzZXJ2acOnbyBkZSBjaWRhZMOjb1xuICAgICAgICBjb25zdCBjaWRhZGFvQ3JpYWRvID0gYXdhaXQgcXVlcnlSdW5uZXIubWFuYWdlci5zYXZlKFxuICAgICAgICAgIHRoaXMuY2lkYWRhb1JlcG9zaXRvcnkuY3JlYXRlKGRhZG9zQ2lkYWRhb0NvbXBsZXRvcyksXG4gICAgICAgICk7XG5cbiAgICAgICAgY2lkYWRhbyA9IGNpZGFkYW9DcmlhZG87XG5cbiAgICAgICAgLy8gQ3JpYXIgcGFwZWwgZGUgYmVuZWZpY2nDoXJpbyBwYXJhIG8gbm92byBjaWRhZMOjb1xuICAgICAgICBub3ZvUGFwZWwgPSBhd2FpdCBxdWVyeVJ1bm5lci5tYW5hZ2VyLnNhdmUoXG4gICAgICAgICAgdGhpcy5wYXBlbENpZGFkYW9SZXBvc2l0b3J5LmNyZWF0ZSh7XG4gICAgICAgICAgICBjaWRhZGFvX2lkOiBjaWRhZGFvLmlkLFxuICAgICAgICAgICAgdGlwb19wYXBlbDogVGlwb1BhcGVsLkJFTkVGSUNJQVJJTyxcbiAgICAgICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICAgIH0pLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBTb2Z0IGRlbGV0ZSBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXIgKG1hcmNhciBjb21vIHJlbW92aWRvKVxuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoXG4gICAgICAgIGBSZWFsaXphbmRvIHNvZnQgZGVsZXRlIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhcjogSUQgJHtjb21wb3NpY2FvRmFtaWxpYXIuaWR9YCxcbiAgICAgICk7XG4gICAgICBhd2FpdCBxdWVyeVJ1bm5lci5tYW5hZ2VyLnNvZnRSZW1vdmUoY29tcG9zaWNhb0ZhbWlsaWFyKTtcblxuICAgICAgLy8gUmVnaXN0cmFyIGhpc3TDs3JpY28gZGUgY29udmVyc8Ojb1xuICAgICAgY29uc3QgaGlzdG9yaWNvID0gYXdhaXQgdGhpcy5oaXN0b3JpY29TZXJ2aWNlLmNyaWFySGlzdG9yaWNvKFxuICAgICAgICB7XG4gICAgICAgICAgY2lkYWRhb19pZDogY2lkYWRhby5pZCxcbiAgICAgICAgICBwYXBlbF9hbnRlcmlvcjogVGlwb1BhcGVsLk1FTUJST19DT01QT1NJQ0FPLFxuICAgICAgICAgIHBhcGVsX25vdm86IFRpcG9QYXBlbC5CRU5FRklDSUFSSU8sXG4gICAgICAgICAganVzdGlmaWNhdGl2YSxcbiAgICAgICAgfSxcbiAgICAgICAgdXN1YXJpb0lkLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgcXVlcnlSdW5uZXIuY29tbWl0VHJhbnNhY3Rpb24oKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjZXNzbzogdHJ1ZSxcbiAgICAgICAgbWVuc2FnZW06ICdNZW1icm8gY29udmVydGlkbyBwYXJhIGNpZGFkw6NvIGJlbmVmaWNpw6FyaW8gY29tIHN1Y2Vzc28nLFxuICAgICAgICBoaXN0b3JpY29JZDogaGlzdG9yaWNvLmlkLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIud2FybihcbiAgICAgICAgYEVycm8gZHVyYW50ZSBhIGNvbnZlcnPDo28gcGFyYSBiZW5lZmljacOhcmlvOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICk7XG4gICAgICBhd2FpdCBxdWVyeVJ1bm5lci5yb2xsYmFja1RyYW5zYWN0aW9uKCk7XG4gICAgICB0aGlzLmxvZ2dlci5kZWJ1ZygnVHJhbnNhw6fDo28gcmV2ZXJ0aWRhIGFww7NzIGVycm8nKTtcblxuICAgICAgaWYgKFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIE5vdEZvdW5kRXhjZXB0aW9uIHx8XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgQ29uZmxpY3RFeGNlcHRpb24gfHxcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBCYWRSZXF1ZXN0RXhjZXB0aW9uXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlZ2lzdHJhciBkZXRhbGhlcyBkbyBlcnJvIHBhcmEgZmFjaWxpdGFyIGEgZGVwdXJhw6fDo29cbiAgICAgIGNvbnN0IGVycm9yRGV0YWlscyA9IHtcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgc3RhY2s6IGVycm9yLnN0YWNrLFxuICAgICAgICBjcGYsXG4gICAgICAgIG5vbWU6IGRhZG9zQ2lkYWRhbz8ubm9tZSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9O1xuXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gY29udmVydGVyIHBhcmEgYmVuZWZpY2nDoXJpbzogJHtKU09OLnN0cmluZ2lmeShlcnJvckRldGFpbHMpfWAsXG4gICAgICAgIGVycm9yLnN0YWNrLFxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICAnRXJybyBhbyBjb252ZXJ0ZXIgbWVtYnJvIHBhcmEgY2lkYWTDo28gYmVuZWZpY2nDoXJpbycsXG4gICAgICApO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBhd2FpdCBxdWVyeVJ1bm5lci5yZWxlYXNlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnRlIHVtIGNpZGFkw6NvIGJlbmVmaWNpw6FyaW8gcGFyYSBtZW1icm8gZGUgY29tcG9zacOnw6NvIGZhbWlsaWFyXG4gICAqIEBwYXJhbSBjcGYgQ1BGIGRvIGNpZGFkw6NvIGJlbmVmaWNpw6FyaW9cbiAgICogQHBhcmFtIGNpZGFkYW9BbHZvSWQgSUQgZG8gY2lkYWTDo28gcXVlIHRlcsOhIG8gbWVtYnJvIGFkaWNpb25hZG8gw6Agc3VhIGNvbXBvc2nDp8OjbyBmYW1pbGlhclxuICAgKiBAcGFyYW0gZGFkb3NDb21wb3NpY2FvIERhZG9zIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhclxuICAgKiBAcGFyYW0ganVzdGlmaWNhdGl2YSBKdXN0aWZpY2F0aXZhIHBhcmEgYSBjb252ZXJzw6NvXG4gICAqIEBwYXJhbSB1c3VhcmlvSWQgSUQgZG8gdXN1w6FyaW8gcXVlIGVzdMOhIHJlYWxpemFuZG8gYSBjb252ZXJzw6NvXG4gICAqIEByZXR1cm5zIFJlc3VsdGFkbyBkYSBjb252ZXJzw6NvXG4gICAqIEB0aHJvd3MgQmFkUmVxdWVzdEV4Y2VwdGlvbiBzZSBvIGNpZGFkw6NvIG7Do28gZm9yIGJlbmVmaWNpw6FyaW9cbiAgICogQHRocm93cyBDb25mbGljdEV4Y2VwdGlvbiBzZSBvIGNpZGFkw6NvIGrDoSBlc3RpdmVyIGVtIHVtYSBjb21wb3Npw6fDo28gZmFtaWxpYXJcbiAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBzZSBvIGNpZGFkw6NvIG91IG8gY2lkYWTDo28gYWx2byBuw6NvIGZvcmVtIGVuY29udHJhZG9zXG4gICAqIEB0aHJvd3MgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbiBzZSBvY29ycmVyIHVtIGVycm8gZHVyYW50ZSBhIGNvbnZlcnPDo29cbiAgICovXG4gIGFzeW5jIGNvbnZlcnRlclBhcmFDb21wb3NpY2FvRmFtaWxpYXIoXG4gICAgY3BmOiBzdHJpbmcsXG4gICAgY2lkYWRhb0Fsdm9JZDogc3RyaW5nLFxuICAgIGRhZG9zQ29tcG9zaWNhbzogUGFydGlhbDxDb21wb3NpY2FvRmFtaWxpYXI+LFxuICAgIGp1c3RpZmljYXRpdmE6IHN0cmluZyxcbiAgICB1c3VhcmlvSWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxSZXN1bHRhZG9Db252ZXJzYW9QYXBlbD4ge1xuICAgIHRoaXMubG9nZ2VyLmxvZyhgSW5pY2lhbmRvIGNvbnZlcnPDo28gcGFyYSBjb21wb3Npw6fDo28gZmFtaWxpYXI6IENQRiAke2NwZn1gKTtcblxuICAgIC8vIFZhbGlkYXIgZGFkb3MgZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyXG4gICAgaWYgKCFkYWRvc0NvbXBvc2ljYW8gfHwgIWNpZGFkYW9BbHZvSWQpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgIGBUZW50YXRpdmEgZGUgY29udmVyc8OjbyBjb20gZGFkb3MgaW52w6FsaWRvczogQ1BGICR7Y3BmfWAsXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oXG4gICAgICAgICdEYWRvcyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXIgZSBJRCBkbyBjaWRhZMOjbyBhbHZvIHPDo28gb2JyaWdhdMOzcmlvcycsXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHF1ZXJ5UnVubmVyID0gdGhpcy5kYXRhU291cmNlLmNyZWF0ZVF1ZXJ5UnVubmVyKCk7XG4gICAgYXdhaXQgcXVlcnlSdW5uZXIuY29ubmVjdCgpO1xuICAgIGF3YWl0IHF1ZXJ5UnVubmVyLnN0YXJ0VHJhbnNhY3Rpb24oKTtcblxuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBUcmFuc2HDp8OjbyBpbmljaWFkYSBwYXJhIGNvbnZlcnPDo286IENQRiAke2NwZn1gKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBSZW1vdmVyIGZvcm1hdGHDp8OjbyBkbyBDUEZcbiAgICAgIGNvbnN0IGNwZkxpbXBvID0gY3BmLnJlcGxhY2UoL1xcRC9nLCAnJyk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciBzZSBvIGNpZGFkw6NvIGV4aXN0ZVxuICAgICAgY29uc3QgY2lkYWRhbyA9IGF3YWl0IHRoaXMuY2lkYWRhb1JlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICAgIHdoZXJlOiB7IGNwZjogY3BmTGltcG8gfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWNpZGFkYW8pIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybihgQ2lkYWTDo28gbsOjbyBlbmNvbnRyYWRvOiBDUEYgJHtjcGZMaW1wb31gKTtcbiAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdDaWRhZMOjbyBuw6NvIGVuY29udHJhZG8nKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoYENpZGFkw6NvIGVuY29udHJhZG86IElEICR7Y2lkYWRhby5pZH1gKTtcblxuICAgICAgLy8gVmVyaWZpY2FyIHNlIG8gY2lkYWTDo28gYWx2byBleGlzdGVcbiAgICAgIGNvbnN0IGNpZGFkYW9BbHZvID0gYXdhaXQgdGhpcy5jaWRhZGFvUmVwb3NpdG9yeS5maW5kT25lKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNpZGFkYW9BbHZvSWQgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWNpZGFkYW9BbHZvKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLndhcm4oYENpZGFkw6NvIGFsdm8gbsOjbyBlbmNvbnRyYWRvOiBJRCAke2NpZGFkYW9BbHZvSWR9YCk7XG4gICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignQ2lkYWTDo28gYWx2byBuw6NvIGVuY29udHJhZG8nKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoYENpZGFkw6NvIGFsdm8gZW5jb250cmFkbzogSUQgJHtjaWRhZGFvQWx2by5pZH1gKTtcblxuICAgICAgLy8gVmVyaWZpY2FyIHNlIG8gY2lkYWTDo28gw6kgYmVuZWZpY2nDoXJpb1xuICAgICAgY29uc3QgcGFwZWxCZW5lZmljaWFyaW8gPSBhd2FpdCB0aGlzLnBhcGVsQ2lkYWRhb1JlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgY2lkYWRhb19pZDogY2lkYWRhby5pZCxcbiAgICAgICAgICB0aXBvX3BhcGVsOiBUaXBvUGFwZWwuQkVORUZJQ0lBUklPLFxuICAgICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcGFwZWxCZW5lZmljaWFyaW8pIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybihgQ2lkYWTDo28gbsOjbyDDqSBiZW5lZmljacOhcmlvOiBJRCAke2NpZGFkYW8uaWR9YCk7XG4gICAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKCdDaWRhZMOjbyBuw6NvIMOpIGJlbmVmaWNpw6FyaW8nKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoXG4gICAgICAgIGBQYXBlbCBiZW5lZmljacOhcmlvIGVuY29udHJhZG86IElEICR7cGFwZWxCZW5lZmljaWFyaW8uaWR9YCxcbiAgICAgICk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciBzZSBvIGNpZGFkw6NvIGrDoSBlc3TDoSBlbSBhbGd1bWEgY29tcG9zacOnw6NvIGZhbWlsaWFyXG4gICAgICBjb25zdCBjb21wb3NpY2FvRXhpc3RlbnRlID1cbiAgICAgICAgYXdhaXQgdGhpcy5jb21wb3NpY2FvRmFtaWxpYXJSZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICAgIHdoZXJlOiB7IGNwZjogY3BmTGltcG8gfSxcbiAgICAgICAgfSk7XG5cbiAgICAgIGlmIChjb21wb3NpY2FvRXhpc3RlbnRlKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgICAgYENpZGFkw6NvIGrDoSBlc3TDoSBlbSB1bWEgY29tcG9zacOnw6NvIGZhbWlsaWFyOiBJRCAke2NvbXBvc2ljYW9FeGlzdGVudGUuaWR9YCxcbiAgICAgICAgKTtcbiAgICAgICAgdGhyb3cgbmV3IENvbmZsaWN0RXhjZXB0aW9uKFxuICAgICAgICAgICdDaWRhZMOjbyBqw6EgZXN0w6EgZW0gdW1hIGNvbXBvc2nDp8OjbyBmYW1pbGlhcicsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKCdDaWRhZMOjbyBuw6NvIGVzdMOhIGVtIG5lbmh1bWEgY29tcG9zacOnw6NvIGZhbWlsaWFyJyk7XG5cbiAgICAgIC8vIENyaWFyIGNvbXBvc2nDp8OjbyBmYW1pbGlhclxuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoXG4gICAgICAgIGBDcmlhbmRvIG5vdmEgY29tcG9zacOnw6NvIGZhbWlsaWFyIHBhcmEgbyBjaWRhZMOjbzogSUQgJHtjaWRhZGFvLmlkfWAsXG4gICAgICApO1xuICAgICAgY29uc3Qgbm92YUNvbXBvc2ljYW8gPSB0aGlzLmNvbXBvc2ljYW9GYW1pbGlhclJlcG9zaXRvcnkuY3JlYXRlKHtcbiAgICAgICAgLi4uZGFkb3NDb21wb3NpY2FvLFxuICAgICAgICBjcGY6IGNwZkxpbXBvLFxuICAgICAgICBjaWRhZGFvX2lkOiBjaWRhZGFvQWx2b0lkLFxuICAgICAgICBub21lOiBjaWRhZGFvLm5vbWUsIC8vIFVzYXIgbyBub21lIGRvIGNpZGFkw6NvXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgcXVlcnlSdW5uZXIubWFuYWdlci5zYXZlKG5vdmFDb21wb3NpY2FvKTtcbiAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKFxuICAgICAgICBgTm92YSBjb21wb3Npw6fDo28gZmFtaWxpYXIgY3JpYWRhOiBJRCAke25vdmFDb21wb3NpY2FvLmlkfWAsXG4gICAgICApO1xuXG4gICAgICAvLyBTb2Z0IGRlbGV0ZSBkbyBjaWRhZMOjbyAobWFyY2FyIGNvbW8gcmVtb3ZpZG8pXG4gICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgUmVhbGl6YW5kbyBzb2Z0IGRlbGV0ZSBkbyBjaWRhZMOjbzogSUQgJHtjaWRhZGFvLmlkfWApO1xuICAgICAgYXdhaXQgcXVlcnlSdW5uZXIubWFuYWdlci5zb2Z0UmVtb3ZlKGNpZGFkYW8pO1xuXG4gICAgICAvLyBSZWdpc3RyYXIgaGlzdMOzcmljbyBkZSBjb252ZXJzw6NvXG4gICAgICBjb25zdCBoaXN0b3JpY28gPSBhd2FpdCB0aGlzLmhpc3Rvcmljb1NlcnZpY2UuY3JpYXJIaXN0b3JpY28oXG4gICAgICAgIHtcbiAgICAgICAgICBjaWRhZGFvX2lkOiBjaWRhZGFvLmlkLFxuICAgICAgICAgIHBhcGVsX2FudGVyaW9yOiBUaXBvUGFwZWwuQkVORUZJQ0lBUklPLFxuICAgICAgICAgIHBhcGVsX25vdm86IFRpcG9QYXBlbC5NRU1CUk9fQ09NUE9TSUNBTyxcbiAgICAgICAgICBqdXN0aWZpY2F0aXZhLFxuICAgICAgICAgIGNvbXBvc2ljYW9fZmFtaWxpYXJfaWQ6IG5vdmFDb21wb3NpY2FvLmlkLFxuICAgICAgICB9LFxuICAgICAgICB1c3VhcmlvSWQsXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBxdWVyeVJ1bm5lci5jb21taXRUcmFuc2FjdGlvbigpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNlc3NvOiB0cnVlLFxuICAgICAgICBtZW5zYWdlbTpcbiAgICAgICAgICAnQ2lkYWTDo28gY29udmVydGlkbyBwYXJhIG1lbWJybyBkZSBjb21wb3Npw6fDo28gZmFtaWxpYXIgY29tIHN1Y2Vzc28nLFxuICAgICAgICBoaXN0b3JpY29JZDogaGlzdG9yaWNvLmlkLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIud2FybihcbiAgICAgICAgYEVycm8gZHVyYW50ZSBhIGNvbnZlcnPDo28gcGFyYSBjb21wb3Npw6fDo28gZmFtaWxpYXI6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgKTtcbiAgICAgIGF3YWl0IHF1ZXJ5UnVubmVyLnJvbGxiYWNrVHJhbnNhY3Rpb24oKTtcbiAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKCdUcmFuc2HDp8OjbyByZXZlcnRpZGEgYXDDs3MgZXJybycpO1xuXG4gICAgICBpZiAoXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgTm90Rm91bmRFeGNlcHRpb24gfHxcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBDb25mbGljdEV4Y2VwdGlvbiB8fFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEJhZFJlcXVlc3RFeGNlcHRpb25cbiAgICAgICkge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cblxuICAgICAgLy8gUmVnaXN0cmFyIGRldGFsaGVzIGRvIGVycm8gcGFyYSBmYWNpbGl0YXIgYSBkZXB1cmHDp8Ojb1xuICAgICAgY29uc3QgZXJyb3JEZXRhaWxzID0ge1xuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICBzdGFjazogZXJyb3Iuc3RhY2ssXG4gICAgICAgIGNwZixcbiAgICAgICAgY2lkYWRhb0Fsdm9JZCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9O1xuXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gY29udmVydGVyIHBhcmEgY29tcG9zacOnw6NvIGZhbWlsaWFyOiAke0pTT04uc3RyaW5naWZ5KGVycm9yRGV0YWlscyl9YCxcbiAgICAgICAgZXJyb3Iuc3RhY2ssXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgICdFcnJvIGFvIGNvbnZlcnRlciBjaWRhZMOjbyBwYXJhIG1lbWJybyBkZSBjb21wb3Npw6fDo28gZmFtaWxpYXInLFxuICAgICAgKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgYXdhaXQgcXVlcnlSdW5uZXIucmVsZWFzZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBleGlzdGVtIGNvbmZsaXRvcyBlbnRyZSBwYXDDqWlzIHBhcmEgdW0gY2lkYWTDo29cbiAgICogQHBhcmFtIGNpZGFkYW9JZCBJRCBkbyBjaWRhZMOjb1xuICAgKiBAcGFyYW0gcGFwZWxJZHMgTGlzdGEgZGUgSURzIGRlIHBhcMOpaXMgYSBzZXJlbSB2ZXJpZmljYWRvc1xuICAgKiBAcmV0dXJucyBSZXN1bHRhZG8gZGEgdmVyaWZpY2HDp8Ojb1xuICAgKi9cbiAgYXN5bmMgdmVyaWZpY2FyUGFwZWlzQ29uZmxpdGFudGVzKFxuICAgIGNpZGFkYW9JZDogc3RyaW5nLFxuICAgIHBhcGVsSWRzOiBzdHJpbmdbXSxcbiAgKTogUHJvbWlzZTxSZXN1bHRhZG9WZXJpZmljYWNhb0NvbmZsaXRvcz4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBWZXJpZmljYXIgc2UgbyBjaWRhZMOjbyBleGlzdGVcbiAgICAgIGNvbnN0IGNpZGFkYW8gPSBhd2FpdCB0aGlzLmNpZGFkYW9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY2lkYWRhb0lkIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFjaWRhZGFvKSB7XG4gICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignQ2lkYWTDo28gbsOjbyBlbmNvbnRyYWRvJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEJ1c2NhciBwYXDDqWlzIGF0dWFpcyBkbyBjaWRhZMOjb1xuICAgICAgY29uc3QgcGFwZWlzQ2lkYWRhbyA9IGF3YWl0IHRoaXMucGFwZWxDaWRhZGFvUmVwb3NpdG9yeS5maW5kKHtcbiAgICAgICAgd2hlcmU6IHsgY2lkYWRhb19pZDogY2lkYWRhb0lkLCBhdGl2bzogdHJ1ZSB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFNpbXVsYXIgYSBsaXN0YSBkZSBwYXDDqWlzIHF1ZSBvIGNpZGFkw6NvIHRlcmlhXG4gICAgICBjb25zdCB0b2Rvc1BhcGVpcyA9IFsuLi5wYXBlaXNDaWRhZGFvLm1hcCgocCkgPT4gcC5pZCksIC4uLnBhcGVsSWRzXTtcblxuICAgICAgLy8gVmVyaWZpY2FyIGNvbmZsaXRvcyBjb20gYmFzZSBuYXMgcmVncmFzIGRlIG5lZ8OzY2lvXG4gICAgICBjb25zdCByZWdyYXNDb25mbGl0byA9IGF3YWl0IHRoaXMubGlzdGFyUmVncmFzQ29uZmxpdG8oKTtcbiAgICAgIGNvbnN0IGNvbmZsaXRvczogUGFwZWxDb25mbGl0YW50ZVtdID0gW107XG5cbiAgICAgIC8vIFZlcmlmaWNhciBjYWRhIHJlZ3JhIGRlIGNvbmZsaXRvXG4gICAgICBmb3IgKGNvbnN0IHJlZ3JhIG9mIHJlZ3Jhc0NvbmZsaXRvKSB7XG4gICAgICAgIGlmICghcmVncmEuYXRpdm8pIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFZlcmlmaWNhciBzZSBhIHJlZ3JhIHNlIGFwbGljYSBhb3MgcGFww6lpcyBkbyBjaWRhZMOjb1xuICAgICAgICBjb25zdCB0ZW1QYXBlbE9yaWdlbSA9IHRvZG9zUGFwZWlzLmluY2x1ZGVzKHJlZ3JhLnBhcGVsX29yaWdlbV9pZCk7XG4gICAgICAgIGNvbnN0IHRlbVBhcGVsRGVzdGlubyA9IHRvZG9zUGFwZWlzLmluY2x1ZGVzKHJlZ3JhLnBhcGVsX2Rlc3Rpbm9faWQpO1xuXG4gICAgICAgIGlmICh0ZW1QYXBlbE9yaWdlbSAmJiB0ZW1QYXBlbERlc3Rpbm8pIHtcbiAgICAgICAgICBjb25mbGl0b3MucHVzaCh7XG4gICAgICAgICAgICBwYXBlbF9pZDogcGFwZWxJZHMuaW5jbHVkZXMocmVncmEucGFwZWxfb3JpZ2VtX2lkKVxuICAgICAgICAgICAgICA/IHJlZ3JhLnBhcGVsX29yaWdlbV9pZFxuICAgICAgICAgICAgICA6IHJlZ3JhLnBhcGVsX2Rlc3Rpbm9faWQsXG4gICAgICAgICAgICBub21lX3BhcGVsOiBwYXBlbElkcy5pbmNsdWRlcyhyZWdyYS5wYXBlbF9vcmlnZW1faWQpXG4gICAgICAgICAgICAgID8gcmVncmEucGFwZWxfb3JpZ2VtX25vbWVcbiAgICAgICAgICAgICAgOiByZWdyYS5wYXBlbF9kZXN0aW5vX25vbWUsXG4gICAgICAgICAgICByZWdyYV9jb25mbGl0bzogcmVncmEuZGVzY3JpY2FvLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBvc3N1aV9jb25mbGl0bzogY29uZmxpdG9zLmxlbmd0aCA+IDAsXG4gICAgICAgIHBhcGVpc19jb25mbGl0YW50ZXM6IGNvbmZsaXRvcyxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIE5vdEZvdW5kRXhjZXB0aW9uKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gdmVyaWZpY2FyIHBhcMOpaXMgY29uZmxpdGFudGVzOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgZXJyb3Iuc3RhY2ssXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgICdFcnJvIGFvIHZlcmlmaWNhciBwYXDDqWlzIGNvbmZsaXRhbnRlcycsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBwYXDDqWlzIGNvbmZsaXRhbnRlcyBwYXJhIHVtIGNpZGFkw6NvIGVzcGVjw61maWNvXG4gICAqIEBwYXJhbSBjaWRhZGFvSWQgSUQgZG8gY2lkYWTDo29cbiAgICogQHJldHVybnMgUmVzdWx0YWRvIGRhIHZlcmlmaWNhw6fDo29cbiAgICovXG4gIGFzeW5jIHZlcmlmaWNhclBhcGVpc0NvbmZsaXRhbnRlc0NpZGFkYW8oXG4gICAgY2lkYWRhb0lkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8UmVzdWx0YWRvVmVyaWZpY2FjYW9Db25mbGl0b3M+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVmVyaWZpY2FyIHNlIG8gY2lkYWTDo28gZXhpc3RlXG4gICAgICBjb25zdCBjaWRhZGFvID0gYXdhaXQgdGhpcy5jaWRhZGFvUmVwb3NpdG9yeS5maW5kT25lKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGNpZGFkYW9JZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghY2lkYWRhbykge1xuICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ0NpZGFkw6NvIG7Do28gZW5jb250cmFkbycpO1xuICAgICAgfVxuXG4gICAgICAvLyBCdXNjYXIgcGFww6lpcyBhdHVhaXMgZG8gY2lkYWTDo29cbiAgICAgIGNvbnN0IHBhcGVpc0NpZGFkYW8gPSBhd2FpdCB0aGlzLnBhcGVsQ2lkYWRhb1JlcG9zaXRvcnkuZmluZCh7XG4gICAgICAgIHdoZXJlOiB7IGNpZGFkYW9faWQ6IGNpZGFkYW9JZCwgYXRpdm86IHRydWUgfSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBWZXJpZmljYXIgY29uZmxpdG9zIGNvbSBiYXNlIG5hcyByZWdyYXMgZGUgbmVnw7NjaW9cbiAgICAgIGNvbnN0IHJlZ3Jhc0NvbmZsaXRvID0gYXdhaXQgdGhpcy5saXN0YXJSZWdyYXNDb25mbGl0bygpO1xuICAgICAgY29uc3QgY29uZmxpdG9zOiBQYXBlbENvbmZsaXRhbnRlW10gPSBbXTtcblxuICAgICAgLy8gVmVyaWZpY2FyIGNhZGEgcmVncmEgZGUgY29uZmxpdG9cbiAgICAgIGZvciAoY29uc3QgcmVncmEgb2YgcmVncmFzQ29uZmxpdG8pIHtcbiAgICAgICAgaWYgKCFyZWdyYS5hdGl2bykge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVmVyaWZpY2FyIHNlIGEgcmVncmEgc2UgYXBsaWNhIGFvcyBwYXDDqWlzIGRvIGNpZGFkw6NvXG4gICAgICAgIGNvbnN0IHRlbVBhcGVsT3JpZ2VtID0gcGFwZWlzQ2lkYWRhby5zb21lKFxuICAgICAgICAgIChwKSA9PiBwLmlkID09PSByZWdyYS5wYXBlbF9vcmlnZW1faWQsXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHRlbVBhcGVsRGVzdGlubyA9IHBhcGVpc0NpZGFkYW8uc29tZShcbiAgICAgICAgICAocCkgPT4gcC5pZCA9PT0gcmVncmEucGFwZWxfZGVzdGlub19pZCxcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodGVtUGFwZWxPcmlnZW0gJiYgdGVtUGFwZWxEZXN0aW5vKSB7XG4gICAgICAgICAgY29uZmxpdG9zLnB1c2goe1xuICAgICAgICAgICAgcGFwZWxfaWQ6IHJlZ3JhLnBhcGVsX2Rlc3Rpbm9faWQsXG4gICAgICAgICAgICBub21lX3BhcGVsOiByZWdyYS5wYXBlbF9kZXN0aW5vX25vbWUsXG4gICAgICAgICAgICByZWdyYV9jb25mbGl0bzogcmVncmEuZGVzY3JpY2FvLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBvc3N1aV9jb25mbGl0bzogY29uZmxpdG9zLmxlbmd0aCA+IDAsXG4gICAgICAgIHBhcGVpc19jb25mbGl0YW50ZXM6IGNvbmZsaXRvcyxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIE5vdEZvdW5kRXhjZXB0aW9uKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gdmVyaWZpY2FyIHBhcMOpaXMgY29uZmxpdGFudGVzIGRvIGNpZGFkw6NvOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgZXJyb3Iuc3RhY2ssXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgICdFcnJvIGFvIHZlcmlmaWNhciBwYXDDqWlzIGNvbmZsaXRhbnRlcyBkbyBjaWRhZMOjbycsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMaXN0YSBhcyByZWdyYXMgZGUgY29uZmxpdG8gZW50cmUgcGFww6lpc1xuICAgKiBAcmV0dXJucyBMaXN0YSBkZSByZWdyYXMgZGUgY29uZmxpdG9cbiAgICovXG4gIGFzeW5jIGxpc3RhclJlZ3Jhc0NvbmZsaXRvKCk6IFByb21pc2U8UmVncmFDb25mbGl0b1tdPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFNpbXVsYcOnw6NvIGRlIHJlZ3JhcyBkZSBjb25mbGl0byAtIGVtIHVtIGFtYmllbnRlIHJlYWwsIGVzdGFzIHZpcmlhbSBkbyBiYW5jbyBkZSBkYWRvc1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAnMScsXG4gICAgICAgICAgcGFwZWxfb3JpZ2VtX2lkOiAnMScsXG4gICAgICAgICAgcGFwZWxfb3JpZ2VtX25vbWU6ICdCZW5lZmljacOhcmlvJyxcbiAgICAgICAgICBwYXBlbF9kZXN0aW5vX2lkOiAnMicsXG4gICAgICAgICAgcGFwZWxfZGVzdGlub19ub21lOiAnTWVtYnJvIGRlIENvbXBvc2nDp8OjbyBGYW1pbGlhcicsXG4gICAgICAgICAgZGVzY3JpY2FvOlxuICAgICAgICAgICAgJ1VtIGNpZGFkw6NvIG7Do28gcG9kZSBzZXIgYmVuZWZpY2nDoXJpbyBlIG1lbWJybyBkZSBjb21wb3Npw6fDo28gZmFtaWxpYXIgYW8gbWVzbW8gdGVtcG8nLFxuICAgICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICcyJyxcbiAgICAgICAgICBwYXBlbF9vcmlnZW1faWQ6ICczJyxcbiAgICAgICAgICBwYXBlbF9vcmlnZW1fbm9tZTogJ1Jlc3BvbnPDoXZlbCBGYW1pbGlhcicsXG4gICAgICAgICAgcGFwZWxfZGVzdGlub19pZDogJzQnLFxuICAgICAgICAgIHBhcGVsX2Rlc3Rpbm9fbm9tZTogJ0RlcGVuZGVudGUnLFxuICAgICAgICAgIGRlc2NyaWNhbzpcbiAgICAgICAgICAgICdVbSBjaWRhZMOjbyBuw6NvIHBvZGUgc2VyIHJlc3BvbnPDoXZlbCBmYW1pbGlhciBlIGRlcGVuZGVudGUgYW8gbWVzbW8gdGVtcG8nLFxuICAgICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICczJyxcbiAgICAgICAgICBwYXBlbF9vcmlnZW1faWQ6ICc1JyxcbiAgICAgICAgICBwYXBlbF9vcmlnZW1fbm9tZTogJ1NlcnZpZG9yIFDDumJsaWNvJyxcbiAgICAgICAgICBwYXBlbF9kZXN0aW5vX2lkOiAnMScsXG4gICAgICAgICAgcGFwZWxfZGVzdGlub19ub21lOiAnQmVuZWZpY2nDoXJpbycsXG4gICAgICAgICAgZGVzY3JpY2FvOlxuICAgICAgICAgICAgJ1VtIHNlcnZpZG9yIHDDumJsaWNvIG7Do28gcG9kZSBzZXIgYmVuZWZpY2nDoXJpbyBkZSBwcm9ncmFtYXMgc29jaWFpcycsXG4gICAgICAgICAgYXRpdm86IHRydWUsXG4gICAgICAgIH0sXG4gICAgICBdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gbGlzdGFyIHJlZ3JhcyBkZSBjb25mbGl0bzogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICAgIGVycm9yLnN0YWNrLFxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICAnRXJybyBhbyBsaXN0YXIgcmVncmFzIGRlIGNvbmZsaXRvJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIGjDoSBjb25mbGl0byBlbnRyZSBwYXDDqWlzIGRlIHVtIGNpZGFkw6NvXG4gICAqIEBwYXJhbSBjcGYgQ1BGIGRvIGNpZGFkw6NvXG4gICAqIEByZXR1cm5zIFJlc3VsdGFkbyBkYSB2ZXJpZmljYcOnw6NvXG4gICAqL1xuICBhc3luYyB2ZXJpZmljYXJDb25mbGl0b1BhcGVpcyhcbiAgICBjcGY6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxSZXN1bHRhZG9WZXJpZmljYWNhb0NvbmZsaXRvPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEJ1c2NhciBjaWRhZMOjbyBwZWxvIENQRlxuICAgICAgY29uc3QgY2lkYWRhbyA9IGF3YWl0IHRoaXMuY2lkYWRhb1JlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICAgIHdoZXJlOiB7IGNwZiB9LFxuICAgICAgICByZWxhdGlvbnM6IFsncGFwZWlzJ10sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFjaWRhZGFvKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdGVtQ29uZmxpdG86IGZhbHNlLFxuICAgICAgICAgIGRldGFsaGVzOiAnQ2lkYWTDo28gbsOjbyBlbmNvbnRyYWRvJyxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gVmVyaWZpY2FyIHBhcMOpaXMgYXRpdm9zXG4gICAgICBjb25zdCBwYXBlaXNBdGl2b3MgPSBjaWRhZGFvLnBhcGVpcz8uZmlsdGVyKChwYXBlbCkgPT4gcGFwZWwuYXRpdm8pIHx8IFtdO1xuXG4gICAgICBpZiAocGFwZWlzQXRpdm9zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRlbUNvbmZsaXRvOiBmYWxzZSxcbiAgICAgICAgICBkZXRhbGhlczogJ05lbmh1bSBwYXBlbCBhdGl2byBlbmNvbnRyYWRvJyxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gVmVyaWZpY2FyIHNlIGjDoSBjb25mbGl0byAoZXhlbXBsbzogYmVuZWZpY2nDoXJpbyBuw6NvIHBvZGUgc2VyIHJlcXVlcmVudGUpXG4gICAgICBjb25zdCB0ZW1CZW5lZmljaWFyaW8gPSBwYXBlaXNBdGl2b3Muc29tZShcbiAgICAgICAgKHBhcGVsKSA9PiBwYXBlbC50aXBvX3BhcGVsID09PSAnYmVuZWZpY2lhcmlvJyxcbiAgICAgICk7XG4gICAgICBjb25zdCB0ZW1SZXF1ZXJlbnRlID0gcGFwZWlzQXRpdm9zLnNvbWUoXG4gICAgICAgIChwYXBlbCkgPT4gcGFwZWwudGlwb19wYXBlbCA9PT0gJ3JlcXVlcmVudGUnLFxuICAgICAgKTtcblxuICAgICAgaWYgKHRlbUJlbmVmaWNpYXJpbyAmJiB0ZW1SZXF1ZXJlbnRlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdGVtQ29uZmxpdG86IHRydWUsXG4gICAgICAgICAgdGlwb1BhcGVsQXR1YWw6ICdiZW5lZmljaWFyaW8nLFxuICAgICAgICAgIGNpZGFkYW9JZDogY2lkYWRhby5pZCxcbiAgICAgICAgICBkZXRhbGhlczpcbiAgICAgICAgICAgICdDaWRhZMOjbyBuw6NvIHBvZGUgc2VyIGJlbmVmaWNpw6FyaW8gZSByZXF1ZXJlbnRlIHNpbXVsdGFuZWFtZW50ZScsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRlbUNvbmZsaXRvOiBmYWxzZSxcbiAgICAgICAgdGlwb1BhcGVsQXR1YWw6IHBhcGVpc0F0aXZvc1swXT8udGlwb19wYXBlbCxcbiAgICAgICAgY2lkYWRhb0lkOiBjaWRhZGFvLmlkLFxuICAgICAgICBkZXRhbGhlczogJ05lbmh1bSBjb25mbGl0byBkZXRlY3RhZG8nLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvIGFvIHZlcmlmaWNhciBjb25mbGl0byBkZSBwYXDDqWlzOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgZXJyb3Iuc3RhY2ssXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgICdFcnJvIGFvIHZlcmlmaWNhciBjb25mbGl0byBkZSBwYXDDqWlzJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=