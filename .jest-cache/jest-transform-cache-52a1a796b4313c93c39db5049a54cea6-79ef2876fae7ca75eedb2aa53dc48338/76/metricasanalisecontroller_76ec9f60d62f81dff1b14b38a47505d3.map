{"file":"C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\modules\\metricas\\controllers\\metricas-analise.controller.ts","mappings":"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","names":[],"sources":["C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\modules\\metricas\\controllers\\metricas-analise.controller.ts"],"sourcesContent":["import { Controller, Get, Param, Query, UseGuards } from '@nestjs/common';\nimport {\n  ApiTags,\n  ApiOperation,\n  ApiResponse,\n  ApiBearerAuth,\n} from '@nestjs/swagger';\nimport { JwtAuthGuard } from '../../../shared/guards/jwt-auth.guard';\nimport { RolesGuard } from '../../../auth/guards/roles.guard';\nimport { Roles } from '../../../auth/decorators/role.decorator';\nimport { ROLES } from '../../../shared/constants/roles.constants';\n\nimport { MetricasService } from '../services/metricas.service';\nimport { MetricasAnomaliasService } from '../services/metricas-anomalia.service';\n\n/**\n * Controlador para análise de métricas\n *\n * Este controlador fornece endpoints para:\n * 1. Analisar tendências de métricas\n * 2. Detectar anomalias em séries históricas\n * 3. Gerar previsões baseadas em dados históricos\n */\n@ApiTags('Métricas e Dashboard')\n@ApiBearerAuth()\n@UseGuards(JwtAuthGuard, RolesGuard)\n@Controller('metricas/analise')\nexport class MetricasAnaliseController {\n  constructor(\n    private readonly metricasService: MetricasService,\n    private readonly metricasAnomaliasService: MetricasAnomaliasService,\n  ) {}\n\n  /**\n   * Analisa a tendência de uma métrica específica\n   */\n  @Get(':codigo/tendencia')\n  @Roles(ROLES.ADMIN, ROLES.GESTOR, ROLES.TECNICO)\n  @ApiOperation({ summary: 'Analisa tendência de uma métrica' })\n  @ApiResponse({\n    status: 200,\n    description: 'Análise de tendência realizada com sucesso',\n  })\n  @ApiResponse({ status: 404, description: 'Métrica não encontrada' })\n  async analisarTendencia(\n    @Param('codigo') codigo: string,\n    @Query('dataInicio') dataInicio: Date,\n    @Query('dataFim') dataFim: Date,\n    @Query('granularidade') granularidade: string,\n  ) {\n    return this.metricasAnomaliasService.analisarTendencias(\n      codigo,\n      dataInicio,\n      dataFim,\n      { granularidade: granularidade || 'diaria' },\n    );\n  }\n\n  /**\n   * Detecta anomalias em uma série histórica de métrica\n   */\n  @Get(':codigo/anomalias')\n  @Roles(ROLES.ADMIN, ROLES.GESTOR, ROLES.TECNICO)\n  @ApiOperation({ summary: 'Detecta anomalias em série histórica de métrica' })\n  @ApiResponse({\n    status: 200,\n    description: 'Detecção de anomalias realizada com sucesso',\n  })\n  @ApiResponse({ status: 404, description: 'Métrica não encontrada' })\n  async detectarAnomalias(\n    @Param('codigo') codigo: string,\n    @Query('dataInicio') dataInicio: Date,\n    @Query('dataFim') dataFim: Date,\n    @Query('sensibilidade') sensibilidade: number,\n  ) {\n    return this.metricasAnomaliasService.detectarAnomaliasPorCodigo(\n      codigo,\n      dataInicio,\n      dataFim,\n    );\n  }\n\n  /**\n   * Gera previsão baseada em dados históricos de uma métrica\n   */\n  @Get(':codigo/previsao')\n  @Roles(ROLES.ADMIN, ROLES.GESTOR, ROLES.TECNICO)\n  @ApiOperation({ summary: 'Gera previsão baseada em dados históricos' })\n  @ApiResponse({ status: 200, description: 'Previsão gerada com sucesso' })\n  @ApiResponse({ status: 404, description: 'Métrica não encontrada' })\n  async gerarPrevisao(\n    @Param('codigo') codigo: string,\n    @Query('horizonte') horizonte: number,\n    @Query('intervaloConfianca') intervaloConfianca: number,\n    @Query('modelo') modelo: string,\n  ) {\n    // Implementação temporária até que o método seja adicionado ao serviço\n    return {\n      codigo,\n      horizonte,\n      intervaloConfianca,\n      modelo,\n      previsao: [{ data: new Date(), valor: 0 }],\n      mensagem: 'Funcionalidade em desenvolvimento',\n    };\n  }\n}\n"],"version":3}