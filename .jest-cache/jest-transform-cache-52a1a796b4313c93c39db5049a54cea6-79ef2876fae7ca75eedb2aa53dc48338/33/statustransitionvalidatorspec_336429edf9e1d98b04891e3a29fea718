e73ec6fb633d7a0329a9d5354ecdbe9b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const status_transition_validator_1 = require("../../validators/status-transition-validator");
const status_pagamento_enum_1 = require("../../enums/status-pagamento.enum");
/**
 * Testes unitários para o validador de transições de status
 *
 * Verifica o funcionamento correto das validações de transições entre
 * os diferentes estados de um pagamento, garantindo que apenas transições
 * válidas sejam permitidas.
 *
 * @author Equipe PGBen
 */
describe('StatusTransitionValidator', () => {
    let validator;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [status_transition_validator_1.StatusTransitionValidator],
        }).compile();
        validator = module.get(status_transition_validator_1.StatusTransitionValidator);
    });
    describe('validarTransicao', () => {
        it('deve permitir transição de AGENDADO para LIBERADO', () => {
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO, status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO)).toBe(true);
        });
        it('deve permitir transição de AGENDADO para CANCELADO', () => {
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO, status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO)).toBe(true);
        });
        it('deve permitir transição de LIBERADO para CONFIRMADO', () => {
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO, status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO)).toBe(true);
        });
        it('deve permitir transição de LIBERADO para CANCELADO', () => {
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO, status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO)).toBe(true);
        });
        it('não deve permitir transição de CANCELADO para qualquer outro status', () => {
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO, status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO)).toBe(false);
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO, status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO)).toBe(false);
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO, status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO)).toBe(false);
        });
        it('não deve permitir transição de CONFIRMADO para qualquer outro status', () => {
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO, status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO)).toBe(false);
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO, status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO)).toBe(false);
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO, status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO)).toBe(false);
        });
        it('não deve permitir transição de AGENDADO para CONFIRMADO (pula etapa)', () => {
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO, status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO)).toBe(false);
        });
        it('deve retornar false para status inválidos', () => {
            expect(validator.validarTransicao('STATUS_INVALIDO', status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO)).toBe(false);
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO, 'STATUS_INVALIDO')).toBe(false);
        });
        it('deve permitir manter o mesmo status', () => {
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO, status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO)).toBe(true);
            expect(validator.validarTransicao(status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO, status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO)).toBe(true);
        });
    });
    describe('getProximosStatusPossiveis', () => {
        it('deve retornar os próximos status possíveis para AGENDADO', () => {
            const proximos = validator.getProximosStatusPossiveis(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO);
            expect(proximos).toContain(status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO);
            expect(proximos).toContain(status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO);
            expect(proximos).not.toContain(status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO);
        });
        it('deve retornar os próximos status possíveis para LIBERADO', () => {
            const proximos = validator.getProximosStatusPossiveis(status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO);
            expect(proximos).toContain(status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO);
            expect(proximos).toContain(status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO);
            expect(proximos).not.toContain(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO);
        });
        it('deve retornar array vazio para CONFIRMADO', () => {
            const proximos = validator.getProximosStatusPossiveis(status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO);
            expect(proximos.length).toBe(0);
        });
        it('deve retornar array vazio para CANCELADO', () => {
            const proximos = validator.getProximosStatusPossiveis(status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO);
            expect(proximos.length).toBe(0);
        });
        it('deve retornar array vazio para status inválido', () => {
            const proximos = validator.getProximosStatusPossiveis('STATUS_INVALIDO');
            expect(proximos.length).toBe(0);
        });
    });
    describe('getStatusInicial', () => {
        it('deve retornar AGENDADO como status inicial', () => {
            expect(validator.getStatusInicial()).toBe(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO);
        });
    });
    describe('getStatusFinais', () => {
        it('deve retornar CONFIRMADO e CANCELADO como status finais', () => {
            const statusFinais = validator.getStatusFinais();
            expect(statusFinais).toContain(status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO);
            expect(statusFinais).toContain(status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO);
            expect(statusFinais).not.toContain(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO);
            expect(statusFinais).not.toContain(status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO);
        });
    });
    describe('isStatusFinal', () => {
        it('deve identificar corretamente status finais', () => {
            expect(validator.isStatusFinal(status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO)).toBe(true);
            expect(validator.isStatusFinal(status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO)).toBe(true);
        });
        it('deve identificar corretamente status não finais', () => {
            expect(validator.isStatusFinal(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO)).toBe(false);
            expect(validator.isStatusFinal(status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO)).toBe(false);
        });
        it('deve retornar false para status inválido', () => {
            expect(validator.isStatusFinal('STATUS_INVALIDO')).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcdGVzdHNcXHZhbGlkYXRvcnNcXHN0YXR1cy10cmFuc2l0aW9uLXZhbGlkYXRvci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELDhGQUF5RjtBQUN6Riw2RUFBd0U7QUFFeEU7Ozs7Ozs7O0dBUUc7QUFDSCxRQUFRLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO0lBQ3pDLElBQUksU0FBb0MsQ0FBQztJQUV6QyxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFNBQVMsRUFBRSxDQUFDLHVEQUF5QixDQUFDO1NBQ3ZDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUViLFNBQVMsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUNwQix1REFBeUIsQ0FDMUIsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxFQUFFLENBQUMsbURBQW1ELEVBQUUsR0FBRyxFQUFFO1lBQzNELE1BQU0sQ0FDSixTQUFTLENBQUMsZ0JBQWdCLENBQ3hCLDJDQUFtQixDQUFDLFFBQVEsRUFDNUIsMkNBQW1CLENBQUMsUUFBUSxDQUM3QixDQUNGLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2YsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsb0RBQW9ELEVBQUUsR0FBRyxFQUFFO1lBQzVELE1BQU0sQ0FDSixTQUFTLENBQUMsZ0JBQWdCLENBQ3hCLDJDQUFtQixDQUFDLFFBQVEsRUFDNUIsMkNBQW1CLENBQUMsU0FBUyxDQUM5QixDQUNGLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2YsQ0FBQyxDQUFDLENBQUM7UUFF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Q0FDSixTQUFTLENBQUMsYUFBYSxDQUFDLGlCQUF3QyxDQUFDLENBQ2xFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xccGFnYW1lbnRvXFx0ZXN0c1xcdmFsaWRhdG9yc1xcc3RhdHVzLXRyYW5zaXRpb24tdmFsaWRhdG9yLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBTdGF0dXNUcmFuc2l0aW9uVmFsaWRhdG9yIH0gZnJvbSAnLi4vLi4vdmFsaWRhdG9ycy9zdGF0dXMtdHJhbnNpdGlvbi12YWxpZGF0b3InO1xuaW1wb3J0IHsgU3RhdHVzUGFnYW1lbnRvRW51bSB9IGZyb20gJy4uLy4uL2VudW1zL3N0YXR1cy1wYWdhbWVudG8uZW51bSc7XG5cbi8qKlxuICogVGVzdGVzIHVuaXTDoXJpb3MgcGFyYSBvIHZhbGlkYWRvciBkZSB0cmFuc2nDp8O1ZXMgZGUgc3RhdHVzXG4gKlxuICogVmVyaWZpY2EgbyBmdW5jaW9uYW1lbnRvIGNvcnJldG8gZGFzIHZhbGlkYcOnw7VlcyBkZSB0cmFuc2nDp8O1ZXMgZW50cmVcbiAqIG9zIGRpZmVyZW50ZXMgZXN0YWRvcyBkZSB1bSBwYWdhbWVudG8sIGdhcmFudGluZG8gcXVlIGFwZW5hcyB0cmFuc2nDp8O1ZXNcbiAqIHbDoWxpZGFzIHNlamFtIHBlcm1pdGlkYXMuXG4gKlxuICogQGF1dGhvciBFcXVpcGUgUEdCZW5cbiAqL1xuZGVzY3JpYmUoJ1N0YXR1c1RyYW5zaXRpb25WYWxpZGF0b3InLCAoKSA9PiB7XG4gIGxldCB2YWxpZGF0b3I6IFN0YXR1c1RyYW5zaXRpb25WYWxpZGF0b3I7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1N0YXR1c1RyYW5zaXRpb25WYWxpZGF0b3JdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHZhbGlkYXRvciA9IG1vZHVsZS5nZXQ8U3RhdHVzVHJhbnNpdGlvblZhbGlkYXRvcj4oXG4gICAgICBTdGF0dXNUcmFuc2l0aW9uVmFsaWRhdG9yLFxuICAgICk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGFyVHJhbnNpY2FvJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHBlcm1pdGlyIHRyYW5zacOnw6NvIGRlIEFHRU5EQURPIHBhcmEgTElCRVJBRE8nLCAoKSA9PiB7XG4gICAgICBleHBlY3QoXG4gICAgICAgIHZhbGlkYXRvci52YWxpZGFyVHJhbnNpY2FvKFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQUdFTkRBRE8sXG4gICAgICAgICAgU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETyxcbiAgICAgICAgKSxcbiAgICAgICkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHBlcm1pdGlyIHRyYW5zacOnw6NvIGRlIEFHRU5EQURPIHBhcmEgQ0FOQ0VMQURPJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KFxuICAgICAgICB2YWxpZGF0b3IudmFsaWRhclRyYW5zaWNhbyhcbiAgICAgICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkFHRU5EQURPLFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPLFxuICAgICAgICApLFxuICAgICAgKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcGVybWl0aXIgdHJhbnNpw6fDo28gZGUgTElCRVJBRE8gcGFyYSBDT05GSVJNQURPJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KFxuICAgICAgICB2YWxpZGF0b3IudmFsaWRhclRyYW5zaWNhbyhcbiAgICAgICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPLFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQ09ORklSTUFETyxcbiAgICAgICAgKSxcbiAgICAgICkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHBlcm1pdGlyIHRyYW5zacOnw6NvIGRlIExJQkVSQURPIHBhcmEgQ0FOQ0VMQURPJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KFxuICAgICAgICB2YWxpZGF0b3IudmFsaWRhclRyYW5zaWNhbyhcbiAgICAgICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPLFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPLFxuICAgICAgICApLFxuICAgICAgKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ27Do28gZGV2ZSBwZXJtaXRpciB0cmFuc2nDp8OjbyBkZSBDQU5DRUxBRE8gcGFyYSBxdWFscXVlciBvdXRybyBzdGF0dXMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoXG4gICAgICAgIHZhbGlkYXRvci52YWxpZGFyVHJhbnNpY2FvKFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPLFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQUdFTkRBRE8sXG4gICAgICAgICksXG4gICAgICApLnRvQmUoZmFsc2UpO1xuXG4gICAgICBleHBlY3QoXG4gICAgICAgIHZhbGlkYXRvci52YWxpZGFyVHJhbnNpY2FvKFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPLFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE8sXG4gICAgICAgICksXG4gICAgICApLnRvQmUoZmFsc2UpO1xuXG4gICAgICBleHBlY3QoXG4gICAgICAgIHZhbGlkYXRvci52YWxpZGFyVHJhbnNpY2FvKFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPLFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQ09ORklSTUFETyxcbiAgICAgICAgKSxcbiAgICAgICkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnbsOjbyBkZXZlIHBlcm1pdGlyIHRyYW5zacOnw6NvIGRlIENPTkZJUk1BRE8gcGFyYSBxdWFscXVlciBvdXRybyBzdGF0dXMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoXG4gICAgICAgIHZhbGlkYXRvci52YWxpZGFyVHJhbnNpY2FvKFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQ09ORklSTUFETyxcbiAgICAgICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkFHRU5EQURPLFxuICAgICAgICApLFxuICAgICAgKS50b0JlKGZhbHNlKTtcblxuICAgICAgZXhwZWN0KFxuICAgICAgICB2YWxpZGF0b3IudmFsaWRhclRyYW5zaWNhbyhcbiAgICAgICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkNPTkZJUk1BRE8sXG4gICAgICAgICAgU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETyxcbiAgICAgICAgKSxcbiAgICAgICkudG9CZShmYWxzZSk7XG5cbiAgICAgIGV4cGVjdChcbiAgICAgICAgdmFsaWRhdG9yLnZhbGlkYXJUcmFuc2ljYW8oXG4gICAgICAgICAgU3RhdHVzUGFnYW1lbnRvRW51bS5DT05GSVJNQURPLFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPLFxuICAgICAgICApLFxuICAgICAgKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCduw6NvIGRldmUgcGVybWl0aXIgdHJhbnNpw6fDo28gZGUgQUdFTkRBRE8gcGFyYSBDT05GSVJNQURPIChwdWxhIGV0YXBhKScsICgpID0+IHtcbiAgICAgIGV4cGVjdChcbiAgICAgICAgdmFsaWRhdG9yLnZhbGlkYXJUcmFuc2ljYW8oXG4gICAgICAgICAgU3RhdHVzUGFnYW1lbnRvRW51bS5BR0VOREFETyxcbiAgICAgICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkNPTkZJUk1BRE8sXG4gICAgICAgICksXG4gICAgICApLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgZmFsc2UgcGFyYSBzdGF0dXMgaW52w6FsaWRvcycsICgpID0+IHtcbiAgICAgIGV4cGVjdChcbiAgICAgICAgdmFsaWRhdG9yLnZhbGlkYXJUcmFuc2ljYW8oXG4gICAgICAgICAgJ1NUQVRVU19JTlZBTElETycgYXMgU3RhdHVzUGFnYW1lbnRvRW51bSxcbiAgICAgICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPLFxuICAgICAgICApLFxuICAgICAgKS50b0JlKGZhbHNlKTtcblxuICAgICAgZXhwZWN0KFxuICAgICAgICB2YWxpZGF0b3IudmFsaWRhclRyYW5zaWNhbyhcbiAgICAgICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkFHRU5EQURPLFxuICAgICAgICAgICdTVEFUVVNfSU5WQUxJRE8nIGFzIFN0YXR1c1BhZ2FtZW50b0VudW0sXG4gICAgICAgICksXG4gICAgICApLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcGVybWl0aXIgbWFudGVyIG8gbWVzbW8gc3RhdHVzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KFxuICAgICAgICB2YWxpZGF0b3IudmFsaWRhclRyYW5zaWNhbyhcbiAgICAgICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkFHRU5EQURPLFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQUdFTkRBRE8sXG4gICAgICAgICksXG4gICAgICApLnRvQmUodHJ1ZSk7XG5cbiAgICAgIGV4cGVjdChcbiAgICAgICAgdmFsaWRhdG9yLnZhbGlkYXJUcmFuc2ljYW8oXG4gICAgICAgICAgU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETyxcbiAgICAgICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPLFxuICAgICAgICApLFxuICAgICAgKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UHJveGltb3NTdGF0dXNQb3NzaXZlaXMnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgb3MgcHLDs3hpbW9zIHN0YXR1cyBwb3Nzw612ZWlzIHBhcmEgQUdFTkRBRE8nLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcm94aW1vcyA9IHZhbGlkYXRvci5nZXRQcm94aW1vc1N0YXR1c1Bvc3NpdmVpcyhcbiAgICAgICAgU3RhdHVzUGFnYW1lbnRvRW51bS5BR0VOREFETyxcbiAgICAgICk7XG4gICAgICBleHBlY3QocHJveGltb3MpLnRvQ29udGFpbihTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPKTtcbiAgICAgIGV4cGVjdChwcm94aW1vcykudG9Db250YWluKFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPKTtcbiAgICAgIGV4cGVjdChwcm94aW1vcykubm90LnRvQ29udGFpbihTdGF0dXNQYWdhbWVudG9FbnVtLkNPTkZJUk1BRE8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgb3MgcHLDs3hpbW9zIHN0YXR1cyBwb3Nzw612ZWlzIHBhcmEgTElCRVJBRE8nLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcm94aW1vcyA9IHZhbGlkYXRvci5nZXRQcm94aW1vc1N0YXR1c1Bvc3NpdmVpcyhcbiAgICAgICAgU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETyxcbiAgICAgICk7XG4gICAgICBleHBlY3QocHJveGltb3MpLnRvQ29udGFpbihTdGF0dXNQYWdhbWVudG9FbnVtLkNPTkZJUk1BRE8pO1xuICAgICAgZXhwZWN0KHByb3hpbW9zKS50b0NvbnRhaW4oU3RhdHVzUGFnYW1lbnRvRW51bS5DQU5DRUxBRE8pO1xuICAgICAgZXhwZWN0KHByb3hpbW9zKS5ub3QudG9Db250YWluKFN0YXR1c1BhZ2FtZW50b0VudW0uQUdFTkRBRE8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgYXJyYXkgdmF6aW8gcGFyYSBDT05GSVJNQURPJywgKCkgPT4ge1xuICAgICAgY29uc3QgcHJveGltb3MgPSB2YWxpZGF0b3IuZ2V0UHJveGltb3NTdGF0dXNQb3NzaXZlaXMoXG4gICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQ09ORklSTUFETyxcbiAgICAgICk7XG4gICAgICBleHBlY3QocHJveGltb3MubGVuZ3RoKS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgYXJyYXkgdmF6aW8gcGFyYSBDQU5DRUxBRE8nLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcm94aW1vcyA9IHZhbGlkYXRvci5nZXRQcm94aW1vc1N0YXR1c1Bvc3NpdmVpcyhcbiAgICAgICAgU3RhdHVzUGFnYW1lbnRvRW51bS5DQU5DRUxBRE8sXG4gICAgICApO1xuICAgICAgZXhwZWN0KHByb3hpbW9zLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIGFycmF5IHZhemlvIHBhcmEgc3RhdHVzIGludsOhbGlkbycsICgpID0+IHtcbiAgICAgIGNvbnN0IHByb3hpbW9zID0gdmFsaWRhdG9yLmdldFByb3hpbW9zU3RhdHVzUG9zc2l2ZWlzKFxuICAgICAgICAnU1RBVFVTX0lOVkFMSURPJyBhcyBTdGF0dXNQYWdhbWVudG9FbnVtLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChwcm94aW1vcy5sZW5ndGgpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRTdGF0dXNJbmljaWFsJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIEFHRU5EQURPIGNvbW8gc3RhdHVzIGluaWNpYWwnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodmFsaWRhdG9yLmdldFN0YXR1c0luaWNpYWwoKSkudG9CZShTdGF0dXNQYWdhbWVudG9FbnVtLkFHRU5EQURPKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFN0YXR1c0ZpbmFpcycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSByZXRvcm5hciBDT05GSVJNQURPIGUgQ0FOQ0VMQURPIGNvbW8gc3RhdHVzIGZpbmFpcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXR1c0ZpbmFpcyA9IHZhbGlkYXRvci5nZXRTdGF0dXNGaW5haXMoKTtcbiAgICAgIGV4cGVjdChzdGF0dXNGaW5haXMpLnRvQ29udGFpbihTdGF0dXNQYWdhbWVudG9FbnVtLkNPTkZJUk1BRE8pO1xuICAgICAgZXhwZWN0KHN0YXR1c0ZpbmFpcykudG9Db250YWluKFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPKTtcbiAgICAgIGV4cGVjdChzdGF0dXNGaW5haXMpLm5vdC50b0NvbnRhaW4oU3RhdHVzUGFnYW1lbnRvRW51bS5BR0VOREFETyk7XG4gICAgICBleHBlY3Qoc3RhdHVzRmluYWlzKS5ub3QudG9Db250YWluKFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE8pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaXNTdGF0dXNGaW5hbCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBpZGVudGlmaWNhciBjb3JyZXRhbWVudGUgc3RhdHVzIGZpbmFpcycsICgpID0+IHtcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IuaXNTdGF0dXNGaW5hbChTdGF0dXNQYWdhbWVudG9FbnVtLkNPTkZJUk1BRE8pKS50b0JlKFxuICAgICAgICB0cnVlLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IuaXNTdGF0dXNGaW5hbChTdGF0dXNQYWdhbWVudG9FbnVtLkNBTkNFTEFETykpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBpZGVudGlmaWNhciBjb3JyZXRhbWVudGUgc3RhdHVzIG7Do28gZmluYWlzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci5pc1N0YXR1c0ZpbmFsKFN0YXR1c1BhZ2FtZW50b0VudW0uQUdFTkRBRE8pKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IuaXNTdGF0dXNGaW5hbChTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBmYWxzZSBwYXJhIHN0YXR1cyBpbnbDoWxpZG8nLCAoKSA9PiB7XG4gICAgICBleHBlY3QoXG4gICAgICAgIHZhbGlkYXRvci5pc1N0YXR1c0ZpbmFsKCdTVEFUVVNfSU5WQUxJRE8nIGFzIFN0YXR1c1BhZ2FtZW50b0VudW0pLFxuICAgICAgKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==