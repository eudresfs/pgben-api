c150bcb01c96a2d0e67210d04128763a
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DadosNatalidadeService = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const dados_natalidade_entity_1 = require("../../../entities/dados-natalidade.entity");
/**
 * Serviço para gerenciar dados específicos de Auxílio Natalidade
 */
let DadosNatalidadeService = class DadosNatalidadeService {
    dadosNatalidadeRepository;
    constructor(dadosNatalidadeRepository) {
        this.dadosNatalidadeRepository = dadosNatalidadeRepository;
    }
    /**
     * Criar dados de natalidade para uma solicitação
     */
    async create(createDto) {
        // Verificar se já existem dados para esta solicitação
        const existingData = await this.dadosNatalidadeRepository.findOne({
            where: { solicitacao_id: createDto.solicitacao_id },
        });
        if (existingData) {
            throw new Error('Já existem dados de natalidade para esta solicitação');
        }
        const dadosNatalidade = this.dadosNatalidadeRepository.create(createDto);
        return this.dadosNatalidadeRepository.save(dadosNatalidade);
    }
    /**
     * Buscar dados de natalidade por ID
     */
    async findOne(id) {
        const dadosNatalidade = await this.dadosNatalidadeRepository.findOne({
            where: { id },
            relations: ['solicitacao'],
        });
        if (!dadosNatalidade) {
            throw new common_1.NotFoundException('Dados de natalidade não encontrados');
        }
        return dadosNatalidade;
    }
    /**
     * Buscar dados de natalidade por solicitação
     */
    async findBySolicitacao(solicitacaoId) {
        const dadosNatalidade = await this.dadosNatalidadeRepository.findOne({
            where: { solicitacao_id: solicitacaoId },
            relations: ['solicitacao'],
        });
        if (!dadosNatalidade) {
            throw new common_1.NotFoundException('Dados de natalidade não encontrados para esta solicitação');
        }
        return dadosNatalidade;
    }
    /**
     * Atualizar dados de natalidade
     */
    async update(id, updateDto) {
        const dadosNatalidade = await this.findOne(id);
        // Atualizar apenas os campos fornecidos
        Object.assign(dadosNatalidade, updateDto);
        return this.dadosNatalidadeRepository.save(dadosNatalidade);
    }
    /**
     * Remover dados de natalidade
     */
    async remove(id) {
        const dadosNatalidade = await this.findOne(id);
        await this.dadosNatalidadeRepository.remove(dadosNatalidade);
    }
    /**
     * Verificar se existem dados de natalidade para uma solicitação
     */
    async existsBySolicitacao(solicitacaoId) {
        const count = await this.dadosNatalidadeRepository.count({
            where: { solicitacao_id: solicitacaoId },
        });
        return count > 0;
    }
    /**
     * Buscar todos os dados de natalidade com paginação
     */
    async findAll(page = 1, limit = 10) {
        const [data, total] = await this.dadosNatalidadeRepository.findAndCount({
            relations: ['solicitacao'],
            skip: (page - 1) * limit,
            take: limit,
            order: { created_at: 'DESC' },
        });
        return {
            data,
            total,
            page,
            limit,
        };
    }
};
exports.DadosNatalidadeService = DadosNatalidadeService;
exports.DadosNatalidadeService = DadosNatalidadeService = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(dados_natalidade_entity_1.DadosNatalidade)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], DadosNatalidadeService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGJlbmVmaWNpb1xcc2VydmljZXNcXGRhZG9zLW5hdGFsaWRhZGUuc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQStEO0FBQy9ELDZDQUFtRDtBQUNuRCxxQ0FBcUM7QUFDckMsdUZBQTRFO0FBTTVFOztHQUVHO0FBRUksSUFBTSxzQkFBc0IsR0FBNUIsTUFBTSxzQkFBc0I7SUFHZDtJQUZuQixZQUVtQix5QkFBc0Q7UUFBdEQsOEJBQXlCLEdBQXpCLHlCQUF5QixDQUE2QjtJQUN0RSxDQUFDO0lBRUo7O09BRUc7SUFDSCxLQUFLLENBQUMsTUFBTSxDQUFDLFNBQW1DO1FBQzlDLHNEQUFzRDtRQUN0RCxNQUFNLFlBQVksR0FBRyxNQUFNLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxPQUFPLENBQUM7WUFDaEUsS0FBSyxFQUFFLEVBQUUsY0FBYyxFQUFFLFNBQVMsQ0FBQyxjQUFjLEVBQUU7U0FDcEQsQ0FBQyxDQUFDO1FBRUgsSUFBSSxZQUFZLEVBQUUsQ0FBQztZQUNqQixNQUFNLElBQUksS0FBSyxDQUFDLHNEQUFzRCxDQUFDLENBQUM7UUFDMUUsQ0FBQztRQUVELE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDekUsT0FBTyxJQUFJLENBQUMseUJBQXlCLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQzlELENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxPQUFPLENBQUMsRUFBVTtRQUN0QixNQUFNLGVBQWUsR0FBRyxNQUFNLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxPQUFPLENBQUM7WUFDbkUsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFO1lBQ2IsU0FBUyxFQUFFLENBQUMsYUFBYSxDQUFDO1NBQzNCLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUNyQixNQUFNLElBQUksMEJBQWlCLENBQUMscUNBQXFDLENBQUMsQ0FBQztRQUNyRSxDQUFDO1FBRUQsT0FBTyxlQUFlLENBQUM7SUFDekIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLGlCQUFpQixDQUFDLGFBQXFCO1FBQzNDLE1BQU0sZUFBZSxHQUFHLE1BQU0sSUFBSSxDQUFDLHlCQUF5QixDQUFDLE9BQU8sQ0FBQztZQUNuRSxLQUFLLEVBQUUsRUFBRSxjQUFjLEVBQUUsYUFBYSxFQUFFO1lBQ3hDLFNBQVMsRUFBRSxDQUFDLGFBQWEsQ0FBQztTQUMzQixDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDckIsTUFBTSxJQUFJLDBCQUFpQixDQUN6QiwyREFBMkQsQ0FDNUQsQ0FBQztRQUNKLENBQUM7UUFFRCxPQUFPLGVBQWUsQ0FBQztJQUN6QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsTUFBTSxDQUNWLEVBQVUsRUFDVixTQUFtQztRQUVuQyxNQUFNLGVBQWUsR0FBRyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFL0Msd0NBQXdDO1FBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsZUFBZSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBRTFDLE9BQU8sSUFBSSxDQUFDLHlCQUF5QixDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQVU7UUFDckIsTUFBTSxlQUFlLEdBQUcsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLE1BQU0sSUFBSSxDQUFDLHlCQUF5QixDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUMvRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsbUJBQW1CLENBQUMsYUFBcUI7UUFDN0MsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFJLENBQUMseUJBQXlCLENBQUMsS0FBSyxDQUFDO1lBQ3ZELEtBQUssRUFBRSxFQUFFLGNBQWMsRUFBRSxhQUFhLEVBQUU7U0FDekMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ25CLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxPQUFPLENBQ1gsT0FBZSxDQUFDLEVBQ2hCLFFBQWdCLEVBQUU7UUFPbEIsTUFBTSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsR0FBRyxNQUFNLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxZQUFZLENBQUM7WUFDdEUsU0FBUyxFQUFFLENBQUMsYUFBYSxDQUFDO1lBQzFCLElBQUksRUFBRSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxLQUFLO1lBQ3hCLElBQUksRUFBRSxLQUFLO1lBQ1gsS0FBSyxFQUFFLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRTtTQUM5QixDQUFDLENBQUM7UUFFSCxPQUFPO1lBQ0wsSUFBSTtZQUNKLEtBQUs7WUFDTCxJQUFJO1lBQ0osS0FBSztTQUNOLENBQUM7SUFDSixDQUFDO0NBQ0YsQ0FBQTtBQXBIWSx3REFBc0I7aUNBQXRCLHNCQUFzQjtJQURsQyxJQUFBLG1CQUFVLEdBQUU7SUFHUixXQUFBLElBQUEsMEJBQWdCLEVBQUMseUNBQWUsQ0FBQyxDQUFBO3lEQUNVLG9CQUFVLG9CQUFWLG9CQUFVO0dBSDdDLHNCQUFzQixDQW9IbEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGJlbmVmaWNpb1xcc2VydmljZXNcXGRhZG9zLW5hdGFsaWRhZGUuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBOb3RGb3VuZEV4Y2VwdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IEluamVjdFJlcG9zaXRvcnkgfSBmcm9tICdAbmVzdGpzL3R5cGVvcm0nO1xuaW1wb3J0IHsgUmVwb3NpdG9yeSB9IGZyb20gJ3R5cGVvcm0nO1xuaW1wb3J0IHsgRGFkb3NOYXRhbGlkYWRlIH0gZnJvbSAnLi4vLi4vLi4vZW50aXRpZXMvZGFkb3MtbmF0YWxpZGFkZS5lbnRpdHknO1xuaW1wb3J0IHtcbiAgQ3JlYXRlRGFkb3NOYXRhbGlkYWRlRHRvLFxuICBVcGRhdGVEYWRvc05hdGFsaWRhZGVEdG8sXG59IGZyb20gJy4uL2R0by9jcmVhdGUtZGFkb3MtbmF0YWxpZGFkZS5kdG8nO1xuXG4vKipcbiAqIFNlcnZpw6dvIHBhcmEgZ2VyZW5jaWFyIGRhZG9zIGVzcGVjw61maWNvcyBkZSBBdXjDrWxpbyBOYXRhbGlkYWRlXG4gKi9cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBEYWRvc05hdGFsaWRhZGVTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdFJlcG9zaXRvcnkoRGFkb3NOYXRhbGlkYWRlKVxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGFkb3NOYXRhbGlkYWRlUmVwb3NpdG9yeTogUmVwb3NpdG9yeTxEYWRvc05hdGFsaWRhZGU+LFxuICApIHt9XG5cbiAgLyoqXG4gICAqIENyaWFyIGRhZG9zIGRlIG5hdGFsaWRhZGUgcGFyYSB1bWEgc29saWNpdGHDp8Ojb1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlKGNyZWF0ZUR0bzogQ3JlYXRlRGFkb3NOYXRhbGlkYWRlRHRvKTogUHJvbWlzZTxEYWRvc05hdGFsaWRhZGU+IHtcbiAgICAvLyBWZXJpZmljYXIgc2UgasOhIGV4aXN0ZW0gZGFkb3MgcGFyYSBlc3RhIHNvbGljaXRhw6fDo29cbiAgICBjb25zdCBleGlzdGluZ0RhdGEgPSBhd2FpdCB0aGlzLmRhZG9zTmF0YWxpZGFkZVJlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICB3aGVyZTogeyBzb2xpY2l0YWNhb19pZDogY3JlYXRlRHRvLnNvbGljaXRhY2FvX2lkIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoZXhpc3RpbmdEYXRhKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0rDoSBleGlzdGVtIGRhZG9zIGRlIG5hdGFsaWRhZGUgcGFyYSBlc3RhIHNvbGljaXRhw6fDo28nKTtcbiAgICB9XG5cbiAgICBjb25zdCBkYWRvc05hdGFsaWRhZGUgPSB0aGlzLmRhZG9zTmF0YWxpZGFkZVJlcG9zaXRvcnkuY3JlYXRlKGNyZWF0ZUR0byk7XG4gICAgcmV0dXJuIHRoaXMuZGFkb3NOYXRhbGlkYWRlUmVwb3NpdG9yeS5zYXZlKGRhZG9zTmF0YWxpZGFkZSk7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2FyIGRhZG9zIGRlIG5hdGFsaWRhZGUgcG9yIElEXG4gICAqL1xuICBhc3luYyBmaW5kT25lKGlkOiBzdHJpbmcpOiBQcm9taXNlPERhZG9zTmF0YWxpZGFkZT4ge1xuICAgIGNvbnN0IGRhZG9zTmF0YWxpZGFkZSA9IGF3YWl0IHRoaXMuZGFkb3NOYXRhbGlkYWRlUmVwb3NpdG9yeS5maW5kT25lKHtcbiAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICByZWxhdGlvbnM6IFsnc29saWNpdGFjYW8nXSxcbiAgICB9KTtcblxuICAgIGlmICghZGFkb3NOYXRhbGlkYWRlKSB7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ0RhZG9zIGRlIG5hdGFsaWRhZGUgbsOjbyBlbmNvbnRyYWRvcycpO1xuICAgIH1cblxuICAgIHJldHVybiBkYWRvc05hdGFsaWRhZGU7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2FyIGRhZG9zIGRlIG5hdGFsaWRhZGUgcG9yIHNvbGljaXRhw6fDo29cbiAgICovXG4gIGFzeW5jIGZpbmRCeVNvbGljaXRhY2FvKHNvbGljaXRhY2FvSWQ6IHN0cmluZyk6IFByb21pc2U8RGFkb3NOYXRhbGlkYWRlPiB7XG4gICAgY29uc3QgZGFkb3NOYXRhbGlkYWRlID0gYXdhaXQgdGhpcy5kYWRvc05hdGFsaWRhZGVSZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgd2hlcmU6IHsgc29saWNpdGFjYW9faWQ6IHNvbGljaXRhY2FvSWQgfSxcbiAgICAgIHJlbGF0aW9uczogWydzb2xpY2l0YWNhbyddLFxuICAgIH0pO1xuXG4gICAgaWYgKCFkYWRvc05hdGFsaWRhZGUpIHtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihcbiAgICAgICAgJ0RhZG9zIGRlIG5hdGFsaWRhZGUgbsOjbyBlbmNvbnRyYWRvcyBwYXJhIGVzdGEgc29saWNpdGHDp8OjbycsXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiBkYWRvc05hdGFsaWRhZGU7XG4gIH1cblxuICAvKipcbiAgICogQXR1YWxpemFyIGRhZG9zIGRlIG5hdGFsaWRhZGVcbiAgICovXG4gIGFzeW5jIHVwZGF0ZShcbiAgICBpZDogc3RyaW5nLFxuICAgIHVwZGF0ZUR0bzogVXBkYXRlRGFkb3NOYXRhbGlkYWRlRHRvLFxuICApOiBQcm9taXNlPERhZG9zTmF0YWxpZGFkZT4ge1xuICAgIGNvbnN0IGRhZG9zTmF0YWxpZGFkZSA9IGF3YWl0IHRoaXMuZmluZE9uZShpZCk7XG5cbiAgICAvLyBBdHVhbGl6YXIgYXBlbmFzIG9zIGNhbXBvcyBmb3JuZWNpZG9zXG4gICAgT2JqZWN0LmFzc2lnbihkYWRvc05hdGFsaWRhZGUsIHVwZGF0ZUR0byk7XG5cbiAgICByZXR1cm4gdGhpcy5kYWRvc05hdGFsaWRhZGVSZXBvc2l0b3J5LnNhdmUoZGFkb3NOYXRhbGlkYWRlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVyIGRhZG9zIGRlIG5hdGFsaWRhZGVcbiAgICovXG4gIGFzeW5jIHJlbW92ZShpZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZGFkb3NOYXRhbGlkYWRlID0gYXdhaXQgdGhpcy5maW5kT25lKGlkKTtcbiAgICBhd2FpdCB0aGlzLmRhZG9zTmF0YWxpZGFkZVJlcG9zaXRvcnkucmVtb3ZlKGRhZG9zTmF0YWxpZGFkZSk7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2FyIHNlIGV4aXN0ZW0gZGFkb3MgZGUgbmF0YWxpZGFkZSBwYXJhIHVtYSBzb2xpY2l0YcOnw6NvXG4gICAqL1xuICBhc3luYyBleGlzdHNCeVNvbGljaXRhY2FvKHNvbGljaXRhY2FvSWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IGNvdW50ID0gYXdhaXQgdGhpcy5kYWRvc05hdGFsaWRhZGVSZXBvc2l0b3J5LmNvdW50KHtcbiAgICAgIHdoZXJlOiB7IHNvbGljaXRhY2FvX2lkOiBzb2xpY2l0YWNhb0lkIH0sXG4gICAgfSk7XG4gICAgcmV0dXJuIGNvdW50ID4gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdXNjYXIgdG9kb3Mgb3MgZGFkb3MgZGUgbmF0YWxpZGFkZSBjb20gcGFnaW5hw6fDo29cbiAgICovXG4gIGFzeW5jIGZpbmRBbGwoXG4gICAgcGFnZTogbnVtYmVyID0gMSxcbiAgICBsaW1pdDogbnVtYmVyID0gMTAsXG4gICk6IFByb21pc2U8e1xuICAgIGRhdGE6IERhZG9zTmF0YWxpZGFkZVtdO1xuICAgIHRvdGFsOiBudW1iZXI7XG4gICAgcGFnZTogbnVtYmVyO1xuICAgIGxpbWl0OiBudW1iZXI7XG4gIH0+IHtcbiAgICBjb25zdCBbZGF0YSwgdG90YWxdID0gYXdhaXQgdGhpcy5kYWRvc05hdGFsaWRhZGVSZXBvc2l0b3J5LmZpbmRBbmRDb3VudCh7XG4gICAgICByZWxhdGlvbnM6IFsnc29saWNpdGFjYW8nXSxcbiAgICAgIHNraXA6IChwYWdlIC0gMSkgKiBsaW1pdCxcbiAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgb3JkZXI6IHsgY3JlYXRlZF9hdDogJ0RFU0MnIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGF0YSxcbiAgICAgIHRvdGFsLFxuICAgICAgcGFnZSxcbiAgICAgIGxpbWl0LFxuICAgIH07XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==