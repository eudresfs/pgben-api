8c3e1c6b8a3083bc3a370ba7d388405d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const axios_1 = require("@nestjs/axios");
const config_1 = require("@nestjs/config");
const rxjs_1 = require("rxjs");
const integracao_solicitacao_service_1 = require("../../services/integracao-solicitacao.service");
const status_pagamento_enum_1 = require("../../enums/status-pagamento.enum");
const common_1 = require("@nestjs/common");
/**
 * Testes unitários para o serviço de integração com o módulo de solicitação
 *
 * Verifica o funcionamento correto das operações de consulta e atualização
 * de status de solicitações relacionadas a pagamentos.
 *
 * @author Equipe PGBen
 */
describe('IntegracaoSolicitacaoService', () => {
    let service;
    let httpService;
    let configService;
    // Mock do HttpService
    const mockHttpService = {
        get: jest.fn(),
        post: jest.fn(),
        patch: jest.fn()
    };
    // Mock do ConfigService
    const mockConfigService = {
        get: jest.fn().mockImplementation((key) => {
            if (key === 'solicitacao.apiUrl') {
                return 'http://api-solicitacao.pgben.local';
            }
            if (key === 'solicitacao.apiKey') {
                return 'api-key-mock';
            }
            if (key === 'solicitacao.statusPagamentoPendente') {
                return 'PAGAMENTO_PENDENTE';
            }
            if (key === 'solicitacao.statusPagamentoRealizado') {
                return 'PAGAMENTO_REALIZADO';
            }
            if (key === 'solicitacao.statusPagamentoCancelado') {
                return 'PAGAMENTO_CANCELADO';
            }
            return null;
        })
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                integracao_solicitacao_service_1.IntegracaoSolicitacaoService,
                {
                    provide: axios_1.HttpService,
                    useValue: mockHttpService
                },
                {
                    provide: config_1.ConfigService,
                    useValue: mockConfigService
                }
            ],
        }).compile();
        service = module.get(integracao_solicitacao_service_1.IntegracaoSolicitacaoService);
        httpService = module.get(axios_1.HttpService);
        configService = module.get(config_1.ConfigService);
        // Limpar mocks antes de cada teste
        jest.clearAllMocks();
    });
    describe('verificarStatusSolicitacao', () => {
        const solicitacaoId = 'solicitacao-id';
        const mockSolicitacao = {
            id: solicitacaoId,
            status: 'PAGAMENTO_PENDENTE',
            cidadaoId: 'cidadao-id',
            valorAprovado: 500.00,
            createdAt: '2023-01-01T00:00:00Z'
        };
        it('deve retornar status da solicitação quando encontrada', async () => {
            // Configurar mock da resposta HTTP
            const axiosResponse = {
                data: mockSolicitacao,
                status: 200,
                statusText: 'OK',
                headers: {},
                config: { headers: {} }
            };
            mockHttpService.get.mockReturnValue((0, rxjs_1.of)(axiosResponse));
            // Executar método
            const result = await service.verificarStatusSolicitacao(solicitacaoId);
            // Verificar resultado
            expect(result).toEqual(mockSolicitacao.status);
            expect(mockHttpService.get).toHaveBeenCalledWith(`http://api-solicitacao.pgben.local/solicitacoes/${solicitacaoId}`, expect.objectContaining({
                headers: expect.objectContaining({
                    'x-api-key': 'api-key-mock'
                })
            }));
        });
        it('deve lançar NotFoundException quando solicitação não encontrada', async () => {
            // Configurar mock do erro HTTP
            mockHttpService.get.mockReturnValue((0, rxjs_1.throwError)(() => ({
                response: {
                    status: 404,
                    data: { message: 'Solicitação não encontrada' }
                }
            })));
            // Executar e verificar exceção
            await expect(service.verificarStatusSolicitacao(solicitacaoId)).rejects.toThrow(common_1.NotFoundException);
        });
        it('deve propagar outros erros HTTP', async () => {
            // Configurar mock do erro HTTP
            mockHttpService.get.mockReturnValue((0, rxjs_1.throwError)(() => ({
                response: {
                    status: 500,
                    data: { message: 'Erro interno do servidor' }
                }
            })));
            // Executar e verificar exceção
            await expect(service.verificarStatusSolicitacao(solicitacaoId)).rejects.toThrow();
        });
    });
    describe('verificarSolicitacaoElegivel', () => {
        const solicitacaoId = 'solicitacao-id';
        it('deve retornar true quando solicitação está elegível para pagamento', async () => {
            // Configurar mock para verificarStatusSolicitacao
            jest.spyOn(service, 'verificarStatusSolicitacao').mockResolvedValue('PAGAMENTO_PENDENTE');
            // Executar método
            const result = await service.verificarSolicitacaoElegivel(solicitacaoId);
            // Verificar resultado
            expect(result).toBe(true);
            expect(service.verificarStatusSolicitacao).toHaveBeenCalledWith(solicitacaoId);
        });
        it('deve retornar false quando solicitação não está elegível para pagamento', async () => {
            // Configurar mock para verificarStatusSolicitacao
            jest.spyOn(service, 'verificarStatusSolicitacao').mockResolvedValue('PAGAMENTO_REALIZADO');
            // Executar método
            const result = await service.verificarSolicitacaoElegivel(solicitacaoId);
            // Verificar resultado
            expect(result).toBe(false);
        });
        it('deve propagar exceções de verificarStatusSolicitacao', async () => {
            // Configurar mock para verificarStatusSolicitacao
            jest.spyOn(service, 'verificarStatusSolicitacao').mockRejectedValue(new common_1.NotFoundException('Solicitação não encontrada'));
            // Executar e verificar exceção
            await expect(service.verificarSolicitacaoElegivel(solicitacaoId)).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('atualizarStatusSolicitacao', () => {
        const solicitacaoId = 'solicitacao-id';
        const usuarioId = 'usuario-id';
        const statusPagamento = status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO;
        const mockResposta = {
            id: solicitacaoId,
            status: 'PAGAMENTO_REALIZADO',
            updatedAt: '2023-01-02T00:00:00Z'
        };
        it('deve atualizar status da solicitação para PAGAMENTO_REALIZADO quando pagamento liberado', async () => {
            // Configurar mock da resposta HTTP
            const axiosResponse = {
                data: mockResposta,
                status: 200,
                statusText: 'OK',
                headers: {},
                config: { headers: {} }
            };
            mockHttpService.patch.mockReturnValue((0, rxjs_1.of)(axiosResponse));
            // Executar método
            const result = await service.atualizarStatusSolicitacao(solicitacaoId, statusPagamento, usuarioId);
            // Verificar resultado
            expect(result).toBe(true);
            expect(mockHttpService.patch).toHaveBeenCalledWith(`http://api-solicitacao.pgben.local/solicitacoes/${solicitacaoId}/status`, { status: 'PAGAMENTO_REALIZADO', motivo: expect.any(String) }, expect.objectContaining({
                headers: expect.objectContaining({
                    'x-api-key': 'api-key-mock',
                    'x-user-id': usuarioId
                })
            }));
        });
        it('deve atualizar status da solicitação para PAGAMENTO_CANCELADO quando pagamento cancelado', async () => {
            // Configurar mock da resposta HTTP
            const axiosResponse = {
                data: { ...mockResposta, status: 'PAGAMENTO_CANCELADO' },
                status: 200,
                statusText: 'OK',
                headers: {},
                config: { headers: {} }
            };
            mockHttpService.patch.mockReturnValue((0, rxjs_1.of)(axiosResponse));
            // Executar método
            const result = await service.atualizarStatusSolicitacao(solicitacaoId, status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO, usuarioId);
            // Verificar resultado
            expect(result).toBe(true);
            expect(mockHttpService.patch).toHaveBeenCalledWith(`http://api-solicitacao.pgben.local/solicitacoes/${solicitacaoId}/status`, { status: 'PAGAMENTO_CANCELADO', motivo: expect.any(String) }, expect.objectContaining({
                headers: expect.objectContaining({
                    'x-api-key': 'api-key-mock',
                    'x-user-id': usuarioId
                })
            }));
        });
        it('deve lançar ConflictException quando status de pagamento não requer atualização da solicitação', async () => {
            // Executar e verificar exceção
            await expect(service.atualizarStatusSolicitacao(solicitacaoId, status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO, usuarioId)).rejects.toThrow(common_1.ConflictException);
            expect(mockHttpService.patch).not.toHaveBeenCalled();
        });
        it('deve lançar NotFoundException quando solicitação não encontrada', async () => {
            // Configurar mock do erro HTTP
            mockHttpService.patch.mockReturnValue((0, rxjs_1.throwError)(() => ({
                response: {
                    status: 404,
                    data: { message: 'Solicitação não encontrada' }
                }
            })));
            // Executar e verificar exceção
            await expect(service.atualizarStatusSolicitacao(solicitacaoId, status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO, usuarioId)).rejects.toThrow(common_1.NotFoundException);
        });
        it('deve propagar outros erros HTTP', async () => {
            // Configurar mock do erro HTTP
            mockHttpService.patch.mockReturnValue((0, rxjs_1.throwError)(() => ({
                response: {
                    status: 500,
                    data: { message: 'Erro interno do servidor' }
                }
            })));
            // Executar e verificar exceção
            await expect(service.atualizarStatusSolicitacao(solicitacaoId, status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO, usuarioId)).rejects.toThrow();
        });
    });
    describe('obterDetalhesSolicitacao', () => {
        const solicitacaoId = 'solicitacao-id';
        const mockSolicitacao = {
            id: solicitacaoId,
            status: 'PAGAMENTO_PENDENTE',
            cidadaoId: 'cidadao-id',
            valorAprovado: 500.00,
            createdAt: '2023-01-01T00:00:00Z',
            beneficio: {
                id: 'beneficio-id',
                nome: 'Auxílio Moradia',
                descricao: 'Auxílio para famílias em situação de vulnerabilidade'
            },
            unidade: {
                id: 'unidade-id',
                nome: 'CRAS Centro',
                endereco: 'Rua Principal, 123'
            }
        };
        it('deve retornar detalhes da solicitação quando encontrada', async () => {
            // Configurar mock da resposta HTTP
            const axiosResponse = {
                data: mockSolicitacao,
                status: 200,
                statusText: 'OK',
                headers: {},
                config: { headers: {} }
            };
            mockHttpService.get.mockReturnValue((0, rxjs_1.of)(axiosResponse));
            // Executar método
            const result = await service.obterDetalhesSolicitacao(solicitacaoId);
            // Verificar resultado
            expect(result).toEqual(mockSolicitacao);
            expect(mockHttpService.get).toHaveBeenCalledWith(`http://api-solicitacao.pgben.local/solicitacoes/${solicitacaoId}`, expect.objectContaining({
                headers: expect.objectContaining({
                    'x-api-key': 'api-key-mock'
                }),
                params: {
                    expand: 'beneficio,unidade'
                }
            }));
        });
        it('deve lançar NotFoundException quando solicitação não encontrada', async () => {
            // Configurar mock do erro HTTP
            mockHttpService.get.mockReturnValue((0, rxjs_1.throwError)(() => ({
                response: {
                    status: 404,
                    data: { message: 'Solicitação não encontrada' }
                }
            })));
            // Executar e verificar exceção
            await expect(service.obterDetalhesSolicitacao(solicitacaoId)).rejects.toThrow(common_1.NotFoundException);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcdGVzdHNcXHNlcnZpY2VzXFxpbnRlZ3JhY2FvLXNvbGljaXRhY2FvLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCx5Q0FBNEM7QUFDNUMsMkNBQStDO0FBQy9DLCtCQUFzQztBQUV0QyxrR0FBNkY7QUFDN0YsNkVBQXdFO0FBQ3hFLDJDQUFzRTtBQUV0RTs7Ozs7OztHQU9HO0FBQ0gsUUFBUSxDQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtJQUM1QyxJQUFJLE9BQXFDLENBQUM7SUFDMUMsSUFBSSxXQUF3QixDQUFDO0lBQzdCLElBQUksYUFBNEIsQ0FBQztJQUVqQyxzQkFBc0I7SUFDdEIsTUFBTSxlQUFlLEdBQUc7UUFDdEIsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZCxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ2pCLENBQUM7SUFFRix3QkFBd0I7SUFDeEIsTUFBTSxpQkFBaUIsR0FBRztRQUN4QixHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7WUFDeEMsSUFBSSxHQUFHLEtBQUssb0JBQW9CLEVBQUUsQ0FBQztnQkFBQSxPQUFPLG9DQUFvQyxDQUFDO1lBQUEsQ0FBQztZQUNoRixJQUFJLEdBQUcsS0FBSyxvQkFBb0IsRUFBRSxDQUFDO2dCQUFBLE9BQU8sY0FBYyxDQUFDO1lBQUEsQ0FBQztZQUMxRCxJQUFJLEdBQUcsS0FBSyxxQ0FBcUMsRUFBRSxDQUFDO2dCQUFBLE9BQU8sb0JBQW9CLENBQUM7WUFBQSxDQUFDO1lBQ2pGLElBQUksR0FBRyxLQUFLLHNDQUFzQyxFQUFFLENBQUM7Z0JBQUEsT0FB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QWM7aUJBQzVCLENBQUM7Z0JBQ0YsTUFBTSxFQUFFO29CQUNOLE1BQU0sRUFBRSxtQkFBbUI7aUJBQzVCO2FBQ0YsQ0FBQyxDQUNILENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpRUFBaUUsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvRSwrQkFBK0I7WUFDL0IsZUFBZSxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQ2pDLElBQUEsaUJBQVUsRUFBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO2dCQUNoQixRQUFRLEVBQUU7b0JBQ1IsTUFBTSxFQUFFLEdBQUc7b0JBQ1gsSUFBSSxFQUFFLEVBQUUsT0FBTyxFQUFFLDRCQUE0QixFQUFFO2lCQUNoRDthQUNGLENBQUMsQ0FBQyxDQUNKLENBQUM7WUFFRiwrQkFBK0I7WUFDL0IsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLHdCQUF3QixDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQywwQkFBaUIsQ0FBQyxDQUFDO1FBQ25HLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xccGFnYW1lbnRvXFx0ZXN0c1xcc2VydmljZXNcXGludGVncmFjYW8tc29saWNpdGFjYW8uc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgSHR0cFNlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2F4aW9zJztcbmltcG9ydCB7IENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZyc7XG5pbXBvcnQgeyBvZiwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgQXhpb3NSZXNwb25zZSB9IGZyb20gJ2F4aW9zJztcbmltcG9ydCB7IEludGVncmFjYW9Tb2xpY2l0YWNhb1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9pbnRlZ3JhY2FvLXNvbGljaXRhY2FvLnNlcnZpY2UnO1xuaW1wb3J0IHsgU3RhdHVzUGFnYW1lbnRvRW51bSB9IGZyb20gJy4uLy4uL2VudW1zL3N0YXR1cy1wYWdhbWVudG8uZW51bSc7XG5pbXBvcnQgeyBOb3RGb3VuZEV4Y2VwdGlvbiwgQ29uZmxpY3RFeGNlcHRpb24gfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5cbi8qKlxuICogVGVzdGVzIHVuaXTDoXJpb3MgcGFyYSBvIHNlcnZpw6dvIGRlIGludGVncmHDp8OjbyBjb20gbyBtw7NkdWxvIGRlIHNvbGljaXRhw6fDo29cbiAqIFxuICogVmVyaWZpY2EgbyBmdW5jaW9uYW1lbnRvIGNvcnJldG8gZGFzIG9wZXJhw6fDtWVzIGRlIGNvbnN1bHRhIGUgYXR1YWxpemHDp8Ojb1xuICogZGUgc3RhdHVzIGRlIHNvbGljaXRhw6fDtWVzIHJlbGFjaW9uYWRhcyBhIHBhZ2FtZW50b3MuXG4gKiBcbiAqIEBhdXRob3IgRXF1aXBlIFBHQmVuXG4gKi9cbmRlc2NyaWJlKCdJbnRlZ3JhY2FvU29saWNpdGFjYW9TZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogSW50ZWdyYWNhb1NvbGljaXRhY2FvU2VydmljZTtcbiAgbGV0IGh0dHBTZXJ2aWNlOiBIdHRwU2VydmljZTtcbiAgbGV0IGNvbmZpZ1NlcnZpY2U6IENvbmZpZ1NlcnZpY2U7XG5cbiAgLy8gTW9jayBkbyBIdHRwU2VydmljZVxuICBjb25zdCBtb2NrSHR0cFNlcnZpY2UgPSB7XG4gICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgcG9zdDogamVzdC5mbigpLFxuICAgIHBhdGNoOiBqZXN0LmZuKClcbiAgfTtcblxuICAvLyBNb2NrIGRvIENvbmZpZ1NlcnZpY2VcbiAgY29uc3QgbW9ja0NvbmZpZ1NlcnZpY2UgPSB7XG4gICAgZ2V0OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChrZXkpID0+IHtcbiAgICAgIGlmIChrZXkgPT09ICdzb2xpY2l0YWNhby5hcGlVcmwnKSB7cmV0dXJuICdodHRwOi8vYXBpLXNvbGljaXRhY2FvLnBnYmVuLmxvY2FsJzt9XG4gICAgICBpZiAoa2V5ID09PSAnc29saWNpdGFjYW8uYXBpS2V5Jykge3JldHVybiAnYXBpLWtleS1tb2NrJzt9XG4gICAgICBpZiAoa2V5ID09PSAnc29saWNpdGFjYW8uc3RhdHVzUGFnYW1lbnRvUGVuZGVudGUnKSB7cmV0dXJuICdQQUdBTUVOVE9fUEVOREVOVEUnO31cbiAgICAgIGlmIChrZXkgPT09ICdzb2xpY2l0YWNhby5zdGF0dXNQYWdhbWVudG9SZWFsaXphZG8nKSB7cmV0dXJuICdQQUdBTUVOVE9fUkVBTElaQURPJzt9XG4gICAgICBpZiAoa2V5ID09PSAnc29saWNpdGFjYW8uc3RhdHVzUGFnYW1lbnRvQ2FuY2VsYWRvJykge3JldHVybiAnUEFHQU1FTlRPX0NBTkNFTEFETyc7fVxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSlcbiAgfTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIEludGVncmFjYW9Tb2xpY2l0YWNhb1NlcnZpY2UsXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBIdHRwU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0h0dHBTZXJ2aWNlXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBDb25maWdTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQ29uZmlnU2VydmljZVxuICAgICAgICB9XG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PEludGVncmFjYW9Tb2xpY2l0YWNhb1NlcnZpY2U+KEludGVncmFjYW9Tb2xpY2l0YWNhb1NlcnZpY2UpO1xuICAgIGh0dHBTZXJ2aWNlID0gbW9kdWxlLmdldDxIdHRwU2VydmljZT4oSHR0cFNlcnZpY2UpO1xuICAgIGNvbmZpZ1NlcnZpY2UgPSBtb2R1bGUuZ2V0PENvbmZpZ1NlcnZpY2U+KENvbmZpZ1NlcnZpY2UpO1xuXG4gICAgLy8gTGltcGFyIG1vY2tzIGFudGVzIGRlIGNhZGEgdGVzdGVcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZlcmlmaWNhclN0YXR1c1NvbGljaXRhY2FvJywgKCkgPT4ge1xuICAgIGNvbnN0IHNvbGljaXRhY2FvSWQgPSAnc29saWNpdGFjYW8taWQnO1xuICAgIFxuICAgIGNvbnN0IG1vY2tTb2xpY2l0YWNhbyA9IHtcbiAgICAgIGlkOiBzb2xpY2l0YWNhb0lkLFxuICAgICAgc3RhdHVzOiAnUEFHQU1FTlRPX1BFTkRFTlRFJyxcbiAgICAgIGNpZGFkYW9JZDogJ2NpZGFkYW8taWQnLFxuICAgICAgdmFsb3JBcHJvdmFkbzogNTAwLjAwLFxuICAgICAgY3JlYXRlZEF0OiAnMjAyMy0wMS0wMVQwMDowMDowMFonXG4gICAgfTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIHN0YXR1cyBkYSBzb2xpY2l0YcOnw6NvIHF1YW5kbyBlbmNvbnRyYWRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ29uZmlndXJhciBtb2NrIGRhIHJlc3Bvc3RhIEhUVFBcbiAgICAgIGNvbnN0IGF4aW9zUmVzcG9uc2U6IEF4aW9zUmVzcG9uc2UgPSB7XG4gICAgICAgIGRhdGE6IG1vY2tTb2xpY2l0YWNhbyxcbiAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgIHN0YXR1c1RleHQ6ICdPSycsXG4gICAgICAgIGhlYWRlcnM6IHt9LFxuICAgICAgICBjb25maWc6IHsgaGVhZGVyczoge30gfSBhcyBhbnlcbiAgICAgIH07XG4gICAgICBcbiAgICAgIG1vY2tIdHRwU2VydmljZS5nZXQubW9ja1JldHVyblZhbHVlKG9mKGF4aW9zUmVzcG9uc2UpKTtcblxuICAgICAgLy8gRXhlY3V0YXIgbcOpdG9kb1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52ZXJpZmljYXJTdGF0dXNTb2xpY2l0YWNhbyhzb2xpY2l0YWNhb0lkKTtcblxuICAgICAgLy8gVmVyaWZpY2FyIHJlc3VsdGFkb1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrU29saWNpdGFjYW8uc3RhdHVzKTtcbiAgICAgIGV4cGVjdChtb2NrSHR0cFNlcnZpY2UuZ2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgYGh0dHA6Ly9hcGktc29saWNpdGFjYW8ucGdiZW4ubG9jYWwvc29saWNpdGFjb2VzLyR7c29saWNpdGFjYW9JZH1gLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgaGVhZGVyczogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgJ3gtYXBpLWtleSc6ICdhcGkta2V5LW1vY2snXG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIE5vdEZvdW5kRXhjZXB0aW9uIHF1YW5kbyBzb2xpY2l0YcOnw6NvIG7Do28gZW5jb250cmFkYScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENvbmZpZ3VyYXIgbW9jayBkbyBlcnJvIEhUVFBcbiAgICAgIG1vY2tIdHRwU2VydmljZS5nZXQubW9ja1JldHVyblZhbHVlKFxuICAgICAgICB0aHJvd0Vycm9yKCgpID0+ICh7XG4gICAgICAgICAgcmVzcG9uc2U6IHtcbiAgICAgICAgICAgIHN0YXR1czogNDA0LFxuICAgICAgICAgICAgZGF0YTogeyBtZXNzYWdlOiAnU29saWNpdGHDp8OjbyBuw6NvIGVuY29udHJhZGEnIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pKVxuICAgICAgKTtcblxuICAgICAgLy8gRXhlY3V0YXIgZSB2ZXJpZmljYXIgZXhjZcOnw6NvXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS52ZXJpZmljYXJTdGF0dXNTb2xpY2l0YWNhbyhzb2xpY2l0YWNhb0lkKSkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHByb3BhZ2FyIG91dHJvcyBlcnJvcyBIVFRQJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ29uZmlndXJhciBtb2NrIGRvIGVycm8gSFRUUFxuICAgICAgbW9ja0h0dHBTZXJ2aWNlLmdldC5tb2NrUmV0dXJuVmFsdWUoXG4gICAgICAgIHRocm93RXJyb3IoKCkgPT4gKHtcbiAgICAgICAgICByZXNwb25zZToge1xuICAgICAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgICAgICBkYXRhOiB7IG1lc3NhZ2U6ICdFcnJvIGludGVybm8gZG8gc2Vydmlkb3InIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pKVxuICAgICAgKTtcblxuICAgICAgLy8gRXhlY3V0YXIgZSB2ZXJpZmljYXIgZXhjZcOnw6NvXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS52ZXJpZmljYXJTdGF0dXNTb2xpY2l0YWNhbyhzb2xpY2l0YWNhb0lkKSkucmVqZWN0cy50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2ZXJpZmljYXJTb2xpY2l0YWNhb0VsZWdpdmVsJywgKCkgPT4ge1xuICAgIGNvbnN0IHNvbGljaXRhY2FvSWQgPSAnc29saWNpdGFjYW8taWQnO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgdHJ1ZSBxdWFuZG8gc29saWNpdGHDp8OjbyBlc3TDoSBlbGVnw612ZWwgcGFyYSBwYWdhbWVudG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDb25maWd1cmFyIG1vY2sgcGFyYSB2ZXJpZmljYXJTdGF0dXNTb2xpY2l0YWNhb1xuICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAndmVyaWZpY2FyU3RhdHVzU29saWNpdGFjYW8nKS5tb2NrUmVzb2x2ZWRWYWx1ZSgnUEFHQU1FTlRPX1BFTkRFTlRFJyk7XG5cbiAgICAgIC8vIEV4ZWN1dGFyIG3DqXRvZG9cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudmVyaWZpY2FyU29saWNpdGFjYW9FbGVnaXZlbChzb2xpY2l0YWNhb0lkKTtcblxuICAgICAgLy8gVmVyaWZpY2FyIHJlc3VsdGFkb1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLnZlcmlmaWNhclN0YXR1c1NvbGljaXRhY2FvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChzb2xpY2l0YWNhb0lkKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIGZhbHNlIHF1YW5kbyBzb2xpY2l0YcOnw6NvIG7Do28gZXN0w6EgZWxlZ8OtdmVsIHBhcmEgcGFnYW1lbnRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ29uZmlndXJhciBtb2NrIHBhcmEgdmVyaWZpY2FyU3RhdHVzU29saWNpdGFjYW9cbiAgICAgIGplc3Quc3B5T24oc2VydmljZSwgJ3ZlcmlmaWNhclN0YXR1c1NvbGljaXRhY2FvJykubW9ja1Jlc29sdmVkVmFsdWUoJ1BBR0FNRU5UT19SRUFMSVpBRE8nKTtcblxuICAgICAgLy8gRXhlY3V0YXIgbcOpdG9kb1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52ZXJpZmljYXJTb2xpY2l0YWNhb0VsZWdpdmVsKHNvbGljaXRhY2FvSWQpO1xuXG4gICAgICAvLyBWZXJpZmljYXIgcmVzdWx0YWRvXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHByb3BhZ2FyIGV4Y2XDp8O1ZXMgZGUgdmVyaWZpY2FyU3RhdHVzU29saWNpdGFjYW8nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDb25maWd1cmFyIG1vY2sgcGFyYSB2ZXJpZmljYXJTdGF0dXNTb2xpY2l0YWNhb1xuICAgICAgamVzdC5zcHlPbihzZXJ2aWNlLCAndmVyaWZpY2FyU3RhdHVzU29saWNpdGFjYW8nKS5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdTb2xpY2l0YcOnw6NvIG7Do28gZW5jb250cmFkYScpXG4gICAgICApO1xuXG4gICAgICAvLyBFeGVjdXRhciBlIHZlcmlmaWNhciBleGNlw6fDo29cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnZlcmlmaWNhclNvbGljaXRhY2FvRWxlZ2l2ZWwoc29saWNpdGFjYW9JZCkpLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdhdHVhbGl6YXJTdGF0dXNTb2xpY2l0YWNhbycsICgpID0+IHtcbiAgICBjb25zdCBzb2xpY2l0YWNhb0lkID0gJ3NvbGljaXRhY2FvLWlkJztcbiAgICBjb25zdCB1c3VhcmlvSWQgPSAndXN1YXJpby1pZCc7XG4gICAgY29uc3Qgc3RhdHVzUGFnYW1lbnRvID0gU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETztcbiAgICBcbiAgICBjb25zdCBtb2NrUmVzcG9zdGEgPSB7XG4gICAgICBpZDogc29saWNpdGFjYW9JZCxcbiAgICAgIHN0YXR1czogJ1BBR0FNRU5UT19SRUFMSVpBRE8nLFxuICAgICAgdXBkYXRlZEF0OiAnMjAyMy0wMS0wMlQwMDowMDowMFonXG4gICAgfTtcblxuICAgIGl0KCdkZXZlIGF0dWFsaXphciBzdGF0dXMgZGEgc29saWNpdGHDp8OjbyBwYXJhIFBBR0FNRU5UT19SRUFMSVpBRE8gcXVhbmRvIHBhZ2FtZW50byBsaWJlcmFkbycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENvbmZpZ3VyYXIgbW9jayBkYSByZXNwb3N0YSBIVFRQXG4gICAgICBjb25zdCBheGlvc1Jlc3BvbnNlOiBBeGlvc1Jlc3BvbnNlID0ge1xuICAgICAgICBkYXRhOiBtb2NrUmVzcG9zdGEsXG4gICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICBzdGF0dXNUZXh0OiAnT0snLFxuICAgICAgICBoZWFkZXJzOiB7fSxcbiAgICAgICAgY29uZmlnOiB7IGhlYWRlcnM6IHt9IH0gYXMgYW55XG4gICAgICB9O1xuICAgICAgXG4gICAgICBtb2NrSHR0cFNlcnZpY2UucGF0Y2gubW9ja1JldHVyblZhbHVlKG9mKGF4aW9zUmVzcG9uc2UpKTtcblxuICAgICAgLy8gRXhlY3V0YXIgbcOpdG9kb1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5hdHVhbGl6YXJTdGF0dXNTb2xpY2l0YWNhbyhzb2xpY2l0YWNhb0lkLCBzdGF0dXNQYWdhbWVudG8sIHVzdWFyaW9JZCk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciByZXN1bHRhZG9cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobW9ja0h0dHBTZXJ2aWNlLnBhdGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgYGh0dHA6Ly9hcGktc29saWNpdGFjYW8ucGdiZW4ubG9jYWwvc29saWNpdGFjb2VzLyR7c29saWNpdGFjYW9JZH0vc3RhdHVzYCxcbiAgICAgICAgeyBzdGF0dXM6ICdQQUdBTUVOVE9fUkVBTElaQURPJywgbW90aXZvOiBleHBlY3QuYW55KFN0cmluZykgfSxcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIGhlYWRlcnM6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgICd4LWFwaS1rZXknOiAnYXBpLWtleS1tb2NrJyxcbiAgICAgICAgICAgICd4LXVzZXItaWQnOiB1c3VhcmlvSWRcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGF0dWFsaXphciBzdGF0dXMgZGEgc29saWNpdGHDp8OjbyBwYXJhIFBBR0FNRU5UT19DQU5DRUxBRE8gcXVhbmRvIHBhZ2FtZW50byBjYW5jZWxhZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDb25maWd1cmFyIG1vY2sgZGEgcmVzcG9zdGEgSFRUUFxuICAgICAgY29uc3QgYXhpb3NSZXNwb25zZTogQXhpb3NSZXNwb25zZSA9IHtcbiAgICAgICAgZGF0YTogeyAuLi5tb2NrUmVzcG9zdGEsIHN0YXR1czogJ1BBR0FNRU5UT19DQU5DRUxBRE8nIH0sXG4gICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICBzdGF0dXNUZXh0OiAnT0snLFxuICAgICAgICBoZWFkZXJzOiB7fSxcbiAgICAgICAgY29uZmlnOiB7IGhlYWRlcnM6IHt9IH0gYXMgYW55XG4gICAgICB9O1xuICAgICAgXG4gICAgICBtb2NrSHR0cFNlcnZpY2UucGF0Y2gubW9ja1JldHVyblZhbHVlKG9mKGF4aW9zUmVzcG9uc2UpKTtcblxuICAgICAgLy8gRXhlY3V0YXIgbcOpdG9kb1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5hdHVhbGl6YXJTdGF0dXNTb2xpY2l0YWNhbyhcbiAgICAgICAgc29saWNpdGFjYW9JZCwgXG4gICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPLCBcbiAgICAgICAgdXN1YXJpb0lkXG4gICAgICApO1xuXG4gICAgICAvLyBWZXJpZmljYXIgcmVzdWx0YWRvXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KG1vY2tIdHRwU2VydmljZS5wYXRjaCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGBodHRwOi8vYXBpLXNvbGljaXRhY2FvLnBnYmVuLmxvY2FsL3NvbGljaXRhY29lcy8ke3NvbGljaXRhY2FvSWR9L3N0YXR1c2AsXG4gICAgICAgIHsgc3RhdHVzOiAnUEFHQU1FTlRPX0NBTkNFTEFETycsIG1vdGl2bzogZXhwZWN0LmFueShTdHJpbmcpIH0sXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBoZWFkZXJzOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICAneC1hcGkta2V5JzogJ2FwaS1rZXktbW9jaycsXG4gICAgICAgICAgICAneC11c2VyLWlkJzogdXN1YXJpb0lkXG4gICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIENvbmZsaWN0RXhjZXB0aW9uIHF1YW5kbyBzdGF0dXMgZGUgcGFnYW1lbnRvIG7Do28gcmVxdWVyIGF0dWFsaXphw6fDo28gZGEgc29saWNpdGHDp8OjbycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEV4ZWN1dGFyIGUgdmVyaWZpY2FyIGV4Y2XDp8Ojb1xuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLmF0dWFsaXphclN0YXR1c1NvbGljaXRhY2FvKHNvbGljaXRhY2FvSWQsIFN0YXR1c1BhZ2FtZW50b0VudW0uQUdFTkRBRE8sIHVzdWFyaW9JZClcbiAgICAgICkucmVqZWN0cy50b1Rocm93KENvbmZsaWN0RXhjZXB0aW9uKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tIdHRwU2VydmljZS5wYXRjaCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGxhbsOnYXIgTm90Rm91bmRFeGNlcHRpb24gcXVhbmRvIHNvbGljaXRhw6fDo28gbsOjbyBlbmNvbnRyYWRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ29uZmlndXJhciBtb2NrIGRvIGVycm8gSFRUUFxuICAgICAgbW9ja0h0dHBTZXJ2aWNlLnBhdGNoLm1vY2tSZXR1cm5WYWx1ZShcbiAgICAgICAgdGhyb3dFcnJvcigoKSA9PiAoe1xuICAgICAgICAgIHJlc3BvbnNlOiB7XG4gICAgICAgICAgICBzdGF0dXM6IDQwNCxcbiAgICAgICAgICAgIGRhdGE6IHsgbWVzc2FnZTogJ1NvbGljaXRhw6fDo28gbsOjbyBlbmNvbnRyYWRhJyB9XG4gICAgICAgICAgfVxuICAgICAgICB9KSlcbiAgICAgICk7XG5cbiAgICAgIC8vIEV4ZWN1dGFyIGUgdmVyaWZpY2FyIGV4Y2XDp8Ojb1xuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLmF0dWFsaXphclN0YXR1c1NvbGljaXRhY2FvKHNvbGljaXRhY2FvSWQsIFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE8sIHVzdWFyaW9JZClcbiAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHByb3BhZ2FyIG91dHJvcyBlcnJvcyBIVFRQJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ29uZmlndXJhciBtb2NrIGRvIGVycm8gSFRUUFxuICAgICAgbW9ja0h0dHBTZXJ2aWNlLnBhdGNoLm1vY2tSZXR1cm5WYWx1ZShcbiAgICAgICAgdGhyb3dFcnJvcigoKSA9PiAoe1xuICAgICAgICAgIHJlc3BvbnNlOiB7XG4gICAgICAgICAgICBzdGF0dXM6IDUwMCxcbiAgICAgICAgICAgIGRhdGE6IHsgbWVzc2FnZTogJ0Vycm8gaW50ZXJubyBkbyBzZXJ2aWRvcicgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSkpXG4gICAgICApO1xuXG4gICAgICAvLyBFeGVjdXRhciBlIHZlcmlmaWNhciBleGNlw6fDo29cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5hdHVhbGl6YXJTdGF0dXNTb2xpY2l0YWNhbyhzb2xpY2l0YWNhb0lkLCBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPLCB1c3VhcmlvSWQpXG4gICAgICApLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnb2J0ZXJEZXRhbGhlc1NvbGljaXRhY2FvJywgKCkgPT4ge1xuICAgIGNvbnN0IHNvbGljaXRhY2FvSWQgPSAnc29saWNpdGFjYW8taWQnO1xuICAgIFxuICAgIGNvbnN0IG1vY2tTb2xpY2l0YWNhbyA9IHtcbiAgICAgIGlkOiBzb2xpY2l0YWNhb0lkLFxuICAgICAgc3RhdHVzOiAnUEFHQU1FTlRPX1BFTkRFTlRFJyxcbiAgICAgIGNpZGFkYW9JZDogJ2NpZGFkYW8taWQnLFxuICAgICAgdmFsb3JBcHJvdmFkbzogNTAwLjAwLFxuICAgICAgY3JlYXRlZEF0OiAnMjAyMy0wMS0wMVQwMDowMDowMFonLFxuICAgICAgYmVuZWZpY2lvOiB7XG4gICAgICAgIGlkOiAnYmVuZWZpY2lvLWlkJyxcbiAgICAgICAgbm9tZTogJ0F1eMOtbGlvIE1vcmFkaWEnLFxuICAgICAgICBkZXNjcmljYW86ICdBdXjDrWxpbyBwYXJhIGZhbcOtbGlhcyBlbSBzaXR1YcOnw6NvIGRlIHZ1bG5lcmFiaWxpZGFkZSdcbiAgICAgIH0sXG4gICAgICB1bmlkYWRlOiB7XG4gICAgICAgIGlkOiAndW5pZGFkZS1pZCcsXG4gICAgICAgIG5vbWU6ICdDUkFTIENlbnRybycsXG4gICAgICAgIGVuZGVyZWNvOiAnUnVhIFByaW5jaXBhbCwgMTIzJ1xuICAgICAgfVxuICAgIH07XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBkZXRhbGhlcyBkYSBzb2xpY2l0YcOnw6NvIHF1YW5kbyBlbmNvbnRyYWRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ29uZmlndXJhciBtb2NrIGRhIHJlc3Bvc3RhIEhUVFBcbiAgICAgIGNvbnN0IGF4aW9zUmVzcG9uc2U6IEF4aW9zUmVzcG9uc2UgPSB7XG4gICAgICAgIGRhdGE6IG1vY2tTb2xpY2l0YWNhbyxcbiAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgIHN0YXR1c1RleHQ6ICdPSycsXG4gICAgICAgIGhlYWRlcnM6IHt9LFxuICAgICAgICBjb25maWc6IHsgaGVhZGVyczoge30gfSBhcyBhbnlcbiAgICAgIH07XG4gICAgICBcbiAgICAgIG1vY2tIdHRwU2VydmljZS5nZXQubW9ja1JldHVyblZhbHVlKG9mKGF4aW9zUmVzcG9uc2UpKTtcblxuICAgICAgLy8gRXhlY3V0YXIgbcOpdG9kb1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5vYnRlckRldGFsaGVzU29saWNpdGFjYW8oc29saWNpdGFjYW9JZCk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciByZXN1bHRhZG9cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1NvbGljaXRhY2FvKTtcbiAgICAgIGV4cGVjdChtb2NrSHR0cFNlcnZpY2UuZ2V0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgYGh0dHA6Ly9hcGktc29saWNpdGFjYW8ucGdiZW4ubG9jYWwvc29saWNpdGFjb2VzLyR7c29saWNpdGFjYW9JZH1gLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgaGVhZGVyczogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgJ3gtYXBpLWtleSc6ICdhcGkta2V5LW1vY2snXG4gICAgICAgICAgfSksXG4gICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICBleHBhbmQ6ICdiZW5lZmljaW8sdW5pZGFkZSdcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbGFuw6dhciBOb3RGb3VuZEV4Y2VwdGlvbiBxdWFuZG8gc29saWNpdGHDp8OjbyBuw6NvIGVuY29udHJhZGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDb25maWd1cmFyIG1vY2sgZG8gZXJybyBIVFRQXG4gICAgICBtb2NrSHR0cFNlcnZpY2UuZ2V0Lm1vY2tSZXR1cm5WYWx1ZShcbiAgICAgICAgdGhyb3dFcnJvcigoKSA9PiAoe1xuICAgICAgICAgIHJlc3BvbnNlOiB7XG4gICAgICAgICAgICBzdGF0dXM6IDQwNCxcbiAgICAgICAgICAgIGRhdGE6IHsgbWVzc2FnZTogJ1NvbGljaXRhw6fDo28gbsOjbyBlbmNvbnRyYWRhJyB9XG4gICAgICAgICAgfVxuICAgICAgICB9KSlcbiAgICAgICk7XG5cbiAgICAgIC8vIEV4ZWN1dGFyIGUgdmVyaWZpY2FyIGV4Y2XDp8Ojb1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2Uub2J0ZXJEZXRhbGhlc1NvbGljaXRhY2FvKHNvbGljaXRhY2FvSWQpKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9