bd636bfb08054a7828cd817c36c33e6b
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MetricsService = void 0;
const common_1 = require("@nestjs/common");
const client = __importStar(require("prom-client"));
/**
 * Serviço de Métricas
 *
 * Responsável por coletar e expor métricas da aplicação
 * utilizando o Prometheus Client
 */
let MetricsService = class MetricsService {
    register;
    httpRequestsTotal;
    httpRequestDuration;
    httpRequestsInProgress;
    databaseQueriesTotal;
    databaseQueryDuration;
    constructor() {
        // Criar registro de métricas
        this.register = new client.Registry();
        // Adicionar métricas padrão do Node.js
        client.collectDefaultMetrics({ register: this.register });
        // Contador de requisições HTTP
        this.httpRequestsTotal = new client.Counter({
            name: 'http_requests_total',
            help: 'Total de requisições HTTP',
            labelNames: ['method', 'route', 'status_code'],
            registers: [this.register],
        });
        // Histograma de duração das requisições HTTP
        this.httpRequestDuration = new client.Histogram({
            name: 'http_request_duration_seconds',
            help: 'Duração das requisições HTTP em segundos',
            labelNames: ['method', 'route', 'status_code'],
            buckets: [0.01, 0.05, 0.1, 0.5, 1, 2, 5, 10],
            registers: [this.register],
        });
        // Gauge de requisições em andamento
        this.httpRequestsInProgress = new client.Gauge({
            name: 'http_requests_in_progress',
            help: 'Número de requisições HTTP em andamento',
            labelNames: ['method', 'route'],
            registers: [this.register],
        });
        // Contador de consultas ao banco de dados
        this.databaseQueriesTotal = new client.Counter({
            name: 'database_queries_total',
            help: 'Total de consultas ao banco de dados',
            labelNames: ['entity', 'operation'],
            registers: [this.register],
        });
        // Histograma de duração das consultas ao banco de dados
        this.databaseQueryDuration = new client.Histogram({
            name: 'database_query_duration_seconds',
            help: 'Duração das consultas ao banco de dados em segundos',
            labelNames: ['entity', 'operation'],
            buckets: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1],
            registers: [this.register],
        });
    }
    /**
     * Incrementa o contador de requisições HTTP
     */
    recordHttpRequest(method, route, statusCode) {
        this.httpRequestsTotal.inc({
            method,
            route,
            status_code: statusCode.toString(),
        });
    }
    /**
     * Registra a duração de uma requisição HTTP
     */
    recordHttpRequestDuration(method, route, statusCode, durationSeconds) {
        this.httpRequestDuration.observe({ method, route, status_code: statusCode.toString() }, durationSeconds);
    }
    /**
     * Incrementa o contador de requisições HTTP em andamento
     */
    incrementHttpRequestsInProgress(method, route) {
        this.httpRequestsInProgress.inc({ method, route });
    }
    /**
     * Decrementa o contador de requisições HTTP em andamento
     */
    decrementHttpRequestsInProgress(method, route) {
        this.httpRequestsInProgress.dec({ method, route });
    }
    /**
     * Incrementa o contador de consultas ao banco de dados
     */
    recordDatabaseQuery(entity, operation) {
        this.databaseQueriesTotal.inc({ entity, operation });
    }
    /**
     * Registra a duração de uma consulta ao banco de dados
     */
    recordDatabaseQueryDuration(entity, operation, durationSeconds) {
        this.databaseQueryDuration.observe({ entity, operation }, durationSeconds);
    }
    /**
     * Retorna todas as métricas no formato do Prometheus
     */
    async getMetrics() {
        return this.register.metrics();
    }
    /**
     * Retorna o registro de métricas
     */
    getRegister() {
        return this.register;
    }
};
exports.MetricsService = MetricsService;
exports.MetricsService = MetricsService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [])
], MetricsService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXHNoYXJlZFxcbW9uaXRvcmluZ1xcbWV0cmljcy5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUE0QztBQUM1QyxvREFBc0M7QUFFdEM7Ozs7O0dBS0c7QUFFSSxJQUFNLGNBQWMsR0FBcEIsTUFBTSxjQUFjO0lBQ1IsUUFBUSxDQUFrQjtJQUMxQixpQkFBaUIsQ0FBaUI7SUFDbEMsbUJBQW1CLENBQW1CO0lBQ3RDLHNCQUFzQixDQUFlO0lBQ3JDLG9CQUFvQixDQUFpQjtJQUNyQyxxQkFBcUIsQ0FBbUI7SUFFekQ7UUFDRSw2QkFBNkI7UUFDN0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUV0Qyx1Q0FBdUM7UUFDdkMsTUFBTSxDQUFDLHFCQUFxQixDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBRTFELCtCQUErQjtRQUMvQixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDO1lBQzFDLElBQUksRUFBRSxxQkFBcUI7WUFDM0IsSUFBSSxFQUFFLDJCQUEyQjtZQUNqQyxVQUFVLEVBQUUsQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLGFBQWEsQ0FBQztZQUM5QyxTQUFTLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO1NBQzNCLENBQUMsQ0FBQztRQUVILDZDQUE2QztRQUM3QyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDO1lBQzlDLElBQUksRUFBRSwrQkFBK0I7WUFDckMsSUFBSSxFQUFFLDBDQUEwQztZQUNoRCxVQUFVLEVBQUUsQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLGFBQWEsQ0FB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QUVHO0lBQ0gsS0FBSyxDQUFDLFVBQVU7UUFDZCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsV0FBVztRQUNULE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN2QixDQUFDO0NBQ0YsQ0FBQTtBQWpJWSx3Q0FBYzt5QkFBZCxjQUFjO0lBRDFCLElBQUEsbUJBQVUsR0FBRTs7R0FDQSxjQUFjLENBaUkxQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcc2hhcmVkXFxtb25pdG9yaW5nXFxtZXRyaWNzLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCAqIGFzIGNsaWVudCBmcm9tICdwcm9tLWNsaWVudCc7XG5cbi8qKlxuICogU2VydmnDp28gZGUgTcOpdHJpY2FzXG4gKlxuICogUmVzcG9uc8OhdmVsIHBvciBjb2xldGFyIGUgZXhwb3IgbcOpdHJpY2FzIGRhIGFwbGljYcOnw6NvXG4gKiB1dGlsaXphbmRvIG8gUHJvbWV0aGV1cyBDbGllbnRcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE1ldHJpY3NTZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSByZWdpc3RlcjogY2xpZW50LlJlZ2lzdHJ5O1xuICBwcml2YXRlIHJlYWRvbmx5IGh0dHBSZXF1ZXN0c1RvdGFsOiBjbGllbnQuQ291bnRlcjtcbiAgcHJpdmF0ZSByZWFkb25seSBodHRwUmVxdWVzdER1cmF0aW9uOiBjbGllbnQuSGlzdG9ncmFtO1xuICBwcml2YXRlIHJlYWRvbmx5IGh0dHBSZXF1ZXN0c0luUHJvZ3Jlc3M6IGNsaWVudC5HYXVnZTtcbiAgcHJpdmF0ZSByZWFkb25seSBkYXRhYmFzZVF1ZXJpZXNUb3RhbDogY2xpZW50LkNvdW50ZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgZGF0YWJhc2VRdWVyeUR1cmF0aW9uOiBjbGllbnQuSGlzdG9ncmFtO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8vIENyaWFyIHJlZ2lzdHJvIGRlIG3DqXRyaWNhc1xuICAgIHRoaXMucmVnaXN0ZXIgPSBuZXcgY2xpZW50LlJlZ2lzdHJ5KCk7XG5cbiAgICAvLyBBZGljaW9uYXIgbcOpdHJpY2FzIHBhZHLDo28gZG8gTm9kZS5qc1xuICAgIGNsaWVudC5jb2xsZWN0RGVmYXVsdE1ldHJpY3MoeyByZWdpc3RlcjogdGhpcy5yZWdpc3RlciB9KTtcblxuICAgIC8vIENvbnRhZG9yIGRlIHJlcXVpc2nDp8O1ZXMgSFRUUFxuICAgIHRoaXMuaHR0cFJlcXVlc3RzVG90YWwgPSBuZXcgY2xpZW50LkNvdW50ZXIoe1xuICAgICAgbmFtZTogJ2h0dHBfcmVxdWVzdHNfdG90YWwnLFxuICAgICAgaGVscDogJ1RvdGFsIGRlIHJlcXVpc2nDp8O1ZXMgSFRUUCcsXG4gICAgICBsYWJlbE5hbWVzOiBbJ21ldGhvZCcsICdyb3V0ZScsICdzdGF0dXNfY29kZSddLFxuICAgICAgcmVnaXN0ZXJzOiBbdGhpcy5yZWdpc3Rlcl0sXG4gICAgfSk7XG5cbiAgICAvLyBIaXN0b2dyYW1hIGRlIGR1cmHDp8OjbyBkYXMgcmVxdWlzacOnw7VlcyBIVFRQXG4gICAgdGhpcy5odHRwUmVxdWVzdER1cmF0aW9uID0gbmV3IGNsaWVudC5IaXN0b2dyYW0oe1xuICAgICAgbmFtZTogJ2h0dHBfcmVxdWVzdF9kdXJhdGlvbl9zZWNvbmRzJyxcbiAgICAgIGhlbHA6ICdEdXJhw6fDo28gZGFzIHJlcXVpc2nDp8O1ZXMgSFRUUCBlbSBzZWd1bmRvcycsXG4gICAgICBsYWJlbE5hbWVzOiBbJ21ldGhvZCcsICdyb3V0ZScsICdzdGF0dXNfY29kZSddLFxuICAgICAgYnVja2V0czogWzAuMDEsIDAuMDUsIDAuMSwgMC41LCAxLCAyLCA1LCAxMF0sXG4gICAgICByZWdpc3RlcnM6IFt0aGlzLnJlZ2lzdGVyXSxcbiAgICB9KTtcblxuICAgIC8vIEdhdWdlIGRlIHJlcXVpc2nDp8O1ZXMgZW0gYW5kYW1lbnRvXG4gICAgdGhpcy5odHRwUmVxdWVzdHNJblByb2dyZXNzID0gbmV3IGNsaWVudC5HYXVnZSh7XG4gICAgICBuYW1lOiAnaHR0cF9yZXF1ZXN0c19pbl9wcm9ncmVzcycsXG4gICAgICBoZWxwOiAnTsO6bWVybyBkZSByZXF1aXNpw6fDtWVzIEhUVFAgZW0gYW5kYW1lbnRvJyxcbiAgICAgIGxhYmVsTmFtZXM6IFsnbWV0aG9kJywgJ3JvdXRlJ10sXG4gICAgICByZWdpc3RlcnM6IFt0aGlzLnJlZ2lzdGVyXSxcbiAgICB9KTtcblxuICAgIC8vIENvbnRhZG9yIGRlIGNvbnN1bHRhcyBhbyBiYW5jbyBkZSBkYWRvc1xuICAgIHRoaXMuZGF0YWJhc2VRdWVyaWVzVG90YWwgPSBuZXcgY2xpZW50LkNvdW50ZXIoe1xuICAgICAgbmFtZTogJ2RhdGFiYXNlX3F1ZXJpZXNfdG90YWwnLFxuICAgICAgaGVscDogJ1RvdGFsIGRlIGNvbnN1bHRhcyBhbyBiYW5jbyBkZSBkYWRvcycsXG4gICAgICBsYWJlbE5hbWVzOiBbJ2VudGl0eScsICdvcGVyYXRpb24nXSxcbiAgICAgIHJlZ2lzdGVyczogW3RoaXMucmVnaXN0ZXJdLFxuICAgIH0pO1xuXG4gICAgLy8gSGlzdG9ncmFtYSBkZSBkdXJhw6fDo28gZGFzIGNvbnN1bHRhcyBhbyBiYW5jbyBkZSBkYWRvc1xuICAgIHRoaXMuZGF0YWJhc2VRdWVyeUR1cmF0aW9uID0gbmV3IGNsaWVudC5IaXN0b2dyYW0oe1xuICAgICAgbmFtZTogJ2RhdGFiYXNlX3F1ZXJ5X2R1cmF0aW9uX3NlY29uZHMnLFxuICAgICAgaGVscDogJ0R1cmHDp8OjbyBkYXMgY29uc3VsdGFzIGFvIGJhbmNvIGRlIGRhZG9zIGVtIHNlZ3VuZG9zJyxcbiAgICAgIGxhYmVsTmFtZXM6IFsnZW50aXR5JywgJ29wZXJhdGlvbiddLFxuICAgICAgYnVja2V0czogWzAuMDAxLCAwLjAwNSwgMC4wMSwgMC4wNSwgMC4xLCAwLjUsIDFdLFxuICAgICAgcmVnaXN0ZXJzOiBbdGhpcy5yZWdpc3Rlcl0sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogSW5jcmVtZW50YSBvIGNvbnRhZG9yIGRlIHJlcXVpc2nDp8O1ZXMgSFRUUFxuICAgKi9cbiAgcmVjb3JkSHR0cFJlcXVlc3QobWV0aG9kOiBzdHJpbmcsIHJvdXRlOiBzdHJpbmcsIHN0YXR1c0NvZGU6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuaHR0cFJlcXVlc3RzVG90YWwuaW5jKHtcbiAgICAgIG1ldGhvZCxcbiAgICAgIHJvdXRlLFxuICAgICAgc3RhdHVzX2NvZGU6IHN0YXR1c0NvZGUudG9TdHJpbmcoKSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RyYSBhIGR1cmHDp8OjbyBkZSB1bWEgcmVxdWlzacOnw6NvIEhUVFBcbiAgICovXG4gIHJlY29yZEh0dHBSZXF1ZXN0RHVyYXRpb24oXG4gICAgbWV0aG9kOiBzdHJpbmcsXG4gICAgcm91dGU6IHN0cmluZyxcbiAgICBzdGF0dXNDb2RlOiBudW1iZXIsXG4gICAgZHVyYXRpb25TZWNvbmRzOiBudW1iZXIsXG4gICk6IHZvaWQge1xuICAgIHRoaXMuaHR0cFJlcXVlc3REdXJhdGlvbi5vYnNlcnZlKFxuICAgICAgeyBtZXRob2QsIHJvdXRlLCBzdGF0dXNfY29kZTogc3RhdHVzQ29kZS50b1N0cmluZygpIH0sXG4gICAgICBkdXJhdGlvblNlY29uZHMsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbmNyZW1lbnRhIG8gY29udGFkb3IgZGUgcmVxdWlzacOnw7VlcyBIVFRQIGVtIGFuZGFtZW50b1xuICAgKi9cbiAgaW5jcmVtZW50SHR0cFJlcXVlc3RzSW5Qcm9ncmVzcyhtZXRob2Q6IHN0cmluZywgcm91dGU6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuaHR0cFJlcXVlc3RzSW5Qcm9ncmVzcy5pbmMoeyBtZXRob2QsIHJvdXRlIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIERlY3JlbWVudGEgbyBjb250YWRvciBkZSByZXF1aXNpw6fDtWVzIEhUVFAgZW0gYW5kYW1lbnRvXG4gICAqL1xuICBkZWNyZW1lbnRIdHRwUmVxdWVzdHNJblByb2dyZXNzKG1ldGhvZDogc3RyaW5nLCByb3V0ZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5odHRwUmVxdWVzdHNJblByb2dyZXNzLmRlYyh7IG1ldGhvZCwgcm91dGUgfSk7XG4gIH1cblxuICAvKipcbiAgICogSW5jcmVtZW50YSBvIGNvbnRhZG9yIGRlIGNvbnN1bHRhcyBhbyBiYW5jbyBkZSBkYWRvc1xuICAgKi9cbiAgcmVjb3JkRGF0YWJhc2VRdWVyeShlbnRpdHk6IHN0cmluZywgb3BlcmF0aW9uOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmRhdGFiYXNlUXVlcmllc1RvdGFsLmluYyh7IGVudGl0eSwgb3BlcmF0aW9uIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdHJhIGEgZHVyYcOnw6NvIGRlIHVtYSBjb25zdWx0YSBhbyBiYW5jbyBkZSBkYWRvc1xuICAgKi9cbiAgcmVjb3JkRGF0YWJhc2VRdWVyeUR1cmF0aW9uKFxuICAgIGVudGl0eTogc3RyaW5nLFxuICAgIG9wZXJhdGlvbjogc3RyaW5nLFxuICAgIGR1cmF0aW9uU2Vjb25kczogbnVtYmVyLFxuICApOiB2b2lkIHtcbiAgICB0aGlzLmRhdGFiYXNlUXVlcnlEdXJhdGlvbi5vYnNlcnZlKHsgZW50aXR5LCBvcGVyYXRpb24gfSwgZHVyYXRpb25TZWNvbmRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRvcm5hIHRvZGFzIGFzIG3DqXRyaWNhcyBubyBmb3JtYXRvIGRvIFByb21ldGhldXNcbiAgICovXG4gIGFzeW5jIGdldE1ldHJpY3MoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gdGhpcy5yZWdpc3Rlci5tZXRyaWNzKCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0b3JuYSBvIHJlZ2lzdHJvIGRlIG3DqXRyaWNhc1xuICAgKi9cbiAgZ2V0UmVnaXN0ZXIoKTogY2xpZW50LlJlZ2lzdHJ5IHtcbiAgICByZXR1cm4gdGhpcy5yZWdpc3RlcjtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9