5d396f4bebe7e1f8beed2de804ba1a62
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var ComposicaoFamiliarController_1;
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", { value: true });
exports.ComposicaoFamiliarController = void 0;
const common_1 = require("@nestjs/common");
const swagger_1 = require("@nestjs/swagger");
const jwt_auth_guard_1 = require("../../../auth/guards/jwt-auth.guard");
const requires_permission_decorator_1 = require("../../../auth/decorators/requires-permission.decorator");
const user_permission_entity_1 = require("../../../entities/user-permission.entity");
const api_error_response_dto_1 = require("../../../shared/dtos/api-error-response.dto");
const create_composicao_familiar_dto_1 = require("../dto/create-composicao-familiar.dto");
const update_composicao_familiar_dto_1 = require("../dto/update-composicao-familiar.dto");
const composicao_familiar_response_dto_1 = require("../dto/composicao-familiar-response.dto");
const composicao_familiar_service_1 = require("../services/composicao-familiar.service");
const cidadao_audit_interceptor_1 = require("../interceptors/cidadao-audit.interceptor");
const common_2 = require("@nestjs/common");
/**
 * Controlador de Composição Familiar
 *
 * Responsável por gerenciar as rotas relacionadas aos membros da composição familiar dos cidadãos
 */
let ComposicaoFamiliarController = ComposicaoFamiliarController_1 = class ComposicaoFamiliarController {
    composicaoFamiliarService;
    logger = new common_1.Logger(ComposicaoFamiliarController_1.name);
    constructor(composicaoFamiliarService) {
        this.composicaoFamiliarService = composicaoFamiliarService;
    }
    /**
     * Cria um novo membro da composição familiar
     */
    async create(createComposicaoFamiliarDto, req) {
        const startTime = Date.now();
        const requestId = `CF-CREATE-${Date.now()}`;
        this.logger.log(`[${requestId}] Início da criação de membro da composição familiar`);
        try {
            const result = await this.composicaoFamiliarService.create(createComposicaoFamiliarDto, req?.user?.id);
            const totalTime = Date.now() - startTime;
            if (totalTime > 500) {
                this.logger.warn(`[${requestId}] Operação lenta (create): ${totalTime}ms`);
            }
            else {
                this.logger.log(`[${requestId}] Operação concluída em ${totalTime}ms`);
            }
            return result;
        }
        catch (error) {
            const totalTime = Date.now() - startTime;
            this.logger.error(`[${requestId}] Erro em ${totalTime}ms: ${error.message}`);
            throw error;
        }
    }
    /**
     * Lista membros da composição familiar por cidadão
     */
    async findByCidadao(cidadaoId, page, limit) {
        const startTime = Date.now();
        const requestId = `CF-LIST-${cidadaoId.substring(0, 8)}-${Date.now()}`;
        this.logger.log(`[${requestId}] Início da listagem de composição familiar`);
        try {
            const result = await this.composicaoFamiliarService.findByCidadao(cidadaoId, { page, limit });
            const totalTime = Date.now() - startTime;
            if (totalTime > 300) {
                this.logger.warn(`[${requestId}] Operação lenta (findByCidadao): ${totalTime}ms`);
            }
            else {
                this.logger.log(`[${requestId}] Operação concluída em ${totalTime}ms`);
            }
            return result;
        }
        catch (error) {
            const totalTime = Date.now() - startTime;
            this.logger.error(`[${requestId}] Erro em ${totalTime}ms: ${error.message}`);
            throw error;
        }
    }
    /**
     * Busca um membro específico da composição familiar
     */
    async findOne(id) {
        const startTime = Date.now();
        const requestId = `CF-GET-${id.substring(0, 8)}-${Date.now()}`;
        this.logger.log(`[${requestId}] Início da busca de membro da composição familiar`);
        try {
            const result = await this.composicaoFamiliarService.findOne(id);
            const totalTime = Date.now() - startTime;
            if (totalTime > 200) {
                this.logger.warn(`[${requestId}] Operação lenta (findOne): ${totalTime}ms`);
            }
            else {
                this.logger.log(`[${requestId}] Operação concluída em ${totalTime}ms`);
            }
            return result;
        }
        catch (error) {
            const totalTime = Date.now() - startTime;
            this.logger.error(`[${requestId}] Erro em ${totalTime}ms: ${error.message}`);
            throw error;
        }
    }
    /**
     * Atualiza um membro da composição familiar
     */
    async update(id, updateComposicaoFamiliarDto, req) {
        const startTime = Date.now();
        const requestId = `CF-UPDATE-${id.substring(0, 8)}-${Date.now()}`;
        this.logger.log(`[${requestId}] Início da atualização de membro da composição familiar`);
        try {
            const result = await this.composicaoFamiliarService.update(id, updateComposicaoFamiliarDto, req?.user?.id);
            const totalTime = Date.now() - startTime;
            if (totalTime > 500) {
                this.logger.warn(`[${requestId}] Operação lenta (update): ${totalTime}ms`);
            }
            else {
                this.logger.log(`[${requestId}] Operação concluída em ${totalTime}ms`);
            }
            return result;
        }
        catch (error) {
            const totalTime = Date.now() - startTime;
            this.logger.error(`[${requestId}] Erro em ${totalTime}ms: ${error.message}`);
            throw error;
        }
    }
    /**
     * Remove um membro da composição familiar
     */
    async remove(id, req) {
        const startTime = Date.now();
        const requestId = `CF-DELETE-${id.substring(0, 8)}-${Date.now()}`;
        this.logger.log(`[${requestId}] Início da remoção de membro da composição familiar`);
        try {
            await this.composicaoFamiliarService.remove(id, req?.user?.id);
            const totalTime = Date.now() - startTime;
            if (totalTime > 300) {
                this.logger.warn(`[${requestId}] Operação lenta (remove): ${totalTime}ms`);
            }
            else {
                this.logger.log(`[${requestId}] Operação concluída em ${totalTime}ms`);
            }
            return { message: 'Membro da composição familiar removido com sucesso' };
        }
        catch (error) {
            const totalTime = Date.now() - startTime;
            this.logger.error(`[${requestId}] Erro em ${totalTime}ms: ${error.message}`);
            throw error;
        }
    }
    /**
     * Busca membros da composição familiar por CPF
     */
    async findByCpf(cpf) {
        const startTime = Date.now();
        const requestId = `CF-CPF-${cpf.substring(0, 4)}-${Date.now()}`;
        this.logger.log(`[${requestId}] Início da busca por CPF`);
        try {
            const result = await this.composicaoFamiliarService.findByCpf(cpf);
            const totalTime = Date.now() - startTime;
            if (totalTime > 200) {
                this.logger.warn(`[${requestId}] Operação lenta (findByCpf): ${totalTime}ms`);
            }
            else {
                this.logger.log(`[${requestId}] Operação concluída em ${totalTime}ms`);
            }
            return result;
        }
        catch (error) {
            const totalTime = Date.now() - startTime;
            this.logger.error(`[${requestId}] Erro em ${totalTime}ms: ${error.message}`);
            throw error;
        }
    }
};
exports.ComposicaoFamiliarController = ComposicaoFamiliarController;
__decorate([
    (0, common_1.Post)(),
    (0, requires_permission_decorator_1.RequiresPermission)({
        permissionName: 'cidadao.editar',
        scopeType: user_permission_entity_1.ScopeType.UNIT,
        scopeIdExpression: 'cidadao.unidadeId',
    }),
    (0, swagger_1.ApiOperation)({
        summary: 'Criar membro da composição familiar',
        description: 'Adiciona um novo membro à composição familiar de um cidadão.',
    }),
    (0, swagger_1.ApiOkResponse)({
        description: 'Membro da composição familiar criado com sucesso',
        type: composicao_familiar_response_dto_1.ComposicaoFamiliarResponseDto,
    }),
    (0, swagger_1.ApiBadRequestResponse)({
        description: 'Dados inválidos fornecidos',
        type: api_error_response_dto_1.ApiErrorResponse,
    }),
    (0, swagger_1.ApiConflictResponse)({
        description: 'CPF já cadastrado na composição familiar',
        type: api_error_response_dto_1.ApiErrorResponse,
    }),
    (0, swagger_1.ApiNotFoundResponse)({
        description: 'Cidadão não encontrado',
        type: api_error_response_dto_1.ApiErrorResponse,
    }),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, common_1.Request)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof create_composicao_familiar_dto_1.CreateComposicaoFamiliarDto !== "undefined" && create_composicao_familiar_dto_1.CreateComposicaoFamiliarDto) === "function" ? _b : Object, Object]),
    __metadata("design:returntype", typeof (_c = typeof Promise !== "undefined" && Promise) === "function" ? _c : Object)
], ComposicaoFamiliarController.prototype, "create", null);
__decorate([
    (0, common_1.Get)('cidadao/:cidadaoId'),
    (0, requires_permission_decorator_1.RequiresPermission)({
        permissionName: 'cidadao.visualizar',
        scopeType: user_permission_entity_1.ScopeType.UNIT,
        scopeIdExpression: 'cidadao.unidadeId',
    }),
    (0, swagger_1.ApiOperation)({
        summary: 'Listar membros da composição familiar',
        description: 'Retorna uma lista paginada dos membros da composição familiar de um cidadão.',
    }),
    (0, swagger_1.ApiParam)({
        name: 'cidadaoId',
        description: 'ID do cidadão',
        type: 'string',
        format: 'uuid',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'page',
        required: false,
        type: Number,
        description: 'Número da página (padrão: 1)',
        example: 1,
    }),
    (0, swagger_1.ApiQuery)({
        name: 'limit',
        required: false,
        type: Number,
        description: 'Itens por página (padrão: 10, máximo: 100)',
        example: 10,
    }),
    (0, swagger_1.ApiOkResponse)({
        description: 'Lista de membros da composição familiar retornada com sucesso',
        type: composicao_familiar_response_dto_1.ComposicaoFamiliarPaginatedResponseDto,
    }),
    (0, swagger_1.ApiNotFoundResponse)({
        description: 'Cidadão não encontrado',
        type: api_error_response_dto_1.ApiErrorResponse,
    }),
    __param(0, (0, common_1.Param)('cidadaoId', common_1.ParseUUIDPipe)),
    __param(1, (0, common_1.Query)('page', new common_1.DefaultValuePipe(1), common_1.ParseIntPipe)),
    __param(2, (0, common_1.Query)('limit', new common_1.DefaultValuePipe(10), common_1.ParseIntPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Number, Number]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], ComposicaoFamiliarController.prototype, "findByCidadao", null);
__decorate([
    (0, common_1.Get)(':id'),
    (0, requires_permission_decorator_1.RequiresPermission)({
        permissionName: 'cidadao.visualizar',
        scopeType: user_permission_entity_1.ScopeType.UNIT,
        scopeIdExpression: 'composicaoFamiliar.cidadao.unidadeId',
    }),
    (0, swagger_1.ApiOperation)({
        summary: 'Buscar membro da composição familiar',
        description: 'Retorna os dados de um membro específico da composição familiar.',
    }),
    (0, swagger_1.ApiParam)({
        name: 'id',
        description: 'ID do membro da composição familiar',
        type: 'string',
        format: 'uuid',
    }),
    (0, swagger_1.ApiOkResponse)({
        description: 'Membro da composição familiar encontrado',
        type: composicao_familiar_response_dto_1.ComposicaoFamiliarResponseDto,
    }),
    (0, swagger_1.ApiNotFoundResponse)({
        description: 'Membro da composição familiar não encontrado',
        type: api_error_response_dto_1.ApiErrorResponse,
    }),
    __param(0, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], ComposicaoFamiliarController.prototype, "findOne", null);
__decorate([
    (0, common_1.Put)(':id'),
    (0, requires_permission_decorator_1.RequiresPermission)({
        permissionName: 'cidadao.editar',
        scopeType: user_permission_entity_1.ScopeType.UNIT,
        scopeIdExpression: 'composicaoFamiliar.cidadao.unidadeId',
    }),
    (0, swagger_1.ApiOperation)({
        summary: 'Atualizar membro da composição familiar',
        description: 'Atualiza os dados de um membro da composição familiar.',
    }),
    (0, swagger_1.ApiParam)({
        name: 'id',
        description: 'ID do membro da composição familiar',
        type: 'string',
        format: 'uuid',
    }),
    (0, swagger_1.ApiOkResponse)({
        description: 'Membro da composição familiar atualizado com sucesso',
        type: composicao_familiar_response_dto_1.ComposicaoFamiliarResponseDto,
    }),
    (0, swagger_1.ApiBadRequestResponse)({
        description: 'Dados inválidos fornecidos',
        type: api_error_response_dto_1.ApiErrorResponse,
    }),
    (0, swagger_1.ApiConflictResponse)({
        description: 'CPF já cadastrado na composição familiar',
        type: api_error_response_dto_1.ApiErrorResponse,
    }),
    (0, swagger_1.ApiNotFoundResponse)({
        description: 'Membro da composição familiar não encontrado',
        type: api_error_response_dto_1.ApiErrorResponse,
    }),
    __param(0, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __param(1, (0, common_1.Body)()),
    __param(2, (0, common_1.Request)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, typeof (_f = typeof update_composicao_familiar_dto_1.UpdateComposicaoFamiliarDto !== "undefined" && update_composicao_familiar_dto_1.UpdateComposicaoFamiliarDto) === "function" ? _f : Object, Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], ComposicaoFamiliarController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)(':id'),
    (0, requires_permission_decorator_1.RequiresPermission)({
        permissionName: 'cidadao.editar',
        scopeType: user_permission_entity_1.ScopeType.UNIT,
        scopeIdExpression: 'composicaoFamiliar.cidadao.unidadeId',
    }),
    (0, swagger_1.ApiOperation)({
        summary: 'Remover membro da composição familiar',
        description: 'Remove um membro da composição familiar (soft delete).',
    }),
    (0, swagger_1.ApiParam)({
        name: 'id',
        description: 'ID do membro da composição familiar',
        type: 'string',
        format: 'uuid',
    }),
    (0, swagger_1.ApiOkResponse)({
        description: 'Membro da composição familiar removido com sucesso',
    }),
    (0, swagger_1.ApiNotFoundResponse)({
        description: 'Membro da composição familiar não encontrado',
        type: api_error_response_dto_1.ApiErrorResponse,
    }),
    __param(0, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __param(1, (0, common_1.Request)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], ComposicaoFamiliarController.prototype, "remove", null);
__decorate([
    (0, common_1.Get)('buscar/cpf/:cpf'),
    (0, requires_permission_decorator_1.RequiresPermission)({
        permissionName: 'cidadao.visualizar',
        scopeType: user_permission_entity_1.ScopeType.UNIT,
        scopeIdExpression: 'user.unidadeId',
    }),
    (0, swagger_1.ApiOperation)({
        summary: 'Buscar membro por CPF',
        description: 'Busca membros da composição familiar pelo CPF.',
    }),
    (0, swagger_1.ApiParam)({
        name: 'cpf',
        description: 'CPF do membro (apenas números)',
        type: 'string',
        example: '12345678901',
    }),
    (0, swagger_1.ApiOkResponse)({
        description: 'Membros encontrados',
        type: [composicao_familiar_response_dto_1.ComposicaoFamiliarResponseDto],
    }),
    __param(0, (0, common_1.Param)('cpf')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_j = typeof Promise !== "undefined" && Promise) === "function" ? _j : Object)
], ComposicaoFamiliarController.prototype, "findByCpf", null);
exports.ComposicaoFamiliarController = ComposicaoFamiliarController = ComposicaoFamiliarController_1 = __decorate([
    (0, swagger_1.ApiTags)('Cidadão'),
    (0, swagger_1.ApiExtraModels)(composicao_familiar_response_dto_1.ComposicaoFamiliarResponseDto, composicao_familiar_response_dto_1.ComposicaoFamiliarPaginatedResponseDto),
    (0, common_1.Controller)('composicao-familiar'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard),
    (0, swagger_1.ApiBearerAuth)(),
    (0, common_2.UseInterceptors)(cidadao_audit_interceptor_1.CidadaoAuditInterceptor),
    __metadata("design:paramtypes", [typeof (_a = typeof composicao_familiar_service_1.ComposicaoFamiliarService !== "undefined" && composicao_familiar_service_1.ComposicaoFamiliarService) === "function" ? _a : Object])
], ComposicaoFamiliarController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGNpZGFkYW9cXGNvbnRyb2xsZXJzXFxjb21wb3NpY2FvLWZhbWlsaWFyLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0Fld0I7QUFDeEIsNkNBWXlCO0FBQ3pCLHdFQUFtRTtBQUNuRSwwR0FBNEY7QUFDNUYscUZBQXFFO0FBQ3JFLHdGQUErRTtBQUMvRSwwRkFBb0Y7QUFDcEYsMEZBQW9GO0FBQ3BGLDhGQUdpRDtBQUNqRCx5RkFBb0Y7QUFDcEYseUZBQW9GO0FBQ3BGLDJDQUFpRDtBQUVqRDs7OztHQUlHO0FBVUksSUFBTSw0QkFBNEIsb0NBQWxDLE1BQU0sNEJBQTRCO0lBSXBCO0lBSEYsTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLDhCQUE0QixDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXhFLFlBQ21CLHlCQUFvRDtRQUFwRCw4QkFBeUIsR0FBekIseUJBQXlCLENBQTJCO0lBQ3BFLENBQUM7SUFFSjs7T0FFRztJQTJCRyxBQUFOLEtBQUssQ0FBQyxNQUFNLENBQ0YsMkJBQXdELEVBQ3JELEdBQUc7UUFFZCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDN0IsTUFBTSxTQUFTLEdBQUcsYUFBYSxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQztRQUM1QyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FDYixJQUFJLFNBQVMsc0RBQXNELENBQ3BFLENBQUM7UUFFRixJQUFJLENBQUM7WUFDSCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxNQUFNLENBQ3hELDJCQUEyQixFQUMzQixHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FDZCxDQUFDO1lBRUYsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLFNB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RUFBRSxxQkFBcUI7UUFDbEMsSUFBSSxFQUFFLENBQUMsZ0VBQTZCLENBQUM7S0FDdEMsQ0FBQztJQUVDLFdBQUEsSUFBQSxjQUFLLEVBQUMsS0FBSyxDQUFDLENBQUE7Ozt3REFDWixPQUFPLG9CQUFQLE9BQU87NkRBeUJUO3VDQW5ZVSw0QkFBNEI7SUFUeEMsSUFBQSxpQkFBTyxFQUFDLFNBQVMsQ0FBQztJQUNsQixJQUFBLHdCQUFjLEVBQ2IsZ0VBQTZCLEVBQzdCLHlFQUFzQyxDQUN2QztJQUNBLElBQUEsbUJBQVUsRUFBQyxxQkFBcUIsQ0FBQztJQUNqQyxJQUFBLGtCQUFTLEVBQUMsNkJBQVksQ0FBQztJQUN2QixJQUFBLHVCQUFhLEdBQUU7SUFDZixJQUFBLHdCQUFlLEVBQUMsbURBQXVCLENBQUM7eURBS08sdURBQXlCLG9CQUF6Qix1REFBeUI7R0FKNUQsNEJBQTRCLENBb1l4QyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xcY2lkYWRhb1xcY29udHJvbGxlcnNcXGNvbXBvc2ljYW8tZmFtaWxpYXIuY29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb250cm9sbGVyLFxuICBHZXQsXG4gIFBvc3QsXG4gIEJvZHksXG4gIFBhcmFtLFxuICBQdXQsXG4gIERlbGV0ZSxcbiAgUGFyc2VVVUlEUGlwZSxcbiAgVXNlR3VhcmRzLFxuICBSZXF1ZXN0LFxuICBMb2dnZXIsXG4gIFF1ZXJ5LFxuICBEZWZhdWx0VmFsdWVQaXBlLFxuICBQYXJzZUludFBpcGUsXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7XG4gIEFwaVRhZ3MsXG4gIEFwaU9wZXJhdGlvbixcbiAgQXBpUmVzcG9uc2UsXG4gIEFwaUJlYXJlckF1dGgsXG4gIEFwaVBhcmFtLFxuICBBcGlPa1Jlc3BvbnNlLFxuICBBcGlOb3RGb3VuZFJlc3BvbnNlLFxuICBBcGlCYWRSZXF1ZXN0UmVzcG9uc2UsXG4gIEFwaUNvbmZsaWN0UmVzcG9uc2UsXG4gIEFwaVF1ZXJ5LFxuICBBcGlFeHRyYU1vZGVscyxcbn0gZnJvbSAnQG5lc3Rqcy9zd2FnZ2VyJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4uLy4uLy4uL2F1dGgvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IFJlcXVpcmVzUGVybWlzc2lvbiB9IGZyb20gJy4uLy4uLy4uL2F1dGgvZGVjb3JhdG9ycy9yZXF1aXJlcy1wZXJtaXNzaW9uLmRlY29yYXRvcic7XG5pbXBvcnQgeyBTY29wZVR5cGUgfSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy91c2VyLXBlcm1pc3Npb24uZW50aXR5JztcbmltcG9ydCB7IEFwaUVycm9yUmVzcG9uc2UgfSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvZHRvcy9hcGktZXJyb3ItcmVzcG9uc2UuZHRvJztcbmltcG9ydCB7IENyZWF0ZUNvbXBvc2ljYW9GYW1pbGlhckR0byB9IGZyb20gJy4uL2R0by9jcmVhdGUtY29tcG9zaWNhby1mYW1pbGlhci5kdG8nO1xuaW1wb3J0IHsgVXBkYXRlQ29tcG9zaWNhb0ZhbWlsaWFyRHRvIH0gZnJvbSAnLi4vZHRvL3VwZGF0ZS1jb21wb3NpY2FvLWZhbWlsaWFyLmR0byc7XG5pbXBvcnQge1xuICBDb21wb3NpY2FvRmFtaWxpYXJSZXNwb25zZUR0byxcbiAgQ29tcG9zaWNhb0ZhbWlsaWFyUGFnaW5hdGVkUmVzcG9uc2VEdG8sXG59IGZyb20gJy4uL2R0by9jb21wb3NpY2FvLWZhbWlsaWFyLXJlc3BvbnNlLmR0byc7XG5pbXBvcnQgeyBDb21wb3NpY2FvRmFtaWxpYXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvY29tcG9zaWNhby1mYW1pbGlhci5zZXJ2aWNlJztcbmltcG9ydCB7IENpZGFkYW9BdWRpdEludGVyY2VwdG9yIH0gZnJvbSAnLi4vaW50ZXJjZXB0b3JzL2NpZGFkYW8tYXVkaXQuaW50ZXJjZXB0b3InO1xuaW1wb3J0IHsgVXNlSW50ZXJjZXB0b3JzIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuXG4vKipcbiAqIENvbnRyb2xhZG9yIGRlIENvbXBvc2nDp8OjbyBGYW1pbGlhclxuICpcbiAqIFJlc3BvbnPDoXZlbCBwb3IgZ2VyZW5jaWFyIGFzIHJvdGFzIHJlbGFjaW9uYWRhcyBhb3MgbWVtYnJvcyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXIgZG9zIGNpZGFkw6Nvc1xuICovXG5AQXBpVGFncygnQ2lkYWTDo28nKVxuQEFwaUV4dHJhTW9kZWxzKFxuICBDb21wb3NpY2FvRmFtaWxpYXJSZXNwb25zZUR0byxcbiAgQ29tcG9zaWNhb0ZhbWlsaWFyUGFnaW5hdGVkUmVzcG9uc2VEdG8sXG4pXG5AQ29udHJvbGxlcignY29tcG9zaWNhby1mYW1pbGlhcicpXG5AVXNlR3VhcmRzKEp3dEF1dGhHdWFyZClcbkBBcGlCZWFyZXJBdXRoKClcbkBVc2VJbnRlcmNlcHRvcnMoQ2lkYWRhb0F1ZGl0SW50ZXJjZXB0b3IpXG5leHBvcnQgY2xhc3MgQ29tcG9zaWNhb0ZhbWlsaWFyQ29udHJvbGxlciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihDb21wb3NpY2FvRmFtaWxpYXJDb250cm9sbGVyLm5hbWUpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZTogQ29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZSxcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBDcmlhIHVtIG5vdm8gbWVtYnJvIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhclxuICAgKi9cbiAgQFBvc3QoKVxuICBAUmVxdWlyZXNQZXJtaXNzaW9uKHtcbiAgICBwZXJtaXNzaW9uTmFtZTogJ2NpZGFkYW8uZWRpdGFyJyxcbiAgICBzY29wZVR5cGU6IFNjb3BlVHlwZS5VTklULFxuICAgIHNjb3BlSWRFeHByZXNzaW9uOiAnY2lkYWRhby51bmlkYWRlSWQnLFxuICB9KVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnQ3JpYXIgbWVtYnJvIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhcicsXG4gICAgZGVzY3JpcHRpb246ICdBZGljaW9uYSB1bSBub3ZvIG1lbWJybyDDoCBjb21wb3Npw6fDo28gZmFtaWxpYXIgZGUgdW0gY2lkYWTDo28uJyxcbiAgfSlcbiAgQEFwaU9rUmVzcG9uc2Uoe1xuICAgIGRlc2NyaXB0aW9uOiAnTWVtYnJvIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhciBjcmlhZG8gY29tIHN1Y2Vzc28nLFxuICAgIHR5cGU6IENvbXBvc2ljYW9GYW1pbGlhclJlc3BvbnNlRHRvLFxuICB9KVxuICBAQXBpQmFkUmVxdWVzdFJlc3BvbnNlKHtcbiAgICBkZXNjcmlwdGlvbjogJ0RhZG9zIGludsOhbGlkb3MgZm9ybmVjaWRvcycsXG4gICAgdHlwZTogQXBpRXJyb3JSZXNwb25zZSxcbiAgfSlcbiAgQEFwaUNvbmZsaWN0UmVzcG9uc2Uoe1xuICAgIGRlc2NyaXB0aW9uOiAnQ1BGIGrDoSBjYWRhc3RyYWRvIG5hIGNvbXBvc2nDp8OjbyBmYW1pbGlhcicsXG4gICAgdHlwZTogQXBpRXJyb3JSZXNwb25zZSxcbiAgfSlcbiAgQEFwaU5vdEZvdW5kUmVzcG9uc2Uoe1xuICAgIGRlc2NyaXB0aW9uOiAnQ2lkYWTDo28gbsOjbyBlbmNvbnRyYWRvJyxcbiAgICB0eXBlOiBBcGlFcnJvclJlc3BvbnNlLFxuICB9KVxuICBhc3luYyBjcmVhdGUoXG4gICAgQEJvZHkoKSBjcmVhdGVDb21wb3NpY2FvRmFtaWxpYXJEdG86IENyZWF0ZUNvbXBvc2ljYW9GYW1pbGlhckR0byxcbiAgICBAUmVxdWVzdCgpIHJlcSxcbiAgKTogUHJvbWlzZTxDb21wb3NpY2FvRmFtaWxpYXJSZXNwb25zZUR0bz4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgY29uc3QgcmVxdWVzdElkID0gYENGLUNSRUFURS0ke0RhdGUubm93KCl9YDtcbiAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICBgWyR7cmVxdWVzdElkfV0gSW7DrWNpbyBkYSBjcmlhw6fDo28gZGUgbWVtYnJvIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhcmAsXG4gICAgKTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNvbXBvc2ljYW9GYW1pbGlhclNlcnZpY2UuY3JlYXRlKFxuICAgICAgICBjcmVhdGVDb21wb3NpY2FvRmFtaWxpYXJEdG8sXG4gICAgICAgIHJlcT8udXNlcj8uaWQsXG4gICAgICApO1xuXG4gICAgICBjb25zdCB0b3RhbFRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgaWYgKHRvdGFsVGltZSA+IDUwMCkge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgICAgIGBbJHtyZXF1ZXN0SWR9XSBPcGVyYcOnw6NvIGxlbnRhIChjcmVhdGUpOiAke3RvdGFsVGltZX1tc2AsXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2coYFske3JlcXVlc3RJZH1dIE9wZXJhw6fDo28gY29uY2x1w61kYSBlbSAke3RvdGFsVGltZX1tc2ApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCB0b3RhbFRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBbJHtyZXF1ZXN0SWR9XSBFcnJvIGVtICR7dG90YWxUaW1lfW1zOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTGlzdGEgbWVtYnJvcyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXIgcG9yIGNpZGFkw6NvXG4gICAqL1xuICBAR2V0KCdjaWRhZGFvLzpjaWRhZGFvSWQnKVxuICBAUmVxdWlyZXNQZXJtaXNzaW9uKHtcbiAgICBwZXJtaXNzaW9uTmFtZTogJ2NpZGFkYW8udmlzdWFsaXphcicsXG4gICAgc2NvcGVUeXBlOiBTY29wZVR5cGUuVU5JVCxcbiAgICBzY29wZUlkRXhwcmVzc2lvbjogJ2NpZGFkYW8udW5pZGFkZUlkJyxcbiAgfSlcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0xpc3RhciBtZW1icm9zIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhcicsXG4gICAgZGVzY3JpcHRpb246XG4gICAgICAnUmV0b3JuYSB1bWEgbGlzdGEgcGFnaW5hZGEgZG9zIG1lbWJyb3MgZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyIGRlIHVtIGNpZGFkw6NvLicsXG4gIH0pXG4gIEBBcGlQYXJhbSh7XG4gICAgbmFtZTogJ2NpZGFkYW9JZCcsXG4gICAgZGVzY3JpcHRpb246ICdJRCBkbyBjaWRhZMOjbycsXG4gICAgdHlwZTogJ3N0cmluZycsXG4gICAgZm9ybWF0OiAndXVpZCcsXG4gIH0pXG4gIEBBcGlRdWVyeSh7XG4gICAgbmFtZTogJ3BhZ2UnLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgICB0eXBlOiBOdW1iZXIsXG4gICAgZGVzY3JpcHRpb246ICdOw7ptZXJvIGRhIHDDoWdpbmEgKHBhZHLDo286IDEpJyxcbiAgICBleGFtcGxlOiAxLFxuICB9KVxuICBAQXBpUXVlcnkoe1xuICAgIG5hbWU6ICdsaW1pdCcsXG4gICAgcmVxdWlyZWQ6IGZhbHNlLFxuICAgIHR5cGU6IE51bWJlcixcbiAgICBkZXNjcmlwdGlvbjogJ0l0ZW5zIHBvciBww6FnaW5hIChwYWRyw6NvOiAxMCwgbcOheGltbzogMTAwKScsXG4gICAgZXhhbXBsZTogMTAsXG4gIH0pXG4gIEBBcGlPa1Jlc3BvbnNlKHtcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgICdMaXN0YSBkZSBtZW1icm9zIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhciByZXRvcm5hZGEgY29tIHN1Y2Vzc28nLFxuICAgIHR5cGU6IENvbXBvc2ljYW9GYW1pbGlhclBhZ2luYXRlZFJlc3BvbnNlRHRvLFxuICB9KVxuICBAQXBpTm90Rm91bmRSZXNwb25zZSh7XG4gICAgZGVzY3JpcHRpb246ICdDaWRhZMOjbyBuw6NvIGVuY29udHJhZG8nLFxuICAgIHR5cGU6IEFwaUVycm9yUmVzcG9uc2UsXG4gIH0pXG4gIGFzeW5jIGZpbmRCeUNpZGFkYW8oXG4gICAgQFBhcmFtKCdjaWRhZGFvSWQnLCBQYXJzZVVVSURQaXBlKSBjaWRhZGFvSWQ6IHN0cmluZyxcbiAgICBAUXVlcnkoJ3BhZ2UnLCBuZXcgRGVmYXVsdFZhbHVlUGlwZSgxKSwgUGFyc2VJbnRQaXBlKSBwYWdlOiBudW1iZXIsXG4gICAgQFF1ZXJ5KCdsaW1pdCcsIG5ldyBEZWZhdWx0VmFsdWVQaXBlKDEwKSwgUGFyc2VJbnRQaXBlKSBsaW1pdDogbnVtYmVyLFxuICApOiBQcm9taXNlPENvbXBvc2ljYW9GYW1pbGlhclBhZ2luYXRlZFJlc3BvbnNlRHRvPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCByZXF1ZXN0SWQgPSBgQ0YtTElTVC0ke2NpZGFkYW9JZC5zdWJzdHJpbmcoMCwgOCl9LSR7RGF0ZS5ub3coKX1gO1xuICAgIHRoaXMubG9nZ2VyLmxvZyhgWyR7cmVxdWVzdElkfV0gSW7DrWNpbyBkYSBsaXN0YWdlbSBkZSBjb21wb3Npw6fDo28gZmFtaWxpYXJgKTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNvbXBvc2ljYW9GYW1pbGlhclNlcnZpY2UuZmluZEJ5Q2lkYWRhbyhcbiAgICAgICAgY2lkYWRhb0lkLFxuICAgICAgICB7IHBhZ2UsIGxpbWl0IH0sXG4gICAgICApO1xuXG4gICAgICBjb25zdCB0b3RhbFRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgaWYgKHRvdGFsVGltZSA+IDMwMCkge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgICAgIGBbJHtyZXF1ZXN0SWR9XSBPcGVyYcOnw6NvIGxlbnRhIChmaW5kQnlDaWRhZGFvKTogJHt0b3RhbFRpbWV9bXNgLFxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKGBbJHtyZXF1ZXN0SWR9XSBPcGVyYcOnw6NvIGNvbmNsdcOtZGEgZW0gJHt0b3RhbFRpbWV9bXNgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgdG90YWxUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgWyR7cmVxdWVzdElkfV0gRXJybyBlbSAke3RvdGFsVGltZX1tczogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICApO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhIHVtIG1lbWJybyBlc3BlY8OtZmljbyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXJcbiAgICovXG4gIEBHZXQoJzppZCcpXG4gIEBSZXF1aXJlc1Blcm1pc3Npb24oe1xuICAgIHBlcm1pc3Npb25OYW1lOiAnY2lkYWRhby52aXN1YWxpemFyJyxcbiAgICBzY29wZVR5cGU6IFNjb3BlVHlwZS5VTklULFxuICAgIHNjb3BlSWRFeHByZXNzaW9uOiAnY29tcG9zaWNhb0ZhbWlsaWFyLmNpZGFkYW8udW5pZGFkZUlkJyxcbiAgfSlcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0J1c2NhciBtZW1icm8gZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyJyxcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgICdSZXRvcm5hIG9zIGRhZG9zIGRlIHVtIG1lbWJybyBlc3BlY8OtZmljbyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXIuJyxcbiAgfSlcbiAgQEFwaVBhcmFtKHtcbiAgICBuYW1lOiAnaWQnLFxuICAgIGRlc2NyaXB0aW9uOiAnSUQgZG8gbWVtYnJvIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhcicsXG4gICAgdHlwZTogJ3N0cmluZycsXG4gICAgZm9ybWF0OiAndXVpZCcsXG4gIH0pXG4gIEBBcGlPa1Jlc3BvbnNlKHtcbiAgICBkZXNjcmlwdGlvbjogJ01lbWJybyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXIgZW5jb250cmFkbycsXG4gICAgdHlwZTogQ29tcG9zaWNhb0ZhbWlsaWFyUmVzcG9uc2VEdG8sXG4gIH0pXG4gIEBBcGlOb3RGb3VuZFJlc3BvbnNlKHtcbiAgICBkZXNjcmlwdGlvbjogJ01lbWJybyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXIgbsOjbyBlbmNvbnRyYWRvJyxcbiAgICB0eXBlOiBBcGlFcnJvclJlc3BvbnNlLFxuICB9KVxuICBhc3luYyBmaW5kT25lKFxuICAgIEBQYXJhbSgnaWQnLCBQYXJzZVVVSURQaXBlKSBpZDogc3RyaW5nLFxuICApOiBQcm9taXNlPENvbXBvc2ljYW9GYW1pbGlhclJlc3BvbnNlRHRvPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCByZXF1ZXN0SWQgPSBgQ0YtR0VULSR7aWQuc3Vic3RyaW5nKDAsIDgpfS0ke0RhdGUubm93KCl9YDtcbiAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICBgWyR7cmVxdWVzdElkfV0gSW7DrWNpbyBkYSBidXNjYSBkZSBtZW1icm8gZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyYCxcbiAgICApO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZS5maW5kT25lKGlkKTtcblxuICAgICAgY29uc3QgdG90YWxUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgIGlmICh0b3RhbFRpbWUgPiAyMDApIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybihcbiAgICAgICAgICBgWyR7cmVxdWVzdElkfV0gT3BlcmHDp8OjbyBsZW50YSAoZmluZE9uZSk6ICR7dG90YWxUaW1lfW1zYCxcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLmxvZyhgWyR7cmVxdWVzdElkfV0gT3BlcmHDp8OjbyBjb25jbHXDrWRhIGVtICR7dG90YWxUaW1lfW1zYCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IHRvdGFsVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYFske3JlcXVlc3RJZH1dIEVycm8gZW0gJHt0b3RhbFRpbWV9bXM6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBdHVhbGl6YSB1bSBtZW1icm8gZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyXG4gICAqL1xuICBAUHV0KCc6aWQnKVxuICBAUmVxdWlyZXNQZXJtaXNzaW9uKHtcbiAgICBwZXJtaXNzaW9uTmFtZTogJ2NpZGFkYW8uZWRpdGFyJyxcbiAgICBzY29wZVR5cGU6IFNjb3BlVHlwZS5VTklULFxuICAgIHNjb3BlSWRFeHByZXNzaW9uOiAnY29tcG9zaWNhb0ZhbWlsaWFyLmNpZGFkYW8udW5pZGFkZUlkJyxcbiAgfSlcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0F0dWFsaXphciBtZW1icm8gZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyJyxcbiAgICBkZXNjcmlwdGlvbjogJ0F0dWFsaXphIG9zIGRhZG9zIGRlIHVtIG1lbWJybyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXIuJyxcbiAgfSlcbiAgQEFwaVBhcmFtKHtcbiAgICBuYW1lOiAnaWQnLFxuICAgIGRlc2NyaXB0aW9uOiAnSUQgZG8gbWVtYnJvIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhcicsXG4gICAgdHlwZTogJ3N0cmluZycsXG4gICAgZm9ybWF0OiAndXVpZCcsXG4gIH0pXG4gIEBBcGlPa1Jlc3BvbnNlKHtcbiAgICBkZXNjcmlwdGlvbjogJ01lbWJybyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXIgYXR1YWxpemFkbyBjb20gc3VjZXNzbycsXG4gICAgdHlwZTogQ29tcG9zaWNhb0ZhbWlsaWFyUmVzcG9uc2VEdG8sXG4gIH0pXG4gIEBBcGlCYWRSZXF1ZXN0UmVzcG9uc2Uoe1xuICAgIGRlc2NyaXB0aW9uOiAnRGFkb3MgaW52w6FsaWRvcyBmb3JuZWNpZG9zJyxcbiAgICB0eXBlOiBBcGlFcnJvclJlc3BvbnNlLFxuICB9KVxuICBAQXBpQ29uZmxpY3RSZXNwb25zZSh7XG4gICAgZGVzY3JpcHRpb246ICdDUEYgasOhIGNhZGFzdHJhZG8gbmEgY29tcG9zacOnw6NvIGZhbWlsaWFyJyxcbiAgICB0eXBlOiBBcGlFcnJvclJlc3BvbnNlLFxuICB9KVxuICBAQXBpTm90Rm91bmRSZXNwb25zZSh7XG4gICAgZGVzY3JpcHRpb246ICdNZW1icm8gZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyIG7Do28gZW5jb250cmFkbycsXG4gICAgdHlwZTogQXBpRXJyb3JSZXNwb25zZSxcbiAgfSlcbiAgYXN5bmMgdXBkYXRlKFxuICAgIEBQYXJhbSgnaWQnLCBQYXJzZVVVSURQaXBlKSBpZDogc3RyaW5nLFxuICAgIEBCb2R5KCkgdXBkYXRlQ29tcG9zaWNhb0ZhbWlsaWFyRHRvOiBVcGRhdGVDb21wb3NpY2FvRmFtaWxpYXJEdG8sXG4gICAgQFJlcXVlc3QoKSByZXEsXG4gICk6IFByb21pc2U8Q29tcG9zaWNhb0ZhbWlsaWFyUmVzcG9uc2VEdG8+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHJlcXVlc3RJZCA9IGBDRi1VUERBVEUtJHtpZC5zdWJzdHJpbmcoMCwgOCl9LSR7RGF0ZS5ub3coKX1gO1xuICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgIGBbJHtyZXF1ZXN0SWR9XSBJbsOtY2lvIGRhIGF0dWFsaXphw6fDo28gZGUgbWVtYnJvIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhcmAsXG4gICAgKTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNvbXBvc2ljYW9GYW1pbGlhclNlcnZpY2UudXBkYXRlKFxuICAgICAgICBpZCxcbiAgICAgICAgdXBkYXRlQ29tcG9zaWNhb0ZhbWlsaWFyRHRvLFxuICAgICAgICByZXE/LnVzZXI/LmlkLFxuICAgICAgKTtcblxuICAgICAgY29uc3QgdG90YWxUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgIGlmICh0b3RhbFRpbWUgPiA1MDApIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybihcbiAgICAgICAgICBgWyR7cmVxdWVzdElkfV0gT3BlcmHDp8OjbyBsZW50YSAodXBkYXRlKTogJHt0b3RhbFRpbWV9bXNgLFxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKGBbJHtyZXF1ZXN0SWR9XSBPcGVyYcOnw6NvIGNvbmNsdcOtZGEgZW0gJHt0b3RhbFRpbWV9bXNgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgdG90YWxUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgWyR7cmVxdWVzdElkfV0gRXJybyBlbSAke3RvdGFsVGltZX1tczogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICApO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSB1bSBtZW1icm8gZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyXG4gICAqL1xuICBARGVsZXRlKCc6aWQnKVxuICBAUmVxdWlyZXNQZXJtaXNzaW9uKHtcbiAgICBwZXJtaXNzaW9uTmFtZTogJ2NpZGFkYW8uZWRpdGFyJyxcbiAgICBzY29wZVR5cGU6IFNjb3BlVHlwZS5VTklULFxuICAgIHNjb3BlSWRFeHByZXNzaW9uOiAnY29tcG9zaWNhb0ZhbWlsaWFyLmNpZGFkYW8udW5pZGFkZUlkJyxcbiAgfSlcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ1JlbW92ZXIgbWVtYnJvIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhcicsXG4gICAgZGVzY3JpcHRpb246ICdSZW1vdmUgdW0gbWVtYnJvIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhciAoc29mdCBkZWxldGUpLicsXG4gIH0pXG4gIEBBcGlQYXJhbSh7XG4gICAgbmFtZTogJ2lkJyxcbiAgICBkZXNjcmlwdGlvbjogJ0lEIGRvIG1lbWJybyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXInLFxuICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgIGZvcm1hdDogJ3V1aWQnLFxuICB9KVxuICBAQXBpT2tSZXNwb25zZSh7XG4gICAgZGVzY3JpcHRpb246ICdNZW1icm8gZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyIHJlbW92aWRvIGNvbSBzdWNlc3NvJyxcbiAgfSlcbiAgQEFwaU5vdEZvdW5kUmVzcG9uc2Uoe1xuICAgIGRlc2NyaXB0aW9uOiAnTWVtYnJvIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhciBuw6NvIGVuY29udHJhZG8nLFxuICAgIHR5cGU6IEFwaUVycm9yUmVzcG9uc2UsXG4gIH0pXG4gIGFzeW5jIHJlbW92ZShcbiAgICBAUGFyYW0oJ2lkJywgUGFyc2VVVUlEUGlwZSkgaWQ6IHN0cmluZyxcbiAgICBAUmVxdWVzdCgpIHJlcSxcbiAgKTogUHJvbWlzZTx7IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCByZXF1ZXN0SWQgPSBgQ0YtREVMRVRFLSR7aWQuc3Vic3RyaW5nKDAsIDgpfS0ke0RhdGUubm93KCl9YDtcbiAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICBgWyR7cmVxdWVzdElkfV0gSW7DrWNpbyBkYSByZW1vw6fDo28gZGUgbWVtYnJvIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhcmAsXG4gICAgKTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbXBvc2ljYW9GYW1pbGlhclNlcnZpY2UucmVtb3ZlKGlkLCByZXE/LnVzZXI/LmlkKTtcblxuICAgICAgY29uc3QgdG90YWxUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgIGlmICh0b3RhbFRpbWUgPiAzMDApIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybihcbiAgICAgICAgICBgWyR7cmVxdWVzdElkfV0gT3BlcmHDp8OjbyBsZW50YSAocmVtb3ZlKTogJHt0b3RhbFRpbWV9bXNgLFxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sb2dnZXIubG9nKGBbJHtyZXF1ZXN0SWR9XSBPcGVyYcOnw6NvIGNvbmNsdcOtZGEgZW0gJHt0b3RhbFRpbWV9bXNgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgbWVzc2FnZTogJ01lbWJybyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXIgcmVtb3ZpZG8gY29tIHN1Y2Vzc28nIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IHRvdGFsVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYFske3JlcXVlc3RJZH1dIEVycm8gZW0gJHt0b3RhbFRpbWV9bXM6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBCdXNjYSBtZW1icm9zIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhciBwb3IgQ1BGXG4gICAqL1xuICBAR2V0KCdidXNjYXIvY3BmLzpjcGYnKVxuICBAUmVxdWlyZXNQZXJtaXNzaW9uKHtcbiAgICBwZXJtaXNzaW9uTmFtZTogJ2NpZGFkYW8udmlzdWFsaXphcicsXG4gICAgc2NvcGVUeXBlOiBTY29wZVR5cGUuVU5JVCxcbiAgICBzY29wZUlkRXhwcmVzc2lvbjogJ3VzZXIudW5pZGFkZUlkJyxcbiAgfSlcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0J1c2NhciBtZW1icm8gcG9yIENQRicsXG4gICAgZGVzY3JpcHRpb246ICdCdXNjYSBtZW1icm9zIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhciBwZWxvIENQRi4nLFxuICB9KVxuICBAQXBpUGFyYW0oe1xuICAgIG5hbWU6ICdjcGYnLFxuICAgIGRlc2NyaXB0aW9uOiAnQ1BGIGRvIG1lbWJybyAoYXBlbmFzIG7Dum1lcm9zKScsXG4gICAgdHlwZTogJ3N0cmluZycsXG4gICAgZXhhbXBsZTogJzEyMzQ1Njc4OTAxJyxcbiAgfSlcbiAgQEFwaU9rUmVzcG9uc2Uoe1xuICAgIGRlc2NyaXB0aW9uOiAnTWVtYnJvcyBlbmNvbnRyYWRvcycsXG4gICAgdHlwZTogW0NvbXBvc2ljYW9GYW1pbGlhclJlc3BvbnNlRHRvXSxcbiAgfSlcbiAgYXN5bmMgZmluZEJ5Q3BmKFxuICAgIEBQYXJhbSgnY3BmJykgY3BmOiBzdHJpbmcsXG4gICk6IFByb21pc2U8Q29tcG9zaWNhb0ZhbWlsaWFyUmVzcG9uc2VEdG9bXT4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgY29uc3QgcmVxdWVzdElkID0gYENGLUNQRi0ke2NwZi5zdWJzdHJpbmcoMCwgNCl9LSR7RGF0ZS5ub3coKX1gO1xuICAgIHRoaXMubG9nZ2VyLmxvZyhgWyR7cmVxdWVzdElkfV0gSW7DrWNpbyBkYSBidXNjYSBwb3IgQ1BGYCk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jb21wb3NpY2FvRmFtaWxpYXJTZXJ2aWNlLmZpbmRCeUNwZihjcGYpO1xuXG4gICAgICBjb25zdCB0b3RhbFRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgaWYgKHRvdGFsVGltZSA+IDIwMCkge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgICAgIGBbJHtyZXF1ZXN0SWR9XSBPcGVyYcOnw6NvIGxlbnRhIChmaW5kQnlDcGYpOiAke3RvdGFsVGltZX1tc2AsXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2coYFske3JlcXVlc3RJZH1dIE9wZXJhw6fDo28gY29uY2x1w61kYSBlbSAke3RvdGFsVGltZX1tc2ApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCB0b3RhbFRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBbJHtyZXF1ZXN0SWR9XSBFcnJvIGVtICR7dG90YWxUaW1lfW1zOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==