d9bed63117a0abe16391f859fec04c02
"use strict";
/**
 * Testes para a classe AppError
 *
 * Valida a funcionalidade da classe principal
 * de erro do sistema de catálogo.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const AppError_1 = require("./AppError");
const catalog_1 = require("./catalog");
describe('AppError', () => {
    describe('Constructor', () => {
        it('should create AppError with valid error code', () => {
            const error = new AppError_1.AppError('VAL_CPF_001');
            expect(error).toBeInstanceOf(AppError_1.AppError);
            expect(error.errorCode).toBe('VAL_CPF_001');
            expect(error.definition).toBe(catalog_1.ERROR_CATALOG['VAL_CPF_001']);
            expect(error.getStatus()).toBe(400);
        });
        it('should create AppError with context', () => {
            const context = {
                cpf: '12345678901',
                operationalContext: {
                    module: 'cidadao',
                    operation: 'create',
                },
            };
            const error = new AppError_1.AppError('VAL_CPF_001', context);
            expect(error.context).toEqual(context);
        });
        it('should create AppError with custom message', () => {
            const customMessage = 'Mensagem personalizada';
            const error = new AppError_1.AppError('VAL_CPF_001', {}, customMessage);
            expect(error.message).toBe(customMessage);
        });
        it('should throw error for invalid error code', () => {
            expect(() => {
                new AppError_1.AppError('INVALID_CODE');
            }).toThrow('Código de erro INVALID_CODE não encontrado no catálogo');
        });
    });
    describe('Message Interpolation', () => {
        it('should interpolate message with context values', () => {
            const context = { cpf: '12345678901' };
            const error = new AppError_1.AppError('VAL_CPF_002', context);
            expect(error.message).toBe('Já existe um cidadão cadastrado com o CPF 12345678901');
        });
        it('should handle missing context values gracefully', () => {
            const error = new AppError_1.AppError('VAL_CPF_002', {});
            expect(error.message).toBe('Já existe um cidadão cadastrado com o CPF {cpf}');
        });
        it('should interpolate multiple placeholders', () => {
            const context = { minAge: 18, maxAge: 65 };
            const error = new AppError_1.AppError('VAL_AGE_001', context);
            expect(error.message).toBe('Idade deve estar entre 18 e 65 anos');
        });
    });
    describe('Localized Messages', () => {
        it('should return Portuguese message by default', () => {
            const error = new AppError_1.AppError('VAL_CPF_001');
            expect(error.getLocalizedMessage()).toBe('CPF informado é inválido');
        });
        it('should return Portuguese message for pt-BR locale', () => {
            const error = new AppError_1.AppError('VAL_CPF_001');
            expect(error.getLocalizedMessage('pt-BR')).toBe('CPF informado é inválido');
        });
        it('should fallback to default message for unsupported locale', () => {
            const error = new AppError_1.AppError('VAL_CPF_001');
            expect(error.getLocalizedMessage('en-US')).toBe('CPF informado é inválido');
        });
    });
    describe('JSON Representation', () => {
        it('should return complete JSON representation', () => {
            const context = {
                cpf: '12345678901',
                operationalContext: {
                    module: 'cidadao',
                    operation: 'create',
                },
            };
            const error = new AppError_1.AppError('VAL_CPF_002', context);
            const json = error.toJSON();
            expect(json).toHaveProperty('errorCode', 'VAL_CPF_002');
            expect(json).toHaveProperty('message');
            expect(json).toHaveProperty('httpStatus', 409);
            expect(json).toHaveProperty('category', catalog_1.ErrorCategory.VALIDATION);
            expect(json).toHaveProperty('severity', catalog_1.ErrorSeverity.MEDIUM);
            expect(json).toHaveProperty('context', context);
            expect(json).toHaveProperty('timestamp');
        });
        it('should include legal reference when available', () => {
            const error = new AppError_1.AppError('BEN_NAT_001');
            const json = error.toJSON();
            if (catalog_1.ERROR_CATALOG['BEN_NAT_001'].legalReference) {
                expect(json).toHaveProperty('legalReference');
            }
        });
    });
    describe('Log Data', () => {
        it('should return sanitized log data', () => {
            const context = {
                cpf: '12345678901',
                password: 'secret123',
                operationalContext: {
                    module: 'cidadao',
                    operation: 'create',
                },
            };
            const error = new AppError_1.AppError('VAL_CPF_002', context);
            const logData = error.getLogData();
            expect(logData.context.cpf).toBe('***.***.***-**');
            expect(logData.context.password).toBe('[REDACTED]');
            expect(logData.context.operationalContext).toEqual(context.operationalContext);
        });
        it('should include stack trace in log data', () => {
            const error = new AppError_1.AppError('VAL_CPF_001');
            const logData = error.getLogData();
            expect(logData).toHaveProperty('stack');
            expect(logData.stack).toBeTruthy();
        });
    });
    describe('API Data', () => {
        it('should return API-safe data without sensitive information', () => {
            const context = {
                cpf: '12345678901',
                password: 'secret123',
                operationalContext: {
                    module: 'cidadao',
                    operation: 'create',
                },
            };
            const error = new AppError_1.AppError('VAL_CPF_002', context);
            const apiData = error.getApiData();
            expect(apiData.context).not.toHaveProperty('password');
            expect(apiData).not.toHaveProperty('stack');
            expect(apiData).toHaveProperty('errorCode');
            expect(apiData).toHaveProperty('message');
            expect(apiData).toHaveProperty('httpStatus');
        });
    });
    describe('Severity and Category Checks', () => {
        it('should correctly identify critical errors', () => {
            const error = new AppError_1.AppError('INT_DB_001');
            expect(error.isCritical()).toBe(true);
            expect(error.isHigh()).toBe(false);
        });
        it('should correctly identify high severity errors', () => {
            const error = new AppError_1.AppError('BEN_NAT_001');
            expect(error.isHigh()).toBe(true);
            expect(error.isCritical()).toBe(false);
        });
        it('should correctly identify validation category', () => {
            const error = new AppError_1.AppError('VAL_CPF_001');
            expect(error.isValidationError()).toBe(true);
            expect(error.isBenefitError()).toBe(false);
        });
        it('should correctly identify benefit category', () => {
            const error = new AppError_1.AppError('BEN_NAT_001');
            expect(error.isBenefitError()).toBe(true);
            expect(error.isValidationError()).toBe(false);
        });
    });
    describe('Static Factory Methods', () => {
        it('should create AppError from PostgreSQL error code', () => {
            const pgError = {
                code: '23505',
                message: 'duplicate key value violates unique constraint',
                constraint: 'uk_cidadao_cpf',
                table: 'cidadao',
            };
            const context = {
                operationalContext: {
                    module: 'cidadao',
                    operation: 'create',
                },
            };
            const error = AppError_1.AppError.fromPostgresError('23505', pgError, context);
            expect(error).toBeInstanceOf(AppError_1.AppError);
            expect(error.errorCode).toBe('SYS_UNIQUE_001');
        });
        it('should throw error for unmapped PostgreSQL code', () => {
            const pgError = {
                code: '99999',
                message: 'unknown error',
            };
            expect(() => {
                AppError_1.AppError.fromPostgresError('99999', pgError, {});
            }).toThrow('Código PostgreSQL 99999 não mapeado no catálogo');
        });
    });
    describe('Error Inheritance', () => {
        it('should be instance of Error', () => {
            const error = new AppError_1.AppError('VAL_CPF_001');
            expect(error).toBeInstanceOf(Error);
        });
        it('should have correct name property', () => {
            const error = new AppError_1.AppError('VAL_CPF_001');
            expect(error.name).toBe('AppError');
        });
        it('should have stack trace', () => {
            const error = new AppError_1.AppError('VAL_CPF_001');
            expect(error.stack).toBeTruthy();
        });
    });
    describe('Context Validation', () => {
        it('should handle empty context', () => {
            const error = new AppError_1.AppError('VAL_CPF_001', {});
            expect(error.context).toEqual({});
        });
        it('should handle undefined context', () => {
            const error = new AppError_1.AppError('VAL_CPF_001');
            expect(error.context).toEqual({});
        });
        it('should preserve complex context objects', () => {
            const context = {
                operationalContext: {
                    module: 'cidadao',
                    operation: 'create',
                    entityType: 'Cidadao',
                    entityId: '123',
                },
                metadata: {
                    constraint: 'uk_cidadao_cpf',
                    table: 'cidadao',
                    userAgent: 'Mozilla/5.0...',
                },
            };
            const error = new AppError_1.AppError('VAL_CPF_001', context);
            expect(error.context).toEqual(context);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXHNoYXJlZFxcZXhjZXB0aW9uc1xcZXJyb3ItY2F0YWxvZ1xcQXBwRXJyb3Iuc3BlYy50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7O0FBRUgseUNBQW9EO0FBQ3BELHVDQUF3RTtBQUV4RSxRQUFRLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRTtJQUN4QixRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUMzQixFQUFFLENBQUMsOENBQThDLEVBQUUsR0FBRyxFQUFFO1lBQ3RELE1BQU0sS0FBSyxHQUFHLElBQUksbUJBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUUxQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsY0FBYyxDQUFDLG1CQUFRLENBQUMsQ0FBQztZQUN2QyxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUM1QyxNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyx1QkFBYSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7WUFDNUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN0QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7WUFDN0MsTUFBTSxPQUFPLEdBQWlCO2dCQUM1QixHQUFHLEVBQUUsYUFBYTtnQkFDbEIsa0JBQWtCLEVBQUU7b0JBQ2xCLE1BQU0sRUFBRSxTQUFTO29CQUNqQixTQUFTLEVBQUUsUUFBUTtpQkFDcEI7YUFDRixDQUFDO1lBRUYsTUFBTSxLQUFLLEdBQUcsSUFBSSxtQkFBUSxDQUFDLGFBQWEsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUVuRCxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8s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QUcsRUFBRTtZQUN6QyxNQUFNLEtBQUssR0FBRyxJQUFJLG1CQUFRLENBQUMsYUFBYSxDQUFDLENBQUM7WUFFMUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDcEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1lBQ2pELE1BQU0sT0FBTyxHQUFpQjtnQkFDNUIsa0JBQWtCLEVBQUU7b0JBQ2xCLE1BQU0sRUFBRSxTQUFTO29CQUNqQixTQUFTLEVBQUUsUUFBUTtvQkFDbkIsVUFBVSxFQUFFLFNBQVM7b0JBQ3JCLFFBQVEsRUFBRSxLQUFLO2lCQUNoQjtnQkFDRCxRQUFRLEVBQUU7b0JBQ1IsVUFBVSxFQUFFLGdCQUFnQjtvQkFDNUIsS0FBSyxFQUFFLFNBQVM7b0JBQ2hCLFNBQVMsRUFBRSxnQkFBZ0I7aUJBQzVCO2FBQ0YsQ0FBQztZQUVGLE1BQU0sS0FBSyxHQUFHLElBQUksbUJBQVEsQ0FBQyxhQUFhLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFbkQsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDekMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxzaGFyZWRcXGV4Y2VwdGlvbnNcXGVycm9yLWNhdGFsb2dcXEFwcEVycm9yLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUZXN0ZXMgcGFyYSBhIGNsYXNzZSBBcHBFcnJvclxuICpcbiAqIFZhbGlkYSBhIGZ1bmNpb25hbGlkYWRlIGRhIGNsYXNzZSBwcmluY2lwYWxcbiAqIGRlIGVycm8gZG8gc2lzdGVtYSBkZSBjYXTDoWxvZ28uXG4gKi9cblxuaW1wb3J0IHsgQXBwRXJyb3IsIEVycm9yQ29udGV4dCB9IGZyb20gJy4vQXBwRXJyb3InO1xuaW1wb3J0IHsgRVJST1JfQ0FUQUxPRywgRXJyb3JTZXZlcml0eSwgRXJyb3JDYXRlZ29yeSB9IGZyb20gJy4vY2F0YWxvZyc7XG5cbmRlc2NyaWJlKCdBcHBFcnJvcicsICgpID0+IHtcbiAgZGVzY3JpYmUoJ0NvbnN0cnVjdG9yJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIEFwcEVycm9yIHdpdGggdmFsaWQgZXJyb3IgY29kZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEFwcEVycm9yKCdWQUxfQ1BGXzAwMScpO1xuXG4gICAgICBleHBlY3QoZXJyb3IpLnRvQmVJbnN0YW5jZU9mKEFwcEVycm9yKTtcbiAgICAgIGV4cGVjdChlcnJvci5lcnJvckNvZGUpLnRvQmUoJ1ZBTF9DUEZfMDAxJyk7XG4gICAgICBleHBlY3QoZXJyb3IuZGVmaW5pdGlvbikudG9CZShFUlJPUl9DQVRBTE9HWydWQUxfQ1BGXzAwMSddKTtcbiAgICAgIGV4cGVjdChlcnJvci5nZXRTdGF0dXMoKSkudG9CZSg0MDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgQXBwRXJyb3Igd2l0aCBjb250ZXh0JywgKCkgPT4ge1xuICAgICAgY29uc3QgY29udGV4dDogRXJyb3JDb250ZXh0ID0ge1xuICAgICAgICBjcGY6ICcxMjM0NTY3ODkwMScsXG4gICAgICAgIG9wZXJhdGlvbmFsQ29udGV4dDoge1xuICAgICAgICAgIG1vZHVsZTogJ2NpZGFkYW8nLFxuICAgICAgICAgIG9wZXJhdGlvbjogJ2NyZWF0ZScsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBBcHBFcnJvcignVkFMX0NQRl8wMDEnLCBjb250ZXh0KTtcblxuICAgICAgZXhwZWN0KGVycm9yLmNvbnRleHQpLnRvRXF1YWwoY29udGV4dCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBBcHBFcnJvciB3aXRoIGN1c3RvbSBtZXNzYWdlJywgKCkgPT4ge1xuICAgICAgY29uc3QgY3VzdG9tTWVzc2FnZSA9ICdNZW5zYWdlbSBwZXJzb25hbGl6YWRhJztcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEFwcEVycm9yKCdWQUxfQ1BGXzAwMScsIHt9LCBjdXN0b21NZXNzYWdlKTtcblxuICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQmUoY3VzdG9tTWVzc2FnZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGZvciBpbnZhbGlkIGVycm9yIGNvZGUnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICBuZXcgQXBwRXJyb3IoJ0lOVkFMSURfQ09ERScpO1xuICAgICAgfSkudG9UaHJvdygnQ8OzZGlnbyBkZSBlcnJvIElOVkFMSURfQ09ERSBuw6NvIGVuY29udHJhZG8gbm8gY2F0w6Fsb2dvJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdNZXNzYWdlIEludGVycG9sYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBpbnRlcnBvbGF0ZSBtZXNzYWdlIHdpdGggY29udGV4dCB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb250ZXh0ID0geyBjcGY6ICcxMjM0NTY3ODkwMScgfTtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEFwcEVycm9yKCdWQUxfQ1BGXzAwMicsIGNvbnRleHQpO1xuXG4gICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZShcbiAgICAgICAgJ0rDoSBleGlzdGUgdW0gY2lkYWTDo28gY2FkYXN0cmFkbyBjb20gbyBDUEYgMTIzNDU2Nzg5MDEnLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1pc3NpbmcgY29udGV4dCB2YWx1ZXMgZ3JhY2VmdWxseScsICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEFwcEVycm9yKCdWQUxfQ1BGXzAwMicsIHt9KTtcblxuICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQmUoXG4gICAgICAgICdKw6EgZXhpc3RlIHVtIGNpZGFkw6NvIGNhZGFzdHJhZG8gY29tIG8gQ1BGIHtjcGZ9JyxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGludGVycG9sYXRlIG11bHRpcGxlIHBsYWNlaG9sZGVycycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSB7IG1pbkFnZTogMTgsIG1heEFnZTogNjUgfTtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEFwcEVycm9yKCdWQUxfQUdFXzAwMScsIGNvbnRleHQpO1xuXG4gICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgnSWRhZGUgZGV2ZSBlc3RhciBlbnRyZSAxOCBlIDY1IGFub3MnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0xvY2FsaXplZCBNZXNzYWdlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBQb3J0dWd1ZXNlIG1lc3NhZ2UgYnkgZGVmYXVsdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEFwcEVycm9yKCdWQUxfQ1BGXzAwMScpO1xuXG4gICAgICBleHBlY3QoZXJyb3IuZ2V0TG9jYWxpemVkTWVzc2FnZSgpKS50b0JlKCdDUEYgaW5mb3JtYWRvIMOpIGludsOhbGlkbycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gUG9ydHVndWVzZSBtZXNzYWdlIGZvciBwdC1CUiBsb2NhbGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBBcHBFcnJvcignVkFMX0NQRl8wMDEnKTtcblxuICAgICAgZXhwZWN0KGVycm9yLmdldExvY2FsaXplZE1lc3NhZ2UoJ3B0LUJSJykpLnRvQmUoXG4gICAgICAgICdDUEYgaW5mb3JtYWRvIMOpIGludsOhbGlkbycsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBmYWxsYmFjayB0byBkZWZhdWx0IG1lc3NhZ2UgZm9yIHVuc3VwcG9ydGVkIGxvY2FsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEFwcEVycm9yKCdWQUxfQ1BGXzAwMScpO1xuXG4gICAgICBleHBlY3QoZXJyb3IuZ2V0TG9jYWxpemVkTWVzc2FnZSgnZW4tVVMnKSkudG9CZShcbiAgICAgICAgJ0NQRiBpbmZvcm1hZG8gw6kgaW52w6FsaWRvJyxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdKU09OIFJlcHJlc2VudGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvbXBsZXRlIEpTT04gcmVwcmVzZW50YXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb250ZXh0OiBFcnJvckNvbnRleHQgPSB7XG4gICAgICAgIGNwZjogJzEyMzQ1Njc4OTAxJyxcbiAgICAgICAgb3BlcmF0aW9uYWxDb250ZXh0OiB7XG4gICAgICAgICAgbW9kdWxlOiAnY2lkYWRhbycsXG4gICAgICAgICAgb3BlcmF0aW9uOiAnY3JlYXRlJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEFwcEVycm9yKCdWQUxfQ1BGXzAwMicsIGNvbnRleHQpO1xuICAgICAgY29uc3QganNvbiA9IGVycm9yLnRvSlNPTigpO1xuXG4gICAgICBleHBlY3QoanNvbikudG9IYXZlUHJvcGVydHkoJ2Vycm9yQ29kZScsICdWQUxfQ1BGXzAwMicpO1xuICAgICAgZXhwZWN0KGpzb24pLnRvSGF2ZVByb3BlcnR5KCdtZXNzYWdlJyk7XG4gICAgICBleHBlY3QoanNvbikudG9IYXZlUHJvcGVydHkoJ2h0dHBTdGF0dXMnLCA0MDkpO1xuICAgICAgZXhwZWN0KGpzb24pLnRvSGF2ZVByb3BlcnR5KCdjYXRlZ29yeScsIEVycm9yQ2F0ZWdvcnkuVkFMSURBVElPTik7XG4gICAgICBleHBlY3QoanNvbikudG9IYXZlUHJvcGVydHkoJ3NldmVyaXR5JywgRXJyb3JTZXZlcml0eS5NRURJVU0pO1xuICAgICAgZXhwZWN0KGpzb24pLnRvSGF2ZVByb3BlcnR5KCdjb250ZXh0JywgY29udGV4dCk7XG4gICAgICBleHBlY3QoanNvbikudG9IYXZlUHJvcGVydHkoJ3RpbWVzdGFtcCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpbmNsdWRlIGxlZ2FsIHJlZmVyZW5jZSB3aGVuIGF2YWlsYWJsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEFwcEVycm9yKCdCRU5fTkFUXzAwMScpO1xuICAgICAgY29uc3QganNvbiA9IGVycm9yLnRvSlNPTigpO1xuXG4gICAgICBpZiAoRVJST1JfQ0FUQUxPR1snQkVOX05BVF8wMDEnXS5sZWdhbFJlZmVyZW5jZSkge1xuICAgICAgICBleHBlY3QoanNvbikudG9IYXZlUHJvcGVydHkoJ2xlZ2FsUmVmZXJlbmNlJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdMb2cgRGF0YScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBzYW5pdGl6ZWQgbG9nIGRhdGEnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb250ZXh0OiBFcnJvckNvbnRleHQgPSB7XG4gICAgICAgIGNwZjogJzEyMzQ1Njc4OTAxJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdzZWNyZXQxMjMnLFxuICAgICAgICBvcGVyYXRpb25hbENvbnRleHQ6IHtcbiAgICAgICAgICBtb2R1bGU6ICdjaWRhZGFvJyxcbiAgICAgICAgICBvcGVyYXRpb246ICdjcmVhdGUnLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgQXBwRXJyb3IoJ1ZBTF9DUEZfMDAyJywgY29udGV4dCk7XG4gICAgICBjb25zdCBsb2dEYXRhID0gZXJyb3IuZ2V0TG9nRGF0YSgpO1xuXG4gICAgICBleHBlY3QobG9nRGF0YS5jb250ZXh0LmNwZikudG9CZSgnKioqLioqKi4qKiotKionKTtcbiAgICAgIGV4cGVjdChsb2dEYXRhLmNvbnRleHQucGFzc3dvcmQpLnRvQmUoJ1tSRURBQ1RFRF0nKTtcbiAgICAgIGV4cGVjdChsb2dEYXRhLmNvbnRleHQub3BlcmF0aW9uYWxDb250ZXh0KS50b0VxdWFsKFxuICAgICAgICBjb250ZXh0Lm9wZXJhdGlvbmFsQ29udGV4dCxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgc3RhY2sgdHJhY2UgaW4gbG9nIGRhdGEnLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBBcHBFcnJvcignVkFMX0NQRl8wMDEnKTtcbiAgICAgIGNvbnN0IGxvZ0RhdGEgPSBlcnJvci5nZXRMb2dEYXRhKCk7XG5cbiAgICAgIGV4cGVjdChsb2dEYXRhKS50b0hhdmVQcm9wZXJ0eSgnc3RhY2snKTtcbiAgICAgIGV4cGVjdChsb2dEYXRhLnN0YWNrKS50b0JlVHJ1dGh5KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBUEkgRGF0YScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBBUEktc2FmZSBkYXRhIHdpdGhvdXQgc2Vuc2l0aXZlIGluZm9ybWF0aW9uJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29udGV4dDogRXJyb3JDb250ZXh0ID0ge1xuICAgICAgICBjcGY6ICcxMjM0NTY3ODkwMScsXG4gICAgICAgIHBhc3N3b3JkOiAnc2VjcmV0MTIzJyxcbiAgICAgICAgb3BlcmF0aW9uYWxDb250ZXh0OiB7XG4gICAgICAgICAgbW9kdWxlOiAnY2lkYWRhbycsXG4gICAgICAgICAgb3BlcmF0aW9uOiAnY3JlYXRlJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEFwcEVycm9yKCdWQUxfQ1BGXzAwMicsIGNvbnRleHQpO1xuICAgICAgY29uc3QgYXBpRGF0YSA9IGVycm9yLmdldEFwaURhdGEoKTtcblxuICAgICAgZXhwZWN0KGFwaURhdGEuY29udGV4dCkubm90LnRvSGF2ZVByb3BlcnR5KCdwYXNzd29yZCcpO1xuICAgICAgZXhwZWN0KGFwaURhdGEpLm5vdC50b0hhdmVQcm9wZXJ0eSgnc3RhY2snKTtcbiAgICAgIGV4cGVjdChhcGlEYXRhKS50b0hhdmVQcm9wZXJ0eSgnZXJyb3JDb2RlJyk7XG4gICAgICBleHBlY3QoYXBpRGF0YSkudG9IYXZlUHJvcGVydHkoJ21lc3NhZ2UnKTtcbiAgICAgIGV4cGVjdChhcGlEYXRhKS50b0hhdmVQcm9wZXJ0eSgnaHR0cFN0YXR1cycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU2V2ZXJpdHkgYW5kIENhdGVnb3J5IENoZWNrcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNvcnJlY3RseSBpZGVudGlmeSBjcml0aWNhbCBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBBcHBFcnJvcignSU5UX0RCXzAwMScpO1xuXG4gICAgICBleHBlY3QoZXJyb3IuaXNDcml0aWNhbCgpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGVycm9yLmlzSGlnaCgpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY29ycmVjdGx5IGlkZW50aWZ5IGhpZ2ggc2V2ZXJpdHkgZXJyb3JzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgQXBwRXJyb3IoJ0JFTl9OQVRfMDAxJyk7XG5cbiAgICAgIGV4cGVjdChlcnJvci5pc0hpZ2goKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChlcnJvci5pc0NyaXRpY2FsKCkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjb3JyZWN0bHkgaWRlbnRpZnkgdmFsaWRhdGlvbiBjYXRlZ29yeScsICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEFwcEVycm9yKCdWQUxfQ1BGXzAwMScpO1xuXG4gICAgICBleHBlY3QoZXJyb3IuaXNWYWxpZGF0aW9uRXJyb3IoKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChlcnJvci5pc0JlbmVmaXRFcnJvcigpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY29ycmVjdGx5IGlkZW50aWZ5IGJlbmVmaXQgY2F0ZWdvcnknLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBBcHBFcnJvcignQkVOX05BVF8wMDEnKTtcblxuICAgICAgZXhwZWN0KGVycm9yLmlzQmVuZWZpdEVycm9yKCkpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoZXJyb3IuaXNWYWxpZGF0aW9uRXJyb3IoKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTdGF0aWMgRmFjdG9yeSBNZXRob2RzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIEFwcEVycm9yIGZyb20gUG9zdGdyZVNRTCBlcnJvciBjb2RlJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGdFcnJvciA9IHtcbiAgICAgICAgY29kZTogJzIzNTA1JyxcbiAgICAgICAgbWVzc2FnZTogJ2R1cGxpY2F0ZSBrZXkgdmFsdWUgdmlvbGF0ZXMgdW5pcXVlIGNvbnN0cmFpbnQnLFxuICAgICAgICBjb25zdHJhaW50OiAndWtfY2lkYWRhb19jcGYnLFxuICAgICAgICB0YWJsZTogJ2NpZGFkYW8nLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29udGV4dDogRXJyb3JDb250ZXh0ID0ge1xuICAgICAgICBvcGVyYXRpb25hbENvbnRleHQ6IHtcbiAgICAgICAgICBtb2R1bGU6ICdjaWRhZGFvJyxcbiAgICAgICAgICBvcGVyYXRpb246ICdjcmVhdGUnLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgZXJyb3IgPSBBcHBFcnJvci5mcm9tUG9zdGdyZXNFcnJvcignMjM1MDUnLCBwZ0Vycm9yLCBjb250ZXh0KTtcblxuICAgICAgZXhwZWN0KGVycm9yKS50b0JlSW5zdGFuY2VPZihBcHBFcnJvcik7XG4gICAgICBleHBlY3QoZXJyb3IuZXJyb3JDb2RlKS50b0JlKCdTWVNfVU5JUVVFXzAwMScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3IgdW5tYXBwZWQgUG9zdGdyZVNRTCBjb2RlJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGdFcnJvciA9IHtcbiAgICAgICAgY29kZTogJzk5OTk5JyxcbiAgICAgICAgbWVzc2FnZTogJ3Vua25vd24gZXJyb3InLFxuICAgICAgfTtcblxuICAgICAgZXhwZWN0KCgpID0+IHtcbiAgICAgICAgQXBwRXJyb3IuZnJvbVBvc3RncmVzRXJyb3IoJzk5OTk5JywgcGdFcnJvciwge30pO1xuICAgICAgfSkudG9UaHJvdygnQ8OzZGlnbyBQb3N0Z3JlU1FMIDk5OTk5IG7Do28gbWFwZWFkbyBubyBjYXTDoWxvZ28nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIEluaGVyaXRhbmNlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYmUgaW5zdGFuY2Ugb2YgRXJyb3InLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBBcHBFcnJvcignVkFMX0NQRl8wMDEnKTtcblxuICAgICAgZXhwZWN0KGVycm9yKS50b0JlSW5zdGFuY2VPZihFcnJvcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhdmUgY29ycmVjdCBuYW1lIHByb3BlcnR5JywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgQXBwRXJyb3IoJ1ZBTF9DUEZfMDAxJyk7XG5cbiAgICAgIGV4cGVjdChlcnJvci5uYW1lKS50b0JlKCdBcHBFcnJvcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYXZlIHN0YWNrIHRyYWNlJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgQXBwRXJyb3IoJ1ZBTF9DUEZfMDAxJyk7XG5cbiAgICAgIGV4cGVjdChlcnJvci5zdGFjaykudG9CZVRydXRoeSgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ29udGV4dCBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IGNvbnRleHQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBBcHBFcnJvcignVkFMX0NQRl8wMDEnLCB7fSk7XG5cbiAgICAgIGV4cGVjdChlcnJvci5jb250ZXh0KS50b0VxdWFsKHt9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHVuZGVmaW5lZCBjb250ZXh0JywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgQXBwRXJyb3IoJ1ZBTF9DUEZfMDAxJyk7XG5cbiAgICAgIGV4cGVjdChlcnJvci5jb250ZXh0KS50b0VxdWFsKHt9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJlc2VydmUgY29tcGxleCBjb250ZXh0IG9iamVjdHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb250ZXh0OiBFcnJvckNvbnRleHQgPSB7XG4gICAgICAgIG9wZXJhdGlvbmFsQ29udGV4dDoge1xuICAgICAgICAgIG1vZHVsZTogJ2NpZGFkYW8nLFxuICAgICAgICAgIG9wZXJhdGlvbjogJ2NyZWF0ZScsXG4gICAgICAgICAgZW50aXR5VHlwZTogJ0NpZGFkYW8nLFxuICAgICAgICAgIGVudGl0eUlkOiAnMTIzJyxcbiAgICAgICAgfSxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBjb25zdHJhaW50OiAndWtfY2lkYWRhb19jcGYnLFxuICAgICAgICAgIHRhYmxlOiAnY2lkYWRhbycsXG4gICAgICAgICAgdXNlckFnZW50OiAnTW96aWxsYS81LjAuLi4nLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgQXBwRXJyb3IoJ1ZBTF9DUEZfMDAxJywgY29udGV4dCk7XG5cbiAgICAgIGV4cGVjdChlcnJvci5jb250ZXh0KS50b0VxdWFsKGNvbnRleHQpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9