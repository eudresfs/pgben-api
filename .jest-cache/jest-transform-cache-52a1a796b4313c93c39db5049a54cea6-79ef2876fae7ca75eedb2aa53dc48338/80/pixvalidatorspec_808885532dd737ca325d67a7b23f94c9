c5aa2aa1d85090262378aaca58e0c290
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const pix_validator_1 = require("../../validators/pix-validator");
/**
 * Testes unitários para o validador de chaves PIX
 *
 * Verifica o funcionamento correto das validações para diferentes tipos de chaves PIX,
 * incluindo CPF, e-mail, telefone e chave aleatória.
 *
 * @author Equipe PGBen
 */
describe('PixValidator', () => {
    let validator;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [pix_validator_1.PixValidator],
        }).compile();
        validator = module.get(pix_validator_1.PixValidator);
    });
    describe('validarChavePix', () => {
        it('deve retornar false para chave vazia', () => {
            expect(validator.validarChavePix('', 'cpf')).toBe(false);
            expect(validator.validarChavePix(null, 'email')).toBe(false);
            expect(validator.validarChavePix(undefined, 'telefone')).toBe(false);
        });
        it('deve retornar false para tipo inválido', () => {
            expect(validator.validarChavePix('12345678900', 'tipo_invalido')).toBe(false);
        });
        it('deve validar corretamente chave CPF', () => {
            // CPF válido
            expect(validator.validarChavePix('12345678909', 'cpf')).toBe(true);
            // CPF com formatação
            expect(validator.validarChavePix('123.456.789-09', 'cpf')).toBe(true);
            // CPF inválido (tamanho incorreto)
            expect(validator.validarChavePix('1234567890', 'cpf')).toBe(false);
            // CPF inválido (caracteres não numéricos)
            expect(validator.validarChavePix('1234567890a', 'cpf')).toBe(false);
        });
        it('deve validar corretamente chave e-mail', () => {
            // E-mail válido
            expect(validator.validarChavePix('usuario@dominio.com', 'email')).toBe(true);
            // E-mail com subdomínio
            expect(validator.validarChavePix('usuario@sub.dominio.com.br', 'email')).toBe(true);
            // E-mail inválido (sem @)
            expect(validator.validarChavePix('usuariodominio.com', 'email')).toBe(false);
            // E-mail inválido (sem domínio)
            expect(validator.validarChavePix('usuario@', 'email')).toBe(false);
            // E-mail inválido (caracteres especiais não permitidos)
            expect(validator.validarChavePix('usuario!@dominio.com', 'email')).toBe(false);
        });
        it('deve validar corretamente chave telefone', () => {
            // Telefone válido (formato completo)
            expect(validator.validarChavePix('+5584999999999', 'telefone')).toBe(true);
            // Telefone válido (sem +)
            expect(validator.validarChavePix('5584999999999', 'telefone')).toBe(true);
            // Telefone válido (com formatação)
            expect(validator.validarChavePix('+55 (84) 99999-9999', 'telefone')).toBe(true);
            // Telefone inválido (poucos dígitos)
            expect(validator.validarChavePix('559999', 'telefone')).toBe(false);
            // Telefone inválido (caracteres não permitidos)
            expect(validator.validarChavePix('5584999999a99', 'telefone')).toBe(false);
        });
        it('deve validar corretamente chave aleatória', () => {
            // UUID válido
            expect(validator.validarChavePix('123e4567-e89b-12d3-a456-426614174000', 'aleatoria')).toBe(true);
            // Chave aleatória inválida (formato incorreto)
            expect(validator.validarChavePix('123e4567e89b12d3a456426614174000', 'aleatoria')).toBe(false);
            // Chave aleatória inválida (tamanho incorreto)
            expect(validator.validarChavePix('123e4567-e89b-12d3-a456', 'aleatoria')).toBe(false);
        });
    });
    describe('mascaraChavePix', () => {
        it('deve mascarar corretamente chave CPF', () => {
            const mascarado = validator.mascaraChavePix('12345678909', 'cpf');
            expect(mascarado).toBe('***.456.789-**');
        });
        it('deve mascarar corretamente chave e-mail', () => {
            const mascarado = validator.mascaraChavePix('usuario@dominio.com', 'email');
            expect(mascarado).toMatch(/^u\*+@d\*+\.com$/);
        });
        it('deve mascarar corretamente chave telefone', () => {
            const mascarado = validator.mascaraChavePix('5584999999999', 'telefone');
            expect(mascarado).toMatch(/^\(\*\*\) \*\*\*\*\*\-\d{4}$/);
        });
        it('deve mascarar corretamente chave aleatória', () => {
            const chave = '123e4567-e89b-12d3-a456-426614174000';
            const mascarado = validator.mascaraChavePix(chave, 'aleatoria');
            expect(mascarado.length).toBe(chave.length);
            expect(mascarado).toContain('123e4567');
            expect(mascarado).not.toBe(chave);
        });
        it('deve retornar string vazia para chave vazia', () => {
            expect(validator.mascaraChavePix('', 'cpf')).toBe('');
            expect(validator.mascaraChavePix(null, 'email')).toBe('');
            expect(validator.mascaraChavePix(undefined, 'telefone')).toBe('');
        });
    });
    describe('obterTipoChavePix', () => {
        it('deve identificar corretamente o tipo de chave CPF', () => {
            expect(validator.obterTipoChavePix('12345678909')).toBe('cpf');
            expect(validator.obterTipoChavePix('123.456.789-09')).toBe('cpf');
        });
        it('deve identificar corretamente o tipo de chave e-mail', () => {
            expect(validator.obterTipoChavePix('usuario@dominio.com')).toBe('email');
            expect(validator.obterTipoChavePix('usuario@sub.dominio.com.br')).toBe('email');
        });
        it('deve identificar corretamente o tipo de chave telefone', () => {
            expect(validator.obterTipoChavePix('+5584999999999')).toBe('telefone');
            expect(validator.obterTipoChavePix('5584999999999')).toBe('telefone');
        });
        it('deve identificar corretamente o tipo de chave aleatória', () => {
            expect(validator.obterTipoChavePix('123e4567-e89b-12d3-a456-426614174000')).toBe('aleatoria');
        });
        it('deve retornar "desconhecido" para chave de formato não reconhecido', () => {
            expect(validator.obterTipoChavePix('formato_desconhecido')).toBe('desconhecido');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcdGVzdHNcXHZhbGlkYXRvcnNcXHBpeC12YWxpZGF0b3Iuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCxrRUFBOEQ7QUFFOUQ7Ozs7Ozs7R0FPRztBQUNILFFBQVEsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO0lBQzVCLElBQUksU0FBdUIsQ0FBQztJQUU1QixVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFNBQVMsRUFBRSxDQUFDLDRCQUFZLENBQUM7U0FDMUIsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRWIsU0FBUyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQWUsNEJBQVksQ0FBQyxDQUFDO0lBQ3JELENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtRQUMvQixFQUFFLENBQUMsc0NBQXNDLEVBQUUsR0FBRyxFQUFFO1lBQzlDLE1BQU0sQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN6RCxNQUFNLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDN0QsTUFBTSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsU0FBUyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3ZFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLEdBQUcsRUFBRTtZQUNoRCxNQUFNLENBQUMsU0FBUyxD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ZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxtb2R1bGVzXFxwYWdhbWVudG9cXHRlc3RzXFx2YWxpZGF0b3JzXFxwaXgtdmFsaWRhdG9yLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBQaXhWYWxpZGF0b3IgfSBmcm9tICcuLi8uLi92YWxpZGF0b3JzL3BpeC12YWxpZGF0b3InO1xuXG4vKipcbiAqIFRlc3RlcyB1bml0w6FyaW9zIHBhcmEgbyB2YWxpZGFkb3IgZGUgY2hhdmVzIFBJWFxuICpcbiAqIFZlcmlmaWNhIG8gZnVuY2lvbmFtZW50byBjb3JyZXRvIGRhcyB2YWxpZGHDp8O1ZXMgcGFyYSBkaWZlcmVudGVzIHRpcG9zIGRlIGNoYXZlcyBQSVgsXG4gKiBpbmNsdWluZG8gQ1BGLCBlLW1haWwsIHRlbGVmb25lIGUgY2hhdmUgYWxlYXTDs3JpYS5cbiAqXG4gKiBAYXV0aG9yIEVxdWlwZSBQR0JlblxuICovXG5kZXNjcmliZSgnUGl4VmFsaWRhdG9yJywgKCkgPT4ge1xuICBsZXQgdmFsaWRhdG9yOiBQaXhWYWxpZGF0b3I7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1BpeFZhbGlkYXRvcl0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgdmFsaWRhdG9yID0gbW9kdWxlLmdldDxQaXhWYWxpZGF0b3I+KFBpeFZhbGlkYXRvcik7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGFyQ2hhdmVQaXgnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgZmFsc2UgcGFyYSBjaGF2ZSB2YXppYScsICgpID0+IHtcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCcnLCAnY3BmJykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgobnVsbCwgJ2VtYWlsJykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgodW5kZWZpbmVkLCAndGVsZWZvbmUnKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBmYWxzZSBwYXJhIHRpcG8gaW52w6FsaWRvJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoJzEyMzQ1Njc4OTAwJywgJ3RpcG9faW52YWxpZG8nKSkudG9CZShcbiAgICAgICAgZmFsc2UsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgdmFsaWRhciBjb3JyZXRhbWVudGUgY2hhdmUgQ1BGJywgKCkgPT4ge1xuICAgICAgLy8gQ1BGIHbDoWxpZG9cbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCcxMjM0NTY3ODkwOScsICdjcGYnKSkudG9CZSh0cnVlKTtcblxuICAgICAgLy8gQ1BGIGNvbSBmb3JtYXRhw6fDo29cbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCcxMjMuNDU2Ljc4OS0wOScsICdjcGYnKSkudG9CZSh0cnVlKTtcblxuICAgICAgLy8gQ1BGIGludsOhbGlkbyAodGFtYW5obyBpbmNvcnJldG8pXG4gICAgICBleHBlY3QodmFsaWRhdG9yLnZhbGlkYXJDaGF2ZVBpeCgnMTIzNDU2Nzg5MCcsICdjcGYnKSkudG9CZShmYWxzZSk7XG5cbiAgICAgIC8vIENQRiBpbnbDoWxpZG8gKGNhcmFjdGVyZXMgbsOjbyBudW3DqXJpY29zKVxuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoJzEyMzQ1Njc4OTBhJywgJ2NwZicpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHZhbGlkYXIgY29ycmV0YW1lbnRlIGNoYXZlIGUtbWFpbCcsICgpID0+IHtcbiAgICAgIC8vIEUtbWFpbCB2w6FsaWRvXG4gICAgICBleHBlY3QodmFsaWRhdG9yLnZhbGlkYXJDaGF2ZVBpeCgndXN1YXJpb0Bkb21pbmlvLmNvbScsICdlbWFpbCcpKS50b0JlKFxuICAgICAgICB0cnVlLFxuICAgICAgKTtcblxuICAgICAgLy8gRS1tYWlsIGNvbSBzdWJkb23DrW5pb1xuICAgICAgZXhwZWN0KFxuICAgICAgICB2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCd1c3VhcmlvQHN1Yi5kb21pbmlvLmNvbS5icicsICdlbWFpbCcpLFxuICAgICAgKS50b0JlKHRydWUpO1xuXG4gICAgICAvLyBFLW1haWwgaW52w6FsaWRvIChzZW0gQClcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCd1c3VhcmlvZG9taW5pby5jb20nLCAnZW1haWwnKSkudG9CZShcbiAgICAgICAgZmFsc2UsXG4gICAgICApO1xuXG4gICAgICAvLyBFLW1haWwgaW52w6FsaWRvIChzZW0gZG9tw61uaW8pXG4gICAgICBleHBlY3QodmFsaWRhdG9yLnZhbGlkYXJDaGF2ZVBpeCgndXN1YXJpb0AnLCAnZW1haWwnKSkudG9CZShmYWxzZSk7XG5cbiAgICAgIC8vIEUtbWFpbCBpbnbDoWxpZG8gKGNhcmFjdGVyZXMgZXNwZWNpYWlzIG7Do28gcGVybWl0aWRvcylcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCd1c3VhcmlvIUBkb21pbmlvLmNvbScsICdlbWFpbCcpKS50b0JlKFxuICAgICAgICBmYWxzZSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSB2YWxpZGFyIGNvcnJldGFtZW50ZSBjaGF2ZSB0ZWxlZm9uZScsICgpID0+IHtcbiAgICAgIC8vIFRlbGVmb25lIHbDoWxpZG8gKGZvcm1hdG8gY29tcGxldG8pXG4gICAgICBleHBlY3QodmFsaWRhdG9yLnZhbGlkYXJDaGF2ZVBpeCgnKzU1ODQ5OTk5OTk5OTknLCAndGVsZWZvbmUnKSkudG9CZShcbiAgICAgICAgdHJ1ZSxcbiAgICAgICk7XG5cbiAgICAgIC8vIFRlbGVmb25lIHbDoWxpZG8gKHNlbSArKVxuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoJzU1ODQ5OTk5OTk5OTknLCAndGVsZWZvbmUnKSkudG9CZSh0cnVlKTtcblxuICAgICAgLy8gVGVsZWZvbmUgdsOhbGlkbyAoY29tIGZvcm1hdGHDp8OjbylcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCcrNTUgKDg0KSA5OTk5OS05OTk5JywgJ3RlbGVmb25lJykpLnRvQmUoXG4gICAgICAgIHRydWUsXG4gICAgICApO1xuXG4gICAgICAvLyBUZWxlZm9uZSBpbnbDoWxpZG8gKHBvdWNvcyBkw61naXRvcylcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCc1NTk5OTknLCAndGVsZWZvbmUnKSkudG9CZShmYWxzZSk7XG5cbiAgICAgIC8vIFRlbGVmb25lIGludsOhbGlkbyAoY2FyYWN0ZXJlcyBuw6NvIHBlcm1pdGlkb3MpXG4gICAgICBleHBlY3QodmFsaWRhdG9yLnZhbGlkYXJDaGF2ZVBpeCgnNTU4NDk5OTk5OWE5OScsICd0ZWxlZm9uZScpKS50b0JlKFxuICAgICAgICBmYWxzZSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSB2YWxpZGFyIGNvcnJldGFtZW50ZSBjaGF2ZSBhbGVhdMOzcmlhJywgKCkgPT4ge1xuICAgICAgLy8gVVVJRCB2w6FsaWRvXG4gICAgICBleHBlY3QoXG4gICAgICAgIHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoXG4gICAgICAgICAgJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsXG4gICAgICAgICAgJ2FsZWF0b3JpYScsXG4gICAgICAgICksXG4gICAgICApLnRvQmUodHJ1ZSk7XG5cbiAgICAgIC8vIENoYXZlIGFsZWF0w7NyaWEgaW52w6FsaWRhIChmb3JtYXRvIGluY29ycmV0bylcbiAgICAgIGV4cGVjdChcbiAgICAgICAgdmFsaWRhdG9yLnZhbGlkYXJDaGF2ZVBpeChcbiAgICAgICAgICAnMTIzZTQ1NjdlODliMTJkM2E0NTY0MjY2MTQxNzQwMDAnLFxuICAgICAgICAgICdhbGVhdG9yaWEnLFxuICAgICAgICApLFxuICAgICAgKS50b0JlKGZhbHNlKTtcblxuICAgICAgLy8gQ2hhdmUgYWxlYXTDs3JpYSBpbnbDoWxpZGEgKHRhbWFuaG8gaW5jb3JyZXRvKVxuICAgICAgZXhwZWN0KFxuICAgICAgICB2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1NicsICdhbGVhdG9yaWEnKSxcbiAgICAgICkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtYXNjYXJhQ2hhdmVQaXgnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgbWFzY2FyYXIgY29ycmV0YW1lbnRlIGNoYXZlIENQRicsICgpID0+IHtcbiAgICAgIGNvbnN0IG1hc2NhcmFkbyA9IHZhbGlkYXRvci5tYXNjYXJhQ2hhdmVQaXgoJzEyMzQ1Njc4OTA5JywgJ2NwZicpO1xuICAgICAgZXhwZWN0KG1hc2NhcmFkbykudG9CZSgnKioqLjQ1Ni43ODktKionKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIG1hc2NhcmFyIGNvcnJldGFtZW50ZSBjaGF2ZSBlLW1haWwnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtYXNjYXJhZG8gPSB2YWxpZGF0b3IubWFzY2FyYUNoYXZlUGl4KFxuICAgICAgICAndXN1YXJpb0Bkb21pbmlvLmNvbScsXG4gICAgICAgICdlbWFpbCcsXG4gICAgICApO1xuICAgICAgZXhwZWN0KG1hc2NhcmFkbykudG9NYXRjaCgvXnVcXCorQGRcXCorXFwuY29tJC8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbWFzY2FyYXIgY29ycmV0YW1lbnRlIGNoYXZlIHRlbGVmb25lJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWFzY2FyYWRvID0gdmFsaWRhdG9yLm1hc2NhcmFDaGF2ZVBpeCgnNTU4NDk5OTk5OTk5OScsICd0ZWxlZm9uZScpO1xuICAgICAgZXhwZWN0KG1hc2NhcmFkbykudG9NYXRjaCgvXlxcKFxcKlxcKlxcKSBcXCpcXCpcXCpcXCpcXCpcXC1cXGR7NH0kLyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBtYXNjYXJhciBjb3JyZXRhbWVudGUgY2hhdmUgYWxlYXTDs3JpYScsICgpID0+IHtcbiAgICAgIGNvbnN0IGNoYXZlID0gJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCc7XG4gICAgICBjb25zdCBtYXNjYXJhZG8gPSB2YWxpZGF0b3IubWFzY2FyYUNoYXZlUGl4KGNoYXZlLCAnYWxlYXRvcmlhJyk7XG4gICAgICBleHBlY3QobWFzY2FyYWRvLmxlbmd0aCkudG9CZShjaGF2ZS5sZW5ndGgpO1xuICAgICAgZXhwZWN0KG1hc2NhcmFkbykudG9Db250YWluKCcxMjNlNDU2NycpO1xuICAgICAgZXhwZWN0KG1hc2NhcmFkbykubm90LnRvQmUoY2hhdmUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgc3RyaW5nIHZhemlhIHBhcmEgY2hhdmUgdmF6aWEnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodmFsaWRhdG9yLm1hc2NhcmFDaGF2ZVBpeCgnJywgJ2NwZicpKS50b0JlKCcnKTtcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IubWFzY2FyYUNoYXZlUGl4KG51bGwsICdlbWFpbCcpKS50b0JlKCcnKTtcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IubWFzY2FyYUNoYXZlUGl4KHVuZGVmaW5lZCwgJ3RlbGVmb25lJykpLnRvQmUoJycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnb2J0ZXJUaXBvQ2hhdmVQaXgnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgaWRlbnRpZmljYXIgY29ycmV0YW1lbnRlIG8gdGlwbyBkZSBjaGF2ZSBDUEYnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodmFsaWRhdG9yLm9idGVyVGlwb0NoYXZlUGl4KCcxMjM0NTY3ODkwOScpKS50b0JlKCdjcGYnKTtcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3Iub2J0ZXJUaXBvQ2hhdmVQaXgoJzEyMy40NTYuNzg5LTA5JykpLnRvQmUoJ2NwZicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgaWRlbnRpZmljYXIgY29ycmV0YW1lbnRlIG8gdGlwbyBkZSBjaGF2ZSBlLW1haWwnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodmFsaWRhdG9yLm9idGVyVGlwb0NoYXZlUGl4KCd1c3VhcmlvQGRvbWluaW8uY29tJykpLnRvQmUoJ2VtYWlsJyk7XG4gICAgICBleHBlY3QodmFsaWRhdG9yLm9idGVyVGlwb0NoYXZlUGl4KCd1c3VhcmlvQHN1Yi5kb21pbmlvLmNvbS5icicpKS50b0JlKFxuICAgICAgICAnZW1haWwnLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGlkZW50aWZpY2FyIGNvcnJldGFtZW50ZSBvIHRpcG8gZGUgY2hhdmUgdGVsZWZvbmUnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodmFsaWRhdG9yLm9idGVyVGlwb0NoYXZlUGl4KCcrNTU4NDk5OTk5OTk5OScpKS50b0JlKCd0ZWxlZm9uZScpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci5vYnRlclRpcG9DaGF2ZVBpeCgnNTU4NDk5OTk5OTk5OScpKS50b0JlKCd0ZWxlZm9uZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgaWRlbnRpZmljYXIgY29ycmV0YW1lbnRlIG8gdGlwbyBkZSBjaGF2ZSBhbGVhdMOzcmlhJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KFxuICAgICAgICB2YWxpZGF0b3Iub2J0ZXJUaXBvQ2hhdmVQaXgoJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcpLFxuICAgICAgKS50b0JlKCdhbGVhdG9yaWEnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIFwiZGVzY29uaGVjaWRvXCIgcGFyYSBjaGF2ZSBkZSBmb3JtYXRvIG7Do28gcmVjb25oZWNpZG8nLCAoKSA9PiB7XG4gICAgICBleHBlY3QodmFsaWRhdG9yLm9idGVyVGlwb0NoYXZlUGl4KCdmb3JtYXRvX2Rlc2NvbmhlY2lkbycpKS50b0JlKFxuICAgICAgICAnZGVzY29uaGVjaWRvJyxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=