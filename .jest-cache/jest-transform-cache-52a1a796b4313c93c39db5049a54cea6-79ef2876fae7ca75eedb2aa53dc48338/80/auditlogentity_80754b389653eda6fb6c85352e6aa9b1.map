{"file":"C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\entities\\audit-log.entity.ts","mappings":"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","names":[],"sources":["C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\entities\\audit-log.entity.ts"],"sourcesContent":["import {\n  Entity,\n  PrimaryGeneratedColumn,\n  Column,\n  CreateDateColumn,\n  Index,\n  ManyToOne,\n  JoinColumn,\n} from 'typeorm';\nimport { Usuario } from './usuario.entity';\n\nexport enum AuditAction {\n  CREATE = 'create',\n  READ = 'read',\n  UPDATE = 'update',\n  DELETE = 'delete',\n  LOGIN = 'login',\n  LOGOUT = 'logout',\n  LOGIN_FAILED = 'login_failed',\n  PASSWORD_RESET = 'password_reset',\n  PASSWORD_CHANGE = 'password_change',\n  PERMISSION_DENIED = 'permission_denied',\n  TOKEN_REFRESH = 'token_refresh',\n  TOKEN_REVOKE = 'token_revoke',\n  EXPORT_DATA = 'export_data',\n  IMPORT_DATA = 'import_data',\n  SYSTEM_CONFIG = 'system_config',\n}\n\nexport enum AuditSeverity {\n  LOW = 'low',\n  MEDIUM = 'medium',\n  HIGH = 'high',\n  CRITICAL = 'critical',\n}\n\n@Entity('audit_logs')\n@Index(['usuario_id', 'created_at'])\n@Index(['action', 'created_at'])\n@Index(['severity', 'created_at'])\n@Index(['resource_type', 'resource_id'])\n@Index(['client_ip', 'created_at'])\nexport class AuditLog {\n  @PrimaryGeneratedColumn('uuid')\n  id: string;\n\n  @Column({ type: 'uuid', nullable: true })\n  usuario_id: string;\n\n  @ManyToOne(() => Usuario, { nullable: true, onDelete: 'SET NULL' })\n  @JoinColumn({ name: 'usuario_id' })\n  usuario: Usuario;\n\n  @Column({\n    type: 'enum',\n    enum: AuditAction,\n  })\n  action: AuditAction;\n\n  @Column({ type: 'varchar', length: 100 })\n  resource_type: string;\n\n  @Column({ type: 'varchar', length: 255, nullable: true })\n  resource_id: string;\n\n  @Column({ type: 'text', nullable: true })\n  description: string;\n\n  @Column({\n    type: 'enum',\n    enum: AuditSeverity,\n    default: AuditSeverity.LOW,\n  })\n  severity: AuditSeverity;\n\n  @Column({ type: 'inet', nullable: true })\n  client_ip: string;\n\n  @Column({ type: 'varchar', length: 500, nullable: true })\n  user_agent: string;\n\n  @Column({ type: 'varchar', length: 100, nullable: true })\n  session_id: string;\n\n  @Column({ type: 'varchar', length: 50, nullable: true })\n  request_method: string;\n\n  @Column({ type: 'varchar', length: 500, nullable: true })\n  request_url: string;\n\n  @Column({ type: 'integer', nullable: true })\n  response_status: number;\n\n  @Column({ type: 'integer', nullable: true })\n  response_time_ms: number;\n\n  @Column({ type: 'jsonb', nullable: true })\n  old_values: Record<string, any>;\n\n  @Column({ type: 'jsonb', nullable: true })\n  new_values: Record<string, any>;\n\n  @Column({ type: 'jsonb', nullable: true })\n  metadata: Record<string, any>;\n\n  @Column({ type: 'text', nullable: true })\n  error_message: string;\n\n  @Column({ type: 'text', nullable: true })\n  stack_trace: string;\n\n  @CreateDateColumn()\n  created_at: Date;\n\n  // Métodos utilitários\n  isSecurityEvent(): boolean {\n    const securityActions = [\n      AuditAction.LOGIN,\n      AuditAction.LOGOUT,\n      AuditAction.LOGIN_FAILED,\n      AuditAction.PASSWORD_RESET,\n      AuditAction.PASSWORD_CHANGE,\n      AuditAction.PERMISSION_DENIED,\n      AuditAction.TOKEN_REFRESH,\n      AuditAction.TOKEN_REVOKE,\n    ];\n    return securityActions.includes(this.action);\n  }\n\n  isCritical(): boolean {\n    return this.severity === AuditSeverity.CRITICAL;\n  }\n\n  isHighRisk(): boolean {\n    return [AuditSeverity.HIGH, AuditSeverity.CRITICAL].includes(this.severity);\n  }\n\n  getFormattedMessage(): string {\n    const user = this.usuario\n      ? `${this.usuario.nome} (${this.usuario.email})`\n      : 'Sistema';\n    const resource = this.resource_id\n      ? `${this.resource_type}:${this.resource_id}`\n      : this.resource_type;\n    return `${user} executou ${this.action} em ${resource}`;\n  }\n}\n"],"version":3}