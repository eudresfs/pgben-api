1e7b7f660c42b3687d8a2d1e06ae7048
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const common_1 = require("@nestjs/common");
const verificacao_papel_service_1 = require("@modules/cidadao/services/verificacao-papel.service");
const cidadao_service_1 = require("@modules/cidadao/services/cidadao.service");
const historico_conversao_papel_service_1 = require("@modules/cidadao/services/historico-conversao-papel.service");
const papel_cidadao_service_1 = require("@modules/cidadao/services/papel-cidadao.service");
const papel_cidadao_entity_1 = require("@modules/cidadao/entities/papel-cidadao.entity");
const tipo_papel_enum_1 = require("@modules/cidadao/enums/tipo-papel.enum");
const composicao_familiar_entity_1 = require("@modules/cidadao/entities/composicao-familiar.entity");
const cidadao_entity_1 = require("@modules/cidadao/entities/cidadao.entity");
describe('VerificacaoPapelService', () => {
    let service;
    let papelRepository;
    let historicoService;
    let dataSource;
    const mockCidadaoRepository = {
        findOne: jest.fn(),
    };
    const mockPapelRepository = {
        find: jest.fn(),
        findOne: jest.fn(),
        create: jest.fn(),
        save: jest.fn(),
        update: jest.fn(),
    };
    const mockComposicaoFamiliarRepository = {
        find: jest.fn(),
        findOne: jest.fn(),
    };
    const mockCidadaoService = {
        findById: jest.fn(),
    };
    const mockHistoricoService = {
        criarHistorico: jest.fn(),
    };
    const mockQueryRunner = {
        connect: jest.fn(),
        startTransaction: jest.fn(),
        commitTransaction: jest.fn(),
        rollbackTransaction: jest.fn(),
        release: jest.fn(),
        manager: {
            find: jest.fn(),
            findOne: jest.fn(),
            create: jest.fn(),
            save: jest.fn(),
            update: jest.fn(),
        },
    };
    const mockDataSource = {
        createQueryRunner: jest.fn().mockReturnValue(mockQueryRunner),
        transaction: jest.fn(),
    };
    const mockCidadao = {
        id: '550e8400-e29b-41d4-a716-446655440000',
        nome: 'João da Silva',
        cpf: '12345678901',
        email: 'joao@example.com',
    };
    const mockCidadaoResponse = {
        id: '550e8400-e29b-41d4-a716-446655440000',
        nome: 'João da Silva',
        cpf: '12345678901',
        email: 'joao@example.com',
    };
    const mockPapelCidadao = {
        id: '660e8400-e29b-41d4-a716-446655440000',
        cidadao_id: '550e8400-e29b-41d4-a716-446655440000',
        tipo_papel: tipo_papel_enum_1.TipoPapel.MEMBRO_COMPOSICAO,
        ativo: true,
        metadados: {},
        created_at: new Date(),
        updated_at: new Date(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                verificacao_papel_service_1.VerificacaoPapelService,
                {
                    provide: (0, typeorm_1.getRepositoryToken)(cidadao_entity_1.Cidadao),
                    useValue: mockCidadaoRepository,
                },
                {
                    provide: (0, typeorm_1.getRepositoryToken)(papel_cidadao_entity_1.PapelCidadao),
                    useValue: mockPapelRepository,
                },
                {
                    provide: (0, typeorm_1.getRepositoryToken)(composicao_familiar_entity_1.ComposicaoFamiliar),
                    useValue: mockComposicaoFamiliarRepository,
                },
                {
                    provide: cidadao_service_1.CidadaoService,
                    useValue: mockCidadaoService,
                },
                {
                    provide: historico_conversao_papel_service_1.HistoricoConversaoPapelService,
                    useValue: mockHistoricoService,
                },
                {
                    provide: typeorm_2.DataSource,
                    useValue: mockDataSource,
                },
                {
                    provide: papel_cidadao_service_1.PapelCidadaoService,
                    useValue: {
                        create: jest.fn(),
                        findById: jest.fn(),
                    },
                },
            ],
        }).compile();
        service = module.get(verificacao_papel_service_1.VerificacaoPapelService);
        papelRepository = module.get((0, typeorm_1.getRepositoryToken)(papel_cidadao_entity_1.PapelCidadao));
        historicoService = module.get(historico_conversao_papel_service_1.HistoricoConversaoPapelService);
        dataSource = module.get(typeorm_2.DataSource);
        jest.clearAllMocks();
    });
    it('deve estar definido', () => {
        expect(service).toBeDefined();
    });
    describe('verificarConflitoPapeis', () => {
        const cpf = '12345678901';
        const novoPapel = tipo_papel_enum_1.TipoPapel.BENEFICIARIO;
        it('deve retornar sem conflito quando não há papéis ativos', async () => {
            mockCidadaoRepository.findOne.mockResolvedValue({
                ...mockCidadao,
                papeis: [],
            });
            const result = await service.verificarConflitoPapeis(cpf);
            expect(result.temConflito).toBe(false);
            expect(result.detalhes).toBe('Nenhum papel ativo encontrado');
        });
        it('deve retornar sem conflito quando não há regras de conflito', async () => {
            mockCidadaoRepository.findOne.mockResolvedValue({
                ...mockCidadao,
                papeis: [],
            });
            const result = await service.verificarConflitoPapeis(cpf);
            expect(result.temConflito).toBe(false);
            expect(result.detalhes).toBe('Nenhum papel ativo encontrado');
        });
        it('deve detectar conflito quando há regra de conflito ativa', async () => {
            const cidadaoComPapeis = {
                ...mockCidadao,
                papeis: [
                    {
                        ...mockPapelCidadao,
                        tipo_papel: 'beneficiario',
                        ativo: true,
                    },
                    {
                        id: '2',
                        cidadao_id: mockCidadao.id,
                        tipo_papel: 'requerente',
                        ativo: true,
                    },
                ],
            };
            mockCidadaoRepository.findOne.mockResolvedValue(cidadaoComPapeis);
            const result = await service.verificarConflitoPapeis(cpf);
            expect(result.temConflito).toBe(true);
            expect(result.detalhes).toContain('beneficiário e requerente simultaneamente');
        });
        it('deve buscar cidadão com papéis', async () => {
            mockCidadaoRepository.findOne.mockResolvedValue({
                ...mockCidadao,
                papeis: [],
            });
            await service.verificarConflitoPapeis(cpf);
            expect(mockCidadaoRepository.findOne).toHaveBeenCalledWith({
                where: { cpf },
                relations: ['papeis'],
            });
        });
        it('deve retornar resultado válido quando cidadão não existe', async () => {
            mockCidadaoRepository.findOne.mockResolvedValue(null);
            const result = await service.verificarConflitoPapeis(cpf);
            expect(result.temConflito).toBe(false);
            expect(result.detalhes).toBe('Cidadão não encontrado');
        });
    });
    describe('converterParaBeneficiario', () => {
        const cidadaoId = '550e8400-e29b-41d4-a716-446655440000';
        const motivo = 'Conversão para beneficiário';
        it('deve converter um membro da composição para beneficiário', async () => {
            const novoPapel = {
                id: '880e8400-e29b-41d4-a716-446655440000',
                cidadao_id: cidadaoId,
                tipo_papel: 'beneficiario',
                ativo: true,
                metadados: {},
                created_at: new Date(),
                updated_at: new Date(),
            };
            const papelMembroComposicao = {
                ...mockPapelCidadao,
                tipo_papel: 'membro_composicao',
                ativo: true,
            };
            const cidadaoComPapeis = {
                ...mockCidadao,
                papeis: [papelMembroComposicao],
            };
            mockDataSource.transaction.mockImplementation(async (callback) => {
                const manager = {
                    findOne: jest.fn().mockResolvedValueOnce(cidadaoComPapeis), // busca do cidadão com papéis
                    find: jest.fn(),
                    update: jest.fn().mockResolvedValue({ affected: 1 }),
                    create: jest.fn().mockReturnValue(novoPapel),
                    save: jest.fn().mockResolvedValue(novoPapel),
                };
                return callback(manager);
            });
            mockHistoricoService.criarHistorico.mockResolvedValue({
                id: 'historico-id',
            });
            const result = await service.converterParaBeneficiario(cidadaoId, motivo);
            expect(result.sucesso).toBe(true);
            expect(result.mensagem).toBe('Conversão para beneficiário realizada com sucesso');
            expect(result.historicoId).toBeDefined();
            expect(mockHistoricoService.criarHistorico).toHaveBeenCalled();
        });
        it('deve lançar NotFoundException quando cidadão não existir', async () => {
            mockDataSource.transaction.mockImplementation(async (callback) => {
                const manager = {
                    findOne: jest.fn().mockResolvedValue(null),
                    find: jest.fn(),
                    update: jest.fn(),
                    create: jest.fn(),
                    save: jest.fn(),
                };
                return callback(manager);
            });
            await expect(service.converterParaBeneficiario(cidadaoId, motivo)).rejects.toThrow(common_1.NotFoundException);
        });
        it('deve lançar ConflictException quando cidadão já for beneficiário', async () => {
            const papelBeneficiario = {
                ...mockPapelCidadao,
                tipo_papel: 'beneficiario',
                ativo: true,
            };
            const cidadaoComBeneficiario = {
                ...mockCidadao,
                papeis: [papelBeneficiario],
            };
            mockDataSource.transaction.mockImplementation(async (callback) => {
                const manager = {
                    findOne: jest.fn().mockResolvedValueOnce(cidadaoComBeneficiario), // busca do cidadão com papel beneficiário
                    find: jest.fn(),
                    update: jest.fn(),
                    create: jest.fn(),
                    save: jest.fn(),
                };
                return callback(manager);
            });
            await expect(service.converterParaBeneficiario(cidadaoId, motivo)).rejects.toThrow('Cidadão já é beneficiário');
        });
        it('deve desativar papéis conflitantes durante a conversão', async () => {
            const novoPapel = {
                id: '880e8400-e29b-41d4-a716-446655440000',
                cidadao_id: cidadaoId,
                tipo_papel: 'beneficiario',
                ativo: true,
                metadados: {},
                created_at: new Date(),
                updated_at: new Date(),
            };
            const papelMembroComposicao = {
                ...mockPapelCidadao,
                tipo_papel: 'membro_composicao',
                ativo: true,
            };
            const cidadaoComPapeis = {
                ...mockCidadao,
                papeis: [papelMembroComposicao],
            };
            const mockManager = {
                findOne: jest.fn().mockResolvedValueOnce(cidadaoComPapeis), // busca do cidadão com papéis
                find: jest.fn(),
                update: jest.fn().mockResolvedValue({ affected: 1 }),
                create: jest.fn().mockReturnValue(novoPapel),
                save: jest.fn().mockResolvedValue(novoPapel),
            };
            mockDataSource.transaction.mockImplementation(async (callback) => {
                return callback(mockManager);
            });
            mockHistoricoService.criarHistorico.mockResolvedValue({
                id: 'historico-id',
            });
            await service.converterParaBeneficiario(cidadaoId, motivo);
            // Verifica se o save foi chamado duas vezes (desativar papel antigo + criar novo papel)
            expect(mockManager.save).toHaveBeenCalledTimes(2);
            // Verifica se o papel antigo foi desativado (primeira chamada)
            expect(mockManager.save).toHaveBeenNthCalledWith(1, expect.objectContaining({
                id: papelMembroComposicao.id,
                ativo: false,
            }));
            // Verifica se o novo papel foi criado (segunda chamada)
            expect(mockManager.save).toHaveBeenNthCalledWith(2, novoPapel);
        });
        it('deve criar histórico de conversão', async () => {
            const novoPapel = {
                id: '880e8400-e29b-41d4-a716-446655440000',
                cidadao_id: cidadaoId,
                tipo_papel: 'beneficiario',
                ativo: true,
                metadados: {},
                created_at: new Date(),
                updated_at: new Date(),
            };
            mockDataSource.transaction.mockImplementation(async (callback) => {
                const manager = {
                    findOne: jest
                        .fn()
                        .mockResolvedValueOnce(mockCidadao) // busca do cidadão
                        .mockResolvedValueOnce(null), // verificação de papel existente
                    find: jest.fn().mockResolvedValueOnce([mockPapelCidadao]), // papéis ativos
                    update: jest.fn().mockResolvedValue({ affected: 1 }),
                    create: jest.fn().mockReturnValue(novoPapel),
                    save: jest.fn().mockResolvedValue(novoPapel),
                };
                return callback(manager);
            });
            mockHistoricoService.criarHistorico.mockResolvedValue({});
            await service.converterParaBeneficiario(cidadaoId, motivo);
            expect(mockHistoricoService.criarHistorico).toHaveBeenCalledWith({
                cidadao_id: cidadaoId,
                papel_anterior: 'membro_composicao',
                papel_novo: 'beneficiario',
                justificativa: motivo,
            }, 'sistema');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFx0ZXN0XFx1bml0XFxjaWRhZGFvXFx2ZXJpZmljYWNhby1wYXBlbC5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsNkNBQXFEO0FBQ3JELHFDQUFpRDtBQUNqRCwyQ0FBc0U7QUFDdEUsbUdBQThGO0FBQzlGLCtFQUEyRTtBQUMzRSxtSEFBNkc7QUFDN0csMkZBQXNGO0FBQ3RGLHlGQUE4RTtBQUM5RSw0RUFBbUU7QUFFbkUscUdBQTBGO0FBQzFGLDZFQUFtRTtBQUduRSxRQUFRLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO0lBQ3ZDLElBQUksT0FBZ0MsQ0FBQztJQUNyQyxJQUFJLGVBQXlDLENBQUM7SUFDOUMsSUFBSSxnQkFBZ0QsQ0FBQztJQUNyRCxJQUFJLFVBQXNCLENBQUM7SUFFM0IsTUFBTSxxQkFBcUIsR0FBRztRQUM1QixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNuQixDQUFDO0lBRUYsTUFBTSxtQkFBbUIsR0FBRztRQUMxQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2YsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDbEIsQ0FBQztJQUVGLE1BQU0sZ0NBQWdDLEdBQUc7UUFDdkMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNuQixDQUFDO0lBRUYsTUFBTSxrQkFBa0IsR0FBRztRQUN6QixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNwQixDQUFDO0lBRUYsTUFBTSxvQkFBb0Is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QUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUM7aUJBQzdDLENBQUM7Z0JBQ0YsT0FBTyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDM0IsQ0FBQyxDQUFDLENBQUM7WUFFSCxvQkFBb0IsQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFMUQsTUFBTSxPQUFPLENBQUMseUJBQXlCLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRTNELE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxjQUFjLENBQUMsQ0FBQyxvQkFBb0IsQ0FDOUQ7Z0JBQ0UsVUFBVSxFQUFFLFNBQVM7Z0JBQ3JCLGNBQWMsRUFBRSxtQkFBbUI7Z0JBQ25DLFVBQVUsRUFBRSxjQUFjO2dCQUMxQixhQUFhLEVBQUUsTUFBTTthQUN0QixFQUNELFNBQVMsQ0FDVixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcdGVzdFxcdW5pdFxcY2lkYWRhb1xcdmVyaWZpY2FjYW8tcGFwZWwuc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgZ2V0UmVwb3NpdG9yeVRva2VuIH0gZnJvbSAnQG5lc3Rqcy90eXBlb3JtJztcbmltcG9ydCB7IFJlcG9zaXRvcnksIERhdGFTb3VyY2UgfSBmcm9tICd0eXBlb3JtJztcbmltcG9ydCB7IE5vdEZvdW5kRXhjZXB0aW9uLCBDb25mbGljdEV4Y2VwdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IFZlcmlmaWNhY2FvUGFwZWxTZXJ2aWNlIH0gZnJvbSAnQG1vZHVsZXMvY2lkYWRhby9zZXJ2aWNlcy92ZXJpZmljYWNhby1wYXBlbC5zZXJ2aWNlJztcbmltcG9ydCB7IENpZGFkYW9TZXJ2aWNlIH0gZnJvbSAnQG1vZHVsZXMvY2lkYWRhby9zZXJ2aWNlcy9jaWRhZGFvLnNlcnZpY2UnO1xuaW1wb3J0IHsgSGlzdG9yaWNvQ29udmVyc2FvUGFwZWxTZXJ2aWNlIH0gZnJvbSAnQG1vZHVsZXMvY2lkYWRhby9zZXJ2aWNlcy9oaXN0b3JpY28tY29udmVyc2FvLXBhcGVsLnNlcnZpY2UnO1xuaW1wb3J0IHsgUGFwZWxDaWRhZGFvU2VydmljZSB9IGZyb20gJ0Btb2R1bGVzL2NpZGFkYW8vc2VydmljZXMvcGFwZWwtY2lkYWRhby5zZXJ2aWNlJztcbmltcG9ydCB7IFBhcGVsQ2lkYWRhbyB9IGZyb20gJ0Btb2R1bGVzL2NpZGFkYW8vZW50aXRpZXMvcGFwZWwtY2lkYWRhby5lbnRpdHknO1xuaW1wb3J0IHsgVGlwb1BhcGVsIH0gZnJvbSAnQG1vZHVsZXMvY2lkYWRhby9lbnVtcy90aXBvLXBhcGVsLmVudW0nO1xuaW1wb3J0IHsgUmVncmFDb25mbGl0b1BhcGVsIH0gZnJvbSAnQG1vZHVsZXMvY2lkYWRhby9lbnRpdGllcy9yZWdyYS1jb25mbGl0by1wYXBlbC5lbnRpdHknO1xuaW1wb3J0IHsgQ29tcG9zaWNhb0ZhbWlsaWFyIH0gZnJvbSAnQG1vZHVsZXMvY2lkYWRhby9lbnRpdGllcy9jb21wb3NpY2FvLWZhbWlsaWFyLmVudGl0eSc7XG5pbXBvcnQgeyBDaWRhZGFvIH0gZnJvbSAnQG1vZHVsZXMvY2lkYWRhby9lbnRpdGllcy9jaWRhZGFvLmVudGl0eSc7XG5pbXBvcnQgeyBDaWRhZGFvUmVzcG9uc2VEdG8gfSBmcm9tICdAbW9kdWxlcy9jaWRhZGFvL2R0by9jaWRhZGFvLXJlc3BvbnNlLmR0byc7XG5cbmRlc2NyaWJlKCdWZXJpZmljYWNhb1BhcGVsU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IFZlcmlmaWNhY2FvUGFwZWxTZXJ2aWNlO1xuICBsZXQgcGFwZWxSZXBvc2l0b3J5OiBSZXBvc2l0b3J5PFBhcGVsQ2lkYWRhbz47XG4gIGxldCBoaXN0b3JpY29TZXJ2aWNlOiBIaXN0b3JpY29Db252ZXJzYW9QYXBlbFNlcnZpY2U7XG4gIGxldCBkYXRhU291cmNlOiBEYXRhU291cmNlO1xuXG4gIGNvbnN0IG1vY2tDaWRhZGFvUmVwb3NpdG9yeSA9IHtcbiAgICBmaW5kT25lOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgY29uc3QgbW9ja1BhcGVsUmVwb3NpdG9yeSA9IHtcbiAgICBmaW5kOiBqZXN0LmZuKCksXG4gICAgZmluZE9uZTogamVzdC5mbigpLFxuICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgIHNhdmU6IGplc3QuZm4oKSxcbiAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgfTtcblxuICBjb25zdCBtb2NrQ29tcG9zaWNhb0ZhbWlsaWFyUmVwb3NpdG9yeSA9IHtcbiAgICBmaW5kOiBqZXN0LmZuKCksXG4gICAgZmluZE9uZTogamVzdC5mbigpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tDaWRhZGFvU2VydmljZSA9IHtcbiAgICBmaW5kQnlJZDogamVzdC5mbigpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tIaXN0b3JpY29TZXJ2aWNlID0ge1xuICAgIGNyaWFySGlzdG9yaWNvOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgY29uc3QgbW9ja1F1ZXJ5UnVubmVyID0ge1xuICAgIGNvbm5lY3Q6IGplc3QuZm4oKSxcbiAgICBzdGFydFRyYW5zYWN0aW9uOiBqZXN0LmZuKCksXG4gICAgY29tbWl0VHJhbnNhY3Rpb246IGplc3QuZm4oKSxcbiAgICByb2xsYmFja1RyYW5zYWN0aW9uOiBqZXN0LmZuKCksXG4gICAgcmVsZWFzZTogamVzdC5mbigpLFxuICAgIG1hbmFnZXI6IHtcbiAgICAgIGZpbmQ6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRPbmU6IGplc3QuZm4oKSxcbiAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgICAgc2F2ZTogamVzdC5mbigpLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCBtb2NrRGF0YVNvdXJjZSA9IHtcbiAgICBjcmVhdGVRdWVyeVJ1bm5lcjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShtb2NrUXVlcnlSdW5uZXIpLFxuICAgIHRyYW5zYWN0aW9uOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgY29uc3QgbW9ja0NpZGFkYW86IENpZGFkYW8gPSB7XG4gICAgaWQ6ICc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnLFxuICAgIG5vbWU6ICdKb8OjbyBkYSBTaWx2YScsXG4gICAgY3BmOiAnMTIzNDU2Nzg5MDEnLFxuICAgIGVtYWlsOiAnam9hb0BleGFtcGxlLmNvbScsXG4gIH0gYXMgQ2lkYWRhbztcblxuICBjb25zdCBtb2NrQ2lkYWRhb1Jlc3BvbnNlOiBDaWRhZGFvUmVzcG9uc2VEdG8gPSB7XG4gICAgaWQ6ICc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnLFxuICAgIG5vbWU6ICdKb8OjbyBkYSBTaWx2YScsXG4gICAgY3BmOiAnMTIzNDU2Nzg5MDEnLFxuICAgIGVtYWlsOiAnam9hb0BleGFtcGxlLmNvbScsXG4gIH0gYXMgQ2lkYWRhb1Jlc3BvbnNlRHRvO1xuXG4gIGNvbnN0IG1vY2tQYXBlbENpZGFkYW86IFBhcGVsQ2lkYWRhbyA9IHtcbiAgICBpZDogJzY2MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsXG4gICAgY2lkYWRhb19pZDogJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsXG4gICAgdGlwb19wYXBlbDogVGlwb1BhcGVsLk1FTUJST19DT01QT1NJQ0FPLFxuICAgIGF0aXZvOiB0cnVlLFxuICAgIG1ldGFkYWRvczoge30sXG4gICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKSxcbiAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICB9IGFzIFBhcGVsQ2lkYWRhbztcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIFZlcmlmaWNhY2FvUGFwZWxTZXJ2aWNlLFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogZ2V0UmVwb3NpdG9yeVRva2VuKENpZGFkYW8pLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQ2lkYWRhb1JlcG9zaXRvcnksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBnZXRSZXBvc2l0b3J5VG9rZW4oUGFwZWxDaWRhZGFvKSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja1BhcGVsUmVwb3NpdG9yeSxcbiAgICAgICAgfSxcblxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogZ2V0UmVwb3NpdG9yeVRva2VuKENvbXBvc2ljYW9GYW1pbGlhciksXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tDb21wb3NpY2FvRmFtaWxpYXJSZXBvc2l0b3J5LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQ2lkYWRhb1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tDaWRhZGFvU2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IEhpc3Rvcmljb0NvbnZlcnNhb1BhcGVsU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0hpc3Rvcmljb1NlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBEYXRhU291cmNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrRGF0YVNvdXJjZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFBhcGVsQ2lkYWRhb1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgICAgICAgICAgZmluZEJ5SWQ6IGplc3QuZm4oKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldDxWZXJpZmljYWNhb1BhcGVsU2VydmljZT4oVmVyaWZpY2FjYW9QYXBlbFNlcnZpY2UpO1xuICAgIHBhcGVsUmVwb3NpdG9yeSA9IG1vZHVsZS5nZXQ8UmVwb3NpdG9yeTxQYXBlbENpZGFkYW8+PihcbiAgICAgIGdldFJlcG9zaXRvcnlUb2tlbihQYXBlbENpZGFkYW8pLFxuICAgICk7XG5cbiAgICBoaXN0b3JpY29TZXJ2aWNlID0gbW9kdWxlLmdldDxIaXN0b3JpY29Db252ZXJzYW9QYXBlbFNlcnZpY2U+KFxuICAgICAgSGlzdG9yaWNvQ29udmVyc2FvUGFwZWxTZXJ2aWNlLFxuICAgICk7XG4gICAgZGF0YVNvdXJjZSA9IG1vZHVsZS5nZXQ8RGF0YVNvdXJjZT4oRGF0YVNvdXJjZSk7XG5cbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgaXQoJ2RldmUgZXN0YXIgZGVmaW5pZG8nLCAoKSA9PiB7XG4gICAgZXhwZWN0KHNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2ZXJpZmljYXJDb25mbGl0b1BhcGVpcycsICgpID0+IHtcbiAgICBjb25zdCBjcGYgPSAnMTIzNDU2Nzg5MDEnO1xuICAgIGNvbnN0IG5vdm9QYXBlbCA9IFRpcG9QYXBlbC5CRU5FRklDSUFSSU87XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBzZW0gY29uZmxpdG8gcXVhbmRvIG7Do28gaMOhIHBhcMOpaXMgYXRpdm9zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0NpZGFkYW9SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrQ2lkYWRhbyxcbiAgICAgICAgcGFwZWlzOiBbXSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnZlcmlmaWNhckNvbmZsaXRvUGFwZWlzKGNwZik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudGVtQ29uZmxpdG8pLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kZXRhbGhlcykudG9CZSgnTmVuaHVtIHBhcGVsIGF0aXZvIGVuY29udHJhZG8nKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIHNlbSBjb25mbGl0byBxdWFuZG8gbsOjbyBow6EgcmVncmFzIGRlIGNvbmZsaXRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0NpZGFkYW9SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrQ2lkYWRhbyxcbiAgICAgICAgcGFwZWlzOiBbXSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnZlcmlmaWNhckNvbmZsaXRvUGFwZWlzKGNwZik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudGVtQ29uZmxpdG8pLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kZXRhbGhlcykudG9CZSgnTmVuaHVtIHBhcGVsIGF0aXZvIGVuY29udHJhZG8nKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGRldGVjdGFyIGNvbmZsaXRvIHF1YW5kbyBow6EgcmVncmEgZGUgY29uZmxpdG8gYXRpdmEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjaWRhZGFvQ29tUGFwZWlzID0ge1xuICAgICAgICAuLi5tb2NrQ2lkYWRhbyxcbiAgICAgICAgcGFwZWlzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgLi4ubW9ja1BhcGVsQ2lkYWRhbyxcbiAgICAgICAgICAgIHRpcG9fcGFwZWw6ICdiZW5lZmljaWFyaW8nLFxuICAgICAgICAgICAgYXRpdm86IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZDogJzInLFxuICAgICAgICAgICAgY2lkYWRhb19pZDogbW9ja0NpZGFkYW8uaWQsXG4gICAgICAgICAgICB0aXBvX3BhcGVsOiAncmVxdWVyZW50ZScsXG4gICAgICAgICAgICBhdGl2bzogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfTtcblxuICAgICAgbW9ja0NpZGFkYW9SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoY2lkYWRhb0NvbVBhcGVpcyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudmVyaWZpY2FyQ29uZmxpdG9QYXBlaXMoY3BmKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC50ZW1Db25mbGl0bykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGV0YWxoZXMpLnRvQ29udGFpbihcbiAgICAgICAgJ2JlbmVmaWNpw6FyaW8gZSByZXF1ZXJlbnRlIHNpbXVsdGFuZWFtZW50ZScsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgYnVzY2FyIGNpZGFkw6NvIGNvbSBwYXDDqWlzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0NpZGFkYW9SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrQ2lkYWRhbyxcbiAgICAgICAgcGFwZWlzOiBbXSxcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnZlcmlmaWNhckNvbmZsaXRvUGFwZWlzKGNwZik7XG5cbiAgICAgIGV4cGVjdChtb2NrQ2lkYWRhb1JlcG9zaXRvcnkuZmluZE9uZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBjcGYgfSxcbiAgICAgICAgcmVsYXRpb25zOiBbJ3BhcGVpcyddLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciByZXN1bHRhZG8gdsOhbGlkbyBxdWFuZG8gY2lkYWTDo28gbsOjbyBleGlzdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQ2lkYWRhb1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52ZXJpZmljYXJDb25mbGl0b1BhcGVpcyhjcGYpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnRlbUNvbmZsaXRvKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGV0YWxoZXMpLnRvQmUoJ0NpZGFkw6NvIG7Do28gZW5jb250cmFkbycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29udmVydGVyUGFyYUJlbmVmaWNpYXJpbycsICgpID0+IHtcbiAgICBjb25zdCBjaWRhZGFvSWQgPSAnNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwJztcbiAgICBjb25zdCBtb3Rpdm8gPSAnQ29udmVyc8OjbyBwYXJhIGJlbmVmaWNpw6FyaW8nO1xuXG4gICAgaXQoJ2RldmUgY29udmVydGVyIHVtIG1lbWJybyBkYSBjb21wb3Npw6fDo28gcGFyYSBiZW5lZmljacOhcmlvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgbm92b1BhcGVsID0ge1xuICAgICAgICBpZDogJzg4MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsXG4gICAgICAgIGNpZGFkYW9faWQ6IGNpZGFkYW9JZCxcbiAgICAgICAgdGlwb19wYXBlbDogJ2JlbmVmaWNpYXJpbycsXG4gICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICBtZXRhZGFkb3M6IHt9LFxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSBhcyBQYXBlbENpZGFkYW87XG5cbiAgICAgIGNvbnN0IHBhcGVsTWVtYnJvQ29tcG9zaWNhbyA9IHtcbiAgICAgICAgLi4ubW9ja1BhcGVsQ2lkYWRhbyxcbiAgICAgICAgdGlwb19wYXBlbDogJ21lbWJyb19jb21wb3NpY2FvJyxcbiAgICAgICAgYXRpdm86IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBjaWRhZGFvQ29tUGFwZWlzID0ge1xuICAgICAgICAuLi5tb2NrQ2lkYWRhbyxcbiAgICAgICAgcGFwZWlzOiBbcGFwZWxNZW1icm9Db21wb3NpY2FvXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tEYXRhU291cmNlLnRyYW5zYWN0aW9uLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY2FsbGJhY2spID0+IHtcbiAgICAgICAgY29uc3QgbWFuYWdlciA9IHtcbiAgICAgICAgICBmaW5kT25lOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWVPbmNlKGNpZGFkYW9Db21QYXBlaXMpLCAvLyBidXNjYSBkbyBjaWRhZMOjbyBjb20gcGFww6lpc1xuICAgICAgICAgIGZpbmQ6IGplc3QuZm4oKSxcbiAgICAgICAgICB1cGRhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGFmZmVjdGVkOiAxIH0pLFxuICAgICAgICAgIGNyZWF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShub3ZvUGFwZWwpLFxuICAgICAgICAgIHNhdmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShub3ZvUGFwZWwpLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sobWFuYWdlcik7XG4gICAgICB9KTtcblxuICAgICAgbW9ja0hpc3Rvcmljb1NlcnZpY2UuY3JpYXJIaXN0b3JpY28ubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ2hpc3Rvcmljby1pZCcsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jb252ZXJ0ZXJQYXJhQmVuZWZpY2lhcmlvKGNpZGFkYW9JZCwgbW90aXZvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNlc3NvKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZW5zYWdlbSkudG9CZShcbiAgICAgICAgJ0NvbnZlcnPDo28gcGFyYSBiZW5lZmljacOhcmlvIHJlYWxpemFkYSBjb20gc3VjZXNzbycsXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5oaXN0b3JpY29JZCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrSGlzdG9yaWNvU2VydmljZS5jcmlhckhpc3RvcmljbykudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbGFuw6dhciBOb3RGb3VuZEV4Y2VwdGlvbiBxdWFuZG8gY2lkYWTDo28gbsOjbyBleGlzdGlyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0RhdGFTb3VyY2UudHJhbnNhY3Rpb24ubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjYWxsYmFjaykgPT4ge1xuICAgICAgICBjb25zdCBtYW5hZ2VyID0ge1xuICAgICAgICAgIGZpbmRPbmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKSxcbiAgICAgICAgICBmaW5kOiBqZXN0LmZuKCksXG4gICAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICAgICAgc2F2ZTogamVzdC5mbigpLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sobWFuYWdlcik7XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLmNvbnZlcnRlclBhcmFCZW5lZmljaWFyaW8oY2lkYWRhb0lkLCBtb3Rpdm8pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbGFuw6dhciBDb25mbGljdEV4Y2VwdGlvbiBxdWFuZG8gY2lkYWTDo28gasOhIGZvciBiZW5lZmljacOhcmlvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGFwZWxCZW5lZmljaWFyaW8gPSB7XG4gICAgICAgIC4uLm1vY2tQYXBlbENpZGFkYW8sXG4gICAgICAgIHRpcG9fcGFwZWw6ICdiZW5lZmljaWFyaW8nLFxuICAgICAgICBhdGl2bzogdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNpZGFkYW9Db21CZW5lZmljaWFyaW8gPSB7XG4gICAgICAgIC4uLm1vY2tDaWRhZGFvLFxuICAgICAgICBwYXBlaXM6IFtwYXBlbEJlbmVmaWNpYXJpb10sXG4gICAgICB9O1xuXG4gICAgICBtb2NrRGF0YVNvdXJjZS50cmFuc2FjdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hbmFnZXIgPSB7XG4gICAgICAgICAgZmluZE9uZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlT25jZShjaWRhZGFvQ29tQmVuZWZpY2lhcmlvKSwgLy8gYnVzY2EgZG8gY2lkYWTDo28gY29tIHBhcGVsIGJlbmVmaWNpw6FyaW9cbiAgICAgICAgICBmaW5kOiBqZXN0LmZuKCksXG4gICAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICAgICAgc2F2ZTogamVzdC5mbigpLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sobWFuYWdlcik7XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLmNvbnZlcnRlclBhcmFCZW5lZmljaWFyaW8oY2lkYWRhb0lkLCBtb3Rpdm8pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ0NpZGFkw6NvIGrDoSDDqSBiZW5lZmljacOhcmlvJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBkZXNhdGl2YXIgcGFww6lpcyBjb25mbGl0YW50ZXMgZHVyYW50ZSBhIGNvbnZlcnPDo28nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBub3ZvUGFwZWwgPSB7XG4gICAgICAgIGlkOiAnODgwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwJyxcbiAgICAgICAgY2lkYWRhb19pZDogY2lkYWRhb0lkLFxuICAgICAgICB0aXBvX3BhcGVsOiAnYmVuZWZpY2lhcmlvJyxcbiAgICAgICAgYXRpdm86IHRydWUsXG4gICAgICAgIG1ldGFkYWRvczoge30sXG4gICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gICAgICB9IGFzIFBhcGVsQ2lkYWRhbztcblxuICAgICAgY29uc3QgcGFwZWxNZW1icm9Db21wb3NpY2FvID0ge1xuICAgICAgICAuLi5tb2NrUGFwZWxDaWRhZGFvLFxuICAgICAgICB0aXBvX3BhcGVsOiAnbWVtYnJvX2NvbXBvc2ljYW8nLFxuICAgICAgICBhdGl2bzogdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNpZGFkYW9Db21QYXBlaXMgPSB7XG4gICAgICAgIC4uLm1vY2tDaWRhZGFvLFxuICAgICAgICBwYXBlaXM6IFtwYXBlbE1lbWJyb0NvbXBvc2ljYW9dLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja01hbmFnZXIgPSB7XG4gICAgICAgIGZpbmRPbmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoY2lkYWRhb0NvbVBhcGVpcyksIC8vIGJ1c2NhIGRvIGNpZGFkw6NvIGNvbSBwYXDDqWlzXG4gICAgICAgIGZpbmQ6IGplc3QuZm4oKSxcbiAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBhZmZlY3RlZDogMSB9KSxcbiAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG5vdm9QYXBlbCksXG4gICAgICAgIHNhdmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShub3ZvUGFwZWwpLFxuICAgICAgfTtcblxuICAgICAgbW9ja0RhdGFTb3VyY2UudHJhbnNhY3Rpb24ubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjYWxsYmFjaykgPT4ge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sobW9ja01hbmFnZXIpO1xuICAgICAgfSk7XG5cbiAgICAgIG1vY2tIaXN0b3JpY29TZXJ2aWNlLmNyaWFySGlzdG9yaWNvLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6ICdoaXN0b3JpY28taWQnLFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuY29udmVydGVyUGFyYUJlbmVmaWNpYXJpbyhjaWRhZGFvSWQsIG1vdGl2byk7XG5cbiAgICAgIC8vIFZlcmlmaWNhIHNlIG8gc2F2ZSBmb2kgY2hhbWFkbyBkdWFzIHZlemVzIChkZXNhdGl2YXIgcGFwZWwgYW50aWdvICsgY3JpYXIgbm92byBwYXBlbClcbiAgICAgIGV4cGVjdChtb2NrTWFuYWdlci5zYXZlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG5cbiAgICAgIC8vIFZlcmlmaWNhIHNlIG8gcGFwZWwgYW50aWdvIGZvaSBkZXNhdGl2YWRvIChwcmltZWlyYSBjaGFtYWRhKVxuICAgICAgZXhwZWN0KG1vY2tNYW5hZ2VyLnNhdmUpLnRvSGF2ZUJlZW5OdGhDYWxsZWRXaXRoKFxuICAgICAgICAxLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgaWQ6IHBhcGVsTWVtYnJvQ29tcG9zaWNhby5pZCxcbiAgICAgICAgICBhdGl2bzogZmFsc2UsXG4gICAgICAgIH0pLFxuICAgICAgKTtcblxuICAgICAgLy8gVmVyaWZpY2Egc2UgbyBub3ZvIHBhcGVsIGZvaSBjcmlhZG8gKHNlZ3VuZGEgY2hhbWFkYSlcbiAgICAgIGV4cGVjdChtb2NrTWFuYWdlci5zYXZlKS50b0hhdmVCZWVuTnRoQ2FsbGVkV2l0aCgyLCBub3ZvUGFwZWwpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgY3JpYXIgaGlzdMOzcmljbyBkZSBjb252ZXJzw6NvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgbm92b1BhcGVsID0ge1xuICAgICAgICBpZDogJzg4MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsXG4gICAgICAgIGNpZGFkYW9faWQ6IGNpZGFkYW9JZCxcbiAgICAgICAgdGlwb19wYXBlbDogJ2JlbmVmaWNpYXJpbycsXG4gICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICBtZXRhZGFkb3M6IHt9LFxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSBhcyBQYXBlbENpZGFkYW87XG5cbiAgICAgIG1vY2tEYXRhU291cmNlLnRyYW5zYWN0aW9uLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY2FsbGJhY2spID0+IHtcbiAgICAgICAgY29uc3QgbWFuYWdlciA9IHtcbiAgICAgICAgICBmaW5kT25lOiBqZXN0XG4gICAgICAgICAgICAuZm4oKVxuICAgICAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShtb2NrQ2lkYWRhbykgLy8gYnVzY2EgZG8gY2lkYWTDo29cbiAgICAgICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobnVsbCksIC8vIHZlcmlmaWNhw6fDo28gZGUgcGFwZWwgZXhpc3RlbnRlXG4gICAgICAgICAgZmluZDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlT25jZShbbW9ja1BhcGVsQ2lkYWRhb10pLCAvLyBwYXDDqWlzIGF0aXZvc1xuICAgICAgICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgYWZmZWN0ZWQ6IDEgfSksXG4gICAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG5vdm9QYXBlbCksXG4gICAgICAgICAgc2F2ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG5vdm9QYXBlbCksXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtYW5hZ2VyKTtcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrSGlzdG9yaWNvU2VydmljZS5jcmlhckhpc3Rvcmljby5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuY29udmVydGVyUGFyYUJlbmVmaWNpYXJpbyhjaWRhZGFvSWQsIG1vdGl2byk7XG5cbiAgICAgIGV4cGVjdChtb2NrSGlzdG9yaWNvU2VydmljZS5jcmlhckhpc3RvcmljbykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIHtcbiAgICAgICAgICBjaWRhZGFvX2lkOiBjaWRhZGFvSWQsXG4gICAgICAgICAgcGFwZWxfYW50ZXJpb3I6ICdtZW1icm9fY29tcG9zaWNhbycsXG4gICAgICAgICAgcGFwZWxfbm92bzogJ2JlbmVmaWNpYXJpbycsXG4gICAgICAgICAganVzdGlmaWNhdGl2YTogbW90aXZvLFxuICAgICAgICB9LFxuICAgICAgICAnc2lzdGVtYScsXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9