7044b093e1dc4e9f74f1bce8d6804ea8
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var HybridCacheService_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", { value: true });
exports.HybridCacheService = void 0;
const common_1 = require("@nestjs/common");
const config_1 = require("@nestjs/config");
const schedule_1 = require("@nestjs/schedule");
const health_check_service_1 = require("./health-check.service");
const cache_service_1 = require("../cache/cache.service");
/**
 * Serviço de Cache Híbrido Resiliente
 *
 * Implementa um sistema de cache em múltiplas camadas com estratégias de resiliência:
 *
 * L1 Cache (Memória Local):
 * - Cache em memória ultra-rápido
 * - Limitado por tamanho configurável
 * - Algoritmo LRU com prioridades
 * - Sempre disponível
 *
 * L2 Cache (Redis):
 * - Cache distribuído persistente
 * - Compartilhado entre instâncias
 * - Fallback automático para L1 em caso de falha
 * - Circuit breaker integrado
 *
 * Funcionalidades de Resiliência:
 * - Cache warming automático
 * - Prevenção de cache stampede
 * - Métricas detalhadas
 * - Recuperação automática
 */
let HybridCacheService = HybridCacheService_1 = class HybridCacheService {
    configService;
    healthCheckService;
    cacheService;
    logger = new common_1.Logger(HybridCacheService_1.name);
    // L1 Cache (Memória Local)
    l1Cache = new Map();
    maxL1Size;
    defaultTtl;
    // Configurações
    enableL2Cache;
    enableCacheWarming;
    warmingInterval;
    // Métricas
    metrics = {
        l1Hits: 0,
        l1Misses: 0,
        l2Hits: 0,
        l2Misses: 0,
        evictions: 0,
        warmingOperations: 0,
        failovers: 0,
    };
    // Cache warming - chaves críticas que devem estar sempre em cache
    criticalKeys = new Set();
    warmingCallbacks = new Map();
    // Prevenção de cache stampede
    pendingOperations = new Map();
    constructor(configService, healthCheckService, cacheService) {
        this.configService = configService;
        this.healthCheckService = healthCheckService;
        this.cacheService = cacheService;
        this.maxL1Size = this.configService.get('CACHE_L1_MAX_SIZE', 1000);
        this.defaultTtl = this.configService.get('CACHE_DEFAULT_TTL', 300000); // 5 minutos
        this.enableL2Cache =
            this.configService.get('CACHE_ENABLE_L2', 'true') === 'true';
        this.enableCacheWarming =
            this.configService.get('CACHE_ENABLE_WARMING', 'true') === 'true';
        this.warmingInterval = this.configService.get('CACHE_WARMING_INTERVAL', 60000); // 1 minuto
    }
    async onModuleInit() {
        this.logger.log('Inicializando Hybrid Cache Service');
        // TEMPORÁRIO: Desabilitando inicialização para evitar travamento
        this.logger.warn('⚠️ Inicialização do HybridCacheService desabilitada temporariamente');
        // TODO: Reabilitar após resolver problemas de conectividade com Redis
        /*
        if (this.enableCacheWarming) {
          this.logger.log('Cache warming habilitado');
        }
        
        // Registrar chaves críticas padrão
        this.registerCriticalKey('system:config', async () => {
          // Exemplo: carregar configurações do sistema
          return { loaded: true, timestamp: Date.now() };
        });
        */
    }
    /**
     * Obtém valor do cache com estratégia híbrida
     *
     * Fluxo:
     * 1. Verifica L1 Cache (memória local)
     * 2. Se não encontrar, verifica L2 Cache (Redis)
     * 3. Se encontrar no L2, promove para L1
     * 4. Se não encontrar em nenhum, retorna null
     *
     * @param key Chave do cache
     * @returns Valor do cache ou null
     */
    async get(key) {
        const startTime = Date.now();
        try {
            // L1 Cache (Memória Local)
            const l1Result = this.getFromL1(key);
            if (l1Result !== null) {
                this.metrics.l1Hits++;
                this.logger.debug(`L1 Cache HIT para '${key}' em ${Date.now() - startTime}ms`);
                return l1Result;
            }
            this.metrics.l1Misses++;
            // L2 Cache (Redis) - apenas se habilitado e disponível
            if (this.enableL2Cache && (await this.isL2Available())) {
                const l2Result = await this.getFromL2(key);
                if (l2Result !== null) {
                    this.metrics.l2Hits++;
                    // Promover para L1 Cache
                    this.setToL1(key, l2Result, this.defaultTtl, 'medium');
                    this.logger.debug(`L2 Cache HIT para '${key}' em ${Date.now() - startTime}ms`);
                    return l2Result;
                }
                this.metrics.l2Misses++;
            }
            this.logger.debug(`Cache MISS para '${key}' em ${Date.now() - startTime}ms`);
            return null;
        }
        catch (error) {
            this.logger.error(`Erro ao obter cache para '${key}': ${error.message}`);
            return null;
        }
    }
    /**
     * Define valor no cache com estratégia híbrida
     *
     * @param key Chave do cache
     * @param value Valor a ser armazenado
     * @param ttl TTL em milissegundos (opcional)
     * @param priority Prioridade do cache (opcional)
     */
    async set(key, value, ttl = this.defaultTtl, priority = 'medium') {
        try {
            // Sempre armazenar no L1 Cache
            this.setToL1(key, value, ttl, priority);
            // Armazenar no L2 Cache se disponível
            if (this.enableL2Cache && (await this.isL2Available())) {
                await this.setToL2(key, value, ttl);
            }
            this.logger.debug(`Cache SET para '${key}' com TTL ${ttl}ms e prioridade ${priority}`);
        }
        catch (error) {
            this.logger.error(`Erro ao definir cache para '${key}': ${error.message}`);
            // Não propagar erro - cache não deve quebrar a aplicação
        }
    }
    /**
     * Remove valor do cache
     */
    async del(key) {
        try {
            // Remover do L1 Cache
            this.l1Cache.delete(key);
            // Remover do L2 Cache se disponível
            if (this.enableL2Cache && (await this.isL2Available())) {
                await this.cacheService.del(key);
            }
            this.logger.debug(`Cache DEL para '${key}'`);
        }
        catch (error) {
            this.logger.error(`Erro ao remover cache para '${key}': ${error.message}`);
        }
    }
    /**
     * Verifica se uma chave existe no cache
     */
    async has(key) {
        try {
            // Verificar L1 Cache
            if (this.hasInL1(key)) {
                return true;
            }
            // Verificar L2 Cache se disponível
            if (this.enableL2Cache && (await this.isL2Available())) {
                return await this.cacheService.has(key);
            }
            return false;
        }
        catch (error) {
            this.logger.error(`Erro ao verificar cache para '${key}': ${error.message}`);
            return false;
        }
    }
    /**
     * Obtém ou define valor no cache com prevenção de cache stampede
     *
     * @param key Chave do cache
     * @param factory Função para gerar o valor se não estiver em cache
     * @param ttl TTL em milissegundos
     * @param priority Prioridade do cache
     */
    async getOrSet(key, factory, ttl = this.defaultTtl, priority = 'medium') {
        // Verificar se já existe no cache
        const cached = await this.get(key);
        if (cached !== null) {
            return cached;
        }
        // Prevenção de cache stampede
        const pendingKey = `pending:${key}`;
        if (this.pendingOperations.has(pendingKey)) {
            this.logger.debug(`Aguardando operação pendente para '${key}'`);
            return await this.pendingOperations.get(pendingKey);
        }
        // Criar nova operação
        const operation = this.executeFactory(key, factory, ttl, priority);
        this.pendingOperations.set(pendingKey, operation);
        try {
            const result = await operation;
            return result;
        }
        finally {
            this.pendingOperations.delete(pendingKey);
        }
    }
    /**
     * Executa factory e armazena resultado no cache
     */
    async executeFactory(key, factory, ttl, priority) {
        try {
            const result = await factory();
            await this.set(key, result, ttl, priority);
            return result;
        }
        catch (error) {
            this.logger.error(`Erro ao executar factory para '${key}': ${error.message}`);
            throw error;
        }
    }
    /**
     * Registra chave crítica para cache warming
     */
    registerCriticalKey(key, factory) {
        this.criticalKeys.add(key);
        this.warmingCallbacks.set(key, factory);
        this.logger.debug(`Chave crítica registrada: ${key}`);
    }
    /**
     * Remove chave crítica
     */
    unregisterCriticalKey(key) {
        this.criticalKeys.delete(key);
        this.warmingCallbacks.delete(key);
        this.logger.debug(`Chave crítica removida: ${key}`);
    }
    /**
     * Job de cache warming - executa periodicamente
     */
    async performCacheWarming() {
        if (!this.enableCacheWarming || this.criticalKeys.size === 0) {
            return;
        }
        this.logger.debug('Iniciando cache warming');
        let warmedCount = 0;
        for (const key of this.criticalKeys) {
            try {
                const factory = this.warmingCallbacks.get(key);
                if (!factory) {
                    continue;
                }
                // Verificar se precisa de warming (não existe ou está próximo do vencimento)
                const needsWarming = await this.needsCacheWarming(key);
                if (needsWarming) {
                    await this.getOrSet(key, factory, this.defaultTtl * 2, 'critical'); // TTL maior para chaves críticas
                    warmedCount++;
                    this.metrics.warmingOperations++;
                }
            }
            catch (error) {
                this.logger.warn(`Erro no cache warming para '${key}': ${error.message}`);
            }
        }
        if (warmedCount > 0) {
            this.logger.debug(`Cache warming concluído: ${warmedCount} chaves aquecidas`);
        }
    }
    /**
     * Verifica se uma chave precisa de cache warming
     */
    async needsCacheWarming(key) {
        const entry = this.l1Cache.get(key);
        if (!entry) {
            return true; // Não existe, precisa de warming
        }
        const now = Date.now();
        const timeToExpire = entry.createdAt + entry.ttl - now;
        const warmingThreshold = entry.ttl * 0.2; // 20% do TTL
        return timeToExpire <= warmingThreshold;
    }
    /**
     * Limpa cache expirado - executa periodicamente
     */
    async cleanupExpiredCache() {
        const now = Date.now();
        let cleanedCount = 0;
        for (const [key, entry] of this.l1Cache.entries()) {
            if (now > entry.createdAt + entry.ttl) {
                this.l1Cache.delete(key);
                cleanedCount++;
            }
        }
        if (cleanedCount > 0) {
            this.logger.debug(`Limpeza de cache: ${cleanedCount} entradas removidas`);
        }
    }
    // Métodos privados para L1 Cache
    getFromL1(key) {
        const entry = this.l1Cache.get(key);
        if (!entry) {
            return null;
        }
        const now = Date.now();
        // Verificar se expirou
        if (now > entry.createdAt + entry.ttl) {
            this.l1Cache.delete(key);
            return null;
        }
        // Atualizar estatísticas de acesso
        entry.accessCount++;
        entry.lastAccessed = now;
        return entry.value;
    }
    setToL1(key, value, ttl, priority) {
        // Verificar se precisa fazer eviction
        if (this.l1Cache.size >= this.maxL1Size) {
            this.evictL1Cache();
        }
        const now = Date.now();
        this.l1Cache.set(key, {
            value,
            ttl,
            createdAt: now,
            accessCount: 0,
            lastAccessed: now,
            priority,
        });
    }
    hasInL1(key) {
        const entry = this.l1Cache.get(key);
        if (!entry) {
            return false;
        }
        const now = Date.now();
        // Verificar se expirou
        if (now > entry.createdAt + entry.ttl) {
            this.l1Cache.delete(key);
            return false;
        }
        return true;
    }
    /**
     * Algoritmo de eviction LRU com prioridades
     */
    evictL1Cache() {
        const priorityOrder = ['low', 'medium', 'high', 'critical'];
        for (const priority of priorityOrder) {
            const candidates = Array.from(this.l1Cache.entries())
                .filter(([_, entry]) => entry.priority === priority)
                .sort((a, b) => a[1].lastAccessed - b[1].lastAccessed); // LRU
            if (candidates.length > 0) {
                const [keyToEvict] = candidates[0];
                this.l1Cache.delete(keyToEvict);
                this.metrics.evictions++;
                this.logger.debug(`Cache eviction: removida chave '${keyToEvict}' com prioridade ${priority}`);
                return;
            }
        }
    }
    // Métodos privados para L2 Cache
    async getFromL2(key) {
        try {
            return await this.cacheService.get(key);
        }
        catch (error) {
            this.logger.warn(`Erro ao acessar L2 Cache para '${key}': ${error.message}`);
            this.metrics.failovers++;
            return null;
        }
    }
    async setToL2(key, value, ttl) {
        try {
            await this.cacheService.set(key, value, ttl);
        }
        catch (error) {
            this.logger.warn(`Erro ao definir L2 Cache para '${key}': ${error.message}`);
            this.metrics.failovers++;
        }
    }
    async isL2Available() {
        try {
            return await this.healthCheckService.isRedisAvailable();
        }
        catch {
            return false;
        }
    }
    /**
     * Retorna métricas detalhadas do cache
     */
    getMetrics() {
        const totalL1Operations = this.metrics.l1Hits + this.metrics.l1Misses;
        const totalL2Operations = this.metrics.l2Hits + this.metrics.l2Misses;
        return {
            ...this.metrics,
            l1Size: this.l1Cache.size,
            l1MaxSize: this.maxL1Size,
            l1HitRate: totalL1Operations > 0
                ? (this.metrics.l1Hits / totalL1Operations) * 100
                : 0,
            l2HitRate: totalL2Operations > 0
                ? (this.metrics.l2Hits / totalL2Operations) * 100
                : 0,
            overallHitRate: totalL1Operations + totalL2Operations > 0
                ? ((this.metrics.l1Hits + this.metrics.l2Hits) /
                    (totalL1Operations + totalL2Operations)) *
                    100
                : 0,
            criticalKeysCount: this.criticalKeys.size,
            pendingOperations: this.pendingOperations.size,
        };
    }
    /**
     * Reseta métricas (útil para testes)
     */
    resetMetrics() {
        this.metrics = {
            l1Hits: 0,
            l1Misses: 0,
            l2Hits: 0,
            l2Misses: 0,
            evictions: 0,
            warmingOperations: 0,
            failovers: 0,
        };
    }
    /**
     * Limpa todo o cache (útil para testes)
     */
    async clear() {
        this.l1Cache.clear();
        if (this.enableL2Cache && (await this.isL2Available())) {
            try {
                // Implementar clear no CacheService se necessário
                this.logger.debug('L2 Cache cleared');
            }
            catch (error) {
                this.logger.warn(`Erro ao limpar L2 Cache: ${error.message}`);
            }
        }
        this.logger.debug('Cache híbrido limpo');
    }
};
exports.HybridCacheService = HybridCacheService;
__decorate([
    (0, schedule_1.Cron)('0 * * * * *') // A cada minuto
    ,
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], HybridCacheService.prototype, "performCacheWarming", null);
__decorate([
    (0, schedule_1.Cron)('0 */5 * * * *') // A cada 5 minutos
    ,
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], HybridCacheService.prototype, "cleanupExpiredCache", null);
exports.HybridCacheService = HybridCacheService = HybridCacheService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigService !== "undefined" && config_1.ConfigService) === "function" ? _a : Object, typeof (_b = typeof health_check_service_1.HealthCheckService !== "undefined" && health_check_service_1.HealthCheckService) === "function" ? _b : Object, typeof (_c = typeof cache_service_1.CacheService !== "undefined" && cache_service_1.CacheService) === "function" ? _c : Object])
], HybridCacheService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXHNoYXJlZFxcc2VydmljZXNcXGh5YnJpZC1jYWNoZS5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQWtFO0FBQ2xFLDJDQUErQztBQUMvQywrQ0FBd0M7QUFDeEMsaUVBQTREO0FBQzVELDBEQUFzRDtBQXFCdEQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FzQkc7QUFFSSxJQUFNLGtCQUFrQiwwQkFBeEIsTUFBTSxrQkFBa0I7SUFnQ1Y7SUFDQTtJQUNBO0lBakNGLE1BQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQyxvQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUU5RCwyQkFBMkI7SUFDVixPQUFPLEdBQUcsSUFBSSxHQUFHLEVBQXNCLENBQUM7SUFDeEMsU0FBUyxDQUFTO0lBQ2xCLFVBQVUsQ0FBUztJQUVwQyxnQkFBZ0I7SUFDQyxhQUFhLENBQVU7SUFDdkIsa0JBQWtCLENBQVU7SUFDNUIsZUFBZSxDQUFTO0lBRXpDLFdBQVc7SUFDSCxPQUFPLEdBQWlCO1FBQzlCLE1BQU0sRUFBRSxDQUFDO1FBQ1QsUUFBUSxFQUFFLENBQUM7UUFDWCxNQUFNLEVBQUUsQ0FBQztRQUNULFFBQVEsRUFBRSxDQUFDO1FBQ1gsU0FBUyxFQUFFLENBQUM7UUFDWixpQkFBaUIsRUFBRSxDQUFDO1FBQ3BCLFNBQVMsRUFBRSxDQUFDO0tBQ2IsQ0FBQztJQUVGLGtFQUFrRTtJQUNqRCxZQUFZLEdBQUcsSUFBSSxHQUFHLEVBQVUsQ0FBQztJQUNqQyxnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsRUFBOEIsQ0FBQztJQUUxRSw4QkFBOEI7SUFDYixpQkFBaUIsR0FBRyxJQUFJLEdBQUcsRUFBd0IsQ0FBQztJQUVyRSxZQUNtQixhQUE0QixFQUM1QixrQkFBc0MsRUFDdEMsWUFBMEI7UUFGMUIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDNUIsdUJB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QUFDO1lBQ1osaUJBQWlCLEVBQUUsQ0FBQztZQUNwQixTQUFTLEVBQUUsQ0FBQztTQUNiLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsS0FBSztRQUNULElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7UUFFckIsSUFBSSxJQUFJLENBQUMsYUFBYSxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUMsRUFBRSxDQUFDO1lBQ3ZELElBQUksQ0FBQztnQkFDSCxrREFBa0Q7Z0JBQ2xELElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7WUFDeEMsQ0FBQztZQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7Z0JBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsNEJBQTRCLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ2hFLENBQUM7UUFDSCxDQUFDO1FBRUQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUMzQyxDQUFDO0NBQ0YsQ0FBQTtBQWppQlksZ0RBQWtCO0FBK1J2QjtJQURMLElBQUEsZUFBSSxFQUFDLGFBQWEsQ0FBQyxDQUFDLGdCQUFnQjs7Ozt3REFDUixPQUFPLG9CQUFQLE9BQU87NkRBb0NuQztBQXVCSztJQURMLElBQUEsZUFBSSxFQUFDLGVBQWUsQ0FBQyxDQUFDLG1CQUFtQjs7Ozt3REFDYixPQUFPLG9CQUFQLE9BQU87NkRBY25DOzZCQXhXVSxrQkFBa0I7SUFEOUIsSUFBQSxtQkFBVSxHQUFFO3lEQWlDdUIsc0JBQWEsb0JBQWIsc0JBQWEsb0RBQ1IseUNBQWtCLG9CQUFsQix5Q0FBa0Isb0RBQ3hCLDRCQUFZLG9CQUFaLDRCQUFZO0dBbENsQyxrQkFBa0IsQ0FpaUI5QiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcc2hhcmVkXFxzZXJ2aWNlc1xcaHlicmlkLWNhY2hlLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTG9nZ2VyLCBPbk1vZHVsZUluaXQgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBDb25maWdTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9jb25maWcnO1xuaW1wb3J0IHsgQ3JvbiB9IGZyb20gJ0BuZXN0anMvc2NoZWR1bGUnO1xuaW1wb3J0IHsgSGVhbHRoQ2hlY2tTZXJ2aWNlIH0gZnJvbSAnLi9oZWFsdGgtY2hlY2suc2VydmljZSc7XG5pbXBvcnQgeyBDYWNoZVNlcnZpY2UgfSBmcm9tICcuLi9jYWNoZS9jYWNoZS5zZXJ2aWNlJztcblxuaW50ZXJmYWNlIENhY2hlRW50cnkge1xuICB2YWx1ZTogYW55O1xuICB0dGw6IG51bWJlcjtcbiAgY3JlYXRlZEF0OiBudW1iZXI7XG4gIGFjY2Vzc0NvdW50OiBudW1iZXI7XG4gIGxhc3RBY2Nlc3NlZDogbnVtYmVyO1xuICBwcmlvcml0eTogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB8ICdjcml0aWNhbCc7XG59XG5cbmludGVyZmFjZSBDYWNoZU1ldHJpY3Mge1xuICBsMUhpdHM6IG51bWJlcjtcbiAgbDFNaXNzZXM6IG51bWJlcjtcbiAgbDJIaXRzOiBudW1iZXI7XG4gIGwyTWlzc2VzOiBudW1iZXI7XG4gIGV2aWN0aW9uczogbnVtYmVyO1xuICB3YXJtaW5nT3BlcmF0aW9uczogbnVtYmVyO1xuICBmYWlsb3ZlcnM6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBTZXJ2acOnbyBkZSBDYWNoZSBIw61icmlkbyBSZXNpbGllbnRlXG4gKlxuICogSW1wbGVtZW50YSB1bSBzaXN0ZW1hIGRlIGNhY2hlIGVtIG3Dumx0aXBsYXMgY2FtYWRhcyBjb20gZXN0cmF0w6lnaWFzIGRlIHJlc2lsacOqbmNpYTpcbiAqXG4gKiBMMSBDYWNoZSAoTWVtw7NyaWEgTG9jYWwpOlxuICogLSBDYWNoZSBlbSBtZW3Ds3JpYSB1bHRyYS1yw6FwaWRvXG4gKiAtIExpbWl0YWRvIHBvciB0YW1hbmhvIGNvbmZpZ3Vyw6F2ZWxcbiAqIC0gQWxnb3JpdG1vIExSVSBjb20gcHJpb3JpZGFkZXNcbiAqIC0gU2VtcHJlIGRpc3BvbsOtdmVsXG4gKlxuICogTDIgQ2FjaGUgKFJlZGlzKTpcbiAqIC0gQ2FjaGUgZGlzdHJpYnXDrWRvIHBlcnNpc3RlbnRlXG4gKiAtIENvbXBhcnRpbGhhZG8gZW50cmUgaW5zdMOibmNpYXNcbiAqIC0gRmFsbGJhY2sgYXV0b23DoXRpY28gcGFyYSBMMSBlbSBjYXNvIGRlIGZhbGhhXG4gKiAtIENpcmN1aXQgYnJlYWtlciBpbnRlZ3JhZG9cbiAqXG4gKiBGdW5jaW9uYWxpZGFkZXMgZGUgUmVzaWxpw6puY2lhOlxuICogLSBDYWNoZSB3YXJtaW5nIGF1dG9tw6F0aWNvXG4gKiAtIFByZXZlbsOnw6NvIGRlIGNhY2hlIHN0YW1wZWRlXG4gKiAtIE3DqXRyaWNhcyBkZXRhbGhhZGFzXG4gKiAtIFJlY3VwZXJhw6fDo28gYXV0b23DoXRpY2FcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEh5YnJpZENhY2hlU2VydmljZSBpbXBsZW1lbnRzIE9uTW9kdWxlSW5pdCB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihIeWJyaWRDYWNoZVNlcnZpY2UubmFtZSk7XG5cbiAgLy8gTDEgQ2FjaGUgKE1lbcOzcmlhIExvY2FsKVxuICBwcml2YXRlIHJlYWRvbmx5IGwxQ2FjaGUgPSBuZXcgTWFwPHN0cmluZywgQ2FjaGVFbnRyeT4oKTtcbiAgcHJpdmF0ZSByZWFkb25seSBtYXhMMVNpemU6IG51bWJlcjtcbiAgcHJpdmF0ZSByZWFkb25seSBkZWZhdWx0VHRsOiBudW1iZXI7XG5cbiAgLy8gQ29uZmlndXJhw6fDtWVzXG4gIHByaXZhdGUgcmVhZG9ubHkgZW5hYmxlTDJDYWNoZTogYm9vbGVhbjtcbiAgcHJpdmF0ZSByZWFkb25seSBlbmFibGVDYWNoZVdhcm1pbmc6IGJvb2xlYW47XG4gIHByaXZhdGUgcmVhZG9ubHkgd2FybWluZ0ludGVydmFsOiBudW1iZXI7XG5cbiAgLy8gTcOpdHJpY2FzXG4gIHByaXZhdGUgbWV0cmljczogQ2FjaGVNZXRyaWNzID0ge1xuICAgIGwxSGl0czogMCxcbiAgICBsMU1pc3NlczogMCxcbiAgICBsMkhpdHM6IDAsXG4gICAgbDJNaXNzZXM6IDAsXG4gICAgZXZpY3Rpb25zOiAwLFxuICAgIHdhcm1pbmdPcGVyYXRpb25zOiAwLFxuICAgIGZhaWxvdmVyczogMCxcbiAgfTtcblxuICAvLyBDYWNoZSB3YXJtaW5nIC0gY2hhdmVzIGNyw610aWNhcyBxdWUgZGV2ZW0gZXN0YXIgc2VtcHJlIGVtIGNhY2hlXG4gIHByaXZhdGUgcmVhZG9ubHkgY3JpdGljYWxLZXlzID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgd2FybWluZ0NhbGxiYWNrcyA9IG5ldyBNYXA8c3RyaW5nLCAoKSA9PiBQcm9taXNlPGFueT4+KCk7XG5cbiAgLy8gUHJldmVuw6fDo28gZGUgY2FjaGUgc3RhbXBlZGVcbiAgcHJpdmF0ZSByZWFkb25seSBwZW5kaW5nT3BlcmF0aW9ucyA9IG5ldyBNYXA8c3RyaW5nLCBQcm9taXNlPGFueT4+KCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBjb25maWdTZXJ2aWNlOiBDb25maWdTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgaGVhbHRoQ2hlY2tTZXJ2aWNlOiBIZWFsdGhDaGVja1NlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBjYWNoZVNlcnZpY2U6IENhY2hlU2VydmljZSxcbiAgKSB7XG4gICAgdGhpcy5tYXhMMVNpemUgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0KCdDQUNIRV9MMV9NQVhfU0laRScsIDEwMDApO1xuICAgIHRoaXMuZGVmYXVsdFR0bCA9IHRoaXMuY29uZmlnU2VydmljZS5nZXQoJ0NBQ0hFX0RFRkFVTFRfVFRMJywgMzAwMDAwKTsgLy8gNSBtaW51dG9zXG4gICAgdGhpcy5lbmFibGVMMkNhY2hlID1cbiAgICAgIHRoaXMuY29uZmlnU2VydmljZS5nZXQoJ0NBQ0hFX0VOQUJMRV9MMicsICd0cnVlJykgPT09ICd0cnVlJztcbiAgICB0aGlzLmVuYWJsZUNhY2hlV2FybWluZyA9XG4gICAgICB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0KCdDQUNIRV9FTkFCTEVfV0FSTUlORycsICd0cnVlJykgPT09ICd0cnVlJztcbiAgICB0aGlzLndhcm1pbmdJbnRlcnZhbCA9IHRoaXMuY29uZmlnU2VydmljZS5nZXQoXG4gICAgICAnQ0FDSEVfV0FSTUlOR19JTlRFUlZBTCcsXG4gICAgICA2MDAwMCxcbiAgICApOyAvLyAxIG1pbnV0b1xuICB9XG5cbiAgYXN5bmMgb25Nb2R1bGVJbml0KCkge1xuICAgIHRoaXMubG9nZ2VyLmxvZygnSW5pY2lhbGl6YW5kbyBIeWJyaWQgQ2FjaGUgU2VydmljZScpO1xuXG4gICAgLy8gVEVNUE9Sw4FSSU86IERlc2FiaWxpdGFuZG8gaW5pY2lhbGl6YcOnw6NvIHBhcmEgZXZpdGFyIHRyYXZhbWVudG9cbiAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgJ+KaoO+4jyBJbmljaWFsaXphw6fDo28gZG8gSHlicmlkQ2FjaGVTZXJ2aWNlIGRlc2FiaWxpdGFkYSB0ZW1wb3JhcmlhbWVudGUnLFxuICAgICk7XG5cbiAgICAvLyBUT0RPOiBSZWFiaWxpdGFyIGFww7NzIHJlc29sdmVyIHByb2JsZW1hcyBkZSBjb25lY3RpdmlkYWRlIGNvbSBSZWRpc1xuICAgIC8qXG4gICAgaWYgKHRoaXMuZW5hYmxlQ2FjaGVXYXJtaW5nKSB7XG4gICAgICB0aGlzLmxvZ2dlci5sb2coJ0NhY2hlIHdhcm1pbmcgaGFiaWxpdGFkbycpO1xuICAgIH1cbiAgICBcbiAgICAvLyBSZWdpc3RyYXIgY2hhdmVzIGNyw610aWNhcyBwYWRyw6NvXG4gICAgdGhpcy5yZWdpc3RlckNyaXRpY2FsS2V5KCdzeXN0ZW06Y29uZmlnJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gRXhlbXBsbzogY2FycmVnYXIgY29uZmlndXJhw6fDtWVzIGRvIHNpc3RlbWFcbiAgICAgIHJldHVybiB7IGxvYWRlZDogdHJ1ZSwgdGltZXN0YW1wOiBEYXRlLm5vdygpIH07XG4gICAgfSk7XG4gICAgKi9cbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gdmFsb3IgZG8gY2FjaGUgY29tIGVzdHJhdMOpZ2lhIGjDrWJyaWRhXG4gICAqXG4gICAqIEZsdXhvOlxuICAgKiAxLiBWZXJpZmljYSBMMSBDYWNoZSAobWVtw7NyaWEgbG9jYWwpXG4gICAqIDIuIFNlIG7Do28gZW5jb250cmFyLCB2ZXJpZmljYSBMMiBDYWNoZSAoUmVkaXMpXG4gICAqIDMuIFNlIGVuY29udHJhciBubyBMMiwgcHJvbW92ZSBwYXJhIEwxXG4gICAqIDQuIFNlIG7Do28gZW5jb250cmFyIGVtIG5lbmh1bSwgcmV0b3JuYSBudWxsXG4gICAqXG4gICAqIEBwYXJhbSBrZXkgQ2hhdmUgZG8gY2FjaGVcbiAgICogQHJldHVybnMgVmFsb3IgZG8gY2FjaGUgb3UgbnVsbFxuICAgKi9cbiAgYXN5bmMgZ2V0PFQgPSBhbnk+KGtleTogc3RyaW5nKTogUHJvbWlzZTxUIHwgbnVsbD4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gTDEgQ2FjaGUgKE1lbcOzcmlhIExvY2FsKVxuICAgICAgY29uc3QgbDFSZXN1bHQgPSB0aGlzLmdldEZyb21MMTxUPihrZXkpO1xuICAgICAgaWYgKGwxUmVzdWx0ICE9PSBudWxsKSB7XG4gICAgICAgIHRoaXMubWV0cmljcy5sMUhpdHMrKztcbiAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoXG4gICAgICAgICAgYEwxIENhY2hlIEhJVCBwYXJhICcke2tleX0nIGVtICR7RGF0ZS5ub3coKSAtIHN0YXJ0VGltZX1tc2AsXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBsMVJlc3VsdDtcbiAgICAgIH1cblxuICAgICAgdGhpcy5tZXRyaWNzLmwxTWlzc2VzKys7XG5cbiAgICAgIC8vIEwyIENhY2hlIChSZWRpcykgLSBhcGVuYXMgc2UgaGFiaWxpdGFkbyBlIGRpc3BvbsOtdmVsXG4gICAgICBpZiAodGhpcy5lbmFibGVMMkNhY2hlICYmIChhd2FpdCB0aGlzLmlzTDJBdmFpbGFibGUoKSkpIHtcbiAgICAgICAgY29uc3QgbDJSZXN1bHQgPSBhd2FpdCB0aGlzLmdldEZyb21MMjxUPihrZXkpO1xuICAgICAgICBpZiAobDJSZXN1bHQgIT09IG51bGwpIHtcbiAgICAgICAgICB0aGlzLm1ldHJpY3MubDJIaXRzKys7XG5cbiAgICAgICAgICAvLyBQcm9tb3ZlciBwYXJhIEwxIENhY2hlXG4gICAgICAgICAgdGhpcy5zZXRUb0wxKGtleSwgbDJSZXN1bHQsIHRoaXMuZGVmYXVsdFR0bCwgJ21lZGl1bScpO1xuXG4gICAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoXG4gICAgICAgICAgICBgTDIgQ2FjaGUgSElUIHBhcmEgJyR7a2V5fScgZW0gJHtEYXRlLm5vdygpIC0gc3RhcnRUaW1lfW1zYCxcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBsMlJlc3VsdDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubWV0cmljcy5sMk1pc3NlcysrO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgYENhY2hlIE1JU1MgcGFyYSAnJHtrZXl9JyBlbSAke0RhdGUubm93KCkgLSBzdGFydFRpbWV9bXNgLFxuICAgICAgKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgRXJybyBhbyBvYnRlciBjYWNoZSBwYXJhICcke2tleX0nOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGVmaW5lIHZhbG9yIG5vIGNhY2hlIGNvbSBlc3RyYXTDqWdpYSBow61icmlkYVxuICAgKlxuICAgKiBAcGFyYW0ga2V5IENoYXZlIGRvIGNhY2hlXG4gICAqIEBwYXJhbSB2YWx1ZSBWYWxvciBhIHNlciBhcm1hemVuYWRvXG4gICAqIEBwYXJhbSB0dGwgVFRMIGVtIG1pbGlzc2VndW5kb3MgKG9wY2lvbmFsKVxuICAgKiBAcGFyYW0gcHJpb3JpdHkgUHJpb3JpZGFkZSBkbyBjYWNoZSAob3BjaW9uYWwpXG4gICAqL1xuICBhc3luYyBzZXQ8VCA9IGFueT4oXG4gICAga2V5OiBzdHJpbmcsXG4gICAgdmFsdWU6IFQsXG4gICAgdHRsOiBudW1iZXIgPSB0aGlzLmRlZmF1bHRUdGwsXG4gICAgcHJpb3JpdHk6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcgfCAnY3JpdGljYWwnID0gJ21lZGl1bScsXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBTZW1wcmUgYXJtYXplbmFyIG5vIEwxIENhY2hlXG4gICAgICB0aGlzLnNldFRvTDEoa2V5LCB2YWx1ZSwgdHRsLCBwcmlvcml0eSk7XG5cbiAgICAgIC8vIEFybWF6ZW5hciBubyBMMiBDYWNoZSBzZSBkaXNwb27DrXZlbFxuICAgICAgaWYgKHRoaXMuZW5hYmxlTDJDYWNoZSAmJiAoYXdhaXQgdGhpcy5pc0wyQXZhaWxhYmxlKCkpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2V0VG9MMihrZXksIHZhbHVlLCB0dGwpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhcbiAgICAgICAgYENhY2hlIFNFVCBwYXJhICcke2tleX0nIGNvbSBUVEwgJHt0dGx9bXMgZSBwcmlvcmlkYWRlICR7cHJpb3JpdHl9YCxcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJybyBhbyBkZWZpbmlyIGNhY2hlIHBhcmEgJyR7a2V5fSc6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgKTtcbiAgICAgIC8vIE7Do28gcHJvcGFnYXIgZXJybyAtIGNhY2hlIG7Do28gZGV2ZSBxdWVicmFyIGEgYXBsaWNhw6fDo29cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIHZhbG9yIGRvIGNhY2hlXG4gICAqL1xuICBhc3luYyBkZWwoa2V5OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8gUmVtb3ZlciBkbyBMMSBDYWNoZVxuICAgICAgdGhpcy5sMUNhY2hlLmRlbGV0ZShrZXkpO1xuXG4gICAgICAvLyBSZW1vdmVyIGRvIEwyIENhY2hlIHNlIGRpc3BvbsOtdmVsXG4gICAgICBpZiAodGhpcy5lbmFibGVMMkNhY2hlICYmIChhd2FpdCB0aGlzLmlzTDJBdmFpbGFibGUoKSkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5jYWNoZVNlcnZpY2UuZGVsKGtleSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBDYWNoZSBERUwgcGFyYSAnJHtrZXl9J2ApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gcmVtb3ZlciBjYWNoZSBwYXJhICcke2tleX0nOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIHVtYSBjaGF2ZSBleGlzdGUgbm8gY2FjaGVcbiAgICovXG4gIGFzeW5jIGhhcyhrZXk6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBWZXJpZmljYXIgTDEgQ2FjaGVcbiAgICAgIGlmICh0aGlzLmhhc0luTDEoa2V5KSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgLy8gVmVyaWZpY2FyIEwyIENhY2hlIHNlIGRpc3BvbsOtdmVsXG4gICAgICBpZiAodGhpcy5lbmFibGVMMkNhY2hlICYmIChhd2FpdCB0aGlzLmlzTDJBdmFpbGFibGUoKSkpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuY2FjaGVTZXJ2aWNlLmhhcyhrZXkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJybyBhbyB2ZXJpZmljYXIgY2FjaGUgcGFyYSAnJHtrZXl9JzogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gb3UgZGVmaW5lIHZhbG9yIG5vIGNhY2hlIGNvbSBwcmV2ZW7Dp8OjbyBkZSBjYWNoZSBzdGFtcGVkZVxuICAgKlxuICAgKiBAcGFyYW0ga2V5IENoYXZlIGRvIGNhY2hlXG4gICAqIEBwYXJhbSBmYWN0b3J5IEZ1bsOnw6NvIHBhcmEgZ2VyYXIgbyB2YWxvciBzZSBuw6NvIGVzdGl2ZXIgZW0gY2FjaGVcbiAgICogQHBhcmFtIHR0bCBUVEwgZW0gbWlsaXNzZWd1bmRvc1xuICAgKiBAcGFyYW0gcHJpb3JpdHkgUHJpb3JpZGFkZSBkbyBjYWNoZVxuICAgKi9cbiAgYXN5bmMgZ2V0T3JTZXQ8VCA9IGFueT4oXG4gICAga2V5OiBzdHJpbmcsXG4gICAgZmFjdG9yeTogKCkgPT4gUHJvbWlzZTxUPixcbiAgICB0dGw6IG51bWJlciA9IHRoaXMuZGVmYXVsdFR0bCxcbiAgICBwcmlvcml0eTogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB8ICdjcml0aWNhbCcgPSAnbWVkaXVtJyxcbiAgKTogUHJvbWlzZTxUPiB7XG4gICAgLy8gVmVyaWZpY2FyIHNlIGrDoSBleGlzdGUgbm8gY2FjaGVcbiAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCB0aGlzLmdldDxUPihrZXkpO1xuICAgIGlmIChjYWNoZWQgIT09IG51bGwpIHtcbiAgICAgIHJldHVybiBjYWNoZWQ7XG4gICAgfVxuXG4gICAgLy8gUHJldmVuw6fDo28gZGUgY2FjaGUgc3RhbXBlZGVcbiAgICBjb25zdCBwZW5kaW5nS2V5ID0gYHBlbmRpbmc6JHtrZXl9YDtcbiAgICBpZiAodGhpcy5wZW5kaW5nT3BlcmF0aW9ucy5oYXMocGVuZGluZ0tleSkpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBBZ3VhcmRhbmRvIG9wZXJhw6fDo28gcGVuZGVudGUgcGFyYSAnJHtrZXl9J2ApO1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucGVuZGluZ09wZXJhdGlvbnMuZ2V0KHBlbmRpbmdLZXkpO1xuICAgIH1cblxuICAgIC8vIENyaWFyIG5vdmEgb3BlcmHDp8Ojb1xuICAgIGNvbnN0IG9wZXJhdGlvbiA9IHRoaXMuZXhlY3V0ZUZhY3Rvcnkoa2V5LCBmYWN0b3J5LCB0dGwsIHByaW9yaXR5KTtcbiAgICB0aGlzLnBlbmRpbmdPcGVyYXRpb25zLnNldChwZW5kaW5nS2V5LCBvcGVyYXRpb24pO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9wZXJhdGlvbjtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMucGVuZGluZ09wZXJhdGlvbnMuZGVsZXRlKHBlbmRpbmdLZXkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRhIGZhY3RvcnkgZSBhcm1hemVuYSByZXN1bHRhZG8gbm8gY2FjaGVcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZUZhY3Rvcnk8VD4oXG4gICAga2V5OiBzdHJpbmcsXG4gICAgZmFjdG9yeTogKCkgPT4gUHJvbWlzZTxUPixcbiAgICB0dGw6IG51bWJlcixcbiAgICBwcmlvcml0eTogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB8ICdjcml0aWNhbCcsXG4gICk6IFByb21pc2U8VD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBmYWN0b3J5KCk7XG4gICAgICBhd2FpdCB0aGlzLnNldChrZXksIHJlc3VsdCwgdHRsLCBwcmlvcml0eSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gZXhlY3V0YXIgZmFjdG9yeSBwYXJhICcke2tleX0nOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0cmEgY2hhdmUgY3LDrXRpY2EgcGFyYSBjYWNoZSB3YXJtaW5nXG4gICAqL1xuICByZWdpc3RlckNyaXRpY2FsS2V5KGtleTogc3RyaW5nLCBmYWN0b3J5OiAoKSA9PiBQcm9taXNlPGFueT4pOiB2b2lkIHtcbiAgICB0aGlzLmNyaXRpY2FsS2V5cy5hZGQoa2V5KTtcbiAgICB0aGlzLndhcm1pbmdDYWxsYmFja3Muc2V0KGtleSwgZmFjdG9yeSk7XG4gICAgdGhpcy5sb2dnZXIuZGVidWcoYENoYXZlIGNyw610aWNhIHJlZ2lzdHJhZGE6ICR7a2V5fWApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBjaGF2ZSBjcsOtdGljYVxuICAgKi9cbiAgdW5yZWdpc3RlckNyaXRpY2FsS2V5KGtleTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5jcml0aWNhbEtleXMuZGVsZXRlKGtleSk7XG4gICAgdGhpcy53YXJtaW5nQ2FsbGJhY2tzLmRlbGV0ZShrZXkpO1xuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBDaGF2ZSBjcsOtdGljYSByZW1vdmlkYTogJHtrZXl9YCk7XG4gIH1cblxuICAvKipcbiAgICogSm9iIGRlIGNhY2hlIHdhcm1pbmcgLSBleGVjdXRhIHBlcmlvZGljYW1lbnRlXG4gICAqL1xuICBAQ3JvbignMCAqICogKiAqIConKSAvLyBBIGNhZGEgbWludXRvXG4gIGFzeW5jIHBlcmZvcm1DYWNoZVdhcm1pbmcoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmVuYWJsZUNhY2hlV2FybWluZyB8fCB0aGlzLmNyaXRpY2FsS2V5cy5zaXplID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoJ0luaWNpYW5kbyBjYWNoZSB3YXJtaW5nJyk7XG5cbiAgICBsZXQgd2FybWVkQ291bnQgPSAwO1xuXG4gICAgZm9yIChjb25zdCBrZXkgb2YgdGhpcy5jcml0aWNhbEtleXMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGZhY3RvcnkgPSB0aGlzLndhcm1pbmdDYWxsYmFja3MuZ2V0KGtleSk7XG4gICAgICAgIGlmICghZmFjdG9yeSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVmVyaWZpY2FyIHNlIHByZWNpc2EgZGUgd2FybWluZyAobsOjbyBleGlzdGUgb3UgZXN0w6EgcHLDs3hpbW8gZG8gdmVuY2ltZW50bylcbiAgICAgICAgY29uc3QgbmVlZHNXYXJtaW5nID0gYXdhaXQgdGhpcy5uZWVkc0NhY2hlV2FybWluZyhrZXkpO1xuXG4gICAgICAgIGlmIChuZWVkc1dhcm1pbmcpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmdldE9yU2V0KGtleSwgZmFjdG9yeSwgdGhpcy5kZWZhdWx0VHRsICogMiwgJ2NyaXRpY2FsJyk7IC8vIFRUTCBtYWlvciBwYXJhIGNoYXZlcyBjcsOtdGljYXNcbiAgICAgICAgICB3YXJtZWRDb3VudCsrO1xuICAgICAgICAgIHRoaXMubWV0cmljcy53YXJtaW5nT3BlcmF0aW9ucysrO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgICAgIGBFcnJvIG5vIGNhY2hlIHdhcm1pbmcgcGFyYSAnJHtrZXl9JzogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHdhcm1lZENvdW50ID4gMCkge1xuICAgICAgdGhpcy5sb2dnZXIuZGVidWcoXG4gICAgICAgIGBDYWNoZSB3YXJtaW5nIGNvbmNsdcOtZG86ICR7d2FybWVkQ291bnR9IGNoYXZlcyBhcXVlY2lkYXNgLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgdW1hIGNoYXZlIHByZWNpc2EgZGUgY2FjaGUgd2FybWluZ1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBuZWVkc0NhY2hlV2FybWluZyhrZXk6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5sMUNhY2hlLmdldChrZXkpO1xuXG4gICAgaWYgKCFlbnRyeSkge1xuICAgICAgcmV0dXJuIHRydWU7IC8vIE7Do28gZXhpc3RlLCBwcmVjaXNhIGRlIHdhcm1pbmdcbiAgICB9XG5cbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHRpbWVUb0V4cGlyZSA9IGVudHJ5LmNyZWF0ZWRBdCArIGVudHJ5LnR0bCAtIG5vdztcbiAgICBjb25zdCB3YXJtaW5nVGhyZXNob2xkID0gZW50cnkudHRsICogMC4yOyAvLyAyMCUgZG8gVFRMXG5cbiAgICByZXR1cm4gdGltZVRvRXhwaXJlIDw9IHdhcm1pbmdUaHJlc2hvbGQ7XG4gIH1cblxuICAvKipcbiAgICogTGltcGEgY2FjaGUgZXhwaXJhZG8gLSBleGVjdXRhIHBlcmlvZGljYW1lbnRlXG4gICAqL1xuICBAQ3JvbignMCAqLzUgKiAqICogKicpIC8vIEEgY2FkYSA1IG1pbnV0b3NcbiAgYXN5bmMgY2xlYW51cEV4cGlyZWRDYWNoZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGxldCBjbGVhbmVkQ291bnQgPSAwO1xuXG4gICAgZm9yIChjb25zdCBba2V5LCBlbnRyeV0gb2YgdGhpcy5sMUNhY2hlLmVudHJpZXMoKSkge1xuICAgICAgaWYgKG5vdyA+IGVudHJ5LmNyZWF0ZWRBdCArIGVudHJ5LnR0bCkge1xuICAgICAgICB0aGlzLmwxQ2FjaGUuZGVsZXRlKGtleSk7XG4gICAgICAgIGNsZWFuZWRDb3VudCsrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjbGVhbmVkQ291bnQgPiAwKSB7XG4gICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgTGltcGV6YSBkZSBjYWNoZTogJHtjbGVhbmVkQ291bnR9IGVudHJhZGFzIHJlbW92aWRhc2ApO1xuICAgIH1cbiAgfVxuXG4gIC8vIE3DqXRvZG9zIHByaXZhZG9zIHBhcmEgTDEgQ2FjaGVcblxuICBwcml2YXRlIGdldEZyb21MMTxUPihrZXk6IHN0cmluZyk6IFQgfCBudWxsIHtcbiAgICBjb25zdCBlbnRyeSA9IHRoaXMubDFDYWNoZS5nZXQoa2V5KTtcblxuICAgIGlmICghZW50cnkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG5cbiAgICAvLyBWZXJpZmljYXIgc2UgZXhwaXJvdVxuICAgIGlmIChub3cgPiBlbnRyeS5jcmVhdGVkQXQgKyBlbnRyeS50dGwpIHtcbiAgICAgIHRoaXMubDFDYWNoZS5kZWxldGUoa2V5KTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIEF0dWFsaXphciBlc3RhdMOtc3RpY2FzIGRlIGFjZXNzb1xuICAgIGVudHJ5LmFjY2Vzc0NvdW50Kys7XG4gICAgZW50cnkubGFzdEFjY2Vzc2VkID0gbm93O1xuXG4gICAgcmV0dXJuIGVudHJ5LnZhbHVlO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRUb0wxPFQ+KFxuICAgIGtleTogc3RyaW5nLFxuICAgIHZhbHVlOiBULFxuICAgIHR0bDogbnVtYmVyLFxuICAgIHByaW9yaXR5OiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnIHwgJ2NyaXRpY2FsJyxcbiAgKTogdm9pZCB7XG4gICAgLy8gVmVyaWZpY2FyIHNlIHByZWNpc2EgZmF6ZXIgZXZpY3Rpb25cbiAgICBpZiAodGhpcy5sMUNhY2hlLnNpemUgPj0gdGhpcy5tYXhMMVNpemUpIHtcbiAgICAgIHRoaXMuZXZpY3RMMUNhY2hlKCk7XG4gICAgfVxuXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcblxuICAgIHRoaXMubDFDYWNoZS5zZXQoa2V5LCB7XG4gICAgICB2YWx1ZSxcbiAgICAgIHR0bCxcbiAgICAgIGNyZWF0ZWRBdDogbm93LFxuICAgICAgYWNjZXNzQ291bnQ6IDAsXG4gICAgICBsYXN0QWNjZXNzZWQ6IG5vdyxcbiAgICAgIHByaW9yaXR5LFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBoYXNJbkwxKGtleTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZW50cnkgPSB0aGlzLmwxQ2FjaGUuZ2V0KGtleSk7XG5cbiAgICBpZiAoIWVudHJ5KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcblxuICAgIC8vIFZlcmlmaWNhciBzZSBleHBpcm91XG4gICAgaWYgKG5vdyA+IGVudHJ5LmNyZWF0ZWRBdCArIGVudHJ5LnR0bCkge1xuICAgICAgdGhpcy5sMUNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIEFsZ29yaXRtbyBkZSBldmljdGlvbiBMUlUgY29tIHByaW9yaWRhZGVzXG4gICAqL1xuICBwcml2YXRlIGV2aWN0TDFDYWNoZSgpOiB2b2lkIHtcbiAgICBjb25zdCBwcmlvcml0eU9yZGVyID0gWydsb3cnLCAnbWVkaXVtJywgJ2hpZ2gnLCAnY3JpdGljYWwnXTtcblxuICAgIGZvciAoY29uc3QgcHJpb3JpdHkgb2YgcHJpb3JpdHlPcmRlcikge1xuICAgICAgY29uc3QgY2FuZGlkYXRlcyA9IEFycmF5LmZyb20odGhpcy5sMUNhY2hlLmVudHJpZXMoKSlcbiAgICAgICAgLmZpbHRlcigoW18sIGVudHJ5XSkgPT4gZW50cnkucHJpb3JpdHkgPT09IHByaW9yaXR5KVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYVsxXS5sYXN0QWNjZXNzZWQgLSBiWzFdLmxhc3RBY2Nlc3NlZCk7IC8vIExSVVxuXG4gICAgICBpZiAoY2FuZGlkYXRlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IFtrZXlUb0V2aWN0XSA9IGNhbmRpZGF0ZXNbMF07XG4gICAgICAgIHRoaXMubDFDYWNoZS5kZWxldGUoa2V5VG9FdmljdCk7XG4gICAgICAgIHRoaXMubWV0cmljcy5ldmljdGlvbnMrKztcbiAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoXG4gICAgICAgICAgYENhY2hlIGV2aWN0aW9uOiByZW1vdmlkYSBjaGF2ZSAnJHtrZXlUb0V2aWN0fScgY29tIHByaW9yaWRhZGUgJHtwcmlvcml0eX1gLFxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gTcOpdG9kb3MgcHJpdmFkb3MgcGFyYSBMMiBDYWNoZVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0RnJvbUwyPFQ+KGtleTogc3RyaW5nKTogUHJvbWlzZTxUIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5jYWNoZVNlcnZpY2UuZ2V0PFQ+KGtleSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgIGBFcnJvIGFvIGFjZXNzYXIgTDIgQ2FjaGUgcGFyYSAnJHtrZXl9JzogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICApO1xuICAgICAgdGhpcy5tZXRyaWNzLmZhaWxvdmVycysrO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzZXRUb0wyPFQ+KGtleTogc3RyaW5nLCB2YWx1ZTogVCwgdHRsOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5jYWNoZVNlcnZpY2Uuc2V0KGtleSwgdmFsdWUsIHR0bCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgIGBFcnJvIGFvIGRlZmluaXIgTDIgQ2FjaGUgcGFyYSAnJHtrZXl9JzogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICApO1xuICAgICAgdGhpcy5tZXRyaWNzLmZhaWxvdmVycysrO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaXNMMkF2YWlsYWJsZSgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuaGVhbHRoQ2hlY2tTZXJ2aWNlLmlzUmVkaXNBdmFpbGFibGUoKTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0b3JuYSBtw6l0cmljYXMgZGV0YWxoYWRhcyBkbyBjYWNoZVxuICAgKi9cbiAgZ2V0TWV0cmljcygpIHtcbiAgICBjb25zdCB0b3RhbEwxT3BlcmF0aW9ucyA9IHRoaXMubWV0cmljcy5sMUhpdHMgKyB0aGlzLm1ldHJpY3MubDFNaXNzZXM7XG4gICAgY29uc3QgdG90YWxMMk9wZXJhdGlvbnMgPSB0aGlzLm1ldHJpY3MubDJIaXRzICsgdGhpcy5tZXRyaWNzLmwyTWlzc2VzO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnRoaXMubWV0cmljcyxcbiAgICAgIGwxU2l6ZTogdGhpcy5sMUNhY2hlLnNpemUsXG4gICAgICBsMU1heFNpemU6IHRoaXMubWF4TDFTaXplLFxuICAgICAgbDFIaXRSYXRlOlxuICAgICAgICB0b3RhbEwxT3BlcmF0aW9ucyA+IDBcbiAgICAgICAgICA/ICh0aGlzLm1ldHJpY3MubDFIaXRzIC8gdG90YWxMMU9wZXJhdGlvbnMpICogMTAwXG4gICAgICAgICAgOiAwLFxuICAgICAgbDJIaXRSYXRlOlxuICAgICAgICB0b3RhbEwyT3BlcmF0aW9ucyA+IDBcbiAgICAgICAgICA/ICh0aGlzLm1ldHJpY3MubDJIaXRzIC8gdG90YWxMMk9wZXJhdGlvbnMpICogMTAwXG4gICAgICAgICAgOiAwLFxuICAgICAgb3ZlcmFsbEhpdFJhdGU6XG4gICAgICAgIHRvdGFsTDFPcGVyYXRpb25zICsgdG90YWxMMk9wZXJhdGlvbnMgPiAwXG4gICAgICAgICAgPyAoKHRoaXMubWV0cmljcy5sMUhpdHMgKyB0aGlzLm1ldHJpY3MubDJIaXRzKSAvXG4gICAgICAgICAgICAgICh0b3RhbEwxT3BlcmF0aW9ucyArIHRvdGFsTDJPcGVyYXRpb25zKSkgKlxuICAgICAgICAgICAgMTAwXG4gICAgICAgICAgOiAwLFxuICAgICAgY3JpdGljYWxLZXlzQ291bnQ6IHRoaXMuY3JpdGljYWxLZXlzLnNpemUsXG4gICAgICBwZW5kaW5nT3BlcmF0aW9uczogdGhpcy5wZW5kaW5nT3BlcmF0aW9ucy5zaXplLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogUmVzZXRhIG3DqXRyaWNhcyAow7p0aWwgcGFyYSB0ZXN0ZXMpXG4gICAqL1xuICByZXNldE1ldHJpY3MoKTogdm9pZCB7XG4gICAgdGhpcy5tZXRyaWNzID0ge1xuICAgICAgbDFIaXRzOiAwLFxuICAgICAgbDFNaXNzZXM6IDAsXG4gICAgICBsMkhpdHM6IDAsXG4gICAgICBsMk1pc3NlczogMCxcbiAgICAgIGV2aWN0aW9uczogMCxcbiAgICAgIHdhcm1pbmdPcGVyYXRpb25zOiAwLFxuICAgICAgZmFpbG92ZXJzOiAwLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogTGltcGEgdG9kbyBvIGNhY2hlICjDunRpbCBwYXJhIHRlc3RlcylcbiAgICovXG4gIGFzeW5jIGNsZWFyKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMubDFDYWNoZS5jbGVhcigpO1xuXG4gICAgaWYgKHRoaXMuZW5hYmxlTDJDYWNoZSAmJiAoYXdhaXQgdGhpcy5pc0wyQXZhaWxhYmxlKCkpKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBJbXBsZW1lbnRhciBjbGVhciBubyBDYWNoZVNlcnZpY2Ugc2UgbmVjZXNzw6FyaW9cbiAgICAgICAgdGhpcy5sb2dnZXIuZGVidWcoJ0wyIENhY2hlIGNsZWFyZWQnKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLndhcm4oYEVycm8gYW8gbGltcGFyIEwyIENhY2hlOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoJ0NhY2hlIGjDrWJyaWRvIGxpbXBvJyk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==