a82e905e9891ded565baa1fc8123b7a6
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.StatusTransitionValidator = void 0;
const common_1 = require("@nestjs/common");
const status_pagamento_enum_1 = require("../../../enums/status-pagamento.enum");
/**
 * Serviço para validação de transições de status de pagamento
 *
 * Implementa a lógica de máquina de estados para controlar
 * as transições válidas entre os diferentes status de pagamento.
 *
 * @author Equipe PGBen
 */
let StatusTransitionValidator = class StatusTransitionValidator {
    // Matriz de transições permitidas
    transitions = [
        // De AGENDADO para...
        {
            from: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
            to: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
            allowed: true
        },
        {
            from: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
            to: status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO,
            allowed: true
        },
        {
            from: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
            to: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO,
            allowed: false,
            reasonIfBlocked: 'Não é possível confirmar um pagamento que ainda não foi liberado'
        },
        // De LIBERADO para...
        {
            from: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
            to: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO,
            allowed: true
        },
        {
            from: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
            to: status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO,
            allowed: true
        },
        {
            from: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
            to: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
            allowed: false,
            reasonIfBlocked: 'Não é possível retornar um pagamento liberado para o status agendado'
        },
        // De CONFIRMADO para...
        {
            from: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO,
            to: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
            allowed: false,
            reasonIfBlocked: 'Não é possível retornar um pagamento confirmado para o status agendado'
        },
        {
            from: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO,
            to: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
            allowed: false,
            reasonIfBlocked: 'Não é possível retornar um pagamento confirmado para o status liberado'
        },
        {
            from: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO,
            to: status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO,
            allowed: false,
            reasonIfBlocked: 'Não é possível cancelar um pagamento que já foi confirmado'
        },
        // De CANCELADO para...
        {
            from: status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO,
            to: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
            allowed: false,
            reasonIfBlocked: 'Não é possível reativar um pagamento cancelado'
        },
        {
            from: status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO,
            to: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
            allowed: false,
            reasonIfBlocked: 'Não é possível liberar um pagamento cancelado'
        },
        {
            from: status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO,
            to: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO,
            allowed: false,
            reasonIfBlocked: 'Não é possível confirmar um pagamento cancelado'
        }
    ];
    /**
     * Verifica se uma transição de status é permitida
     *
     * @param fromStatus Status atual do pagamento
     * @param toStatus Status desejado
     * @returns Um objeto contendo o resultado da validação e a razão se bloqueado
     */
    canTransition(fromStatus, toStatus) {
        // Se não há mudança de status, é permitido
        if (fromStatus === toStatus) {
            return { allowed: true };
        }
        // Busca a transição correspondente
        const transition = this.transitions.find(t => t.from === fromStatus && t.to === toStatus);
        // Se a transição não está definida, não é permitida
        if (!transition) {
            return {
                allowed: false,
                reason: `Transição de ${fromStatus} para ${toStatus} não está definida`
            };
        }
        // Retorna o resultado da validação
        return {
            allowed: transition.allowed,
            reason: transition.allowed ? undefined : transition.reasonIfBlocked
        };
    }
    /**
     * Obtém todas as transições possíveis a partir de um status
     *
     * @param fromStatus Status atual
     * @returns Lista de status para os quais é possível transicionar
     */
    getPossibleTransitions(fromStatus) {
        return this.transitions
            .filter(t => t.from === fromStatus && t.allowed)
            .map(t => t.to);
    }
    /**
     * Verifica se um pagamento pode ser cancelado
     *
     * @param currentStatus Status atual do pagamento
     * @returns true se o pagamento pode ser cancelado, false caso contrário
     */
    canBeCanceled(currentStatus) {
        return this.canTransition(currentStatus, status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO).allowed;
    }
    /**
     * Verifica se um pagamento pode ser confirmado
     *
     * @param currentStatus Status atual do pagamento
     * @returns true se o pagamento pode ser confirmado, false caso contrário
     */
    canBeConfirmed(currentStatus) {
        return this.canTransition(currentStatus, status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO).allowed;
    }
};
exports.StatusTransitionValidator = StatusTransitionValidator;
exports.StatusTransitionValidator = StatusTransitionValidator = __decorate([
    (0, common_1.Injectable)()
], StatusTransitionValidator);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcdmFsaWRhdG9yc1xcc3RhdHVzLXRyYW5zaXRpb24tdmFsaWRhdG9yLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLDJDQUE0QztBQUM1QyxnRkFBMkU7QUFZM0U7Ozs7Ozs7R0FPRztBQUVJLElBQU0seUJBQXlCLEdBQS9CLE1BQU0seUJBQXlCO0lBQ3BDLGtDQUFrQztJQUNqQixXQUFXLEdBQXVCO1FBQ2pELHNCQUFzQjtRQUN0QjtZQUNFLElBQUksRUFBRSwyQ0FBbUIsQ0FBQyxRQUFRO1lBQ2xDLEVBQUUsRUFBRSwyQ0FBbUIsQ0FBQyxRQUFRO1lBQ2hDLE9BQU8sRUFBRSxJQUFJO1NBQ2Q7UUFDRDtZQUNFLElBQUksRUFBRSwyQ0FBbUIsQ0FBQyxRQUFRO1lBQ2xDLEVBQUUsRUFBRSwyQ0FBbUIsQ0FBQyxTQUFTO1lBQ2pDLE9BQU8sRUFBRSxJQUFJO1NBQ2Q7UUFDRDtZQUNFLElBQUksRUFBRSwyQ0FBbUIsQ0FBQyxRQUFRO1lBQ2xDLEVBQUUsRUFBRSwyQ0FBbUIsQ0FBQyxVQUFVO1lBQ2xDLE9BQU8sRUFBRSxLQUFLO1lBQ2QsZUFBZSxFQUFFLGtFQUFrRTtTQUNwRjtRQUVELHNCQUFzQjtRQUN0QjtZQUNFLElBQUksRUFBRSwyQ0FBbUIsQ0FBQyxRQUFRO1lBQ2xDLEVBQUUsRUFBRSwyQ0FBbUIsQ0FBQyxVQUFVO1lBQ2xDLE9BQU8sRUFBRSxJQUFJO1NBQ2Q7UUFDRDtZQUNFLElBQUksRUFBRSwyQ0FBbUIsQ0FBQyxRQUFRO1lBQ2xDLEVBQUUsRUFBRSwyQ0FBbUIsQ0FBQyxTQUFTO1lBQ2pDLE9BQU8sRUFBRSxJQUFJO1NBQ2Q7UUFDRDtZQUNFLElBQUksRUFBRSwyQ0FBbUIsQ0FBQyxRQUFRO1lBQ2xDLEVBQUUsRUFBRSwyQ0FBbUIsQ0FBQyxRQUFRO1lBQ2hDLE9BQU8sRUFBRSxLQUFLO1lBQ2Qs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QyxVQUFVLENBQy9CLENBQUMsT0FBTyxDQUFDO0lBQ1osQ0FBQztDQUNGLENBQUE7QUF6SlksOERBQXlCO29DQUF6Qix5QkFBeUI7SUFEckMsSUFBQSxtQkFBVSxHQUFFO0dBQ0EseUJBQXlCLENBeUpyQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xccGFnYW1lbnRvXFx2YWxpZGF0b3JzXFxzdGF0dXMtdHJhbnNpdGlvbi12YWxpZGF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IFN0YXR1c1BhZ2FtZW50b0VudW0gfSBmcm9tICcuLi8uLi8uLi9lbnVtcy9zdGF0dXMtcGFnYW1lbnRvLmVudW0nO1xuXG4vKipcbiAqIEludGVyZmFjZSBxdWUgZGVmaW5lIHVtYSB0cmFuc2nDp8OjbyBkZSBzdGF0dXNcbiAqL1xuaW50ZXJmYWNlIFN0YXR1c1RyYW5zaXRpb24ge1xuICBmcm9tOiBTdGF0dXNQYWdhbWVudG9FbnVtO1xuICB0bzogU3RhdHVzUGFnYW1lbnRvRW51bTtcbiAgYWxsb3dlZDogYm9vbGVhbjtcbiAgcmVhc29uSWZCbG9ja2VkPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFNlcnZpw6dvIHBhcmEgdmFsaWRhw6fDo28gZGUgdHJhbnNpw6fDtWVzIGRlIHN0YXR1cyBkZSBwYWdhbWVudG9cbiAqIFxuICogSW1wbGVtZW50YSBhIGzDs2dpY2EgZGUgbcOhcXVpbmEgZGUgZXN0YWRvcyBwYXJhIGNvbnRyb2xhclxuICogYXMgdHJhbnNpw6fDtWVzIHbDoWxpZGFzIGVudHJlIG9zIGRpZmVyZW50ZXMgc3RhdHVzIGRlIHBhZ2FtZW50by5cbiAqIFxuICogQGF1dGhvciBFcXVpcGUgUEdCZW5cbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFN0YXR1c1RyYW5zaXRpb25WYWxpZGF0b3Ige1xuICAvLyBNYXRyaXogZGUgdHJhbnNpw6fDtWVzIHBlcm1pdGlkYXNcbiAgcHJpdmF0ZSByZWFkb25seSB0cmFuc2l0aW9uczogU3RhdHVzVHJhbnNpdGlvbltdID0gW1xuICAgIC8vIERlIEFHRU5EQURPIHBhcmEuLi5cbiAgICB7IFxuICAgICAgZnJvbTogU3RhdHVzUGFnYW1lbnRvRW51bS5BR0VOREFETywgXG4gICAgICB0bzogU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETywgXG4gICAgICBhbGxvd2VkOiB0cnVlIFxuICAgIH0sXG4gICAgeyBcbiAgICAgIGZyb206IFN0YXR1c1BhZ2FtZW50b0VudW0uQUdFTkRBRE8sIFxuICAgICAgdG86IFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPLCBcbiAgICAgIGFsbG93ZWQ6IHRydWUgXG4gICAgfSxcbiAgICB7IFxuICAgICAgZnJvbTogU3RhdHVzUGFnYW1lbnRvRW51bS5BR0VOREFETywgXG4gICAgICB0bzogU3RhdHVzUGFnYW1lbnRvRW51bS5DT05GSVJNQURPLCBcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgcmVhc29uSWZCbG9ja2VkOiAnTsOjbyDDqSBwb3Nzw612ZWwgY29uZmlybWFyIHVtIHBhZ2FtZW50byBxdWUgYWluZGEgbsOjbyBmb2kgbGliZXJhZG8nXG4gICAgfSxcbiAgICBcbiAgICAvLyBEZSBMSUJFUkFETyBwYXJhLi4uXG4gICAgeyBcbiAgICAgIGZyb206IFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE8sIFxuICAgICAgdG86IFN0YXR1c1BhZ2FtZW50b0VudW0uQ09ORklSTUFETywgXG4gICAgICBhbGxvd2VkOiB0cnVlIFxuICAgIH0sXG4gICAgeyBcbiAgICAgIGZyb206IFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE8sIFxuICAgICAgdG86IFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPLCBcbiAgICAgIGFsbG93ZWQ6IHRydWUgXG4gICAgfSxcbiAgICB7IFxuICAgICAgZnJvbTogU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETywgXG4gICAgICB0bzogU3RhdHVzUGFnYW1lbnRvRW51bS5BR0VOREFETywgXG4gICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgIHJlYXNvbklmQmxvY2tlZDogJ07Do28gw6kgcG9zc8OtdmVsIHJldG9ybmFyIHVtIHBhZ2FtZW50byBsaWJlcmFkbyBwYXJhIG8gc3RhdHVzIGFnZW5kYWRvJ1xuICAgIH0sXG4gICAgXG4gICAgLy8gRGUgQ09ORklSTUFETyBwYXJhLi4uXG4gICAgeyBcbiAgICAgIGZyb206IFN0YXR1c1BhZ2FtZW50b0VudW0uQ09ORklSTUFETywgXG4gICAgICB0bzogU3RhdHVzUGFnYW1lbnRvRW51bS5BR0VOREFETywgXG4gICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgIHJlYXNvbklmQmxvY2tlZDogJ07Do28gw6kgcG9zc8OtdmVsIHJldG9ybmFyIHVtIHBhZ2FtZW50byBjb25maXJtYWRvIHBhcmEgbyBzdGF0dXMgYWdlbmRhZG8nXG4gICAgfSxcbiAgICB7IFxuICAgICAgZnJvbTogU3RhdHVzUGFnYW1lbnRvRW51bS5DT05GSVJNQURPLCBcbiAgICAgIHRvOiBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPLCBcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgcmVhc29uSWZCbG9ja2VkOiAnTsOjbyDDqSBwb3Nzw612ZWwgcmV0b3JuYXIgdW0gcGFnYW1lbnRvIGNvbmZpcm1hZG8gcGFyYSBvIHN0YXR1cyBsaWJlcmFkbydcbiAgICB9LFxuICAgIHsgXG4gICAgICBmcm9tOiBTdGF0dXNQYWdhbWVudG9FbnVtLkNPTkZJUk1BRE8sIFxuICAgICAgdG86IFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPLCBcbiAgICAgIGFsbG93ZWQ6IGZhbHNlLFxuICAgICAgcmVhc29uSWZCbG9ja2VkOiAnTsOjbyDDqSBwb3Nzw612ZWwgY2FuY2VsYXIgdW0gcGFnYW1lbnRvIHF1ZSBqw6EgZm9pIGNvbmZpcm1hZG8nXG4gICAgfSxcbiAgICBcbiAgICAvLyBEZSBDQU5DRUxBRE8gcGFyYS4uLlxuICAgIHsgXG4gICAgICBmcm9tOiBTdGF0dXNQYWdhbWVudG9FbnVtLkNBTkNFTEFETywgXG4gICAgICB0bzogU3RhdHVzUGFnYW1lbnRvRW51bS5BR0VOREFETywgXG4gICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgIHJlYXNvbklmQmxvY2tlZDogJ07Do28gw6kgcG9zc8OtdmVsIHJlYXRpdmFyIHVtIHBhZ2FtZW50byBjYW5jZWxhZG8nXG4gICAgfSxcbiAgICB7IFxuICAgICAgZnJvbTogU3RhdHVzUGFnYW1lbnRvRW51bS5DQU5DRUxBRE8sIFxuICAgICAgdG86IFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE8sIFxuICAgICAgYWxsb3dlZDogZmFsc2UsXG4gICAgICByZWFzb25JZkJsb2NrZWQ6ICdOw6NvIMOpIHBvc3PDrXZlbCBsaWJlcmFyIHVtIHBhZ2FtZW50byBjYW5jZWxhZG8nXG4gICAgfSxcbiAgICB7IFxuICAgICAgZnJvbTogU3RhdHVzUGFnYW1lbnRvRW51bS5DQU5DRUxBRE8sIFxuICAgICAgdG86IFN0YXR1c1BhZ2FtZW50b0VudW0uQ09ORklSTUFETywgXG4gICAgICBhbGxvd2VkOiBmYWxzZSxcbiAgICAgIHJlYXNvbklmQmxvY2tlZDogJ07Do28gw6kgcG9zc8OtdmVsIGNvbmZpcm1hciB1bSBwYWdhbWVudG8gY2FuY2VsYWRvJ1xuICAgIH1cbiAgXTtcblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgdW1hIHRyYW5zacOnw6NvIGRlIHN0YXR1cyDDqSBwZXJtaXRpZGFcbiAgICogXG4gICAqIEBwYXJhbSBmcm9tU3RhdHVzIFN0YXR1cyBhdHVhbCBkbyBwYWdhbWVudG9cbiAgICogQHBhcmFtIHRvU3RhdHVzIFN0YXR1cyBkZXNlamFkb1xuICAgKiBAcmV0dXJucyBVbSBvYmpldG8gY29udGVuZG8gbyByZXN1bHRhZG8gZGEgdmFsaWRhw6fDo28gZSBhIHJhesOjbyBzZSBibG9xdWVhZG9cbiAgICovXG4gIGNhblRyYW5zaXRpb24oZnJvbVN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bSwgdG9TdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0pOiB7IFxuICAgIGFsbG93ZWQ6IGJvb2xlYW47IFxuICAgIHJlYXNvbj86IHN0cmluZyBcbiAgfSB7XG4gICAgLy8gU2UgbsOjbyBow6EgbXVkYW7Dp2EgZGUgc3RhdHVzLCDDqSBwZXJtaXRpZG9cbiAgICBpZiAoZnJvbVN0YXR1cyA9PT0gdG9TdGF0dXMpIHtcbiAgICAgIHJldHVybiB7IGFsbG93ZWQ6IHRydWUgfTtcbiAgICB9XG5cbiAgICAvLyBCdXNjYSBhIHRyYW5zacOnw6NvIGNvcnJlc3BvbmRlbnRlXG4gICAgY29uc3QgdHJhbnNpdGlvbiA9IHRoaXMudHJhbnNpdGlvbnMuZmluZChcbiAgICAgIHQgPT4gdC5mcm9tID09PSBmcm9tU3RhdHVzICYmIHQudG8gPT09IHRvU3RhdHVzXG4gICAgKTtcblxuICAgIC8vIFNlIGEgdHJhbnNpw6fDo28gbsOjbyBlc3TDoSBkZWZpbmlkYSwgbsOjbyDDqSBwZXJtaXRpZGFcbiAgICBpZiAoIXRyYW5zaXRpb24pIHtcbiAgICAgIHJldHVybiB7IFxuICAgICAgICBhbGxvd2VkOiBmYWxzZSwgXG4gICAgICAgIHJlYXNvbjogYFRyYW5zacOnw6NvIGRlICR7ZnJvbVN0YXR1c30gcGFyYSAke3RvU3RhdHVzfSBuw6NvIGVzdMOhIGRlZmluaWRhYCBcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gUmV0b3JuYSBvIHJlc3VsdGFkbyBkYSB2YWxpZGHDp8Ojb1xuICAgIHJldHVybiB7IFxuICAgICAgYWxsb3dlZDogdHJhbnNpdGlvbi5hbGxvd2VkLCBcbiAgICAgIHJlYXNvbjogdHJhbnNpdGlvbi5hbGxvd2VkID8gdW5kZWZpbmVkIDogdHJhbnNpdGlvbi5yZWFzb25JZkJsb2NrZWQgXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gdG9kYXMgYXMgdHJhbnNpw6fDtWVzIHBvc3PDrXZlaXMgYSBwYXJ0aXIgZGUgdW0gc3RhdHVzXG4gICAqIFxuICAgKiBAcGFyYW0gZnJvbVN0YXR1cyBTdGF0dXMgYXR1YWxcbiAgICogQHJldHVybnMgTGlzdGEgZGUgc3RhdHVzIHBhcmEgb3MgcXVhaXMgw6kgcG9zc8OtdmVsIHRyYW5zaWNpb25hclxuICAgKi9cbiAgZ2V0UG9zc2libGVUcmFuc2l0aW9ucyhmcm9tU3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtKTogU3RhdHVzUGFnYW1lbnRvRW51bVtdIHtcbiAgICByZXR1cm4gdGhpcy50cmFuc2l0aW9uc1xuICAgICAgLmZpbHRlcih0ID0+IHQuZnJvbSA9PT0gZnJvbVN0YXR1cyAmJiB0LmFsbG93ZWQpXG4gICAgICAubWFwKHQgPT4gdC50byk7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgdW0gcGFnYW1lbnRvIHBvZGUgc2VyIGNhbmNlbGFkb1xuICAgKiBcbiAgICogQHBhcmFtIGN1cnJlbnRTdGF0dXMgU3RhdHVzIGF0dWFsIGRvIHBhZ2FtZW50b1xuICAgKiBAcmV0dXJucyB0cnVlIHNlIG8gcGFnYW1lbnRvIHBvZGUgc2VyIGNhbmNlbGFkbywgZmFsc2UgY2FzbyBjb250csOhcmlvXG4gICAqL1xuICBjYW5CZUNhbmNlbGVkKGN1cnJlbnRTdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0pOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jYW5UcmFuc2l0aW9uKFxuICAgICAgY3VycmVudFN0YXR1cywgXG4gICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkNBTkNFTEFET1xuICAgICkuYWxsb3dlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSB1bSBwYWdhbWVudG8gcG9kZSBzZXIgY29uZmlybWFkb1xuICAgKiBcbiAgICogQHBhcmFtIGN1cnJlbnRTdGF0dXMgU3RhdHVzIGF0dWFsIGRvIHBhZ2FtZW50b1xuICAgKiBAcmV0dXJucyB0cnVlIHNlIG8gcGFnYW1lbnRvIHBvZGUgc2VyIGNvbmZpcm1hZG8sIGZhbHNlIGNhc28gY29udHLDoXJpb1xuICAgKi9cbiAgY2FuQmVDb25maXJtZWQoY3VycmVudFN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNhblRyYW5zaXRpb24oXG4gICAgICBjdXJyZW50U3RhdHVzLCBcbiAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQ09ORklSTUFET1xuICAgICkuYWxsb3dlZDtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9