1664f4ff630f8eef3d587989b429aae6
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const rxjs_1 = require("rxjs");
const validation_error_interceptor_1 = require("./validation-error.interceptor");
describe('ValidationErrorInterceptor', () => {
    let interceptor;
    let mockExecutionContext;
    let mockCallHandler;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [validation_error_interceptor_1.ValidationErrorInterceptor],
        }).compile();
        interceptor = module.get(validation_error_interceptor_1.ValidationErrorInterceptor);
        mockExecutionContext = {
            switchToHttp: jest.fn(),
            getClass: jest.fn(),
            getHandler: jest.fn(),
            getArgs: jest.fn(),
            getArgByIndex: jest.fn(),
            switchToRpc: jest.fn(),
            switchToWs: jest.fn(),
            getType: jest.fn(),
        };
        mockCallHandler = {
            handle: jest.fn(),
        };
    });
    describe('intercept', () => {
        it('deve passar erros não relacionados à validação sem modificação', (done) => {
            const nonValidationError = new Error('Erro genérico');
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => nonValidationError));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    expect(error).toBe(nonValidationError);
                    done();
                },
            });
        });
        it('deve passar BadRequestException não relacionado à validação', (done) => {
            const nonValidationBadRequest = new common_1.BadRequestException('Erro customizado');
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => nonValidationBadRequest));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    expect(error).toBeInstanceOf(common_1.BadRequestException);
                    expect(error.getResponse()).toBe('Erro customizado');
                    done();
                },
            });
        });
        it('deve melhorar erros de validação do class-validator', (done) => {
            const validationError = new common_1.BadRequestException({
                error: 'Bad Request',
                message: [
                    'nome must be a string',
                    'email must be an email',
                    'idade must not be less than 18',
                ],
                statusCode: 400,
            });
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => validationError));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    expect(error).toBeInstanceOf(common_1.BadRequestException);
                    const response = error.getResponse();
                    expect(response).toHaveProperty('error', 'Erro de Validação');
                    expect(response).toHaveProperty('message', 'Os dados fornecidos contêm erros de validação');
                    expect(response).toHaveProperty('details');
                    expect(response).toHaveProperty('timestamp');
                    expect(response).toHaveProperty('statusCode', 400);
                    done();
                },
            });
        });
        it('deve agrupar erros por campo', (done) => {
            const validationError = new common_1.BadRequestException({
                error: 'Bad Request',
                message: [
                    'nome must be a string',
                    'nome must be longer than 2 characters',
                    'email must be an email',
                ],
                statusCode: 400,
            });
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => validationError));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    const response = error.getResponse();
                    const details = response.details;
                    expect(details).toHaveProperty('nome');
                    expect(details).toHaveProperty('email');
                    expect(details.nome).toHaveLength(2); // Dois erros para o campo nome
                    expect(details.email).toHaveLength(1); // Um erro para o campo email
                    done();
                },
            });
        });
        it('deve melhorar mensagens de erro de enum', (done) => {
            const enumError = new common_1.BadRequestException({
                error: 'Bad Request',
                message: [
                    'status must be one of the following values [ATIVO, INATIVO, PENDENTE]',
                ],
                statusCode: 400,
            });
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => enumError));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    try {
                        const response = error.getResponse();
                        const details = response.details;
                        expect(details.status[0]).toContain('deve ser um dos seguintes valores');
                        expect(details.status[0]).toContain('ATIVO, INATIVO, PENDENTE');
                        done();
                    }
                    catch (e) {
                        done(e);
                    }
                },
            });
        });
        it('deve melhorar mensagens de erro de tipo', (done) => {
            const typeError = new common_1.BadRequestException({
                error: 'Bad Request',
                message: [
                    'idade must be a number',
                    'ativo must be a boolean',
                ],
                statusCode: 400,
            });
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => typeError));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    try {
                        const response = error.getResponse();
                        const details = response.details;
                        expect(details.idade[0]).toContain('deve ser um número');
                        expect(details.ativo[0]).toContain('deve ser um verdadeiro ou falso');
                        done();
                    }
                    catch (e) {
                        done(e);
                    }
                },
            });
        });
        it('deve melhorar mensagens de erro de tamanho', (done) => {
            const lengthError = new common_1.BadRequestException({
                error: 'Bad Request',
                message: [
                    'nome must be longer than 2 characters',
                    'descricao must be shorter than 100 characters',
                ],
                statusCode: 400,
            });
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => lengthError));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    try {
                        const response = error.getResponse();
                        const details = response.details;
                        expect(details.nome[0]).toContain('deve ter mais de 2 caracteres');
                        expect(details.descricao[0]).toContain('deve ter menos de 100 caracteres');
                        done();
                    }
                    catch (e) {
                        done(e);
                    }
                },
            });
        });
        it('deve melhorar mensagens de erro numérico', (done) => {
            const numericError = new common_1.BadRequestException({
                error: 'Bad Request',
                message: [
                    'idade must not be less than 18',
                    'salario must not be greater than 50000',
                ],
                statusCode: 400,
            });
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.throwError)(() => numericError));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                error: (error) => {
                    try {
                        const response = error.getResponse();
                        const details = response.details;
                        expect(details.idade[0]).toContain('deve ser maior ou igual a 18');
                        expect(details.salario[0]).toContain('deve ser menor ou igual a 50000');
                        done();
                    }
                    catch (e) {
                        done(e);
                    }
                },
            });
        });
        it('deve passar dados válidos sem modificação', (done) => {
            const validData = { id: 1, nome: 'Teste' };
            mockCallHandler.handle = jest.fn(() => (0, rxjs_1.of)(validData));
            interceptor.intercept(mockExecutionContext, mockCallHandler).subscribe({
                next: (data) => {
                    expect(data).toBe(validData);
                    done();
                },
            });
        });
    });
});
describe('ValidationMessageHelper', () => {
    describe('required', () => {
        it('deve criar mensagem para campo obrigatório', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.required('nome');
            expect(message).toBe("O campo 'nome' é obrigatório");
        });
    });
    describe('invalidType', () => {
        it('deve criar mensagem para tipo inválido', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidType('idade', 'number');
            expect(message).toBe("O campo 'idade' deve ser número");
        });
        it('deve mapear tipos em inglês para português', () => {
            expect(validation_error_interceptor_1.ValidationMessageHelper.invalidType('campo', 'string'))
                .toBe("O campo 'campo' deve ser texto");
            expect(validation_error_interceptor_1.ValidationMessageHelper.invalidType('campo', 'boolean'))
                .toBe("O campo 'campo' deve ser verdadeiro ou falso");
            expect(validation_error_interceptor_1.ValidationMessageHelper.invalidType('campo', 'email'))
                .toBe("O campo 'campo' deve ser email válido");
        });
    });
    describe('invalidLength', () => {
        it('deve criar mensagem para tamanho com min e max', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidLength('nome', 2, 50);
            expect(message).toBe("O campo 'nome' deve ter entre 2 e 50 caracteres");
        });
        it('deve criar mensagem apenas para mínimo', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidLength('nome', 2);
            expect(message).toBe("O campo 'nome' deve ter pelo menos 2 caracteres");
        });
        it('deve criar mensagem apenas para máximo', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidLength('nome', undefined, 50);
            expect(message).toBe("O campo 'nome' deve ter no máximo 50 caracteres");
        });
        it('deve criar mensagem genérica quando não há limites', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidLength('nome');
            expect(message).toBe("O campo 'nome' tem tamanho inválido");
        });
    });
    describe('invalidRange', () => {
        it('deve criar mensagem para intervalo com min e max', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidRange('idade', 18, 65);
            expect(message).toBe("O campo 'idade' deve estar entre 18 e 65");
        });
        it('deve criar mensagem apenas para mínimo', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidRange('idade', 18);
            expect(message).toBe("O campo 'idade' deve ser maior ou igual a 18");
        });
        it('deve criar mensagem apenas para máximo', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidRange('idade', undefined, 65);
            expect(message).toBe("O campo 'idade' deve ser menor ou igual a 65");
        });
    });
    describe('invalidFormat', () => {
        it('deve criar mensagem para formato inválido', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidFormat('email', 'email');
            expect(message).toBe("O campo 'email' deve ter o formato: email válido (exemplo: usuario@dominio.com)");
        });
        it('deve mapear formatos conhecidos', () => {
            expect(validation_error_interceptor_1.ValidationMessageHelper.invalidFormat('cpf', 'cpf'))
                .toContain('CPF válido (exemplo: 123.456.789-00)');
            expect(validation_error_interceptor_1.ValidationMessageHelper.invalidFormat('telefone', 'phone'))
                .toContain('telefone válido (exemplo: (11) 99999-9999)');
        });
        it('deve usar formato original se não mapeado', () => {
            const message = validation_error_interceptor_1.ValidationMessageHelper.invalidFormat('campo', 'formato_customizado');
            expect(message).toBe("O campo 'campo' deve ter o formato: formato_customizado");
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXHNoYXJlZFxcaW50ZXJjZXB0b3JzXFx2YWxpZGF0aW9uLWVycm9yLmludGVyY2VwdG9yLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsMkNBQW9GO0FBQ3BGLCtCQUFzQztBQUN0QyxpRkFBcUc7QUFFckcsUUFBUSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRTtJQUMxQyxJQUFJLFdBQXVDLENBQUM7SUFDNUMsSUFBSSxvQkFBc0MsQ0FBQztJQUMzQyxJQUFJLGVBQTRCLENBQUM7SUFFakMsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUUsQ0FBQyx5REFBMEIsQ0FBQztTQUN4QyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixXQUFXLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBNkIseURBQTBCLENBQUMsQ0FBQztRQUVqRixvQkFBb0IsR0FBRztZQUNyQixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN2QixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNuQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNyQixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNsQixhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN4QixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN0QixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNyQixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNuQixDQUFDO1FBRUYsZUFBZSxHQUFHO1lBQ2hCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ2xCLENBQUM7SUFDSixDQUFDLENB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RixDQUFDLENBQUM7UUFDMUcsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsaUNBQWlDLEVBQUUsR0FBRyxFQUFFO1lBQ3pDLE1BQU0sQ0FBQyxzREFBdUIsQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO2lCQUN4RCxTQUFTLENBQUMsc0NBQXNDLENBQUMsQ0FBQztZQUNyRCxNQUFNLENBQUMsc0RBQXVCLENBQUMsYUFBYSxDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQztpQkFDL0QsU0FBUyxDQUFDLDRDQUE0QyxDQUFDLENBQUM7UUFDN0QsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMkNBQTJDLEVBQUUsR0FBRyxFQUFFO1lBQ25ELE1BQU0sT0FBTyxHQUFHLHNEQUF1QixDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUscUJBQXFCLENBQUMsQ0FBQztZQUN0RixNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLHlEQUF5RCxDQUFDLENBQUM7UUFDbEYsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxzaGFyZWRcXGludGVyY2VwdG9yc1xcdmFsaWRhdGlvbi1lcnJvci5pbnRlcmNlcHRvci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgQmFkUmVxdWVzdEV4Y2VwdGlvbiwgRXhlY3V0aW9uQ29udGV4dCwgQ2FsbEhhbmRsZXIgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBvZiwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgVmFsaWRhdGlvbkVycm9ySW50ZXJjZXB0b3IsIFZhbGlkYXRpb25NZXNzYWdlSGVscGVyIH0gZnJvbSAnLi92YWxpZGF0aW9uLWVycm9yLmludGVyY2VwdG9yJztcblxuZGVzY3JpYmUoJ1ZhbGlkYXRpb25FcnJvckludGVyY2VwdG9yJywgKCkgPT4ge1xuICBsZXQgaW50ZXJjZXB0b3I6IFZhbGlkYXRpb25FcnJvckludGVyY2VwdG9yO1xuICBsZXQgbW9ja0V4ZWN1dGlvbkNvbnRleHQ6IEV4ZWN1dGlvbkNvbnRleHQ7XG4gIGxldCBtb2NrQ2FsbEhhbmRsZXI6IENhbGxIYW5kbGVyO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBwcm92aWRlcnM6IFtWYWxpZGF0aW9uRXJyb3JJbnRlcmNlcHRvcl0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgaW50ZXJjZXB0b3IgPSBtb2R1bGUuZ2V0PFZhbGlkYXRpb25FcnJvckludGVyY2VwdG9yPihWYWxpZGF0aW9uRXJyb3JJbnRlcmNlcHRvcik7XG4gICAgXG4gICAgbW9ja0V4ZWN1dGlvbkNvbnRleHQgPSB7XG4gICAgICBzd2l0Y2hUb0h0dHA6IGplc3QuZm4oKSxcbiAgICAgIGdldENsYXNzOiBqZXN0LmZuKCksXG4gICAgICBnZXRIYW5kbGVyOiBqZXN0LmZuKCksXG4gICAgICBnZXRBcmdzOiBqZXN0LmZuKCksXG4gICAgICBnZXRBcmdCeUluZGV4OiBqZXN0LmZuKCksXG4gICAgICBzd2l0Y2hUb1JwYzogamVzdC5mbigpLFxuICAgICAgc3dpdGNoVG9XczogamVzdC5mbigpLFxuICAgICAgZ2V0VHlwZTogamVzdC5mbigpLFxuICAgIH07XG5cbiAgICBtb2NrQ2FsbEhhbmRsZXIgPSB7XG4gICAgICBoYW5kbGU6IGplc3QuZm4oKSxcbiAgICB9O1xuICB9KTtcblxuICBkZXNjcmliZSgnaW50ZXJjZXB0JywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHBhc3NhciBlcnJvcyBuw6NvIHJlbGFjaW9uYWRvcyDDoCB2YWxpZGHDp8OjbyBzZW0gbW9kaWZpY2HDp8OjbycsIChkb25lKSA9PiB7XG4gICAgICBjb25zdCBub25WYWxpZGF0aW9uRXJyb3IgPSBuZXcgRXJyb3IoJ0Vycm8gZ2Vuw6lyaWNvJyk7XG4gICAgICBtb2NrQ2FsbEhhbmRsZXIuaGFuZGxlID0gamVzdC5mbigoKSA9PiB0aHJvd0Vycm9yKCgpID0+IG5vblZhbGlkYXRpb25FcnJvcikpO1xuXG4gICAgICBpbnRlcmNlcHRvci5pbnRlcmNlcHQobW9ja0V4ZWN1dGlvbkNvbnRleHQsIG1vY2tDYWxsSGFuZGxlcikuc3Vic2NyaWJlKHtcbiAgICAgICAgZXJyb3I6IChlcnJvcikgPT4ge1xuICAgICAgICAgIGV4cGVjdChlcnJvcikudG9CZShub25WYWxpZGF0aW9uRXJyb3IpO1xuICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcGFzc2FyIEJhZFJlcXVlc3RFeGNlcHRpb24gbsOjbyByZWxhY2lvbmFkbyDDoCB2YWxpZGHDp8OjbycsIChkb25lKSA9PiB7XG4gICAgICBjb25zdCBub25WYWxpZGF0aW9uQmFkUmVxdWVzdCA9IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKCdFcnJvIGN1c3RvbWl6YWRvJyk7XG4gICAgICBtb2NrQ2FsbEhhbmRsZXIuaGFuZGxlID0gamVzdC5mbigoKSA9PiB0aHJvd0Vycm9yKCgpID0+IG5vblZhbGlkYXRpb25CYWRSZXF1ZXN0KSk7XG5cbiAgICAgIGludGVyY2VwdG9yLmludGVyY2VwdChtb2NrRXhlY3V0aW9uQ29udGV4dCwgbW9ja0NhbGxIYW5kbGVyKS5zdWJzY3JpYmUoe1xuICAgICAgICBlcnJvcjogKGVycm9yKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KGVycm9yKS50b0JlSW5zdGFuY2VPZihCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcbiAgICAgICAgICBleHBlY3QoZXJyb3IuZ2V0UmVzcG9uc2UoKSkudG9CZSgnRXJybyBjdXN0b21pemFkbycpO1xuICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbWVsaG9yYXIgZXJyb3MgZGUgdmFsaWRhw6fDo28gZG8gY2xhc3MtdmFsaWRhdG9yJywgKGRvbmUpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRpb25FcnJvciA9IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKHtcbiAgICAgICAgZXJyb3I6ICdCYWQgUmVxdWVzdCcsXG4gICAgICAgIG1lc3NhZ2U6IFtcbiAgICAgICAgICAnbm9tZSBtdXN0IGJlIGEgc3RyaW5nJyxcbiAgICAgICAgICAnZW1haWwgbXVzdCBiZSBhbiBlbWFpbCcsXG4gICAgICAgICAgJ2lkYWRlIG11c3Qgbm90IGJlIGxlc3MgdGhhbiAxOCcsXG4gICAgICAgIF0sXG4gICAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrQ2FsbEhhbmRsZXIuaGFuZGxlID0gamVzdC5mbigoKSA9PiB0aHJvd0Vycm9yKCgpID0+IHZhbGlkYXRpb25FcnJvcikpO1xuXG4gICAgICBpbnRlcmNlcHRvci5pbnRlcmNlcHQobW9ja0V4ZWN1dGlvbkNvbnRleHQsIG1vY2tDYWxsSGFuZGxlcikuc3Vic2NyaWJlKHtcbiAgICAgICAgZXJyb3I6IChlcnJvcikgPT4ge1xuICAgICAgICAgIGV4cGVjdChlcnJvcikudG9CZUluc3RhbmNlT2YoQmFkUmVxdWVzdEV4Y2VwdGlvbik7XG4gICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBlcnJvci5nZXRSZXNwb25zZSgpO1xuICAgICAgICAgIFxuICAgICAgICAgIGV4cGVjdChyZXNwb25zZSkudG9IYXZlUHJvcGVydHkoJ2Vycm9yJywgJ0Vycm8gZGUgVmFsaWRhw6fDo28nKTtcbiAgICAgICAgICBleHBlY3QocmVzcG9uc2UpLnRvSGF2ZVByb3BlcnR5KCdtZXNzYWdlJywgJ09zIGRhZG9zIGZvcm5lY2lkb3MgY29udMOqbSBlcnJvcyBkZSB2YWxpZGHDp8OjbycpO1xuICAgICAgICAgIGV4cGVjdChyZXNwb25zZSkudG9IYXZlUHJvcGVydHkoJ2RldGFpbHMnKTtcbiAgICAgICAgICBleHBlY3QocmVzcG9uc2UpLnRvSGF2ZVByb3BlcnR5KCd0aW1lc3RhbXAnKTtcbiAgICAgICAgICBleHBlY3QocmVzcG9uc2UpLnRvSGF2ZVByb3BlcnR5KCdzdGF0dXNDb2RlJywgNDAwKTtcbiAgICAgICAgICBcbiAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGFncnVwYXIgZXJyb3MgcG9yIGNhbXBvJywgKGRvbmUpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRpb25FcnJvciA9IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKHtcbiAgICAgICAgZXJyb3I6ICdCYWQgUmVxdWVzdCcsXG4gICAgICAgIG1lc3NhZ2U6IFtcbiAgICAgICAgICAnbm9tZSBtdXN0IGJlIGEgc3RyaW5nJyxcbiAgICAgICAgICAnbm9tZSBtdXN0IGJlIGxvbmdlciB0aGFuIDIgY2hhcmFjdGVycycsXG4gICAgICAgICAgJ2VtYWlsIG11c3QgYmUgYW4gZW1haWwnLFxuICAgICAgICBdLFxuICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXG4gICAgICB9KTtcblxuICAgICAgbW9ja0NhbGxIYW5kbGVyLmhhbmRsZSA9IGplc3QuZm4oKCkgPT4gdGhyb3dFcnJvcigoKSA9PiB2YWxpZGF0aW9uRXJyb3IpKTtcblxuICAgICAgaW50ZXJjZXB0b3IuaW50ZXJjZXB0KG1vY2tFeGVjdXRpb25Db250ZXh0LCBtb2NrQ2FsbEhhbmRsZXIpLnN1YnNjcmliZSh7XG4gICAgICAgIGVycm9yOiAoZXJyb3IpID0+IHtcbiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGVycm9yLmdldFJlc3BvbnNlKCk7XG4gICAgICAgICAgY29uc3QgZGV0YWlscyA9IHJlc3BvbnNlLmRldGFpbHM7XG4gICAgICAgICAgXG4gICAgICAgICAgZXhwZWN0KGRldGFpbHMpLnRvSGF2ZVByb3BlcnR5KCdub21lJyk7XG4gICAgICAgICAgZXhwZWN0KGRldGFpbHMpLnRvSGF2ZVByb3BlcnR5KCdlbWFpbCcpO1xuICAgICAgICAgIGV4cGVjdChkZXRhaWxzLm5vbWUpLnRvSGF2ZUxlbmd0aCgyKTsgLy8gRG9pcyBlcnJvcyBwYXJhIG8gY2FtcG8gbm9tZVxuICAgICAgICAgIGV4cGVjdChkZXRhaWxzLmVtYWlsKS50b0hhdmVMZW5ndGgoMSk7IC8vIFVtIGVycm8gcGFyYSBvIGNhbXBvIGVtYWlsXG4gICAgICAgICAgXG4gICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBtZWxob3JhciBtZW5zYWdlbnMgZGUgZXJybyBkZSBlbnVtJywgKGRvbmUpID0+IHtcbiAgICAgIGNvbnN0IGVudW1FcnJvciA9IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKHtcbiAgICAgICAgZXJyb3I6ICdCYWQgUmVxdWVzdCcsXG4gICAgICAgIG1lc3NhZ2U6IFtcbiAgICAgICAgICAnc3RhdHVzIG11c3QgYmUgb25lIG9mIHRoZSBmb2xsb3dpbmcgdmFsdWVzIFtBVElWTywgSU5BVElWTywgUEVOREVOVEVdJyxcbiAgICAgICAgXSxcbiAgICAgICAgc3RhdHVzQ29kZTogNDAwLFxuICAgICAgfSk7XG5cbiAgICAgIG1vY2tDYWxsSGFuZGxlci5oYW5kbGUgPSBqZXN0LmZuKCgpID0+IHRocm93RXJyb3IoKCkgPT4gZW51bUVycm9yKSk7XG5cbiAgICAgIGludGVyY2VwdG9yLmludGVyY2VwdChtb2NrRXhlY3V0aW9uQ29udGV4dCwgbW9ja0NhbGxIYW5kbGVyKS5zdWJzY3JpYmUoe1xuICAgICAgICBlcnJvcjogKGVycm9yKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gZXJyb3IuZ2V0UmVzcG9uc2UoKTtcbiAgICAgICAgICAgIGNvbnN0IGRldGFpbHMgPSByZXNwb25zZS5kZXRhaWxzO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBleHBlY3QoZGV0YWlscy5zdGF0dXNbMF0pLnRvQ29udGFpbignZGV2ZSBzZXIgdW0gZG9zIHNlZ3VpbnRlcyB2YWxvcmVzJyk7XG4gICAgICAgICAgICBleHBlY3QoZGV0YWlscy5zdGF0dXNbMF0pLnRvQ29udGFpbignQVRJVk8sIElOQVRJVk8sIFBFTkRFTlRFJyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBkb25lKGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbWVsaG9yYXIgbWVuc2FnZW5zIGRlIGVycm8gZGUgdGlwbycsIChkb25lKSA9PiB7XG4gICAgICBjb25zdCB0eXBlRXJyb3IgPSBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbih7XG4gICAgICAgIGVycm9yOiAnQmFkIFJlcXVlc3QnLFxuICAgICAgICBtZXNzYWdlOiBbXG4gICAgICAgICAgJ2lkYWRlIG11c3QgYmUgYSBudW1iZXInLFxuICAgICAgICAgICdhdGl2byBtdXN0IGJlIGEgYm9vbGVhbicsXG4gICAgICAgIF0sXG4gICAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrQ2FsbEhhbmRsZXIuaGFuZGxlID0gamVzdC5mbigoKSA9PiB0aHJvd0Vycm9yKCgpID0+IHR5cGVFcnJvcikpO1xuXG4gICAgICBpbnRlcmNlcHRvci5pbnRlcmNlcHQobW9ja0V4ZWN1dGlvbkNvbnRleHQsIG1vY2tDYWxsSGFuZGxlcikuc3Vic2NyaWJlKHtcbiAgICAgICAgZXJyb3I6IChlcnJvcikgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGVycm9yLmdldFJlc3BvbnNlKCk7XG4gICAgICAgICAgICBjb25zdCBkZXRhaWxzID0gcmVzcG9uc2UuZGV0YWlscztcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KGRldGFpbHMuaWRhZGVbMF0pLnRvQ29udGFpbignZGV2ZSBzZXIgdW0gbsO6bWVybycpO1xuICAgICAgICAgICAgZXhwZWN0KGRldGFpbHMuYXRpdm9bMF0pLnRvQ29udGFpbignZGV2ZSBzZXIgdW0gdmVyZGFkZWlybyBvdSBmYWxzbycpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZG9uZShlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIG1lbGhvcmFyIG1lbnNhZ2VucyBkZSBlcnJvIGRlIHRhbWFuaG8nLCAoZG9uZSkgPT4ge1xuICAgICAgY29uc3QgbGVuZ3RoRXJyb3IgPSBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbih7XG4gICAgICAgIGVycm9yOiAnQmFkIFJlcXVlc3QnLFxuICAgICAgICBtZXNzYWdlOiBbXG4gICAgICAgICAgJ25vbWUgbXVzdCBiZSBsb25nZXIgdGhhbiAyIGNoYXJhY3RlcnMnLFxuICAgICAgICAgICdkZXNjcmljYW8gbXVzdCBiZSBzaG9ydGVyIHRoYW4gMTAwIGNoYXJhY3RlcnMnLFxuICAgICAgICBdLFxuICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXG4gICAgICB9KTtcblxuICAgICAgbW9ja0NhbGxIYW5kbGVyLmhhbmRsZSA9IGplc3QuZm4oKCkgPT4gdGhyb3dFcnJvcigoKSA9PiBsZW5ndGhFcnJvcikpO1xuXG4gICAgICBpbnRlcmNlcHRvci5pbnRlcmNlcHQobW9ja0V4ZWN1dGlvbkNvbnRleHQsIG1vY2tDYWxsSGFuZGxlcikuc3Vic2NyaWJlKHtcbiAgICAgICAgZXJyb3I6IChlcnJvcikgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGVycm9yLmdldFJlc3BvbnNlKCk7XG4gICAgICAgICAgICBjb25zdCBkZXRhaWxzID0gcmVzcG9uc2UuZGV0YWlscztcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXhwZWN0KGRldGFpbHMubm9tZVswXSkudG9Db250YWluKCdkZXZlIHRlciBtYWlzIGRlIDIgY2FyYWN0ZXJlcycpO1xuICAgICAgICAgICAgZXhwZWN0KGRldGFpbHMuZGVzY3JpY2FvWzBdKS50b0NvbnRhaW4oJ2RldmUgdGVyIG1lbm9zIGRlIDEwMCBjYXJhY3RlcmVzJyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBkb25lKGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbWVsaG9yYXIgbWVuc2FnZW5zIGRlIGVycm8gbnVtw6lyaWNvJywgKGRvbmUpID0+IHtcbiAgICAgIGNvbnN0IG51bWVyaWNFcnJvciA9IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKHtcbiAgICAgICAgZXJyb3I6ICdCYWQgUmVxdWVzdCcsXG4gICAgICAgIG1lc3NhZ2U6IFtcbiAgICAgICAgICAnaWRhZGUgbXVzdCBub3QgYmUgbGVzcyB0aGFuIDE4JyxcbiAgICAgICAgICAnc2FsYXJpbyBtdXN0IG5vdCBiZSBncmVhdGVyIHRoYW4gNTAwMDAnLFxuICAgICAgICBdLFxuICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXG4gICAgICB9KTtcblxuICAgICAgbW9ja0NhbGxIYW5kbGVyLmhhbmRsZSA9IGplc3QuZm4oKCkgPT4gdGhyb3dFcnJvcigoKSA9PiBudW1lcmljRXJyb3IpKTtcblxuICAgICAgaW50ZXJjZXB0b3IuaW50ZXJjZXB0KG1vY2tFeGVjdXRpb25Db250ZXh0LCBtb2NrQ2FsbEhhbmRsZXIpLnN1YnNjcmliZSh7XG4gICAgICAgIGVycm9yOiAoZXJyb3IpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBlcnJvci5nZXRSZXNwb25zZSgpO1xuICAgICAgICAgICAgY29uc3QgZGV0YWlscyA9IHJlc3BvbnNlLmRldGFpbHM7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGV4cGVjdChkZXRhaWxzLmlkYWRlWzBdKS50b0NvbnRhaW4oJ2RldmUgc2VyIG1haW9yIG91IGlndWFsIGEgMTgnKTtcbiAgICAgICAgICAgIGV4cGVjdChkZXRhaWxzLnNhbGFyaW9bMF0pLnRvQ29udGFpbignZGV2ZSBzZXIgbWVub3Igb3UgaWd1YWwgYSA1MDAwMCcpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZG9uZShlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHBhc3NhciBkYWRvcyB2w6FsaWRvcyBzZW0gbW9kaWZpY2HDp8OjbycsIChkb25lKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZERhdGEgPSB7IGlkOiAxLCBub21lOiAnVGVzdGUnIH07XG4gICAgICBtb2NrQ2FsbEhhbmRsZXIuaGFuZGxlID0gamVzdC5mbigoKSA9PiBvZih2YWxpZERhdGEpKTtcblxuICAgICAgaW50ZXJjZXB0b3IuaW50ZXJjZXB0KG1vY2tFeGVjdXRpb25Db250ZXh0LCBtb2NrQ2FsbEhhbmRsZXIpLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6IChkYXRhKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KGRhdGEpLnRvQmUodmFsaWREYXRhKTtcbiAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ1ZhbGlkYXRpb25NZXNzYWdlSGVscGVyJywgKCkgPT4ge1xuICBkZXNjcmliZSgncmVxdWlyZWQnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgY3JpYXIgbWVuc2FnZW0gcGFyYSBjYW1wbyBvYnJpZ2F0w7NyaW8nLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXIucmVxdWlyZWQoJ25vbWUnKTtcbiAgICAgIGV4cGVjdChtZXNzYWdlKS50b0JlKFwiTyBjYW1wbyAnbm9tZScgw6kgb2JyaWdhdMOzcmlvXCIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaW52YWxpZFR5cGUnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgY3JpYXIgbWVuc2FnZW0gcGFyYSB0aXBvIGludsOhbGlkbycsICgpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBWYWxpZGF0aW9uTWVzc2FnZUhlbHBlci5pbnZhbGlkVHlwZSgnaWRhZGUnLCAnbnVtYmVyJyk7XG4gICAgICBleHBlY3QobWVzc2FnZSkudG9CZShcIk8gY2FtcG8gJ2lkYWRlJyBkZXZlIHNlciBuw7ptZXJvXCIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbWFwZWFyIHRpcG9zIGVtIGluZ2zDqnMgcGFyYSBwb3J0dWd1w6pzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KFZhbGlkYXRpb25NZXNzYWdlSGVscGVyLmludmFsaWRUeXBlKCdjYW1wbycsICdzdHJpbmcnKSlcbiAgICAgICAgLnRvQmUoXCJPIGNhbXBvICdjYW1wbycgZGV2ZSBzZXIgdGV4dG9cIik7XG4gICAgICBleHBlY3QoVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXIuaW52YWxpZFR5cGUoJ2NhbXBvJywgJ2Jvb2xlYW4nKSlcbiAgICAgICAgLnRvQmUoXCJPIGNhbXBvICdjYW1wbycgZGV2ZSBzZXIgdmVyZGFkZWlybyBvdSBmYWxzb1wiKTtcbiAgICAgIGV4cGVjdChWYWxpZGF0aW9uTWVzc2FnZUhlbHBlci5pbnZhbGlkVHlwZSgnY2FtcG8nLCAnZW1haWwnKSlcbiAgICAgICAgLnRvQmUoXCJPIGNhbXBvICdjYW1wbycgZGV2ZSBzZXIgZW1haWwgdsOhbGlkb1wiKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ludmFsaWRMZW5ndGgnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgY3JpYXIgbWVuc2FnZW0gcGFyYSB0YW1hbmhvIGNvbSBtaW4gZSBtYXgnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXIuaW52YWxpZExlbmd0aCgnbm9tZScsIDIsIDUwKTtcbiAgICAgIGV4cGVjdChtZXNzYWdlKS50b0JlKFwiTyBjYW1wbyAnbm9tZScgZGV2ZSB0ZXIgZW50cmUgMiBlIDUwIGNhcmFjdGVyZXNcIik7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBjcmlhciBtZW5zYWdlbSBhcGVuYXMgcGFyYSBtw61uaW1vJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IFZhbGlkYXRpb25NZXNzYWdlSGVscGVyLmludmFsaWRMZW5ndGgoJ25vbWUnLCAyKTtcbiAgICAgIGV4cGVjdChtZXNzYWdlKS50b0JlKFwiTyBjYW1wbyAnbm9tZScgZGV2ZSB0ZXIgcGVsbyBtZW5vcyAyIGNhcmFjdGVyZXNcIik7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBjcmlhciBtZW5zYWdlbSBhcGVuYXMgcGFyYSBtw6F4aW1vJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IFZhbGlkYXRpb25NZXNzYWdlSGVscGVyLmludmFsaWRMZW5ndGgoJ25vbWUnLCB1bmRlZmluZWQsIDUwKTtcbiAgICAgIGV4cGVjdChtZXNzYWdlKS50b0JlKFwiTyBjYW1wbyAnbm9tZScgZGV2ZSB0ZXIgbm8gbcOheGltbyA1MCBjYXJhY3RlcmVzXCIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgY3JpYXIgbWVuc2FnZW0gZ2Vuw6lyaWNhIHF1YW5kbyBuw6NvIGjDoSBsaW1pdGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IFZhbGlkYXRpb25NZXNzYWdlSGVscGVyLmludmFsaWRMZW5ndGgoJ25vbWUnKTtcbiAgICAgIGV4cGVjdChtZXNzYWdlKS50b0JlKFwiTyBjYW1wbyAnbm9tZScgdGVtIHRhbWFuaG8gaW52w6FsaWRvXCIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaW52YWxpZFJhbmdlJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGNyaWFyIG1lbnNhZ2VtIHBhcmEgaW50ZXJ2YWxvIGNvbSBtaW4gZSBtYXgnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXIuaW52YWxpZFJhbmdlKCdpZGFkZScsIDE4LCA2NSk7XG4gICAgICBleHBlY3QobWVzc2FnZSkudG9CZShcIk8gY2FtcG8gJ2lkYWRlJyBkZXZlIGVzdGFyIGVudHJlIDE4IGUgNjVcIik7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBjcmlhciBtZW5zYWdlbSBhcGVuYXMgcGFyYSBtw61uaW1vJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IFZhbGlkYXRpb25NZXNzYWdlSGVscGVyLmludmFsaWRSYW5nZSgnaWRhZGUnLCAxOCk7XG4gICAgICBleHBlY3QobWVzc2FnZSkudG9CZShcIk8gY2FtcG8gJ2lkYWRlJyBkZXZlIHNlciBtYWlvciBvdSBpZ3VhbCBhIDE4XCIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgY3JpYXIgbWVuc2FnZW0gYXBlbmFzIHBhcmEgbcOheGltbycsICgpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBWYWxpZGF0aW9uTWVzc2FnZUhlbHBlci5pbnZhbGlkUmFuZ2UoJ2lkYWRlJywgdW5kZWZpbmVkLCA2NSk7XG4gICAgICBleHBlY3QobWVzc2FnZSkudG9CZShcIk8gY2FtcG8gJ2lkYWRlJyBkZXZlIHNlciBtZW5vciBvdSBpZ3VhbCBhIDY1XCIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaW52YWxpZEZvcm1hdCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBjcmlhciBtZW5zYWdlbSBwYXJhIGZvcm1hdG8gaW52w6FsaWRvJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IFZhbGlkYXRpb25NZXNzYWdlSGVscGVyLmludmFsaWRGb3JtYXQoJ2VtYWlsJywgJ2VtYWlsJyk7XG4gICAgICBleHBlY3QobWVzc2FnZSkudG9CZShcIk8gY2FtcG8gJ2VtYWlsJyBkZXZlIHRlciBvIGZvcm1hdG86IGVtYWlsIHbDoWxpZG8gKGV4ZW1wbG86IHVzdWFyaW9AZG9taW5pby5jb20pXCIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbWFwZWFyIGZvcm1hdG9zIGNvbmhlY2lkb3MnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXIuaW52YWxpZEZvcm1hdCgnY3BmJywgJ2NwZicpKVxuICAgICAgICAudG9Db250YWluKCdDUEYgdsOhbGlkbyAoZXhlbXBsbzogMTIzLjQ1Ni43ODktMDApJyk7XG4gICAgICBleHBlY3QoVmFsaWRhdGlvbk1lc3NhZ2VIZWxwZXIuaW52YWxpZEZvcm1hdCgndGVsZWZvbmUnLCAncGhvbmUnKSlcbiAgICAgICAgLnRvQ29udGFpbigndGVsZWZvbmUgdsOhbGlkbyAoZXhlbXBsbzogKDExKSA5OTk5OS05OTk5KScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgdXNhciBmb3JtYXRvIG9yaWdpbmFsIHNlIG7Do28gbWFwZWFkbycsICgpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBWYWxpZGF0aW9uTWVzc2FnZUhlbHBlci5pbnZhbGlkRm9ybWF0KCdjYW1wbycsICdmb3JtYXRvX2N1c3RvbWl6YWRvJyk7XG4gICAgICBleHBlY3QobWVzc2FnZSkudG9CZShcIk8gY2FtcG8gJ2NhbXBvJyBkZXZlIHRlciBvIGZvcm1hdG86IGZvcm1hdG9fY3VzdG9taXphZG9cIik7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9