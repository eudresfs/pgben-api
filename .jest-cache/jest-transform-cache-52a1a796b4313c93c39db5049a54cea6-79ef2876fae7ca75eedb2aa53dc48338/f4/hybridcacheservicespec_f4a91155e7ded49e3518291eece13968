2347ac606254c09b5a0521f4c428ba67
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const config_1 = require("@nestjs/config");
const hybrid_cache_service_1 = require("./hybrid-cache.service");
const health_check_service_1 = require("./health-check.service");
const cache_service_1 = require("../cache/cache.service");
describe('HybridCacheService', () => {
    let service;
    let healthCheckService;
    let cacheService;
    let configService;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                hybrid_cache_service_1.HybridCacheService,
                {
                    provide: config_1.ConfigService,
                    useValue: {
                        get: jest.fn((key, defaultValue) => {
                            const config = {
                                CACHE_L1_MAX_SIZE: '100',
                                CACHE_DEFAULT_TTL: '60000',
                                CACHE_ENABLE_L2: 'true',
                                CACHE_ENABLE_WARMING: 'true',
                                CACHE_WARMING_INTERVAL: '30000',
                            };
                            return config[key] || defaultValue;
                        }),
                    },
                },
                {
                    provide: health_check_service_1.HealthCheckService,
                    useValue: {
                        isRedisAvailable: jest.fn(),
                    },
                },
                {
                    provide: cache_service_1.CacheService,
                    useValue: {
                        get: jest.fn(),
                        set: jest.fn(),
                        del: jest.fn(),
                        has: jest.fn(),
                    },
                },
            ],
        }).compile();
        service = module.get(hybrid_cache_service_1.HybridCacheService);
        healthCheckService = module.get(health_check_service_1.HealthCheckService);
        cacheService = module.get(cache_service_1.CacheService);
        configService = module.get(config_1.ConfigService);
        // Reset metrics before each test
        service.resetMetrics();
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('get', () => {
        it('deve retornar valor do cache L1 quando disponível', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            // Simular valor no L1
            await service.set(key, value, 60000, 'medium');
            // Act
            const result = await service.get(key);
            // Assert
            expect(result).toEqual(value);
        });
        it('deve buscar no cache L2 quando L1 miss e L2 disponível', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockResolvedValue(value);
            // Act
            const result = await service.get(key);
            // Assert
            expect(result).toEqual(value);
            expect(cacheService.get).toHaveBeenCalledWith(key);
        });
        it('deve retornar null quando não encontrado em nenhum cache', async () => {
            // Arrange
            const key = 'test-key';
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockResolvedValue(null);
            // Act
            const result = await service.get(key);
            // Assert
            expect(result).toBeNull();
        });
        it('deve funcionar apenas com L1 quando L2 indisponível', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(false);
            // Adicionar ao L1
            await service.set(key, value, 60000, 'medium');
            // Act
            const result = await service.get(key);
            // Assert
            expect(result).toEqual(value);
            expect(cacheService.get).not.toHaveBeenCalled();
        });
    });
    describe('set', () => {
        it('deve armazenar no cache L1', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            // Act
            await service.set(key, value, 60000, 'medium');
            // Assert
            const result = await service.get(key);
            expect(result).toEqual(value);
        });
        it('deve armazenar no cache L2 quando disponível', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.set.mockResolvedValue(undefined);
            // Act
            await service.set(key, value, 60000, 'medium');
            // Assert
            expect(cacheService.set).toHaveBeenCalledWith(key, value, 60000);
        });
        it('deve funcionar apenas com L1 quando L2 indisponível', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(false);
            // Act
            await service.set(key, value, 60000, 'medium');
            // Assert
            const result = await service.get(key);
            expect(result).toEqual(value);
            expect(cacheService.set).not.toHaveBeenCalled();
        });
    });
    describe('del', () => {
        it('deve remover do cache L1', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            await service.set(key, value, 60000, 'medium');
            // Act
            await service.del(key);
            // Assert
            const result = await service.get(key);
            expect(result).toBeNull();
        });
        it('deve remover do cache L2 quando disponível', async () => {
            // Arrange
            const key = 'test-key';
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.del.mockResolvedValue(undefined);
            // Act
            await service.del(key);
            // Assert
            expect(cacheService.del).toHaveBeenCalledWith(key);
        });
    });
    describe('has', () => {
        it('deve retornar true quando chave existe no L1', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            await service.set(key, value, 60000, 'medium');
            // Act
            const result = await service.has(key);
            // Assert
            expect(result).toBe(true);
        });
        it('deve verificar no L2 quando não existe no L1', async () => {
            // Arrange
            const key = 'test-key';
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.has.mockResolvedValue(true);
            // Act
            const result = await service.has(key);
            // Assert
            expect(result).toBe(true);
            expect(cacheService.has).toHaveBeenCalledWith(key);
        });
        it('deve retornar false quando não existe em nenhum cache', async () => {
            // Arrange
            const key = 'test-key';
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.has.mockResolvedValue(false);
            // Act
            const result = await service.has(key);
            // Assert
            expect(result).toBe(false);
        });
    });
    describe('getOrSet', () => {
        it('deve retornar valor existente do cache', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'cached-value' };
            const factory = jest.fn().mockResolvedValue({ data: 'new-value' });
            await service.set(key, value, 60000, 'medium');
            // Act
            const result = await service.getOrSet(key, factory, 60000, 'medium');
            // Assert
            expect(result).toEqual(value);
            expect(factory).not.toHaveBeenCalled();
        });
        it('deve executar factory e armazenar quando valor não existe', async () => {
            // Arrange
            const key = 'test-key';
            const newValue = { data: 'new-value' };
            const factory = jest.fn().mockResolvedValue(newValue);
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockResolvedValue(null);
            // Act
            const result = await service.getOrSet(key, factory, 60000, 'medium');
            // Assert
            expect(result).toEqual(newValue);
            expect(factory).toHaveBeenCalled();
        });
    });
    describe('eviction', () => {
        it('deve remover entradas expiradas durante limpeza', async () => {
            // Arrange
            const key1 = 'expired-key';
            const key2 = 'valid-key';
            const value1 = 'value1';
            const value2 = 'value2';
            // Simular entrada expirada
            await service.set(key1, value1, -1000, 'low'); // TTL negativo = expirado
            await service.set(key2, value2, 60000, 'medium');
            // Act
            await service['cleanupExpiredCache']();
            // Assert
            expect(await service.get(key1)).toBeNull();
            expect(await service.get(key2)).toBe(value2);
        });
    });
    describe('métricas', () => {
        it('deve calcular métricas corretamente', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockResolvedValue(null);
            // Simular algumas operações
            await service.get(key); // L1 miss, L2 miss
            await service.set(key, value, 60000, 'medium');
            await service.get(key); // L1 hit
            // Act
            const metrics = service.getMetrics();
            // Assert
            expect(metrics.l1Hits).toBe(1);
            expect(metrics.l1Misses).toBe(1);
            expect(metrics.l2Misses).toBe(1);
            expect(metrics.l1HitRate).toBe(50);
            expect(metrics.overallHitRate).toBeCloseTo(33.33, 2);
        });
        it('deve resetar métricas corretamente', () => {
            // Arrange - simular algumas operações
            service['metrics'] = {
                l1Hits: 10,
                l1Misses: 5,
                l2Hits: 3,
                l2Misses: 2,
                evictions: 1,
                warmingOperations: 2,
                failovers: 1,
            };
            // Act
            service.resetMetrics();
            // Assert
            const metrics = service.getMetrics();
            expect(metrics.l1Hits).toBe(0);
            expect(metrics.l1Misses).toBe(0);
            expect(metrics.l2Hits).toBe(0);
            expect(metrics.l2Misses).toBe(0);
            expect(metrics.evictions).toBe(0);
            expect(metrics.warmingOperations).toBe(0);
            expect(metrics.failovers).toBe(0);
        });
    });
    describe('clear', () => {
        it('deve limpar todos os caches', async () => {
            // Arrange
            const key1 = 'key1';
            const key2 = 'key2';
            const value1 = 'value1';
            const value2 = 'value2';
            await service.set(key1, value1, 60000, 'medium');
            await service.set(key2, value2, 60000, 'medium');
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            // Act
            await service.clear();
            // Assert
            expect(await service.get(key1)).toBeUndefined();
            expect(await service.get(key2)).toBeUndefined();
        });
    });
    describe('warming', () => {
        it('deve aquecer cache com chaves críticas', async () => {
            // Arrange
            const criticalKey = 'critical-key';
            const value = { data: 'critical-value' };
            // Marcar como crítica
            await service.set(criticalKey, value, 60000, 'critical');
            // Simular que não está no L1 mas está no L2
            service['l1Cache'].clear();
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockResolvedValue(value);
            // Act
            await service['performCacheWarming']();
            // Assert
            const result = await service.get(criticalKey);
            expect(result).toEqual(value);
        });
    });
    describe('error handling', () => {
        it('deve lidar com erros do L2 graciosamente', async () => {
            // Arrange
            const key = 'test-key';
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockRejectedValue(new Error('Redis error'));
            // Act & Assert
            const result = await service.get(key);
            expect(result).toBeNull();
            // Verificar se erro foi registrado nas métricas
            const metrics = service.getMetrics();
            expect(metrics.failovers).toBeGreaterThan(0);
        });
        it('deve continuar funcionando com L1 quando L2 falha', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.set.mockRejectedValue(new Error('Redis error'));
            // Act
            await service.set(key, value, 60000, 'medium');
            // Assert - deve funcionar com L1
            const result = await service.get(key);
            expect(result).toEqual(value);
        });
    });
    describe('priority handling', () => {
        it('deve tratar prioridades corretamente', async () => {
            // Arrange
            const criticalKey = 'critical-key';
            const lowKey = 'low-key';
            const value = { data: 'test' };
            const factory = async () => value;
            // Act
            service.registerCriticalKey(criticalKey, factory);
            await service.getOrSet(lowKey, factory, 60000, 'low');
            // Assert - chave crítica deve estar marcada
            expect(service['criticalKeys'].has(criticalKey)).toBe(true);
            expect(service['criticalKeys'].has(lowKey)).toBe(false);
        });
    });
    describe('concurrent operations', () => {
        it('deve lidar com operações concorrentes', async () => {
            // Arrange
            const key = 'concurrent-key';
            const factory = jest.fn().mockResolvedValue({ data: 'factory-value' });
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockResolvedValue(null);
            // Act - múltiplas chamadas simultâneas
            const promises = [
                service.getOrSet(key, factory, 60000, 'medium'),
                service.getOrSet(key, factory, 60000, 'medium'),
                service.getOrSet(key, factory, 60000, 'medium'),
            ];
            const results = await Promise.all(promises);
            // Assert - factory deve ser chamado apenas uma vez
            expect(factory).toHaveBeenCalledTimes(1);
            results.forEach((result) => {
                expect(result).toEqual({ data: 'factory-value' });
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXHNoYXJlZFxcc2VydmljZXNcXGh5YnJpZC1jYWNoZS5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsMkNBQStDO0FBRS9DLGlFQUE0RDtBQUM1RCxpRUFBNEQ7QUFDNUQsMERBQXNEO0FBRXRELFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7SUFDbEMsSUFBSSxPQUEyQixDQUFDO0lBQ2hDLElBQUksa0JBQW1ELENBQUM7SUFDeEQsSUFBSSxZQUF1QyxDQUFDO0lBQzVDLElBQUksYUFBeUMsQ0FBQztJQUU5QyxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFNBQVMsRUFBRTtnQkFDVCx5Q0FBa0I7Z0JBQ2xCO29CQUNFLE9BQU8sRUFBRSxzQkFBYTtvQkFDdEIsUUFBUSxFQUFFO3dCQUNSLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBVyxFQUFFLFlBQWtCLEVBQUUsRUFBRTs0QkFDL0MsTUFBTSxNQUFNLEdBQUc7Z0NBQ2IsaUJBQWlCLEVBQUUsS0FBSztnQ0FDeEIsaUJBQWlCLEVBQUUsT0FBTztnQ0FDMUIsZUFBZSxFQUFFLE1BQU07Z0NBQ3ZCLG9CQUFvQixFQUFFLE1BQU07Z0NBQzVCLHNCQUFzQixFQUFFLE9BQU87NkJBQ2hDLENBQUM7NEJBQ0YsT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksWUFBWSxDQUFDO3dCQUNyQyxDQUFDLENBQUM7cUJBQ0g7aUJBQ0Y7Z0JBQ0Q7b0JBQ0UsT0FBTyxFQUFFLHlDQUFrQjtvQkFDM0IsUUFBUSxFQUFFO3dCQUNSLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7cUJBQzVCO2lCQUNGO2dCQUNEO29CQUNFLE9BQU8sRUFB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QUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXpDLHVDQUF1QztZQUN2QyxNQUFNLFFBQVEsR0FBRztnQkFDZixPQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQztnQkFDL0MsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLENBQUM7Z0JBQy9DLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDO2FBQ2hELENBQUM7WUFFRixNQUFNLE9BQU8sR0FBRyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFNUMsbURBQW1EO1lBQ25ELE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6QyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUU7Z0JBQ3pCLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLENBQUMsQ0FBQztZQUNwRCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcc2hhcmVkXFxzZXJ2aWNlc1xcaHlicmlkLWNhY2hlLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZyc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBIeWJyaWRDYWNoZVNlcnZpY2UgfSBmcm9tICcuL2h5YnJpZC1jYWNoZS5zZXJ2aWNlJztcbmltcG9ydCB7IEhlYWx0aENoZWNrU2VydmljZSB9IGZyb20gJy4vaGVhbHRoLWNoZWNrLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ2FjaGVTZXJ2aWNlIH0gZnJvbSAnLi4vY2FjaGUvY2FjaGUuc2VydmljZSc7XG5cbmRlc2NyaWJlKCdIeWJyaWRDYWNoZVNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBzZXJ2aWNlOiBIeWJyaWRDYWNoZVNlcnZpY2U7XG4gIGxldCBoZWFsdGhDaGVja1NlcnZpY2U6IGplc3QuTW9ja2VkPEhlYWx0aENoZWNrU2VydmljZT47XG4gIGxldCBjYWNoZVNlcnZpY2U6IGplc3QuTW9ja2VkPENhY2hlU2VydmljZT47XG4gIGxldCBjb25maWdTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxDb25maWdTZXJ2aWNlPjtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIEh5YnJpZENhY2hlU2VydmljZSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IENvbmZpZ1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIGdldDogamVzdC5mbigoa2V5OiBzdHJpbmcsIGRlZmF1bHRWYWx1ZT86IGFueSkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgICAgICAgICAgQ0FDSEVfTDFfTUFYX1NJWkU6ICcxMDAnLFxuICAgICAgICAgICAgICAgIENBQ0hFX0RFRkFVTFRfVFRMOiAnNjAwMDAnLFxuICAgICAgICAgICAgICAgIENBQ0hFX0VOQUJMRV9MMjogJ3RydWUnLFxuICAgICAgICAgICAgICAgIENBQ0hFX0VOQUJMRV9XQVJNSU5HOiAndHJ1ZScsXG4gICAgICAgICAgICAgICAgQ0FDSEVfV0FSTUlOR19JTlRFUlZBTDogJzMwMDAwJyxcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ1trZXldIHx8IGRlZmF1bHRWYWx1ZTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBIZWFsdGhDaGVja1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIGlzUmVkaXNBdmFpbGFibGU6IGplc3QuZm4oKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQ2FjaGVTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICBnZXQ6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIHNldDogamVzdC5mbigpLFxuICAgICAgICAgICAgZGVsOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBoYXM6IGplc3QuZm4oKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldDxIeWJyaWRDYWNoZVNlcnZpY2U+KEh5YnJpZENhY2hlU2VydmljZSk7XG4gICAgaGVhbHRoQ2hlY2tTZXJ2aWNlID0gbW9kdWxlLmdldChIZWFsdGhDaGVja1NlcnZpY2UpO1xuICAgIGNhY2hlU2VydmljZSA9IG1vZHVsZS5nZXQoQ2FjaGVTZXJ2aWNlKTtcbiAgICBjb25maWdTZXJ2aWNlID0gbW9kdWxlLmdldChDb25maWdTZXJ2aWNlKTtcblxuICAgIC8vIFJlc2V0IG1ldHJpY3MgYmVmb3JlIGVhY2ggdGVzdFxuICAgIHNlcnZpY2UucmVzZXRNZXRyaWNzKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXQnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgdmFsb3IgZG8gY2FjaGUgTDEgcXVhbmRvIGRpc3BvbsOtdmVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIGNvbnN0IHZhbHVlID0geyBkYXRhOiAndGVzdC12YWx1ZScgfTtcblxuICAgICAgLy8gU2ltdWxhciB2YWxvciBubyBMMVxuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5LCB2YWx1ZSwgNjAwMDAsICdtZWRpdW0nKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldChrZXkpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodmFsdWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgYnVzY2FyIG5vIGNhY2hlIEwyIHF1YW5kbyBMMSBtaXNzIGUgTDIgZGlzcG9uw612ZWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBrZXkgPSAndGVzdC1rZXknO1xuICAgICAgY29uc3QgdmFsdWUgPSB7IGRhdGE6ICd0ZXN0LXZhbHVlJyB9O1xuXG4gICAgICBoZWFsdGhDaGVja1NlcnZpY2UuaXNSZWRpc0F2YWlsYWJsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUodmFsdWUpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0KGtleSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh2YWx1ZSk7XG4gICAgICBleHBlY3QoY2FjaGVTZXJ2aWNlLmdldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoa2V5KTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIG51bGwgcXVhbmRvIG7Do28gZW5jb250cmFkbyBlbSBuZW5odW0gY2FjaGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBrZXkgPSAndGVzdC1rZXknO1xuXG4gICAgICBoZWFsdGhDaGVja1NlcnZpY2UuaXNSZWRpc0F2YWlsYWJsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXQoa2V5KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZnVuY2lvbmFyIGFwZW5hcyBjb20gTDEgcXVhbmRvIEwyIGluZGlzcG9uw612ZWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBrZXkgPSAndGVzdC1rZXknO1xuICAgICAgY29uc3QgdmFsdWUgPSB7IGRhdGE6ICd0ZXN0LXZhbHVlJyB9O1xuXG4gICAgICBoZWFsdGhDaGVja1NlcnZpY2UuaXNSZWRpc0F2YWlsYWJsZS5tb2NrUmVzb2x2ZWRWYWx1ZShmYWxzZSk7XG5cbiAgICAgIC8vIEFkaWNpb25hciBhbyBMMVxuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5LCB2YWx1ZSwgNjAwMDAsICdtZWRpdW0nKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldChrZXkpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodmFsdWUpO1xuICAgICAgZXhwZWN0KGNhY2hlU2VydmljZS5nZXQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzZXQnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgYXJtYXplbmFyIG5vIGNhY2hlIEwxJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIGNvbnN0IHZhbHVlID0geyBkYXRhOiAndGVzdC12YWx1ZScgfTtcblxuICAgICAgaGVhbHRoQ2hlY2tTZXJ2aWNlLmlzUmVkaXNBdmFpbGFibGUubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5LCB2YWx1ZSwgNjAwMDAsICdtZWRpdW0nKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldChrZXkpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh2YWx1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBhcm1hemVuYXIgbm8gY2FjaGUgTDIgcXVhbmRvIGRpc3BvbsOtdmVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIGNvbnN0IHZhbHVlID0geyBkYXRhOiAndGVzdC12YWx1ZScgfTtcblxuICAgICAgaGVhbHRoQ2hlY2tTZXJ2aWNlLmlzUmVkaXNBdmFpbGFibGUubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgICBjYWNoZVNlcnZpY2Uuc2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5LCB2YWx1ZSwgNjAwMDAsICdtZWRpdW0nKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoY2FjaGVTZXJ2aWNlLnNldCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoa2V5LCB2YWx1ZSwgNjAwMDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZnVuY2lvbmFyIGFwZW5hcyBjb20gTDEgcXVhbmRvIEwyIGluZGlzcG9uw612ZWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBrZXkgPSAndGVzdC1rZXknO1xuICAgICAgY29uc3QgdmFsdWUgPSB7IGRhdGE6ICd0ZXN0LXZhbHVlJyB9O1xuXG4gICAgICBoZWFsdGhDaGVja1NlcnZpY2UuaXNSZWRpc0F2YWlsYWJsZS5tb2NrUmVzb2x2ZWRWYWx1ZShmYWxzZSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5LCB2YWx1ZSwgNjAwMDAsICdtZWRpdW0nKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldChrZXkpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh2YWx1ZSk7XG4gICAgICBleHBlY3QoY2FjaGVTZXJ2aWNlLnNldCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2RlbCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSByZW1vdmVyIGRvIGNhY2hlIEwxJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIGNvbnN0IHZhbHVlID0geyBkYXRhOiAndGVzdC12YWx1ZScgfTtcblxuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5LCB2YWx1ZSwgNjAwMDAsICdtZWRpdW0nKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBhd2FpdCBzZXJ2aWNlLmRlbChrZXkpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0KGtleSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVtb3ZlciBkbyBjYWNoZSBMMiBxdWFuZG8gZGlzcG9uw612ZWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBrZXkgPSAndGVzdC1rZXknO1xuXG4gICAgICBoZWFsdGhDaGVja1NlcnZpY2UuaXNSZWRpc0F2YWlsYWJsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIGNhY2hlU2VydmljZS5kZWwubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBhd2FpdCBzZXJ2aWNlLmRlbChrZXkpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChjYWNoZVNlcnZpY2UuZGVsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChrZXkpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaGFzJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIHRydWUgcXVhbmRvIGNoYXZlIGV4aXN0ZSBubyBMMScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0LWtleSc7XG4gICAgICBjb25zdCB2YWx1ZSA9IHsgZGF0YTogJ3Rlc3QtdmFsdWUnIH07XG5cbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2V0KGtleSwgdmFsdWUsIDYwMDAwLCAnbWVkaXVtJyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5oYXMoa2V5KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgdmVyaWZpY2FyIG5vIEwyIHF1YW5kbyBuw6NvIGV4aXN0ZSBubyBMMScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0LWtleSc7XG5cbiAgICAgIGhlYWx0aENoZWNrU2VydmljZS5pc1JlZGlzQXZhaWxhYmxlLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgICAgY2FjaGVTZXJ2aWNlLmhhcy5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmhhcyhrZXkpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY2FjaGVTZXJ2aWNlLmhhcykudG9IYXZlQmVlbkNhbGxlZFdpdGgoa2V5KTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIGZhbHNlIHF1YW5kbyBuw6NvIGV4aXN0ZSBlbSBuZW5odW0gY2FjaGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBrZXkgPSAndGVzdC1rZXknO1xuXG4gICAgICBoZWFsdGhDaGVja1NlcnZpY2UuaXNSZWRpc0F2YWlsYWJsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIGNhY2hlU2VydmljZS5oYXMubW9ja1Jlc29sdmVkVmFsdWUoZmFsc2UpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuaGFzKGtleSk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRPclNldCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSByZXRvcm5hciB2YWxvciBleGlzdGVudGUgZG8gY2FjaGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBrZXkgPSAndGVzdC1rZXknO1xuICAgICAgY29uc3QgdmFsdWUgPSB7IGRhdGE6ICdjYWNoZWQtdmFsdWUnIH07XG4gICAgICBjb25zdCBmYWN0b3J5ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogJ25ldy12YWx1ZScgfSk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2V0KGtleSwgdmFsdWUsIDYwMDAwLCAnbWVkaXVtJyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRPclNldChrZXksIGZhY3RvcnksIDYwMDAwLCAnbWVkaXVtJyk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh2YWx1ZSk7XG4gICAgICBleHBlY3QoZmFjdG9yeSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGV4ZWN1dGFyIGZhY3RvcnkgZSBhcm1hemVuYXIgcXVhbmRvIHZhbG9yIG7Do28gZXhpc3RlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIGNvbnN0IG5ld1ZhbHVlID0geyBkYXRhOiAnbmV3LXZhbHVlJyB9O1xuICAgICAgY29uc3QgZmFjdG9yeSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShuZXdWYWx1ZSk7XG5cbiAgICAgIGhlYWx0aENoZWNrU2VydmljZS5pc1JlZGlzQXZhaWxhYmxlLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldE9yU2V0KGtleSwgZmFjdG9yeSwgNjAwMDAsICdtZWRpdW0nKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG5ld1ZhbHVlKTtcbiAgICAgIGV4cGVjdChmYWN0b3J5KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdldmljdGlvbicsICgpID0+IHtcbiAgICBpdCgnZGV2ZSByZW1vdmVyIGVudHJhZGFzIGV4cGlyYWRhcyBkdXJhbnRlIGxpbXBlemEnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBrZXkxID0gJ2V4cGlyZWQta2V5JztcbiAgICAgIGNvbnN0IGtleTIgPSAndmFsaWQta2V5JztcbiAgICAgIGNvbnN0IHZhbHVlMSA9ICd2YWx1ZTEnO1xuICAgICAgY29uc3QgdmFsdWUyID0gJ3ZhbHVlMic7XG5cbiAgICAgIC8vIFNpbXVsYXIgZW50cmFkYSBleHBpcmFkYVxuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5MSwgdmFsdWUxLCAtMTAwMCwgJ2xvdycpOyAvLyBUVEwgbmVnYXRpdm8gPSBleHBpcmFkb1xuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5MiwgdmFsdWUyLCA2MDAwMCwgJ21lZGl1bScpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IHNlcnZpY2VbJ2NsZWFudXBFeHBpcmVkQ2FjaGUnXSgpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChhd2FpdCBzZXJ2aWNlLmdldChrZXkxKSkudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChhd2FpdCBzZXJ2aWNlLmdldChrZXkyKSkudG9CZSh2YWx1ZTIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbcOpdHJpY2FzJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGNhbGN1bGFyIG3DqXRyaWNhcyBjb3JyZXRhbWVudGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBrZXkgPSAndGVzdC1rZXknO1xuICAgICAgY29uc3QgdmFsdWUgPSB7IGRhdGE6ICd0ZXN0LXZhbHVlJyB9O1xuXG4gICAgICBoZWFsdGhDaGVja1NlcnZpY2UuaXNSZWRpc0F2YWlsYWJsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIC8vIFNpbXVsYXIgYWxndW1hcyBvcGVyYcOnw7Vlc1xuICAgICAgYXdhaXQgc2VydmljZS5nZXQoa2V5KTsgLy8gTDEgbWlzcywgTDIgbWlzc1xuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5LCB2YWx1ZSwgNjAwMDAsICdtZWRpdW0nKTtcbiAgICAgIGF3YWl0IHNlcnZpY2UuZ2V0KGtleSk7IC8vIEwxIGhpdFxuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IG1ldHJpY3MgPSBzZXJ2aWNlLmdldE1ldHJpY3MoKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobWV0cmljcy5sMUhpdHMpLnRvQmUoMSk7XG4gICAgICBleHBlY3QobWV0cmljcy5sMU1pc3NlcykudG9CZSgxKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLmwyTWlzc2VzKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KG1ldHJpY3MubDFIaXRSYXRlKS50b0JlKDUwKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLm92ZXJhbGxIaXRSYXRlKS50b0JlQ2xvc2VUbygzMy4zMywgMik7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXNldGFyIG3DqXRyaWNhcyBjb3JyZXRhbWVudGUnLCAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlIC0gc2ltdWxhciBhbGd1bWFzIG9wZXJhw6fDtWVzXG4gICAgICBzZXJ2aWNlWydtZXRyaWNzJ10gPSB7XG4gICAgICAgIGwxSGl0czogMTAsXG4gICAgICAgIGwxTWlzc2VzOiA1LFxuICAgICAgICBsMkhpdHM6IDMsXG4gICAgICAgIGwyTWlzc2VzOiAyLFxuICAgICAgICBldmljdGlvbnM6IDEsXG4gICAgICAgIHdhcm1pbmdPcGVyYXRpb25zOiAyLFxuICAgICAgICBmYWlsb3ZlcnM6IDEsXG4gICAgICB9O1xuXG4gICAgICAvLyBBY3RcbiAgICAgIHNlcnZpY2UucmVzZXRNZXRyaWNzKCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgY29uc3QgbWV0cmljcyA9IHNlcnZpY2UuZ2V0TWV0cmljcygpO1xuICAgICAgZXhwZWN0KG1ldHJpY3MubDFIaXRzKS50b0JlKDApO1xuICAgICAgZXhwZWN0KG1ldHJpY3MubDFNaXNzZXMpLnRvQmUoMCk7XG4gICAgICBleHBlY3QobWV0cmljcy5sMkhpdHMpLnRvQmUoMCk7XG4gICAgICBleHBlY3QobWV0cmljcy5sMk1pc3NlcykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLmV2aWN0aW9ucykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLndhcm1pbmdPcGVyYXRpb25zKS50b0JlKDApO1xuICAgICAgZXhwZWN0KG1ldHJpY3MuZmFpbG92ZXJzKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2xlYXInLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgbGltcGFyIHRvZG9zIG9zIGNhY2hlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGtleTEgPSAna2V5MSc7XG4gICAgICBjb25zdCBrZXkyID0gJ2tleTInO1xuICAgICAgY29uc3QgdmFsdWUxID0gJ3ZhbHVlMSc7XG4gICAgICBjb25zdCB2YWx1ZTIgPSAndmFsdWUyJztcblxuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5MSwgdmFsdWUxLCA2MDAwMCwgJ21lZGl1bScpO1xuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5MiwgdmFsdWUyLCA2MDAwMCwgJ21lZGl1bScpO1xuXG4gICAgICBoZWFsdGhDaGVja1NlcnZpY2UuaXNSZWRpc0F2YWlsYWJsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBhd2FpdCBzZXJ2aWNlLmNsZWFyKCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGF3YWl0IHNlcnZpY2UuZ2V0KGtleTEpKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICBleHBlY3QoYXdhaXQgc2VydmljZS5nZXQoa2V5MikpLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3dhcm1pbmcnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgYXF1ZWNlciBjYWNoZSBjb20gY2hhdmVzIGNyw610aWNhcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGNyaXRpY2FsS2V5ID0gJ2NyaXRpY2FsLWtleSc7XG4gICAgICBjb25zdCB2YWx1ZSA9IHsgZGF0YTogJ2NyaXRpY2FsLXZhbHVlJyB9O1xuXG4gICAgICAvLyBNYXJjYXIgY29tbyBjcsOtdGljYVxuICAgICAgYXdhaXQgc2VydmljZS5zZXQoY3JpdGljYWxLZXksIHZhbHVlLCA2MDAwMCwgJ2NyaXRpY2FsJyk7XG5cbiAgICAgIC8vIFNpbXVsYXIgcXVlIG7Do28gZXN0w6Egbm8gTDEgbWFzIGVzdMOhIG5vIEwyXG4gICAgICBzZXJ2aWNlWydsMUNhY2hlJ10uY2xlYXIoKTtcbiAgICAgIGhlYWx0aENoZWNrU2VydmljZS5pc1JlZGlzQXZhaWxhYmxlLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh2YWx1ZSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgc2VydmljZVsncGVyZm9ybUNhY2hlV2FybWluZyddKCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXQoY3JpdGljYWxLZXkpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh2YWx1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdlcnJvciBoYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBsaWRhciBjb20gZXJyb3MgZG8gTDIgZ3JhY2lvc2FtZW50ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0LWtleSc7XG5cbiAgICAgIGhlYWx0aENoZWNrU2VydmljZS5pc1JlZGlzQXZhaWxhYmxlLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1JlZGlzIGVycm9yJykpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0KGtleSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuXG4gICAgICAvLyBWZXJpZmljYXIgc2UgZXJybyBmb2kgcmVnaXN0cmFkbyBuYXMgbcOpdHJpY2FzXG4gICAgICBjb25zdCBtZXRyaWNzID0gc2VydmljZS5nZXRNZXRyaWNzKCk7XG4gICAgICBleHBlY3QobWV0cmljcy5mYWlsb3ZlcnMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGNvbnRpbnVhciBmdW5jaW9uYW5kbyBjb20gTDEgcXVhbmRvIEwyIGZhbGhhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIGNvbnN0IHZhbHVlID0geyBkYXRhOiAndGVzdC12YWx1ZScgfTtcblxuICAgICAgaGVhbHRoQ2hlY2tTZXJ2aWNlLmlzUmVkaXNBdmFpbGFibGUubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgICBjYWNoZVNlcnZpY2Uuc2V0Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignUmVkaXMgZXJyb3InKSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5LCB2YWx1ZSwgNjAwMDAsICdtZWRpdW0nKTtcblxuICAgICAgLy8gQXNzZXJ0IC0gZGV2ZSBmdW5jaW9uYXIgY29tIEwxXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldChrZXkpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh2YWx1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwcmlvcml0eSBoYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSB0cmF0YXIgcHJpb3JpZGFkZXMgY29ycmV0YW1lbnRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgY3JpdGljYWxLZXkgPSAnY3JpdGljYWwta2V5JztcbiAgICAgIGNvbnN0IGxvd0tleSA9ICdsb3cta2V5JztcbiAgICAgIGNvbnN0IHZhbHVlID0geyBkYXRhOiAndGVzdCcgfTtcbiAgICAgIGNvbnN0IGZhY3RvcnkgPSBhc3luYyAoKSA9PiB2YWx1ZTtcblxuICAgICAgLy8gQWN0XG4gICAgICBzZXJ2aWNlLnJlZ2lzdGVyQ3JpdGljYWxLZXkoY3JpdGljYWxLZXksIGZhY3RvcnkpO1xuICAgICAgYXdhaXQgc2VydmljZS5nZXRPclNldChsb3dLZXksIGZhY3RvcnksIDYwMDAwLCAnbG93Jyk7XG5cbiAgICAgIC8vIEFzc2VydCAtIGNoYXZlIGNyw610aWNhIGRldmUgZXN0YXIgbWFyY2FkYVxuICAgICAgZXhwZWN0KHNlcnZpY2VbJ2NyaXRpY2FsS2V5cyddLmhhcyhjcml0aWNhbEtleSkpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3Qoc2VydmljZVsnY3JpdGljYWxLZXlzJ10uaGFzKGxvd0tleSkpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29uY3VycmVudCBvcGVyYXRpb25zJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGxpZGFyIGNvbSBvcGVyYcOnw7VlcyBjb25jb3JyZW50ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBrZXkgPSAnY29uY3VycmVudC1rZXknO1xuICAgICAgY29uc3QgZmFjdG9yeSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6ICdmYWN0b3J5LXZhbHVlJyB9KTtcblxuICAgICAgaGVhbHRoQ2hlY2tTZXJ2aWNlLmlzUmVkaXNBdmFpbGFibGUubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICAvLyBBY3QgLSBtw7psdGlwbGFzIGNoYW1hZGFzIHNpbXVsdMOibmVhc1xuICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXG4gICAgICAgIHNlcnZpY2UuZ2V0T3JTZXQoa2V5LCBmYWN0b3J5LCA2MDAwMCwgJ21lZGl1bScpLFxuICAgICAgICBzZXJ2aWNlLmdldE9yU2V0KGtleSwgZmFjdG9yeSwgNjAwMDAsICdtZWRpdW0nKSxcbiAgICAgICAgc2VydmljZS5nZXRPclNldChrZXksIGZhY3RvcnksIDYwMDAwLCAnbWVkaXVtJyksXG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuXG4gICAgICAvLyBBc3NlcnQgLSBmYWN0b3J5IGRldmUgc2VyIGNoYW1hZG8gYXBlbmFzIHVtYSB2ZXpcbiAgICAgIGV4cGVjdChmYWN0b3J5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICByZXN1bHRzLmZvckVhY2goKHJlc3VsdCkgPT4ge1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHsgZGF0YTogJ2ZhY3RvcnktdmFsdWUnIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=