f11a2df054f78404b8e6667265cf7d92
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const typeorm_1 = require("@nestjs/typeorm");
const pagamento_service_1 = require("../../services/pagamento.service");
const entities_1 = require("../../entities");
const status_pagamento_enum_1 = require("../../enums/status-pagamento.enum");
const metodo_pagamento_enum_1 = require("../../enums/metodo-pagamento.enum");
const status_transition_validator_1 = require("../../validators/status-transition-validator");
const pix_validator_1 = require("../../validators/pix-validator");
const common_1 = require("@nestjs/common");
/**
 * Testes unitários para o serviço de pagamento
 *
 * Verifica o funcionamento correto das operações de criação, consulta,
 * atualização e gerenciamento de status de pagamentos.
 *
 * @author Equipe PGBen
 */
describe('PagamentoService', () => {
    let service;
    let pagamentoRepository;
    let statusValidator;
    let pixValidator;
    // Mock do repositório
    const mockPagamentoRepository = {
        create: jest.fn(),
        save: jest.fn(),
        findOne: jest.fn(),
        find: jest.fn(),
        findAndCount: jest.fn(),
        update: jest.fn(),
    };
    // Mock do validador de status
    const mockStatusValidator = {
        validarTransicao: jest.fn(),
        getProximosStatusPossiveis: jest.fn(),
        getStatusInicial: jest.fn().mockReturnValue(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO),
        isStatusFinal: jest.fn(),
    };
    // Mock do validador de PIX
    const mockPixValidator = {
        validarChavePix: jest.fn(),
        mascaraChavePix: jest.fn(),
        obterTipoChavePix: jest.fn(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                pagamento_service_1.PagamentoService,
                {
                    provide: (0, typeorm_1.getRepositoryToken)(entities_1.Pagamento),
                    useValue: mockPagamentoRepository,
                },
                {
                    provide: status_transition_validator_1.StatusTransitionValidator,
                    useValue: mockStatusValidator,
                },
                {
                    provide: pix_validator_1.PixValidator,
                    useValue: mockPixValidator,
                },
            ],
        }).compile();
        service = module.get(pagamento_service_1.PagamentoService);
        pagamentoRepository = module.get((0, typeorm_1.getRepositoryToken)(entities_1.Pagamento));
        statusValidator = module.get(status_transition_validator_1.StatusTransitionValidator);
        pixValidator = module.get(pix_validator_1.PixValidator);
        // Limpar mocks antes de cada teste
        jest.clearAllMocks();
    });
    describe('createPagamento', () => {
        const createDto = {
            valor: 500.0,
            dataLiberacao: new Date(),
            metodoPagamento: metodo_pagamento_enum_1.MetodoPagamentoEnum.PIX,
            infoBancariaId: 'info-bancaria-id',
            dadosBancarios: {
                pixTipo: 'cpf',
                pixChave: '12345678909',
            },
            observacoes: 'Pagamento de benefício',
        };
        const usuarioId = 'usuario-id';
        const solicitacaoId = 'solicitacao-id';
        it('deve criar um novo pagamento com sucesso', async () => {
            // Configurar mocks
            mockPixValidator.validarChavePix.mockReturnValue(true);
            mockPixValidator.mascaraChavePix.mockReturnValue('***.456.789-**');
            const pagamentoMock = {
                id: 'pagamento-id',
                solicitacaoId,
                ...createDto,
                status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
                responsavelLiberacao: usuarioId,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            mockPagamentoRepository.create.mockReturnValue(pagamentoMock);
            mockPagamentoRepository.save.mockResolvedValue(pagamentoMock);
            // Executar método
            const result = await service.createPagamento(solicitacaoId, createDto, usuarioId);
            // Verificar resultado
            expect(result).toEqual(pagamentoMock);
            expect(mockPagamentoRepository.create).toHaveBeenCalledWith({
                solicitacaoId,
                ...createDto,
                status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
                responsavelLiberacao: usuarioId,
            });
            expect(mockPagamentoRepository.save).toHaveBeenCalledWith(pagamentoMock);
            expect(mockPixValidator.validarChavePix).toHaveBeenCalledWith(createDto.dadosBancarios.pixChave, createDto.dadosBancarios.pixTipo);
        });
        it('deve rejeitar pagamento com chave PIX inválida', async () => {
            // Configurar mocks
            mockPixValidator.validarChavePix.mockReturnValue(false);
            // Executar e verificar exceção
            await expect(service.createPagamento(solicitacaoId, createDto, usuarioId)).rejects.toThrow('Chave PIX inválida');
            expect(mockPagamentoRepository.create).not.toHaveBeenCalled();
            expect(mockPagamentoRepository.save).not.toHaveBeenCalled();
        });
    });
    describe('findOne', () => {
        it('deve retornar um pagamento quando encontrado', async () => {
            const pagamentoMock = {
                id: 'pagamento-id',
                solicitacaoId: 'solicitacao-id',
                status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
            };
            mockPagamentoRepository.findOne.mockResolvedValue(pagamentoMock);
            const result = await service.findOne('pagamento-id');
            expect(result).toEqual(pagamentoMock);
            expect(mockPagamentoRepository.findOne).toHaveBeenCalledWith({
                where: { id: 'pagamento-id' },
            });
        });
        it('deve retornar null quando pagamento não for encontrado', async () => {
            mockPagamentoRepository.findOne.mockResolvedValue(null);
            const result = await service.findOne('pagamento-inexistente');
            expect(result).toBeNull();
        });
    });
    describe('findAll', () => {
        it('deve retornar lista paginada de pagamentos', async () => {
            const pagamentosMock = [
                { id: 'pagamento-1', status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO },
                { id: 'pagamento-2', status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO },
            ];
            mockPagamentoRepository.findAndCount.mockResolvedValue([
                pagamentosMock,
                2,
            ]);
            const result = await service.findAll({ page: 1, limit: 10 });
            expect(result).toEqual({
                items: pagamentosMock,
                total: 2,
                page: 1,
                limit: 10,
            });
        });
        it('deve aplicar filtros corretamente', async () => {
            mockPagamentoRepository.findAndCount.mockResolvedValue([[], 0]);
            await service.findAll({
                status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
                unidadeId: 'unidade-id',
                metodoPagamento: metodo_pagamento_enum_1.MetodoPagamentoEnum.PIX,
                page: 1,
                limit: 10,
            });
            // Verificar se o filtro foi aplicado na query
            expect(mockPagamentoRepository.findAndCount).toHaveBeenCalledWith(expect.objectContaining({
                where: expect.objectContaining({
                    status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
                    metodoPagamento: metodo_pagamento_enum_1.MetodoPagamentoEnum.PIX,
                }),
            }));
        });
    });
    describe('atualizarStatus', () => {
        const pagamentoId = 'pagamento-id';
        const usuarioId = 'usuario-id';
        it('deve atualizar status com sucesso quando transição é válida', async () => {
            // Configurar mocks
            const pagamentoMock = {
                id: pagamentoId,
                status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
            };
            mockPagamentoRepository.findOne.mockResolvedValue(pagamentoMock);
            mockStatusValidator.validarTransicao.mockReturnValue(true);
            mockPagamentoRepository.save.mockResolvedValue({
                ...pagamentoMock,
                status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
            });
            // Executar método
            const result = await service.atualizarStatus(pagamentoId, status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO, usuarioId);
            // Verificar resultado
            expect(result.status).toBe(status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO);
            expect(mockStatusValidator.validarTransicao).toHaveBeenCalledWith(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO, status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO);
        });
        it('deve rejeitar atualização quando pagamento não existe', async () => {
            mockPagamentoRepository.findOne.mockResolvedValue(null);
            await expect(service.atualizarStatus(pagamentoId, status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO, usuarioId)).rejects.toThrow(common_1.NotFoundException);
        });
        it('deve rejeitar atualização quando transição é inválida', async () => {
            // Configurar mocks
            const pagamentoMock = {
                id: pagamentoId,
                status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
            };
            mockPagamentoRepository.findOne.mockResolvedValue(pagamentoMock);
            mockStatusValidator.validarTransicao.mockReturnValue(false);
            // Executar e verificar exceção
            await expect(service.atualizarStatus(pagamentoId, status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO, usuarioId)).rejects.toThrow(common_1.ConflictException);
            expect(mockPagamentoRepository.save).not.toHaveBeenCalled();
        });
    });
    describe('cancelarPagamento', () => {
        const pagamentoId = 'pagamento-id';
        const usuarioId = 'usuario-id';
        const motivoCancelamento = 'Motivo de cancelamento';
        it('deve cancelar pagamento com sucesso quando status permite', async () => {
            // Configurar mocks
            const pagamentoMock = {
                id: pagamentoId,
                status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
                solicitacaoId: 'solicitacao-id',
            };
            mockPagamentoRepository.findOne.mockResolvedValue(pagamentoMock);
            mockStatusValidator.validarTransicao.mockReturnValue(true);
            mockPagamentoRepository.save.mockResolvedValue({
                ...pagamentoMock,
                status: status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO,
                observacoes: `CANCELADO: ${motivoCancelamento}`,
            });
            // Executar método
            const result = await service.cancelarPagamento(pagamentoId, usuarioId, motivoCancelamento);
            // Verificar resultado
            expect(result.status).toBe(status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO);
            expect(result.observacoes).toContain(motivoCancelamento);
        });
        it('deve rejeitar cancelamento quando pagamento não existe', async () => {
            mockPagamentoRepository.findOne.mockResolvedValue(null);
            await expect(service.cancelarPagamento(pagamentoId, usuarioId, motivoCancelamento)).rejects.toThrow(common_1.NotFoundException);
        });
        it('deve rejeitar cancelamento quando transição é inválida', async () => {
            // Configurar mocks
            const pagamentoMock = {
                id: pagamentoId,
                status: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO,
            };
            mockPagamentoRepository.findOne.mockResolvedValue(pagamentoMock);
            mockStatusValidator.validarTransicao.mockReturnValue(false);
            // Executar e verificar exceção
            await expect(service.cancelarPagamento(pagamentoId, usuarioId, motivoCancelamento)).rejects.toThrow(common_1.ConflictException);
        });
    });
    describe('findPendentes', () => {
        it('deve retornar pagamentos com status LIBERADO', async () => {
            const pagamentosMock = [
                { id: 'pagamento-1', status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO },
            ];
            mockPagamentoRepository.findAndCount.mockResolvedValue([
                pagamentosMock,
                1,
            ]);
            const result = await service.findPendentes({ page: 1, limit: 10 });
            expect(result.items).toEqual(pagamentosMock);
            expect(mockPagamentoRepository.findAndCount).toHaveBeenCalledWith(expect.objectContaining({
                where: expect.objectContaining({
                    status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
                }),
            }));
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcdGVzdHNcXHNlcnZpY2VzXFxwYWdhbWVudG8uc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELDZDQUFxRDtBQUVyRCx3RUFBb0U7QUFDcEUsNkNBQTJDO0FBQzNDLDZFQUF3RTtBQUN4RSw2RUFBd0U7QUFDeEUsOEZBQXlGO0FBQ3pGLGtFQUE4RDtBQUM5RCwyQ0FBc0U7QUFFdEU7Ozs7Ozs7R0FPRztBQUNILFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7SUFDaEMsSUFBSSxPQUF5QixDQUFDO0lBQzlCLElBQUksbUJBQTBDLENBQUM7SUFDL0MsSUFBSSxlQUEwQyxDQUFDO0lBQy9DLElBQUksWUFBMEIsQ0FBQztJQUUvQixzQkFBc0I7SUFDdEIsTUFBTSx1QkFBdUIsR0FBRztRQUM5QixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNqQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2YsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDdkIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDbEIsQ0FBQztJQUVGLDhCQUE4QjtJQUM5QixNQUFNLG1CQUFtQixHQUFHO1FBQzFCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDM0IsMEJBQTBCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNyQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLDJDQUFtQixDQUFDLFFBQVEsQ0FBQztRQUN6RSxhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFB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QyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xccGFnYW1lbnRvXFx0ZXN0c1xcc2VydmljZXNcXHBhZ2FtZW50by5zZXJ2aWNlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBnZXRSZXBvc2l0b3J5VG9rZW4gfSBmcm9tICdAbmVzdGpzL3R5cGVvcm0nO1xuaW1wb3J0IHsgUmVwb3NpdG9yeSB9IGZyb20gJ3R5cGVvcm0nO1xuaW1wb3J0IHsgUGFnYW1lbnRvU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3BhZ2FtZW50by5zZXJ2aWNlJztcbmltcG9ydCB7IFBhZ2FtZW50byB9IGZyb20gJy4uLy4uL2VudGl0aWVzJztcbmltcG9ydCB7IFN0YXR1c1BhZ2FtZW50b0VudW0gfSBmcm9tICcuLi8uLi9lbnVtcy9zdGF0dXMtcGFnYW1lbnRvLmVudW0nO1xuaW1wb3J0IHsgTWV0b2RvUGFnYW1lbnRvRW51bSB9IGZyb20gJy4uLy4uL2VudW1zL21ldG9kby1wYWdhbWVudG8uZW51bSc7XG5pbXBvcnQgeyBTdGF0dXNUcmFuc2l0aW9uVmFsaWRhdG9yIH0gZnJvbSAnLi4vLi4vdmFsaWRhdG9ycy9zdGF0dXMtdHJhbnNpdGlvbi12YWxpZGF0b3InO1xuaW1wb3J0IHsgUGl4VmFsaWRhdG9yIH0gZnJvbSAnLi4vLi4vdmFsaWRhdG9ycy9waXgtdmFsaWRhdG9yJztcbmltcG9ydCB7IENvbmZsaWN0RXhjZXB0aW9uLCBOb3RGb3VuZEV4Y2VwdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcblxuLyoqXG4gKiBUZXN0ZXMgdW5pdMOhcmlvcyBwYXJhIG8gc2VydmnDp28gZGUgcGFnYW1lbnRvXG4gKlxuICogVmVyaWZpY2EgbyBmdW5jaW9uYW1lbnRvIGNvcnJldG8gZGFzIG9wZXJhw6fDtWVzIGRlIGNyaWHDp8OjbywgY29uc3VsdGEsXG4gKiBhdHVhbGl6YcOnw6NvIGUgZ2VyZW5jaWFtZW50byBkZSBzdGF0dXMgZGUgcGFnYW1lbnRvcy5cbiAqXG4gKiBAYXV0aG9yIEVxdWlwZSBQR0JlblxuICovXG5kZXNjcmliZSgnUGFnYW1lbnRvU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IFBhZ2FtZW50b1NlcnZpY2U7XG4gIGxldCBwYWdhbWVudG9SZXBvc2l0b3J5OiBSZXBvc2l0b3J5PFBhZ2FtZW50bz47XG4gIGxldCBzdGF0dXNWYWxpZGF0b3I6IFN0YXR1c1RyYW5zaXRpb25WYWxpZGF0b3I7XG4gIGxldCBwaXhWYWxpZGF0b3I6IFBpeFZhbGlkYXRvcjtcblxuICAvLyBNb2NrIGRvIHJlcG9zaXTDs3Jpb1xuICBjb25zdCBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeSA9IHtcbiAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICBzYXZlOiBqZXN0LmZuKCksXG4gICAgZmluZE9uZTogamVzdC5mbigpLFxuICAgIGZpbmQ6IGplc3QuZm4oKSxcbiAgICBmaW5kQW5kQ291bnQ6IGplc3QuZm4oKSxcbiAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgfTtcblxuICAvLyBNb2NrIGRvIHZhbGlkYWRvciBkZSBzdGF0dXNcbiAgY29uc3QgbW9ja1N0YXR1c1ZhbGlkYXRvciA9IHtcbiAgICB2YWxpZGFyVHJhbnNpY2FvOiBqZXN0LmZuKCksXG4gICAgZ2V0UHJveGltb3NTdGF0dXNQb3NzaXZlaXM6IGplc3QuZm4oKSxcbiAgICBnZXRTdGF0dXNJbmljaWFsOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKFN0YXR1c1BhZ2FtZW50b0VudW0uQUdFTkRBRE8pLFxuICAgIGlzU3RhdHVzRmluYWw6IGplc3QuZm4oKSxcbiAgfTtcblxuICAvLyBNb2NrIGRvIHZhbGlkYWRvciBkZSBQSVhcbiAgY29uc3QgbW9ja1BpeFZhbGlkYXRvciA9IHtcbiAgICB2YWxpZGFyQ2hhdmVQaXg6IGplc3QuZm4oKSxcbiAgICBtYXNjYXJhQ2hhdmVQaXg6IGplc3QuZm4oKSxcbiAgICBvYnRlclRpcG9DaGF2ZVBpeDogamVzdC5mbigpLFxuICB9O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgUGFnYW1lbnRvU2VydmljZSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IGdldFJlcG9zaXRvcnlUb2tlbihQYWdhbWVudG8pLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFN0YXR1c1RyYW5zaXRpb25WYWxpZGF0b3IsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tTdGF0dXNWYWxpZGF0b3IsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQaXhWYWxpZGF0b3IsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tQaXhWYWxpZGF0b3IsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PFBhZ2FtZW50b1NlcnZpY2U+KFBhZ2FtZW50b1NlcnZpY2UpO1xuICAgIHBhZ2FtZW50b1JlcG9zaXRvcnkgPSBtb2R1bGUuZ2V0PFJlcG9zaXRvcnk8UGFnYW1lbnRvPj4oXG4gICAgICBnZXRSZXBvc2l0b3J5VG9rZW4oUGFnYW1lbnRvKSxcbiAgICApO1xuICAgIHN0YXR1c1ZhbGlkYXRvciA9IG1vZHVsZS5nZXQ8U3RhdHVzVHJhbnNpdGlvblZhbGlkYXRvcj4oXG4gICAgICBTdGF0dXNUcmFuc2l0aW9uVmFsaWRhdG9yLFxuICAgICk7XG4gICAgcGl4VmFsaWRhdG9yID0gbW9kdWxlLmdldDxQaXhWYWxpZGF0b3I+KFBpeFZhbGlkYXRvcik7XG5cbiAgICAvLyBMaW1wYXIgbW9ja3MgYW50ZXMgZGUgY2FkYSB0ZXN0ZVxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlUGFnYW1lbnRvJywgKCkgPT4ge1xuICAgIGNvbnN0IGNyZWF0ZUR0byA9IHtcbiAgICAgIHZhbG9yOiA1MDAuMCxcbiAgICAgIGRhdGFMaWJlcmFjYW86IG5ldyBEYXRlKCksXG4gICAgICBtZXRvZG9QYWdhbWVudG86IE1ldG9kb1BhZ2FtZW50b0VudW0uUElYLFxuICAgICAgaW5mb0JhbmNhcmlhSWQ6ICdpbmZvLWJhbmNhcmlhLWlkJyxcbiAgICAgIGRhZG9zQmFuY2FyaW9zOiB7XG4gICAgICAgIHBpeFRpcG86ICdjcGYnLFxuICAgICAgICBwaXhDaGF2ZTogJzEyMzQ1Njc4OTA5JyxcbiAgICAgIH0sXG4gICAgICBvYnNlcnZhY29lczogJ1BhZ2FtZW50byBkZSBiZW5lZsOtY2lvJyxcbiAgICB9O1xuXG4gICAgY29uc3QgdXN1YXJpb0lkID0gJ3VzdWFyaW8taWQnO1xuICAgIGNvbnN0IHNvbGljaXRhY2FvSWQgPSAnc29saWNpdGFjYW8taWQnO1xuXG4gICAgaXQoJ2RldmUgY3JpYXIgdW0gbm92byBwYWdhbWVudG8gY29tIHN1Y2Vzc28nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDb25maWd1cmFyIG1vY2tzXG4gICAgICBtb2NrUGl4VmFsaWRhdG9yLnZhbGlkYXJDaGF2ZVBpeC5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICBtb2NrUGl4VmFsaWRhdG9yLm1hc2NhcmFDaGF2ZVBpeC5tb2NrUmV0dXJuVmFsdWUoJyoqKi40NTYuNzg5LSoqJyk7XG5cbiAgICAgIGNvbnN0IHBhZ2FtZW50b01vY2sgPSB7XG4gICAgICAgIGlkOiAncGFnYW1lbnRvLWlkJyxcbiAgICAgICAgc29saWNpdGFjYW9JZCxcbiAgICAgICAgLi4uY3JlYXRlRHRvLFxuICAgICAgICBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uQUdFTkRBRE8sXG4gICAgICAgIHJlc3BvbnNhdmVsTGliZXJhY2FvOiB1c3VhcmlvSWQsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgbW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuY3JlYXRlLm1vY2tSZXR1cm5WYWx1ZShwYWdhbWVudG9Nb2NrKTtcbiAgICAgIG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LnNhdmUubW9ja1Jlc29sdmVkVmFsdWUocGFnYW1lbnRvTW9jayk7XG5cbiAgICAgIC8vIEV4ZWN1dGFyIG3DqXRvZG9cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY3JlYXRlUGFnYW1lbnRvKFxuICAgICAgICBzb2xpY2l0YWNhb0lkLFxuICAgICAgICBjcmVhdGVEdG8sXG4gICAgICAgIHVzdWFyaW9JZCxcbiAgICAgICk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciByZXN1bHRhZG9cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwocGFnYW1lbnRvTW9jayk7XG4gICAgICBleHBlY3QobW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHNvbGljaXRhY2FvSWQsXG4gICAgICAgIC4uLmNyZWF0ZUR0byxcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkFHRU5EQURPLFxuICAgICAgICByZXNwb25zYXZlbExpYmVyYWNhbzogdXN1YXJpb0lkLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QobW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuc2F2ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgocGFnYW1lbnRvTW9jayk7XG4gICAgICBleHBlY3QobW9ja1BpeFZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBjcmVhdGVEdG8uZGFkb3NCYW5jYXJpb3MucGl4Q2hhdmUsXG4gICAgICAgIGNyZWF0ZUR0by5kYWRvc0JhbmNhcmlvcy5waXhUaXBvLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJlamVpdGFyIHBhZ2FtZW50byBjb20gY2hhdmUgUElYIGludsOhbGlkYScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENvbmZpZ3VyYXIgbW9ja3NcbiAgICAgIG1vY2tQaXhWYWxpZGF0b3IudmFsaWRhckNoYXZlUGl4Lm1vY2tSZXR1cm5WYWx1ZShmYWxzZSk7XG5cbiAgICAgIC8vIEV4ZWN1dGFyIGUgdmVyaWZpY2FyIGV4Y2XDp8Ojb1xuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLmNyZWF0ZVBhZ2FtZW50byhzb2xpY2l0YWNhb0lkLCBjcmVhdGVEdG8sIHVzdWFyaW9JZCksXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnQ2hhdmUgUElYIGludsOhbGlkYScpO1xuXG4gICAgICBleHBlY3QobW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuY3JlYXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LnNhdmUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmaW5kT25lJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIHVtIHBhZ2FtZW50byBxdWFuZG8gZW5jb250cmFkbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBhZ2FtZW50b01vY2sgPSB7XG4gICAgICAgIGlkOiAncGFnYW1lbnRvLWlkJyxcbiAgICAgICAgc29saWNpdGFjYW9JZDogJ3NvbGljaXRhY2FvLWlkJyxcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkFHRU5EQURPLFxuICAgICAgfTtcblxuICAgICAgbW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShwYWdhbWVudG9Nb2NrKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kT25lKCdwYWdhbWVudG8taWQnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChwYWdhbWVudG9Nb2NrKTtcbiAgICAgIGV4cGVjdChtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiAncGFnYW1lbnRvLWlkJyB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBudWxsIHF1YW5kbyBwYWdhbWVudG8gbsOjbyBmb3IgZW5jb250cmFkbycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZE9uZSgncGFnYW1lbnRvLWluZXhpc3RlbnRlJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmaW5kQWxsJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIGxpc3RhIHBhZ2luYWRhIGRlIHBhZ2FtZW50b3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwYWdhbWVudG9zTW9jayA9IFtcbiAgICAgICAgeyBpZDogJ3BhZ2FtZW50by0xJywgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkFHRU5EQURPIH0sXG4gICAgICAgIHsgaWQ6ICdwYWdhbWVudG8tMicsIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETyB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuZmluZEFuZENvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKFtcbiAgICAgICAgcGFnYW1lbnRvc01vY2ssXG4gICAgICAgIDIsXG4gICAgICBdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kQWxsKHsgcGFnZTogMSwgbGltaXQ6IDEwIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgaXRlbXM6IHBhZ2FtZW50b3NNb2NrLFxuICAgICAgICB0b3RhbDogMixcbiAgICAgICAgcGFnZTogMSxcbiAgICAgICAgbGltaXQ6IDEwLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBhcGxpY2FyIGZpbHRyb3MgY29ycmV0YW1lbnRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuZmluZEFuZENvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKFtbXSwgMF0pO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmZpbmRBbGwoe1xuICAgICAgICBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE8sXG4gICAgICAgIHVuaWRhZGVJZDogJ3VuaWRhZGUtaWQnLFxuICAgICAgICBtZXRvZG9QYWdhbWVudG86IE1ldG9kb1BhZ2FtZW50b0VudW0uUElYLFxuICAgICAgICBwYWdlOiAxLFxuICAgICAgICBsaW1pdDogMTAsXG4gICAgICB9KTtcblxuICAgICAgLy8gVmVyaWZpY2FyIHNlIG8gZmlsdHJvIGZvaSBhcGxpY2FkbyBuYSBxdWVyeVxuICAgICAgZXhwZWN0KG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LmZpbmRBbmRDb3VudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICB3aGVyZTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPLFxuICAgICAgICAgICAgbWV0b2RvUGFnYW1lbnRvOiBNZXRvZG9QYWdhbWVudG9FbnVtLlBJWCxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYXR1YWxpemFyU3RhdHVzJywgKCkgPT4ge1xuICAgIGNvbnN0IHBhZ2FtZW50b0lkID0gJ3BhZ2FtZW50by1pZCc7XG4gICAgY29uc3QgdXN1YXJpb0lkID0gJ3VzdWFyaW8taWQnO1xuXG4gICAgaXQoJ2RldmUgYXR1YWxpemFyIHN0YXR1cyBjb20gc3VjZXNzbyBxdWFuZG8gdHJhbnNpw6fDo28gw6kgdsOhbGlkYScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENvbmZpZ3VyYXIgbW9ja3NcbiAgICAgIGNvbnN0IHBhZ2FtZW50b01vY2sgPSB7XG4gICAgICAgIGlkOiBwYWdhbWVudG9JZCxcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkFHRU5EQURPLFxuICAgICAgfTtcblxuICAgICAgbW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShwYWdhbWVudG9Nb2NrKTtcbiAgICAgIG1vY2tTdGF0dXNWYWxpZGF0b3IudmFsaWRhclRyYW5zaWNhby5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5zYXZlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ucGFnYW1lbnRvTW9jayxcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEV4ZWN1dGFyIG3DqXRvZG9cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuYXR1YWxpemFyU3RhdHVzKFxuICAgICAgICBwYWdhbWVudG9JZCxcbiAgICAgICAgU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETyxcbiAgICAgICAgdXN1YXJpb0lkLFxuICAgICAgKTtcblxuICAgICAgLy8gVmVyaWZpY2FyIHJlc3VsdGFkb1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETyk7XG4gICAgICBleHBlY3QobW9ja1N0YXR1c1ZhbGlkYXRvci52YWxpZGFyVHJhbnNpY2FvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgU3RhdHVzUGFnYW1lbnRvRW51bS5BR0VOREFETyxcbiAgICAgICAgU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETyxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZWplaXRhciBhdHVhbGl6YcOnw6NvIHF1YW5kbyBwYWdhbWVudG8gbsOjbyBleGlzdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UuYXR1YWxpemFyU3RhdHVzKFxuICAgICAgICAgIHBhZ2FtZW50b0lkLFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE8sXG4gICAgICAgICAgdXN1YXJpb0lkLFxuICAgICAgICApLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVqZWl0YXIgYXR1YWxpemHDp8OjbyBxdWFuZG8gdHJhbnNpw6fDo28gw6kgaW52w6FsaWRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ29uZmlndXJhciBtb2Nrc1xuICAgICAgY29uc3QgcGFnYW1lbnRvTW9jayA9IHtcbiAgICAgICAgaWQ6IHBhZ2FtZW50b0lkLFxuICAgICAgICBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uQUdFTkRBRE8sXG4gICAgICB9O1xuXG4gICAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKHBhZ2FtZW50b01vY2spO1xuICAgICAgbW9ja1N0YXR1c1ZhbGlkYXRvci52YWxpZGFyVHJhbnNpY2FvLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSk7XG5cbiAgICAgIC8vIEV4ZWN1dGFyIGUgdmVyaWZpY2FyIGV4Y2XDp8Ojb1xuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLmF0dWFsaXphclN0YXR1cyhcbiAgICAgICAgICBwYWdhbWVudG9JZCxcbiAgICAgICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkNPTkZJUk1BRE8sXG4gICAgICAgICAgdXN1YXJpb0lkLFxuICAgICAgICApLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQ29uZmxpY3RFeGNlcHRpb24pO1xuXG4gICAgICBleHBlY3QobW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuc2F2ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NhbmNlbGFyUGFnYW1lbnRvJywgKCkgPT4ge1xuICAgIGNvbnN0IHBhZ2FtZW50b0lkID0gJ3BhZ2FtZW50by1pZCc7XG4gICAgY29uc3QgdXN1YXJpb0lkID0gJ3VzdWFyaW8taWQnO1xuICAgIGNvbnN0IG1vdGl2b0NhbmNlbGFtZW50byA9ICdNb3Rpdm8gZGUgY2FuY2VsYW1lbnRvJztcblxuICAgIGl0KCdkZXZlIGNhbmNlbGFyIHBhZ2FtZW50byBjb20gc3VjZXNzbyBxdWFuZG8gc3RhdHVzIHBlcm1pdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDb25maWd1cmFyIG1vY2tzXG4gICAgICBjb25zdCBwYWdhbWVudG9Nb2NrID0ge1xuICAgICAgICBpZDogcGFnYW1lbnRvSWQsXG4gICAgICAgIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5BR0VOREFETyxcbiAgICAgICAgc29saWNpdGFjYW9JZDogJ3NvbGljaXRhY2FvLWlkJyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUocGFnYW1lbnRvTW9jayk7XG4gICAgICBtb2NrU3RhdHVzVmFsaWRhdG9yLnZhbGlkYXJUcmFuc2ljYW8ubW9ja1JldHVyblZhbHVlKHRydWUpO1xuICAgICAgbW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuc2F2ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLnBhZ2FtZW50b01vY2ssXG4gICAgICAgIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5DQU5DRUxBRE8sXG4gICAgICAgIG9ic2VydmFjb2VzOiBgQ0FOQ0VMQURPOiAke21vdGl2b0NhbmNlbGFtZW50b31gLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEV4ZWN1dGFyIG3DqXRvZG9cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY2FuY2VsYXJQYWdhbWVudG8oXG4gICAgICAgIHBhZ2FtZW50b0lkLFxuICAgICAgICB1c3VhcmlvSWQsXG4gICAgICAgIG1vdGl2b0NhbmNlbGFtZW50byxcbiAgICAgICk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciByZXN1bHRhZG9cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPKTtcbiAgICAgIGV4cGVjdChyZXN1bHQub2JzZXJ2YWNvZXMpLnRvQ29udGFpbihtb3Rpdm9DYW5jZWxhbWVudG8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVqZWl0YXIgY2FuY2VsYW1lbnRvIHF1YW5kbyBwYWdhbWVudG8gbsOjbyBleGlzdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UuY2FuY2VsYXJQYWdhbWVudG8ocGFnYW1lbnRvSWQsIHVzdWFyaW9JZCwgbW90aXZvQ2FuY2VsYW1lbnRvKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJlamVpdGFyIGNhbmNlbGFtZW50byBxdWFuZG8gdHJhbnNpw6fDo28gw6kgaW52w6FsaWRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ29uZmlndXJhciBtb2Nrc1xuICAgICAgY29uc3QgcGFnYW1lbnRvTW9jayA9IHtcbiAgICAgICAgaWQ6IHBhZ2FtZW50b0lkLFxuICAgICAgICBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uQ09ORklSTUFETyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUocGFnYW1lbnRvTW9jayk7XG4gICAgICBtb2NrU3RhdHVzVmFsaWRhdG9yLnZhbGlkYXJUcmFuc2ljYW8ubW9ja1JldHVyblZhbHVlKGZhbHNlKTtcblxuICAgICAgLy8gRXhlY3V0YXIgZSB2ZXJpZmljYXIgZXhjZcOnw6NvXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UuY2FuY2VsYXJQYWdhbWVudG8ocGFnYW1lbnRvSWQsIHVzdWFyaW9JZCwgbW90aXZvQ2FuY2VsYW1lbnRvKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KENvbmZsaWN0RXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbmRQZW5kZW50ZXMnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgcGFnYW1lbnRvcyBjb20gc3RhdHVzIExJQkVSQURPJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGFnYW1lbnRvc01vY2sgPSBbXG4gICAgICAgIHsgaWQ6ICdwYWdhbWVudG8tMScsIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETyB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuZmluZEFuZENvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKFtcbiAgICAgICAgcGFnYW1lbnRvc01vY2ssXG4gICAgICAgIDEsXG4gICAgICBdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kUGVuZGVudGVzKHsgcGFnZTogMSwgbGltaXQ6IDEwIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0Lml0ZW1zKS50b0VxdWFsKHBhZ2FtZW50b3NNb2NrKTtcbiAgICAgIGV4cGVjdChtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5maW5kQW5kQ291bnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgd2hlcmU6IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETyxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9