{"file":"C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\modules\\cidadao\\services\\composicao-familiar.service.ts","mappings":"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","names":[],"sources":["C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\modules\\cidadao\\services\\composicao-familiar.service.ts"],"sourcesContent":["import {\r\n  Injectable,\r\n  NotFoundException,\r\n  ConflictException,\r\n  BadRequestException,\r\n  Logger,\r\n} from '@nestjs/common';\r\nimport { InjectRepository } from '@nestjs/typeorm';\r\nimport { Repository, DataSource, IsNull, Not } from 'typeorm';\r\nimport { plainToInstance } from 'class-transformer';\r\nimport { validate } from 'class-validator';\r\nimport { ComposicaoFamiliar } from '../../../entities/composicao-familiar.entity';\r\nimport { Cidadao } from '../../../entities/cidadao.entity';\r\nimport { CreateComposicaoFamiliarDto } from '../dto/create-composicao-familiar.dto';\r\nimport { UpdateComposicaoFamiliarDto } from '../dto/update-composicao-familiar.dto';\r\nimport {\r\n  ComposicaoFamiliarResponseDto,\r\n  ComposicaoFamiliarPaginatedResponseDto,\r\n} from '../dto/composicao-familiar-response.dto';\r\nimport { CacheService } from '../../../shared/cache';\r\nimport { CPFValidator } from '../validators/cpf-validator';\r\nimport { normalizeEnumFields } from '../../../shared/utils/enum-normalizer.util';\r\n\r\n/**\r\n * Serviço de Composição Familiar\r\n *\r\n * Responsável pela lógica de negócio relacionada aos membros da composição familiar dos cidadãos.\r\n * Implementa operações CRUD completas com validações específicas, cache e auditoria.\r\n */\r\n@Injectable()\r\nexport class ComposicaoFamiliarService {\r\n  private readonly logger = new Logger(ComposicaoFamiliarService.name);\r\n  private readonly CACHE_TTL = 3600; // 1 hora\r\n  private readonly CACHE_PREFIX = 'composicao_familiar:';\r\n\r\n  constructor(\r\n    @InjectRepository(ComposicaoFamiliar)\r\n    private readonly composicaoFamiliarRepository: Repository<ComposicaoFamiliar>,\r\n    @InjectRepository(Cidadao)\r\n    private readonly cidadaoRepository: Repository<Cidadao>,\r\n    private readonly cacheService: CacheService,\r\n    private readonly dataSource: DataSource,\r\n  ) {}\r\n\r\n  /**\r\n   * Cria um novo membro da composição familiar\r\n   * @param createComposicaoFamiliarDto Dados do membro familiar\r\n   * @param userId ID do usuário que está criando\r\n   * @returns Membro da composição familiar criado\r\n   */\r\n  async create(\r\n    createComposicaoFamiliarDto: CreateComposicaoFamiliarDto,\r\n    userId: string,\r\n  ): Promise<ComposicaoFamiliarResponseDto> {\r\n    const queryRunner = this.dataSource.createQueryRunner();\r\n    await queryRunner.connect();\r\n    await queryRunner.startTransaction();\r\n\r\n    try {\r\n      // Validar se o cidadão existe\r\n      const cidadao = await this.cidadaoRepository.findOne({\r\n        where: { id: createComposicaoFamiliarDto.cidadao_id },\r\n      });\r\n\r\n      if (!cidadao) {\r\n        throw new NotFoundException('Cidadão não encontrado');\r\n      }\r\n\r\n      // Validar CPF\r\n      const cpfLimpo = createComposicaoFamiliarDto.cpf.replace(/\\D/g, '');\r\n      const cpfValidator = new CPFValidator();\r\n      if (!cpfValidator.validate(cpfLimpo, {} as any)) {\r\n        throw new BadRequestException('CPF inválido');\r\n      }\r\n\r\n      // Verificar se já existe membro com o mesmo CPF na composição familiar do cidadão\r\n      const membroExistente = await this.composicaoFamiliarRepository.findOne({\r\n        where: {\r\n          cidadao_id: createComposicaoFamiliarDto.cidadao_id,\r\n          cpf: cpfLimpo,\r\n          removed_at: IsNull(),\r\n        },\r\n      });\r\n\r\n      if (membroExistente) {\r\n        throw new ConflictException(\r\n          'Já existe um membro com este CPF na composição familiar',\r\n        );\r\n      }\r\n\r\n      // Verificar se o CPF não é o mesmo do cidadão responsável\r\n      if (cidadao.cpf === cpfLimpo) {\r\n        throw new ConflictException(\r\n          'O CPF do membro não pode ser igual ao CPF do cidadão responsável',\r\n        );\r\n      }\r\n\r\n      // Validar se o nome não é duplicado na mesma composição familiar\r\n      const nomeExistente = await this.composicaoFamiliarRepository.findOne({\r\n        where: {\r\n          cidadao_id: createComposicaoFamiliarDto.cidadao_id,\r\n          nome: createComposicaoFamiliarDto.nome,\r\n          removed_at: IsNull(),\r\n        },\r\n      });\r\n\r\n      if (nomeExistente) {\r\n        throw new ConflictException(\r\n          'Já existe um membro com este nome na composição familiar',\r\n        );\r\n      }\r\n\r\n      // Normalizar campos de enum antes de criar\r\n      const dadosNormalizados = normalizeEnumFields({\r\n        ...createComposicaoFamiliarDto,\r\n        cpf: cpfLimpo,\r\n      });\r\n\r\n      // Criar o membro da composição familiar\r\n      const novoMembro = this.composicaoFamiliarRepository.create(dadosNormalizados);\r\n\r\n      // Validar entidade\r\n      const errors = await validate(novoMembro);\r\n      if (errors.length > 0) {\r\n        const errorMessages = errors\r\n          .map((error) => Object.values(error.constraints || {}).join(', '))\r\n          .join('; ');\r\n        throw new BadRequestException(`Dados inválidos: ${errorMessages}`);\r\n      }\r\n\r\n      const membroSalvo = await queryRunner.manager.save(novoMembro);\r\n\r\n      await queryRunner.commitTransaction();\r\n\r\n      // Invalidar cache relacionado\r\n      await this.invalidateCache(createComposicaoFamiliarDto.cidadao_id);\r\n\r\n      // Converter para DTO de resposta\r\n      const responseDto = plainToInstance(ComposicaoFamiliarResponseDto, membroSalvo, {\r\n        excludeExtraneousValues: true,\r\n        enableImplicitConversion: true,\r\n      });\r\n\r\n      // Cachear o resultado\r\n      await this.cacheService.set(\r\n        `${this.CACHE_PREFIX}id:${membroSalvo.id}`,\r\n        responseDto,\r\n        this.CACHE_TTL,\r\n      );\r\n\r\n      this.logger.log(\r\n        `Membro da composição familiar criado: ${membroSalvo.id} por usuário ${userId}`,\r\n      );\r\n\r\n      return responseDto;\r\n    } catch (error) {\r\n      await queryRunner.rollbackTransaction();\r\n      this.logger.error(\r\n        `Erro ao criar membro da composição familiar: ${error.message}`,\r\n        error.stack,\r\n      );\r\n      throw error;\r\n    } finally {\r\n      await queryRunner.release();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Lista membros da composição familiar por cidadão\r\n   * @param cidadaoId ID do cidadão\r\n   * @param options Opções de paginação\r\n   * @returns Lista paginada de membros\r\n   */\r\n  async findByCidadao(\r\n    cidadaoId: string,\r\n    options: { page: number; limit: number },\r\n  ): Promise<ComposicaoFamiliarPaginatedResponseDto> {\r\n    const { page, limit } = options;\r\n    const offset = (page - 1) * limit;\r\n\r\n    // Verificar se o cidadão existe\r\n    const cidadao = await this.cidadaoRepository.findOne({\r\n      where: { id: cidadaoId },\r\n    });\r\n\r\n    if (!cidadao) {\r\n      throw new NotFoundException('Cidadão não encontrado');\r\n    }\r\n\r\n    // Verificar cache\r\n    const cacheKey = `${this.CACHE_PREFIX}cidadao:${cidadaoId}:page:${page}:limit:${limit}`;\r\n    const cached = await this.cacheService.get<ComposicaoFamiliarPaginatedResponseDto>(cacheKey);\r\n    if (cached) {\r\n      return cached;\r\n    }\r\n\r\n    // Buscar membros da composição familiar\r\n    const [membros, total] = await this.composicaoFamiliarRepository.findAndCount({\r\n      where: {\r\n        cidadao_id: cidadaoId,\r\n        removed_at: IsNull(),\r\n      },\r\n      order: {\r\n        created_at: 'DESC',\r\n      },\r\n      skip: offset,\r\n      take: limit,\r\n    });\r\n\r\n    // Converter para DTOs de resposta\r\n    const data = membros.map((membro) =>\r\n      plainToInstance(ComposicaoFamiliarResponseDto, membro, {\r\n        excludeExtraneousValues: true,\r\n        enableImplicitConversion: true,\r\n      }),\r\n    );\r\n\r\n    // Calcular estatísticas\r\n    const estatisticas = await this.calcularEstatisticas(cidadaoId);\r\n\r\n    const totalPages = Math.ceil(total / limit);\r\n    const result: ComposicaoFamiliarPaginatedResponseDto = {\r\n      data,\r\n      meta: {\r\n        total,\r\n        page,\r\n        limit,\r\n        totalPages,\r\n        hasNext: page < totalPages,\r\n        hasPrev: page > 1,\r\n      },\r\n      estatisticas,\r\n    };\r\n\r\n    // Cachear resultado\r\n    await this.cacheService.set(cacheKey, result, this.CACHE_TTL);\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Busca um membro específico da composição familiar\r\n   * @param id ID do membro\r\n   * @returns Dados do membro\r\n   */\r\n  async findOne(id: string): Promise<ComposicaoFamiliarResponseDto> {\r\n    // Verificar cache\r\n    const cacheKey = `${this.CACHE_PREFIX}id:${id}`;\r\n    const cached = await this.cacheService.get<ComposicaoFamiliarResponseDto>(cacheKey);\r\n    if (cached) {\r\n      return cached;\r\n    }\r\n\r\n    const membro = await this.composicaoFamiliarRepository.findOne({\r\n      where: {\r\n        id,\r\n        removed_at: IsNull(),\r\n      },\r\n      relations: ['cidadao'],\r\n    });\r\n\r\n    if (!membro) {\r\n      throw new NotFoundException('Membro da composição familiar não encontrado');\r\n    }\r\n\r\n    const responseDto = plainToInstance(ComposicaoFamiliarResponseDto, membro, {\r\n      excludeExtraneousValues: true,\r\n      enableImplicitConversion: true,\r\n    });\r\n\r\n    // Cachear resultado\r\n    await this.cacheService.set(cacheKey, responseDto, this.CACHE_TTL);\r\n\r\n    return responseDto;\r\n  }\r\n\r\n  /**\r\n   * Atualiza um membro da composição familiar\r\n   * @param id ID do membro\r\n   * @param updateComposicaoFamiliarDto Dados para atualização\r\n   * @param userId ID do usuário que está atualizando\r\n   * @returns Membro atualizado\r\n   */\r\n  async update(\r\n    id: string,\r\n    updateComposicaoFamiliarDto: UpdateComposicaoFamiliarDto,\r\n    userId: string,\r\n  ): Promise<ComposicaoFamiliarResponseDto> {\r\n    const queryRunner = this.dataSource.createQueryRunner();\r\n    await queryRunner.connect();\r\n    await queryRunner.startTransaction();\r\n\r\n    try {\r\n      const membro = await this.composicaoFamiliarRepository.findOne({\r\n        where: {\r\n          id,\r\n          removed_at: IsNull(),\r\n        },\r\n        relations: ['cidadao'],\r\n      });\r\n\r\n      if (!membro) {\r\n        throw new NotFoundException('Membro da composição familiar não encontrado');\r\n      }\r\n\r\n      // Se o CPF está sendo atualizado, validar\r\n      if (updateComposicaoFamiliarDto.cpf) {\r\n        const cpfLimpo = updateComposicaoFamiliarDto.cpf.replace(/\\D/g, '');\r\n        const cpfValidator = new CPFValidator();\r\n        if (!cpfValidator.validate(cpfLimpo, {} as any)) {\r\n          throw new BadRequestException('CPF inválido');\r\n        }\r\n\r\n        // Verificar se já existe outro membro com o mesmo CPF\r\n        const membroExistente = await this.composicaoFamiliarRepository.findOne({\r\n          where: {\r\n            cidadao_id: membro.cidadao_id,\r\n            cpf: cpfLimpo,\r\n            id: Not(id),\r\n            removed_at: IsNull(),\r\n          },\r\n        });\r\n\r\n        if (membroExistente) {\r\n          throw new ConflictException(\r\n            'Já existe um membro com este CPF na composição familiar',\r\n          );\r\n        }\r\n\r\n        // Verificar se o CPF não é o mesmo do cidadão responsável\r\n        if (membro.cidadao.cpf === cpfLimpo) {\r\n          throw new ConflictException(\r\n            'O CPF do membro não pode ser igual ao CPF do cidadão responsável',\r\n          );\r\n        }\r\n\r\n        updateComposicaoFamiliarDto.cpf = cpfLimpo;\r\n      }\r\n\r\n      // Se o nome está sendo atualizado, validar\r\n      if (updateComposicaoFamiliarDto.nome) {\r\n        const nomeExistente = await this.composicaoFamiliarRepository.findOne({\r\n          where: {\r\n            cidadao_id: membro.cidadao_id,\r\n            nome: updateComposicaoFamiliarDto.nome,\r\n            id: Not(id),\r\n            removed_at: IsNull(),\r\n          },\r\n        });\r\n\r\n        if (nomeExistente) {\r\n          throw new ConflictException(\r\n            'Já existe um membro com este nome na composição familiar',\r\n          );\r\n        }\r\n      }\r\n\r\n      // Normalizar campos de enum antes de atualizar\r\n      const dadosNormalizados = normalizeEnumFields({ ...updateComposicaoFamiliarDto });\r\n\r\n      // Atualizar dados\r\n      Object.assign(membro, dadosNormalizados);\r\n      membro.updated_at = new Date();\r\n\r\n      // Validar entidade\r\n      const errors = await validate(membro);\r\n      if (errors.length > 0) {\r\n        const errorMessages = errors\r\n          .map((error) => Object.values(error.constraints || {}).join(', '))\r\n          .join('; ');\r\n        throw new BadRequestException(`Dados inválidos: ${errorMessages}`);\r\n      }\r\n\r\n      const membroAtualizado = await queryRunner.manager.save(membro);\r\n\r\n      await queryRunner.commitTransaction();\r\n\r\n      // Invalidar cache\r\n      await this.invalidateCache(membro.cidadao_id, id);\r\n\r\n      const responseDto = plainToInstance(ComposicaoFamiliarResponseDto, membroAtualizado, {\r\n        excludeExtraneousValues: true,\r\n        enableImplicitConversion: true,\r\n      });\r\n\r\n      // Atualizar cache\r\n      await this.cacheService.set(\r\n        `${this.CACHE_PREFIX}id:${id}`,\r\n        responseDto,\r\n        this.CACHE_TTL,\r\n      );\r\n\r\n      this.logger.log(\r\n        `Membro da composição familiar atualizado: ${id} por usuário ${userId}`,\r\n      );\r\n\r\n      return responseDto;\r\n    } catch (error) {\r\n      await queryRunner.rollbackTransaction();\r\n      this.logger.error(\r\n        `Erro ao atualizar membro da composição familiar: ${error.message}`,\r\n        error.stack,\r\n      );\r\n      throw error;\r\n    } finally {\r\n      await queryRunner.release();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove um membro da composição familiar (soft delete)\r\n   * @param id ID do membro\r\n   * @param userId ID do usuário que está removendo\r\n   */\r\n  async remove(id: string, userId: string): Promise<void> {\r\n    const membro = await this.composicaoFamiliarRepository.findOne({\r\n      where: {\r\n        id,\r\n        removed_at: IsNull(),\r\n      },\r\n    });\r\n\r\n    if (!membro) {\r\n      throw new NotFoundException('Membro da composição familiar não encontrado');\r\n    }\r\n\r\n    // Soft delete\r\n    membro.removed_at = new Date();\r\n    await this.composicaoFamiliarRepository.save(membro);\r\n\r\n    // Invalidar cache\r\n    await this.invalidateCache(membro.cidadao_id, id);\r\n\r\n    this.logger.log(\r\n      `Membro da composição familiar removido: ${id} por usuário ${userId}`,\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Busca membros da composição familiar por CPF\r\n   * @param cpf CPF para busca\r\n   * @returns Lista de membros encontrados\r\n   */\r\n  async findByCpf(cpf: string): Promise<ComposicaoFamiliarResponseDto[]> {\r\n    const cpfLimpo = cpf.replace(/\\D/g, '');\r\n\r\n    if (cpfLimpo.length !== 11) {\r\n      throw new BadRequestException('CPF deve ter 11 dígitos');\r\n    }\r\n\r\n    const membros = await this.composicaoFamiliarRepository.find({\r\n      where: {\r\n        cpf: cpfLimpo,\r\n        removed_at: IsNull(),\r\n      },\r\n      relations: ['cidadao'],\r\n      order: {\r\n        created_at: 'DESC',\r\n      },\r\n    });\r\n\r\n    return membros.map((membro) =>\r\n      plainToInstance(ComposicaoFamiliarResponseDto, membro, {\r\n        excludeExtraneousValues: true,\r\n        enableImplicitConversion: true,\r\n      }),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Calcula estatísticas da composição familiar\r\n   * @param cidadaoId ID do cidadão\r\n   * @returns Estatísticas calculadas\r\n   */\r\n  private async calcularEstatisticas(cidadaoId: string) {\r\n    const membros = await this.composicaoFamiliarRepository.find({\r\n      where: {\r\n        cidadao_id: cidadaoId,\r\n        removed_at: IsNull(),\r\n      },\r\n    });\r\n\r\n    const totalMembros = membros.length;\r\n    const membrosComRenda = membros.filter((m) => m.renda && m.renda > 0).length;\r\n    const rendaTotal = membros.reduce((sum, m) => sum + (m.renda || 0), 0);\r\n    const rendaMedia = membrosComRenda > 0 ? rendaTotal / membrosComRenda : 0;\r\n    const idadeMedia = totalMembros > 0 ? membros.reduce((sum, m) => sum + m.idade, 0) / totalMembros : 0;\r\n\r\n    return {\r\n      totalMembros,\r\n      rendaTotal,\r\n      rendaMedia: Math.round(rendaMedia * 100) / 100,\r\n      idadeMedia: Math.round(idadeMedia * 100) / 100,\r\n      membrosComRenda,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Invalida cache relacionado à composição familiar\r\n   * @param cidadaoId ID do cidadão\r\n   * @param membroId ID do membro (opcional)\r\n   */\r\n  private async invalidateCache(cidadaoId: string, membroId?: string): Promise<void> {\r\n    const patterns = [\r\n      `${this.CACHE_PREFIX}cidadao:${cidadaoId}:*`,\r\n      `cidadao:id:${cidadaoId}`,\r\n      `cidadao:list:*`,\r\n    ];\r\n\r\n    if (membroId) {\r\n      patterns.push(`${this.CACHE_PREFIX}id:${membroId}`);\r\n    }\r\n\r\n    for (const pattern of patterns) {\r\n      await this.cacheService.del(pattern);\r\n    }\r\n  }\r\n}"],"version":3}