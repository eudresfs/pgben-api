38431e8b5bc3d8d2b0496740a61d7ac9
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const typeorm_1 = require("@nestjs/typeorm");
const pagamento_service_1 = require("../../services/pagamento.service");
const entities_1 = require("../../entities");
const status_pagamento_enum_1 = require("../../enums/status-pagamento.enum");
const metodo_pagamento_enum_1 = require("../../enums/metodo-pagamento.enum");
const status_transition_validator_1 = require("../../validators/status-transition-validator");
const pix_validator_1 = require("../../validators/pix-validator");
const common_1 = require("@nestjs/common");
/**
 * Testes unitários para o serviço de pagamento
 *
 * Verifica o funcionamento correto das operações de criação, consulta,
 * atualização e gerenciamento de status de pagamentos.
 *
 * @author Equipe PGBen
 */
describe('PagamentoService', () => {
    let service;
    let pagamentoRepository;
    let statusValidator;
    let pixValidator;
    // Mock do repositório
    const mockPagamentoRepository = {
        create: jest.fn(),
        save: jest.fn(),
        findOne: jest.fn(),
        find: jest.fn(),
        findAndCount: jest.fn(),
        update: jest.fn(),
    };
    // Mock do validador de status
    const mockStatusValidator = {
        validarTransicao: jest.fn(),
        getProximosStatusPossiveis: jest.fn(),
        getStatusInicial: jest.fn().mockReturnValue(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO),
        isStatusFinal: jest.fn(),
    };
    // Mock do validador de PIX
    const mockPixValidator = {
        validarChavePix: jest.fn(),
        mascaraChavePix: jest.fn(),
        obterTipoChavePix: jest.fn(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                pagamento_service_1.PagamentoService,
                {
                    provide: (0, typeorm_1.getRepositoryToken)(entities_1.Pagamento),
                    useValue: mockPagamentoRepository,
                },
                {
                    provide: status_transition_validator_1.StatusTransitionValidator,
                    useValue: mockStatusValidator,
                },
                {
                    provide: pix_validator_1.PixValidator,
                    useValue: mockPixValidator,
                },
            ],
        }).compile();
        service = module.get(pagamento_service_1.PagamentoService);
        pagamentoRepository = module.get((0, typeorm_1.getRepositoryToken)(entities_1.Pagamento));
        statusValidator = module.get(status_transition_validator_1.StatusTransitionValidator);
        pixValidator = module.get(pix_validator_1.PixValidator);
        // Limpar mocks antes de cada teste
        jest.clearAllMocks();
    });
    describe('createPagamento', () => {
        const createDto = {
            valor: 500.00,
            dataLiberacao: new Date(),
            metodoPagamento: metodo_pagamento_enum_1.MetodoPagamentoEnum.PIX,
            infoBancariaId: 'info-bancaria-id',
            dadosBancarios: {
                pixTipo: 'cpf',
                pixChave: '12345678909'
            },
            observacoes: 'Pagamento de benefício'
        };
        const usuarioId = 'usuario-id';
        const solicitacaoId = 'solicitacao-id';
        it('deve criar um novo pagamento com sucesso', async () => {
            // Configurar mocks
            mockPixValidator.validarChavePix.mockReturnValue(true);
            mockPixValidator.mascaraChavePix.mockReturnValue('***.456.789-**');
            const pagamentoMock = {
                id: 'pagamento-id',
                solicitacaoId,
                ...createDto,
                status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
                responsavelLiberacao: usuarioId,
                createdAt: new Date(),
                updatedAt: new Date()
            };
            mockPagamentoRepository.create.mockReturnValue(pagamentoMock);
            mockPagamentoRepository.save.mockResolvedValue(pagamentoMock);
            // Executar método
            const result = await service.createPagamento(solicitacaoId, createDto, usuarioId);
            // Verificar resultado
            expect(result).toEqual(pagamentoMock);
            expect(mockPagamentoRepository.create).toHaveBeenCalledWith({
                solicitacaoId,
                ...createDto,
                status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
                responsavelLiberacao: usuarioId
            });
            expect(mockPagamentoRepository.save).toHaveBeenCalledWith(pagamentoMock);
            expect(mockPixValidator.validarChavePix).toHaveBeenCalledWith(createDto.dadosBancarios.pixChave, createDto.dadosBancarios.pixTipo);
        });
        it('deve rejeitar pagamento com chave PIX inválida', async () => {
            // Configurar mocks
            mockPixValidator.validarChavePix.mockReturnValue(false);
            // Executar e verificar exceção
            await expect(service.createPagamento(solicitacaoId, createDto, usuarioId)).rejects.toThrow('Chave PIX inválida');
            expect(mockPagamentoRepository.create).not.toHaveBeenCalled();
            expect(mockPagamentoRepository.save).not.toHaveBeenCalled();
        });
    });
    describe('findOne', () => {
        it('deve retornar um pagamento quando encontrado', async () => {
            const pagamentoMock = {
                id: 'pagamento-id',
                solicitacaoId: 'solicitacao-id',
                status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO
            };
            mockPagamentoRepository.findOne.mockResolvedValue(pagamentoMock);
            const result = await service.findOne('pagamento-id');
            expect(result).toEqual(pagamentoMock);
            expect(mockPagamentoRepository.findOne).toHaveBeenCalledWith({
                where: { id: 'pagamento-id' }
            });
        });
        it('deve retornar null quando pagamento não for encontrado', async () => {
            mockPagamentoRepository.findOne.mockResolvedValue(null);
            const result = await service.findOne('pagamento-inexistente');
            expect(result).toBeNull();
        });
    });
    describe('findAll', () => {
        it('deve retornar lista paginada de pagamentos', async () => {
            const pagamentosMock = [
                { id: 'pagamento-1', status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO },
                { id: 'pagamento-2', status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO }
            ];
            mockPagamentoRepository.findAndCount.mockResolvedValue([pagamentosMock, 2]);
            const result = await service.findAll({ page: 1, limit: 10 });
            expect(result).toEqual({
                items: pagamentosMock,
                total: 2,
                page: 1,
                limit: 10
            });
        });
        it('deve aplicar filtros corretamente', async () => {
            mockPagamentoRepository.findAndCount.mockResolvedValue([[], 0]);
            await service.findAll({
                status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
                unidadeId: 'unidade-id',
                metodoPagamento: metodo_pagamento_enum_1.MetodoPagamentoEnum.PIX,
                page: 1,
                limit: 10
            });
            // Verificar se o filtro foi aplicado na query
            expect(mockPagamentoRepository.findAndCount).toHaveBeenCalledWith(expect.objectContaining({
                where: expect.objectContaining({
                    status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
                    metodoPagamento: metodo_pagamento_enum_1.MetodoPagamentoEnum.PIX
                })
            }));
        });
    });
    describe('atualizarStatus', () => {
        const pagamentoId = 'pagamento-id';
        const usuarioId = 'usuario-id';
        it('deve atualizar status com sucesso quando transição é válida', async () => {
            // Configurar mocks
            const pagamentoMock = {
                id: pagamentoId,
                status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO
            };
            mockPagamentoRepository.findOne.mockResolvedValue(pagamentoMock);
            mockStatusValidator.validarTransicao.mockReturnValue(true);
            mockPagamentoRepository.save.mockResolvedValue({
                ...pagamentoMock,
                status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO
            });
            // Executar método
            const result = await service.atualizarStatus(pagamentoId, status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO, usuarioId);
            // Verificar resultado
            expect(result.status).toBe(status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO);
            expect(mockStatusValidator.validarTransicao).toHaveBeenCalledWith(status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO, status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO);
        });
        it('deve rejeitar atualização quando pagamento não existe', async () => {
            mockPagamentoRepository.findOne.mockResolvedValue(null);
            await expect(service.atualizarStatus(pagamentoId, status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO, usuarioId)).rejects.toThrow(common_1.NotFoundException);
        });
        it('deve rejeitar atualização quando transição é inválida', async () => {
            // Configurar mocks
            const pagamentoMock = {
                id: pagamentoId,
                status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO
            };
            mockPagamentoRepository.findOne.mockResolvedValue(pagamentoMock);
            mockStatusValidator.validarTransicao.mockReturnValue(false);
            // Executar e verificar exceção
            await expect(service.atualizarStatus(pagamentoId, status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO, usuarioId)).rejects.toThrow(common_1.ConflictException);
            expect(mockPagamentoRepository.save).not.toHaveBeenCalled();
        });
    });
    describe('cancelarPagamento', () => {
        const pagamentoId = 'pagamento-id';
        const usuarioId = 'usuario-id';
        const motivoCancelamento = 'Motivo de cancelamento';
        it('deve cancelar pagamento com sucesso quando status permite', async () => {
            // Configurar mocks
            const pagamentoMock = {
                id: pagamentoId,
                status: status_pagamento_enum_1.StatusPagamentoEnum.AGENDADO,
                solicitacaoId: 'solicitacao-id'
            };
            mockPagamentoRepository.findOne.mockResolvedValue(pagamentoMock);
            mockStatusValidator.validarTransicao.mockReturnValue(true);
            mockPagamentoRepository.save.mockResolvedValue({
                ...pagamentoMock,
                status: status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO,
                observacoes: `CANCELADO: ${motivoCancelamento}`
            });
            // Executar método
            const result = await service.cancelarPagamento(pagamentoId, usuarioId, motivoCancelamento);
            // Verificar resultado
            expect(result.status).toBe(status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO);
            expect(result.observacoes).toContain(motivoCancelamento);
        });
        it('deve rejeitar cancelamento quando pagamento não existe', async () => {
            mockPagamentoRepository.findOne.mockResolvedValue(null);
            await expect(service.cancelarPagamento(pagamentoId, usuarioId, motivoCancelamento)).rejects.toThrow(common_1.NotFoundException);
        });
        it('deve rejeitar cancelamento quando transição é inválida', async () => {
            // Configurar mocks
            const pagamentoMock = {
                id: pagamentoId,
                status: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO
            };
            mockPagamentoRepository.findOne.mockResolvedValue(pagamentoMock);
            mockStatusValidator.validarTransicao.mockReturnValue(false);
            // Executar e verificar exceção
            await expect(service.cancelarPagamento(pagamentoId, usuarioId, motivoCancelamento)).rejects.toThrow(common_1.ConflictException);
        });
    });
    describe('findPendentes', () => {
        it('deve retornar pagamentos com status LIBERADO', async () => {
            const pagamentosMock = [
                { id: 'pagamento-1', status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO }
            ];
            mockPagamentoRepository.findAndCount.mockResolvedValue([pagamentosMock, 1]);
            const result = await service.findPendentes({ page: 1, limit: 10 });
            expect(result.items).toEqual(pagamentosMock);
            expect(mockPagamentoRepository.findAndCount).toHaveBeenCalledWith(expect.objectContaining({
                where: expect.objectContaining({
                    status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO
                })
            }));
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcdGVzdHNcXHNlcnZpY2VzXFxwYWdhbWVudG8uc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELDZDQUFxRDtBQUVyRCx3RUFBb0U7QUFDcEUsNkNBQTJDO0FBQzNDLDZFQUF3RTtBQUN4RSw2RUFBd0U7QUFDeEUsOEZBQXlGO0FBQ3pGLGtFQUE4RDtBQUM5RCwyQ0FBc0U7QUFFdEU7Ozs7Ozs7R0FPRztBQUNILFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7SUFDaEMsSUFBSSxPQUF5QixDQUFDO0lBQzlCLElBQUksbUJBQTBDLENBQUM7SUFDL0MsSUFBSSxlQUEwQyxDQUFDO0lBQy9DLElBQUksWUFBMEIsQ0FBQztJQUUvQixzQkFBc0I7SUFDdEIsTUFBTSx1QkFBdUIsR0FBRztRQUM5QixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNqQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2YsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDdkIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDbEIsQ0FBQztJQUVGLDhCQUE4QjtJQUM5QixNQUFNLG1CQUFtQixHQUFHO1FBQzFCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDM0IsMEJBQTBCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNyQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLDJDQUFtQixDQUFDLFFBQVEsQ0FBQztRQUN6RSxhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFB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Q0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcdGVzdHNcXHNlcnZpY2VzXFxwYWdhbWVudG8uc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgZ2V0UmVwb3NpdG9yeVRva2VuIH0gZnJvbSAnQG5lc3Rqcy90eXBlb3JtJztcbmltcG9ydCB7IFJlcG9zaXRvcnkgfSBmcm9tICd0eXBlb3JtJztcbmltcG9ydCB7IFBhZ2FtZW50b1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wYWdhbWVudG8uc2VydmljZSc7XG5pbXBvcnQgeyBQYWdhbWVudG8gfSBmcm9tICcuLi8uLi9lbnRpdGllcyc7XG5pbXBvcnQgeyBTdGF0dXNQYWdhbWVudG9FbnVtIH0gZnJvbSAnLi4vLi4vZW51bXMvc3RhdHVzLXBhZ2FtZW50by5lbnVtJztcbmltcG9ydCB7IE1ldG9kb1BhZ2FtZW50b0VudW0gfSBmcm9tICcuLi8uLi9lbnVtcy9tZXRvZG8tcGFnYW1lbnRvLmVudW0nO1xuaW1wb3J0IHsgU3RhdHVzVHJhbnNpdGlvblZhbGlkYXRvciB9IGZyb20gJy4uLy4uL3ZhbGlkYXRvcnMvc3RhdHVzLXRyYW5zaXRpb24tdmFsaWRhdG9yJztcbmltcG9ydCB7IFBpeFZhbGlkYXRvciB9IGZyb20gJy4uLy4uL3ZhbGlkYXRvcnMvcGl4LXZhbGlkYXRvcic7XG5pbXBvcnQgeyBDb25mbGljdEV4Y2VwdGlvbiwgTm90Rm91bmRFeGNlcHRpb24gfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5cbi8qKlxuICogVGVzdGVzIHVuaXTDoXJpb3MgcGFyYSBvIHNlcnZpw6dvIGRlIHBhZ2FtZW50b1xuICogXG4gKiBWZXJpZmljYSBvIGZ1bmNpb25hbWVudG8gY29ycmV0byBkYXMgb3BlcmHDp8O1ZXMgZGUgY3JpYcOnw6NvLCBjb25zdWx0YSxcbiAqIGF0dWFsaXphw6fDo28gZSBnZXJlbmNpYW1lbnRvIGRlIHN0YXR1cyBkZSBwYWdhbWVudG9zLlxuICogXG4gKiBAYXV0aG9yIEVxdWlwZSBQR0JlblxuICovXG5kZXNjcmliZSgnUGFnYW1lbnRvU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IFBhZ2FtZW50b1NlcnZpY2U7XG4gIGxldCBwYWdhbWVudG9SZXBvc2l0b3J5OiBSZXBvc2l0b3J5PFBhZ2FtZW50bz47XG4gIGxldCBzdGF0dXNWYWxpZGF0b3I6IFN0YXR1c1RyYW5zaXRpb25WYWxpZGF0b3I7XG4gIGxldCBwaXhWYWxpZGF0b3I6IFBpeFZhbGlkYXRvcjtcblxuICAvLyBNb2NrIGRvIHJlcG9zaXTDs3Jpb1xuICBjb25zdCBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeSA9IHtcbiAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICBzYXZlOiBqZXN0LmZuKCksXG4gICAgZmluZE9uZTogamVzdC5mbigpLFxuICAgIGZpbmQ6IGplc3QuZm4oKSxcbiAgICBmaW5kQW5kQ291bnQ6IGplc3QuZm4oKSxcbiAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgfTtcblxuICAvLyBNb2NrIGRvIHZhbGlkYWRvciBkZSBzdGF0dXNcbiAgY29uc3QgbW9ja1N0YXR1c1ZhbGlkYXRvciA9IHtcbiAgICB2YWxpZGFyVHJhbnNpY2FvOiBqZXN0LmZuKCksXG4gICAgZ2V0UHJveGltb3NTdGF0dXNQb3NzaXZlaXM6IGplc3QuZm4oKSxcbiAgICBnZXRTdGF0dXNJbmljaWFsOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKFN0YXR1c1BhZ2FtZW50b0VudW0uQUdFTkRBRE8pLFxuICAgIGlzU3RhdHVzRmluYWw6IGplc3QuZm4oKSxcbiAgfTtcblxuICAvLyBNb2NrIGRvIHZhbGlkYWRvciBkZSBQSVhcbiAgY29uc3QgbW9ja1BpeFZhbGlkYXRvciA9IHtcbiAgICB2YWxpZGFyQ2hhdmVQaXg6IGplc3QuZm4oKSxcbiAgICBtYXNjYXJhQ2hhdmVQaXg6IGplc3QuZm4oKSxcbiAgICBvYnRlclRpcG9DaGF2ZVBpeDogamVzdC5mbigpLFxuICB9O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgUGFnYW1lbnRvU2VydmljZSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IGdldFJlcG9zaXRvcnlUb2tlbihQYWdhbWVudG8pLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFN0YXR1c1RyYW5zaXRpb25WYWxpZGF0b3IsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tTdGF0dXNWYWxpZGF0b3IsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQaXhWYWxpZGF0b3IsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tQaXhWYWxpZGF0b3IsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PFBhZ2FtZW50b1NlcnZpY2U+KFBhZ2FtZW50b1NlcnZpY2UpO1xuICAgIHBhZ2FtZW50b1JlcG9zaXRvcnkgPSBtb2R1bGUuZ2V0PFJlcG9zaXRvcnk8UGFnYW1lbnRvPj4oZ2V0UmVwb3NpdG9yeVRva2VuKFBhZ2FtZW50bykpO1xuICAgIHN0YXR1c1ZhbGlkYXRvciA9IG1vZHVsZS5nZXQ8U3RhdHVzVHJhbnNpdGlvblZhbGlkYXRvcj4oU3RhdHVzVHJhbnNpdGlvblZhbGlkYXRvcik7XG4gICAgcGl4VmFsaWRhdG9yID0gbW9kdWxlLmdldDxQaXhWYWxpZGF0b3I+KFBpeFZhbGlkYXRvcik7XG5cbiAgICAvLyBMaW1wYXIgbW9ja3MgYW50ZXMgZGUgY2FkYSB0ZXN0ZVxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlUGFnYW1lbnRvJywgKCkgPT4ge1xuICAgIGNvbnN0IGNyZWF0ZUR0byA9IHtcbiAgICAgIHZhbG9yOiA1MDAuMDAsXG4gICAgICBkYXRhTGliZXJhY2FvOiBuZXcgRGF0ZSgpLFxuICAgICAgbWV0b2RvUGFnYW1lbnRvOiBNZXRvZG9QYWdhbWVudG9FbnVtLlBJWCxcbiAgICAgIGluZm9CYW5jYXJpYUlkOiAnaW5mby1iYW5jYXJpYS1pZCcsXG4gICAgICBkYWRvc0JhbmNhcmlvczoge1xuICAgICAgICBwaXhUaXBvOiAnY3BmJyxcbiAgICAgICAgcGl4Q2hhdmU6ICcxMjM0NTY3ODkwOSdcbiAgICAgIH0sXG4gICAgICBvYnNlcnZhY29lczogJ1BhZ2FtZW50byBkZSBiZW5lZsOtY2lvJ1xuICAgIH07XG5cbiAgICBjb25zdCB1c3VhcmlvSWQgPSAndXN1YXJpby1pZCc7XG4gICAgY29uc3Qgc29saWNpdGFjYW9JZCA9ICdzb2xpY2l0YWNhby1pZCc7XG5cbiAgICBpdCgnZGV2ZSBjcmlhciB1bSBub3ZvIHBhZ2FtZW50byBjb20gc3VjZXNzbycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENvbmZpZ3VyYXIgbW9ja3NcbiAgICAgIG1vY2tQaXhWYWxpZGF0b3IudmFsaWRhckNoYXZlUGl4Lm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICAgIG1vY2tQaXhWYWxpZGF0b3IubWFzY2FyYUNoYXZlUGl4Lm1vY2tSZXR1cm5WYWx1ZSgnKioqLjQ1Ni43ODktKionKTtcbiAgICAgIFxuICAgICAgY29uc3QgcGFnYW1lbnRvTW9jayA9IHtcbiAgICAgICAgaWQ6ICdwYWdhbWVudG8taWQnLFxuICAgICAgICBzb2xpY2l0YWNhb0lkLFxuICAgICAgICAuLi5jcmVhdGVEdG8sXG4gICAgICAgIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5BR0VOREFETyxcbiAgICAgICAgcmVzcG9uc2F2ZWxMaWJlcmFjYW86IHVzdWFyaW9JZCxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICAgIH07XG4gICAgICBcbiAgICAgIG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LmNyZWF0ZS5tb2NrUmV0dXJuVmFsdWUocGFnYW1lbnRvTW9jayk7XG4gICAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5zYXZlLm1vY2tSZXNvbHZlZFZhbHVlKHBhZ2FtZW50b01vY2spO1xuXG4gICAgICAvLyBFeGVjdXRhciBtw6l0b2RvXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmNyZWF0ZVBhZ2FtZW50byhzb2xpY2l0YWNhb0lkLCBjcmVhdGVEdG8sIHVzdWFyaW9JZCk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciByZXN1bHRhZG9cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwocGFnYW1lbnRvTW9jayk7XG4gICAgICBleHBlY3QobW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHNvbGljaXRhY2FvSWQsXG4gICAgICAgIC4uLmNyZWF0ZUR0byxcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkFHRU5EQURPLFxuICAgICAgICByZXNwb25zYXZlbExpYmVyYWNhbzogdXN1YXJpb0lkXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5zYXZlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChwYWdhbWVudG9Nb2NrKTtcbiAgICAgIGV4cGVjdChtb2NrUGl4VmFsaWRhdG9yLnZhbGlkYXJDaGF2ZVBpeCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGNyZWF0ZUR0by5kYWRvc0JhbmNhcmlvcy5waXhDaGF2ZSxcbiAgICAgICAgY3JlYXRlRHRvLmRhZG9zQmFuY2FyaW9zLnBpeFRpcG9cbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZWplaXRhciBwYWdhbWVudG8gY29tIGNoYXZlIFBJWCBpbnbDoWxpZGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDb25maWd1cmFyIG1vY2tzXG4gICAgICBtb2NrUGl4VmFsaWRhdG9yLnZhbGlkYXJDaGF2ZVBpeC5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpO1xuICAgICAgXG4gICAgICAvLyBFeGVjdXRhciBlIHZlcmlmaWNhciBleGNlw6fDo29cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5jcmVhdGVQYWdhbWVudG8oc29saWNpdGFjYW9JZCwgY3JlYXRlRHRvLCB1c3VhcmlvSWQpXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnQ2hhdmUgUElYIGludsOhbGlkYScpO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuY3JlYXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LnNhdmUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmaW5kT25lJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIHVtIHBhZ2FtZW50byBxdWFuZG8gZW5jb250cmFkbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBhZ2FtZW50b01vY2sgPSB7XG4gICAgICAgIGlkOiAncGFnYW1lbnRvLWlkJyxcbiAgICAgICAgc29saWNpdGFjYW9JZDogJ3NvbGljaXRhY2FvLWlkJyxcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkFHRU5EQURPXG4gICAgICB9O1xuICAgICAgXG4gICAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKHBhZ2FtZW50b01vY2spO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRPbmUoJ3BhZ2FtZW50by1pZCcpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHBhZ2FtZW50b01vY2spO1xuICAgICAgZXhwZWN0KG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LmZpbmRPbmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6ICdwYWdhbWVudG8taWQnIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgbnVsbCBxdWFuZG8gcGFnYW1lbnRvIG7Do28gZm9yIGVuY29udHJhZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRPbmUoJ3BhZ2FtZW50by1pbmV4aXN0ZW50ZScpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmluZEFsbCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSByZXRvcm5hciBsaXN0YSBwYWdpbmFkYSBkZSBwYWdhbWVudG9zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGFnYW1lbnRvc01vY2sgPSBbXG4gICAgICAgIHsgaWQ6ICdwYWdhbWVudG8tMScsIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5BR0VOREFETyB9LFxuICAgICAgICB7IGlkOiAncGFnYW1lbnRvLTInLCBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE8gfVxuICAgICAgXTtcbiAgICAgIFxuICAgICAgbW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuZmluZEFuZENvdW50Lm1vY2tSZXNvbHZlZFZhbHVlKFtwYWdhbWVudG9zTW9jaywgMl0pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRBbGwoeyBwYWdlOiAxLCBsaW1pdDogMTAgfSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBpdGVtczogcGFnYW1lbnRvc01vY2ssXG4gICAgICAgIHRvdGFsOiAyLFxuICAgICAgICBwYWdlOiAxLFxuICAgICAgICBsaW1pdDogMTBcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgYXBsaWNhciBmaWx0cm9zIGNvcnJldGFtZW50ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LmZpbmRBbmRDb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZShbW10sIDBdKTtcbiAgICAgIFxuICAgICAgYXdhaXQgc2VydmljZS5maW5kQWxsKHtcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPLFxuICAgICAgICB1bmlkYWRlSWQ6ICd1bmlkYWRlLWlkJyxcbiAgICAgICAgbWV0b2RvUGFnYW1lbnRvOiBNZXRvZG9QYWdhbWVudG9FbnVtLlBJWCxcbiAgICAgICAgcGFnZTogMSxcbiAgICAgICAgbGltaXQ6IDEwXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZpY2FyIHNlIG8gZmlsdHJvIGZvaSBhcGxpY2FkbyBuYSBxdWVyeVxuICAgICAgZXhwZWN0KG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LmZpbmRBbmRDb3VudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICB3aGVyZTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPLFxuICAgICAgICAgICAgbWV0b2RvUGFnYW1lbnRvOiBNZXRvZG9QYWdhbWVudG9FbnVtLlBJWFxuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYXR1YWxpemFyU3RhdHVzJywgKCkgPT4ge1xuICAgIGNvbnN0IHBhZ2FtZW50b0lkID0gJ3BhZ2FtZW50by1pZCc7XG4gICAgY29uc3QgdXN1YXJpb0lkID0gJ3VzdWFyaW8taWQnO1xuICAgIFxuICAgIGl0KCdkZXZlIGF0dWFsaXphciBzdGF0dXMgY29tIHN1Y2Vzc28gcXVhbmRvIHRyYW5zacOnw6NvIMOpIHbDoWxpZGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDb25maWd1cmFyIG1vY2tzXG4gICAgICBjb25zdCBwYWdhbWVudG9Nb2NrID0ge1xuICAgICAgICBpZDogcGFnYW1lbnRvSWQsXG4gICAgICAgIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5BR0VOREFET1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgbW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShwYWdhbWVudG9Nb2NrKTtcbiAgICAgIG1vY2tTdGF0dXNWYWxpZGF0b3IudmFsaWRhclRyYW5zaWNhby5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5zYXZlLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ucGFnYW1lbnRvTW9jayxcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gRXhlY3V0YXIgbcOpdG9kb1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5hdHVhbGl6YXJTdGF0dXMoXG4gICAgICAgIHBhZ2FtZW50b0lkLFxuICAgICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPLFxuICAgICAgICB1c3VhcmlvSWRcbiAgICAgICk7XG4gICAgICBcbiAgICAgIC8vIFZlcmlmaWNhciByZXN1bHRhZG9cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE8pO1xuICAgICAgZXhwZWN0KG1vY2tTdGF0dXNWYWxpZGF0b3IudmFsaWRhclRyYW5zaWNhbykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uQUdFTkRBRE8sXG4gICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE9cbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZWplaXRhciBhdHVhbGl6YcOnw6NvIHF1YW5kbyBwYWdhbWVudG8gbsOjbyBleGlzdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UuYXR1YWxpemFyU3RhdHVzKFxuICAgICAgICAgIHBhZ2FtZW50b0lkLFxuICAgICAgICAgIFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE8sXG4gICAgICAgICAgdXN1YXJpb0lkXG4gICAgICAgIClcbiAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJlamVpdGFyIGF0dWFsaXphw6fDo28gcXVhbmRvIHRyYW5zacOnw6NvIMOpIGludsOhbGlkYScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENvbmZpZ3VyYXIgbW9ja3NcbiAgICAgIGNvbnN0IHBhZ2FtZW50b01vY2sgPSB7XG4gICAgICAgIGlkOiBwYWdhbWVudG9JZCxcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkFHRU5EQURPXG4gICAgICB9O1xuICAgICAgXG4gICAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKHBhZ2FtZW50b01vY2spO1xuICAgICAgbW9ja1N0YXR1c1ZhbGlkYXRvci52YWxpZGFyVHJhbnNpY2FvLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSk7XG4gICAgICBcbiAgICAgIC8vIEV4ZWN1dGFyIGUgdmVyaWZpY2FyIGV4Y2XDp8Ojb1xuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLmF0dWFsaXphclN0YXR1cyhcbiAgICAgICAgICBwYWdhbWVudG9JZCxcbiAgICAgICAgICBTdGF0dXNQYWdhbWVudG9FbnVtLkNPTkZJUk1BRE8sXG4gICAgICAgICAgdXN1YXJpb0lkXG4gICAgICAgIClcbiAgICAgICkucmVqZWN0cy50b1Rocm93KENvbmZsaWN0RXhjZXB0aW9uKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LnNhdmUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjYW5jZWxhclBhZ2FtZW50bycsICgpID0+IHtcbiAgICBjb25zdCBwYWdhbWVudG9JZCA9ICdwYWdhbWVudG8taWQnO1xuICAgIGNvbnN0IHVzdWFyaW9JZCA9ICd1c3VhcmlvLWlkJztcbiAgICBjb25zdCBtb3Rpdm9DYW5jZWxhbWVudG8gPSAnTW90aXZvIGRlIGNhbmNlbGFtZW50byc7XG4gICAgXG4gICAgaXQoJ2RldmUgY2FuY2VsYXIgcGFnYW1lbnRvIGNvbSBzdWNlc3NvIHF1YW5kbyBzdGF0dXMgcGVybWl0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENvbmZpZ3VyYXIgbW9ja3NcbiAgICAgIGNvbnN0IHBhZ2FtZW50b01vY2sgPSB7XG4gICAgICAgIGlkOiBwYWdhbWVudG9JZCxcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkFHRU5EQURPLFxuICAgICAgICBzb2xpY2l0YWNhb0lkOiAnc29saWNpdGFjYW8taWQnXG4gICAgICB9O1xuICAgICAgXG4gICAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKHBhZ2FtZW50b01vY2spO1xuICAgICAgbW9ja1N0YXR1c1ZhbGlkYXRvci52YWxpZGFyVHJhbnNpY2FvLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICAgIG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LnNhdmUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5wYWdhbWVudG9Nb2NrLFxuICAgICAgICBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPLFxuICAgICAgICBvYnNlcnZhY29lczogYENBTkNFTEFETzogJHttb3Rpdm9DYW5jZWxhbWVudG99YFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIEV4ZWN1dGFyIG3DqXRvZG9cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY2FuY2VsYXJQYWdhbWVudG8oXG4gICAgICAgIHBhZ2FtZW50b0lkLFxuICAgICAgICB1c3VhcmlvSWQsXG4gICAgICAgIG1vdGl2b0NhbmNlbGFtZW50b1xuICAgICAgKTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZpY2FyIHJlc3VsdGFkb1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoU3RhdHVzUGFnYW1lbnRvRW51bS5DQU5DRUxBRE8pO1xuICAgICAgZXhwZWN0KHJlc3VsdC5vYnNlcnZhY29lcykudG9Db250YWluKG1vdGl2b0NhbmNlbGFtZW50byk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZWplaXRhciBjYW5jZWxhbWVudG8gcXVhbmRvIHBhZ2FtZW50byBuw6NvIGV4aXN0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5jYW5jZWxhclBhZ2FtZW50byhcbiAgICAgICAgICBwYWdhbWVudG9JZCxcbiAgICAgICAgICB1c3VhcmlvSWQsXG4gICAgICAgICAgbW90aXZvQ2FuY2VsYW1lbnRvXG4gICAgICAgIClcbiAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJlamVpdGFyIGNhbmNlbGFtZW50byBxdWFuZG8gdHJhbnNpw6fDo28gw6kgaW52w6FsaWRhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ29uZmlndXJhciBtb2Nrc1xuICAgICAgY29uc3QgcGFnYW1lbnRvTW9jayA9IHtcbiAgICAgICAgaWQ6IHBhZ2FtZW50b0lkLFxuICAgICAgICBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uQ09ORklSTUFET1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgbW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShwYWdhbWVudG9Nb2NrKTtcbiAgICAgIG1vY2tTdGF0dXNWYWxpZGF0b3IudmFsaWRhclRyYW5zaWNhby5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpO1xuICAgICAgXG4gICAgICAvLyBFeGVjdXRhciBlIHZlcmlmaWNhciBleGNlw6fDo29cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5jYW5jZWxhclBhZ2FtZW50byhcbiAgICAgICAgICBwYWdhbWVudG9JZCxcbiAgICAgICAgICB1c3VhcmlvSWQsXG4gICAgICAgICAgbW90aXZvQ2FuY2VsYW1lbnRvXG4gICAgICAgIClcbiAgICAgICkucmVqZWN0cy50b1Rocm93KENvbmZsaWN0RXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbmRQZW5kZW50ZXMnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgcGFnYW1lbnRvcyBjb20gc3RhdHVzIExJQkVSQURPJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGFnYW1lbnRvc01vY2sgPSBbXG4gICAgICAgIHsgaWQ6ICdwYWdhbWVudG8tMScsIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5MSUJFUkFETyB9XG4gICAgICBdO1xuICAgICAgXG4gICAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5maW5kQW5kQ291bnQubW9ja1Jlc29sdmVkVmFsdWUoW3BhZ2FtZW50b3NNb2NrLCAxXSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZFBlbmRlbnRlcyh7IHBhZ2U6IDEsIGxpbWl0OiAxMCB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5pdGVtcykudG9FcXVhbChwYWdhbWVudG9zTW9jayk7XG4gICAgICBleHBlY3QobW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuZmluZEFuZENvdW50KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHdoZXJlOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uTElCRVJBRE9cbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==