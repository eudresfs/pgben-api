d1b814f6bd1b6ed56d832ada21f5a679
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DadosAluguelSocial = void 0;
const typeorm_1 = require("typeorm");
const class_validator_1 = require("class-validator");
const solicitacao_entity_1 = require("./solicitacao.entity");
const enums_1 = require("../enums");
/**
 * Entidade para armazenar dados específicos do cidadão para Aluguel Social
 *
 * Armazena informações específicas necessárias para a solicitação do benefício
 * de Aluguel Social, como público prioritário, situação da moradia, etc.
 */
let DadosAluguelSocial = class DadosAluguelSocial {
    id;
    solicitacao_id;
    solicitacao;
    publico_prioritario;
    especificacoes;
    situacao_moradia_atual;
    possui_imovel_interditado;
    caso_judicializado_maria_penha;
    observacoes_adicionais;
    created_at;
    updated_at;
    removed_at;
    // Getters
    get createdAt() {
        return this.created_at;
    }
    get updatedAt() {
        return this.updated_at;
    }
    get removedAt() {
        return this.removed_at;
    }
    // Métodos Utilitários
    /**
     * Verifica se é caso de alta prioridade
     */
    isAltaPrioridade() {
        const casosAltaPrioridade = [
            enums_1.PublicoPrioritarioAluguel.MULHERES_VITIMAS_VIOLENCIA,
            enums_1.PublicoPrioritarioAluguel.ATINGIDOS_CALAMIDADE,
            enums_1.PublicoPrioritarioAluguel.SITUACAO_RISCO,
        ];
        return (casosAltaPrioridade.includes(this.publico_prioritario) ||
            this.caso_judicializado_maria_penha);
    }
    /**
     * Verifica se tem especificações de vulnerabilidade
     */
    temVulnerabilidadeEspecifica() {
        if (!this.especificacoes || this.especificacoes.length === 0)
            return false;
        const vulnerabilidades = [
            enums_1.EspecificacaoAluguel.EXPLORACAO_SEXUAL,
            enums_1.EspecificacaoAluguel.VITIMA_VIOLENCIA,
            enums_1.EspecificacaoAluguel.SITUACAO_RUA,
            enums_1.EspecificacaoAluguel.DROGADICAO,
        ];
        return this.especificacoes.some((esp) => vulnerabilidades.includes(esp));
    }
    /**
     * Calcula pontuação de prioridade para fila de atendimento
     */
    calcularPontuacaoPrioridade() {
        let pontuacao = 0;
        // Pontuação base por público prioritário
        switch (this.publico_prioritario) {
            case enums_1.PublicoPrioritarioAluguel.ATINGIDOS_CALAMIDADE:
                pontuacao += 100;
                break;
            case enums_1.PublicoPrioritarioAluguel.MULHERES_VITIMAS_VIOLENCIA:
                pontuacao += 90;
                break;
            case enums_1.PublicoPrioritarioAluguel.SITUACAO_RISCO:
                pontuacao += 80;
                break;
            case enums_1.PublicoPrioritarioAluguel.CRIANCAS_ADOLESCENTES:
                pontuacao += 70;
                break;
            case enums_1.PublicoPrioritarioAluguel.GESTANTES_NUTRIZES:
                pontuacao += 60;
                break;
            case enums_1.PublicoPrioritarioAluguel.IDOSOS:
                pontuacao += 50;
                break;
            case enums_1.PublicoPrioritarioAluguel.PCD:
                pontuacao += 40;
                break;
        }
        // Pontuação adicional por especificações
        if (this.especificacoes) {
            if (this.especificacoes.includes(enums_1.EspecificacaoAluguel.EXPLORACAO_SEXUAL))
                pontuacao += 50;
            if (this.especificacoes.includes(enums_1.EspecificacaoAluguel.VITIMA_VIOLENCIA))
                pontuacao += 40;
            if (this.especificacoes.includes(enums_1.EspecificacaoAluguel.SITUACAO_RUA))
                pontuacao += 30;
            if (this.especificacoes.includes(enums_1.EspecificacaoAluguel.DROGADICAO))
                pontuacao += 20;
        }
        // Pontuação por situações especiais
        if (this.caso_judicializado_maria_penha)
            pontuacao += 50;
        if (this.possui_imovel_interditado)
            pontuacao += 30;
        return pontuacao;
    }
    /**
     * Valida se os dados estão completos para submissão
     */
    validarDadosCompletos() {
        const erros = [];
        if (!this.publico_prioritario) {
            erros.push('Público prioritário é obrigatório');
        }
        if (!this.situacao_moradia_atual ||
            this.situacao_moradia_atual.trim().length === 0) {
            erros.push('Situação da moradia atual é obrigatória');
        }
        if (this.especificacoes && this.especificacoes.length > 2) {
            erros.push('Máximo de 2 especificações permitidas');
        }
        return {
            valido: erros.length === 0,
            erros,
        };
    }
};
exports.DadosAluguelSocial = DadosAluguelSocial;
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)('uuid'),
    __metadata("design:type", String)
], DadosAluguelSocial.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_validator_1.IsNotEmpty)({ message: 'ID da solicitação é obrigatório' }),
    __metadata("design:type", String)
], DadosAluguelSocial.prototype, "solicitacao_id", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => solicitacao_entity_1.Solicitacao, { onDelete: 'CASCADE' }),
    (0, typeorm_1.JoinColumn)({ name: 'solicitacao_id' }),
    __metadata("design:type", typeof (_a = typeof solicitacao_entity_1.Solicitacao !== "undefined" && solicitacao_entity_1.Solicitacao) === "function" ? _a : Object)
], DadosAluguelSocial.prototype, "solicitacao", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'enum',
        enum: enums_1.PublicoPrioritarioAluguel,
        enumName: 'publico_prioritario_aluguel',
    }),
    (0, class_validator_1.IsNotEmpty)({ message: 'Público prioritário é obrigatório' }),
    (0, class_validator_1.IsEnum)(enums_1.PublicoPrioritarioAluguel, {
        message: 'Público prioritário inválido',
    }),
    __metadata("design:type", typeof (_b = typeof enums_1.PublicoPrioritarioAluguel !== "undefined" && enums_1.PublicoPrioritarioAluguel) === "function" ? _b : Object)
], DadosAluguelSocial.prototype, "publico_prioritario", void 0);
__decorate([
    (0, typeorm_1.Column)('simple-array', { nullable: true }),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsArray)({ message: 'Especificações devem ser um array' }),
    __metadata("design:type", Array)
], DadosAluguelSocial.prototype, "especificacoes", void 0);
__decorate([
    (0, typeorm_1.Column)('text'),
    (0, class_validator_1.IsNotEmpty)({ message: 'Situação da moradia atual é obrigatória' }),
    __metadata("design:type", String)
], DadosAluguelSocial.prototype, "situacao_moradia_atual", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: false }),
    (0, class_validator_1.IsBoolean)({ message: 'Possui imóvel interditado deve ser um booleano' }),
    __metadata("design:type", Boolean)
], DadosAluguelSocial.prototype, "possui_imovel_interditado", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: false }),
    (0, class_validator_1.IsBoolean)({
        message: 'Caso judicializado Lei Maria da Penha deve ser um booleano',
    }),
    __metadata("design:type", Boolean)
], DadosAluguelSocial.prototype, "caso_judicializado_maria_penha", void 0);
__decorate([
    (0, typeorm_1.Column)('text', { nullable: true }),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", String)
], DadosAluguelSocial.prototype, "observacoes_adicionais", void 0);
__decorate([
    (0, typeorm_1.CreateDateColumn)(),
    __metadata("design:type", typeof (_c = typeof Date !== "undefined" && Date) === "function" ? _c : Object)
], DadosAluguelSocial.prototype, "created_at", void 0);
__decorate([
    (0, typeorm_1.UpdateDateColumn)(),
    __metadata("design:type", typeof (_d = typeof Date !== "undefined" && Date) === "function" ? _d : Object)
], DadosAluguelSocial.prototype, "updated_at", void 0);
__decorate([
    (0, typeorm_1.DeleteDateColumn)(),
    __metadata("design:type", typeof (_e = typeof Date !== "undefined" && Date) === "function" ? _e : Object)
], DadosAluguelSocial.prototype, "removed_at", void 0);
exports.DadosAluguelSocial = DadosAluguelSocial = __decorate([
    (0, typeorm_1.Entity)('dados_aluguel_social'),
    (0, typeorm_1.Index)(['solicitacao_id'], { unique: true })
], DadosAluguelSocial);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGVudGl0aWVzXFxkYWRvcy1hbHVndWVsLXNvY2lhbC5lbnRpdHkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLHFDQVVpQjtBQUNqQixxREFNeUI7QUFDekIsNkRBQW1EO0FBQ25ELG9DQUEyRTtBQUUzRTs7Ozs7R0FLRztBQUdJLElBQU0sa0JBQWtCLEdBQXhCLE1BQU0sa0JBQWtCO0lBRTdCLEVBQUUsQ0FBUztJQUlYLGNBQWMsQ0FBUztJQUl2QixXQUFXLENBQWM7SUFXekIsbUJBQW1CLENBQTRCO0lBSy9DLGNBQWMsQ0FBMEI7SUFJeEMsc0JBQXNCLENBQVM7SUFJL0IseUJBQXlCLENBQVU7SUFNbkMsOEJBQThCLENBQVU7SUFJeEMsc0JBQXNCLENBQVU7SUFHaEMsVUFBVSxDQUFPO0lBR2pCLFVBQVUsQ0FBTztJQUdqQixVQUFVLENBQU87SUFFakIsVUFBVTtJQUNWLElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN6QixDQUFDO0lBRUQsSUFBSSxTQUFTO1FBQ1gsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxJQUFJLFNBQVM7UUFDWCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDekIsQ0FBQztJQUVELHNCQUFzQjtJQUV0Qjs7T0FFRztJQUNILGdCQUFnQjtRQUNkLE1BQU0sbUJBQW1CLEdBQUc7WUFDMUIsaUNBQXlCLENBQUMsMEJBQTBCO1lBQ3BELGlDQUF5QixDQUFDLG9CQUFvQjtZQUM5QyxpQ0FBeUIsQ0FBQyxjQUFjO1NBQ3pDLENBQUM7UUFFRixPQUFPLENBQ0wsbUJBQW1CLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUN0RCxJQUFJLENBQUMsOEJBQThCLENBQ3BDLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDSCw0QkFBNEI7UUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEtBQUssQ0FBQztZQUFFLE9BQU8sS0FBSyxDQUFDO1FBRTNFLE1BQU0sZ0JBQWdCLEdBQUc7WUFDdkIsNEJBQW9CLENBQUMsaUJBQWlCO1lBQ3RDLDRCQUFvQixDQUFDLGdCQUFnQjtZQUNyQyw0QkFBb0IsQ0FBQyxZQUFZO1lBQ2pDLDRCQUFvQixDQUFDLFVBQVU7U0FDaEMsQ0FBQztRQUVGLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzNFLENBQUM7SUFFRDs7T0FFRztJQUNILDJCQUEyQjtRQUN6QixJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUM7UUFFbEIseUNBQXlDO1FBQ3pDLFFBQVEsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7WUFDakMsS0FBSyxpQ0FBeUIsQ0FBQyxvQkFBb0I7Z0JBQ2pELFNBQVMsSUFBSSxHQUFHLENBQUM7Z0JBQ2pCLE1BQU07WUFDUixLQUFLLGlDQUF5QixDQUFDLDBCQUEwQjtnQkFDdkQsU0FBUyxJQUFJLEVBQUUsQ0FBQztnQkFDaEIsTUFBTTtZQUNSLEtBQUssaUNBQXlCLENBQUMsY0FBYztnQkFDM0MsU0FBUyxJQUFJLEVBQUUsQ0FBQztnQkFDaEIsTUFBTTtZQUNSLEtBQUssaUNBQXlCLENBQUMscUJBQXFCO2dCQUNsRCxTQUFTLElBQUksRUFBRSxDQUFDO2dCQUNoQixNQUFNO1lBQ1IsS0FBSyxpQ0FBeUIsQ0FBQyxrQkFBa0I7Z0JBQy9DLFNBQVMsSUFBSSxFQUFFLENBQUM7Z0JBQ2hCLE1BQU07WUFDUixLQUFLLGlDQUF5QixDQUFDLE1BQU07Z0JBQ25DLFNBQVMsSUFBSSxFQUFFLENBQUM7Z0JBQ2hCLE1BQU07WUFDUixLQUFLLGlDQUF5QixDQUFDLEdBQUc7Z0JBQ2hDLFNBQVMsSUFBSSxFQUFFLENBQUM7Z0JBQ2hCLE1BQU07UUFDVixDQUFDO1FBRUQseUNBQXlDO1FBQ3pDLElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3hCLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsNEJBQW9CLENBQUMsaUJBQWlCLENBQUM7Z0JBQ3RFLFNBQVMsSUFBSSxFQUFFLENBQUM7WUFDbEIsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyw0QkFBb0IsQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDckUsU0FBUyxJQUFJLEVBQUUsQ0FBQztZQUNsQixJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLDRCQUFvQixDQUFDLFlBQVksQ0FBQztnQkFDakUsU0FBUyxJQUFJLEVBQUUsQ0FBQztZQUNsQixJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLDRCQUFvQixDQUFDLFVBQVUsQ0FBQztnQkFDL0QsU0FBUyxJQUFJLEVBQUUsQ0FBQztRQUNwQixDQUFDO1FBRUQsb0NBQW9DO1FBQ3BDLElBQUksSUFBSSxDQUFDLDhCQUE4QjtZQUFFLFNBQVMsSUFBSSxFQUFFLENBQUM7UUFDekQsSUFBSSxJQUFJLENBQUMseUJBQXlCO1lBQUUsU0FBUyxJQUFJLEVBQUUsQ0FBQztRQUVwRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxxQkFBcUI7UUFDbkIsTUFBTSxLQUFLLEdBQWEsRUFBRSxDQUFDO1FBRTNCLElBQUksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztZQUM5QixLQUFLLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxDQUFDLENBQUM7UUFDbEQsQ0FBQztRQUVELElBQ0UsQ0FBQyxJQUFJLENBQUMsc0JBQXNCO1lBQzVCLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUMvQyxDQUFDO1lBQ0QsS0FBSyxDQUFDLElBQUksQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDO1FBQ3hELENBQUM7UUFFRCxJQUFJLElBQUksQ0FBQyxjQUFjLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDMUQsS0FBSyxDQUFDLElBQUksQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDO1FBQ3RELENBQUM7UUFFRCxPQUFPO1lBQ0wsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQztZQUMxQixLQUFLO1NBQ04sQ0FBQztJQUNKLENBQUM7Q0FDRixDQUFBO0FBbExZLGdEQUFrQjtBQUU3QjtJQURDLElBQUEsZ0NBQXNCLEVBQUMsTUFBTSxDQUFDOzs4Q0FDcEI7QUFJWDtJQUZDLElBQUEsZ0JBQU0sR0FBRTtJQUNSLElBQUEsNEJBQVUsRUFBQyxFQUFFLE9BQU8sRUFBRSxpQ0FBaUMsRUFBRSxDQUFDOzswREFDcEM7QUFJdkI7SUFGQyxJQUFBLG1CQUFTLEVBQUMsR0FBRyxFQUFFLENBQUMsZ0NBQVcsRUFBRSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsQ0FBQztJQUNyRCxJQUFBLG9CQUFVLEVBQUMsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQztrREFDMUIsZ0NBQVcsb0JBQVgsZ0NBQVc7dURBQUM7QUFXekI7SUFUQyxJQUFBLGdCQUFNLEVBQUM7UUFDTixJQUFJLEVBQUUsTUFBTTtRQUNaLElBQUksRUFBRSxpQ0FBeUI7UUFDL0IsUUFBUSxFQUFFLDZCQUE2QjtLQUN4QyxDQUFDO0lBQ0QsSUFBQSw0QkFBVSxFQUFDLEVBQUUsT0FBTyxFQUFFLG1DQUFtQyxFQUFFLENBQUM7SUFDNUQsSUFBQSx3QkFBTSxFQUFDLGlDQUF5QixFQUFFO1FBQ2pDLE9BQU8sRUFBRSw4QkFBOEI7S0FDeEMsQ0FBQztrREFDbUIsaUNBQXlCLG9CQUF6QixpQ0FBeUI7K0RBQUM7QUFLL0M7SUFIQyxJQUFBLGdCQUFNLEVBQUMsY0FBYyxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDO0lBQzFDLElBQUEsNEJBQVUsR0FBRTtJQUNaLElBQUEseUJBQU8sRUFBQyxFQUFFLE9BQU8sRUFBRSxtQ0FBbUMsRUFBRSxDQUFDOzswREFDbEI7QUFJeEM7SUFGQyxJQUFBLGdCQUFNLEVBQUMsTUFBTSxDQUFDO0lBQ2QsSUFBQSw0QkFBVSxFQUFDLEVBQUUsT0FBTyxFQUFFLHlDQUF5QyxFQUFFLENBQUM7O2tFQUNwQztBQUkvQjtJQUZDLElBQUEsZ0JBQU0sRUFBQyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsQ0FBQztJQUMxQixJQUFBLDJCQUFTLEVBQUMsRUFBRSxPQUFPLEVBQUUsZ0RBQWdELEVBQUUsQ0FBQzs7cUVBQ3RDO0FBTW5DO0lBSkMsSUFBQSxnQkFBTSxFQUFDLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxDQUFDO0lBQzFCLElBQUEsMkJBQVMsRUFBQztRQUNULE9BQU8sRUFBRSw0REFBNEQ7S0FDdEUsQ0FBQzs7MEVBQ3NDO0FBSXhDO0lBRkMsSUFBQSxnQkFBTSxFQUFDLE1BQU0sRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUNsQyxJQUFBLDRCQUFVLEdBQUU7O2tFQUNtQjtBQUdoQztJQURDLElBQUEsMEJBQWdCLEdBQUU7a0RBQ1AsSUFBSSxvQkFBSixJQUFJO3NEQUFDO0FBR2pCO0lBREMsSUFBQSwwQkFBZ0IsR0FBRTtrREFDUCxJQUFJLG9CQUFKLElBQUk7c0RBQUM7QUFHakI7SUFEQyxJQUFBLDBCQUFnQixHQUFFO2tEQUNQLElBQUksb0JBQUosSUFBSTtzREFBQzs2QkFyRE4sa0JBQWtCO0lBRjlCLElBQUEsZ0JBQU0sRUFBQyxzQkFBc0IsQ0FBQztJQUM5QixJQUFBLGVBQUssRUFBQyxDQUFDLGdCQUFnQixDQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7R0FDL0Isa0JBQWtCLENBa0w5QiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcZW50aXRpZXNcXGRhZG9zLWFsdWd1ZWwtc29jaWFsLmVudGl0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBFbnRpdHksXG4gIFByaW1hcnlHZW5lcmF0ZWRDb2x1bW4sXG4gIENvbHVtbixcbiAgQ3JlYXRlRGF0ZUNvbHVtbixcbiAgVXBkYXRlRGF0ZUNvbHVtbixcbiAgRGVsZXRlRGF0ZUNvbHVtbixcbiAgTWFueVRvT25lLFxuICBKb2luQ29sdW1uLFxuICBJbmRleCxcbn0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQge1xuICBJc05vdEVtcHR5LFxuICBJc0Jvb2xlYW4sXG4gIElzRW51bSxcbiAgSXNPcHRpb25hbCxcbiAgSXNBcnJheSxcbn0gZnJvbSAnY2xhc3MtdmFsaWRhdG9yJztcbmltcG9ydCB7IFNvbGljaXRhY2FvIH0gZnJvbSAnLi9zb2xpY2l0YWNhby5lbnRpdHknO1xuaW1wb3J0IHsgUHVibGljb1ByaW9yaXRhcmlvQWx1Z3VlbCwgRXNwZWNpZmljYWNhb0FsdWd1ZWwgfSBmcm9tICcuLi9lbnVtcyc7XG5cbi8qKlxuICogRW50aWRhZGUgcGFyYSBhcm1hemVuYXIgZGFkb3MgZXNwZWPDrWZpY29zIGRvIGNpZGFkw6NvIHBhcmEgQWx1Z3VlbCBTb2NpYWxcbiAqXG4gKiBBcm1hemVuYSBpbmZvcm1hw6fDtWVzIGVzcGVjw61maWNhcyBuZWNlc3PDoXJpYXMgcGFyYSBhIHNvbGljaXRhw6fDo28gZG8gYmVuZWbDrWNpb1xuICogZGUgQWx1Z3VlbCBTb2NpYWwsIGNvbW8gcMO6YmxpY28gcHJpb3JpdMOhcmlvLCBzaXR1YcOnw6NvIGRhIG1vcmFkaWEsIGV0Yy5cbiAqL1xuQEVudGl0eSgnZGFkb3NfYWx1Z3VlbF9zb2NpYWwnKVxuQEluZGV4KFsnc29saWNpdGFjYW9faWQnXSwgeyB1bmlxdWU6IHRydWUgfSlcbmV4cG9ydCBjbGFzcyBEYWRvc0FsdWd1ZWxTb2NpYWwge1xuICBAUHJpbWFyeUdlbmVyYXRlZENvbHVtbigndXVpZCcpXG4gIGlkOiBzdHJpbmc7XG5cbiAgQENvbHVtbigpXG4gIEBJc05vdEVtcHR5KHsgbWVzc2FnZTogJ0lEIGRhIHNvbGljaXRhw6fDo28gw6kgb2JyaWdhdMOzcmlvJyB9KVxuICBzb2xpY2l0YWNhb19pZDogc3RyaW5nO1xuXG4gIEBNYW55VG9PbmUoKCkgPT4gU29saWNpdGFjYW8sIHsgb25EZWxldGU6ICdDQVNDQURFJyB9KVxuICBASm9pbkNvbHVtbih7IG5hbWU6ICdzb2xpY2l0YWNhb19pZCcgfSlcbiAgc29saWNpdGFjYW86IFNvbGljaXRhY2FvO1xuXG4gIEBDb2x1bW4oe1xuICAgIHR5cGU6ICdlbnVtJyxcbiAgICBlbnVtOiBQdWJsaWNvUHJpb3JpdGFyaW9BbHVndWVsLFxuICAgIGVudW1OYW1lOiAncHVibGljb19wcmlvcml0YXJpb19hbHVndWVsJyxcbiAgfSlcbiAgQElzTm90RW1wdHkoeyBtZXNzYWdlOiAnUMO6YmxpY28gcHJpb3JpdMOhcmlvIMOpIG9icmlnYXTDs3JpbycgfSlcbiAgQElzRW51bShQdWJsaWNvUHJpb3JpdGFyaW9BbHVndWVsLCB7XG4gICAgbWVzc2FnZTogJ1DDumJsaWNvIHByaW9yaXTDoXJpbyBpbnbDoWxpZG8nLFxuICB9KVxuICBwdWJsaWNvX3ByaW9yaXRhcmlvOiBQdWJsaWNvUHJpb3JpdGFyaW9BbHVndWVsO1xuXG4gIEBDb2x1bW4oJ3NpbXBsZS1hcnJheScsIHsgbnVsbGFibGU6IHRydWUgfSlcbiAgQElzT3B0aW9uYWwoKVxuICBASXNBcnJheSh7IG1lc3NhZ2U6ICdFc3BlY2lmaWNhw6fDtWVzIGRldmVtIHNlciB1bSBhcnJheScgfSlcbiAgZXNwZWNpZmljYWNvZXM/OiBFc3BlY2lmaWNhY2FvQWx1Z3VlbFtdO1xuXG4gIEBDb2x1bW4oJ3RleHQnKVxuICBASXNOb3RFbXB0eSh7IG1lc3NhZ2U6ICdTaXR1YcOnw6NvIGRhIG1vcmFkaWEgYXR1YWwgw6kgb2JyaWdhdMOzcmlhJyB9KVxuICBzaXR1YWNhb19tb3JhZGlhX2F0dWFsOiBzdHJpbmc7XG5cbiAgQENvbHVtbih7IGRlZmF1bHQ6IGZhbHNlIH0pXG4gIEBJc0Jvb2xlYW4oeyBtZXNzYWdlOiAnUG9zc3VpIGltw7N2ZWwgaW50ZXJkaXRhZG8gZGV2ZSBzZXIgdW0gYm9vbGVhbm8nIH0pXG4gIHBvc3N1aV9pbW92ZWxfaW50ZXJkaXRhZG86IGJvb2xlYW47XG5cbiAgQENvbHVtbih7IGRlZmF1bHQ6IGZhbHNlIH0pXG4gIEBJc0Jvb2xlYW4oe1xuICAgIG1lc3NhZ2U6ICdDYXNvIGp1ZGljaWFsaXphZG8gTGVpIE1hcmlhIGRhIFBlbmhhIGRldmUgc2VyIHVtIGJvb2xlYW5vJyxcbiAgfSlcbiAgY2Fzb19qdWRpY2lhbGl6YWRvX21hcmlhX3BlbmhhOiBib29sZWFuO1xuXG4gIEBDb2x1bW4oJ3RleHQnLCB7IG51bGxhYmxlOiB0cnVlIH0pXG4gIEBJc09wdGlvbmFsKClcbiAgb2JzZXJ2YWNvZXNfYWRpY2lvbmFpcz86IHN0cmluZztcblxuICBAQ3JlYXRlRGF0ZUNvbHVtbigpXG4gIGNyZWF0ZWRfYXQ6IERhdGU7XG5cbiAgQFVwZGF0ZURhdGVDb2x1bW4oKVxuICB1cGRhdGVkX2F0OiBEYXRlO1xuXG4gIEBEZWxldGVEYXRlQ29sdW1uKClcbiAgcmVtb3ZlZF9hdDogRGF0ZTtcblxuICAvLyBHZXR0ZXJzXG4gIGdldCBjcmVhdGVkQXQoKTogRGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlZF9hdDtcbiAgfVxuXG4gIGdldCB1cGRhdGVkQXQoKTogRGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMudXBkYXRlZF9hdDtcbiAgfVxuXG4gIGdldCByZW1vdmVkQXQoKTogRGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMucmVtb3ZlZF9hdDtcbiAgfVxuXG4gIC8vIE3DqXRvZG9zIFV0aWxpdMOhcmlvc1xuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSDDqSBjYXNvIGRlIGFsdGEgcHJpb3JpZGFkZVxuICAgKi9cbiAgaXNBbHRhUHJpb3JpZGFkZSgpOiBib29sZWFuIHtcbiAgICBjb25zdCBjYXNvc0FsdGFQcmlvcmlkYWRlID0gW1xuICAgICAgUHVibGljb1ByaW9yaXRhcmlvQWx1Z3VlbC5NVUxIRVJFU19WSVRJTUFTX1ZJT0xFTkNJQSxcbiAgICAgIFB1YmxpY29Qcmlvcml0YXJpb0FsdWd1ZWwuQVRJTkdJRE9TX0NBTEFNSURBREUsXG4gICAgICBQdWJsaWNvUHJpb3JpdGFyaW9BbHVndWVsLlNJVFVBQ0FPX1JJU0NPLFxuICAgIF07XG5cbiAgICByZXR1cm4gKFxuICAgICAgY2Fzb3NBbHRhUHJpb3JpZGFkZS5pbmNsdWRlcyh0aGlzLnB1YmxpY29fcHJpb3JpdGFyaW8pIHx8XG4gICAgICB0aGlzLmNhc29fanVkaWNpYWxpemFkb19tYXJpYV9wZW5oYVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgdGVtIGVzcGVjaWZpY2HDp8O1ZXMgZGUgdnVsbmVyYWJpbGlkYWRlXG4gICAqL1xuICB0ZW1WdWxuZXJhYmlsaWRhZGVFc3BlY2lmaWNhKCk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5lc3BlY2lmaWNhY29lcyB8fCB0aGlzLmVzcGVjaWZpY2Fjb2VzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgY29uc3QgdnVsbmVyYWJpbGlkYWRlcyA9IFtcbiAgICAgIEVzcGVjaWZpY2FjYW9BbHVndWVsLkVYUExPUkFDQU9fU0VYVUFMLFxuICAgICAgRXNwZWNpZmljYWNhb0FsdWd1ZWwuVklUSU1BX1ZJT0xFTkNJQSxcbiAgICAgIEVzcGVjaWZpY2FjYW9BbHVndWVsLlNJVFVBQ0FPX1JVQSxcbiAgICAgIEVzcGVjaWZpY2FjYW9BbHVndWVsLkRST0dBRElDQU8sXG4gICAgXTtcblxuICAgIHJldHVybiB0aGlzLmVzcGVjaWZpY2Fjb2VzLnNvbWUoKGVzcCkgPT4gdnVsbmVyYWJpbGlkYWRlcy5pbmNsdWRlcyhlc3ApKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhIHBvbnR1YcOnw6NvIGRlIHByaW9yaWRhZGUgcGFyYSBmaWxhIGRlIGF0ZW5kaW1lbnRvXG4gICAqL1xuICBjYWxjdWxhclBvbnR1YWNhb1ByaW9yaWRhZGUoKTogbnVtYmVyIHtcbiAgICBsZXQgcG9udHVhY2FvID0gMDtcblxuICAgIC8vIFBvbnR1YcOnw6NvIGJhc2UgcG9yIHDDumJsaWNvIHByaW9yaXTDoXJpb1xuICAgIHN3aXRjaCAodGhpcy5wdWJsaWNvX3ByaW9yaXRhcmlvKSB7XG4gICAgICBjYXNlIFB1YmxpY29Qcmlvcml0YXJpb0FsdWd1ZWwuQVRJTkdJRE9TX0NBTEFNSURBREU6XG4gICAgICAgIHBvbnR1YWNhbyArPSAxMDA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBQdWJsaWNvUHJpb3JpdGFyaW9BbHVndWVsLk1VTEhFUkVTX1ZJVElNQVNfVklPTEVOQ0lBOlxuICAgICAgICBwb250dWFjYW8gKz0gOTA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBQdWJsaWNvUHJpb3JpdGFyaW9BbHVndWVsLlNJVFVBQ0FPX1JJU0NPOlxuICAgICAgICBwb250dWFjYW8gKz0gODA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBQdWJsaWNvUHJpb3JpdGFyaW9BbHVndWVsLkNSSUFOQ0FTX0FET0xFU0NFTlRFUzpcbiAgICAgICAgcG9udHVhY2FvICs9IDcwO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgUHVibGljb1ByaW9yaXRhcmlvQWx1Z3VlbC5HRVNUQU5URVNfTlVUUklaRVM6XG4gICAgICAgIHBvbnR1YWNhbyArPSA2MDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFB1YmxpY29Qcmlvcml0YXJpb0FsdWd1ZWwuSURPU09TOlxuICAgICAgICBwb250dWFjYW8gKz0gNTA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBQdWJsaWNvUHJpb3JpdGFyaW9BbHVndWVsLlBDRDpcbiAgICAgICAgcG9udHVhY2FvICs9IDQwO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICAvLyBQb250dWHDp8OjbyBhZGljaW9uYWwgcG9yIGVzcGVjaWZpY2HDp8O1ZXNcbiAgICBpZiAodGhpcy5lc3BlY2lmaWNhY29lcykge1xuICAgICAgaWYgKHRoaXMuZXNwZWNpZmljYWNvZXMuaW5jbHVkZXMoRXNwZWNpZmljYWNhb0FsdWd1ZWwuRVhQTE9SQUNBT19TRVhVQUwpKVxuICAgICAgICBwb250dWFjYW8gKz0gNTA7XG4gICAgICBpZiAodGhpcy5lc3BlY2lmaWNhY29lcy5pbmNsdWRlcyhFc3BlY2lmaWNhY2FvQWx1Z3VlbC5WSVRJTUFfVklPTEVOQ0lBKSlcbiAgICAgICAgcG9udHVhY2FvICs9IDQwO1xuICAgICAgaWYgKHRoaXMuZXNwZWNpZmljYWNvZXMuaW5jbHVkZXMoRXNwZWNpZmljYWNhb0FsdWd1ZWwuU0lUVUFDQU9fUlVBKSlcbiAgICAgICAgcG9udHVhY2FvICs9IDMwO1xuICAgICAgaWYgKHRoaXMuZXNwZWNpZmljYWNvZXMuaW5jbHVkZXMoRXNwZWNpZmljYWNhb0FsdWd1ZWwuRFJPR0FESUNBTykpXG4gICAgICAgIHBvbnR1YWNhbyArPSAyMDtcbiAgICB9XG5cbiAgICAvLyBQb250dWHDp8OjbyBwb3Igc2l0dWHDp8O1ZXMgZXNwZWNpYWlzXG4gICAgaWYgKHRoaXMuY2Fzb19qdWRpY2lhbGl6YWRvX21hcmlhX3BlbmhhKSBwb250dWFjYW8gKz0gNTA7XG4gICAgaWYgKHRoaXMucG9zc3VpX2ltb3ZlbF9pbnRlcmRpdGFkbykgcG9udHVhY2FvICs9IDMwO1xuXG4gICAgcmV0dXJuIHBvbnR1YWNhbztcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGEgc2Ugb3MgZGFkb3MgZXN0w6NvIGNvbXBsZXRvcyBwYXJhIHN1Ym1pc3PDo29cbiAgICovXG4gIHZhbGlkYXJEYWRvc0NvbXBsZXRvcygpOiB7IHZhbGlkbzogYm9vbGVhbjsgZXJyb3M6IHN0cmluZ1tdIH0ge1xuICAgIGNvbnN0IGVycm9zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKCF0aGlzLnB1YmxpY29fcHJpb3JpdGFyaW8pIHtcbiAgICAgIGVycm9zLnB1c2goJ1DDumJsaWNvIHByaW9yaXTDoXJpbyDDqSBvYnJpZ2F0w7NyaW8nKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICAhdGhpcy5zaXR1YWNhb19tb3JhZGlhX2F0dWFsIHx8XG4gICAgICB0aGlzLnNpdHVhY2FvX21vcmFkaWFfYXR1YWwudHJpbSgpLmxlbmd0aCA9PT0gMFxuICAgICkge1xuICAgICAgZXJyb3MucHVzaCgnU2l0dWHDp8OjbyBkYSBtb3JhZGlhIGF0dWFsIMOpIG9icmlnYXTDs3JpYScpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmVzcGVjaWZpY2Fjb2VzICYmIHRoaXMuZXNwZWNpZmljYWNvZXMubGVuZ3RoID4gMikge1xuICAgICAgZXJyb3MucHVzaCgnTcOheGltbyBkZSAyIGVzcGVjaWZpY2HDp8O1ZXMgcGVybWl0aWRhcycpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB2YWxpZG86IGVycm9zLmxlbmd0aCA9PT0gMCxcbiAgICAgIGVycm9zLFxuICAgIH07XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==