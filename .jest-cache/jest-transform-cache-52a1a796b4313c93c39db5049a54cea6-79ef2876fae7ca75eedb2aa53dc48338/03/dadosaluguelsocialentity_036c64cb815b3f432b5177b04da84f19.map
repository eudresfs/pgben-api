{"file":"C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\entities\\dados-aluguel-social.entity.ts","mappings":"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","names":[],"sources":["C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\entities\\dados-aluguel-social.entity.ts"],"sourcesContent":["import {\n  Entity,\n  PrimaryGeneratedColumn,\n  Column,\n  CreateDateColumn,\n  UpdateDateColumn,\n  DeleteDateColumn,\n  ManyToOne,\n  JoinColumn,\n  Index,\n} from 'typeorm';\nimport {\n  IsNotEmpty,\n  IsBoolean,\n  IsEnum,\n  IsOptional,\n  IsArray,\n} from 'class-validator';\nimport { Solicitacao } from './solicitacao.entity';\nimport { PublicoPrioritarioAluguel, EspecificacaoAluguel } from '../enums';\n\n/**\n * Entidade para armazenar dados específicos do cidadão para Aluguel Social\n *\n * Armazena informações específicas necessárias para a solicitação do benefício\n * de Aluguel Social, como público prioritário, situação da moradia, etc.\n */\n@Entity('dados_aluguel_social')\n@Index(['solicitacao_id'], { unique: true })\nexport class DadosAluguelSocial {\n  @PrimaryGeneratedColumn('uuid')\n  id: string;\n\n  @Column()\n  @IsNotEmpty({ message: 'ID da solicitação é obrigatório' })\n  solicitacao_id: string;\n\n  @ManyToOne(() => Solicitacao, { onDelete: 'CASCADE' })\n  @JoinColumn({ name: 'solicitacao_id' })\n  solicitacao: Solicitacao;\n\n  @Column({\n    type: 'enum',\n    enum: PublicoPrioritarioAluguel,\n    enumName: 'publico_prioritario_aluguel',\n  })\n  @IsNotEmpty({ message: 'Público prioritário é obrigatório' })\n  @IsEnum(PublicoPrioritarioAluguel, {\n    message: 'Público prioritário inválido',\n  })\n  publico_prioritario: PublicoPrioritarioAluguel;\n\n  @Column('simple-array', { nullable: true })\n  @IsOptional()\n  @IsArray({ message: 'Especificações devem ser um array' })\n  especificacoes?: EspecificacaoAluguel[];\n\n  @Column('text')\n  @IsNotEmpty({ message: 'Situação da moradia atual é obrigatória' })\n  situacao_moradia_atual: string;\n\n  @Column({ default: false })\n  @IsBoolean({ message: 'Possui imóvel interditado deve ser um booleano' })\n  possui_imovel_interditado: boolean;\n\n  @Column({ default: false })\n  @IsBoolean({\n    message: 'Caso judicializado Lei Maria da Penha deve ser um booleano',\n  })\n  caso_judicializado_maria_penha: boolean;\n\n  @Column('text', { nullable: true })\n  @IsOptional()\n  observacoes_adicionais?: string;\n\n  @CreateDateColumn()\n  created_at: Date;\n\n  @UpdateDateColumn()\n  updated_at: Date;\n\n  @DeleteDateColumn()\n  removed_at: Date;\n\n  // Getters\n  get createdAt(): Date {\n    return this.created_at;\n  }\n\n  get updatedAt(): Date {\n    return this.updated_at;\n  }\n\n  get removedAt(): Date {\n    return this.removed_at;\n  }\n\n  // Métodos Utilitários\n\n  /**\n   * Verifica se é caso de alta prioridade\n   */\n  isAltaPrioridade(): boolean {\n    const casosAltaPrioridade = [\n      PublicoPrioritarioAluguel.MULHERES_VITIMAS_VIOLENCIA,\n      PublicoPrioritarioAluguel.ATINGIDOS_CALAMIDADE,\n      PublicoPrioritarioAluguel.SITUACAO_RISCO,\n    ];\n\n    return (\n      casosAltaPrioridade.includes(this.publico_prioritario) ||\n      this.caso_judicializado_maria_penha\n    );\n  }\n\n  /**\n   * Verifica se tem especificações de vulnerabilidade\n   */\n  temVulnerabilidadeEspecifica(): boolean {\n    if (!this.especificacoes || this.especificacoes.length === 0) return false;\n\n    const vulnerabilidades = [\n      EspecificacaoAluguel.EXPLORACAO_SEXUAL,\n      EspecificacaoAluguel.VITIMA_VIOLENCIA,\n      EspecificacaoAluguel.SITUACAO_RUA,\n      EspecificacaoAluguel.DROGADICAO,\n    ];\n\n    return this.especificacoes.some((esp) => vulnerabilidades.includes(esp));\n  }\n\n  /**\n   * Calcula pontuação de prioridade para fila de atendimento\n   */\n  calcularPontuacaoPrioridade(): number {\n    let pontuacao = 0;\n\n    // Pontuação base por público prioritário\n    switch (this.publico_prioritario) {\n      case PublicoPrioritarioAluguel.ATINGIDOS_CALAMIDADE:\n        pontuacao += 100;\n        break;\n      case PublicoPrioritarioAluguel.MULHERES_VITIMAS_VIOLENCIA:\n        pontuacao += 90;\n        break;\n      case PublicoPrioritarioAluguel.SITUACAO_RISCO:\n        pontuacao += 80;\n        break;\n      case PublicoPrioritarioAluguel.CRIANCAS_ADOLESCENTES:\n        pontuacao += 70;\n        break;\n      case PublicoPrioritarioAluguel.GESTANTES_NUTRIZES:\n        pontuacao += 60;\n        break;\n      case PublicoPrioritarioAluguel.IDOSOS:\n        pontuacao += 50;\n        break;\n      case PublicoPrioritarioAluguel.PCD:\n        pontuacao += 40;\n        break;\n    }\n\n    // Pontuação adicional por especificações\n    if (this.especificacoes) {\n      if (this.especificacoes.includes(EspecificacaoAluguel.EXPLORACAO_SEXUAL))\n        pontuacao += 50;\n      if (this.especificacoes.includes(EspecificacaoAluguel.VITIMA_VIOLENCIA))\n        pontuacao += 40;\n      if (this.especificacoes.includes(EspecificacaoAluguel.SITUACAO_RUA))\n        pontuacao += 30;\n      if (this.especificacoes.includes(EspecificacaoAluguel.DROGADICAO))\n        pontuacao += 20;\n    }\n\n    // Pontuação por situações especiais\n    if (this.caso_judicializado_maria_penha) pontuacao += 50;\n    if (this.possui_imovel_interditado) pontuacao += 30;\n\n    return pontuacao;\n  }\n\n  /**\n   * Valida se os dados estão completos para submissão\n   */\n  validarDadosCompletos(): { valido: boolean; erros: string[] } {\n    const erros: string[] = [];\n\n    if (!this.publico_prioritario) {\n      erros.push('Público prioritário é obrigatório');\n    }\n\n    if (\n      !this.situacao_moradia_atual ||\n      this.situacao_moradia_atual.trim().length === 0\n    ) {\n      erros.push('Situação da moradia atual é obrigatória');\n    }\n\n    if (this.especificacoes && this.especificacoes.length > 2) {\n      erros.push('Máximo de 2 especificações permitidas');\n    }\n\n    return {\n      valido: erros.length === 0,\n      erros,\n    };\n  }\n}\n"],"version":3}