113c2799e6a9cc1641d7c4ed459c3bca
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const config_1 = require("@nestjs/config");
const criptografia_service_1 = require("../../../../src/modules/criptografia/services/criptografia.service");
describe('CriptografiaService', () => {
    let service;
    let configService;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            imports: [
                config_1.ConfigModule.forRoot({
                    isGlobal: true,
                    envFilePath: '.env.test',
                }),
            ],
            providers: [
                criptografia_service_1.CriptografiaService,
                {
                    provide: config_1.ConfigService,
                    useValue: {
                        get: jest.fn((key) => {
                            if (key === 'ENCRYPTION_KEY') {
                                return 'chave-de-criptografia-de-32-caracteres';
                            }
                            if (key === 'ENCRYPTION_IV') {
                                return 'vetor-de-16-chars';
                            }
                            return null;
                        }),
                    },
                },
            ],
        }).compile();
        service = module.get(criptografia_service_1.CriptografiaService);
        configService = module.get(config_1.ConfigService);
    });
    it('deve ser definido', () => {
        expect(service).toBeDefined();
    });
    describe('criptografar', () => {
        it('deve criptografar um texto corretamente', () => {
            const textoOriginal = 'Dados sensíveis para criptografar';
            const textoCriptografado = service.criptografar(textoOriginal);
            // O texto criptografado não deve ser igual ao original
            expect(textoCriptografado).not.toEqual(textoOriginal);
            // O texto criptografado deve ser uma string não vazia
            expect(typeof textoCriptografado).toBe('string');
            expect(textoCriptografado.length).toBeGreaterThan(0);
        });
        it('deve gerar criptografias diferentes para o mesmo texto em chamadas distintas', () => {
            const textoOriginal = 'Dados sensíveis para criptografar';
            const criptografia1 = service.criptografar(textoOriginal);
            const criptografia2 = service.criptografar(textoOriginal);
            // Devido ao IV aleatório, as criptografias devem ser diferentes
            expect(criptografia1).not.toEqual(criptografia2);
        });
        it('deve retornar string vazia ao criptografar null ou undefined', () => {
            expect(service.criptografar(null)).toBe('');
            expect(service.criptografar(undefined)).toBe('');
        });
        it('deve criptografar objetos convertendo-os para JSON', () => {
            const objetoOriginal = { nome: 'João', cpf: '123.456.789-00' };
            const textoCriptografado = service.criptografar(objetoOriginal);
            // O texto criptografado deve ser uma string não vazia
            expect(typeof textoCriptografado).toBe('string');
            expect(textoCriptografado.length).toBeGreaterThan(0);
        });
    });
    describe('descriptografar', () => {
        it('deve descriptografar corretamente um texto previamente criptografado', () => {
            const textoOriginal = 'Dados sensíveis para criptografar';
            const textoCriptografado = service.criptografar(textoOriginal);
            const textoDescriptografado = service.descriptografar(textoCriptografado);
            expect(textoDescriptografado).toEqual(textoOriginal);
        });
        it('deve retornar string vazia ao descriptografar null ou undefined', () => {
            expect(service.descriptografar(null)).toBe('');
            expect(service.descriptografar(undefined)).toBe('');
        });
        it('deve descriptografar e converter para objeto quando o conteúdo original era um objeto', () => {
            const objetoOriginal = { nome: 'João', cpf: '123.456.789-00' };
            const textoCriptografado = service.criptografar(objetoOriginal);
            const objetoDescriptografado = service.descriptografarParaObjeto(textoCriptografado);
            expect(objetoDescriptografado).toEqual(objetoOriginal);
        });
        it('deve lançar erro ao tentar descriptografar um texto inválido', () => {
            const textoInvalido = 'texto-nao-criptografado';
            expect(() => service.descriptografar(textoInvalido)).toThrow();
        });
    });
    describe('criptografarArquivo', () => {
        it('deve criptografar um buffer de arquivo corretamente', () => {
            const conteudoOriginal = Buffer.from('Conteúdo do arquivo sensível');
            const conteudoCriptografado = service.criptografarArquivo(conteudoOriginal);
            // O conteúdo criptografado não deve ser igual ao original
            expect(conteudoCriptografado.equals(conteudoOriginal)).toBe(false);
            // O conteúdo criptografado deve ser um Buffer não vazio
            expect(Buffer.isBuffer(conteudoCriptografado)).toBe(true);
            expect(conteudoCriptografado.length).toBeGreaterThan(0);
        });
        it('deve retornar Buffer vazio ao criptografar null ou undefined', () => {
            expect(service.criptografarArquivo(null).length).toBe(0);
            expect(service.criptografarArquivo(undefined).length).toBe(0);
        });
    });
    describe('descriptografarArquivo', () => {
        it('deve descriptografar corretamente um buffer previamente criptografado', () => {
            const conteudoOriginal = Buffer.from('Conteúdo do arquivo sensível');
            const conteudoCriptografado = service.criptografarArquivo(conteudoOriginal);
            const conteudoDescriptografado = service.descriptografarArquivo(conteudoCriptografado);
            expect(conteudoDescriptografado.equals(conteudoOriginal)).toBe(true);
        });
        it('deve retornar Buffer vazio ao descriptografar null ou undefined', () => {
            expect(service.descriptografarArquivo(null).length).toBe(0);
            expect(service.descriptografarArquivo(undefined).length).toBe(0);
        });
        it('deve lançar erro ao tentar descriptografar um buffer inválido', () => {
            const bufferInvalido = Buffer.from('buffer-nao-criptografado');
            expect(() => service.descriptografarArquivo(bufferInvalido)).toThrow();
        });
    });
    describe('gerarHash', () => {
        it('deve gerar um hash para uma string', () => {
            const textoOriginal = 'Texto para gerar hash';
            const hash = service.gerarHash(textoOriginal);
            // O hash deve ser uma string não vazia
            expect(typeof hash).toBe('string');
            expect(hash.length).toBeGreaterThan(0);
            // O hash não deve ser igual ao texto original
            expect(hash).not.toEqual(textoOriginal);
        });
        it('deve gerar o mesmo hash para o mesmo texto', () => {
            const textoOriginal = 'Texto para gerar hash';
            const hash1 = service.gerarHash(textoOriginal);
            const hash2 = service.gerarHash(textoOriginal);
            // Os hashes devem ser iguais
            expect(hash1).toEqual(hash2);
        });
        it('deve gerar hashes diferentes para textos diferentes', () => {
            const texto1 = 'Texto 1';
            const texto2 = 'Texto 2';
            const hash1 = service.gerarHash(texto1);
            const hash2 = service.gerarHash(texto2);
            // Os hashes devem ser diferentes
            expect(hash1).not.toEqual(hash2);
        });
        it('deve retornar string vazia ao gerar hash de null ou undefined', () => {
            expect(service.gerarHash(null)).toBe('');
            expect(service.gerarHash(undefined)).toBe('');
        });
    });
    describe('verificarHash', () => {
        it('deve verificar corretamente um hash válido', () => {
            const textoOriginal = 'Texto para verificar hash';
            const hash = service.gerarHash(textoOriginal);
            const resultado = service.verificarHash(textoOriginal, hash);
            expect(resultado).toBe(true);
        });
        it('deve rejeitar um hash inválido', () => {
            const textoOriginal = 'Texto para verificar hash';
            const hashInvalido = 'hash-invalido';
            const resultado = service.verificarHash(textoOriginal, hashInvalido);
            expect(resultado).toBe(false);
        });
        it('deve rejeitar quando o texto é diferente do original', () => {
            const textoOriginal = 'Texto para verificar hash';
            const hash = service.gerarHash(textoOriginal);
            const resultado = service.verificarHash('Texto diferente', hash);
            expect(resultado).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFx0ZXN0XFxtb2R1bGVzXFxjcmlwdG9ncmFmaWFcXHNlcnZpY2VzXFxjcmlwdG9ncmFmaWEuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELDJDQUE2RDtBQUM3RCw2R0FBeUc7QUFFekcsUUFBUSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtJQUNuQyxJQUFJLE9BQTRCLENBQUM7SUFDakMsSUFBSSxhQUE0QixDQUFDO0lBRWpDLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixNQUFNLE1BQU0sR0FBa0IsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDM0QsT0FBTyxFQUFFO2dCQUNQLHFCQUFZLENBQUMsT0FBTyxDQUFDO29CQUNuQixRQUFRLEVBQUUsSUFBSTtvQkFDZCxXQUFXLEVBQUUsV0FBVztpQkFDekIsQ0FBQzthQUNIO1lBQ0QsU0FBUyxFQUFFO2dCQUNULDBDQUFtQjtnQkFDbkI7b0JBQ0UsT0FBTyxFQUFFLHNCQUFhO29CQUN0QixRQUFRLEVBQUU7d0JBQ1IsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFXLEVBQUUsRUFBRTs0QkFDM0IsSUFBSSxHQUFHLEtBQUssZ0JBQWdCLEVBQUUsQ0FBQztnQ0FDN0IsT0FBTyx3Q0FBd0MsQ0FBQzs0QkFDbEQsQ0FBQzs0QkFDRCxJQUFJLEdBQUcsS0FBSyxlQUFlLEVBQUUsQ0FBQztnQ0FDNUIsT0FBTyxtQkFBbUIsQ0FBQzs0QkFDN0IsQ0FBQzs0QkFDRCxPQUFPLElBQUksQ0FBQzt3QkFDZCxDQUFDLENBQUM7cUJBQ0g7aUJBQ0Y7YUFDRjtTQUNGLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUViLE9BQU8sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFzQiwwQ0FBbUIsQ0FBQyxDQUFDO1FBQy9ELGFBQWEsR0FBRyxNQUFNLENB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QUFDLGFBQWEsQ0FBQyxDQUFDO1lBRTlDLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRTdELE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0IsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsR0FBRyxFQUFFO1lBQ3hDLE1BQU0sYUFBYSxHQUFHLDJCQUEyQixDQUFDO1lBQ2xELE1BQU0sWUFBWSxHQUFHLGVBQWUsQ0FBQztZQUVyQyxNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLGFBQWEsRUFBRSxZQUFZLENBQUMsQ0FBQztZQUVyRSxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNEQUFzRCxFQUFFLEdBQUcsRUFBRTtZQUM5RCxNQUFNLGFBQWEsR0FBRywyQkFBMkIsQ0FBQztZQUNsRCxNQUFNLElBQUksR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBRTlDLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFFakUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFx0ZXN0XFxtb2R1bGVzXFxjcmlwdG9ncmFmaWFcXHNlcnZpY2VzXFxjcmlwdG9ncmFmaWEuc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgQ29uZmlnTW9kdWxlLCBDb25maWdTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9jb25maWcnO1xuaW1wb3J0IHsgQ3JpcHRvZ3JhZmlhU2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9tb2R1bGVzL2NyaXB0b2dyYWZpYS9zZXJ2aWNlcy9jcmlwdG9ncmFmaWEuc2VydmljZSc7XG5cbmRlc2NyaWJlKCdDcmlwdG9ncmFmaWFTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogQ3JpcHRvZ3JhZmlhU2VydmljZTtcbiAgbGV0IGNvbmZpZ1NlcnZpY2U6IENvbmZpZ1NlcnZpY2U7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIGltcG9ydHM6IFtcbiAgICAgICAgQ29uZmlnTW9kdWxlLmZvclJvb3Qoe1xuICAgICAgICAgIGlzR2xvYmFsOiB0cnVlLFxuICAgICAgICAgIGVudkZpbGVQYXRoOiAnLmVudi50ZXN0JyxcbiAgICAgICAgfSksXG4gICAgICBdLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIENyaXB0b2dyYWZpYVNlcnZpY2UsXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBDb25maWdTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICBnZXQ6IGplc3QuZm4oKGtleTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgIGlmIChrZXkgPT09ICdFTkNSWVBUSU9OX0tFWScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2NoYXZlLWRlLWNyaXB0b2dyYWZpYS1kZS0zMi1jYXJhY3RlcmVzJztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnRU5DUllQVElPTl9JVicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ3ZldG9yLWRlLTE2LWNoYXJzJztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PENyaXB0b2dyYWZpYVNlcnZpY2U+KENyaXB0b2dyYWZpYVNlcnZpY2UpO1xuICAgIGNvbmZpZ1NlcnZpY2UgPSBtb2R1bGUuZ2V0PENvbmZpZ1NlcnZpY2U+KENvbmZpZ1NlcnZpY2UpO1xuICB9KTtcblxuICBpdCgnZGV2ZSBzZXIgZGVmaW5pZG8nLCAoKSA9PiB7XG4gICAgZXhwZWN0KHNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmlwdG9ncmFmYXInLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgY3JpcHRvZ3JhZmFyIHVtIHRleHRvIGNvcnJldGFtZW50ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHRleHRvT3JpZ2luYWwgPSAnRGFkb3Mgc2Vuc8OtdmVpcyBwYXJhIGNyaXB0b2dyYWZhcic7XG4gICAgICBjb25zdCB0ZXh0b0NyaXB0b2dyYWZhZG8gPSBzZXJ2aWNlLmNyaXB0b2dyYWZhcih0ZXh0b09yaWdpbmFsKTtcblxuICAgICAgLy8gTyB0ZXh0byBjcmlwdG9ncmFmYWRvIG7Do28gZGV2ZSBzZXIgaWd1YWwgYW8gb3JpZ2luYWxcbiAgICAgIGV4cGVjdCh0ZXh0b0NyaXB0b2dyYWZhZG8pLm5vdC50b0VxdWFsKHRleHRvT3JpZ2luYWwpO1xuXG4gICAgICAvLyBPIHRleHRvIGNyaXB0b2dyYWZhZG8gZGV2ZSBzZXIgdW1hIHN0cmluZyBuw6NvIHZhemlhXG4gICAgICBleHBlY3QodHlwZW9mIHRleHRvQ3JpcHRvZ3JhZmFkbykudG9CZSgnc3RyaW5nJyk7XG4gICAgICBleHBlY3QodGV4dG9DcmlwdG9ncmFmYWRvLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZ2VyYXIgY3JpcHRvZ3JhZmlhcyBkaWZlcmVudGVzIHBhcmEgbyBtZXNtbyB0ZXh0byBlbSBjaGFtYWRhcyBkaXN0aW50YXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXh0b09yaWdpbmFsID0gJ0RhZG9zIHNlbnPDrXZlaXMgcGFyYSBjcmlwdG9ncmFmYXInO1xuXG4gICAgICBjb25zdCBjcmlwdG9ncmFmaWExID0gc2VydmljZS5jcmlwdG9ncmFmYXIodGV4dG9PcmlnaW5hbCk7XG4gICAgICBjb25zdCBjcmlwdG9ncmFmaWEyID0gc2VydmljZS5jcmlwdG9ncmFmYXIodGV4dG9PcmlnaW5hbCk7XG5cbiAgICAgIC8vIERldmlkbyBhbyBJViBhbGVhdMOzcmlvLCBhcyBjcmlwdG9ncmFmaWFzIGRldmVtIHNlciBkaWZlcmVudGVzXG4gICAgICBleHBlY3QoY3JpcHRvZ3JhZmlhMSkubm90LnRvRXF1YWwoY3JpcHRvZ3JhZmlhMik7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBzdHJpbmcgdmF6aWEgYW8gY3JpcHRvZ3JhZmFyIG51bGwgb3UgdW5kZWZpbmVkJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHNlcnZpY2UuY3JpcHRvZ3JhZmFyKG51bGwpKS50b0JlKCcnKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmNyaXB0b2dyYWZhcih1bmRlZmluZWQpKS50b0JlKCcnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGNyaXB0b2dyYWZhciBvYmpldG9zIGNvbnZlcnRlbmRvLW9zIHBhcmEgSlNPTicsICgpID0+IHtcbiAgICAgIGNvbnN0IG9iamV0b09yaWdpbmFsID0geyBub21lOiAnSm/Do28nLCBjcGY6ICcxMjMuNDU2Ljc4OS0wMCcgfTtcbiAgICAgIGNvbnN0IHRleHRvQ3JpcHRvZ3JhZmFkbyA9IHNlcnZpY2UuY3JpcHRvZ3JhZmFyKG9iamV0b09yaWdpbmFsKTtcblxuICAgICAgLy8gTyB0ZXh0byBjcmlwdG9ncmFmYWRvIGRldmUgc2VyIHVtYSBzdHJpbmcgbsOjbyB2YXppYVxuICAgICAgZXhwZWN0KHR5cGVvZiB0ZXh0b0NyaXB0b2dyYWZhZG8pLnRvQmUoJ3N0cmluZycpO1xuICAgICAgZXhwZWN0KHRleHRvQ3JpcHRvZ3JhZmFkby5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Rlc2NyaXB0b2dyYWZhcicsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBkZXNjcmlwdG9ncmFmYXIgY29ycmV0YW1lbnRlIHVtIHRleHRvIHByZXZpYW1lbnRlIGNyaXB0b2dyYWZhZG8nLCAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXh0b09yaWdpbmFsID0gJ0RhZG9zIHNlbnPDrXZlaXMgcGFyYSBjcmlwdG9ncmFmYXInO1xuICAgICAgY29uc3QgdGV4dG9DcmlwdG9ncmFmYWRvID0gc2VydmljZS5jcmlwdG9ncmFmYXIodGV4dG9PcmlnaW5hbCk7XG4gICAgICBjb25zdCB0ZXh0b0Rlc2NyaXB0b2dyYWZhZG8gPSBzZXJ2aWNlLmRlc2NyaXB0b2dyYWZhcih0ZXh0b0NyaXB0b2dyYWZhZG8pO1xuXG4gICAgICBleHBlY3QodGV4dG9EZXNjcmlwdG9ncmFmYWRvKS50b0VxdWFsKHRleHRvT3JpZ2luYWwpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgc3RyaW5nIHZhemlhIGFvIGRlc2NyaXB0b2dyYWZhciBudWxsIG91IHVuZGVmaW5lZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmRlc2NyaXB0b2dyYWZhcihudWxsKSkudG9CZSgnJyk7XG4gICAgICBleHBlY3Qoc2VydmljZS5kZXNjcmlwdG9ncmFmYXIodW5kZWZpbmVkKSkudG9CZSgnJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBkZXNjcmlwdG9ncmFmYXIgZSBjb252ZXJ0ZXIgcGFyYSBvYmpldG8gcXVhbmRvIG8gY29udGXDumRvIG9yaWdpbmFsIGVyYSB1bSBvYmpldG8nLCAoKSA9PiB7XG4gICAgICBjb25zdCBvYmpldG9PcmlnaW5hbCA9IHsgbm9tZTogJ0pvw6NvJywgY3BmOiAnMTIzLjQ1Ni43ODktMDAnIH07XG4gICAgICBjb25zdCB0ZXh0b0NyaXB0b2dyYWZhZG8gPSBzZXJ2aWNlLmNyaXB0b2dyYWZhcihvYmpldG9PcmlnaW5hbCk7XG4gICAgICBjb25zdCBvYmpldG9EZXNjcmlwdG9ncmFmYWRvID1cbiAgICAgICAgc2VydmljZS5kZXNjcmlwdG9ncmFmYXJQYXJhT2JqZXRvKHRleHRvQ3JpcHRvZ3JhZmFkbyk7XG5cbiAgICAgIGV4cGVjdChvYmpldG9EZXNjcmlwdG9ncmFmYWRvKS50b0VxdWFsKG9iamV0b09yaWdpbmFsKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGxhbsOnYXIgZXJybyBhbyB0ZW50YXIgZGVzY3JpcHRvZ3JhZmFyIHVtIHRleHRvIGludsOhbGlkbycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRleHRvSW52YWxpZG8gPSAndGV4dG8tbmFvLWNyaXB0b2dyYWZhZG8nO1xuXG4gICAgICBleHBlY3QoKCkgPT4gc2VydmljZS5kZXNjcmlwdG9ncmFmYXIodGV4dG9JbnZhbGlkbykpLnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyaXB0b2dyYWZhckFycXVpdm8nLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgY3JpcHRvZ3JhZmFyIHVtIGJ1ZmZlciBkZSBhcnF1aXZvIGNvcnJldGFtZW50ZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRldWRvT3JpZ2luYWwgPSBCdWZmZXIuZnJvbSgnQ29udGXDumRvIGRvIGFycXVpdm8gc2Vuc8OtdmVsJyk7XG4gICAgICBjb25zdCBjb250ZXVkb0NyaXB0b2dyYWZhZG8gPVxuICAgICAgICBzZXJ2aWNlLmNyaXB0b2dyYWZhckFycXVpdm8oY29udGV1ZG9PcmlnaW5hbCk7XG5cbiAgICAgIC8vIE8gY29udGXDumRvIGNyaXB0b2dyYWZhZG8gbsOjbyBkZXZlIHNlciBpZ3VhbCBhbyBvcmlnaW5hbFxuICAgICAgZXhwZWN0KGNvbnRldWRvQ3JpcHRvZ3JhZmFkby5lcXVhbHMoY29udGV1ZG9PcmlnaW5hbCkpLnRvQmUoZmFsc2UpO1xuXG4gICAgICAvLyBPIGNvbnRlw7pkbyBjcmlwdG9ncmFmYWRvIGRldmUgc2VyIHVtIEJ1ZmZlciBuw6NvIHZhemlvXG4gICAgICBleHBlY3QoQnVmZmVyLmlzQnVmZmVyKGNvbnRldWRvQ3JpcHRvZ3JhZmFkbykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY29udGV1ZG9DcmlwdG9ncmFmYWRvLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgQnVmZmVyIHZhemlvIGFvIGNyaXB0b2dyYWZhciBudWxsIG91IHVuZGVmaW5lZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmNyaXB0b2dyYWZhckFycXVpdm8obnVsbCkubGVuZ3RoKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuY3JpcHRvZ3JhZmFyQXJxdWl2byh1bmRlZmluZWQpLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Rlc2NyaXB0b2dyYWZhckFycXVpdm8nLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgZGVzY3JpcHRvZ3JhZmFyIGNvcnJldGFtZW50ZSB1bSBidWZmZXIgcHJldmlhbWVudGUgY3JpcHRvZ3JhZmFkbycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRldWRvT3JpZ2luYWwgPSBCdWZmZXIuZnJvbSgnQ29udGXDumRvIGRvIGFycXVpdm8gc2Vuc8OtdmVsJyk7XG4gICAgICBjb25zdCBjb250ZXVkb0NyaXB0b2dyYWZhZG8gPVxuICAgICAgICBzZXJ2aWNlLmNyaXB0b2dyYWZhckFycXVpdm8oY29udGV1ZG9PcmlnaW5hbCk7XG4gICAgICBjb25zdCBjb250ZXVkb0Rlc2NyaXB0b2dyYWZhZG8gPSBzZXJ2aWNlLmRlc2NyaXB0b2dyYWZhckFycXVpdm8oXG4gICAgICAgIGNvbnRldWRvQ3JpcHRvZ3JhZmFkbyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChjb250ZXVkb0Rlc2NyaXB0b2dyYWZhZG8uZXF1YWxzKGNvbnRldWRvT3JpZ2luYWwpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgQnVmZmVyIHZhemlvIGFvIGRlc2NyaXB0b2dyYWZhciBudWxsIG91IHVuZGVmaW5lZCcsICgpID0+IHtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmRlc2NyaXB0b2dyYWZhckFycXVpdm8obnVsbCkubGVuZ3RoKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZGVzY3JpcHRvZ3JhZmFyQXJxdWl2byh1bmRlZmluZWQpLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGxhbsOnYXIgZXJybyBhbyB0ZW50YXIgZGVzY3JpcHRvZ3JhZmFyIHVtIGJ1ZmZlciBpbnbDoWxpZG8nLCAoKSA9PiB7XG4gICAgICBjb25zdCBidWZmZXJJbnZhbGlkbyA9IEJ1ZmZlci5mcm9tKCdidWZmZXItbmFvLWNyaXB0b2dyYWZhZG8nKTtcblxuICAgICAgZXhwZWN0KCgpID0+IHNlcnZpY2UuZGVzY3JpcHRvZ3JhZmFyQXJxdWl2byhidWZmZXJJbnZhbGlkbykpLnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dlcmFySGFzaCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBnZXJhciB1bSBoYXNoIHBhcmEgdW1hIHN0cmluZycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRleHRvT3JpZ2luYWwgPSAnVGV4dG8gcGFyYSBnZXJhciBoYXNoJztcbiAgICAgIGNvbnN0IGhhc2ggPSBzZXJ2aWNlLmdlcmFySGFzaCh0ZXh0b09yaWdpbmFsKTtcblxuICAgICAgLy8gTyBoYXNoIGRldmUgc2VyIHVtYSBzdHJpbmcgbsOjbyB2YXppYVxuICAgICAgZXhwZWN0KHR5cGVvZiBoYXNoKS50b0JlKCdzdHJpbmcnKTtcbiAgICAgIGV4cGVjdChoYXNoLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuXG4gICAgICAvLyBPIGhhc2ggbsOjbyBkZXZlIHNlciBpZ3VhbCBhbyB0ZXh0byBvcmlnaW5hbFxuICAgICAgZXhwZWN0KGhhc2gpLm5vdC50b0VxdWFsKHRleHRvT3JpZ2luYWwpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZ2VyYXIgbyBtZXNtbyBoYXNoIHBhcmEgbyBtZXNtbyB0ZXh0bycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRleHRvT3JpZ2luYWwgPSAnVGV4dG8gcGFyYSBnZXJhciBoYXNoJztcblxuICAgICAgY29uc3QgaGFzaDEgPSBzZXJ2aWNlLmdlcmFySGFzaCh0ZXh0b09yaWdpbmFsKTtcbiAgICAgIGNvbnN0IGhhc2gyID0gc2VydmljZS5nZXJhckhhc2godGV4dG9PcmlnaW5hbCk7XG5cbiAgICAgIC8vIE9zIGhhc2hlcyBkZXZlbSBzZXIgaWd1YWlzXG4gICAgICBleHBlY3QoaGFzaDEpLnRvRXF1YWwoaGFzaDIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZ2VyYXIgaGFzaGVzIGRpZmVyZW50ZXMgcGFyYSB0ZXh0b3MgZGlmZXJlbnRlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRleHRvMSA9ICdUZXh0byAxJztcbiAgICAgIGNvbnN0IHRleHRvMiA9ICdUZXh0byAyJztcblxuICAgICAgY29uc3QgaGFzaDEgPSBzZXJ2aWNlLmdlcmFySGFzaCh0ZXh0bzEpO1xuICAgICAgY29uc3QgaGFzaDIgPSBzZXJ2aWNlLmdlcmFySGFzaCh0ZXh0bzIpO1xuXG4gICAgICAvLyBPcyBoYXNoZXMgZGV2ZW0gc2VyIGRpZmVyZW50ZXNcbiAgICAgIGV4cGVjdChoYXNoMSkubm90LnRvRXF1YWwoaGFzaDIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgc3RyaW5nIHZhemlhIGFvIGdlcmFyIGhhc2ggZGUgbnVsbCBvdSB1bmRlZmluZWQnLCAoKSA9PiB7XG4gICAgICBleHBlY3Qoc2VydmljZS5nZXJhckhhc2gobnVsbCkpLnRvQmUoJycpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2VyYXJIYXNoKHVuZGVmaW5lZCkpLnRvQmUoJycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndmVyaWZpY2FySGFzaCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSB2ZXJpZmljYXIgY29ycmV0YW1lbnRlIHVtIGhhc2ggdsOhbGlkbycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRleHRvT3JpZ2luYWwgPSAnVGV4dG8gcGFyYSB2ZXJpZmljYXIgaGFzaCc7XG4gICAgICBjb25zdCBoYXNoID0gc2VydmljZS5nZXJhckhhc2godGV4dG9PcmlnaW5hbCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdGFkbyA9IHNlcnZpY2UudmVyaWZpY2FySGFzaCh0ZXh0b09yaWdpbmFsLCBoYXNoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdGFkbykudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJlamVpdGFyIHVtIGhhc2ggaW52w6FsaWRvJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGV4dG9PcmlnaW5hbCA9ICdUZXh0byBwYXJhIHZlcmlmaWNhciBoYXNoJztcbiAgICAgIGNvbnN0IGhhc2hJbnZhbGlkbyA9ICdoYXNoLWludmFsaWRvJztcblxuICAgICAgY29uc3QgcmVzdWx0YWRvID0gc2VydmljZS52ZXJpZmljYXJIYXNoKHRleHRvT3JpZ2luYWwsIGhhc2hJbnZhbGlkbyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHRhZG8pLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVqZWl0YXIgcXVhbmRvIG8gdGV4dG8gw6kgZGlmZXJlbnRlIGRvIG9yaWdpbmFsJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGV4dG9PcmlnaW5hbCA9ICdUZXh0byBwYXJhIHZlcmlmaWNhciBoYXNoJztcbiAgICAgIGNvbnN0IGhhc2ggPSBzZXJ2aWNlLmdlcmFySGFzaCh0ZXh0b09yaWdpbmFsKTtcblxuICAgICAgY29uc3QgcmVzdWx0YWRvID0gc2VydmljZS52ZXJpZmljYXJIYXNoKCdUZXh0byBkaWZlcmVudGUnLCBoYXNoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdGFkbykudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=