d39b646fd9747e55376960edd680899d
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var DeterminacaoJudicialConsolidadoService_1;
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DeterminacaoJudicialConsolidadoService = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const determinacao_judicial_entity_1 = require("../../../entities/determinacao-judicial.entity");
const processo_judicial_service_1 = require("./processo-judicial.service");
const solicitacao_entity_1 = require("../../../entities/solicitacao.entity");
/**
 * Serviço consolidado para gerenciamento de determinações judiciais
 *
 * Este serviço unifica as funcionalidades dos módulos judicial e solicitação,
 * mantendo a separação de responsabilidades através de métodos específicos.
 *
 * Funcionalidades:
 * - Gestão completa de determinações judiciais (CRUD)
 * - Integração com processos judiciais
 * - Integração com solicitações de benefício
 * - Controle de prazos e vencimentos
 * - Transações atômicas para operações complexas
 * - Soft delete e hard delete conforme contexto
 */
let DeterminacaoJudicialConsolidadoService = DeterminacaoJudicialConsolidadoService_1 = class DeterminacaoJudicialConsolidadoService {
    determinacaoRepository;
    solicitacaoRepository;
    processoJudicialService;
    dataSource;
    logger = new common_1.Logger(DeterminacaoJudicialConsolidadoService_1.name);
    constructor(determinacaoRepository, solicitacaoRepository, processoJudicialService, dataSource) {
        this.determinacaoRepository = determinacaoRepository;
        this.solicitacaoRepository = solicitacaoRepository;
        this.processoJudicialService = processoJudicialService;
        this.dataSource = dataSource;
    }
    // ========================================
    // MÉTODOS PRINCIPAIS (CONTEXTO JUDICIAL)
    // ========================================
    /**
     * Cria uma nova determinação judicial no contexto judicial
     *
     * @param data Dados da determinação judicial a ser criada
     * @param usuarioId ID do usuário que está criando a determinação
     * @returns A determinação judicial criada
     */
    async create(data, usuarioId) {
        this.logger.log(`Criando determinação judicial: ${JSON.stringify(data)}`);
        // Verificar se o processo judicial existe e se o ID foi fornecido
        if (!data.processo_judicial_id) {
            throw new common_1.BadRequestException('ID do processo judicial é obrigatório');
        }
        await this.processoJudicialService.findById(data.processo_judicial_id);
        // Criar a nova determinação
        const novaDeterminacao = this.determinacaoRepository.create({
            ...data,
            usuario_id: usuarioId,
            created_by: usuarioId,
            updated_by: usuarioId,
        });
        return this.determinacaoRepository.save(novaDeterminacao);
    }
    /**
     * Busca uma determinação judicial pelo ID
     *
     * @param id ID da determinação judicial
     * @param includeRelations Relações a incluir na busca
     * @returns A determinação judicial encontrada
     * @throws NotFoundException se a determinação não for encontrada
     */
    async findById(id, includeRelations = ['processo_judicial']) {
        const determinacao = await this.determinacaoRepository.findOne({
            where: { id },
            relations: includeRelations,
        });
        if (!determinacao) {
            throw new common_1.NotFoundException(`Determinação judicial com ID ${id} não encontrada`);
        }
        return determinacao;
    }
    /**
     * Lista determinações judiciais com paginação e filtros
     *
     * @param options Opções de busca e paginação
     * @returns Lista paginada de determinações judiciais
     */
    async findAll(options) {
        const { page = 1, limit = 10, processoJudicialId, solicitacaoId, cidadaoId, tipo, cumprida, termo, } = options;
        const where = { ativo: true };
        // Aplicar filtros
        if (processoJudicialId) {
            where.processo_judicial_id = processoJudicialId;
        }
        if (solicitacaoId) {
            where.solicitacao_id = solicitacaoId;
        }
        if (cidadaoId) {
            where.cidadao_id = cidadaoId;
        }
        if (tipo) {
            where.tipo = tipo;
        }
        if (cumprida !== undefined) {
            where.cumprida = cumprida;
        }
        const findOptions = {
            where,
            skip: (page - 1) * limit,
            take: limit,
            order: {
                data_determinacao: 'DESC',
            },
            relations: ['processo_judicial'],
        };
        // Aplicar busca por texto, se fornecido
        if (termo) {
            findOptions.where = [
                { ...where, numero_processo: (0, typeorm_2.Like)(`%${termo}%`) },
                { ...where, numero_determinacao: (0, typeorm_2.Like)(`%${termo}%`) },
                { ...where, descricao: (0, typeorm_2.Like)(`%${termo}%`) },
            ];
        }
        const [determinacoes, total] = await this.determinacaoRepository.findAndCount(findOptions);
        return {
            data: determinacoes,
            meta: {
                page,
                limit,
                total,
                totalPages: Math.ceil(total / limit),
            },
        };
    }
    /**
     * Atualiza uma determinação judicial
     *
     * @param id ID da determinação judicial
     * @param data Dados atualizados da determinação
     * @param usuarioId ID do usuário que está atualizando a determinação
     * @returns A determinação judicial atualizada
     * @throws NotFoundException se a determinação não for encontrada
     */
    async update(id, data, usuarioId) {
        const determinacao = await this.findById(id);
        this.logger.log(`Atualizando determinação judicial ${id}: ${JSON.stringify(data)}`);
        // Atualizar os dados da determinação
        this.determinacaoRepository.merge(determinacao, {
            ...data,
            updated_by: usuarioId,
        });
        return this.determinacaoRepository.save(determinacao);
    }
    /**
     * Marca uma determinação judicial como cumprida
     *
     * @param id ID da determinação judicial
     * @param observacao Observação sobre o cumprimento
     * @param usuarioId ID do usuário que está marcando a determinação como cumprida
     * @returns A determinação judicial atualizada
     * @throws NotFoundException se a determinação não for encontrada
     */
    async marcarComoCumprida(id, observacao, usuarioId) {
        const determinacao = await this.findById(id);
        if (determinacao.cumprida) {
            throw new common_1.BadRequestException('Esta determinação judicial já está marcada como cumprida');
        }
        this.logger.log(`Marcando determinação judicial ${id} como cumprida`);
        // Atualizar o status da determinação
        determinacao.cumprida = true;
        determinacao.data_cumprimento = new Date();
        determinacao.observacao_cumprimento = observacao;
        determinacao.updated_by = usuarioId;
        return this.determinacaoRepository.save(determinacao);
    }
    /**
     * Desativa (soft delete) uma determinação judicial
     *
     * @param id ID da determinação judicial
     * @param usuarioId ID do usuário que está desativando a determinação
     * @returns Verdadeiro se a operação foi bem-sucedida
     * @throws NotFoundException se a determinação não for encontrada
     */
    async desativar(id, usuarioId) {
        const determinacao = await this.findById(id);
        this.logger.log(`Desativando determinação judicial ${id}`);
        // Desativar a determinação
        determinacao.ativo = false;
        determinacao.updated_by = usuarioId;
        await this.determinacaoRepository.save(determinacao);
        return true;
    }
    // ========================================
    // MÉTODOS ESPECÍFICOS PARA SOLICITAÇÕES
    // ========================================
    /**
     * Cria uma nova determinação judicial no contexto de solicitação
     *
     * @param createDeterminacaoDto Dados da determinação judicial
     * @param usuarioId ID do usuário que está criando a determinação
     * @returns Determinação judicial criada
     */
    async createForSolicitacao(createDeterminacaoDto, usuarioId) {
        const queryRunner = this.dataSource.createQueryRunner();
        await queryRunner.connect();
        await queryRunner.startTransaction();
        try {
            // Verificar se a solicitação existe
            const solicitacao = await this.solicitacaoRepository.findOne({
                where: { id: createDeterminacaoDto.solicitacao_id },
            });
            if (!solicitacao) {
                throw new common_1.NotFoundException('Solicitação de benefício não encontrada');
            }
            // Verificar se já existe determinação com o mesmo número de processo para a solicitação
            const determinacaoExistente = await this.determinacaoRepository.findOne({
                where: {
                    solicitacao_id: createDeterminacaoDto.solicitacao_id,
                    numero_processo: createDeterminacaoDto.numero_processo,
                },
            });
            if (determinacaoExistente) {
                throw new common_1.ConflictException('Já existe uma determinação judicial com este número de processo para esta solicitação');
            }
            // Criar a determinação judicial
            const novaDeterminacao = this.determinacaoRepository.create({
                ...createDeterminacaoDto,
                usuario_id: usuarioId,
            });
            const determinacaoSalva = await queryRunner.manager.save(novaDeterminacao);
            // Atualizar a solicitação para indicar que possui determinação judicial
            await queryRunner.manager.update(solicitacao_entity_1.Solicitacao, { id: createDeterminacaoDto.solicitacao_id }, {
                determinacao_judicial_flag: true,
                determinacao_judicial_id: determinacaoSalva.id,
            });
            await queryRunner.commitTransaction();
            return determinacaoSalva;
        }
        catch (error) {
            await queryRunner.rollbackTransaction();
            if (error instanceof common_1.NotFoundException ||
                error instanceof common_1.ConflictException) {
                throw error;
            }
            this.logger.error(`Erro ao criar determinação judicial: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao criar determinação judicial');
        }
        finally {
            await queryRunner.release();
        }
    }
    /**
     * Busca todas as determinações judiciais de uma solicitação
     * @param solicitacaoId ID da solicitação
     * @returns Lista de determinações judiciais
     */
    async findBySolicitacaoId(solicitacaoId) {
        try {
            // Verificar se a solicitação existe
            const solicitacao = await this.solicitacaoRepository.findOne({
                where: { id: solicitacaoId },
            });
            if (!solicitacao) {
                throw new common_1.NotFoundException('Solicitação de benefício não encontrada');
            }
            return this.determinacaoRepository.find({
                where: { solicitacao_id: solicitacaoId },
                order: { data_determinacao: 'DESC' },
            });
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            this.logger.error(`Erro ao buscar determinações judiciais: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao buscar determinações judiciais');
        }
    }
    /**
     * Atualiza uma determinação judicial no contexto de solicitação
     * @param id ID da determinação judicial
     * @param updateDeterminacaoDto Dados para atualização
     * @returns Determinação judicial atualizada
     */
    async updateForSolicitacao(id, updateDeterminacaoDto) {
        try {
            // Verificar se a determinação existe
            const determinacao = await this.determinacaoRepository.findOne({
                where: { id },
            });
            if (!determinacao) {
                throw new common_1.NotFoundException('Determinação judicial não encontrada');
            }
            // Atualizar a determinação
            await this.determinacaoRepository.update(id, updateDeterminacaoDto);
            // Retornar a determinação atualizada
            return this.findById(id, ['solicitacao']);
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            this.logger.error(`Erro ao atualizar determinação judicial: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao atualizar determinação judicial');
        }
    }
    /**
     * Registra o cumprimento de uma determinação judicial (alias para marcarComoCumprida)
     * @param id ID da determinação judicial
     * @param observacoes Observações sobre o cumprimento
     * @returns Determinação judicial atualizada
     */
    async registrarCumprimento(id, observacoes) {
        try {
            // Verificar se a determinação existe
            const determinacao = await this.determinacaoRepository.findOne({
                where: { id },
            });
            if (!determinacao) {
                throw new common_1.NotFoundException('Determinação judicial não encontrada');
            }
            // Atualizar a determinação com a data de cumprimento
            const updateData = {
                data_cumprimento: new Date(),
            };
            if (observacoes) {
                updateData.observacao_cumprimento = observacoes;
            }
            await this.determinacaoRepository.update(id, updateData);
            // Retornar a determinação atualizada
            return this.findById(id, ['solicitacao']);
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            this.logger.error(`Erro ao registrar cumprimento de determinação judicial: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao registrar cumprimento de determinação judicial');
        }
    }
    /**
     * Remove uma determinação judicial do contexto de solicitação
     * @param id ID da determinação judicial
     * @returns Void
     */
    async removeFromSolicitacao(id) {
        const queryRunner = this.dataSource.createQueryRunner();
        await queryRunner.connect();
        await queryRunner.startTransaction();
        try {
            // Verificar se a determinação existe
            const determinacao = await this.determinacaoRepository.findOne({
                where: { id },
                relations: ['solicitacao'],
            });
            if (!determinacao) {
                throw new common_1.NotFoundException('Determinação judicial não encontrada');
            }
            // Verificar se é a determinação principal da solicitação
            const solicitacao = await this.solicitacaoRepository.findOne({
                where: { determinacao_judicial_id: id },
            });
            if (solicitacao) {
                // Se for a determinação principal, verificar se há outras determinações
                const outrasDeterminacoes = await this.determinacaoRepository.find({
                    where: { solicitacao_id: determinacao.solicitacao_id },
                });
                if (outrasDeterminacoes.length > 1) {
                    // Se houver outras determinações, definir a mais recente como principal
                    const outrasDeterminacoesOrdenadas = outrasDeterminacoes
                        .filter((det) => det.id !== id)
                        .sort((a, b) => b.data_determinacao.getTime() - a.data_determinacao.getTime());
                    // Atualizar a solicitação com a nova determinação principal
                    await queryRunner.manager.update(solicitacao_entity_1.Solicitacao, { id: determinacao.solicitacao_id }, { determinacao_judicial_id: outrasDeterminacoesOrdenadas[0].id });
                }
                else {
                    // Se não houver outras determinações, remover a referência na solicitação
                    await queryRunner.manager.update(solicitacao_entity_1.Solicitacao, { id: determinacao.solicitacao_id }, {
                        determinacao_judicial_flag: false,
                        determinacao_judicial_id: null,
                    });
                }
            }
            // Remover a determinação
            await queryRunner.manager.remove(determinacao);
            await queryRunner.commitTransaction();
        }
        catch (error) {
            await queryRunner.rollbackTransaction();
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            this.logger.error(`Erro ao remover determinação judicial: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao remover determinação judicial');
        }
        finally {
            await queryRunner.release();
        }
    }
    // ========================================
    // MÉTODOS DE BUSCA ESPECIALIZADOS
    // ========================================
    /**
     * Busca determinações judiciais por processo judicial
     *
     * @param processoJudicialId ID do processo judicial
     * @returns Lista de determinações judiciais
     */
    async findByProcessoJudicial(processoJudicialId) {
        return this.determinacaoRepository.find({
            where: { processo_judicial_id: processoJudicialId, ativo: true },
            order: { data_determinacao: 'DESC' },
        });
    }
    /**
     * Busca determinações judiciais por solicitação
     *
     * @param solicitacaoId ID da solicitação
     * @returns Lista de determinações judiciais
     */
    async findBySolicitacao(solicitacaoId) {
        return this.determinacaoRepository.find({
            where: { solicitacao_id: solicitacaoId, ativo: true },
            order: { data_determinacao: 'DESC' },
            relations: ['processo_judicial'],
        });
    }
    /**
     * Busca determinações judiciais por cidadão
     *
     * @param cidadaoId ID do cidadão
     * @returns Lista de determinações judiciais
     */
    async findByCidadao(cidadaoId) {
        return this.determinacaoRepository.find({
            where: { cidadao_id: cidadaoId, ativo: true },
            order: { data_determinacao: 'DESC' },
            relations: ['processo_judicial'],
        });
    }
    // ========================================
    // MÉTODOS DE GESTÃO DE PRAZOS
    // ========================================
    /**
     * Retorna determinações judiciais com prazo próximo de expirar ou expirado
     *
     * @param diasAviso Número de dias para considerar como prazo próximo
     * @returns Lista de determinações judiciais
     */
    async findDeterminacoesComPrazoProximo(diasAviso = 7) {
        const hoje = new Date();
        const limiteDias = new Date();
        limiteDias.setDate(hoje.getDate() + diasAviso);
        return this.determinacaoRepository.find({
            where: {
                ativo: true,
                cumprida: false,
                data_prazo: (0, typeorm_2.MoreThanOrEqual)(hoje) && (0, typeorm_2.LessThanOrEqual)(limiteDias),
            },
            order: { data_prazo: 'ASC' },
            relations: ['processo_judicial'],
        });
    }
    /**
     * Retorna determinações judiciais com prazo expirado
     *
     * @returns Lista de determinações judiciais
     */
    async findDeterminacoesComPrazoExpirado() {
        const hoje = new Date();
        return this.determinacaoRepository.find({
            where: {
                ativo: true,
                cumprida: false,
                data_prazo: (0, typeorm_2.LessThan)(hoje),
            },
            order: { data_prazo: 'ASC' },
            relations: ['processo_judicial'],
        });
    }
    /**
     * Busca determinações judiciais pendentes de cumprimento
     *
     * @returns Lista de determinações judiciais pendentes
     */
    async findPendentes() {
        return this.determinacaoRepository.find({
            where: {
                ativo: true,
                cumprida: false,
            },
            order: { data_determinacao: 'DESC' },
            relations: ['processo_judicial'],
        });
    }
    /**
     * Alterna o status ativo/inativo de uma determinação judicial
     *
     * @param id ID da determinação judicial
     * @param usuarioId ID do usuário que está alterando o status
     * @returns A determinação judicial atualizada
     * @throws NotFoundException se a determinação não for encontrada
     */
    async toggleAtivo(id, usuarioId) {
        const determinacao = await this.findById(id);
        this.logger.log(`Alternando status ativo da determinação judicial ${id}`);
        // Alternar o status ativo
        determinacao.ativo = !determinacao.ativo;
        determinacao.updated_by = usuarioId;
        return this.determinacaoRepository.save(determinacao);
    }
    /**
     * Remove permanentemente uma determinação judicial
     *
     * @param id ID da determinação judicial
     * @returns Void
     * @throws NotFoundException se a determinação não for encontrada
     */
    async remove(id) {
        const determinacao = await this.findById(id);
        this.logger.log(`Removendo determinação judicial ${id}`);
        await this.determinacaoRepository.remove(determinacao);
    }
};
exports.DeterminacaoJudicialConsolidadoService = DeterminacaoJudicialConsolidadoService;
exports.DeterminacaoJudicialConsolidadoService = DeterminacaoJudicialConsolidadoService = DeterminacaoJudicialConsolidadoService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(determinacao_judicial_entity_1.DeterminacaoJudicial)),
    __param(1, (0, typeorm_1.InjectRepository)(solicitacao_entity_1.Solicitacao)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object, typeof (_c = typeof processo_judicial_service_1.ProcessoJudicialService !== "undefined" && processo_judicial_service_1.ProcessoJudicialService) === "function" ? _c : Object, typeof (_d = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _d : Object])
], DeterminacaoJudicialConsolidadoService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGp1ZGljaWFsXFxzZXJ2aWNlc1xcZGV0ZXJtaW5hY2FvLWp1ZGljaWFsLWNvbnNvbGlkYWRvLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FPd0I7QUFDeEIsNkNBQW1EO0FBQ25ELHFDQVNpQjtBQUNqQixpR0FHd0Q7QUFDeEQsMkVBQXNFO0FBUXRFLDZFQUFtRTtBQUVuRTs7Ozs7Ozs7Ozs7OztHQWFHO0FBRUksSUFBTSxzQ0FBc0MsOENBQTVDLE1BQU0sc0NBQXNDO0lBTzlCO0lBRUE7SUFDQTtJQUNBO0lBVkYsTUFBTSxHQUFHLElBQUksZUFBTSxDQUNsQyx3Q0FBc0MsQ0FBQyxJQUFJLENBQzVDLENBQUM7SUFFRixZQUVtQixzQkFBd0QsRUFFeEQscUJBQThDLEVBQzlDLHVCQUFnRCxFQUNoRCxVQUFzQjtRQUp0QiwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQWtDO1FBRXhELDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBeUI7UUFDOUMsNEJBQXVCLEdBQXZCLHVCQUF1QixDQUF5QjtRQUNoRCxlQUFVLEdBQVYsVUFBVSxDQUFZO0lBQ3RDLENBQUM7SUFFSiwyQ0FBMkM7SUFDM0MseUNBQXlDO0lBQ3pDLDJDQUEyQztJQUUzQzs7Ozs7O09BTUc7SUFDSCxLQUFLLENBQUMsTUFBTSxDQUNWLElBQW1DLEVBQ25DLFNBQWlCO1FBRWpCLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGtDQUFrQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUUxRSxrRUFBa0U7UUFDbEUsSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1lBQy9CLE1BQU0sSUFBSSw0QkFBbUIsQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDO1FBQ3pFLENBQUM7UUFFRCxNQUFNLElB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cyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xcanVkaWNpYWxcXHNlcnZpY2VzXFxkZXRlcm1pbmFjYW8tanVkaWNpYWwtY29uc29saWRhZG8uc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBJbmplY3RhYmxlLFxuICBMb2dnZXIsXG4gIE5vdEZvdW5kRXhjZXB0aW9uLFxuICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxuICBDb25mbGljdEV4Y2VwdGlvbixcbiAgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgSW5qZWN0UmVwb3NpdG9yeSB9IGZyb20gJ0BuZXN0anMvdHlwZW9ybSc7XG5pbXBvcnQge1xuICBSZXBvc2l0b3J5LFxuICBGaW5kT3B0aW9uc1doZXJlLFxuICBGaW5kTWFueU9wdGlvbnMsXG4gIExpa2UsXG4gIExlc3NUaGFuT3JFcXVhbCxcbiAgTW9yZVRoYW5PckVxdWFsLFxuICBMZXNzVGhhbixcbiAgRGF0YVNvdXJjZSxcbn0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQge1xuICBEZXRlcm1pbmFjYW9KdWRpY2lhbCxcbiAgVGlwb0RldGVybWluYWNhb0p1ZGljaWFsLFxufSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy9kZXRlcm1pbmFjYW8tanVkaWNpYWwuZW50aXR5JztcbmltcG9ydCB7IFByb2Nlc3NvSnVkaWNpYWxTZXJ2aWNlIH0gZnJvbSAnLi9wcm9jZXNzby1qdWRpY2lhbC5zZXJ2aWNlJztcbmltcG9ydCB7IFBhZ2luYXRlZFJlc3VsdCB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9pbnRlcmZhY2VzL3BhZ2luYXRlZC1yZXN1bHQuaW50ZXJmYWNlJztcbmltcG9ydCB7XG4gIENyZWF0ZURldGVybWluYWNhb0p1ZGljaWFsRHRvLFxuICBVcGRhdGVEZXRlcm1pbmFjYW9KdWRpY2lhbER0byxcbn0gZnJvbSAnLi4vZHRvcy9kZXRlcm1pbmFjYW8tanVkaWNpYWwuZHRvJztcbmltcG9ydCB7IFNvbGljaXRhY2FvQ3JlYXRlRGV0ZXJtaW5hY2FvSnVkaWNpYWxEdG8gfSBmcm9tICcuLi8uLi9zb2xpY2l0YWNhby9kdG8vY3JlYXRlLWRldGVybWluYWNhby1qdWRpY2lhbC5kdG8nO1xuaW1wb3J0IHsgU29saWNpdGFjYW9VcGRhdGVEZXRlcm1pbmFjYW9KdWRpY2lhbER0byB9IGZyb20gJy4uLy4uL3NvbGljaXRhY2FvL2R0by91cGRhdGUtZGV0ZXJtaW5hY2FvLWp1ZGljaWFsLmR0byc7XG5pbXBvcnQgeyBTb2xpY2l0YWNhbyB9IGZyb20gJy4uLy4uLy4uL2VudGl0aWVzL3NvbGljaXRhY2FvLmVudGl0eSc7XG5cbi8qKlxuICogU2VydmnDp28gY29uc29saWRhZG8gcGFyYSBnZXJlbmNpYW1lbnRvIGRlIGRldGVybWluYcOnw7VlcyBqdWRpY2lhaXNcbiAqXG4gKiBFc3RlIHNlcnZpw6dvIHVuaWZpY2EgYXMgZnVuY2lvbmFsaWRhZGVzIGRvcyBtw7NkdWxvcyBqdWRpY2lhbCBlIHNvbGljaXRhw6fDo28sXG4gKiBtYW50ZW5kbyBhIHNlcGFyYcOnw6NvIGRlIHJlc3BvbnNhYmlsaWRhZGVzIGF0cmF2w6lzIGRlIG3DqXRvZG9zIGVzcGVjw61maWNvcy5cbiAqXG4gKiBGdW5jaW9uYWxpZGFkZXM6XG4gKiAtIEdlc3TDo28gY29tcGxldGEgZGUgZGV0ZXJtaW5hw6fDtWVzIGp1ZGljaWFpcyAoQ1JVRClcbiAqIC0gSW50ZWdyYcOnw6NvIGNvbSBwcm9jZXNzb3MganVkaWNpYWlzXG4gKiAtIEludGVncmHDp8OjbyBjb20gc29saWNpdGHDp8O1ZXMgZGUgYmVuZWbDrWNpb1xuICogLSBDb250cm9sZSBkZSBwcmF6b3MgZSB2ZW5jaW1lbnRvc1xuICogLSBUcmFuc2HDp8O1ZXMgYXTDtG1pY2FzIHBhcmEgb3BlcmHDp8O1ZXMgY29tcGxleGFzXG4gKiAtIFNvZnQgZGVsZXRlIGUgaGFyZCBkZWxldGUgY29uZm9ybWUgY29udGV4dG9cbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIERldGVybWluYWNhb0p1ZGljaWFsQ29uc29saWRhZG9TZXJ2aWNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKFxuICAgIERldGVybWluYWNhb0p1ZGljaWFsQ29uc29saWRhZG9TZXJ2aWNlLm5hbWUsXG4gICk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdFJlcG9zaXRvcnkoRGV0ZXJtaW5hY2FvSnVkaWNpYWwpXG4gICAgcHJpdmF0ZSByZWFkb25seSBkZXRlcm1pbmFjYW9SZXBvc2l0b3J5OiBSZXBvc2l0b3J5PERldGVybWluYWNhb0p1ZGljaWFsPixcbiAgICBASW5qZWN0UmVwb3NpdG9yeShTb2xpY2l0YWNhbylcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNvbGljaXRhY2FvUmVwb3NpdG9yeTogUmVwb3NpdG9yeTxTb2xpY2l0YWNhbz4sXG4gICAgcHJpdmF0ZSByZWFkb25seSBwcm9jZXNzb0p1ZGljaWFsU2VydmljZTogUHJvY2Vzc29KdWRpY2lhbFNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBkYXRhU291cmNlOiBEYXRhU291cmNlLFxuICApIHt9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBNw4lUT0RPUyBQUklOQ0lQQUlTIChDT05URVhUTyBKVURJQ0lBTClcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBDcmlhIHVtYSBub3ZhIGRldGVybWluYcOnw6NvIGp1ZGljaWFsIG5vIGNvbnRleHRvIGp1ZGljaWFsXG4gICAqXG4gICAqIEBwYXJhbSBkYXRhIERhZG9zIGRhIGRldGVybWluYcOnw6NvIGp1ZGljaWFsIGEgc2VyIGNyaWFkYVxuICAgKiBAcGFyYW0gdXN1YXJpb0lkIElEIGRvIHVzdcOhcmlvIHF1ZSBlc3TDoSBjcmlhbmRvIGEgZGV0ZXJtaW5hw6fDo29cbiAgICogQHJldHVybnMgQSBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbCBjcmlhZGFcbiAgICovXG4gIGFzeW5jIGNyZWF0ZShcbiAgICBkYXRhOiBDcmVhdGVEZXRlcm1pbmFjYW9KdWRpY2lhbER0byxcbiAgICB1c3VhcmlvSWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxEZXRlcm1pbmFjYW9KdWRpY2lhbD4ge1xuICAgIHRoaXMubG9nZ2VyLmxvZyhgQ3JpYW5kbyBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbDogJHtKU09OLnN0cmluZ2lmeShkYXRhKX1gKTtcblxuICAgIC8vIFZlcmlmaWNhciBzZSBvIHByb2Nlc3NvIGp1ZGljaWFsIGV4aXN0ZSBlIHNlIG8gSUQgZm9pIGZvcm5lY2lkb1xuICAgIGlmICghZGF0YS5wcm9jZXNzb19qdWRpY2lhbF9pZCkge1xuICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0lEIGRvIHByb2Nlc3NvIGp1ZGljaWFsIMOpIG9icmlnYXTDs3JpbycpO1xuICAgIH1cblxuICAgIGF3YWl0IHRoaXMucHJvY2Vzc29KdWRpY2lhbFNlcnZpY2UuZmluZEJ5SWQoZGF0YS5wcm9jZXNzb19qdWRpY2lhbF9pZCk7XG5cbiAgICAvLyBDcmlhciBhIG5vdmEgZGV0ZXJtaW5hw6fDo29cbiAgICBjb25zdCBub3ZhRGV0ZXJtaW5hY2FvID0gdGhpcy5kZXRlcm1pbmFjYW9SZXBvc2l0b3J5LmNyZWF0ZSh7XG4gICAgICAuLi5kYXRhLFxuICAgICAgdXN1YXJpb19pZDogdXN1YXJpb0lkLFxuICAgICAgY3JlYXRlZF9ieTogdXN1YXJpb0lkLFxuICAgICAgdXBkYXRlZF9ieTogdXN1YXJpb0lkLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuZGV0ZXJtaW5hY2FvUmVwb3NpdG9yeS5zYXZlKG5vdmFEZXRlcm1pbmFjYW8pO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhIHVtYSBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbCBwZWxvIElEXG4gICAqXG4gICAqIEBwYXJhbSBpZCBJRCBkYSBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbFxuICAgKiBAcGFyYW0gaW5jbHVkZVJlbGF0aW9ucyBSZWxhw6fDtWVzIGEgaW5jbHVpciBuYSBidXNjYVxuICAgKiBAcmV0dXJucyBBIGRldGVybWluYcOnw6NvIGp1ZGljaWFsIGVuY29udHJhZGFcbiAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBzZSBhIGRldGVybWluYcOnw6NvIG7Do28gZm9yIGVuY29udHJhZGFcbiAgICovXG4gIGFzeW5jIGZpbmRCeUlkKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgaW5jbHVkZVJlbGF0aW9uczogc3RyaW5nW10gPSBbJ3Byb2Nlc3NvX2p1ZGljaWFsJ10sXG4gICk6IFByb21pc2U8RGV0ZXJtaW5hY2FvSnVkaWNpYWw+IHtcbiAgICBjb25zdCBkZXRlcm1pbmFjYW8gPSBhd2FpdCB0aGlzLmRldGVybWluYWNhb1JlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgcmVsYXRpb25zOiBpbmNsdWRlUmVsYXRpb25zLFxuICAgIH0pO1xuXG4gICAgaWYgKCFkZXRlcm1pbmFjYW8pIHtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihcbiAgICAgICAgYERldGVybWluYcOnw6NvIGp1ZGljaWFsIGNvbSBJRCAke2lkfSBuw6NvIGVuY29udHJhZGFgLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZGV0ZXJtaW5hY2FvO1xuICB9XG5cbiAgLyoqXG4gICAqIExpc3RhIGRldGVybWluYcOnw7VlcyBqdWRpY2lhaXMgY29tIHBhZ2luYcOnw6NvIGUgZmlsdHJvc1xuICAgKlxuICAgKiBAcGFyYW0gb3B0aW9ucyBPcMOnw7VlcyBkZSBidXNjYSBlIHBhZ2luYcOnw6NvXG4gICAqIEByZXR1cm5zIExpc3RhIHBhZ2luYWRhIGRlIGRldGVybWluYcOnw7VlcyBqdWRpY2lhaXNcbiAgICovXG4gIGFzeW5jIGZpbmRBbGwob3B0aW9uczoge1xuICAgIHBhZ2U/OiBudW1iZXI7XG4gICAgbGltaXQ/OiBudW1iZXI7XG4gICAgcHJvY2Vzc29KdWRpY2lhbElkPzogc3RyaW5nO1xuICAgIHNvbGljaXRhY2FvSWQ/OiBzdHJpbmc7XG4gICAgY2lkYWRhb0lkPzogc3RyaW5nO1xuICAgIHRpcG8/OiBUaXBvRGV0ZXJtaW5hY2FvSnVkaWNpYWw7XG4gICAgY3VtcHJpZGE/OiBib29sZWFuO1xuICAgIHRlcm1vPzogc3RyaW5nO1xuICB9KTogUHJvbWlzZTxQYWdpbmF0ZWRSZXN1bHQ8RGV0ZXJtaW5hY2FvSnVkaWNpYWw+PiB7XG4gICAgY29uc3Qge1xuICAgICAgcGFnZSA9IDEsXG4gICAgICBsaW1pdCA9IDEwLFxuICAgICAgcHJvY2Vzc29KdWRpY2lhbElkLFxuICAgICAgc29saWNpdGFjYW9JZCxcbiAgICAgIGNpZGFkYW9JZCxcbiAgICAgIHRpcG8sXG4gICAgICBjdW1wcmlkYSxcbiAgICAgIHRlcm1vLFxuICAgIH0gPSBvcHRpb25zO1xuXG4gICAgY29uc3Qgd2hlcmU6IEZpbmRPcHRpb25zV2hlcmU8RGV0ZXJtaW5hY2FvSnVkaWNpYWw+ID0geyBhdGl2bzogdHJ1ZSB9O1xuXG4gICAgLy8gQXBsaWNhciBmaWx0cm9zXG4gICAgaWYgKHByb2Nlc3NvSnVkaWNpYWxJZCkge1xuICAgICAgd2hlcmUucHJvY2Vzc29fanVkaWNpYWxfaWQgPSBwcm9jZXNzb0p1ZGljaWFsSWQ7XG4gICAgfVxuXG4gICAgaWYgKHNvbGljaXRhY2FvSWQpIHtcbiAgICAgIHdoZXJlLnNvbGljaXRhY2FvX2lkID0gc29saWNpdGFjYW9JZDtcbiAgICB9XG5cbiAgICBpZiAoY2lkYWRhb0lkKSB7XG4gICAgICB3aGVyZS5jaWRhZGFvX2lkID0gY2lkYWRhb0lkO1xuICAgIH1cblxuICAgIGlmICh0aXBvKSB7XG4gICAgICB3aGVyZS50aXBvID0gdGlwbztcbiAgICB9XG5cbiAgICBpZiAoY3VtcHJpZGEgIT09IHVuZGVmaW5lZCkge1xuICAgICAgd2hlcmUuY3VtcHJpZGEgPSBjdW1wcmlkYTtcbiAgICB9XG5cbiAgICBjb25zdCBmaW5kT3B0aW9uczogRmluZE1hbnlPcHRpb25zPERldGVybWluYWNhb0p1ZGljaWFsPiA9IHtcbiAgICAgIHdoZXJlLFxuICAgICAgc2tpcDogKHBhZ2UgLSAxKSAqIGxpbWl0LFxuICAgICAgdGFrZTogbGltaXQsXG4gICAgICBvcmRlcjoge1xuICAgICAgICBkYXRhX2RldGVybWluYWNhbzogJ0RFU0MnLFxuICAgICAgfSxcbiAgICAgIHJlbGF0aW9uczogWydwcm9jZXNzb19qdWRpY2lhbCddLFxuICAgIH07XG5cbiAgICAvLyBBcGxpY2FyIGJ1c2NhIHBvciB0ZXh0bywgc2UgZm9ybmVjaWRvXG4gICAgaWYgKHRlcm1vKSB7XG4gICAgICBmaW5kT3B0aW9ucy53aGVyZSA9IFtcbiAgICAgICAgeyAuLi53aGVyZSwgbnVtZXJvX3Byb2Nlc3NvOiBMaWtlKGAlJHt0ZXJtb30lYCkgfSxcbiAgICAgICAgeyAuLi53aGVyZSwgbnVtZXJvX2RldGVybWluYWNhbzogTGlrZShgJSR7dGVybW99JWApIH0sXG4gICAgICAgIHsgLi4ud2hlcmUsIGRlc2NyaWNhbzogTGlrZShgJSR7dGVybW99JWApIH0sXG4gICAgICBdO1xuICAgIH1cblxuICAgIGNvbnN0IFtkZXRlcm1pbmFjb2VzLCB0b3RhbF0gPVxuICAgICAgYXdhaXQgdGhpcy5kZXRlcm1pbmFjYW9SZXBvc2l0b3J5LmZpbmRBbmRDb3VudChmaW5kT3B0aW9ucyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGF0YTogZGV0ZXJtaW5hY29lcyxcbiAgICAgIG1ldGE6IHtcbiAgICAgICAgcGFnZSxcbiAgICAgICAgbGltaXQsXG4gICAgICAgIHRvdGFsLFxuICAgICAgICB0b3RhbFBhZ2VzOiBNYXRoLmNlaWwodG90YWwgLyBsaW1pdCksXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQXR1YWxpemEgdW1hIGRldGVybWluYcOnw6NvIGp1ZGljaWFsXG4gICAqXG4gICAqIEBwYXJhbSBpZCBJRCBkYSBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbFxuICAgKiBAcGFyYW0gZGF0YSBEYWRvcyBhdHVhbGl6YWRvcyBkYSBkZXRlcm1pbmHDp8Ojb1xuICAgKiBAcGFyYW0gdXN1YXJpb0lkIElEIGRvIHVzdcOhcmlvIHF1ZSBlc3TDoSBhdHVhbGl6YW5kbyBhIGRldGVybWluYcOnw6NvXG4gICAqIEByZXR1cm5zIEEgZGV0ZXJtaW5hw6fDo28ganVkaWNpYWwgYXR1YWxpemFkYVxuICAgKiBAdGhyb3dzIE5vdEZvdW5kRXhjZXB0aW9uIHNlIGEgZGV0ZXJtaW5hw6fDo28gbsOjbyBmb3IgZW5jb250cmFkYVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgZGF0YTogVXBkYXRlRGV0ZXJtaW5hY2FvSnVkaWNpYWxEdG8sXG4gICAgdXN1YXJpb0lkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8RGV0ZXJtaW5hY2FvSnVkaWNpYWw+IHtcbiAgICBjb25zdCBkZXRlcm1pbmFjYW8gPSBhd2FpdCB0aGlzLmZpbmRCeUlkKGlkKTtcblxuICAgIHRoaXMubG9nZ2VyLmxvZyhcbiAgICAgIGBBdHVhbGl6YW5kbyBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbCAke2lkfTogJHtKU09OLnN0cmluZ2lmeShkYXRhKX1gLFxuICAgICk7XG5cbiAgICAvLyBBdHVhbGl6YXIgb3MgZGFkb3MgZGEgZGV0ZXJtaW5hw6fDo29cbiAgICB0aGlzLmRldGVybWluYWNhb1JlcG9zaXRvcnkubWVyZ2UoZGV0ZXJtaW5hY2FvLCB7XG4gICAgICAuLi5kYXRhLFxuICAgICAgdXBkYXRlZF9ieTogdXN1YXJpb0lkLFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuZGV0ZXJtaW5hY2FvUmVwb3NpdG9yeS5zYXZlKGRldGVybWluYWNhbyk7XG4gIH1cblxuICAvKipcbiAgICogTWFyY2EgdW1hIGRldGVybWluYcOnw6NvIGp1ZGljaWFsIGNvbW8gY3VtcHJpZGFcbiAgICpcbiAgICogQHBhcmFtIGlkIElEIGRhIGRldGVybWluYcOnw6NvIGp1ZGljaWFsXG4gICAqIEBwYXJhbSBvYnNlcnZhY2FvIE9ic2VydmHDp8OjbyBzb2JyZSBvIGN1bXByaW1lbnRvXG4gICAqIEBwYXJhbSB1c3VhcmlvSWQgSUQgZG8gdXN1w6FyaW8gcXVlIGVzdMOhIG1hcmNhbmRvIGEgZGV0ZXJtaW5hw6fDo28gY29tbyBjdW1wcmlkYVxuICAgKiBAcmV0dXJucyBBIGRldGVybWluYcOnw6NvIGp1ZGljaWFsIGF0dWFsaXphZGFcbiAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBzZSBhIGRldGVybWluYcOnw6NvIG7Do28gZm9yIGVuY29udHJhZGFcbiAgICovXG4gIGFzeW5jIG1hcmNhckNvbW9DdW1wcmlkYShcbiAgICBpZDogc3RyaW5nLFxuICAgIG9ic2VydmFjYW86IHN0cmluZyxcbiAgICB1c3VhcmlvSWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxEZXRlcm1pbmFjYW9KdWRpY2lhbD4ge1xuICAgIGNvbnN0IGRldGVybWluYWNhbyA9IGF3YWl0IHRoaXMuZmluZEJ5SWQoaWQpO1xuXG4gICAgaWYgKGRldGVybWluYWNhby5jdW1wcmlkYSkge1xuICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oXG4gICAgICAgICdFc3RhIGRldGVybWluYcOnw6NvIGp1ZGljaWFsIGrDoSBlc3TDoSBtYXJjYWRhIGNvbW8gY3VtcHJpZGEnLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aGlzLmxvZ2dlci5sb2coYE1hcmNhbmRvIGRldGVybWluYcOnw6NvIGp1ZGljaWFsICR7aWR9IGNvbW8gY3VtcHJpZGFgKTtcblxuICAgIC8vIEF0dWFsaXphciBvIHN0YXR1cyBkYSBkZXRlcm1pbmHDp8Ojb1xuICAgIGRldGVybWluYWNhby5jdW1wcmlkYSA9IHRydWU7XG4gICAgZGV0ZXJtaW5hY2FvLmRhdGFfY3VtcHJpbWVudG8gPSBuZXcgRGF0ZSgpO1xuICAgIGRldGVybWluYWNhby5vYnNlcnZhY2FvX2N1bXByaW1lbnRvID0gb2JzZXJ2YWNhbztcbiAgICBkZXRlcm1pbmFjYW8udXBkYXRlZF9ieSA9IHVzdWFyaW9JZDtcblxuICAgIHJldHVybiB0aGlzLmRldGVybWluYWNhb1JlcG9zaXRvcnkuc2F2ZShkZXRlcm1pbmFjYW8pO1xuICB9XG5cbiAgLyoqXG4gICAqIERlc2F0aXZhIChzb2Z0IGRlbGV0ZSkgdW1hIGRldGVybWluYcOnw6NvIGp1ZGljaWFsXG4gICAqXG4gICAqIEBwYXJhbSBpZCBJRCBkYSBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbFxuICAgKiBAcGFyYW0gdXN1YXJpb0lkIElEIGRvIHVzdcOhcmlvIHF1ZSBlc3TDoSBkZXNhdGl2YW5kbyBhIGRldGVybWluYcOnw6NvXG4gICAqIEByZXR1cm5zIFZlcmRhZGVpcm8gc2UgYSBvcGVyYcOnw6NvIGZvaSBiZW0tc3VjZWRpZGFcbiAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBzZSBhIGRldGVybWluYcOnw6NvIG7Do28gZm9yIGVuY29udHJhZGFcbiAgICovXG4gIGFzeW5jIGRlc2F0aXZhcihpZDogc3RyaW5nLCB1c3VhcmlvSWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IGRldGVybWluYWNhbyA9IGF3YWl0IHRoaXMuZmluZEJ5SWQoaWQpO1xuXG4gICAgdGhpcy5sb2dnZXIubG9nKGBEZXNhdGl2YW5kbyBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbCAke2lkfWApO1xuXG4gICAgLy8gRGVzYXRpdmFyIGEgZGV0ZXJtaW5hw6fDo29cbiAgICBkZXRlcm1pbmFjYW8uYXRpdm8gPSBmYWxzZTtcbiAgICBkZXRlcm1pbmFjYW8udXBkYXRlZF9ieSA9IHVzdWFyaW9JZDtcblxuICAgIGF3YWl0IHRoaXMuZGV0ZXJtaW5hY2FvUmVwb3NpdG9yeS5zYXZlKGRldGVybWluYWNhbyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIE3DiVRPRE9TIEVTUEVDw41GSUNPUyBQQVJBIFNPTElDSVRBw4fDlUVTXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogQ3JpYSB1bWEgbm92YSBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbCBubyBjb250ZXh0byBkZSBzb2xpY2l0YcOnw6NvXG4gICAqXG4gICAqIEBwYXJhbSBjcmVhdGVEZXRlcm1pbmFjYW9EdG8gRGFkb3MgZGEgZGV0ZXJtaW5hw6fDo28ganVkaWNpYWxcbiAgICogQHBhcmFtIHVzdWFyaW9JZCBJRCBkbyB1c3XDoXJpbyBxdWUgZXN0w6EgY3JpYW5kbyBhIGRldGVybWluYcOnw6NvXG4gICAqIEByZXR1cm5zIERldGVybWluYcOnw6NvIGp1ZGljaWFsIGNyaWFkYVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlRm9yU29saWNpdGFjYW8oXG4gICAgY3JlYXRlRGV0ZXJtaW5hY2FvRHRvOiBTb2xpY2l0YWNhb0NyZWF0ZURldGVybWluYWNhb0p1ZGljaWFsRHRvLFxuICAgIHVzdWFyaW9JZDogc3RyaW5nLFxuICApOiBQcm9taXNlPERldGVybWluYWNhb0p1ZGljaWFsPiB7XG4gICAgY29uc3QgcXVlcnlSdW5uZXIgPSB0aGlzLmRhdGFTb3VyY2UuY3JlYXRlUXVlcnlSdW5uZXIoKTtcbiAgICBhd2FpdCBxdWVyeVJ1bm5lci5jb25uZWN0KCk7XG4gICAgYXdhaXQgcXVlcnlSdW5uZXIuc3RhcnRUcmFuc2FjdGlvbigpO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFZlcmlmaWNhciBzZSBhIHNvbGljaXRhw6fDo28gZXhpc3RlXG4gICAgICBjb25zdCBzb2xpY2l0YWNhbyA9IGF3YWl0IHRoaXMuc29saWNpdGFjYW9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZTogeyBpZDogY3JlYXRlRGV0ZXJtaW5hY2FvRHRvLnNvbGljaXRhY2FvX2lkIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFzb2xpY2l0YWNhbykge1xuICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ1NvbGljaXRhw6fDo28gZGUgYmVuZWbDrWNpbyBuw6NvIGVuY29udHJhZGEnKTtcbiAgICAgIH1cblxuICAgICAgLy8gVmVyaWZpY2FyIHNlIGrDoSBleGlzdGUgZGV0ZXJtaW5hw6fDo28gY29tIG8gbWVzbW8gbsO6bWVybyBkZSBwcm9jZXNzbyBwYXJhIGEgc29saWNpdGHDp8Ojb1xuICAgICAgY29uc3QgZGV0ZXJtaW5hY2FvRXhpc3RlbnRlID0gYXdhaXQgdGhpcy5kZXRlcm1pbmFjYW9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIHNvbGljaXRhY2FvX2lkOiBjcmVhdGVEZXRlcm1pbmFjYW9EdG8uc29saWNpdGFjYW9faWQsXG4gICAgICAgICAgbnVtZXJvX3Byb2Nlc3NvOiBjcmVhdGVEZXRlcm1pbmFjYW9EdG8ubnVtZXJvX3Byb2Nlc3NvLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChkZXRlcm1pbmFjYW9FeGlzdGVudGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IENvbmZsaWN0RXhjZXB0aW9uKFxuICAgICAgICAgICdKw6EgZXhpc3RlIHVtYSBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbCBjb20gZXN0ZSBuw7ptZXJvIGRlIHByb2Nlc3NvIHBhcmEgZXN0YSBzb2xpY2l0YcOnw6NvJyxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JpYXIgYSBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbFxuICAgICAgY29uc3Qgbm92YURldGVybWluYWNhbyA9IHRoaXMuZGV0ZXJtaW5hY2FvUmVwb3NpdG9yeS5jcmVhdGUoe1xuICAgICAgICAuLi5jcmVhdGVEZXRlcm1pbmFjYW9EdG8sXG4gICAgICAgIHVzdWFyaW9faWQ6IHVzdWFyaW9JZCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBkZXRlcm1pbmFjYW9TYWx2YSA9XG4gICAgICAgIGF3YWl0IHF1ZXJ5UnVubmVyLm1hbmFnZXIuc2F2ZShub3ZhRGV0ZXJtaW5hY2FvKTtcblxuICAgICAgLy8gQXR1YWxpemFyIGEgc29saWNpdGHDp8OjbyBwYXJhIGluZGljYXIgcXVlIHBvc3N1aSBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbFxuICAgICAgYXdhaXQgcXVlcnlSdW5uZXIubWFuYWdlci51cGRhdGUoXG4gICAgICAgIFNvbGljaXRhY2FvLFxuICAgICAgICB7IGlkOiBjcmVhdGVEZXRlcm1pbmFjYW9EdG8uc29saWNpdGFjYW9faWQgfSxcbiAgICAgICAge1xuICAgICAgICAgIGRldGVybWluYWNhb19qdWRpY2lhbF9mbGFnOiB0cnVlLFxuICAgICAgICAgIGRldGVybWluYWNhb19qdWRpY2lhbF9pZDogZGV0ZXJtaW5hY2FvU2FsdmEuaWQsXG4gICAgICAgIH0sXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBxdWVyeVJ1bm5lci5jb21taXRUcmFuc2FjdGlvbigpO1xuXG4gICAgICByZXR1cm4gZGV0ZXJtaW5hY2FvU2FsdmE7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGF3YWl0IHF1ZXJ5UnVubmVyLnJvbGxiYWNrVHJhbnNhY3Rpb24oKTtcblxuICAgICAgaWYgKFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIE5vdEZvdW5kRXhjZXB0aW9uIHx8XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgQ29uZmxpY3RFeGNlcHRpb25cbiAgICAgICkge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvIGFvIGNyaWFyIGRldGVybWluYcOnw6NvIGp1ZGljaWFsOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgZXJyb3Iuc3RhY2ssXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgICdFcnJvIGFvIGNyaWFyIGRldGVybWluYcOnw6NvIGp1ZGljaWFsJyxcbiAgICAgICk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGF3YWl0IHF1ZXJ5UnVubmVyLnJlbGVhc2UoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQnVzY2EgdG9kYXMgYXMgZGV0ZXJtaW5hw6fDtWVzIGp1ZGljaWFpcyBkZSB1bWEgc29saWNpdGHDp8Ojb1xuICAgKiBAcGFyYW0gc29saWNpdGFjYW9JZCBJRCBkYSBzb2xpY2l0YcOnw6NvXG4gICAqIEByZXR1cm5zIExpc3RhIGRlIGRldGVybWluYcOnw7VlcyBqdWRpY2lhaXNcbiAgICovXG4gIGFzeW5jIGZpbmRCeVNvbGljaXRhY2FvSWQoXG4gICAgc29saWNpdGFjYW9JZDogc3RyaW5nLFxuICApOiBQcm9taXNlPERldGVybWluYWNhb0p1ZGljaWFsW10+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVmVyaWZpY2FyIHNlIGEgc29saWNpdGHDp8OjbyBleGlzdGVcbiAgICAgIGNvbnN0IHNvbGljaXRhY2FvID0gYXdhaXQgdGhpcy5zb2xpY2l0YWNhb1JlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBzb2xpY2l0YWNhb0lkIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFzb2xpY2l0YWNhbykge1xuICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ1NvbGljaXRhw6fDo28gZGUgYmVuZWbDrWNpbyBuw6NvIGVuY29udHJhZGEnKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuZGV0ZXJtaW5hY2FvUmVwb3NpdG9yeS5maW5kKHtcbiAgICAgICAgd2hlcmU6IHsgc29saWNpdGFjYW9faWQ6IHNvbGljaXRhY2FvSWQgfSxcbiAgICAgICAgb3JkZXI6IHsgZGF0YV9kZXRlcm1pbmFjYW86ICdERVNDJyB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIE5vdEZvdW5kRXhjZXB0aW9uKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gYnVzY2FyIGRldGVybWluYcOnw7VlcyBqdWRpY2lhaXM6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICBlcnJvci5zdGFjayxcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgJ0Vycm8gYW8gYnVzY2FyIGRldGVybWluYcOnw7VlcyBqdWRpY2lhaXMnLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQXR1YWxpemEgdW1hIGRldGVybWluYcOnw6NvIGp1ZGljaWFsIG5vIGNvbnRleHRvIGRlIHNvbGljaXRhw6fDo29cbiAgICogQHBhcmFtIGlkIElEIGRhIGRldGVybWluYcOnw6NvIGp1ZGljaWFsXG4gICAqIEBwYXJhbSB1cGRhdGVEZXRlcm1pbmFjYW9EdG8gRGFkb3MgcGFyYSBhdHVhbGl6YcOnw6NvXG4gICAqIEByZXR1cm5zIERldGVybWluYcOnw6NvIGp1ZGljaWFsIGF0dWFsaXphZGFcbiAgICovXG4gIGFzeW5jIHVwZGF0ZUZvclNvbGljaXRhY2FvKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgdXBkYXRlRGV0ZXJtaW5hY2FvRHRvOiBTb2xpY2l0YWNhb1VwZGF0ZURldGVybWluYWNhb0p1ZGljaWFsRHRvLFxuICApOiBQcm9taXNlPERldGVybWluYWNhb0p1ZGljaWFsPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFZlcmlmaWNhciBzZSBhIGRldGVybWluYcOnw6NvIGV4aXN0ZVxuICAgICAgY29uc3QgZGV0ZXJtaW5hY2FvID0gYXdhaXQgdGhpcy5kZXRlcm1pbmFjYW9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghZGV0ZXJtaW5hY2FvKSB7XG4gICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignRGV0ZXJtaW5hw6fDo28ganVkaWNpYWwgbsOjbyBlbmNvbnRyYWRhJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEF0dWFsaXphciBhIGRldGVybWluYcOnw6NvXG4gICAgICBhd2FpdCB0aGlzLmRldGVybWluYWNhb1JlcG9zaXRvcnkudXBkYXRlKGlkLCB1cGRhdGVEZXRlcm1pbmFjYW9EdG8pO1xuXG4gICAgICAvLyBSZXRvcm5hciBhIGRldGVybWluYcOnw6NvIGF0dWFsaXphZGFcbiAgICAgIHJldHVybiB0aGlzLmZpbmRCeUlkKGlkLCBbJ3NvbGljaXRhY2FvJ10pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvIGFvIGF0dWFsaXphciBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbDogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICAgIGVycm9yLnN0YWNrLFxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICAnRXJybyBhbyBhdHVhbGl6YXIgZGV0ZXJtaW5hw6fDo28ganVkaWNpYWwnLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0cmEgbyBjdW1wcmltZW50byBkZSB1bWEgZGV0ZXJtaW5hw6fDo28ganVkaWNpYWwgKGFsaWFzIHBhcmEgbWFyY2FyQ29tb0N1bXByaWRhKVxuICAgKiBAcGFyYW0gaWQgSUQgZGEgZGV0ZXJtaW5hw6fDo28ganVkaWNpYWxcbiAgICogQHBhcmFtIG9ic2VydmFjb2VzIE9ic2VydmHDp8O1ZXMgc29icmUgbyBjdW1wcmltZW50b1xuICAgKiBAcmV0dXJucyBEZXRlcm1pbmHDp8OjbyBqdWRpY2lhbCBhdHVhbGl6YWRhXG4gICAqL1xuICBhc3luYyByZWdpc3RyYXJDdW1wcmltZW50byhcbiAgICBpZDogc3RyaW5nLFxuICAgIG9ic2VydmFjb2VzPzogc3RyaW5nLFxuICApOiBQcm9taXNlPERldGVybWluYWNhb0p1ZGljaWFsPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFZlcmlmaWNhciBzZSBhIGRldGVybWluYcOnw6NvIGV4aXN0ZVxuICAgICAgY29uc3QgZGV0ZXJtaW5hY2FvID0gYXdhaXQgdGhpcy5kZXRlcm1pbmFjYW9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghZGV0ZXJtaW5hY2FvKSB7XG4gICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignRGV0ZXJtaW5hw6fDo28ganVkaWNpYWwgbsOjbyBlbmNvbnRyYWRhJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEF0dWFsaXphciBhIGRldGVybWluYcOnw6NvIGNvbSBhIGRhdGEgZGUgY3VtcHJpbWVudG9cbiAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IFBhcnRpYWw8RGV0ZXJtaW5hY2FvSnVkaWNpYWw+ID0ge1xuICAgICAgICBkYXRhX2N1bXByaW1lbnRvOiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgaWYgKG9ic2VydmFjb2VzKSB7XG4gICAgICAgIHVwZGF0ZURhdGEub2JzZXJ2YWNhb19jdW1wcmltZW50byA9IG9ic2VydmFjb2VzO1xuICAgICAgfVxuXG4gICAgICBhd2FpdCB0aGlzLmRldGVybWluYWNhb1JlcG9zaXRvcnkudXBkYXRlKGlkLCB1cGRhdGVEYXRhKTtcblxuICAgICAgLy8gUmV0b3JuYXIgYSBkZXRlcm1pbmHDp8OjbyBhdHVhbGl6YWRhXG4gICAgICByZXR1cm4gdGhpcy5maW5kQnlJZChpZCwgWydzb2xpY2l0YWNhbyddKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgTm90Rm91bmRFeGNlcHRpb24pIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJybyBhbyByZWdpc3RyYXIgY3VtcHJpbWVudG8gZGUgZGV0ZXJtaW5hw6fDo28ganVkaWNpYWw6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICBlcnJvci5zdGFjayxcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgJ0Vycm8gYW8gcmVnaXN0cmFyIGN1bXByaW1lbnRvIGRlIGRldGVybWluYcOnw6NvIGp1ZGljaWFsJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSB1bWEgZGV0ZXJtaW5hw6fDo28ganVkaWNpYWwgZG8gY29udGV4dG8gZGUgc29saWNpdGHDp8Ojb1xuICAgKiBAcGFyYW0gaWQgSUQgZGEgZGV0ZXJtaW5hw6fDo28ganVkaWNpYWxcbiAgICogQHJldHVybnMgVm9pZFxuICAgKi9cbiAgYXN5bmMgcmVtb3ZlRnJvbVNvbGljaXRhY2FvKGlkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBxdWVyeVJ1bm5lciA9IHRoaXMuZGF0YVNvdXJjZS5jcmVhdGVRdWVyeVJ1bm5lcigpO1xuICAgIGF3YWl0IHF1ZXJ5UnVubmVyLmNvbm5lY3QoKTtcbiAgICBhd2FpdCBxdWVyeVJ1bm5lci5zdGFydFRyYW5zYWN0aW9uKCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gVmVyaWZpY2FyIHNlIGEgZGV0ZXJtaW5hw6fDo28gZXhpc3RlXG4gICAgICBjb25zdCBkZXRlcm1pbmFjYW8gPSBhd2FpdCB0aGlzLmRldGVybWluYWNhb1JlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH0sXG4gICAgICAgIHJlbGF0aW9uczogWydzb2xpY2l0YWNhbyddLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghZGV0ZXJtaW5hY2FvKSB7XG4gICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignRGV0ZXJtaW5hw6fDo28ganVkaWNpYWwgbsOjbyBlbmNvbnRyYWRhJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZlcmlmaWNhciBzZSDDqSBhIGRldGVybWluYcOnw6NvIHByaW5jaXBhbCBkYSBzb2xpY2l0YcOnw6NvXG4gICAgICBjb25zdCBzb2xpY2l0YWNhbyA9IGF3YWl0IHRoaXMuc29saWNpdGFjYW9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZTogeyBkZXRlcm1pbmFjYW9fanVkaWNpYWxfaWQ6IGlkIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKHNvbGljaXRhY2FvKSB7XG4gICAgICAgIC8vIFNlIGZvciBhIGRldGVybWluYcOnw6NvIHByaW5jaXBhbCwgdmVyaWZpY2FyIHNlIGjDoSBvdXRyYXMgZGV0ZXJtaW5hw6fDtWVzXG4gICAgICAgIGNvbnN0IG91dHJhc0RldGVybWluYWNvZXMgPSBhd2FpdCB0aGlzLmRldGVybWluYWNhb1JlcG9zaXRvcnkuZmluZCh7XG4gICAgICAgICAgd2hlcmU6IHsgc29saWNpdGFjYW9faWQ6IGRldGVybWluYWNhby5zb2xpY2l0YWNhb19pZCB9LFxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAob3V0cmFzRGV0ZXJtaW5hY29lcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgLy8gU2UgaG91dmVyIG91dHJhcyBkZXRlcm1pbmHDp8O1ZXMsIGRlZmluaXIgYSBtYWlzIHJlY2VudGUgY29tbyBwcmluY2lwYWxcbiAgICAgICAgICBjb25zdCBvdXRyYXNEZXRlcm1pbmFjb2VzT3JkZW5hZGFzID0gb3V0cmFzRGV0ZXJtaW5hY29lc1xuICAgICAgICAgICAgLmZpbHRlcigoZGV0KSA9PiBkZXQuaWQgIT09IGlkKVxuICAgICAgICAgICAgLnNvcnQoXG4gICAgICAgICAgICAgIChhLCBiKSA9PlxuICAgICAgICAgICAgICAgIGIuZGF0YV9kZXRlcm1pbmFjYW8uZ2V0VGltZSgpIC0gYS5kYXRhX2RldGVybWluYWNhby5nZXRUaW1lKCksXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gQXR1YWxpemFyIGEgc29saWNpdGHDp8OjbyBjb20gYSBub3ZhIGRldGVybWluYcOnw6NvIHByaW5jaXBhbFxuICAgICAgICAgIGF3YWl0IHF1ZXJ5UnVubmVyLm1hbmFnZXIudXBkYXRlKFxuICAgICAgICAgICAgU29saWNpdGFjYW8sXG4gICAgICAgICAgICB7IGlkOiBkZXRlcm1pbmFjYW8uc29saWNpdGFjYW9faWQgfSxcbiAgICAgICAgICAgIHsgZGV0ZXJtaW5hY2FvX2p1ZGljaWFsX2lkOiBvdXRyYXNEZXRlcm1pbmFjb2VzT3JkZW5hZGFzWzBdLmlkIH0sXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBTZSBuw6NvIGhvdXZlciBvdXRyYXMgZGV0ZXJtaW5hw6fDtWVzLCByZW1vdmVyIGEgcmVmZXLDqm5jaWEgbmEgc29saWNpdGHDp8Ojb1xuICAgICAgICAgIGF3YWl0IHF1ZXJ5UnVubmVyLm1hbmFnZXIudXBkYXRlKFxuICAgICAgICAgICAgU29saWNpdGFjYW8sXG4gICAgICAgICAgICB7IGlkOiBkZXRlcm1pbmFjYW8uc29saWNpdGFjYW9faWQgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZGV0ZXJtaW5hY2FvX2p1ZGljaWFsX2ZsYWc6IGZhbHNlLFxuICAgICAgICAgICAgICBkZXRlcm1pbmFjYW9fanVkaWNpYWxfaWQ6IG51bGwgYXMgdW5rbm93biBhcyBzdHJpbmcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gUmVtb3ZlciBhIGRldGVybWluYcOnw6NvXG4gICAgICBhd2FpdCBxdWVyeVJ1bm5lci5tYW5hZ2VyLnJlbW92ZShkZXRlcm1pbmFjYW8pO1xuXG4gICAgICBhd2FpdCBxdWVyeVJ1bm5lci5jb21taXRUcmFuc2FjdGlvbigpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBhd2FpdCBxdWVyeVJ1bm5lci5yb2xsYmFja1RyYW5zYWN0aW9uKCk7XG5cbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIE5vdEZvdW5kRXhjZXB0aW9uKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gcmVtb3ZlciBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbDogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICAgIGVycm9yLnN0YWNrLFxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICAnRXJybyBhbyByZW1vdmVyIGRldGVybWluYcOnw6NvIGp1ZGljaWFsJyxcbiAgICAgICk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGF3YWl0IHF1ZXJ5UnVubmVyLnJlbGVhc2UoKTtcbiAgICB9XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIE3DiVRPRE9TIERFIEJVU0NBIEVTUEVDSUFMSVpBRE9TXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogQnVzY2EgZGV0ZXJtaW5hw6fDtWVzIGp1ZGljaWFpcyBwb3IgcHJvY2Vzc28ganVkaWNpYWxcbiAgICpcbiAgICogQHBhcmFtIHByb2Nlc3NvSnVkaWNpYWxJZCBJRCBkbyBwcm9jZXNzbyBqdWRpY2lhbFxuICAgKiBAcmV0dXJucyBMaXN0YSBkZSBkZXRlcm1pbmHDp8O1ZXMganVkaWNpYWlzXG4gICAqL1xuICBhc3luYyBmaW5kQnlQcm9jZXNzb0p1ZGljaWFsKFxuICAgIHByb2Nlc3NvSnVkaWNpYWxJZDogc3RyaW5nLFxuICApOiBQcm9taXNlPERldGVybWluYWNhb0p1ZGljaWFsW10+IHtcbiAgICByZXR1cm4gdGhpcy5kZXRlcm1pbmFjYW9SZXBvc2l0b3J5LmZpbmQoe1xuICAgICAgd2hlcmU6IHsgcHJvY2Vzc29fanVkaWNpYWxfaWQ6IHByb2Nlc3NvSnVkaWNpYWxJZCwgYXRpdm86IHRydWUgfSxcbiAgICAgIG9yZGVyOiB7IGRhdGFfZGV0ZXJtaW5hY2FvOiAnREVTQycgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdXNjYSBkZXRlcm1pbmHDp8O1ZXMganVkaWNpYWlzIHBvciBzb2xpY2l0YcOnw6NvXG4gICAqXG4gICAqIEBwYXJhbSBzb2xpY2l0YWNhb0lkIElEIGRhIHNvbGljaXRhw6fDo29cbiAgICogQHJldHVybnMgTGlzdGEgZGUgZGV0ZXJtaW5hw6fDtWVzIGp1ZGljaWFpc1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5U29saWNpdGFjYW8oXG4gICAgc29saWNpdGFjYW9JZDogc3RyaW5nLFxuICApOiBQcm9taXNlPERldGVybWluYWNhb0p1ZGljaWFsW10+IHtcbiAgICByZXR1cm4gdGhpcy5kZXRlcm1pbmFjYW9SZXBvc2l0b3J5LmZpbmQoe1xuICAgICAgd2hlcmU6IHsgc29saWNpdGFjYW9faWQ6IHNvbGljaXRhY2FvSWQsIGF0aXZvOiB0cnVlIH0sXG4gICAgICBvcmRlcjogeyBkYXRhX2RldGVybWluYWNhbzogJ0RFU0MnIH0sXG4gICAgICByZWxhdGlvbnM6IFsncHJvY2Vzc29fanVkaWNpYWwnXSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdXNjYSBkZXRlcm1pbmHDp8O1ZXMganVkaWNpYWlzIHBvciBjaWRhZMOjb1xuICAgKlxuICAgKiBAcGFyYW0gY2lkYWRhb0lkIElEIGRvIGNpZGFkw6NvXG4gICAqIEByZXR1cm5zIExpc3RhIGRlIGRldGVybWluYcOnw7VlcyBqdWRpY2lhaXNcbiAgICovXG4gIGFzeW5jIGZpbmRCeUNpZGFkYW8oY2lkYWRhb0lkOiBzdHJpbmcpOiBQcm9taXNlPERldGVybWluYWNhb0p1ZGljaWFsW10+IHtcbiAgICByZXR1cm4gdGhpcy5kZXRlcm1pbmFjYW9SZXBvc2l0b3J5LmZpbmQoe1xuICAgICAgd2hlcmU6IHsgY2lkYWRhb19pZDogY2lkYWRhb0lkLCBhdGl2bzogdHJ1ZSB9LFxuICAgICAgb3JkZXI6IHsgZGF0YV9kZXRlcm1pbmFjYW86ICdERVNDJyB9LFxuICAgICAgcmVsYXRpb25zOiBbJ3Byb2Nlc3NvX2p1ZGljaWFsJ10sXG4gICAgfSk7XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIE3DiVRPRE9TIERFIEdFU1TDg08gREUgUFJBWk9TXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogUmV0b3JuYSBkZXRlcm1pbmHDp8O1ZXMganVkaWNpYWlzIGNvbSBwcmF6byBwcsOzeGltbyBkZSBleHBpcmFyIG91IGV4cGlyYWRvXG4gICAqXG4gICAqIEBwYXJhbSBkaWFzQXZpc28gTsO6bWVybyBkZSBkaWFzIHBhcmEgY29uc2lkZXJhciBjb21vIHByYXpvIHByw7N4aW1vXG4gICAqIEByZXR1cm5zIExpc3RhIGRlIGRldGVybWluYcOnw7VlcyBqdWRpY2lhaXNcbiAgICovXG4gIGFzeW5jIGZpbmREZXRlcm1pbmFjb2VzQ29tUHJhem9Qcm94aW1vKFxuICAgIGRpYXNBdmlzbzogbnVtYmVyID0gNyxcbiAgKTogUHJvbWlzZTxEZXRlcm1pbmFjYW9KdWRpY2lhbFtdPiB7XG4gICAgY29uc3QgaG9qZSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgbGltaXRlRGlhcyA9IG5ldyBEYXRlKCk7XG4gICAgbGltaXRlRGlhcy5zZXREYXRlKGhvamUuZ2V0RGF0ZSgpICsgZGlhc0F2aXNvKTtcblxuICAgIHJldHVybiB0aGlzLmRldGVybWluYWNhb1JlcG9zaXRvcnkuZmluZCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBhdGl2bzogdHJ1ZSxcbiAgICAgICAgY3VtcHJpZGE6IGZhbHNlLFxuICAgICAgICBkYXRhX3ByYXpvOiBNb3JlVGhhbk9yRXF1YWwoaG9qZSkgJiYgTGVzc1RoYW5PckVxdWFsKGxpbWl0ZURpYXMpLFxuICAgICAgfSxcbiAgICAgIG9yZGVyOiB7IGRhdGFfcHJhem86ICdBU0MnIH0sXG4gICAgICByZWxhdGlvbnM6IFsncHJvY2Vzc29fanVkaWNpYWwnXSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRvcm5hIGRldGVybWluYcOnw7VlcyBqdWRpY2lhaXMgY29tIHByYXpvIGV4cGlyYWRvXG4gICAqXG4gICAqIEByZXR1cm5zIExpc3RhIGRlIGRldGVybWluYcOnw7VlcyBqdWRpY2lhaXNcbiAgICovXG4gIGFzeW5jIGZpbmREZXRlcm1pbmFjb2VzQ29tUHJhem9FeHBpcmFkbygpOiBQcm9taXNlPERldGVybWluYWNhb0p1ZGljaWFsW10+IHtcbiAgICBjb25zdCBob2plID0gbmV3IERhdGUoKTtcblxuICAgIHJldHVybiB0aGlzLmRldGVybWluYWNhb1JlcG9zaXRvcnkuZmluZCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBhdGl2bzogdHJ1ZSxcbiAgICAgICAgY3VtcHJpZGE6IGZhbHNlLFxuICAgICAgICBkYXRhX3ByYXpvOiBMZXNzVGhhbihob2plKSxcbiAgICAgIH0sXG4gICAgICBvcmRlcjogeyBkYXRhX3ByYXpvOiAnQVNDJyB9LFxuICAgICAgcmVsYXRpb25zOiBbJ3Byb2Nlc3NvX2p1ZGljaWFsJ10sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2EgZGV0ZXJtaW5hw6fDtWVzIGp1ZGljaWFpcyBwZW5kZW50ZXMgZGUgY3VtcHJpbWVudG9cbiAgICpcbiAgICogQHJldHVybnMgTGlzdGEgZGUgZGV0ZXJtaW5hw6fDtWVzIGp1ZGljaWFpcyBwZW5kZW50ZXNcbiAgICovXG4gIGFzeW5jIGZpbmRQZW5kZW50ZXMoKTogUHJvbWlzZTxEZXRlcm1pbmFjYW9KdWRpY2lhbFtdPiB7XG4gICAgcmV0dXJuIHRoaXMuZGV0ZXJtaW5hY2FvUmVwb3NpdG9yeS5maW5kKHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICBjdW1wcmlkYTogZmFsc2UsXG4gICAgICB9LFxuICAgICAgb3JkZXI6IHsgZGF0YV9kZXRlcm1pbmFjYW86ICdERVNDJyB9LFxuICAgICAgcmVsYXRpb25zOiBbJ3Byb2Nlc3NvX2p1ZGljaWFsJ10sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQWx0ZXJuYSBvIHN0YXR1cyBhdGl2by9pbmF0aXZvIGRlIHVtYSBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbFxuICAgKlxuICAgKiBAcGFyYW0gaWQgSUQgZGEgZGV0ZXJtaW5hw6fDo28ganVkaWNpYWxcbiAgICogQHBhcmFtIHVzdWFyaW9JZCBJRCBkbyB1c3XDoXJpbyBxdWUgZXN0w6EgYWx0ZXJhbmRvIG8gc3RhdHVzXG4gICAqIEByZXR1cm5zIEEgZGV0ZXJtaW5hw6fDo28ganVkaWNpYWwgYXR1YWxpemFkYVxuICAgKiBAdGhyb3dzIE5vdEZvdW5kRXhjZXB0aW9uIHNlIGEgZGV0ZXJtaW5hw6fDo28gbsOjbyBmb3IgZW5jb250cmFkYVxuICAgKi9cbiAgYXN5bmMgdG9nZ2xlQXRpdm8oXG4gICAgaWQ6IHN0cmluZyxcbiAgICB1c3VhcmlvSWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxEZXRlcm1pbmFjYW9KdWRpY2lhbD4ge1xuICAgIGNvbnN0IGRldGVybWluYWNhbyA9IGF3YWl0IHRoaXMuZmluZEJ5SWQoaWQpO1xuXG4gICAgdGhpcy5sb2dnZXIubG9nKGBBbHRlcm5hbmRvIHN0YXR1cyBhdGl2byBkYSBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbCAke2lkfWApO1xuXG4gICAgLy8gQWx0ZXJuYXIgbyBzdGF0dXMgYXRpdm9cbiAgICBkZXRlcm1pbmFjYW8uYXRpdm8gPSAhZGV0ZXJtaW5hY2FvLmF0aXZvO1xuICAgIGRldGVybWluYWNhby51cGRhdGVkX2J5ID0gdXN1YXJpb0lkO1xuXG4gICAgcmV0dXJuIHRoaXMuZGV0ZXJtaW5hY2FvUmVwb3NpdG9yeS5zYXZlKGRldGVybWluYWNhbyk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIHBlcm1hbmVudGVtZW50ZSB1bWEgZGV0ZXJtaW5hw6fDo28ganVkaWNpYWxcbiAgICpcbiAgICogQHBhcmFtIGlkIElEIGRhIGRldGVybWluYcOnw6NvIGp1ZGljaWFsXG4gICAqIEByZXR1cm5zIFZvaWRcbiAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBzZSBhIGRldGVybWluYcOnw6NvIG7Do28gZm9yIGVuY29udHJhZGFcbiAgICovXG4gIGFzeW5jIHJlbW92ZShpZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZGV0ZXJtaW5hY2FvID0gYXdhaXQgdGhpcy5maW5kQnlJZChpZCk7XG5cbiAgICB0aGlzLmxvZ2dlci5sb2coYFJlbW92ZW5kbyBkZXRlcm1pbmHDp8OjbyBqdWRpY2lhbCAke2lkfWApO1xuXG4gICAgYXdhaXQgdGhpcy5kZXRlcm1pbmFjYW9SZXBvc2l0b3J5LnJlbW92ZShkZXRlcm1pbmFjYW8pO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=