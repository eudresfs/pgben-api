48a7538fa15fdcbabb720a4aa14a6ef4
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var UnifiedLoggerService_1;
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.UnifiedLoggerService = void 0;
const common_1 = require("@nestjs/common");
const winston_1 = require("winston");
const nest_winston_1 = require("nest-winston");
const winston_config_1 = require("./winston.config");
/**
 * Serviço de Logging Unificado
 *
 * Unifica as funcionalidades do AppLogger e LoggingService em um único
 * serviço de logging consistente e flexível.
 *
 * Mantém compatibilidade total com código existente e fornece recursos adicionais
 * para logging contextualizado, estruturado e com melhor performance.
 *
 * Características:
 * - Compatibilidade total com AppLogger e LoggingService
 * - Logging estruturado com Winston
 * - Contexto automático e manual
 * - Formatação consistente de timestamps
 * - Suporte a metadados extensíveis
 */
let UnifiedLoggerService = UnifiedLoggerService_1 = class UnifiedLoggerService {
    winstonLogger;
    context;
    logger;
    constructor(winstonLogger) {
        this.winstonLogger = winstonLogger;
        // Usar o logger injetado ou criar um novo com a configuração padrão
        this.logger = this.winstonLogger || (0, winston_1.createLogger)(winston_config_1.winstonConfig);
    }
    /**
     * Define o contexto para todos os logs deste serviço
     * Compatível com AppLogger.setContext()
     */
    setContext(context) {
        this.context = context;
    }
    /**
     * Cria uma nova instância do logger com contexto específico
     * Compatível com outros loggers que usam child()
     */
    child(options) {
        const childLogger = new UnifiedLoggerService_1(this.winstonLogger);
        childLogger.setContext(options.context);
        return childLogger;
    }
    /**
     * Log de nível error
     * Compatível com AppLogger.error() e LoggingService.error()
     */
    error(ctxOrMessage, messageOrMeta, metaOrTrace, extraMeta) {
        const timestamp = new Date().toISOString();
        // Compatibilidade com a API antiga (AppLogger)
        if (typeof ctxOrMessage !== 'string') {
            const ctx = ctxOrMessage;
            const message = messageOrMeta;
            const meta = metaOrTrace;
            return this.logger.error({
                message,
                contextName: this.context,
                ctx,
                timestamp,
                level: 'error',
                ...meta
            });
        }
        // Nova API (LoggingService)
        const message = ctxOrMessage;
        const context = messageOrMeta || this.context;
        const trace = typeof metaOrTrace === 'string' ? metaOrTrace : undefined;
        const meta = typeof metaOrTrace === 'object' ? metaOrTrace : extraMeta;
        return this.logger.error(message, {
            context,
            trace,
            timestamp,
            level: 'error',
            ...meta,
        });
    }
    /**
     * Log de nível warn
     * Compatível com AppLogger.warn() e LoggingService.warn()
     */
    warn(ctxOrMessage, messageOrMeta, meta) {
        const timestamp = new Date().toISOString();
        // Compatibilidade com a API antiga (AppLogger)
        if (typeof ctxOrMessage !== 'string') {
            const ctx = ctxOrMessage;
            const message = messageOrMeta;
            return this.logger.warn({
                message,
                contextName: this.context,
                ctx,
                timestamp,
                level: 'warn',
                ...meta
            });
        }
        // Nova API (LoggingService)
        const message = ctxOrMessage;
        const context = messageOrMeta || this.context;
        return this.logger.warn(message, {
            context,
            timestamp,
            level: 'warn',
            ...meta,
        });
    }
    /**
     * Log de nível debug
     * Compatível com AppLogger.debug()
     */
    debug(ctxOrMessage, messageOrMeta, meta) {
        const timestamp = new Date().toISOString();
        // Compatibilidade com a API antiga (AppLogger)
        if (typeof ctxOrMessage !== 'string') {
            const ctx = ctxOrMessage;
            const message = messageOrMeta;
            return this.logger.debug({
                message,
                contextName: this.context,
                ctx,
                timestamp,
                level: 'debug',
                ...meta
            });
        }
        // Nova API (LoggingService)
        const message = ctxOrMessage;
        const context = messageOrMeta || this.context;
        return this.logger.debug(message, {
            context,
            timestamp,
            level: 'debug',
            ...meta,
        });
    }
    /**
     * Log de nível verbose
     * Compatível com AppLogger.verbose()
     */
    verbose(ctxOrMessage, messageOrMeta, meta) {
        const timestamp = new Date().toISOString();
        // Compatibilidade com a API antiga (AppLogger)
        if (typeof ctxOrMessage !== 'string') {
            const ctx = ctxOrMessage;
            const message = messageOrMeta;
            return this.logger.verbose({
                message,
                contextName: this.context,
                ctx,
                timestamp,
                level: 'verbose',
                ...meta
            });
        }
        // Nova API (LoggingService)
        const message = ctxOrMessage;
        const context = messageOrMeta || this.context;
        return this.logger.verbose(message, {
            context,
            timestamp,
            level: 'verbose',
            ...meta,
        });
    }
    /**
     * Log de nível info (compatível com AppLogger.log())
     * Compatível com AppLogger.log()
     */
    log(ctxOrMessage, messageOrMeta, meta) {
        const timestamp = new Date().toISOString();
        // Compatibilidade com a API antiga (AppLogger)
        if (typeof ctxOrMessage !== 'string') {
            const ctx = ctxOrMessage;
            const message = messageOrMeta;
            return this.logger.info({
                message,
                contextName: this.context,
                ctx,
                timestamp,
                level: 'info',
                ...meta
            });
        }
        // Nova API (LoggingService)
        const message = ctxOrMessage;
        const context = messageOrMeta || this.context;
        return this.logger.info(message, {
            context,
            timestamp,
            level: 'info',
            ...meta,
        });
    }
    // Alias para log (compatibilidade com LoggingService)
    info(ctxOrMessage, messageOrMeta, meta) {
        return this.log(ctxOrMessage, messageOrMeta, meta);
    }
    /**
     * Registra uma operação de banco de dados
     */
    logDatabase(operation, entity, duration, query) {
        this.logger.debug(`DB: ${operation} ${entity} - ${duration}ms`, {
            context: 'Database',
            operation,
            entity,
            duration,
            query,
            timestamp: new Date().toISOString(),
        });
    }
    /**
     * Registra uma operação de autenticação
     */
    logAuth(operation, userId, success, ip, userAgent) {
        this.logger.info(`Auth: ${operation} - Usuário: ${userId} - Sucesso: ${success}`, {
            context: 'Authentication',
            operation,
            userId,
            success,
            ip,
            userAgent,
            timestamp: new Date().toISOString(),
        });
    }
    /**
     * Registra uma operação de negócio
     */
    logBusiness(operation, entity, entityId, userId, details) {
        this.logger.info(`Business: ${operation} ${entity} ${entityId} - Usuário: ${userId}`, {
            context: 'Business',
            operation,
            entity,
            entityId,
            userId,
            details,
            timestamp: new Date().toISOString(),
        });
    }
};
exports.UnifiedLoggerService = UnifiedLoggerService;
exports.UnifiedLoggerService = UnifiedLoggerService = UnifiedLoggerService_1 = __decorate([
    (0, common_1.Injectable)({ scope: common_1.Scope.TRANSIENT }),
    __param(0, (0, common_1.Optional)()),
    __param(0, (0, common_1.Inject)(nest_winston_1.WINSTON_MODULE_PROVIDER)),
    __metadata("design:paramtypes", [typeof (_a = typeof winston_1.Logger !== "undefined" && winston_1.Logger) === "function" ? _a : Object])
], UnifiedLoggerService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXHNoYXJlZFxcbG9nZ2luZ1xcdW5pZmllZC1sb2dnZXIuc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUFxRTtBQUNyRSxxQ0FBK0M7QUFDL0MsK0NBQXVEO0FBR3ZELHFEQUFpRDtBQUVqRDs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFFSSxJQUFNLG9CQUFvQiw0QkFBMUIsTUFBTSxvQkFBb0I7SUFLaUM7SUFKeEQsT0FBTyxDQUFVO0lBQ2pCLE1BQU0sQ0FBUztJQUV2QixZQUNnRSxhQUFzQjtRQUF0QixrQkFBYSxHQUFiLGFBQWEsQ0FBUztRQUVwRixvRUFBb0U7UUFDcEUsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsYUFBYSxJQUFJLElBQUEsc0JBQVksRUFBQyw4QkFBYSxDQUFDLENBQUM7SUFDbEUsQ0FBQztJQUVEOzs7T0FHRztJQUNJLFVBQVUsQ0FBQyxPQUFlO1FBQy9CLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0lBQ3pCLENBQUM7SUFFRDs7O09BR0c7SUFDSSxLQUFLLENBQUMsT0FBNEI7UUFDdkMsTUFBTSxXQUFXLEdBQUcsSUFBSSxzQkFBb0IsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDakUsV0FBVyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDeEMsT0FBTyxXQUFXLENBQUM7SUFDckIsQ0FBQztJQUVEOzs7T0FHRztJQUNILEtBQUssQ0FDSCxZQUFxQyxFQUNyQyxhQUE0QyxFQUM1QyxXQUEwQyxFQUMxQyxTQUErQjtRQUUvQixNQUFNLFNBQVMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBRTNDLCtDQUErQztRQUMvQyxJQUFJLE9BQU8sWUFBWSxLQUFLLFFBQVEsRUFBRSxDQUFDO1lBQ3JDLE1BQU0s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TCxTQUFpQixFQUNqQixNQUFjLEVBQ2QsT0FBZ0IsRUFDaEIsRUFBVyxFQUNYLFNBQWtCO1FBRWxCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUNkLFNBQVMsU0FBUyxlQUFlLE1BQU0sZUFBZSxPQUFPLEVBQUUsRUFDL0Q7WUFDRSxPQUFPLEVBQUUsZ0JBQWdCO1lBQ3pCLFNBQVM7WUFDVCxNQUFNO1lBQ04sT0FBTztZQUNQLEVBQUU7WUFDRixTQUFTO1lBQ1QsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO1NBQ3BDLENBQ0YsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNILFdBQVcsQ0FDVCxTQUFpQixFQUNqQixNQUFjLEVBQ2QsUUFBZ0IsRUFDaEIsTUFBYyxFQUNkLE9BQTZCO1FBRTdCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUNkLGFBQWEsU0FBUyxJQUFJLE1BQU0sSUFBSSxRQUFRLGVBQWUsTUFBTSxFQUFFLEVBQ25FO1lBQ0UsT0FBTyxFQUFFLFVBQVU7WUFDbkIsU0FBUztZQUNULE1BQU07WUFDTixRQUFRO1lBQ1IsTUFBTTtZQUNOLE9BQU87WUFDUCxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7U0FDcEMsQ0FDRixDQUFDO0lBQ0osQ0FBQztDQUNGLENBQUE7QUEzU1ksb0RBQW9COytCQUFwQixvQkFBb0I7SUFEaEMsSUFBQSxtQkFBVSxFQUFDLEVBQUUsS0FBSyxFQUFFLGNBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQU1sQyxXQUFBLElBQUEsaUJBQVEsR0FBRSxDQUFBO0lBQUUsV0FBQSxJQUFBLGVBQU0sRUFBQyxzQ0FBdUIsQ0FBQyxDQUFBO3lEQUFrQyxnQkFBTSxvQkFBTixnQkFBTTtHQUwzRSxvQkFBb0IsQ0EyU2hDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxzaGFyZWRcXGxvZ2dpbmdcXHVuaWZpZWQtbG9nZ2VyLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgU2NvcGUsIEluamVjdCwgT3B0aW9uYWwgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBMb2dnZXIsIGNyZWF0ZUxvZ2dlciB9IGZyb20gJ3dpbnN0b24nO1xuaW1wb3J0IHsgV0lOU1RPTl9NT0RVTEVfUFJPVklERVIgfSBmcm9tICduZXN0LXdpbnN0b24nO1xuXG5pbXBvcnQgeyBSZXF1ZXN0Q29udGV4dCB9IGZyb20gJy4uL3JlcXVlc3QtY29udGV4dC9yZXF1ZXN0LWNvbnRleHQuZHRvJztcbmltcG9ydCB7IHdpbnN0b25Db25maWcgfSBmcm9tICcuL3dpbnN0b24uY29uZmlnJztcblxuLyoqXG4gKiBTZXJ2acOnbyBkZSBMb2dnaW5nIFVuaWZpY2Fkb1xuICogXG4gKiBVbmlmaWNhIGFzIGZ1bmNpb25hbGlkYWRlcyBkbyBBcHBMb2dnZXIgZSBMb2dnaW5nU2VydmljZSBlbSB1bSDDum5pY29cbiAqIHNlcnZpw6dvIGRlIGxvZ2dpbmcgY29uc2lzdGVudGUgZSBmbGV4w612ZWwuXG4gKiBcbiAqIE1hbnTDqW0gY29tcGF0aWJpbGlkYWRlIHRvdGFsIGNvbSBjw7NkaWdvIGV4aXN0ZW50ZSBlIGZvcm5lY2UgcmVjdXJzb3MgYWRpY2lvbmFpc1xuICogcGFyYSBsb2dnaW5nIGNvbnRleHR1YWxpemFkbywgZXN0cnV0dXJhZG8gZSBjb20gbWVsaG9yIHBlcmZvcm1hbmNlLlxuICogXG4gKiBDYXJhY3RlcsOtc3RpY2FzOlxuICogLSBDb21wYXRpYmlsaWRhZGUgdG90YWwgY29tIEFwcExvZ2dlciBlIExvZ2dpbmdTZXJ2aWNlXG4gKiAtIExvZ2dpbmcgZXN0cnV0dXJhZG8gY29tIFdpbnN0b25cbiAqIC0gQ29udGV4dG8gYXV0b23DoXRpY28gZSBtYW51YWxcbiAqIC0gRm9ybWF0YcOnw6NvIGNvbnNpc3RlbnRlIGRlIHRpbWVzdGFtcHNcbiAqIC0gU3Vwb3J0ZSBhIG1ldGFkYWRvcyBleHRlbnPDrXZlaXNcbiAqL1xuQEluamVjdGFibGUoeyBzY29wZTogU2NvcGUuVFJBTlNJRU5UIH0pXG5leHBvcnQgY2xhc3MgVW5pZmllZExvZ2dlclNlcnZpY2Uge1xuICBwcml2YXRlIGNvbnRleHQ/OiBzdHJpbmc7XG4gIHByaXZhdGUgbG9nZ2VyOiBMb2dnZXI7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChXSU5TVE9OX01PRFVMRV9QUk9WSURFUikgcHJpdmF0ZSByZWFkb25seSB3aW5zdG9uTG9nZ2VyPzogTG9nZ2VyLFxuICApIHtcbiAgICAvLyBVc2FyIG8gbG9nZ2VyIGluamV0YWRvIG91IGNyaWFyIHVtIG5vdm8gY29tIGEgY29uZmlndXJhw6fDo28gcGFkcsOjb1xuICAgIHRoaXMubG9nZ2VyID0gdGhpcy53aW5zdG9uTG9nZ2VyIHx8IGNyZWF0ZUxvZ2dlcih3aW5zdG9uQ29uZmlnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWZpbmUgbyBjb250ZXh0byBwYXJhIHRvZG9zIG9zIGxvZ3MgZGVzdGUgc2VydmnDp29cbiAgICogQ29tcGF0w612ZWwgY29tIEFwcExvZ2dlci5zZXRDb250ZXh0KClcbiAgICovXG4gIHB1YmxpYyBzZXRDb250ZXh0KGNvbnRleHQ6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7XG4gIH1cblxuICAvKipcbiAgICogQ3JpYSB1bWEgbm92YSBpbnN0w6JuY2lhIGRvIGxvZ2dlciBjb20gY29udGV4dG8gZXNwZWPDrWZpY29cbiAgICogQ29tcGF0w612ZWwgY29tIG91dHJvcyBsb2dnZXJzIHF1ZSB1c2FtIGNoaWxkKClcbiAgICovXG4gIHB1YmxpYyBjaGlsZChvcHRpb25zOiB7IGNvbnRleHQ6IHN0cmluZyB9KTogVW5pZmllZExvZ2dlclNlcnZpY2Uge1xuICAgIGNvbnN0IGNoaWxkTG9nZ2VyID0gbmV3IFVuaWZpZWRMb2dnZXJTZXJ2aWNlKHRoaXMud2luc3RvbkxvZ2dlcik7XG4gICAgY2hpbGRMb2dnZXIuc2V0Q29udGV4dChvcHRpb25zLmNvbnRleHQpO1xuICAgIHJldHVybiBjaGlsZExvZ2dlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgZGUgbsOtdmVsIGVycm9yXG4gICAqIENvbXBhdMOtdmVsIGNvbSBBcHBMb2dnZXIuZXJyb3IoKSBlIExvZ2dpbmdTZXJ2aWNlLmVycm9yKClcbiAgICovXG4gIGVycm9yKFxuICAgIGN0eE9yTWVzc2FnZTogUmVxdWVzdENvbnRleHQgfCBzdHJpbmcsXG4gICAgbWVzc2FnZU9yTWV0YT86IHN0cmluZyB8IFJlY29yZDxzdHJpbmcsIGFueT4sXG4gICAgbWV0YU9yVHJhY2U/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+IHwgc3RyaW5nLFxuICAgIGV4dHJhTWV0YT86IFJlY29yZDxzdHJpbmcsIGFueT4sXG4gICk6IExvZ2dlciB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIFxuICAgIC8vIENvbXBhdGliaWxpZGFkZSBjb20gYSBBUEkgYW50aWdhIChBcHBMb2dnZXIpXG4gICAgaWYgKHR5cGVvZiBjdHhPck1lc3NhZ2UgIT09ICdzdHJpbmcnKSB7XG4gICAgICBjb25zdCBjdHggPSBjdHhPck1lc3NhZ2U7XG4gICAgICBjb25zdCBtZXNzYWdlID0gbWVzc2FnZU9yTWV0YSBhcyBzdHJpbmc7XG4gICAgICBjb25zdCBtZXRhID0gbWV0YU9yVHJhY2UgYXMgUmVjb3JkPHN0cmluZywgYW55PjtcbiAgICAgIFxuICAgICAgcmV0dXJuIHRoaXMubG9nZ2VyLmVycm9yKHtcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgY29udGV4dE5hbWU6IHRoaXMuY29udGV4dCxcbiAgICAgICAgY3R4LFxuICAgICAgICB0aW1lc3RhbXAsXG4gICAgICAgIGxldmVsOiAnZXJyb3InLFxuICAgICAgICAuLi5tZXRhXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gTm92YSBBUEkgKExvZ2dpbmdTZXJ2aWNlKVxuICAgIGNvbnN0IG1lc3NhZ2UgPSBjdHhPck1lc3NhZ2U7XG4gICAgY29uc3QgY29udGV4dCA9IG1lc3NhZ2VPck1ldGEgYXMgc3RyaW5nIHx8IHRoaXMuY29udGV4dDtcbiAgICBjb25zdCB0cmFjZSA9IHR5cGVvZiBtZXRhT3JUcmFjZSA9PT0gJ3N0cmluZycgPyBtZXRhT3JUcmFjZSA6IHVuZGVmaW5lZDtcbiAgICBjb25zdCBtZXRhID0gdHlwZW9mIG1ldGFPclRyYWNlID09PSAnb2JqZWN0JyA/IG1ldGFPclRyYWNlIDogZXh0cmFNZXRhO1xuICAgIFxuICAgIHJldHVybiB0aGlzLmxvZ2dlci5lcnJvcihtZXNzYWdlLCB7XG4gICAgICBjb250ZXh0LFxuICAgICAgdHJhY2UsXG4gICAgICB0aW1lc3RhbXAsXG4gICAgICBsZXZlbDogJ2Vycm9yJyxcbiAgICAgIC4uLm1ldGEsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogTG9nIGRlIG7DrXZlbCB3YXJuXG4gICAqIENvbXBhdMOtdmVsIGNvbSBBcHBMb2dnZXIud2FybigpIGUgTG9nZ2luZ1NlcnZpY2Uud2FybigpXG4gICAqL1xuICB3YXJuKFxuICAgIGN0eE9yTWVzc2FnZTogUmVxdWVzdENvbnRleHQgfCBzdHJpbmcsXG4gICAgbWVzc2FnZU9yTWV0YT86IHN0cmluZyB8IFJlY29yZDxzdHJpbmcsIGFueT4sXG4gICAgbWV0YT86IFJlY29yZDxzdHJpbmcsIGFueT4sXG4gICk6IExvZ2dlciB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIFxuICAgIC8vIENvbXBhdGliaWxpZGFkZSBjb20gYSBBUEkgYW50aWdhIChBcHBMb2dnZXIpXG4gICAgaWYgKHR5cGVvZiBjdHhPck1lc3NhZ2UgIT09ICdzdHJpbmcnKSB7XG4gICAgICBjb25zdCBjdHggPSBjdHhPck1lc3NhZ2U7XG4gICAgICBjb25zdCBtZXNzYWdlID0gbWVzc2FnZU9yTWV0YSBhcyBzdHJpbmc7XG4gICAgICBcbiAgICAgIHJldHVybiB0aGlzLmxvZ2dlci53YXJuKHtcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgY29udGV4dE5hbWU6IHRoaXMuY29udGV4dCxcbiAgICAgICAgY3R4LFxuICAgICAgICB0aW1lc3RhbXAsXG4gICAgICAgIGxldmVsOiAnd2FybicsXG4gICAgICAgIC4uLm1ldGFcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBOb3ZhIEFQSSAoTG9nZ2luZ1NlcnZpY2UpXG4gICAgY29uc3QgbWVzc2FnZSA9IGN0eE9yTWVzc2FnZTtcbiAgICBjb25zdCBjb250ZXh0ID0gbWVzc2FnZU9yTWV0YSBhcyBzdHJpbmcgfHwgdGhpcy5jb250ZXh0O1xuICAgIFxuICAgIHJldHVybiB0aGlzLmxvZ2dlci53YXJuKG1lc3NhZ2UsIHtcbiAgICAgIGNvbnRleHQsXG4gICAgICB0aW1lc3RhbXAsXG4gICAgICBsZXZlbDogJ3dhcm4nLFxuICAgICAgLi4ubWV0YSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgZGUgbsOtdmVsIGRlYnVnXG4gICAqIENvbXBhdMOtdmVsIGNvbSBBcHBMb2dnZXIuZGVidWcoKVxuICAgKi9cbiAgZGVidWcoXG4gICAgY3R4T3JNZXNzYWdlOiBSZXF1ZXN0Q29udGV4dCB8IHN0cmluZyxcbiAgICBtZXNzYWdlT3JNZXRhPzogc3RyaW5nIHwgUmVjb3JkPHN0cmluZywgYW55PixcbiAgICBtZXRhPzogUmVjb3JkPHN0cmluZywgYW55PixcbiAgKTogTG9nZ2VyIHtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgXG4gICAgLy8gQ29tcGF0aWJpbGlkYWRlIGNvbSBhIEFQSSBhbnRpZ2EgKEFwcExvZ2dlcilcbiAgICBpZiAodHlwZW9mIGN0eE9yTWVzc2FnZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgIGNvbnN0IGN0eCA9IGN0eE9yTWVzc2FnZTtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBtZXNzYWdlT3JNZXRhIGFzIHN0cmluZztcbiAgICAgIFxuICAgICAgcmV0dXJuIHRoaXMubG9nZ2VyLmRlYnVnKHtcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgY29udGV4dE5hbWU6IHRoaXMuY29udGV4dCxcbiAgICAgICAgY3R4LFxuICAgICAgICB0aW1lc3RhbXAsXG4gICAgICAgIGxldmVsOiAnZGVidWcnLFxuICAgICAgICAuLi5tZXRhXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gTm92YSBBUEkgKExvZ2dpbmdTZXJ2aWNlKVxuICAgIGNvbnN0IG1lc3NhZ2UgPSBjdHhPck1lc3NhZ2U7XG4gICAgY29uc3QgY29udGV4dCA9IG1lc3NhZ2VPck1ldGEgYXMgc3RyaW5nIHx8IHRoaXMuY29udGV4dDtcbiAgICBcbiAgICByZXR1cm4gdGhpcy5sb2dnZXIuZGVidWcobWVzc2FnZSwge1xuICAgICAgY29udGV4dCxcbiAgICAgIHRpbWVzdGFtcCxcbiAgICAgIGxldmVsOiAnZGVidWcnLFxuICAgICAgLi4ubWV0YSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgZGUgbsOtdmVsIHZlcmJvc2VcbiAgICogQ29tcGF0w612ZWwgY29tIEFwcExvZ2dlci52ZXJib3NlKClcbiAgICovXG4gIHZlcmJvc2UoXG4gICAgY3R4T3JNZXNzYWdlOiBSZXF1ZXN0Q29udGV4dCB8IHN0cmluZyxcbiAgICBtZXNzYWdlT3JNZXRhPzogc3RyaW5nIHwgUmVjb3JkPHN0cmluZywgYW55PixcbiAgICBtZXRhPzogUmVjb3JkPHN0cmluZywgYW55PixcbiAgKTogTG9nZ2VyIHtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgXG4gICAgLy8gQ29tcGF0aWJpbGlkYWRlIGNvbSBhIEFQSSBhbnRpZ2EgKEFwcExvZ2dlcilcbiAgICBpZiAodHlwZW9mIGN0eE9yTWVzc2FnZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgIGNvbnN0IGN0eCA9IGN0eE9yTWVzc2FnZTtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBtZXNzYWdlT3JNZXRhIGFzIHN0cmluZztcbiAgICAgIFxuICAgICAgcmV0dXJuIHRoaXMubG9nZ2VyLnZlcmJvc2Uoe1xuICAgICAgICBtZXNzYWdlLFxuICAgICAgICBjb250ZXh0TmFtZTogdGhpcy5jb250ZXh0LFxuICAgICAgICBjdHgsXG4gICAgICAgIHRpbWVzdGFtcCxcbiAgICAgICAgbGV2ZWw6ICd2ZXJib3NlJyxcbiAgICAgICAgLi4ubWV0YVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIE5vdmEgQVBJIChMb2dnaW5nU2VydmljZSlcbiAgICBjb25zdCBtZXNzYWdlID0gY3R4T3JNZXNzYWdlO1xuICAgIGNvbnN0IGNvbnRleHQgPSBtZXNzYWdlT3JNZXRhIGFzIHN0cmluZyB8fCB0aGlzLmNvbnRleHQ7XG4gICAgXG4gICAgcmV0dXJuIHRoaXMubG9nZ2VyLnZlcmJvc2UobWVzc2FnZSwge1xuICAgICAgY29udGV4dCxcbiAgICAgIHRpbWVzdGFtcCxcbiAgICAgIGxldmVsOiAndmVyYm9zZScsXG4gICAgICAuLi5tZXRhLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIExvZyBkZSBuw612ZWwgaW5mbyAoY29tcGF0w612ZWwgY29tIEFwcExvZ2dlci5sb2coKSlcbiAgICogQ29tcGF0w612ZWwgY29tIEFwcExvZ2dlci5sb2coKVxuICAgKi9cbiAgbG9nKFxuICAgIGN0eE9yTWVzc2FnZTogUmVxdWVzdENvbnRleHQgfCBzdHJpbmcsXG4gICAgbWVzc2FnZU9yTWV0YT86IHN0cmluZyB8IFJlY29yZDxzdHJpbmcsIGFueT4sXG4gICAgbWV0YT86IFJlY29yZDxzdHJpbmcsIGFueT4sXG4gICk6IExvZ2dlciB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIFxuICAgIC8vIENvbXBhdGliaWxpZGFkZSBjb20gYSBBUEkgYW50aWdhIChBcHBMb2dnZXIpXG4gICAgaWYgKHR5cGVvZiBjdHhPck1lc3NhZ2UgIT09ICdzdHJpbmcnKSB7XG4gICAgICBjb25zdCBjdHggPSBjdHhPck1lc3NhZ2U7XG4gICAgICBjb25zdCBtZXNzYWdlID0gbWVzc2FnZU9yTWV0YSBhcyBzdHJpbmc7XG4gICAgICBcbiAgICAgIHJldHVybiB0aGlzLmxvZ2dlci5pbmZvKHtcbiAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgY29udGV4dE5hbWU6IHRoaXMuY29udGV4dCxcbiAgICAgICAgY3R4LFxuICAgICAgICB0aW1lc3RhbXAsXG4gICAgICAgIGxldmVsOiAnaW5mbycsXG4gICAgICAgIC4uLm1ldGFcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBOb3ZhIEFQSSAoTG9nZ2luZ1NlcnZpY2UpXG4gICAgY29uc3QgbWVzc2FnZSA9IGN0eE9yTWVzc2FnZTtcbiAgICBjb25zdCBjb250ZXh0ID0gbWVzc2FnZU9yTWV0YSBhcyBzdHJpbmcgfHwgdGhpcy5jb250ZXh0O1xuICAgIFxuICAgIHJldHVybiB0aGlzLmxvZ2dlci5pbmZvKG1lc3NhZ2UsIHtcbiAgICAgIGNvbnRleHQsXG4gICAgICB0aW1lc3RhbXAsXG4gICAgICBsZXZlbDogJ2luZm8nLFxuICAgICAgLi4ubWV0YSxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEFsaWFzIHBhcmEgbG9nIChjb21wYXRpYmlsaWRhZGUgY29tIExvZ2dpbmdTZXJ2aWNlKVxuICBpbmZvKFxuICAgIGN0eE9yTWVzc2FnZTogUmVxdWVzdENvbnRleHQgfCBzdHJpbmcsXG4gICAgbWVzc2FnZU9yTWV0YT86IHN0cmluZyB8IFJlY29yZDxzdHJpbmcsIGFueT4sXG4gICAgbWV0YT86IFJlY29yZDxzdHJpbmcsIGFueT4sXG4gICk6IExvZ2dlciB7XG4gICAgcmV0dXJuIHRoaXMubG9nKGN0eE9yTWVzc2FnZSwgbWVzc2FnZU9yTWV0YSwgbWV0YSk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0cmEgdW1hIG9wZXJhw6fDo28gZGUgYmFuY28gZGUgZGFkb3NcbiAgICovXG4gIGxvZ0RhdGFiYXNlKFxuICAgIG9wZXJhdGlvbjogc3RyaW5nLFxuICAgIGVudGl0eTogc3RyaW5nLFxuICAgIGR1cmF0aW9uOiBudW1iZXIsXG4gICAgcXVlcnk/OiBzdHJpbmcsXG4gICk6IHZvaWQge1xuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGBEQjogJHtvcGVyYXRpb259ICR7ZW50aXR5fSAtICR7ZHVyYXRpb259bXNgLCB7XG4gICAgICBjb250ZXh0OiAnRGF0YWJhc2UnLFxuICAgICAgb3BlcmF0aW9uLFxuICAgICAgZW50aXR5LFxuICAgICAgZHVyYXRpb24sXG4gICAgICBxdWVyeSxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdHJhIHVtYSBvcGVyYcOnw6NvIGRlIGF1dGVudGljYcOnw6NvXG4gICAqL1xuICBsb2dBdXRoKFxuICAgIG9wZXJhdGlvbjogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHN1Y2Nlc3M6IGJvb2xlYW4sXG4gICAgaXA/OiBzdHJpbmcsXG4gICAgdXNlckFnZW50Pzogc3RyaW5nLFxuICApOiB2b2lkIHtcbiAgICB0aGlzLmxvZ2dlci5pbmZvKFxuICAgICAgYEF1dGg6ICR7b3BlcmF0aW9ufSAtIFVzdcOhcmlvOiAke3VzZXJJZH0gLSBTdWNlc3NvOiAke3N1Y2Nlc3N9YCxcbiAgICAgIHtcbiAgICAgICAgY29udGV4dDogJ0F1dGhlbnRpY2F0aW9uJyxcbiAgICAgICAgb3BlcmF0aW9uLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIHN1Y2Nlc3MsXG4gICAgICAgIGlwLFxuICAgICAgICB1c2VyQWdlbnQsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgfSxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdHJhIHVtYSBvcGVyYcOnw6NvIGRlIG5lZ8OzY2lvXG4gICAqL1xuICBsb2dCdXNpbmVzcyhcbiAgICBvcGVyYXRpb246IHN0cmluZyxcbiAgICBlbnRpdHk6IHN0cmluZyxcbiAgICBlbnRpdHlJZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIGRldGFpbHM/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuICApOiB2b2lkIHtcbiAgICB0aGlzLmxvZ2dlci5pbmZvKFxuICAgICAgYEJ1c2luZXNzOiAke29wZXJhdGlvbn0gJHtlbnRpdHl9ICR7ZW50aXR5SWR9IC0gVXN1w6FyaW86ICR7dXNlcklkfWAsXG4gICAgICB7XG4gICAgICAgIGNvbnRleHQ6ICdCdXNpbmVzcycsXG4gICAgICAgIG9wZXJhdGlvbixcbiAgICAgICAgZW50aXR5LFxuICAgICAgICBlbnRpdHlJZCxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBkZXRhaWxzLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH0sXG4gICAgKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9