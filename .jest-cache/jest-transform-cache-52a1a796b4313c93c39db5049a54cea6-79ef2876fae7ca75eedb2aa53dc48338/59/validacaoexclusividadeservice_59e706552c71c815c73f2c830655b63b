c414c92ecec7478c0ffbc41f6b4f28cd
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var ValidacaoExclusividadeService_1;
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.ValidacaoExclusividadeService = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("typeorm");
const typeorm_2 = require("@nestjs/typeorm");
const solicitacao_entity_1 = require("../../../entities/solicitacao.entity");
/**
 * Serviço responsável por validar a exclusividade de papéis dos cidadãos
 * nas solicitações de benefícios.
 *
 * Conforme requisito crítico (5.1 Exclusividade de Papéis) da especificação técnica,
 * um cidadão não pode simultaneamente ser beneficiário principal e
 * fazer parte da composição familiar de outro beneficiário.
 */
let ValidacaoExclusividadeService = ValidacaoExclusividadeService_1 = class ValidacaoExclusividadeService {
    solicitacaoRepository;
    logger = new common_1.Logger(ValidacaoExclusividadeService_1.name);
    constructor(solicitacaoRepository) {
        this.solicitacaoRepository = solicitacaoRepository;
    }
    /**
     * Valida se um cidadão pode ser beneficiário principal
     * verificando se ele não faz parte da composição familiar de outras solicitações ativas
     *
     * @param cidadaoId ID do cidadão a ser validado
     * @returns true se o cidadão pode ser beneficiário, false caso contrário
     * @throws BadRequestException se o cidadão já faz parte da composição familiar de outra solicitação
     */
    async validarExclusividadeBeneficiario(cidadaoId) {
        this.logger.log(`Validando exclusividade de papel para cidadão ${cidadaoId}`);
        // Verifica se o cidadão faz parte da composição familiar de alguma solicitação ativa
        const solicitacoesComCidadaoNaComposicao = await this.solicitacaoRepository
            .createQueryBuilder('solicitacao')
            .where(`solicitacao.dados_complementares->'composicao_familiar' @> :membro`, {
            membro: JSON.stringify([{ cidadao_id: cidadaoId }]),
        })
            .andWhere(`solicitacao.status NOT IN (:...statusInativos)`, {
            statusInativos: [
                solicitacao_entity_1.StatusSolicitacao.CANCELADA,
                solicitacao_entity_1.StatusSolicitacao.INDEFERIDA,
                solicitacao_entity_1.StatusSolicitacao.ARQUIVADA,
            ],
        })
            .getCount();
        if (solicitacoesComCidadaoNaComposicao > 0) {
            this.logger.warn(`Cidadão ${cidadaoId} já faz parte da composição familiar de outra solicitação ativa`);
            throw new common_1.BadRequestException('Cidadão não pode ser beneficiário principal pois já faz parte da composição familiar de outra solicitação ativa');
        }
        return true;
    }
    /**
     * Valida se um cidadão pode ser incluído na composição familiar
     * verificando se ele não é beneficiário principal em outras solicitações ativas
     *
     * @param cidadaoId ID do cidadão a ser validado
     * @returns true se o cidadão pode ser incluído na composição familiar, false caso contrário
     * @throws BadRequestException se o cidadão já é beneficiário principal em outra solicitação
     */
    async validarExclusividadeComposicaoFamiliar(cidadaoId) {
        this.logger.log(`Validando exclusividade para composição familiar: cidadão ${cidadaoId}`);
        // Verifica se o cidadão é beneficiário principal em alguma solicitação ativa
        const solicitacoesComCidadaoBeneficiario = await this.solicitacaoRepository
            .createQueryBuilder('solicitacao')
            .where('solicitacao.beneficiario_id = :cidadaoId', { cidadaoId })
            .andWhere(`solicitacao.status NOT IN (:...statusInativos)`, {
            statusInativos: [
                solicitacao_entity_1.StatusSolicitacao.CANCELADA,
                solicitacao_entity_1.StatusSolicitacao.INDEFERIDA,
                solicitacao_entity_1.StatusSolicitacao.ARQUIVADA,
            ],
        })
            .getCount();
        if (solicitacoesComCidadaoBeneficiario > 0) {
            this.logger.warn(`Cidadão ${cidadaoId} já é beneficiário principal em outra solicitação ativa`);
            throw new common_1.BadRequestException('Cidadão não pode ser incluído na composição familiar pois já é beneficiário principal em outra solicitação ativa');
        }
        return true;
    }
    /**
     * Valida a composição familiar completa, verificando se todos os membros
     * podem ser incluídos (não são beneficiários principais em outras solicitações)
     *
     * @param composicaoFamiliar Array de IDs de cidadãos da composição familiar
     * @returns true se todos os membros podem ser incluídos na composição familiar
     * @throws BadRequestException se algum membro não pode ser incluído
     */
    async validarComposicaoFamiliarCompleta(composicaoFamiliar) {
        this.logger.log(`Validando composição familiar completa com ${composicaoFamiliar.length} membros`);
        // Valida cada membro da composição familiar
        for (const cidadaoId of composicaoFamiliar) {
            await this.validarExclusividadeComposicaoFamiliar(cidadaoId);
        }
        return true;
    }
};
exports.ValidacaoExclusividadeService = ValidacaoExclusividadeService;
exports.ValidacaoExclusividadeService = ValidacaoExclusividadeService = ValidacaoExclusividadeService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_2.InjectRepository)(solicitacao_entity_1.Solicitacao)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.Repository !== "undefined" && typeorm_1.Repository) === "function" ? _a : Object])
], ValidacaoExclusividadeService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHNvbGljaXRhY2FvXFxzZXJ2aWNlc1xcdmFsaWRhY2FvLWV4Y2x1c2l2aWRhZGUuc2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUF5RTtBQUN6RSxxQ0FBcUM7QUFDckMsNkNBQW1EO0FBQ25ELDZFQUc4QztBQUU5Qzs7Ozs7OztHQU9HO0FBRUksSUFBTSw2QkFBNkIscUNBQW5DLE1BQU0sNkJBQTZCO0lBSzlCO0lBSk8sTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLCtCQUE2QixDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXpFLFlBRVUscUJBQThDO1FBQTlDLDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBeUI7SUFDckQsQ0FBQztJQUVKOzs7Ozs7O09BT0c7SUFDSCxLQUFLLENBQUMsZ0NBQWdDLENBQUMsU0FBaUI7UUFDdEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQ2IsaURBQWlELFNBQVMsRUFBRSxDQUM3RCxDQUFDO1FBRUYscUZBQXFGO1FBQ3JGLE1BQU0sa0NBQWtDLEdBQUcsTUFBTSxJQUFJLENBQUMscUJBQXFCO2FBQ3hFLGtCQUFrQixDQUFDLGFBQWEsQ0FBQzthQUNqQyxLQUFLLENBQ0osb0VBQW9FLEVBQ3BFO1lBQ0UsTUFBTSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDO1NBQ3BELENBQ0Y7YUFDQSxRQUFRLENBQUMsZ0RBQWdELEVBQUU7WUFDMUQsY0FBYyxFQUFFO2dCQUNkLHNDQUFpQixDQUFDLFNBQVM7Z0JBQzNCLHNDQUFpQixDQUFDLFVBQVU7Z0JBQzVCLHNDQUFpQixDQUFDLFNBQVM7YUFDNUI7U0FDRixDQUFDO2FBQ0QsUUFBUSxFQUFFLENBQUM7UUFFZCxJQUFJLGtDQUFrQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQzNDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUNkLFdBQVcsU0FBUyxpRUFBaUUsQ0FDdEYsQ0FBQztZQUNGLE1BQU0sSUFBSSw0QkFBbUIsQ0FDM0IsaUhBQWlILENBQ2xILENBQUM7UUFDSixDQUFDO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNILEtBQUssQ0FBQyxzQ0FBc0MsQ0FDMUMsU0FBaUI7UUFFakIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQ2IsNkRBQTZELFNBQVMsRUFBRSxDQUN6RSxDQUFDO1FBRUYsNkVBQTZFO1FBQzdFLE1BQU0sa0NBQWtDLEdBQUcsTUFBTSxJQUFJLENBQUMscUJBQXFCO2FBQ3hFLGtCQUFrQixDQUFDLGFBQWEsQ0FBQzthQUNqQyxLQUFLLENBQUMsMENBQTBDLEVBQUUsRUFBRSxTQUFTLEVBQUUsQ0FBQzthQUNoRSxRQUFRLENBQUMsZ0RBQWdELEVBQUU7WUFDMUQsY0FBYyxFQUFFO2dCQUNkLHNDQUFpQixDQUFDLFNBQVM7Z0JBQzNCLHNDQUFpQixDQUFDLFVBQVU7Z0JBQzVCLHNDQUFpQixDQUFDLFNBQVM7YUFDNUI7U0FDRixDQUFDO2FBQ0QsUUFBUSxFQUFFLENBQUM7UUFFZCxJQUFJLGtDQUFrQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQzNDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUNkLFdBQVcsU0FBUyx5REFBeUQsQ0FDOUUsQ0FBQztZQUNGLE1BQU0sSUFBSSw0QkFBbUIsQ0FDM0Isa0hBQWtILENBQ25ILENBQUM7UUFDSixDQUFDO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNILEtBQUssQ0FBQyxpQ0FBaUMsQ0FDckMsa0JBQTRCO1FBRTVCLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUNiLDhDQUE4QyxrQkFBa0IsQ0FBQyxNQUFNLFVBQVUsQ0FDbEYsQ0FBQztRQUVGLDRDQUE0QztRQUM1QyxLQUFLLE1BQU0sU0FBUyxJQUFJLGtCQUFrQixFQUFFLENBQUM7WUFDM0MsTUFBTSxJQUFJLENBQUMsc0NBQXNDLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDL0QsQ0FBQztRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztDQUNGLENBQUE7QUFqSFksc0VBQTZCO3dDQUE3Qiw2QkFBNkI7SUFEekMsSUFBQSxtQkFBVSxHQUFFO0lBS1IsV0FBQSxJQUFBLDBCQUFnQixFQUFDLGdDQUFXLENBQUMsQ0FBQTt5REFDQyxvQkFBVSxvQkFBVixvQkFBVTtHQUxoQyw2QkFBNkIsQ0FpSHpDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxtb2R1bGVzXFxzb2xpY2l0YWNhb1xcc2VydmljZXNcXHZhbGlkYWNhby1leGNsdXNpdmlkYWRlLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTG9nZ2VyLCBCYWRSZXF1ZXN0RXhjZXB0aW9uIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgUmVwb3NpdG9yeSB9IGZyb20gJ3R5cGVvcm0nO1xuaW1wb3J0IHsgSW5qZWN0UmVwb3NpdG9yeSB9IGZyb20gJ0BuZXN0anMvdHlwZW9ybSc7XG5pbXBvcnQge1xuICBTb2xpY2l0YWNhbyxcbiAgU3RhdHVzU29saWNpdGFjYW8sXG59IGZyb20gJy4uLy4uLy4uL2VudGl0aWVzL3NvbGljaXRhY2FvLmVudGl0eSc7XG5cbi8qKlxuICogU2VydmnDp28gcmVzcG9uc8OhdmVsIHBvciB2YWxpZGFyIGEgZXhjbHVzaXZpZGFkZSBkZSBwYXDDqWlzIGRvcyBjaWRhZMOjb3NcbiAqIG5hcyBzb2xpY2l0YcOnw7VlcyBkZSBiZW5lZsOtY2lvcy5cbiAqXG4gKiBDb25mb3JtZSByZXF1aXNpdG8gY3LDrXRpY28gKDUuMSBFeGNsdXNpdmlkYWRlIGRlIFBhcMOpaXMpIGRhIGVzcGVjaWZpY2HDp8OjbyB0w6ljbmljYSxcbiAqIHVtIGNpZGFkw6NvIG7Do28gcG9kZSBzaW11bHRhbmVhbWVudGUgc2VyIGJlbmVmaWNpw6FyaW8gcHJpbmNpcGFsIGVcbiAqIGZhemVyIHBhcnRlIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhciBkZSBvdXRybyBiZW5lZmljacOhcmlvLlxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgVmFsaWRhY2FvRXhjbHVzaXZpZGFkZVNlcnZpY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IGxvZ2dlciA9IG5ldyBMb2dnZXIoVmFsaWRhY2FvRXhjbHVzaXZpZGFkZVNlcnZpY2UubmFtZSk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdFJlcG9zaXRvcnkoU29saWNpdGFjYW8pXG4gICAgcHJpdmF0ZSBzb2xpY2l0YWNhb1JlcG9zaXRvcnk6IFJlcG9zaXRvcnk8U29saWNpdGFjYW8+LFxuICApIHt9XG5cbiAgLyoqXG4gICAqIFZhbGlkYSBzZSB1bSBjaWRhZMOjbyBwb2RlIHNlciBiZW5lZmljacOhcmlvIHByaW5jaXBhbFxuICAgKiB2ZXJpZmljYW5kbyBzZSBlbGUgbsOjbyBmYXogcGFydGUgZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyIGRlIG91dHJhcyBzb2xpY2l0YcOnw7VlcyBhdGl2YXNcbiAgICpcbiAgICogQHBhcmFtIGNpZGFkYW9JZCBJRCBkbyBjaWRhZMOjbyBhIHNlciB2YWxpZGFkb1xuICAgKiBAcmV0dXJucyB0cnVlIHNlIG8gY2lkYWTDo28gcG9kZSBzZXIgYmVuZWZpY2nDoXJpbywgZmFsc2UgY2FzbyBjb250csOhcmlvXG4gICAqIEB0aHJvd3MgQmFkUmVxdWVzdEV4Y2VwdGlvbiBzZSBvIGNpZGFkw6NvIGrDoSBmYXogcGFydGUgZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyIGRlIG91dHJhIHNvbGljaXRhw6fDo29cbiAgICovXG4gIGFzeW5jIHZhbGlkYXJFeGNsdXNpdmlkYWRlQmVuZWZpY2lhcmlvKGNpZGFkYW9JZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgYFZhbGlkYW5kbyBleGNsdXNpdmlkYWRlIGRlIHBhcGVsIHBhcmEgY2lkYWTDo28gJHtjaWRhZGFvSWR9YCxcbiAgICApO1xuXG4gICAgLy8gVmVyaWZpY2Egc2UgbyBjaWRhZMOjbyBmYXogcGFydGUgZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyIGRlIGFsZ3VtYSBzb2xpY2l0YcOnw6NvIGF0aXZhXG4gICAgY29uc3Qgc29saWNpdGFjb2VzQ29tQ2lkYWRhb05hQ29tcG9zaWNhbyA9IGF3YWl0IHRoaXMuc29saWNpdGFjYW9SZXBvc2l0b3J5XG4gICAgICAuY3JlYXRlUXVlcnlCdWlsZGVyKCdzb2xpY2l0YWNhbycpXG4gICAgICAud2hlcmUoXG4gICAgICAgIGBzb2xpY2l0YWNhby5kYWRvc19jb21wbGVtZW50YXJlcy0+J2NvbXBvc2ljYW9fZmFtaWxpYXInIEA+IDptZW1icm9gLFxuICAgICAgICB7XG4gICAgICAgICAgbWVtYnJvOiBKU09OLnN0cmluZ2lmeShbeyBjaWRhZGFvX2lkOiBjaWRhZGFvSWQgfV0pLFxuICAgICAgICB9LFxuICAgICAgKVxuICAgICAgLmFuZFdoZXJlKGBzb2xpY2l0YWNhby5zdGF0dXMgTk9UIElOICg6Li4uc3RhdHVzSW5hdGl2b3MpYCwge1xuICAgICAgICBzdGF0dXNJbmF0aXZvczogW1xuICAgICAgICAgIFN0YXR1c1NvbGljaXRhY2FvLkNBTkNFTEFEQSxcbiAgICAgICAgICBTdGF0dXNTb2xpY2l0YWNhby5JTkRFRkVSSURBLFxuICAgICAgICAgIFN0YXR1c1NvbGljaXRhY2FvLkFSUVVJVkFEQSxcbiAgICAgICAgXSxcbiAgICAgIH0pXG4gICAgICAuZ2V0Q291bnQoKTtcblxuICAgIGlmIChzb2xpY2l0YWNvZXNDb21DaWRhZGFvTmFDb21wb3NpY2FvID4gMCkge1xuICAgICAgdGhpcy5sb2dnZXIud2FybihcbiAgICAgICAgYENpZGFkw6NvICR7Y2lkYWRhb0lkfSBqw6EgZmF6IHBhcnRlIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhciBkZSBvdXRyYSBzb2xpY2l0YcOnw6NvIGF0aXZhYCxcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbihcbiAgICAgICAgJ0NpZGFkw6NvIG7Do28gcG9kZSBzZXIgYmVuZWZpY2nDoXJpbyBwcmluY2lwYWwgcG9pcyBqw6EgZmF6IHBhcnRlIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhciBkZSBvdXRyYSBzb2xpY2l0YcOnw6NvIGF0aXZhJyxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhIHNlIHVtIGNpZGFkw6NvIHBvZGUgc2VyIGluY2x1w61kbyBuYSBjb21wb3Npw6fDo28gZmFtaWxpYXJcbiAgICogdmVyaWZpY2FuZG8gc2UgZWxlIG7Do28gw6kgYmVuZWZpY2nDoXJpbyBwcmluY2lwYWwgZW0gb3V0cmFzIHNvbGljaXRhw6fDtWVzIGF0aXZhc1xuICAgKlxuICAgKiBAcGFyYW0gY2lkYWRhb0lkIElEIGRvIGNpZGFkw6NvIGEgc2VyIHZhbGlkYWRvXG4gICAqIEByZXR1cm5zIHRydWUgc2UgbyBjaWRhZMOjbyBwb2RlIHNlciBpbmNsdcOtZG8gbmEgY29tcG9zacOnw6NvIGZhbWlsaWFyLCBmYWxzZSBjYXNvIGNvbnRyw6FyaW9cbiAgICogQHRocm93cyBCYWRSZXF1ZXN0RXhjZXB0aW9uIHNlIG8gY2lkYWTDo28gasOhIMOpIGJlbmVmaWNpw6FyaW8gcHJpbmNpcGFsIGVtIG91dHJhIHNvbGljaXRhw6fDo29cbiAgICovXG4gIGFzeW5jIHZhbGlkYXJFeGNsdXNpdmlkYWRlQ29tcG9zaWNhb0ZhbWlsaWFyKFxuICAgIGNpZGFkYW9JZDogc3RyaW5nLFxuICApOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICBgVmFsaWRhbmRvIGV4Y2x1c2l2aWRhZGUgcGFyYSBjb21wb3Npw6fDo28gZmFtaWxpYXI6IGNpZGFkw6NvICR7Y2lkYWRhb0lkfWAsXG4gICAgKTtcblxuICAgIC8vIFZlcmlmaWNhIHNlIG8gY2lkYWTDo28gw6kgYmVuZWZpY2nDoXJpbyBwcmluY2lwYWwgZW0gYWxndW1hIHNvbGljaXRhw6fDo28gYXRpdmFcbiAgICBjb25zdCBzb2xpY2l0YWNvZXNDb21DaWRhZGFvQmVuZWZpY2lhcmlvID0gYXdhaXQgdGhpcy5zb2xpY2l0YWNhb1JlcG9zaXRvcnlcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoJ3NvbGljaXRhY2FvJylcbiAgICAgIC53aGVyZSgnc29saWNpdGFjYW8uYmVuZWZpY2lhcmlvX2lkID0gOmNpZGFkYW9JZCcsIHsgY2lkYWRhb0lkIH0pXG4gICAgICAuYW5kV2hlcmUoYHNvbGljaXRhY2FvLnN0YXR1cyBOT1QgSU4gKDouLi5zdGF0dXNJbmF0aXZvcylgLCB7XG4gICAgICAgIHN0YXR1c0luYXRpdm9zOiBbXG4gICAgICAgICAgU3RhdHVzU29saWNpdGFjYW8uQ0FOQ0VMQURBLFxuICAgICAgICAgIFN0YXR1c1NvbGljaXRhY2FvLklOREVGRVJJREEsXG4gICAgICAgICAgU3RhdHVzU29saWNpdGFjYW8uQVJRVUlWQURBLFxuICAgICAgICBdLFxuICAgICAgfSlcbiAgICAgIC5nZXRDb3VudCgpO1xuXG4gICAgaWYgKHNvbGljaXRhY29lc0NvbUNpZGFkYW9CZW5lZmljaWFyaW8gPiAwKSB7XG4gICAgICB0aGlzLmxvZ2dlci53YXJuKFxuICAgICAgICBgQ2lkYWTDo28gJHtjaWRhZGFvSWR9IGrDoSDDqSBiZW5lZmljacOhcmlvIHByaW5jaXBhbCBlbSBvdXRyYSBzb2xpY2l0YcOnw6NvIGF0aXZhYCxcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbihcbiAgICAgICAgJ0NpZGFkw6NvIG7Do28gcG9kZSBzZXIgaW5jbHXDrWRvIG5hIGNvbXBvc2nDp8OjbyBmYW1pbGlhciBwb2lzIGrDoSDDqSBiZW5lZmljacOhcmlvIHByaW5jaXBhbCBlbSBvdXRyYSBzb2xpY2l0YcOnw6NvIGF0aXZhJyxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhIGEgY29tcG9zacOnw6NvIGZhbWlsaWFyIGNvbXBsZXRhLCB2ZXJpZmljYW5kbyBzZSB0b2RvcyBvcyBtZW1icm9zXG4gICAqIHBvZGVtIHNlciBpbmNsdcOtZG9zIChuw6NvIHPDo28gYmVuZWZpY2nDoXJpb3MgcHJpbmNpcGFpcyBlbSBvdXRyYXMgc29saWNpdGHDp8O1ZXMpXG4gICAqXG4gICAqIEBwYXJhbSBjb21wb3NpY2FvRmFtaWxpYXIgQXJyYXkgZGUgSURzIGRlIGNpZGFkw6NvcyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXJcbiAgICogQHJldHVybnMgdHJ1ZSBzZSB0b2RvcyBvcyBtZW1icm9zIHBvZGVtIHNlciBpbmNsdcOtZG9zIG5hIGNvbXBvc2nDp8OjbyBmYW1pbGlhclxuICAgKiBAdGhyb3dzIEJhZFJlcXVlc3RFeGNlcHRpb24gc2UgYWxndW0gbWVtYnJvIG7Do28gcG9kZSBzZXIgaW5jbHXDrWRvXG4gICAqL1xuICBhc3luYyB2YWxpZGFyQ29tcG9zaWNhb0ZhbWlsaWFyQ29tcGxldGEoXG4gICAgY29tcG9zaWNhb0ZhbWlsaWFyOiBzdHJpbmdbXSxcbiAgKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgYFZhbGlkYW5kbyBjb21wb3Npw6fDo28gZmFtaWxpYXIgY29tcGxldGEgY29tICR7Y29tcG9zaWNhb0ZhbWlsaWFyLmxlbmd0aH0gbWVtYnJvc2AsXG4gICAgKTtcblxuICAgIC8vIFZhbGlkYSBjYWRhIG1lbWJybyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXJcbiAgICBmb3IgKGNvbnN0IGNpZGFkYW9JZCBvZiBjb21wb3NpY2FvRmFtaWxpYXIpIHtcbiAgICAgIGF3YWl0IHRoaXMudmFsaWRhckV4Y2x1c2l2aWRhZGVDb21wb3NpY2FvRmFtaWxpYXIoY2lkYWRhb0lkKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9