516f0a075e525410b18420484c7a2721
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const common_1 = require("@nestjs/common");
const papel_cidadao_service_1 = require("@modules/cidadao/services/papel-cidadao.service");
const cidadao_service_1 = require("@modules/cidadao/services/cidadao.service");
const verificacao_papel_service_1 = require("@modules/cidadao/services/verificacao-papel.service");
const papel_cidadao_entity_1 = require("@modules/cidadao/entities/papel-cidadao.entity");
const tipo_papel_enum_1 = require("@modules/cidadao/enums/tipo-papel.enum");
describe('PapelCidadaoService', () => {
    let service;
    let repository;
    let cidadaoService;
    let verificacaoPapelService;
    let dataSource;
    const mockRepository = {
        create: jest.fn(),
        save: jest.fn(),
        find: jest.fn(),
        findOne: jest.fn(),
        update: jest.fn(),
    };
    const mockCidadaoService = {
        findById: jest.fn(),
    };
    const mockVerificacaoPapelService = {
        verificarConflitoPapeis: jest.fn(),
    };
    const mockQueryRunner = {
        connect: jest.fn(),
        startTransaction: jest.fn(),
        commitTransaction: jest.fn(),
        rollbackTransaction: jest.fn(),
        release: jest.fn(),
        manager: {
            create: jest.fn(),
            save: jest.fn(),
            findOne: jest.fn(),
        },
    };
    const mockDataSource = {
        createQueryRunner: jest.fn().mockReturnValue(mockQueryRunner),
        transaction: jest.fn(),
    };
    const mockCidadaoResponse = {
        id: '550e8400-e29b-41d4-a716-446655440000',
        nome: 'João da Silva',
        cpf: '12345678901',
        email: 'joao@example.com',
    };
    const mockPapelCidadao = {
        id: '660e8400-e29b-41d4-a716-446655440000',
        cidadao_id: '550e8400-e29b-41d4-a716-446655440000',
        tipo_papel: tipo_papel_enum_1.TipoPapel.BENEFICIARIO,
        ativo: true,
        metadados: {},
        created_at: new Date(),
        updated_at: new Date(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                papel_cidadao_service_1.PapelCidadaoService,
                {
                    provide: (0, typeorm_1.getRepositoryToken)(papel_cidadao_entity_1.PapelCidadao),
                    useValue: mockRepository,
                },
                {
                    provide: cidadao_service_1.CidadaoService,
                    useValue: mockCidadaoService,
                },
                {
                    provide: verificacao_papel_service_1.VerificacaoPapelService,
                    useValue: mockVerificacaoPapelService,
                },
                {
                    provide: typeorm_2.DataSource,
                    useValue: mockDataSource,
                },
            ],
        }).compile();
        service = module.get(papel_cidadao_service_1.PapelCidadaoService);
        repository = module.get((0, typeorm_1.getRepositoryToken)(papel_cidadao_entity_1.PapelCidadao));
        cidadaoService = module.get(cidadao_service_1.CidadaoService);
        verificacaoPapelService = module.get(verificacao_papel_service_1.VerificacaoPapelService);
        dataSource = module.get(typeorm_2.DataSource);
        jest.clearAllMocks();
    });
    it('deve estar definido', () => {
        expect(service).toBeDefined();
    });
    describe('create', () => {
        const createPapelDto = {
            cidadao_id: '550e8400-e29b-41d4-a716-446655440000',
            tipo_papel: tipo_papel_enum_1.TipoPapel.BENEFICIARIO,
            metadados: {},
        };
        it('deve criar um papel com sucesso', async () => {
            // Mock para verificação de cidadão existente
            mockCidadaoService.findById.mockResolvedValue(mockCidadaoResponse);
            // Mock para verificação inicial de papel existente
            mockRepository.findOne.mockResolvedValue(null);
            mockDataSource.transaction.mockImplementation(async (callback) => {
                const manager = {
                    findOne: jest.fn().mockResolvedValue(mockCidadaoResponse), // Cidadão encontrado na transação
                    create: jest.fn().mockReturnValue(mockPapelCidadao),
                    save: jest.fn().mockResolvedValue(mockPapelCidadao),
                };
                return callback(manager);
            });
            const result = await service.create(createPapelDto);
            expect(mockCidadaoService.findById).toHaveBeenCalledWith(createPapelDto.cidadao_id, false);
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: {
                    cidadao_id: createPapelDto.cidadao_id,
                    tipo_papel: createPapelDto.tipo_papel,
                    ativo: true,
                },
            });
            expect(result).toEqual(mockPapelCidadao);
        });
        it('deve lançar NotFoundException quando cidadão não existir', async () => {
            mockCidadaoService.findById.mockResolvedValue(null);
            await expect(service.create(createPapelDto)).rejects.toThrow(common_1.NotFoundException);
            expect(mockCidadaoService.findById).toHaveBeenCalledWith(createPapelDto.cidadao_id, false);
        });
        it('deve lançar ConflictException quando cidadão já possuir o papel', async () => {
            // Mock para verificação de cidadão existente
            mockCidadaoService.findById.mockResolvedValue(mockCidadaoResponse);
            // Mock para verificação inicial de papel existente - retorna papel existente
            mockRepository.findOne.mockResolvedValue(mockPapelCidadao);
            await expect(service.create(createPapelDto)).rejects.toThrow(common_1.ConflictException);
            expect(mockCidadaoService.findById).toHaveBeenCalledWith(createPapelDto.cidadao_id, false);
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: {
                    cidadao_id: createPapelDto.cidadao_id,
                    tipo_papel: createPapelDto.tipo_papel,
                    ativo: true,
                },
            });
        });
        it('deve lançar NotFoundException quando cidadão não existir na transação', async () => {
            // Mock para verificação inicial de papel existente
            mockRepository.findOne.mockResolvedValue(null);
            mockDataSource.transaction.mockImplementation(async (callback) => {
                const manager = {
                    findOne: jest.fn().mockResolvedValue(null), // Cidadão não encontrado na transação
                    create: jest.fn(),
                    save: jest.fn(),
                };
                return callback(manager);
            });
            await expect(service.create(createPapelDto)).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('createMany', () => {
        const cidadaoId = '550e8400-e29b-41d4-a716-446655440000';
        const papeis = [
            {
                tipo_papel: tipo_papel_enum_1.TipoPapel.BENEFICIARIO,
                metadados: {},
            },
            {
                tipo_papel: tipo_papel_enum_1.TipoPapel.MEMBRO_COMPOSICAO,
                metadados: {},
            },
        ];
        it('deve criar múltiplos papéis com sucesso', async () => {
            mockDataSource.transaction.mockImplementation(async (callback) => {
                const manager = {
                    findOne: jest
                        .fn()
                        .mockResolvedValueOnce(null) // Primeiro papel não existe
                        .mockResolvedValueOnce(mockCidadaoResponse) // Cidadão encontrado para verificação de conflitos do primeiro papel
                        .mockResolvedValueOnce(null) // Segundo papel não existe
                        .mockResolvedValueOnce(mockCidadaoResponse), // Cidadão encontrado para verificação de conflitos do segundo papel
                    create: jest.fn().mockReturnValue([mockPapelCidadao]),
                    save: jest.fn().mockResolvedValue([mockPapelCidadao]),
                };
                return callback(manager);
            });
            mockCidadaoService.findById.mockResolvedValue(mockCidadaoResponse);
            mockVerificacaoPapelService.verificarConflitoPapeis.mockResolvedValue({
                temConflito: false,
                detalhes: '',
            });
            const result = await service.createMany(cidadaoId, papeis);
            expect(mockCidadaoService.findById).toHaveBeenCalledWith(cidadaoId, false);
            expect(result).toEqual([mockPapelCidadao]);
        });
        it('deve lançar BadRequestException quando lista estiver vazia', async () => {
            await expect(service.createMany(cidadaoId, [])).rejects.toThrow(common_1.BadRequestException);
        });
        it('deve lançar BadRequestException quando houver papéis duplicados', async () => {
            const papeisDuplicados = [
                {
                    tipo_papel: tipo_papel_enum_1.TipoPapel.BENEFICIARIO,
                    metadados: {},
                },
                {
                    tipo_papel: tipo_papel_enum_1.TipoPapel.BENEFICIARIO,
                    metadados: {},
                },
            ];
            mockDataSource.transaction.mockImplementation(async (callback) => {
                const manager = {
                    findOne: jest.fn(),
                    create: jest.fn(),
                    save: jest.fn(),
                };
                return callback(manager);
            });
            mockCidadaoService.findById.mockResolvedValue(mockCidadaoResponse);
            await expect(service.createMany(cidadaoId, papeisDuplicados)).rejects.toThrow(common_1.BadRequestException);
        });
        it('deve lançar NotFoundException quando cidadão não existir', async () => {
            mockDataSource.transaction.mockImplementation(async (callback) => {
                const manager = {
                    findOne: jest.fn(),
                    create: jest.fn(),
                    save: jest.fn(),
                };
                return callback(manager);
            });
            mockCidadaoService.findById.mockResolvedValue(null);
            await expect(service.createMany(cidadaoId, papeis)).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('findByCidadaoId', () => {
        it('deve retornar papéis do cidadão', async () => {
            const papeis = [mockPapelCidadao];
            mockRepository.find.mockResolvedValue(papeis);
            const result = await service.findByCidadaoId('550e8400-e29b-41d4-a716-446655440000');
            expect(mockRepository.find).toHaveBeenCalledWith({
                where: {
                    cidadao_id: '550e8400-e29b-41d4-a716-446655440000',
                    ativo: true,
                },
            });
            expect(result).toEqual(papeis);
        });
        it('deve filtrar por status ativo quando especificado', async () => {
            const papeis = [mockPapelCidadao];
            mockRepository.find.mockResolvedValue(papeis);
            const result = await service.findByCidadaoId('550e8400-e29b-41d4-a716-446655440000');
            expect(mockRepository.find).toHaveBeenCalledWith({
                where: {
                    cidadao_id: '550e8400-e29b-41d4-a716-446655440000',
                    ativo: true,
                },
            });
            expect(result).toEqual(papeis);
        });
    });
    describe('verificarPapel', () => {
        it('deve retornar true quando cidadão possuir o papel ativo', async () => {
            mockRepository.findOne.mockResolvedValue(mockPapelCidadao);
            const result = await service.verificarPapel('550e8400-e29b-41d4-a716-446655440000', tipo_papel_enum_1.TipoPapel.BENEFICIARIO);
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: {
                    cidadao_id: '550e8400-e29b-41d4-a716-446655440000',
                    tipo_papel: tipo_papel_enum_1.TipoPapel.BENEFICIARIO,
                    ativo: true,
                },
            });
            expect(result).toBe(true);
        });
        it('deve retornar false quando cidadão não possuir o papel', async () => {
            mockRepository.findOne.mockResolvedValue(null);
            const result = await service.verificarPapel('550e8400-e29b-41d4-a716-446655440000', tipo_papel_enum_1.TipoPapel.BENEFICIARIO);
            expect(result).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFx0ZXN0XFx1bml0XFxjaWRhZGFvXFxwYXBlbC1jaWRhZGFvLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCw2Q0FBcUQ7QUFDckQscUNBQWlEO0FBQ2pELDJDQUl3QjtBQUN4QiwyRkFBc0Y7QUFDdEYsK0VBQTJFO0FBQzNFLG1HQUE4RjtBQUM5Rix5RkFBOEU7QUFDOUUsNEVBQW1FO0FBSW5FLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDbkMsSUFBSSxPQUE0QixDQUFDO0lBQ2pDLElBQUksVUFBb0MsQ0FBQztJQUN6QyxJQUFJLGNBQThCLENBQUM7SUFDbkMsSUFBSSx1QkFBZ0QsQ0FBQztJQUNyRCxJQUFJLFVBQXNCLENBQUM7SUFFM0IsTUFBTSxjQUFjLEdBQUc7UUFDckIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDakIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ2xCLENBQUM7SUFFRixNQUFNLGtCQUFrQixHQUFHO1FBQ3pCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ3BCLENBQUM7SUFFRixNQUFNLDJCQUEyQixHQUFHO1FBQ2xDLHVCQUF1QixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDbkMsQ0FBQztJQUVGLE1BQU0sZUFBZSxHQUFHO1FBQ3RCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDM0IsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUM1QixtQkFB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QUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzdCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHRlc3RcXHVuaXRcXGNpZGFkYW9cXHBhcGVsLWNpZGFkYW8uc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgZ2V0UmVwb3NpdG9yeVRva2VuIH0gZnJvbSAnQG5lc3Rqcy90eXBlb3JtJztcbmltcG9ydCB7IFJlcG9zaXRvcnksIERhdGFTb3VyY2UgfSBmcm9tICd0eXBlb3JtJztcbmltcG9ydCB7XG4gIE5vdEZvdW5kRXhjZXB0aW9uLFxuICBDb25mbGljdEV4Y2VwdGlvbixcbiAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgUGFwZWxDaWRhZGFvU2VydmljZSB9IGZyb20gJ0Btb2R1bGVzL2NpZGFkYW8vc2VydmljZXMvcGFwZWwtY2lkYWRhby5zZXJ2aWNlJztcbmltcG9ydCB7IENpZGFkYW9TZXJ2aWNlIH0gZnJvbSAnQG1vZHVsZXMvY2lkYWRhby9zZXJ2aWNlcy9jaWRhZGFvLnNlcnZpY2UnO1xuaW1wb3J0IHsgVmVyaWZpY2FjYW9QYXBlbFNlcnZpY2UgfSBmcm9tICdAbW9kdWxlcy9jaWRhZGFvL3NlcnZpY2VzL3ZlcmlmaWNhY2FvLXBhcGVsLnNlcnZpY2UnO1xuaW1wb3J0IHsgUGFwZWxDaWRhZGFvIH0gZnJvbSAnQG1vZHVsZXMvY2lkYWRhby9lbnRpdGllcy9wYXBlbC1jaWRhZGFvLmVudGl0eSc7XG5pbXBvcnQgeyBUaXBvUGFwZWwgfSBmcm9tICdAbW9kdWxlcy9jaWRhZGFvL2VudW1zL3RpcG8tcGFwZWwuZW51bSc7XG5pbXBvcnQgeyBDcmVhdGVQYXBlbENpZGFkYW9EdG8gfSBmcm9tICdAbW9kdWxlcy9jaWRhZGFvL2R0by9jcmVhdGUtcGFwZWwtY2lkYWRhby5kdG8nO1xuaW1wb3J0IHsgQ2lkYWRhb1Jlc3BvbnNlRHRvIH0gZnJvbSAnQG1vZHVsZXMvY2lkYWRhby9kdG8vY2lkYWRhby1yZXNwb25zZS5kdG8nO1xuXG5kZXNjcmliZSgnUGFwZWxDaWRhZGFvU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IFBhcGVsQ2lkYWRhb1NlcnZpY2U7XG4gIGxldCByZXBvc2l0b3J5OiBSZXBvc2l0b3J5PFBhcGVsQ2lkYWRhbz47XG4gIGxldCBjaWRhZGFvU2VydmljZTogQ2lkYWRhb1NlcnZpY2U7XG4gIGxldCB2ZXJpZmljYWNhb1BhcGVsU2VydmljZTogVmVyaWZpY2FjYW9QYXBlbFNlcnZpY2U7XG4gIGxldCBkYXRhU291cmNlOiBEYXRhU291cmNlO1xuXG4gIGNvbnN0IG1vY2tSZXBvc2l0b3J5ID0ge1xuICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgIHNhdmU6IGplc3QuZm4oKSxcbiAgICBmaW5kOiBqZXN0LmZuKCksXG4gICAgZmluZE9uZTogamVzdC5mbigpLFxuICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tDaWRhZGFvU2VydmljZSA9IHtcbiAgICBmaW5kQnlJZDogamVzdC5mbigpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tWZXJpZmljYWNhb1BhcGVsU2VydmljZSA9IHtcbiAgICB2ZXJpZmljYXJDb25mbGl0b1BhcGVpczogamVzdC5mbigpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tRdWVyeVJ1bm5lciA9IHtcbiAgICBjb25uZWN0OiBqZXN0LmZuKCksXG4gICAgc3RhcnRUcmFuc2FjdGlvbjogamVzdC5mbigpLFxuICAgIGNvbW1pdFRyYW5zYWN0aW9uOiBqZXN0LmZuKCksXG4gICAgcm9sbGJhY2tUcmFuc2FjdGlvbjogamVzdC5mbigpLFxuICAgIHJlbGVhc2U6IGplc3QuZm4oKSxcbiAgICBtYW5hZ2VyOiB7XG4gICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgIHNhdmU6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRPbmU6IGplc3QuZm4oKSxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IG1vY2tEYXRhU291cmNlID0ge1xuICAgIGNyZWF0ZVF1ZXJ5UnVubmVyOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tRdWVyeVJ1bm5lciksXG4gICAgdHJhbnNhY3Rpb246IGplc3QuZm4oKSxcbiAgfTtcblxuICBjb25zdCBtb2NrQ2lkYWRhb1Jlc3BvbnNlOiBDaWRhZGFvUmVzcG9uc2VEdG8gPSB7XG4gICAgaWQ6ICc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnLFxuICAgIG5vbWU6ICdKb8OjbyBkYSBTaWx2YScsXG4gICAgY3BmOiAnMTIzNDU2Nzg5MDEnLFxuICAgIGVtYWlsOiAnam9hb0BleGFtcGxlLmNvbScsXG4gIH0gYXMgQ2lkYWRhb1Jlc3BvbnNlRHRvO1xuXG4gIGNvbnN0IG1vY2tQYXBlbENpZGFkYW86IFBhcGVsQ2lkYWRhbyA9IHtcbiAgICBpZDogJzY2MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsXG4gICAgY2lkYWRhb19pZDogJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsXG4gICAgdGlwb19wYXBlbDogVGlwb1BhcGVsLkJFTkVGSUNJQVJJTyxcbiAgICBhdGl2bzogdHJ1ZSxcbiAgICBtZXRhZGFkb3M6IHt9LFxuICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKSxcbiAgfSBhcyBQYXBlbENpZGFkYW87XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICBQYXBlbENpZGFkYW9TZXJ2aWNlLFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogZ2V0UmVwb3NpdG9yeVRva2VuKFBhcGVsQ2lkYWRhbyksXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tSZXBvc2l0b3J5LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQ2lkYWRhb1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tDaWRhZGFvU2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFZlcmlmaWNhY2FvUGFwZWxTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrVmVyaWZpY2FjYW9QYXBlbFNlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBEYXRhU291cmNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrRGF0YVNvdXJjZSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8UGFwZWxDaWRhZGFvU2VydmljZT4oUGFwZWxDaWRhZGFvU2VydmljZSk7XG4gICAgcmVwb3NpdG9yeSA9IG1vZHVsZS5nZXQ8UmVwb3NpdG9yeTxQYXBlbENpZGFkYW8+PihcbiAgICAgIGdldFJlcG9zaXRvcnlUb2tlbihQYXBlbENpZGFkYW8pLFxuICAgICk7XG4gICAgY2lkYWRhb1NlcnZpY2UgPSBtb2R1bGUuZ2V0PENpZGFkYW9TZXJ2aWNlPihDaWRhZGFvU2VydmljZSk7XG4gICAgdmVyaWZpY2FjYW9QYXBlbFNlcnZpY2UgPSBtb2R1bGUuZ2V0PFZlcmlmaWNhY2FvUGFwZWxTZXJ2aWNlPihcbiAgICAgIFZlcmlmaWNhY2FvUGFwZWxTZXJ2aWNlLFxuICAgICk7XG4gICAgZGF0YVNvdXJjZSA9IG1vZHVsZS5nZXQ8RGF0YVNvdXJjZT4oRGF0YVNvdXJjZSk7XG5cbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgaXQoJ2RldmUgZXN0YXIgZGVmaW5pZG8nLCAoKSA9PiB7XG4gICAgZXhwZWN0KHNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGUnLCAoKSA9PiB7XG4gICAgY29uc3QgY3JlYXRlUGFwZWxEdG86IENyZWF0ZVBhcGVsQ2lkYWRhb0R0byA9IHtcbiAgICAgIGNpZGFkYW9faWQ6ICc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnLFxuICAgICAgdGlwb19wYXBlbDogVGlwb1BhcGVsLkJFTkVGSUNJQVJJTyxcbiAgICAgIG1ldGFkYWRvczoge30sXG4gICAgfTtcblxuICAgIGl0KCdkZXZlIGNyaWFyIHVtIHBhcGVsIGNvbSBzdWNlc3NvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBwYXJhIHZlcmlmaWNhw6fDo28gZGUgY2lkYWTDo28gZXhpc3RlbnRlXG4gICAgICBtb2NrQ2lkYWRhb1NlcnZpY2UuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NpZGFkYW9SZXNwb25zZSk7XG4gICAgICAvLyBNb2NrIHBhcmEgdmVyaWZpY2HDp8OjbyBpbmljaWFsIGRlIHBhcGVsIGV4aXN0ZW50ZVxuICAgICAgbW9ja1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgbW9ja0RhdGFTb3VyY2UudHJhbnNhY3Rpb24ubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjYWxsYmFjaykgPT4ge1xuICAgICAgICBjb25zdCBtYW5hZ2VyID0ge1xuICAgICAgICAgIGZpbmRPbmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2lkYWRhb1Jlc3BvbnNlKSwgLy8gQ2lkYWTDo28gZW5jb250cmFkbyBuYSB0cmFuc2HDp8Ojb1xuICAgICAgICAgIGNyZWF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShtb2NrUGFwZWxDaWRhZGFvKSxcbiAgICAgICAgICBzYXZlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BhcGVsQ2lkYWRhbyksXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtYW5hZ2VyKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmNyZWF0ZShjcmVhdGVQYXBlbER0byk7XG5cbiAgICAgIGV4cGVjdChtb2NrQ2lkYWRhb1NlcnZpY2UuZmluZEJ5SWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBjcmVhdGVQYXBlbER0by5jaWRhZGFvX2lkLFxuICAgICAgICBmYWxzZSxcbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja1JlcG9zaXRvcnkuZmluZE9uZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGNpZGFkYW9faWQ6IGNyZWF0ZVBhcGVsRHRvLmNpZGFkYW9faWQsXG4gICAgICAgICAgdGlwb19wYXBlbDogY3JlYXRlUGFwZWxEdG8udGlwb19wYXBlbCxcbiAgICAgICAgICBhdGl2bzogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUGFwZWxDaWRhZGFvKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGxhbsOnYXIgTm90Rm91bmRFeGNlcHRpb24gcXVhbmRvIGNpZGFkw6NvIG7Do28gZXhpc3RpcicsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tDaWRhZGFvU2VydmljZS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuY3JlYXRlKGNyZWF0ZVBhcGVsRHRvKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChtb2NrQ2lkYWRhb1NlcnZpY2UuZmluZEJ5SWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBjcmVhdGVQYXBlbER0by5jaWRhZGFvX2lkLFxuICAgICAgICBmYWxzZSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIENvbmZsaWN0RXhjZXB0aW9uIHF1YW5kbyBjaWRhZMOjbyBqw6EgcG9zc3VpciBvIHBhcGVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBwYXJhIHZlcmlmaWNhw6fDo28gZGUgY2lkYWTDo28gZXhpc3RlbnRlXG4gICAgICBtb2NrQ2lkYWRhb1NlcnZpY2UuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NpZGFkYW9SZXNwb25zZSk7XG4gICAgICAvLyBNb2NrIHBhcmEgdmVyaWZpY2HDp8OjbyBpbmljaWFsIGRlIHBhcGVsIGV4aXN0ZW50ZSAtIHJldG9ybmEgcGFwZWwgZXhpc3RlbnRlXG4gICAgICBtb2NrUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQYXBlbENpZGFkYW8pO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5jcmVhdGUoY3JlYXRlUGFwZWxEdG8pKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIENvbmZsaWN0RXhjZXB0aW9uLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1vY2tDaWRhZGFvU2VydmljZS5maW5kQnlJZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGNyZWF0ZVBhcGVsRHRvLmNpZGFkYW9faWQsXG4gICAgICAgIGZhbHNlLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgY2lkYWRhb19pZDogY3JlYXRlUGFwZWxEdG8uY2lkYWRhb19pZCxcbiAgICAgICAgICB0aXBvX3BhcGVsOiBjcmVhdGVQYXBlbER0by50aXBvX3BhcGVsLFxuICAgICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIE5vdEZvdW5kRXhjZXB0aW9uIHF1YW5kbyBjaWRhZMOjbyBuw6NvIGV4aXN0aXIgbmEgdHJhbnNhw6fDo28nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIHBhcmEgdmVyaWZpY2HDp8OjbyBpbmljaWFsIGRlIHBhcGVsIGV4aXN0ZW50ZVxuICAgICAgbW9ja1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgbW9ja0RhdGFTb3VyY2UudHJhbnNhY3Rpb24ubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjYWxsYmFjaykgPT4ge1xuICAgICAgICBjb25zdCBtYW5hZ2VyID0ge1xuICAgICAgICAgIGZpbmRPbmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKSwgLy8gQ2lkYWTDo28gbsOjbyBlbmNvbnRyYWRvIG5hIHRyYW5zYcOnw6NvXG4gICAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICAgICAgc2F2ZTogamVzdC5mbigpLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sobWFuYWdlcik7XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuY3JlYXRlKGNyZWF0ZVBhcGVsRHRvKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVNYW55JywgKCkgPT4ge1xuICAgIGNvbnN0IGNpZGFkYW9JZCA9ICc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnO1xuICAgIGNvbnN0IHBhcGVpcyA9IFtcbiAgICAgIHtcbiAgICAgICAgdGlwb19wYXBlbDogVGlwb1BhcGVsLkJFTkVGSUNJQVJJTyxcbiAgICAgICAgbWV0YWRhZG9zOiB7fSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHRpcG9fcGFwZWw6IFRpcG9QYXBlbC5NRU1CUk9fQ09NUE9TSUNBTyxcbiAgICAgICAgbWV0YWRhZG9zOiB7fSxcbiAgICAgIH0sXG4gICAgXTtcblxuICAgIGl0KCdkZXZlIGNyaWFyIG3Dumx0aXBsb3MgcGFww6lpcyBjb20gc3VjZXNzbycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tEYXRhU291cmNlLnRyYW5zYWN0aW9uLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY2FsbGJhY2spID0+IHtcbiAgICAgICAgY29uc3QgbWFuYWdlciA9IHtcbiAgICAgICAgICBmaW5kT25lOiBqZXN0XG4gICAgICAgICAgICAuZm4oKVxuICAgICAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShudWxsKSAvLyBQcmltZWlybyBwYXBlbCBuw6NvIGV4aXN0ZVxuICAgICAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShtb2NrQ2lkYWRhb1Jlc3BvbnNlKSAvLyBDaWRhZMOjbyBlbmNvbnRyYWRvIHBhcmEgdmVyaWZpY2HDp8OjbyBkZSBjb25mbGl0b3MgZG8gcHJpbWVpcm8gcGFwZWxcbiAgICAgICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobnVsbCkgLy8gU2VndW5kbyBwYXBlbCBuw6NvIGV4aXN0ZVxuICAgICAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShtb2NrQ2lkYWRhb1Jlc3BvbnNlKSwgLy8gQ2lkYWTDo28gZW5jb250cmFkbyBwYXJhIHZlcmlmaWNhw6fDo28gZGUgY29uZmxpdG9zIGRvIHNlZ3VuZG8gcGFwZWxcbiAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoW21vY2tQYXBlbENpZGFkYW9dKSxcbiAgICAgICAgICBzYXZlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoW21vY2tQYXBlbENpZGFkYW9dKSxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG1hbmFnZXIpO1xuICAgICAgfSk7XG5cbiAgICAgIG1vY2tDaWRhZGFvU2VydmljZS5maW5kQnlJZC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2lkYWRhb1Jlc3BvbnNlKTtcbiAgICAgIG1vY2tWZXJpZmljYWNhb1BhcGVsU2VydmljZS52ZXJpZmljYXJDb25mbGl0b1BhcGVpcy5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHRlbUNvbmZsaXRvOiBmYWxzZSxcbiAgICAgICAgZGV0YWxoZXM6ICcnLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY3JlYXRlTWFueShjaWRhZGFvSWQsIHBhcGVpcyk7XG5cbiAgICAgIGV4cGVjdChtb2NrQ2lkYWRhb1NlcnZpY2UuZmluZEJ5SWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBjaWRhZGFvSWQsXG4gICAgICAgIGZhbHNlLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoW21vY2tQYXBlbENpZGFkYW9dKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGxhbsOnYXIgQmFkUmVxdWVzdEV4Y2VwdGlvbiBxdWFuZG8gbGlzdGEgZXN0aXZlciB2YXppYScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmNyZWF0ZU1hbnkoY2lkYWRhb0lkLCBbXSkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIEJhZFJlcXVlc3RFeGNlcHRpb24gcXVhbmRvIGhvdXZlciBwYXDDqWlzIGR1cGxpY2Fkb3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwYXBlaXNEdXBsaWNhZG9zID0gW1xuICAgICAgICB7XG4gICAgICAgICAgdGlwb19wYXBlbDogVGlwb1BhcGVsLkJFTkVGSUNJQVJJTyxcbiAgICAgICAgICBtZXRhZGFkb3M6IHt9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdGlwb19wYXBlbDogVGlwb1BhcGVsLkJFTkVGSUNJQVJJTyxcbiAgICAgICAgICBtZXRhZGFkb3M6IHt9LFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja0RhdGFTb3VyY2UudHJhbnNhY3Rpb24ubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChjYWxsYmFjaykgPT4ge1xuICAgICAgICBjb25zdCBtYW5hZ2VyID0ge1xuICAgICAgICAgIGZpbmRPbmU6IGplc3QuZm4oKSxcbiAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgICBzYXZlOiBqZXN0LmZuKCksXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtYW5hZ2VyKTtcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrQ2lkYWRhb1NlcnZpY2UuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NpZGFkYW9SZXNwb25zZSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5jcmVhdGVNYW55KGNpZGFkYW9JZCwgcGFwZWlzRHVwbGljYWRvcyksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGxhbsOnYXIgTm90Rm91bmRFeGNlcHRpb24gcXVhbmRvIGNpZGFkw6NvIG7Do28gZXhpc3RpcicsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tEYXRhU291cmNlLnRyYW5zYWN0aW9uLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY2FsbGJhY2spID0+IHtcbiAgICAgICAgY29uc3QgbWFuYWdlciA9IHtcbiAgICAgICAgICBmaW5kT25lOiBqZXN0LmZuKCksXG4gICAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICAgICAgc2F2ZTogamVzdC5mbigpLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sobWFuYWdlcik7XG4gICAgICB9KTtcblxuICAgICAgbW9ja0NpZGFkYW9TZXJ2aWNlLmZpbmRCeUlkLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5jcmVhdGVNYW55KGNpZGFkYW9JZCwgcGFwZWlzKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmaW5kQnlDaWRhZGFvSWQnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgcGFww6lpcyBkbyBjaWRhZMOjbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcGVpcyA9IFttb2NrUGFwZWxDaWRhZGFvXTtcbiAgICAgIG1vY2tSZXBvc2l0b3J5LmZpbmQubW9ja1Jlc29sdmVkVmFsdWUocGFwZWlzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kQnlDaWRhZGFvSWQoXG4gICAgICAgICc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1vY2tSZXBvc2l0b3J5LmZpbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBjaWRhZGFvX2lkOiAnNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwJyxcbiAgICAgICAgICBhdGl2bzogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChwYXBlaXMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZmlsdHJhciBwb3Igc3RhdHVzIGF0aXZvIHF1YW5kbyBlc3BlY2lmaWNhZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwYXBlaXMgPSBbbW9ja1BhcGVsQ2lkYWRhb107XG4gICAgICBtb2NrUmVwb3NpdG9yeS5maW5kLm1vY2tSZXNvbHZlZFZhbHVlKHBhcGVpcyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZEJ5Q2lkYWRhb0lkKFxuICAgICAgICAnNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwJyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5maW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgY2lkYWRhb19pZDogJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsXG4gICAgICAgICAgYXRpdm86IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwocGFwZWlzKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZlcmlmaWNhclBhcGVsJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIHRydWUgcXVhbmRvIGNpZGFkw6NvIHBvc3N1aXIgbyBwYXBlbCBhdGl2bycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tSZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BhcGVsQ2lkYWRhbyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudmVyaWZpY2FyUGFwZWwoXG4gICAgICAgICc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnLFxuICAgICAgICBUaXBvUGFwZWwuQkVORUZJQ0lBUklPLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1vY2tSZXBvc2l0b3J5LmZpbmRPbmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBjaWRhZGFvX2lkOiAnNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwJyxcbiAgICAgICAgICB0aXBvX3BhcGVsOiBUaXBvUGFwZWwuQkVORUZJQ0lBUklPLFxuICAgICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgZmFsc2UgcXVhbmRvIGNpZGFkw6NvIG7Do28gcG9zc3VpciBvIHBhcGVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52ZXJpZmljYXJQYXBlbChcbiAgICAgICAgJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsXG4gICAgICAgIFRpcG9QYXBlbC5CRU5FRklDSUFSSU8sXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==