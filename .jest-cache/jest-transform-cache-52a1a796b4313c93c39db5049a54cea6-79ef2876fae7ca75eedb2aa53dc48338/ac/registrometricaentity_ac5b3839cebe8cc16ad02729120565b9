1dc991ebffbda144c06276c1315f8f47
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.RegistroMetrica = void 0;
const typeorm_1 = require("typeorm");
const class_validator_1 = require("class-validator");
const metrica_entity_1 = require("./metrica.entity");
/**
 * Entidade que representa um registro de métrica
 *
 * Esta entidade armazena os valores coletados para uma métrica específica,
 * incluindo o timestamp da coleta e detalhes adicionais.
 *
 * A tabela é particionada por tempo para otimizar o desempenho em consultas
 * com grandes volumes de dados.
 */
let RegistroMetrica = class RegistroMetrica {
    id;
    metrica_definicao_id;
    metrica;
    valor;
    created_at;
    detalhes;
    ip_origem;
    usuario_id;
    endpoint;
};
exports.RegistroMetrica = RegistroMetrica;
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)('uuid'),
    __metadata("design:type", String)
], RegistroMetrica.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'uuid' }),
    (0, typeorm_1.Index)('idx_registros_metricas_definicao_id'),
    (0, class_validator_1.IsNotEmpty)({ message: 'ID da definição de métrica é obrigatório' }),
    (0, class_validator_1.IsUUID)('4', { message: 'ID da definição de métrica inválido' }),
    __metadata("design:type", String)
], RegistroMetrica.prototype, "metrica_definicao_id", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => metrica_entity_1.Metrica, (metrica) => metrica.registros),
    (0, typeorm_1.JoinColumn)({ name: 'metrica_id' }),
    __metadata("design:type", typeof (_a = typeof metrica_entity_1.Metrica !== "undefined" && metrica_entity_1.Metrica) === "function" ? _a : Object)
], RegistroMetrica.prototype, "metrica", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'numeric', precision: 15, scale: 2 }),
    (0, class_validator_1.IsNotEmpty)({ message: 'Valor é obrigatório' }),
    (0, class_validator_1.IsNumber)({}, { message: 'Valor deve ser um número' }),
    __metadata("design:type", Number)
], RegistroMetrica.prototype, "valor", void 0);
__decorate([
    (0, typeorm_1.CreateDateColumn)({ name: 'created_at' }),
    (0, typeorm_1.Index)('idx_registros_metricas_timestamp'),
    __metadata("design:type", typeof (_b = typeof Date !== "undefined" && Date) === "function" ? _b : Object)
], RegistroMetrica.prototype, "created_at", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'jsonb', nullable: true }),
    __metadata("design:type", typeof (_c = typeof Record !== "undefined" && Record) === "function" ? _c : Object)
], RegistroMetrica.prototype, "detalhes", void 0);
__decorate([
    (0, typeorm_1.Column)({ length: 45, nullable: true }),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsIP)(undefined, { message: 'IP de origem inválido' }),
    __metadata("design:type", String)
], RegistroMetrica.prototype, "ip_origem", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'uuid', nullable: true }),
    (0, typeorm_1.Index)('idx_registros_metricas_usuario_id'),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsUUID)('4', { message: 'ID do usuário inválido' }),
    __metadata("design:type", String)
], RegistroMetrica.prototype, "usuario_id", void 0);
__decorate([
    (0, typeorm_1.Column)({ length: 255, nullable: true }),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsString)({ message: 'Endpoint deve ser uma string' }),
    (0, class_validator_1.MaxLength)(255, { message: 'Endpoint deve ter no máximo 255 caracteres' }),
    __metadata("design:type", String)
], RegistroMetrica.prototype, "endpoint", void 0);
exports.RegistroMetrica = RegistroMetrica = __decorate([
    (0, typeorm_1.Entity)('registros_metricas')
], RegistroMetrica);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGVudGl0aWVzXFxyZWdpc3Ryby1tZXRyaWNhLmVudGl0eS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEscUNBUWlCO0FBQ2pCLHFEQVN5QjtBQUV6QixxREFBMkM7QUFFM0M7Ozs7Ozs7O0dBUUc7QUFFSSxJQUFNLGVBQWUsR0FBckIsTUFBTSxlQUFlO0lBRTFCLEVBQUUsQ0FBUztJQU1YLG9CQUFvQixDQUFTO0lBSTdCLE9BQU8sQ0FBVTtJQUtqQixLQUFLLENBQVM7SUFJZCxVQUFVLENBQU87SUFHakIsUUFBUSxDQUFzQjtJQUs5QixTQUFTLENBQVM7SUFNbEIsVUFBVSxDQUFTO0lBTW5CLFFBQVEsQ0FBUztDQUNsQixDQUFBO0FBMUNZLDBDQUFlO0FBRTFCO0lBREMsSUFBQSxnQ0FBc0IsRUFBQyxNQUFNLENBQUM7OzJDQUNwQjtBQU1YO0lBSkMsSUFBQSxnQkFBTSxFQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDO0lBQ3hCLElBQUEsZUFBSyxFQUFDLHFDQUFxQyxDQUFDO0lBQzVDLElBQUEsNEJBQVUsRUFBQyxFQUFFLE9BQU8sRUFBRSwwQ0FBMEMsRUFBRSxDQUFDO0lBQ25FLElBQUEsd0JBQU0sRUFBQyxHQUFHLEVBQUUsRUFBRSxPQUFPLEVBQUUscUNBQXFDLEVBQUUsQ0FBQzs7NkRBQ25DO0FBSTdCO0lBRkMsSUFBQSxtQkFBUyxFQUFDLEdBQUcsRUFBRSxDQUFDLHdCQUFPLEVBQUUsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7SUFDeEQsSUFBQSxvQkFBVSxFQUFDLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDO2tEQUMxQix3QkFBTyxvQkFBUCx3QkFBTztnREFBQztBQUtqQjtJQUhDLElBQUEsZ0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUM7SUFDcEQsSUFBQSw0QkFBVSxFQUFDLEVBQUUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLENBQUM7SUFDOUMsSUFBQSwwQkFBUSxFQUFDLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxDQUFDOzs4Q0FDeEM7QUFJZDtJQUZDLElBQUEsMEJBQWdCLEVBQUMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLENBQUM7SUFDeEMsSUFBQSxlQUFLLEVBQUMsa0NBQWtDLENBQUM7a0RBQzlCLElBQUksb0JBQUosSUFBSTttREFBQztBQUdqQjtJQURDLElBQUEsZ0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDO2tEQUNoQyxNQUFNLG9CQUFOLE1BQU07aURBQWM7QUFLOUI7SUFIQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUN0QyxJQUFBLDRCQUFVLEdBQUU7SUFDWixJQUFBLHNCQUFJLEVBQUMsU0FBUyxFQUFFLEVBQUUsT0FBTyxFQUFFLHVCQUF1QixFQUFFLENBQUM7O2tEQUNwQztBQU1sQjtJQUpDLElBQUEsZ0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDO0lBQ3hDLElBQUEsZUFBSyxFQUFDLG1DQUFtQyxDQUFDO0lBQzFDLElBQUEsNEJBQVUsR0FBRTtJQUNaLElBQUEsd0JBQU0sRUFBQyxHQUFHLEVBQUUsRUFBRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsQ0FBQzs7bURBQ2hDO0FBTW5CO0lBSkMsSUFBQSxnQkFBTSxFQUFDLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUM7SUFDdkMsSUFBQSw0QkFBVSxHQUFFO0lBQ1osSUFBQSwwQkFBUSxFQUFDLEVBQUUsT0FBTyxFQUFFLDhCQUE4QixFQUFFLENBQUM7SUFDckQsSUFBQSwyQkFBUyxFQUFDLEdBQUcsRUFBRSxFQUFFLE9BQU8sRUFBRSw0Q0FBNEMsRUFBRSxDQUFDOztpREFDekQ7MEJBekNOLGVBQWU7SUFEM0IsSUFBQSxnQkFBTSxFQUFDLG9CQUFvQixDQUFDO0dBQ2hCLGVBQWUsQ0EwQzNCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxlbnRpdGllc1xccmVnaXN0cm8tbWV0cmljYS5lbnRpdHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRW50aXR5LFxuICBQcmltYXJ5R2VuZXJhdGVkQ29sdW1uLFxuICBDb2x1bW4sXG4gIEluZGV4LFxuICBNYW55VG9PbmUsXG4gIEpvaW5Db2x1bW4sXG4gIENyZWF0ZURhdGVDb2x1bW4sXG59IGZyb20gJ3R5cGVvcm0nO1xuaW1wb3J0IHtcbiAgSXNOb3RFbXB0eSxcbiAgSXNVVUlELFxuICBJc09wdGlvbmFsLFxuICBJc051bWJlcixcbiAgTWluLFxuICBJc1N0cmluZyxcbiAgTWF4TGVuZ3RoLFxuICBJc0lQLFxufSBmcm9tICdjbGFzcy12YWxpZGF0b3InO1xuaW1wb3J0IHsgTWV0cmljYURlZmluaWNhbyB9IGZyb20gJy4vbWV0cmljYS1kZWZpbmljYW8uZW50aXR5JztcbmltcG9ydCB7IE1ldHJpY2EgfSBmcm9tICcuL21ldHJpY2EuZW50aXR5JztcblxuLyoqXG4gKiBFbnRpZGFkZSBxdWUgcmVwcmVzZW50YSB1bSByZWdpc3RybyBkZSBtw6l0cmljYVxuICpcbiAqIEVzdGEgZW50aWRhZGUgYXJtYXplbmEgb3MgdmFsb3JlcyBjb2xldGFkb3MgcGFyYSB1bWEgbcOpdHJpY2EgZXNwZWPDrWZpY2EsXG4gKiBpbmNsdWluZG8gbyB0aW1lc3RhbXAgZGEgY29sZXRhIGUgZGV0YWxoZXMgYWRpY2lvbmFpcy5cbiAqXG4gKiBBIHRhYmVsYSDDqSBwYXJ0aWNpb25hZGEgcG9yIHRlbXBvIHBhcmEgb3RpbWl6YXIgbyBkZXNlbXBlbmhvIGVtIGNvbnN1bHRhc1xuICogY29tIGdyYW5kZXMgdm9sdW1lcyBkZSBkYWRvcy5cbiAqL1xuQEVudGl0eSgncmVnaXN0cm9zX21ldHJpY2FzJylcbmV4cG9ydCBjbGFzcyBSZWdpc3Ryb01ldHJpY2Ege1xuICBAUHJpbWFyeUdlbmVyYXRlZENvbHVtbigndXVpZCcpXG4gIGlkOiBzdHJpbmc7XG5cbiAgQENvbHVtbih7IHR5cGU6ICd1dWlkJyB9KVxuICBASW5kZXgoJ2lkeF9yZWdpc3Ryb3NfbWV0cmljYXNfZGVmaW5pY2FvX2lkJylcbiAgQElzTm90RW1wdHkoeyBtZXNzYWdlOiAnSUQgZGEgZGVmaW5pw6fDo28gZGUgbcOpdHJpY2Egw6kgb2JyaWdhdMOzcmlvJyB9KVxuICBASXNVVUlEKCc0JywgeyBtZXNzYWdlOiAnSUQgZGEgZGVmaW5pw6fDo28gZGUgbcOpdHJpY2EgaW52w6FsaWRvJyB9KVxuICBtZXRyaWNhX2RlZmluaWNhb19pZDogc3RyaW5nO1xuXG4gIEBNYW55VG9PbmUoKCkgPT4gTWV0cmljYSwgKG1ldHJpY2EpID0+IG1ldHJpY2EucmVnaXN0cm9zKVxuICBASm9pbkNvbHVtbih7IG5hbWU6ICdtZXRyaWNhX2lkJyB9KVxuICBtZXRyaWNhOiBNZXRyaWNhO1xuXG4gIEBDb2x1bW4oeyB0eXBlOiAnbnVtZXJpYycsIHByZWNpc2lvbjogMTUsIHNjYWxlOiAyIH0pXG4gIEBJc05vdEVtcHR5KHsgbWVzc2FnZTogJ1ZhbG9yIMOpIG9icmlnYXTDs3JpbycgfSlcbiAgQElzTnVtYmVyKHt9LCB7IG1lc3NhZ2U6ICdWYWxvciBkZXZlIHNlciB1bSBuw7ptZXJvJyB9KVxuICB2YWxvcjogbnVtYmVyO1xuXG4gIEBDcmVhdGVEYXRlQ29sdW1uKHsgbmFtZTogJ2NyZWF0ZWRfYXQnIH0pXG4gIEBJbmRleCgnaWR4X3JlZ2lzdHJvc19tZXRyaWNhc190aW1lc3RhbXAnKVxuICBjcmVhdGVkX2F0OiBEYXRlO1xuXG4gIEBDb2x1bW4oeyB0eXBlOiAnanNvbmInLCBudWxsYWJsZTogdHJ1ZSB9KVxuICBkZXRhbGhlczogUmVjb3JkPHN0cmluZywgYW55PjtcblxuICBAQ29sdW1uKHsgbGVuZ3RoOiA0NSwgbnVsbGFibGU6IHRydWUgfSlcbiAgQElzT3B0aW9uYWwoKVxuICBASXNJUCh1bmRlZmluZWQsIHsgbWVzc2FnZTogJ0lQIGRlIG9yaWdlbSBpbnbDoWxpZG8nIH0pXG4gIGlwX29yaWdlbTogc3RyaW5nO1xuXG4gIEBDb2x1bW4oeyB0eXBlOiAndXVpZCcsIG51bGxhYmxlOiB0cnVlIH0pXG4gIEBJbmRleCgnaWR4X3JlZ2lzdHJvc19tZXRyaWNhc191c3VhcmlvX2lkJylcbiAgQElzT3B0aW9uYWwoKVxuICBASXNVVUlEKCc0JywgeyBtZXNzYWdlOiAnSUQgZG8gdXN1w6FyaW8gaW52w6FsaWRvJyB9KVxuICB1c3VhcmlvX2lkOiBzdHJpbmc7XG5cbiAgQENvbHVtbih7IGxlbmd0aDogMjU1LCBudWxsYWJsZTogdHJ1ZSB9KVxuICBASXNPcHRpb25hbCgpXG4gIEBJc1N0cmluZyh7IG1lc3NhZ2U6ICdFbmRwb2ludCBkZXZlIHNlciB1bWEgc3RyaW5nJyB9KVxuICBATWF4TGVuZ3RoKDI1NSwgeyBtZXNzYWdlOiAnRW5kcG9pbnQgZGV2ZSB0ZXIgbm8gbcOheGltbyAyNTUgY2FyYWN0ZXJlcycgfSlcbiAgZW5kcG9pbnQ6IHN0cmluZztcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==