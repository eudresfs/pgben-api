df940c71383b14d226d7c78039af7c13
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const usuario_controller_1 = require("./usuario.controller");
const usuario_service_1 = require("../services/usuario.service");
const jwt_auth_guard_1 = require("../../../auth/guards/jwt-auth.guard");
const permission_guard_1 = require("../../../auth/guards/permission.guard");
const unidade_entity_1 = require("../../unidade/entities/unidade.entity");
/**
 * Testes unitários para o UsuarioController
 *
 * Cobertura de testes:
 * - Listagem de usuários com filtros
 * - Busca por ID
 * - Perfil do usuário atual
 * - Criação de usuários
 * - Atualização de dados
 * - Atualização de status
 * - Atualização de senha
 * - Remoção de usuários
 */
describe('UsuarioController', () => {
    let controller;
    let service;
    const mockUsuario = {
        id: '123e4567-e89b-12d3-a456-426614174000',
        nome: 'João da Silva',
        email: 'joao.silva@semtas.natal.gov.br',
        cpf: '123.456.789-00',
        telefone: '(84) 99999-9999',
        matricula: '12345',
        senhaHash: '$2b$12$hashedpassword',
        role_id: 'ASSISTENTE_SOCIAL',
        status: 'ativo',
        primeiro_acesso: false,
        unidadeId: 'unidade-123',
        setorId: 'setor-123',
        created_at: new Date(),
        updated_at: new Date(),
        // Relacionamentos obrigatórios
        role: {
            id: 'role-123',
            nome: 'admin',
            descricao: 'Administrador',
            ativo: true,
            usuarios: [],
            created_at: new Date(),
            updated_at: new Date(),
        },
        unidade: {
            id: 'unidade-123',
            nome: 'Unidade Teste',
            codigo: 'UN001',
            sigla: 'UT',
            tipo: unidade_entity_1.TipoUnidade.CRAS,
            endereco: 'Endereço Teste',
            telefone: '(84) 99999-9999',
            email: 'unidade@teste.com',
            responsavel_matricula: '12345',
            status: unidade_entity_1.StatusUnidade.ATIVO,
            usuarios: [],
            setores: [],
            created_at: new Date(),
            updated_at: new Date(),
            removed_at: null,
        },
        setor: {
            id: 'setor-123',
            nome: 'Setor Teste',
            descricao: 'Setor de Teste',
            unidade_id: 'unidade-123',
            unidade: {
                id: 'unidade-123',
                nome: 'Unidade Teste',
                codigo: 'UN001',
                sigla: 'UT',
                tipo: unidade_entity_1.TipoUnidade.CRAS,
                endereco: 'Rua Teste, 123',
                telefone: '(84) 99999-9999',
                email: 'unidade@teste.com',
                responsavel_matricula: '12345',
                status: unidade_entity_1.StatusUnidade.ATIVO,
                usuarios: [],
                setores: [],
                created_at: new Date(),
                updated_at: new Date(),
                removed_at: null,
            },
            usuarios: [],
            created_at: new Date(),
            updated_at: new Date(),
        },
        refreshTokens: [],
    };
    const mockRequest = {
        user: {
            id: '123e4567-e89b-12d3-a456-426614174000',
            email: 'joao.silva@semtas.natal.gov.br',
            role: 'ASSISTENTE_SOCIAL',
        },
    };
    beforeEach(async () => {
        const mockService = {
            findAll: jest.fn(),
            findById: jest.fn(),
            create: jest.fn(),
            update: jest.fn(),
            updateStatus: jest.fn(),
            updateSenha: jest.fn(),
            remove: jest.fn(),
            getProfile: jest.fn(),
        };
        const module = await testing_1.Test.createTestingModule({
            controllers: [usuario_controller_1.UsuarioController],
            providers: [
                {
                    provide: usuario_service_1.UsuarioService,
                    useValue: mockService,
                },
            ],
        })
            .overrideGuard(jwt_auth_guard_1.JwtAuthGuard)
            .useValue({ canActivate: jest.fn(() => true) })
            .overrideGuard(permission_guard_1.PermissionGuard)
            .useValue({ canActivate: jest.fn(() => true) })
            .compile();
        controller = module.get(usuario_controller_1.UsuarioController);
        service = module.get(usuario_service_1.UsuarioService);
    });
    describe('findAll', () => {
        it('deve retornar lista de usuários com paginação', async () => {
            const mockResult = {
                items: [mockUsuario],
                meta: {
                    total: 1,
                    page: 1,
                    limit: 10,
                    totalPages: 1,
                },
            };
            service.findAll.mockResolvedValue(mockResult);
            const result = await controller.findAll(1, 10, 'João', 'ASSISTENTE_SOCIAL', 'ativo', 'unidade-123');
            expect(result).toEqual(mockResult);
            expect(service.findAll).toHaveBeenCalledWith({
                page: 1,
                limit: 10,
                search: 'João',
                role: 'ASSISTENTE_SOCIAL',
                status: unidade_entity_1.StatusUnidade.ATIVO,
                unidadeId: 'unidade-123',
            });
        });
        it('deve usar valores padrão quando parâmetros não fornecidos', async () => {
            const mockResult = {
                items: [mockUsuario],
                meta: {
                    total: 1,
                    page: 1,
                    limit: 10,
                    totalPages: 1,
                },
            };
            service.findAll.mockResolvedValue(mockResult);
            await controller.findAll();
            expect(service.findAll).toHaveBeenCalledWith({
                page: undefined,
                limit: undefined,
                search: undefined,
                role: undefined,
                status: undefined,
                unidadeId: undefined,
            });
        });
    });
    describe('findOne', () => {
        it('deve retornar usuário por ID', async () => {
            service.findById.mockResolvedValue(mockUsuario);
            const result = await controller.findOne('123e4567-e89b-12d3-a456-426614174000');
            expect(result).toEqual(mockUsuario);
            expect(service.findById).toHaveBeenCalledWith('123e4567-e89b-12d3-a456-426614174000');
        });
    });
    describe('getProfile', () => {
        it('deve retornar perfil do usuário atual', async () => {
            service.getProfile.mockResolvedValue(mockUsuario);
            const result = await controller.getProfile(mockRequest);
            expect(result).toEqual(mockUsuario);
            expect(service.getProfile).toHaveBeenCalledWith('123e4567-e89b-12d3-a456-426614174000');
        });
    });
    describe('create', () => {
        it('deve criar novo usuário', async () => {
            const createDto = {
                nome: 'João da Silva',
                email: 'joao.silva@semtas.natal.gov.br',
                senha: 'Senha@123',
                cpf: '123.456.789-00',
                telefone: '(84) 99999-9999',
                matricula: '12345',
                role_id: 'ASSISTENTE_SOCIAL',
                unidade_id: 'unidade-123',
                setor_id: 'setor-123',
            };
            const mockResponse = {
                data: mockUsuario,
                meta: null,
                message: null,
            };
            service.create.mockResolvedValue(mockResponse);
            const result = await controller.create(createDto);
            expect(result).toEqual(mockResponse);
            expect(service.create).toHaveBeenCalledWith(createDto);
        });
    });
    describe('update', () => {
        it('deve atualizar usuário', async () => {
            const updateDto = {
                nome: 'João Silva Santos',
                cpf: '123.456.789-00',
                telefone: '(84) 88888-8888',
            };
            const mockResponse = {
                data: { ...mockUsuario, ...updateDto },
                meta: null,
                message: null,
            };
            service.update.mockResolvedValue(mockResponse);
            const result = await controller.update('123e4567-e89b-12d3-a456-426614174000', updateDto);
            expect(result).toEqual(mockResponse);
            expect(service.update).toHaveBeenCalledWith('123e4567-e89b-12d3-a456-426614174000', updateDto);
        });
    });
    describe('updateStatus', () => {
        it('deve atualizar status do usuário', async () => {
            const updateStatusDto = {
                status: 'inativo',
            };
            const { senhaHash, ...usuarioAtualizado } = {
                ...mockUsuario,
                status: 'inativo',
            };
            service.updateStatus.mockResolvedValue(usuarioAtualizado);
            const result = await controller.updateStatus('123e4567-e89b-12d3-a456-426614174000', updateStatusDto);
            expect(result).toEqual(usuarioAtualizado);
            expect(service.updateStatus).toHaveBeenCalledWith('123e4567-e89b-12d3-a456-426614174000', updateStatusDto);
        });
    });
    describe('updateSenha', () => {
        it('deve atualizar senha do usuário', async () => {
            const updateSenhaDto = {
                senhaAtual: 'senhaAtual123',
                novaSenha: 'novaSenha123',
                confirmacaoSenha: 'novaSenha123',
            };
            const mockResponse = { message: 'Senha atualizada com sucesso' };
            service.updateSenha.mockResolvedValue(mockResponse);
            const result = await controller.updateSenha('123e4567-e89b-12d3-a456-426614174000', updateSenhaDto, mockRequest);
            expect(result).toEqual(mockResponse);
            expect(service.updateSenha).toHaveBeenCalledWith('123e4567-e89b-12d3-a456-426614174000', updateSenhaDto);
        });
    });
    describe('remove', () => {
        it('deve remover usuário', async () => {
            const mockResponse = { message: 'Usuário removido com sucesso' };
            service.remove.mockResolvedValue(undefined);
            const result = await controller.remove('123e4567-e89b-12d3-a456-426614174000');
            expect(service.remove).toHaveBeenCalledWith('123e4567-e89b-12d3-a456-426614174000');
        });
    });
    it('deve estar definido', () => {
        expect(controller).toBeDefined();
    });
    it('deve ter service injetado', () => {
        expect(service).toBeDefined();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHVzdWFyaW9cXGNvbnRyb2xsZXJzXFx1c3VhcmlvLmNvbnRyb2xsZXIuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCw2REFBeUQ7QUFDekQsaUVBQTZEO0FBQzdELHdFQUFtRTtBQUNuRSw0RUFBd0U7QUFNeEUsMEVBRytDO0FBRS9DOzs7Ozs7Ozs7Ozs7R0FZRztBQUNILFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsSUFBSSxVQUE2QixDQUFDO0lBQ2xDLElBQUksT0FBb0MsQ0FBQztJQUV6QyxNQUFNLFdBQVcsR0FBWTtRQUMzQixFQUFFLEVBQUUsc0NBQXNDO1FBQzFDLElBQUksRUFBRSxlQUFlO1FBQ3JCLEtBQUssRUFBRSxnQ0FBZ0M7UUFDdkMsR0FBRyxFQUFFLGdCQUFnQjtRQUNyQixRQUFRLEVBQUUsaUJBQWlCO1FBQzNCLFNBQVMsRUFBRSxPQUFPO1FBQ2xCLFNBQVMsRUFBRSx1QkFBdUI7UUFDbEMsT0FBTyxFQUFFLG1CQUFtQjtRQUM1QixNQUFNLEVBQUUsT0FBTztRQUNmLGVBQWUsRUFBRSxLQUFLO1FBQ3RCLFNBQVMsRUFBRSxhQUFhO1FBQ3hCLE9BQU8sRUFBRSxXQUFXO1FBQ3BCLFVBQVUsRUFBRSxJQUFJLElBQUksRUFBRTtRQUN0QixVQUFVLEVBQUUsSUFBSSxJQUFJLEVBQUU7UUFDdEIsK0JBQStCO1FBQy9CLElBQUksRUFBRTtZQUNKLEVBQUUsRUFBRSxVQUFVO1lBQ2QsSUFBSSxFQUFFLE9BQU87WUFDYixTQUFTLEVBQUUsZUFBZTtZQUMxQixLQUFLLEVBQUUsSUFBSTtZQUNYLFFBQVEsRUFBRSxFQUFFO1lBQ1osVUFBVSxFQUFFLElBQUksSUFBSSxFQUFFO1lBQ3RCLFVBQVUsRUFBRSxJQUFJLElBQUksRUFBRTtTQUN2QjtRQUNELE9BQU8sRUFBRTtZQUNQLEVB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QUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7UUFDdEIsRUFBRSxDQUFDLHNCQUFzQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BDLE1BQU0sWUFBWSxHQUFHLEVBQUUsT0FBTyxFQUFFLDhCQUE4QixFQUFFLENBQUM7WUFDakUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUU1QyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxNQUFNLENBQ3BDLHNDQUFzQyxDQUN2QyxDQUFDO1lBRUYsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FDekMsc0NBQXNDLENBQ3ZDLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRTtRQUM3QixNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO1FBQ25DLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNoQyxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxtb2R1bGVzXFx1c3VhcmlvXFxjb250cm9sbGVyc1xcdXN1YXJpby5jb250cm9sbGVyLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBVc3VhcmlvQ29udHJvbGxlciB9IGZyb20gJy4vdXN1YXJpby5jb250cm9sbGVyJztcbmltcG9ydCB7IFVzdWFyaW9TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvdXN1YXJpby5zZXJ2aWNlJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4uLy4uLy4uL2F1dGgvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IFBlcm1pc3Npb25HdWFyZCB9IGZyb20gJy4uLy4uLy4uL2F1dGgvZ3VhcmRzL3Blcm1pc3Npb24uZ3VhcmQnO1xuaW1wb3J0IHsgQ3JlYXRlVXN1YXJpb0R0byB9IGZyb20gJy4uL2R0by9jcmVhdGUtdXN1YXJpby5kdG8nO1xuaW1wb3J0IHsgVXBkYXRlVXN1YXJpb0R0byB9IGZyb20gJy4uL2R0by91cGRhdGUtdXN1YXJpby5kdG8nO1xuaW1wb3J0IHsgVXBkYXRlU3RhdHVzVXN1YXJpb0R0byB9IGZyb20gJy4uL2R0by91cGRhdGUtc3RhdHVzLXVzdWFyaW8uZHRvJztcbmltcG9ydCB7IFVwZGF0ZVNlbmhhRHRvIH0gZnJvbSAnLi4vZHRvL3VwZGF0ZS1zZW5oYS5kdG8nO1xuaW1wb3J0IHsgVXN1YXJpbyB9IGZyb20gJy4uL2VudGl0aWVzL3VzdWFyaW8uZW50aXR5JztcbmltcG9ydCB7XG4gIFRpcG9VbmlkYWRlLFxuICBTdGF0dXNVbmlkYWRlLFxufSBmcm9tICcuLi8uLi91bmlkYWRlL2VudGl0aWVzL3VuaWRhZGUuZW50aXR5JztcblxuLyoqXG4gKiBUZXN0ZXMgdW5pdMOhcmlvcyBwYXJhIG8gVXN1YXJpb0NvbnRyb2xsZXJcbiAqXG4gKiBDb2JlcnR1cmEgZGUgdGVzdGVzOlxuICogLSBMaXN0YWdlbSBkZSB1c3XDoXJpb3MgY29tIGZpbHRyb3NcbiAqIC0gQnVzY2EgcG9yIElEXG4gKiAtIFBlcmZpbCBkbyB1c3XDoXJpbyBhdHVhbFxuICogLSBDcmlhw6fDo28gZGUgdXN1w6FyaW9zXG4gKiAtIEF0dWFsaXphw6fDo28gZGUgZGFkb3NcbiAqIC0gQXR1YWxpemHDp8OjbyBkZSBzdGF0dXNcbiAqIC0gQXR1YWxpemHDp8OjbyBkZSBzZW5oYVxuICogLSBSZW1vw6fDo28gZGUgdXN1w6FyaW9zXG4gKi9cbmRlc2NyaWJlKCdVc3VhcmlvQ29udHJvbGxlcicsICgpID0+IHtcbiAgbGV0IGNvbnRyb2xsZXI6IFVzdWFyaW9Db250cm9sbGVyO1xuICBsZXQgc2VydmljZTogamVzdC5Nb2NrZWQ8VXN1YXJpb1NlcnZpY2U+O1xuXG4gIGNvbnN0IG1vY2tVc3VhcmlvOiBVc3VhcmlvID0ge1xuICAgIGlkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJyxcbiAgICBub21lOiAnSm/Do28gZGEgU2lsdmEnLFxuICAgIGVtYWlsOiAnam9hby5zaWx2YUBzZW10YXMubmF0YWwuZ292LmJyJyxcbiAgICBjcGY6ICcxMjMuNDU2Ljc4OS0wMCcsXG4gICAgdGVsZWZvbmU6ICcoODQpIDk5OTk5LTk5OTknLFxuICAgIG1hdHJpY3VsYTogJzEyMzQ1JyxcbiAgICBzZW5oYUhhc2g6ICckMmIkMTIkaGFzaGVkcGFzc3dvcmQnLFxuICAgIHJvbGVfaWQ6ICdBU1NJU1RFTlRFX1NPQ0lBTCcsXG4gICAgc3RhdHVzOiAnYXRpdm8nLFxuICAgIHByaW1laXJvX2FjZXNzbzogZmFsc2UsXG4gICAgdW5pZGFkZUlkOiAndW5pZGFkZS0xMjMnLFxuICAgIHNldG9ySWQ6ICdzZXRvci0xMjMnLFxuICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKSxcbiAgICAvLyBSZWxhY2lvbmFtZW50b3Mgb2JyaWdhdMOzcmlvc1xuICAgIHJvbGU6IHtcbiAgICAgIGlkOiAncm9sZS0xMjMnLFxuICAgICAgbm9tZTogJ2FkbWluJyxcbiAgICAgIGRlc2NyaWNhbzogJ0FkbWluaXN0cmFkb3InLFxuICAgICAgYXRpdm86IHRydWUsXG4gICAgICB1c3VhcmlvczogW10sXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKSxcbiAgICB9LFxuICAgIHVuaWRhZGU6IHtcbiAgICAgIGlkOiAndW5pZGFkZS0xMjMnLFxuICAgICAgbm9tZTogJ1VuaWRhZGUgVGVzdGUnLFxuICAgICAgY29kaWdvOiAnVU4wMDEnLFxuICAgICAgc2lnbGE6ICdVVCcsXG4gICAgICB0aXBvOiBUaXBvVW5pZGFkZS5DUkFTLFxuICAgICAgZW5kZXJlY286ICdFbmRlcmXDp28gVGVzdGUnLFxuICAgICAgdGVsZWZvbmU6ICcoODQpIDk5OTk5LTk5OTknLFxuICAgICAgZW1haWw6ICd1bmlkYWRlQHRlc3RlLmNvbScsXG4gICAgICByZXNwb25zYXZlbF9tYXRyaWN1bGE6ICcxMjM0NScsXG4gICAgICBzdGF0dXM6IFN0YXR1c1VuaWRhZGUuQVRJVk8sXG4gICAgICB1c3VhcmlvczogW10sXG4gICAgICBzZXRvcmVzOiBbXSxcbiAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgcmVtb3ZlZF9hdDogbnVsbCxcbiAgICB9LFxuICAgIHNldG9yOiB7XG4gICAgICBpZDogJ3NldG9yLTEyMycsXG4gICAgICBub21lOiAnU2V0b3IgVGVzdGUnLFxuICAgICAgZGVzY3JpY2FvOiAnU2V0b3IgZGUgVGVzdGUnLFxuICAgICAgdW5pZGFkZV9pZDogJ3VuaWRhZGUtMTIzJyxcbiAgICAgIHVuaWRhZGU6IHtcbiAgICAgICAgaWQ6ICd1bmlkYWRlLTEyMycsXG4gICAgICAgIG5vbWU6ICdVbmlkYWRlIFRlc3RlJyxcbiAgICAgICAgY29kaWdvOiAnVU4wMDEnLFxuICAgICAgICBzaWdsYTogJ1VUJyxcbiAgICAgICAgdGlwbzogVGlwb1VuaWRhZGUuQ1JBUyxcbiAgICAgICAgZW5kZXJlY286ICdSdWEgVGVzdGUsIDEyMycsXG4gICAgICAgIHRlbGVmb25lOiAnKDg0KSA5OTk5OS05OTk5JyxcbiAgICAgICAgZW1haWw6ICd1bmlkYWRlQHRlc3RlLmNvbScsXG4gICAgICAgIHJlc3BvbnNhdmVsX21hdHJpY3VsYTogJzEyMzQ1JyxcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNVbmlkYWRlLkFUSVZPLFxuICAgICAgICB1c3VhcmlvczogW10sXG4gICAgICAgIHNldG9yZXM6IFtdLFxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgICByZW1vdmVkX2F0OiBudWxsLFxuICAgICAgfSxcbiAgICAgIHVzdWFyaW9zOiBbXSxcbiAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgIH0sXG4gICAgcmVmcmVzaFRva2VuczogW10sXG4gIH07XG5cbiAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgdXNlcjoge1xuICAgICAgaWQ6ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnLFxuICAgICAgZW1haWw6ICdqb2FvLnNpbHZhQHNlbXRhcy5uYXRhbC5nb3YuYnInLFxuICAgICAgcm9sZTogJ0FTU0lTVEVOVEVfU09DSUFMJyxcbiAgICB9LFxuICB9O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tTZXJ2aWNlID0ge1xuICAgICAgZmluZEFsbDogamVzdC5mbigpLFxuICAgICAgZmluZEJ5SWQ6IGplc3QuZm4oKSxcbiAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGVTdGF0dXM6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZVNlbmhhOiBqZXN0LmZuKCksXG4gICAgICByZW1vdmU6IGplc3QuZm4oKSxcbiAgICAgIGdldFByb2ZpbGU6IGplc3QuZm4oKSxcbiAgICB9O1xuXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIGNvbnRyb2xsZXJzOiBbVXN1YXJpb0NvbnRyb2xsZXJdLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBVc3VhcmlvU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja1NlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pXG4gICAgICAub3ZlcnJpZGVHdWFyZChKd3RBdXRoR3VhcmQpXG4gICAgICAudXNlVmFsdWUoeyBjYW5BY3RpdmF0ZTogamVzdC5mbigoKSA9PiB0cnVlKSB9KVxuICAgICAgLm92ZXJyaWRlR3VhcmQoUGVybWlzc2lvbkd1YXJkKVxuICAgICAgLnVzZVZhbHVlKHsgY2FuQWN0aXZhdGU6IGplc3QuZm4oKCkgPT4gdHJ1ZSkgfSlcbiAgICAgIC5jb21waWxlKCk7XG5cbiAgICBjb250cm9sbGVyID0gbW9kdWxlLmdldDxVc3VhcmlvQ29udHJvbGxlcj4oVXN1YXJpb0NvbnRyb2xsZXIpO1xuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0KFVzdWFyaW9TZXJ2aWNlKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbmRBbGwnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgbGlzdGEgZGUgdXN1w6FyaW9zIGNvbSBwYWdpbmHDp8OjbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgIGl0ZW1zOiBbbW9ja1VzdWFyaW9dLFxuICAgICAgICBtZXRhOiB7XG4gICAgICAgICAgdG90YWw6IDEsXG4gICAgICAgICAgcGFnZTogMSxcbiAgICAgICAgICBsaW1pdDogMTAsXG4gICAgICAgICAgdG90YWxQYWdlczogMSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIHNlcnZpY2UuZmluZEFsbC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzdWx0KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5maW5kQWxsKFxuICAgICAgICAxLFxuICAgICAgICAxMCxcbiAgICAgICAgJ0pvw6NvJyxcbiAgICAgICAgJ0FTU0lTVEVOVEVfU09DSUFMJyxcbiAgICAgICAgJ2F0aXZvJyxcbiAgICAgICAgJ3VuaWRhZGUtMTIzJyxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1Jlc3VsdCk7XG4gICAgICBleHBlY3Qoc2VydmljZS5maW5kQWxsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHBhZ2U6IDEsXG4gICAgICAgIGxpbWl0OiAxMCxcbiAgICAgICAgc2VhcmNoOiAnSm/Do28nLFxuICAgICAgICByb2xlOiAnQVNTSVNURU5URV9TT0NJQUwnLFxuICAgICAgICBzdGF0dXM6IFN0YXR1c1VuaWRhZGUuQVRJVk8sXG4gICAgICAgIHVuaWRhZGVJZDogJ3VuaWRhZGUtMTIzJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgdXNhciB2YWxvcmVzIHBhZHLDo28gcXVhbmRvIHBhcsOibWV0cm9zIG7Do28gZm9ybmVjaWRvcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgIGl0ZW1zOiBbbW9ja1VzdWFyaW9dLFxuICAgICAgICBtZXRhOiB7XG4gICAgICAgICAgdG90YWw6IDEsXG4gICAgICAgICAgcGFnZTogMSxcbiAgICAgICAgICBsaW1pdDogMTAsXG4gICAgICAgICAgdG90YWxQYWdlczogMSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgICBzZXJ2aWNlLmZpbmRBbGwubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3VsdCk7XG5cbiAgICAgIGF3YWl0IGNvbnRyb2xsZXIuZmluZEFsbCgpO1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5maW5kQWxsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHBhZ2U6IHVuZGVmaW5lZCxcbiAgICAgICAgbGltaXQ6IHVuZGVmaW5lZCxcbiAgICAgICAgc2VhcmNoOiB1bmRlZmluZWQsXG4gICAgICAgIHJvbGU6IHVuZGVmaW5lZCxcbiAgICAgICAgc3RhdHVzOiB1bmRlZmluZWQsXG4gICAgICAgIHVuaWRhZGVJZDogdW5kZWZpbmVkLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmaW5kT25lJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIHVzdcOhcmlvIHBvciBJRCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHNlcnZpY2UuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzdWFyaW8pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRPbmUoXG4gICAgICAgICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrVXN1YXJpbyk7XG4gICAgICBleHBlY3Qoc2VydmljZS5maW5kQnlJZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFByb2ZpbGUnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgcGVyZmlsIGRvIHVzdcOhcmlvIGF0dWFsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgc2VydmljZS5nZXRQcm9maWxlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc3VhcmlvKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRQcm9maWxlKG1vY2tSZXF1ZXN0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrVXN1YXJpbyk7XG4gICAgICBleHBlY3Qoc2VydmljZS5nZXRQcm9maWxlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGNyaWFyIG5vdm8gdXN1w6FyaW8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjcmVhdGVEdG86IENyZWF0ZVVzdWFyaW9EdG8gPSB7XG4gICAgICAgIG5vbWU6ICdKb8OjbyBkYSBTaWx2YScsXG4gICAgICAgIGVtYWlsOiAnam9hby5zaWx2YUBzZW10YXMubmF0YWwuZ292LmJyJyxcbiAgICAgICAgc2VuaGE6ICdTZW5oYUAxMjMnLFxuICAgICAgICBjcGY6ICcxMjMuNDU2Ljc4OS0wMCcsXG4gICAgICAgIHRlbGVmb25lOiAnKDg0KSA5OTk5OS05OTk5JyxcbiAgICAgICAgbWF0cmljdWxhOiAnMTIzNDUnLFxuICAgICAgICByb2xlX2lkOiAnQVNTSVNURU5URV9TT0NJQUwnLFxuICAgICAgICB1bmlkYWRlX2lkOiAndW5pZGFkZS0xMjMnLFxuICAgICAgICBzZXRvcl9pZDogJ3NldG9yLTEyMycsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrUmVzcG9uc2UgPSB7XG4gICAgICAgIGRhdGE6IG1vY2tVc3VhcmlvLFxuICAgICAgICBtZXRhOiBudWxsLFxuICAgICAgICBtZXNzYWdlOiBudWxsLFxuICAgICAgfTtcblxuICAgICAgc2VydmljZS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3BvbnNlKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGUoY3JlYXRlRHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUmVzcG9uc2UpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChjcmVhdGVEdG8pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBkYXRlJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGF0dWFsaXphciB1c3XDoXJpbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZUR0bzogVXBkYXRlVXN1YXJpb0R0byA9IHtcbiAgICAgICAgbm9tZTogJ0pvw6NvIFNpbHZhIFNhbnRvcycsXG4gICAgICAgIGNwZjogJzEyMy40NTYuNzg5LTAwJyxcbiAgICAgICAgdGVsZWZvbmU6ICcoODQpIDg4ODg4LTg4ODgnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja1Jlc3BvbnNlID0ge1xuICAgICAgICBkYXRhOiB7IC4uLm1vY2tVc3VhcmlvLCAuLi51cGRhdGVEdG8gfSxcbiAgICAgICAgbWV0YTogbnVsbCxcbiAgICAgICAgbWVzc2FnZTogbnVsbCxcbiAgICAgIH07XG5cbiAgICAgIHNlcnZpY2UudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXNwb25zZSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIudXBkYXRlKFxuICAgICAgICAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJyxcbiAgICAgICAgdXBkYXRlRHRvLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUmVzcG9uc2UpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsXG4gICAgICAgIHVwZGF0ZUR0byxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd1cGRhdGVTdGF0dXMnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgYXR1YWxpemFyIHN0YXR1cyBkbyB1c3XDoXJpbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZVN0YXR1c0R0bzogVXBkYXRlU3RhdHVzVXN1YXJpb0R0byA9IHtcbiAgICAgICAgc3RhdHVzOiAnaW5hdGl2bycsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCB7IHNlbmhhSGFzaCwgLi4udXN1YXJpb0F0dWFsaXphZG8gfSA9IHtcbiAgICAgICAgLi4ubW9ja1VzdWFyaW8sXG4gICAgICAgIHN0YXR1czogJ2luYXRpdm8nLFxuICAgICAgfTtcblxuICAgICAgc2VydmljZS51cGRhdGVTdGF0dXMubW9ja1Jlc29sdmVkVmFsdWUodXN1YXJpb0F0dWFsaXphZG8pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnVwZGF0ZVN0YXR1cyhcbiAgICAgICAgJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsXG4gICAgICAgIHVwZGF0ZVN0YXR1c0R0byxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodXN1YXJpb0F0dWFsaXphZG8pO1xuICAgICAgZXhwZWN0KHNlcnZpY2UudXBkYXRlU3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsXG4gICAgICAgIHVwZGF0ZVN0YXR1c0R0byxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd1cGRhdGVTZW5oYScsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBhdHVhbGl6YXIgc2VuaGEgZG8gdXN1w6FyaW8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1cGRhdGVTZW5oYUR0bzogVXBkYXRlU2VuaGFEdG8gPSB7XG4gICAgICAgIHNlbmhhQXR1YWw6ICdzZW5oYUF0dWFsMTIzJyxcbiAgICAgICAgbm92YVNlbmhhOiAnbm92YVNlbmhhMTIzJyxcbiAgICAgICAgY29uZmlybWFjYW9TZW5oYTogJ25vdmFTZW5oYTEyMycsXG4gICAgICB9O1xuICAgICAgY29uc3QgbW9ja1Jlc3BvbnNlID0geyBtZXNzYWdlOiAnU2VuaGEgYXR1YWxpemFkYSBjb20gc3VjZXNzbycgfTtcbiAgICAgIHNlcnZpY2UudXBkYXRlU2VuaGEubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3BvbnNlKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci51cGRhdGVTZW5oYShcbiAgICAgICAgJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsXG4gICAgICAgIHVwZGF0ZVNlbmhhRHRvLFxuICAgICAgICBtb2NrUmVxdWVzdCxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1Jlc3BvbnNlKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLnVwZGF0ZVNlbmhhKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsXG4gICAgICAgIHVwZGF0ZVNlbmhhRHRvLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JlbW92ZScsICgpID0+IHtcbiAgICBpdCgnZGV2ZSByZW1vdmVyIHVzdcOhcmlvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc3BvbnNlID0geyBtZXNzYWdlOiAnVXN1w6FyaW8gcmVtb3ZpZG8gY29tIHN1Y2Vzc28nIH07XG4gICAgICBzZXJ2aWNlLnJlbW92ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnJlbW92ZShcbiAgICAgICAgJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsXG4gICAgICApO1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5yZW1vdmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJyxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdkZXZlIGVzdGFyIGRlZmluaWRvJywgKCkgPT4ge1xuICAgIGV4cGVjdChjb250cm9sbGVyKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICBpdCgnZGV2ZSB0ZXIgc2VydmljZSBpbmpldGFkbycsICgpID0+IHtcbiAgICBleHBlY3Qoc2VydmljZSkudG9CZURlZmluZWQoKTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==