{"file":"C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\entities\\role-permission.entity.ts","mappings":"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","names":[],"sources":["C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\entities\\role-permission.entity.ts"],"sourcesContent":["import {\n  Column,\n  CreateDateColumn,\n  Entity,\n  JoinColumn,\n  ManyToOne,\n  PrimaryGeneratedColumn,\n  UpdateDateColumn,\n  Index,\n} from 'typeorm';\nimport { IsNotEmpty, IsUUID, IsOptional } from 'class-validator';\nimport { Permission } from './permission.entity';\nimport { Usuario } from './usuario.entity';\n\n/**\n * Entidade que representa o relacionamento entre roles e permissões.\n *\n * Esta entidade permite mapear as permissões granulares para as roles existentes,\n * facilitando a transição do modelo baseado em roles para o modelo de permissões granulares.\n */\n@Entity('role_permissao')\n@Index(['role_id'])\n@Index(['permissao_id'])\n@Index(['role_id', 'permissao_id'], { unique: true })\n@Index(['criado_por'])\nexport class RolePermission {\n  /**\n   * Identificador único do mapeamento\n   */\n  @PrimaryGeneratedColumn('uuid')\n  id: string;\n\n  /**\n   * Referência à role\n   */\n  @Column({ type: 'uuid', name: 'role_id' })\n  @IsNotEmpty({ message: 'ID da role é obrigatório' })\n  @IsUUID('4', { message: 'ID da role inválido' })\n  role_id: string;\n\n  /**\n   * Referência à permissão\n   */\n  @Column({ type: 'uuid', name: 'permissao_id' })\n  @IsNotEmpty({ message: 'ID da permissão é obrigatório' })\n  @IsUUID('4', { message: 'ID da permissão inválido' })\n  permissao_id: string;\n\n  /**\n   * Relação com a permissão\n   */\n  @ManyToOne(() => Permission, { onDelete: 'CASCADE' })\n  @JoinColumn({ name: 'permissao_id' })\n  permissao: Permission;\n\n  /**\n   * Data de criação\n   */\n  @CreateDateColumn({ name: 'created_at' })\n  created_at: Date;\n\n  /**\n   * Data de atualização\n   */\n  @UpdateDateColumn({ name: 'updated_at' })\n  updated_at: Date;\n\n  /**\n   * Usuário que criou o mapeamento\n   */\n  @Column({ type: 'uuid', nullable: true, name: 'criado_por' })\n  @IsOptional()\n  @IsUUID('4', { message: 'ID do usuário criador inválido' })\n  criado_por: string | null;\n\n  /**\n   * Relação com o usuário que criou o mapeamento\n   */\n  @ManyToOne(() => Usuario, { nullable: true })\n  @JoinColumn({ name: 'criado_por' })\n  usuario_criador: Usuario | null;\n\n  // Getters e setters para compatibilidade com código existente\n  get roleId(): string {\n    return this.role_id;\n  }\n\n  set roleId(value: string) {\n    this.role_id = value;\n  }\n\n  get permissionId(): string {\n    return this.permissao_id;\n  }\n\n  set permissionId(value: string) {\n    this.permissao_id = value;\n  }\n\n  get permission(): Permission {\n    return this.permissao;\n  }\n\n  set permission(value: Permission) {\n    this.permissao = value;\n  }\n\n  get createdAt(): Date {\n    return this.created_at;\n  }\n\n  get createdBy(): string | null {\n    return this.criado_por;\n  }\n\n  set createdBy(value: string | null) {\n    this.criado_por = value;\n  }\n\n  get creator(): Usuario | null {\n    return this.usuario_criador;\n  }\n\n  set creator(value: Usuario | null) {\n    this.usuario_criador = value;\n  }\n\n  // Métodos utilitários\n  /**\n   * Verifica se o mapeamento foi criado por um usuário específico\n   */\n  foiCriadoPor(usuarioId: string): boolean {\n    return this.criado_por === usuarioId;\n  }\n\n  /**\n   * Cria uma chave única para o mapeamento\n   */\n  getUniqueKey(): string {\n    return `${this.role_id}-${this.permissao_id}`;\n  }\n\n  /**\n   * Verifica se o mapeamento é válido\n   */\n  isValido(): boolean {\n    return !!(this.role_id && this.permissao_id);\n  }\n\n  /**\n   * Define o criador do mapeamento\n   */\n  definirCriador(usuarioId: string): void {\n    this.criado_por = usuarioId;\n  }\n\n  /**\n   * Verifica se o mapeamento pertence a uma role específica\n   */\n  pertenceARole(roleId: string): boolean {\n    return this.role_id === roleId;\n  }\n\n  /**\n   * Verifica se o mapeamento contém uma permissão específica\n   */\n  contemPermissao(permissaoId: string): boolean {\n    return this.permissao_id === permissaoId;\n  }\n\n  /**\n   * Verifica se o mapeamento foi criado recentemente (últimas 24 horas)\n   */\n  isCriadoRecentemente(): boolean {\n    if (!this.created_at) return false;\n\n    const agora = new Date();\n    const umDiaAtras = new Date(agora.getTime() - 24 * 60 * 60 * 1000);\n\n    return this.created_at > umDiaAtras;\n  }\n\n  /**\n   * Calcula a idade do mapeamento em dias\n   */\n  getIdadeEmDias(): number {\n    if (!this.created_at) return 0;\n\n    const agora = new Date();\n    const diffTime = Math.abs(agora.getTime() - this.created_at.getTime());\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n\n    return diffDays;\n  }\n\n  /**\n   * Verifica se o mapeamento tem criador definido\n   */\n  temCriador(): boolean {\n    return !!this.criado_por;\n  }\n\n  /**\n   * Obtém informações resumidas do mapeamento\n   */\n  getSummary(): {\n    id: string;\n    role_id: string;\n    permissao_id: string;\n    criado_por: string | null;\n    created_at: Date;\n    idadeEmDias: number;\n  } {\n    return {\n      id: this.id,\n      role_id: this.role_id,\n      permissao_id: this.permissao_id,\n      criado_por: this.criado_por,\n      created_at: this.created_at,\n      idadeEmDias: this.getIdadeEmDias(),\n    };\n  }\n\n  /**\n   * Verifica se o mapeamento é compatível com outro mapeamento\n   */\n  isCompatibleWith(otherMapping: RolePermission): boolean {\n    // Mapeamentos são compatíveis se pertencem à mesma role\n    return this.role_id === otherMapping.role_id;\n  }\n\n  /**\n   * Gera uma chave única mais robusta para o mapeamento\n   */\n  getExtendedUniqueKey(): string {\n    return `role_permission_${this.role_id}_${this.permissao_id}_${this.id}`;\n  }\n\n  /**\n   * Verifica se o mapeamento está em estado consistente\n   */\n  isConsistente(): boolean {\n    return (\n      !!this.id && !!this.role_id && !!this.permissao_id && !!this.created_at\n    );\n  }\n\n  /**\n   * Obtém uma descrição legível do mapeamento\n   */\n  getDescricao(): string {\n    const permissaoNome = this.permissao?.nome || 'Permissão não carregada';\n    return `Role ${this.role_id} -> Permissão: ${permissaoNome}`;\n  }\n\n  /**\n   * Verifica se o mapeamento pode ser removido\n   */\n  podeSerRemovido(): boolean {\n    // Por padrão, todos os mapeamentos podem ser removidos\n    // Esta lógica pode ser expandida conforme regras de negócio\n    return true;\n  }\n\n  /**\n   * Clona o mapeamento (sem ID e datas)\n   */\n  clone(): Partial<RolePermission> {\n    return {\n      role_id: this.role_id,\n      permissao_id: this.permissao_id,\n      criado_por: this.criado_por,\n    };\n  }\n\n  /**\n   * Verifica se o mapeamento é para uma permissão de administrador\n   */\n  isAdminPermission(): boolean {\n    return this.permissao?.isAdminPermission() || false;\n  }\n\n  /**\n   * Verifica se o mapeamento é para uma permissão de sistema\n   */\n  isSystemPermission(): boolean {\n    return this.permissao?.isSystemPermission() || false;\n  }\n\n  /**\n   * Obtém o nível de criticidade do mapeamento baseado na permissão\n   */\n  getCriticalityLevel(): 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL' {\n    return this.permissao?.getCriticalityLevel() || 'LOW';\n  }\n\n  /**\n   * Formata a data de criação para exibição\n   */\n  getCriacaoFormatada(): string {\n    return this.created_at.toLocaleString('pt-BR', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  }\n}\n"],"version":3}