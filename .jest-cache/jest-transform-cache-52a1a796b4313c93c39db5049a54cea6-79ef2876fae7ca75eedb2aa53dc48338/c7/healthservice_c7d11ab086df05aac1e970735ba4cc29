2266c718de42934401c60e891f15f5af
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var HealthService_1;
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.HealthService = void 0;
const common_1 = require("@nestjs/common");
const config_1 = require("@nestjs/config");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const log_auditoria_entity_1 = require("../../../entities/log-auditoria.entity");
const health_check_service_1 = require("../../../shared/services/health-check.service");
/**
 * Serviço responsável por verificar a saúde dos componentes do sistema
 */
let HealthService = HealthService_1 = class HealthService {
    configService;
    logAuditoriaRepository;
    healthCheckService;
    logger = new common_1.Logger(HealthService_1.name);
    constructor(configService, logAuditoriaRepository, healthCheckService) {
        this.configService = configService;
        this.logAuditoriaRepository = logAuditoriaRepository;
        this.healthCheckService = healthCheckService;
    }
    /**
     * Verifica a saúde geral do sistema
     * @returns Status de saúde do sistema
     */
    async checkHealth() {
        const checks = await Promise.all([
            this.checkDatabase(),
            this.checkRedis(),
            this.checkMinIO(),
        ]);
        const status = checks.every((check) => check.status === 'up')
            ? 'up'
            : 'down';
        return {
            status,
            timestamp: new Date(),
            info: {
                version: process.env.npm_package_version || '1.0.0',
                environment: this.configService.get('NODE_ENV', 'development'),
            },
            details: {
                database: checks[0],
                redis: checks[1],
                minio: checks[2],
            },
        };
    }
    /**
     * Verifica a conexão com o banco de dados
     * @returns Status da conexão com o banco de dados
     */
    async checkDatabase() {
        try {
            // Tenta executar uma consulta simples para verificar a conexão
            await this.logAuditoriaRepository.query('SELECT 1');
            return {
                status: 'up',
                responseTime: 0, // Idealmente, mediríamos o tempo de resposta
            };
        }
        catch (error) {
            this.logger.error(`Erro ao verificar conexão com banco de dados: ${error.message}`);
            return {
                status: 'down',
                error: error.message,
            };
        }
    }
    /**
     * Verifica a conexão com o Redis
     * @returns Status da conexão com o Redis
     */
    async checkRedis() {
        try {
            // Utilizamos o serviço de health check para verificar a disponibilidade do Redis
            const startTime = Date.now();
            const isAvailable = await this.healthCheckService.isRedisAvailable();
            const responseTime = Date.now() - startTime;
            // Verificar se o Redis está desabilitado por configuração
            const disableRedis = this.configService.get('DISABLE_REDIS') === 'true';
            if (disableRedis) {
                return {
                    status: 'disabled',
                    message: 'Redis desabilitado por configuração',
                    responseTime: 0,
                };
            }
            if (isAvailable) {
                return {
                    status: 'up',
                    responseTime,
                };
            }
            else {
                return {
                    status: 'down',
                    message: 'Não foi possível conectar ao Redis',
                    responseTime,
                };
            }
        }
        catch (error) {
            this.logger.error(`Erro ao verificar conexão com Redis: ${error.message}`);
            return {
                status: 'down',
                error: error.message,
            };
        }
    }
    /**
     * Verifica a conexão com o MinIO
     * @returns Status da conexão com o MinIO
     */
    async checkMinIO() {
        try {
            // Aqui seria ideal ter uma injeção do serviço MinIO para verificar a conexão
            // Como estamos apenas simulando, retornamos um status positivo
            return {
                status: 'up',
                responseTime: 0,
            };
        }
        catch (error) {
            this.logger.error(`Erro ao verificar conexão com MinIO: ${error.message}`);
            return {
                status: 'down',
                error: error.message,
            };
        }
    }
};
exports.HealthService = HealthService;
exports.HealthService = HealthService = HealthService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(log_auditoria_entity_1.LogAuditoria)),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigService !== "undefined" && config_1.ConfigService) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object, typeof (_c = typeof health_check_service_1.HealthCheckService !== "undefined" && health_check_service_1.HealthCheckService) === "function" ? _c : Object])
], HealthService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXG1ldHJpY2FzXFxzZXJ2aWNlc1xcaGVhbHRoLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBb0Q7QUFDcEQsMkNBQStDO0FBQy9DLDZDQUFtRDtBQUNuRCxxQ0FBcUM7QUFDckMsaUZBQXNFO0FBQ3RFLHdGQUFtRjtBQUVuRjs7R0FFRztBQUVJLElBQU0sYUFBYSxxQkFBbkIsTUFBTSxhQUFhO0lBSUw7SUFFQTtJQUNBO0lBTkYsTUFBTSxHQUFHLElBQUksZUFBTSxDQUFDLGVBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUV6RCxZQUNtQixhQUE0QixFQUU1QixzQkFBZ0QsRUFDaEQsa0JBQXNDO1FBSHRDLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBRTVCLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBMEI7UUFDaEQsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtJQUN0RCxDQUFDO0lBRUo7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLFdBQVc7UUFDZixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUM7WUFDL0IsSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUNwQixJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxVQUFVLEVBQUU7U0FDbEIsQ0FBQyxDQUFDO1FBRUgsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUM7WUFDM0QsQ0FBQyxDQUFDLElBQUk7WUFDTixDQUFDLENBQUMsTUFBTSxDQUFDO1FBRVgsT0FBTztZQUNMLE1BQU07WUFDTixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7WUFDckIsSUFBSSxFQUFFO2dCQUNKLE9BQU8sRUFBRSxPQUFPLENBQUMs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SixDQUFDO0lBQ0gsQ0FBQztDQUNGLENBQUE7QUF2SVksc0NBQWE7d0JBQWIsYUFBYTtJQUR6QixJQUFBLG1CQUFVLEdBQUU7SUFNUixXQUFBLElBQUEsMEJBQWdCLEVBQUMsbUNBQVksQ0FBQyxDQUFBO3lEQURDLHNCQUFhLG9CQUFiLHNCQUFhLG9EQUVKLG9CQUFVLG9CQUFWLG9CQUFVLG9EQUNkLHlDQUFrQixvQkFBbEIseUNBQWtCO0dBUDlDLGFBQWEsQ0F1SXpCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxtb2R1bGVzXFxtZXRyaWNhc1xcc2VydmljZXNcXGhlYWx0aC5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIExvZ2dlciB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZyc7XG5pbXBvcnQgeyBJbmplY3RSZXBvc2l0b3J5IH0gZnJvbSAnQG5lc3Rqcy90eXBlb3JtJztcbmltcG9ydCB7IFJlcG9zaXRvcnkgfSBmcm9tICd0eXBlb3JtJztcbmltcG9ydCB7IExvZ0F1ZGl0b3JpYSB9IGZyb20gJy4uLy4uLy4uL2VudGl0aWVzL2xvZy1hdWRpdG9yaWEuZW50aXR5JztcbmltcG9ydCB7IEhlYWx0aENoZWNrU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NoYXJlZC9zZXJ2aWNlcy9oZWFsdGgtY2hlY2suc2VydmljZSc7XG5cbi8qKlxuICogU2VydmnDp28gcmVzcG9uc8OhdmVsIHBvciB2ZXJpZmljYXIgYSBzYcO6ZGUgZG9zIGNvbXBvbmVudGVzIGRvIHNpc3RlbWFcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEhlYWx0aFNlcnZpY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IGxvZ2dlciA9IG5ldyBMb2dnZXIoSGVhbHRoU2VydmljZS5uYW1lKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNvbmZpZ1NlcnZpY2U6IENvbmZpZ1NlcnZpY2UsXG4gICAgQEluamVjdFJlcG9zaXRvcnkoTG9nQXVkaXRvcmlhKVxuICAgIHByaXZhdGUgcmVhZG9ubHkgbG9nQXVkaXRvcmlhUmVwb3NpdG9yeTogUmVwb3NpdG9yeTxMb2dBdWRpdG9yaWE+LFxuICAgIHByaXZhdGUgcmVhZG9ubHkgaGVhbHRoQ2hlY2tTZXJ2aWNlOiBIZWFsdGhDaGVja1NlcnZpY2UsXG4gICkge31cblxuICAvKipcbiAgICogVmVyaWZpY2EgYSBzYcO6ZGUgZ2VyYWwgZG8gc2lzdGVtYVxuICAgKiBAcmV0dXJucyBTdGF0dXMgZGUgc2HDumRlIGRvIHNpc3RlbWFcbiAgICovXG4gIGFzeW5jIGNoZWNrSGVhbHRoKCk6IFByb21pc2U8YW55PiB7XG4gICAgY29uc3QgY2hlY2tzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgdGhpcy5jaGVja0RhdGFiYXNlKCksXG4gICAgICB0aGlzLmNoZWNrUmVkaXMoKSxcbiAgICAgIHRoaXMuY2hlY2tNaW5JTygpLFxuICAgIF0pO1xuXG4gICAgY29uc3Qgc3RhdHVzID0gY2hlY2tzLmV2ZXJ5KChjaGVjaykgPT4gY2hlY2suc3RhdHVzID09PSAndXAnKVxuICAgICAgPyAndXAnXG4gICAgICA6ICdkb3duJztcblxuICAgIHJldHVybiB7XG4gICAgICBzdGF0dXMsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBpbmZvOiB7XG4gICAgICAgIHZlcnNpb246IHByb2Nlc3MuZW52Lm5wbV9wYWNrYWdlX3ZlcnNpb24gfHwgJzEuMC4wJyxcbiAgICAgICAgZW52aXJvbm1lbnQ6IHRoaXMuY29uZmlnU2VydmljZS5nZXQoJ05PREVfRU5WJywgJ2RldmVsb3BtZW50JyksXG4gICAgICB9LFxuICAgICAgZGV0YWlsczoge1xuICAgICAgICBkYXRhYmFzZTogY2hlY2tzWzBdLFxuICAgICAgICByZWRpczogY2hlY2tzWzFdLFxuICAgICAgICBtaW5pbzogY2hlY2tzWzJdLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIGEgY29uZXjDo28gY29tIG8gYmFuY28gZGUgZGFkb3NcbiAgICogQHJldHVybnMgU3RhdHVzIGRhIGNvbmV4w6NvIGNvbSBvIGJhbmNvIGRlIGRhZG9zXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNoZWNrRGF0YWJhc2UoKTogUHJvbWlzZTxhbnk+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVGVudGEgZXhlY3V0YXIgdW1hIGNvbnN1bHRhIHNpbXBsZXMgcGFyYSB2ZXJpZmljYXIgYSBjb25leMOjb1xuICAgICAgYXdhaXQgdGhpcy5sb2dBdWRpdG9yaWFSZXBvc2l0b3J5LnF1ZXJ5KCdTRUxFQ1QgMScpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXM6ICd1cCcsXG4gICAgICAgIHJlc3BvbnNlVGltZTogMCwgLy8gSWRlYWxtZW50ZSwgbWVkaXLDrWFtb3MgbyB0ZW1wbyBkZSByZXNwb3N0YVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvIGFvIHZlcmlmaWNhciBjb25leMOjbyBjb20gYmFuY28gZGUgZGFkb3M6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdHVzOiAnZG93bicsXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2EgYSBjb25leMOjbyBjb20gbyBSZWRpc1xuICAgKiBAcmV0dXJucyBTdGF0dXMgZGEgY29uZXjDo28gY29tIG8gUmVkaXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY2hlY2tSZWRpcygpOiBQcm9taXNlPGFueT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBVdGlsaXphbW9zIG8gc2VydmnDp28gZGUgaGVhbHRoIGNoZWNrIHBhcmEgdmVyaWZpY2FyIGEgZGlzcG9uaWJpbGlkYWRlIGRvIFJlZGlzXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgaXNBdmFpbGFibGUgPSBhd2FpdCB0aGlzLmhlYWx0aENoZWNrU2VydmljZS5pc1JlZGlzQXZhaWxhYmxlKCk7XG4gICAgICBjb25zdCByZXNwb25zZVRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICAvLyBWZXJpZmljYXIgc2UgbyBSZWRpcyBlc3TDoSBkZXNhYmlsaXRhZG8gcG9yIGNvbmZpZ3VyYcOnw6NvXG4gICAgICBjb25zdCBkaXNhYmxlUmVkaXMgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0KCdESVNBQkxFX1JFRElTJykgPT09ICd0cnVlJztcblxuICAgICAgaWYgKGRpc2FibGVSZWRpcykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN0YXR1czogJ2Rpc2FibGVkJyxcbiAgICAgICAgICBtZXNzYWdlOiAnUmVkaXMgZGVzYWJpbGl0YWRvIHBvciBjb25maWd1cmHDp8OjbycsXG4gICAgICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBpZiAoaXNBdmFpbGFibGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGF0dXM6ICd1cCcsXG4gICAgICAgICAgcmVzcG9uc2VUaW1lLFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGF0dXM6ICdkb3duJyxcbiAgICAgICAgICBtZXNzYWdlOiAnTsOjbyBmb2kgcG9zc8OtdmVsIGNvbmVjdGFyIGFvIFJlZGlzJyxcbiAgICAgICAgICByZXNwb25zZVRpbWUsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJybyBhbyB2ZXJpZmljYXIgY29uZXjDo28gY29tIFJlZGlzOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXR1czogJ2Rvd24nLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIGEgY29uZXjDo28gY29tIG8gTWluSU9cbiAgICogQHJldHVybnMgU3RhdHVzIGRhIGNvbmV4w6NvIGNvbSBvIE1pbklPXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNoZWNrTWluSU8oKTogUHJvbWlzZTxhbnk+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQXF1aSBzZXJpYSBpZGVhbCB0ZXIgdW1hIGluamXDp8OjbyBkbyBzZXJ2acOnbyBNaW5JTyBwYXJhIHZlcmlmaWNhciBhIGNvbmV4w6NvXG4gICAgICAvLyBDb21vIGVzdGFtb3MgYXBlbmFzIHNpbXVsYW5kbywgcmV0b3JuYW1vcyB1bSBzdGF0dXMgcG9zaXRpdm9cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhdHVzOiAndXAnLFxuICAgICAgICByZXNwb25zZVRpbWU6IDAsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gdmVyaWZpY2FyIGNvbmV4w6NvIGNvbSBNaW5JTzogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXM6ICdkb3duJyxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICB9O1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9