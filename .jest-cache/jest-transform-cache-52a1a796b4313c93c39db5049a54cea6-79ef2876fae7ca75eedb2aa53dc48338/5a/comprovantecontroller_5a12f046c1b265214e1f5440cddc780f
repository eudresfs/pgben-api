c0144ae332f0d43974f574bb97367d1e
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.ComprovanteController = void 0;
const common_1 = require("@nestjs/common");
const platform_express_1 = require("@nestjs/platform-express");
const swagger_1 = require("@nestjs/swagger");
const comprovante_service_1 = require("../services/comprovante.service");
const comprovante_upload_dto_1 = require("../dtos/comprovante-upload.dto");
const comprovante_response_dto_1 = require("../dtos/comprovante-response.dto");
const express_1 = require("express");
/**
 * Controller para gerenciamento de comprovantes de pagamento
 *
 * Implementa endpoints para upload, visualização e remoção de
 * documentos comprobatórios anexados aos pagamentos.
 *
 * @author Equipe PGBen
 */
let ComprovanteController = class ComprovanteController {
    comprovanteService;
    constructor(comprovanteService) {
        this.comprovanteService = comprovanteService;
    }
    /**
     * Lista todos os comprovantes associados a um pagamento
     */
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    async findAll(pagamentoId) {
        const comprovantes = await this.comprovanteService.findAllByPagamento(pagamentoId);
        // Mapear para DTO de resposta
        return comprovantes.map((comprovante) => ({
            id: comprovante.id,
            pagamentoId: comprovante.pagamento_id,
            tipoDocumento: comprovante.tipo_documento,
            nomeArquivo: comprovante.nome_arquivo,
            tamanho: comprovante.tamanho,
            mimeType: comprovante.mime_type,
            dataUpload: comprovante.data_upload,
            uploadedPor: {
                id: comprovante.uploaded_por,
                nome: 'Usuário Responsável', // seria obtido da entidade Usuario
            },
        }));
    }
    /**
     * Realiza o upload de um comprovante para um pagamento
     */
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    async uploadComprovante(pagamentoId, file, uploadDto) {
        if (!file) {
            throw new common_1.BadRequestException('Nenhum arquivo enviado');
        }
        // Usar o ID do usuário atual
        const usuarioId = 'placeholder'; // usuario.id;
        const comprovante = await this.comprovanteService.uploadComprovante(pagamentoId, file, uploadDto, usuarioId);
        // Mapear para DTO de resposta
        return {
            id: comprovante.id,
            pagamentoId: comprovante.pagamento_id,
            tipoDocumento: comprovante.tipo_documento,
            nomeArquivo: comprovante.nome_arquivo,
            tamanho: comprovante.tamanho,
            mimeType: comprovante.mime_type,
            dataUpload: comprovante.data_upload,
            uploadedPor: {
                id: usuarioId,
                nome: 'Usuário Responsável', // seria obtido da entidade Usuario
            },
        };
    }
    /**
     * Obtém um comprovante específico para download
     */
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    async downloadComprovante(id, res) {
        const { buffer, fileName, mimeType } = await this.comprovanteService.getComprovanteContent(id);
        res.set({
            'Content-Type': mimeType,
            'Content-Disposition': `attachment; filename="${encodeURIComponent(fileName)}"`,
            'Content-Length': buffer.length.toString(),
        });
        res.end(buffer);
    }
    /**
     * Busca um comprovante pelo ID
     */
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    async findOne(id) {
        const comprovante = await this.comprovanteService.findOne(id);
        if (!comprovante) {
            throw new common_1.NotFoundException('Comprovante não encontrado');
        }
        // Mapear para DTO de resposta
        return {
            id: comprovante.id,
            pagamentoId: comprovante.pagamento_id,
            tipoDocumento: comprovante.tipo_documento,
            nomeArquivo: comprovante.nome_arquivo,
            tamanho: comprovante.tamanho,
            mimeType: comprovante.mime_type,
            dataUpload: comprovante.data_upload,
            uploadedPor: {
                id: comprovante.uploaded_por,
                nome: 'Usuário Responsável', // seria obtido da entidade Usuario
            },
        };
    }
    /**
     * Remove um comprovante
     */
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    async remove(id) {
        // Usar o ID do usuário atual
        const usuarioId = 'placeholder'; // usuario.id;
        await this.comprovanteService.removeComprovante(id, usuarioId);
        return { message: 'Comprovante removido com sucesso' };
    }
};
exports.ComprovanteController = ComprovanteController;
__decorate([
    (0, common_1.Get)(),
    (0, swagger_1.ApiOperation)({ summary: 'Lista comprovantes para um determinado pagamento' }),
    (0, swagger_1.ApiParam)({
        name: 'pagamentoId',
        type: 'string',
        description: 'ID do pagamento',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Lista de comprovantes',
        type: [comprovante_response_dto_1.ComprovanteResponseDto],
    }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Pagamento não encontrado' }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' })
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    ,
    __param(0, (0, common_1.Param)('pagamentoId', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], ComprovanteController.prototype, "findAll", null);
__decorate([
    (0, common_1.Post)(),
    (0, common_1.UseInterceptors)((0, platform_express_1.FileInterceptor)('file')),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, swagger_1.ApiOperation)({
        summary: 'Realiza upload de um comprovante para um pagamento',
    }),
    (0, swagger_1.ApiParam)({
        name: 'pagamentoId',
        type: 'string',
        description: 'ID do pagamento',
    }),
    (0, swagger_1.ApiResponse)({
        status: 201,
        description: 'Comprovante enviado com sucesso',
        type: comprovante_response_dto_1.ComprovanteResponseDto,
    }),
    (0, swagger_1.ApiResponse)({
        status: 400,
        description: 'Arquivo inválido ou dados incorretos',
    }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Pagamento não encontrado' }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' })
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    ,
    __param(0, (0, common_1.Param)('pagamentoId', common_1.ParseUUIDPipe)),
    __param(1, (0, common_1.UploadedFile)()),
    __param(2, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object, typeof (_b = typeof comprovante_upload_dto_1.ComprovanteUploadDto !== "undefined" && comprovante_upload_dto_1.ComprovanteUploadDto) === "function" ? _b : Object]),
    __metadata("design:returntype", Promise)
], ComprovanteController.prototype, "uploadComprovante", null);
__decorate([
    (0, common_1.Get)(':id/download'),
    (0, swagger_1.ApiOperation)({ summary: 'Faz download de um comprovante' }),
    (0, swagger_1.ApiParam)({
        name: 'pagamentoId',
        type: 'string',
        description: 'ID do pagamento',
    }),
    (0, swagger_1.ApiParam)({ name: 'id', type: 'string', description: 'ID do comprovante' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Arquivo enviado com sucesso' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Comprovante não encontrado' }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' })
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    ,
    __param(0, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __param(1, (0, common_1.Res)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, typeof (_c = typeof express_1.Response !== "undefined" && express_1.Response) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], ComprovanteController.prototype, "downloadComprovante", null);
__decorate([
    (0, common_1.Get)(':id'),
    (0, swagger_1.ApiOperation)({ summary: 'Busca um comprovante pelo ID' }),
    (0, swagger_1.ApiParam)({
        name: 'pagamentoId',
        type: 'string',
        description: 'ID do pagamento',
    }),
    (0, swagger_1.ApiParam)({ name: 'id', type: 'string', description: 'ID do comprovante' }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Comprovante encontrado',
        type: comprovante_response_dto_1.ComprovanteResponseDto,
    }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Comprovante não encontrado' }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' })
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    ,
    __param(0, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], ComprovanteController.prototype, "findOne", null);
__decorate([
    (0, common_1.Delete)(':id'),
    (0, swagger_1.ApiOperation)({ summary: 'Remove um comprovante' }),
    (0, swagger_1.ApiParam)({
        name: 'pagamentoId',
        type: 'string',
        description: 'ID do pagamento',
    }),
    (0, swagger_1.ApiParam)({ name: 'id', type: 'string', description: 'ID do comprovante' }),
    (0, swagger_1.ApiResponse)({ status: 200, description: 'Comprovante removido com sucesso' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Comprovante não encontrado' }),
    (0, swagger_1.ApiResponse)({
        status: 409,
        description: 'Comprovante não pode ser removido',
    }),
    (0, swagger_1.ApiResponse)({ status: 403, description: 'Acesso negado' })
    // @UseGuards(RolesGuard)
    // @Roles('admin', 'gestor_semtas', 'tecnico')
    ,
    __param(0, (0, common_1.Param)('id', common_1.ParseUUIDPipe)),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], ComprovanteController.prototype, "remove", null);
exports.ComprovanteController = ComprovanteController = __decorate([
    (0, swagger_1.ApiTags)('Pagamentos'),
    (0, common_1.Controller)('pagamentos/:pagamentoId/comprovantes'),
    __metadata("design:paramtypes", [typeof (_a = typeof comprovante_service_1.ComprovanteService !== "undefined" && comprovante_service_1.ComprovanteService) === "function" ? _a : Object])
], ComprovanteController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcY29udHJvbGxlcnNcXGNvbXByb3ZhbnRlLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQWN3QjtBQUN4QiwrREFBMkQ7QUFDM0QsNkNBTXlCO0FBQ3pCLHlFQUFxRTtBQUNyRSwyRUFBc0U7QUFDdEUsK0VBQTBFO0FBQzFFLHFDQUFtQztBQUVuQzs7Ozs7OztHQU9HO0FBR0ksSUFBTSxxQkFBcUIsR0FBM0IsTUFBTSxxQkFBcUI7SUFDSDtJQUE3QixZQUE2QixrQkFBc0M7UUFBdEMsdUJBQWtCLEdBQWxCLGtCQUFrQixDQUFvQjtJQUFHLENBQUM7SUFFdkU7O09BRUc7SUFpQkcsQUFGTix5QkFBeUI7SUFDekIsOENBQThDO0lBQzlDLEtBQUssQ0FBQyxPQUFPLENBQXNDLFdBQW1CO1FBQ3BFLE1BQU0sWUFBWSxHQUNoQixNQUFNLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUVoRSw4QkFBOEI7UUFDOUIsT0FBTyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ3hDLEVBQUUsRUFBRSxXQUFXLENBQUMsRUFBRTtZQUNsQixXQUFXLEVBQUUsV0FBVyxDQUFDLFlBQVk7WUFDckMsYUFBYSxFQUFFLFdBQVcsQ0FBQyxjQUFjO1lBQ3pDLFdBQVcsRUFBRSxXQUFXLENBQUMsWUFBWTtZQUNyQyxPQUFPLEVBQUUsV0FBVyxDQUFDLE9BQU87WUFDNUIsUUFBUSxFQUFFLFdBQVcsQ0FBQyxTQUFTO1lBQy9CLFVBQVUsRUFBRSxXQUFXLENBQUMsV0FBVztZQUNuQyxXQUFXLEVBQUU7Z0JBQ1gsRUFBRSxFQUFFLFdBQVcsQ0FBQyxZQUFZO2dCQUM1QixJQUFJLEVBQUUscUJBQXFCLEVBQUUsbUNB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QTs7OztvREFxQnhDO0FBc0JLO0lBakJMLElBQUEsZUFBTSxFQUFDLEtBQUssQ0FBQztJQUNiLElBQUEsc0JBQVksRUFBQyxFQUFFLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxDQUFDO0lBQ2xELElBQUEsa0JBQVEsRUFBQztRQUNSLElBQUksRUFBRSxhQUFhO1FBQ25CLElBQUksRUFBRSxRQUFRO1FBQ2QsV0FBVyxFQUFFLGlCQUFpQjtLQUMvQixDQUFDO0lBQ0QsSUFBQSxrQkFBUSxFQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxtQkFBbUIsRUFBRSxDQUFDO0lBQzFFLElBQUEscUJBQVcsRUFBQyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLGtDQUFrQyxFQUFFLENBQUM7SUFDN0UsSUFBQSxxQkFBVyxFQUFDLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsNEJBQTRCLEVBQUUsQ0FBQztJQUN2RSxJQUFBLHFCQUFXLEVBQUM7UUFDWCxNQUFNLEVBQUUsR0FBRztRQUNYLFdBQVcsRUFBRSxtQ0FBbUM7S0FDakQsQ0FBQztJQUNELElBQUEscUJBQVcsRUFBQyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLGVBQWUsRUFBRSxDQUFDO0lBQzNELHlCQUF5QjtJQUN6Qiw4Q0FBOEM7O0lBRTNDLFdBQUEsSUFBQSxjQUFLLEVBQUMsSUFBSSxFQUFFLHNCQUFhLENBQUMsQ0FBQTs7OzttREFTNUI7Z0NBbE5VLHFCQUFxQjtJQUZqQyxJQUFBLGlCQUFPLEVBQUMsWUFBWSxDQUFDO0lBQ3JCLElBQUEsbUJBQVUsRUFBQyxzQ0FBc0MsQ0FBQzt5REFFQSx3Q0FBa0Isb0JBQWxCLHdDQUFrQjtHQUR4RCxxQkFBcUIsQ0FtTmpDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxtb2R1bGVzXFxwYWdhbWVudG9cXGNvbnRyb2xsZXJzXFxjb21wcm92YW50ZS5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbnRyb2xsZXIsXG4gIEdldCxcbiAgUG9zdCxcbiAgRGVsZXRlLFxuICBQYXJhbSxcbiAgUGFyc2VVVUlEUGlwZSxcbiAgVXNlSW50ZXJjZXB0b3JzLFxuICBVcGxvYWRlZEZpbGUsXG4gIEJhZFJlcXVlc3RFeGNlcHRpb24sXG4gIEJvZHksXG4gIFJlcyxcbiAgVXNlR3VhcmRzLFxuICBOb3RGb3VuZEV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgRmlsZUludGVyY2VwdG9yIH0gZnJvbSAnQG5lc3Rqcy9wbGF0Zm9ybS1leHByZXNzJztcbmltcG9ydCB7XG4gIEFwaUNvbnN1bWVzLFxuICBBcGlPcGVyYXRpb24sXG4gIEFwaVBhcmFtLFxuICBBcGlSZXNwb25zZSxcbiAgQXBpVGFncyxcbn0gZnJvbSAnQG5lc3Rqcy9zd2FnZ2VyJztcbmltcG9ydCB7IENvbXByb3ZhbnRlU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2NvbXByb3ZhbnRlLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29tcHJvdmFudGVVcGxvYWREdG8gfSBmcm9tICcuLi9kdG9zL2NvbXByb3ZhbnRlLXVwbG9hZC5kdG8nO1xuaW1wb3J0IHsgQ29tcHJvdmFudGVSZXNwb25zZUR0byB9IGZyb20gJy4uL2R0b3MvY29tcHJvdmFudGUtcmVzcG9uc2UuZHRvJztcbmltcG9ydCB7IFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XG5cbi8qKlxuICogQ29udHJvbGxlciBwYXJhIGdlcmVuY2lhbWVudG8gZGUgY29tcHJvdmFudGVzIGRlIHBhZ2FtZW50b1xuICpcbiAqIEltcGxlbWVudGEgZW5kcG9pbnRzIHBhcmEgdXBsb2FkLCB2aXN1YWxpemHDp8OjbyBlIHJlbW/Dp8OjbyBkZVxuICogZG9jdW1lbnRvcyBjb21wcm9iYXTDs3Jpb3MgYW5leGFkb3MgYW9zIHBhZ2FtZW50b3MuXG4gKlxuICogQGF1dGhvciBFcXVpcGUgUEdCZW5cbiAqL1xuQEFwaVRhZ3MoJ1BhZ2FtZW50b3MnKVxuQENvbnRyb2xsZXIoJ3BhZ2FtZW50b3MvOnBhZ2FtZW50b0lkL2NvbXByb3ZhbnRlcycpXG5leHBvcnQgY2xhc3MgQ29tcHJvdmFudGVDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBjb21wcm92YW50ZVNlcnZpY2U6IENvbXByb3ZhbnRlU2VydmljZSkge31cblxuICAvKipcbiAgICogTGlzdGEgdG9kb3Mgb3MgY29tcHJvdmFudGVzIGFzc29jaWFkb3MgYSB1bSBwYWdhbWVudG9cbiAgICovXG4gIEBHZXQoKVxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0xpc3RhIGNvbXByb3ZhbnRlcyBwYXJhIHVtIGRldGVybWluYWRvIHBhZ2FtZW50bycgfSlcbiAgQEFwaVBhcmFtKHtcbiAgICBuYW1lOiAncGFnYW1lbnRvSWQnLFxuICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgIGRlc2NyaXB0aW9uOiAnSUQgZG8gcGFnYW1lbnRvJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBkZXNjcmlwdGlvbjogJ0xpc3RhIGRlIGNvbXByb3ZhbnRlcycsXG4gICAgdHlwZTogW0NvbXByb3ZhbnRlUmVzcG9uc2VEdG9dLFxuICB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwNCwgZGVzY3JpcHRpb246ICdQYWdhbWVudG8gbsOjbyBlbmNvbnRyYWRvJyB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMywgZGVzY3JpcHRpb246ICdBY2Vzc28gbmVnYWRvJyB9KVxuICAvLyBAVXNlR3VhcmRzKFJvbGVzR3VhcmQpXG4gIC8vIEBSb2xlcygnYWRtaW4nLCAnZ2VzdG9yX3NlbXRhcycsICd0ZWNuaWNvJylcbiAgYXN5bmMgZmluZEFsbChAUGFyYW0oJ3BhZ2FtZW50b0lkJywgUGFyc2VVVUlEUGlwZSkgcGFnYW1lbnRvSWQ6IHN0cmluZykge1xuICAgIGNvbnN0IGNvbXByb3ZhbnRlcyA9XG4gICAgICBhd2FpdCB0aGlzLmNvbXByb3ZhbnRlU2VydmljZS5maW5kQWxsQnlQYWdhbWVudG8ocGFnYW1lbnRvSWQpO1xuXG4gICAgLy8gTWFwZWFyIHBhcmEgRFRPIGRlIHJlc3Bvc3RhXG4gICAgcmV0dXJuIGNvbXByb3ZhbnRlcy5tYXAoKGNvbXByb3ZhbnRlKSA9PiAoe1xuICAgICAgaWQ6IGNvbXByb3ZhbnRlLmlkLFxuICAgICAgcGFnYW1lbnRvSWQ6IGNvbXByb3ZhbnRlLnBhZ2FtZW50b19pZCxcbiAgICAgIHRpcG9Eb2N1bWVudG86IGNvbXByb3ZhbnRlLnRpcG9fZG9jdW1lbnRvLFxuICAgICAgbm9tZUFycXVpdm86IGNvbXByb3ZhbnRlLm5vbWVfYXJxdWl2byxcbiAgICAgIHRhbWFuaG86IGNvbXByb3ZhbnRlLnRhbWFuaG8sXG4gICAgICBtaW1lVHlwZTogY29tcHJvdmFudGUubWltZV90eXBlLFxuICAgICAgZGF0YVVwbG9hZDogY29tcHJvdmFudGUuZGF0YV91cGxvYWQsXG4gICAgICB1cGxvYWRlZFBvcjoge1xuICAgICAgICBpZDogY29tcHJvdmFudGUudXBsb2FkZWRfcG9yLFxuICAgICAgICBub21lOiAnVXN1w6FyaW8gUmVzcG9uc8OhdmVsJywgLy8gc2VyaWEgb2J0aWRvIGRhIGVudGlkYWRlIFVzdWFyaW9cbiAgICAgIH0sXG4gICAgfSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlYWxpemEgbyB1cGxvYWQgZGUgdW0gY29tcHJvdmFudGUgcGFyYSB1bSBwYWdhbWVudG9cbiAgICovXG4gIEBQb3N0KClcbiAgQFVzZUludGVyY2VwdG9ycyhGaWxlSW50ZXJjZXB0b3IoJ2ZpbGUnKSlcbiAgQEFwaUNvbnN1bWVzKCdtdWx0aXBhcnQvZm9ybS1kYXRhJylcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ1JlYWxpemEgdXBsb2FkIGRlIHVtIGNvbXByb3ZhbnRlIHBhcmEgdW0gcGFnYW1lbnRvJyxcbiAgfSlcbiAgQEFwaVBhcmFtKHtcbiAgICBuYW1lOiAncGFnYW1lbnRvSWQnLFxuICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgIGRlc2NyaXB0aW9uOiAnSUQgZG8gcGFnYW1lbnRvJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMSxcbiAgICBkZXNjcmlwdGlvbjogJ0NvbXByb3ZhbnRlIGVudmlhZG8gY29tIHN1Y2Vzc28nLFxuICAgIHR5cGU6IENvbXByb3ZhbnRlUmVzcG9uc2VEdG8sXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiA0MDAsXG4gICAgZGVzY3JpcHRpb246ICdBcnF1aXZvIGludsOhbGlkbyBvdSBkYWRvcyBpbmNvcnJldG9zJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDQsIGRlc2NyaXB0aW9uOiAnUGFnYW1lbnRvIG7Do28gZW5jb250cmFkbycgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDMsIGRlc2NyaXB0aW9uOiAnQWNlc3NvIG5lZ2FkbycgfSlcbiAgLy8gQFVzZUd1YXJkcyhSb2xlc0d1YXJkKVxuICAvLyBAUm9sZXMoJ2FkbWluJywgJ2dlc3Rvcl9zZW10YXMnLCAndGVjbmljbycpXG4gIGFzeW5jIHVwbG9hZENvbXByb3ZhbnRlKFxuICAgIEBQYXJhbSgncGFnYW1lbnRvSWQnLCBQYXJzZVVVSURQaXBlKSBwYWdhbWVudG9JZDogc3RyaW5nLFxuICAgIEBVcGxvYWRlZEZpbGUoKSBmaWxlOiBhbnksXG4gICAgQEJvZHkoKSB1cGxvYWREdG86IENvbXByb3ZhbnRlVXBsb2FkRHRvLFxuICAgIC8vIEBDdXJyZW50VXNlcigpIHVzdWFyaW86IFVzdWFyaW9cbiAgKSB7XG4gICAgaWYgKCFmaWxlKSB7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignTmVuaHVtIGFycXVpdm8gZW52aWFkbycpO1xuICAgIH1cblxuICAgIC8vIFVzYXIgbyBJRCBkbyB1c3XDoXJpbyBhdHVhbFxuICAgIGNvbnN0IHVzdWFyaW9JZCA9ICdwbGFjZWhvbGRlcic7IC8vIHVzdWFyaW8uaWQ7XG5cbiAgICBjb25zdCBjb21wcm92YW50ZSA9IGF3YWl0IHRoaXMuY29tcHJvdmFudGVTZXJ2aWNlLnVwbG9hZENvbXByb3ZhbnRlKFxuICAgICAgcGFnYW1lbnRvSWQsXG4gICAgICBmaWxlLFxuICAgICAgdXBsb2FkRHRvLFxuICAgICAgdXN1YXJpb0lkLFxuICAgICk7XG5cbiAgICAvLyBNYXBlYXIgcGFyYSBEVE8gZGUgcmVzcG9zdGFcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGNvbXByb3ZhbnRlLmlkLFxuICAgICAgcGFnYW1lbnRvSWQ6IGNvbXByb3ZhbnRlLnBhZ2FtZW50b19pZCxcbiAgICAgIHRpcG9Eb2N1bWVudG86IGNvbXByb3ZhbnRlLnRpcG9fZG9jdW1lbnRvLFxuICAgICAgbm9tZUFycXVpdm86IGNvbXByb3ZhbnRlLm5vbWVfYXJxdWl2byxcbiAgICAgIHRhbWFuaG86IGNvbXByb3ZhbnRlLnRhbWFuaG8sXG4gICAgICBtaW1lVHlwZTogY29tcHJvdmFudGUubWltZV90eXBlLFxuICAgICAgZGF0YVVwbG9hZDogY29tcHJvdmFudGUuZGF0YV91cGxvYWQsXG4gICAgICB1cGxvYWRlZFBvcjoge1xuICAgICAgICBpZDogdXN1YXJpb0lkLFxuICAgICAgICBub21lOiAnVXN1w6FyaW8gUmVzcG9uc8OhdmVsJywgLy8gc2VyaWEgb2J0aWRvIGRhIGVudGlkYWRlIFVzdWFyaW9cbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gdW0gY29tcHJvdmFudGUgZXNwZWPDrWZpY28gcGFyYSBkb3dubG9hZFxuICAgKi9cbiAgQEdldCgnOmlkL2Rvd25sb2FkJylcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdGYXogZG93bmxvYWQgZGUgdW0gY29tcHJvdmFudGUnIH0pXG4gIEBBcGlQYXJhbSh7XG4gICAgbmFtZTogJ3BhZ2FtZW50b0lkJyxcbiAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICBkZXNjcmlwdGlvbjogJ0lEIGRvIHBhZ2FtZW50bycsXG4gIH0pXG4gIEBBcGlQYXJhbSh7IG5hbWU6ICdpZCcsIHR5cGU6ICdzdHJpbmcnLCBkZXNjcmlwdGlvbjogJ0lEIGRvIGNvbXByb3ZhbnRlJyB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDIwMCwgZGVzY3JpcHRpb246ICdBcnF1aXZvIGVudmlhZG8gY29tIHN1Y2Vzc28nIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDA0LCBkZXNjcmlwdGlvbjogJ0NvbXByb3ZhbnRlIG7Do28gZW5jb250cmFkbycgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDMsIGRlc2NyaXB0aW9uOiAnQWNlc3NvIG5lZ2FkbycgfSlcbiAgLy8gQFVzZUd1YXJkcyhSb2xlc0d1YXJkKVxuICAvLyBAUm9sZXMoJ2FkbWluJywgJ2dlc3Rvcl9zZW10YXMnLCAndGVjbmljbycpXG4gIGFzeW5jIGRvd25sb2FkQ29tcHJvdmFudGUoXG4gICAgQFBhcmFtKCdpZCcsIFBhcnNlVVVJRFBpcGUpIGlkOiBzdHJpbmcsXG4gICAgQFJlcygpIHJlczogUmVzcG9uc2UsXG4gICkge1xuICAgIGNvbnN0IHsgYnVmZmVyLCBmaWxlTmFtZSwgbWltZVR5cGUgfSA9XG4gICAgICBhd2FpdCB0aGlzLmNvbXByb3ZhbnRlU2VydmljZS5nZXRDb21wcm92YW50ZUNvbnRlbnQoaWQpO1xuXG4gICAgcmVzLnNldCh7XG4gICAgICAnQ29udGVudC1UeXBlJzogbWltZVR5cGUsXG4gICAgICAnQ29udGVudC1EaXNwb3NpdGlvbic6IGBhdHRhY2htZW50OyBmaWxlbmFtZT1cIiR7ZW5jb2RlVVJJQ29tcG9uZW50KGZpbGVOYW1lKX1cImAsXG4gICAgICAnQ29udGVudC1MZW5ndGgnOiBidWZmZXIubGVuZ3RoLnRvU3RyaW5nKCksXG4gICAgfSk7XG5cbiAgICByZXMuZW5kKGJ1ZmZlcik7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2EgdW0gY29tcHJvdmFudGUgcGVsbyBJRFxuICAgKi9cbiAgQEdldCgnOmlkJylcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdCdXNjYSB1bSBjb21wcm92YW50ZSBwZWxvIElEJyB9KVxuICBAQXBpUGFyYW0oe1xuICAgIG5hbWU6ICdwYWdhbWVudG9JZCcsXG4gICAgdHlwZTogJ3N0cmluZycsXG4gICAgZGVzY3JpcHRpb246ICdJRCBkbyBwYWdhbWVudG8nLFxuICB9KVxuICBAQXBpUGFyYW0oeyBuYW1lOiAnaWQnLCB0eXBlOiAnc3RyaW5nJywgZGVzY3JpcHRpb246ICdJRCBkbyBjb21wcm92YW50ZScgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBkZXNjcmlwdGlvbjogJ0NvbXByb3ZhbnRlIGVuY29udHJhZG8nLFxuICAgIHR5cGU6IENvbXByb3ZhbnRlUmVzcG9uc2VEdG8sXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDA0LCBkZXNjcmlwdGlvbjogJ0NvbXByb3ZhbnRlIG7Do28gZW5jb250cmFkbycgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDMsIGRlc2NyaXB0aW9uOiAnQWNlc3NvIG5lZ2FkbycgfSlcbiAgLy8gQFVzZUd1YXJkcyhSb2xlc0d1YXJkKVxuICAvLyBAUm9sZXMoJ2FkbWluJywgJ2dlc3Rvcl9zZW10YXMnLCAndGVjbmljbycpXG4gIGFzeW5jIGZpbmRPbmUoQFBhcmFtKCdpZCcsIFBhcnNlVVVJRFBpcGUpIGlkOiBzdHJpbmcpIHtcbiAgICBjb25zdCBjb21wcm92YW50ZSA9IGF3YWl0IHRoaXMuY29tcHJvdmFudGVTZXJ2aWNlLmZpbmRPbmUoaWQpO1xuXG4gICAgaWYgKCFjb21wcm92YW50ZSkge1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdDb21wcm92YW50ZSBuw6NvIGVuY29udHJhZG8nKTtcbiAgICB9XG5cbiAgICAvLyBNYXBlYXIgcGFyYSBEVE8gZGUgcmVzcG9zdGFcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGNvbXByb3ZhbnRlLmlkLFxuICAgICAgcGFnYW1lbnRvSWQ6IGNvbXByb3ZhbnRlLnBhZ2FtZW50b19pZCxcbiAgICAgIHRpcG9Eb2N1bWVudG86IGNvbXByb3ZhbnRlLnRpcG9fZG9jdW1lbnRvLFxuICAgICAgbm9tZUFycXVpdm86IGNvbXByb3ZhbnRlLm5vbWVfYXJxdWl2byxcbiAgICAgIHRhbWFuaG86IGNvbXByb3ZhbnRlLnRhbWFuaG8sXG4gICAgICBtaW1lVHlwZTogY29tcHJvdmFudGUubWltZV90eXBlLFxuICAgICAgZGF0YVVwbG9hZDogY29tcHJvdmFudGUuZGF0YV91cGxvYWQsXG4gICAgICB1cGxvYWRlZFBvcjoge1xuICAgICAgICBpZDogY29tcHJvdmFudGUudXBsb2FkZWRfcG9yLFxuICAgICAgICBub21lOiAnVXN1w6FyaW8gUmVzcG9uc8OhdmVsJywgLy8gc2VyaWEgb2J0aWRvIGRhIGVudGlkYWRlIFVzdWFyaW9cbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgdW0gY29tcHJvdmFudGVcbiAgICovXG4gIEBEZWxldGUoJzppZCcpXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnUmVtb3ZlIHVtIGNvbXByb3ZhbnRlJyB9KVxuICBAQXBpUGFyYW0oe1xuICAgIG5hbWU6ICdwYWdhbWVudG9JZCcsXG4gICAgdHlwZTogJ3N0cmluZycsXG4gICAgZGVzY3JpcHRpb246ICdJRCBkbyBwYWdhbWVudG8nLFxuICB9KVxuICBAQXBpUGFyYW0oeyBuYW1lOiAnaWQnLCB0eXBlOiAnc3RyaW5nJywgZGVzY3JpcHRpb246ICdJRCBkbyBjb21wcm92YW50ZScgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiAyMDAsIGRlc2NyaXB0aW9uOiAnQ29tcHJvdmFudGUgcmVtb3ZpZG8gY29tIHN1Y2Vzc28nIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDA0LCBkZXNjcmlwdGlvbjogJ0NvbXByb3ZhbnRlIG7Do28gZW5jb250cmFkbycgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDQwOSxcbiAgICBkZXNjcmlwdGlvbjogJ0NvbXByb3ZhbnRlIG7Do28gcG9kZSBzZXIgcmVtb3ZpZG8nLFxuICB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwMywgZGVzY3JpcHRpb246ICdBY2Vzc28gbmVnYWRvJyB9KVxuICAvLyBAVXNlR3VhcmRzKFJvbGVzR3VhcmQpXG4gIC8vIEBSb2xlcygnYWRtaW4nLCAnZ2VzdG9yX3NlbXRhcycsICd0ZWNuaWNvJylcbiAgYXN5bmMgcmVtb3ZlKFxuICAgIEBQYXJhbSgnaWQnLCBQYXJzZVVVSURQaXBlKSBpZDogc3RyaW5nLFxuICAgIC8vIEBDdXJyZW50VXNlcigpIHVzdWFyaW86IFVzdWFyaW9cbiAgKSB7XG4gICAgLy8gVXNhciBvIElEIGRvIHVzdcOhcmlvIGF0dWFsXG4gICAgY29uc3QgdXN1YXJpb0lkID0gJ3BsYWNlaG9sZGVyJzsgLy8gdXN1YXJpby5pZDtcblxuICAgIGF3YWl0IHRoaXMuY29tcHJvdmFudGVTZXJ2aWNlLnJlbW92ZUNvbXByb3ZhbnRlKGlkLCB1c3VhcmlvSWQpO1xuXG4gICAgcmV0dXJuIHsgbWVzc2FnZTogJ0NvbXByb3ZhbnRlIHJlbW92aWRvIGNvbSBzdWNlc3NvJyB9O1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=