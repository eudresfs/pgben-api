6881cdde6de4b26515d8b7871028a51e
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var AuthController_1;
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuthController = void 0;
const common_1 = require("@nestjs/common");
const swagger_1 = require("@nestjs/swagger");
const base_api_response_dto_1 = require("../../shared/dtos/base-api-response.dto");
const logger_service_1 = require("../../shared/logger/logger.service");
const req_context_decorator_1 = require("../../shared/request-context/req-context.decorator");
const request_context_dto_1 = require("../../shared/request-context/request-context.dto");
const auth_login_input_dto_1 = require("../dtos/auth-login-input.dto");
const auth_refresh_token_input_dto_1 = require("../dtos/auth-refresh-token-input.dto");
const auth_token_output_dto_1 = require("../dtos/auth-token-output.dto");
const jwt_refresh_guard_1 = require("../guards/jwt-refresh.guard");
const local_auth_guard_1 = require("../guards/local-auth.guard");
const auth_service_1 = require("../services/auth.service");
const public_decorator_1 = require("../decorators/public.decorator");
let AuthController = AuthController_1 = class AuthController {
    authService;
    logger;
    constructor(authService, logger) {
        this.authService = authService;
        this.logger = logger;
        this.logger.setContext(AuthController_1.name);
    }
    async login(ctx, credential) {
        this.logger.log(ctx, `${this.login.name} was called`);
        const authToken = await this.authService.login(ctx);
        // Converter para o formato BaseApiResponse
        const response = new base_api_response_dto_1.BaseApiResponse();
        response.data = authToken;
        response.meta = {};
        return response;
    }
    async refreshToken(ctx, credential) {
        this.logger.log(ctx, `${this.refreshToken.name} was called`);
        const authToken = await this.authService.refreshToken(ctx, credential);
        // Converter para o formato BaseApiResponse
        const response = new base_api_response_dto_1.BaseApiResponse();
        response.data = authToken;
        response.meta = {};
        return response;
    }
    getStatus() {
        return {
            status: 'online',
            message: 'Serviço de autenticação está funcionando',
            timestamp: new Date().toISOString(),
        };
    }
};
exports.AuthController = AuthController;
__decorate([
    (0, common_1.Post)('login'),
    (0, public_decorator_1.Public)(),
    (0, swagger_1.ApiOperation)({
        summary: 'Fazer login',
        description: 'Autentica um usuário no sistema usando credenciais (username/password)',
        requestBody: {
            description: 'Credenciais de login',
            required: true,
            content: {
                'application/json': {
                    schema: {
                        $ref: '#/components/schemas/LoginInput',
                    },
                    examples: {
                        'usuario-admin': {
                            summary: 'Login de Administrador',
                            description: 'Exemplo de login para usuário administrador',
                            value: {
                                username: 'admin@semtas.gov.br',
                                password: 'senha123'
                            }
                        },
                        'usuario-assistente': {
                            summary: 'Login de Assistente Social',
                            description: 'Exemplo de login para assistente social',
                            value: {
                                username: 'maria.silva@semtas.gov.br',
                                password: 'minhasenha456'
                            }
                        },
                        'usuario-coordenador': {
                            summary: 'Login de Coordenador',
                            description: 'Exemplo de login para coordenador de unidade',
                            value: {
                                username: 'joao.santos@semtas.gov.br',
                                password: 'coordenador789'
                            }
                        }
                    }
                }
            }
        }
    }),
    (0, swagger_1.ApiResponse)({
        status: common_1.HttpStatus.OK,
        type: (0, base_api_response_dto_1.SwaggerBaseApiResponse)(auth_token_output_dto_1.AuthTokenOutput),
    }),
    (0, swagger_1.ApiResponse)({
        status: common_1.HttpStatus.UNAUTHORIZED,
        type: base_api_response_dto_1.BaseApiErrorResponse,
    }),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, common_1.UseGuards)(local_auth_guard_1.LocalAuthGuard),
    (0, common_1.UseInterceptors)(common_1.ClassSerializerInterceptor),
    __param(0, (0, req_context_decorator_1.ReqContext)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof request_context_dto_1.RequestContext !== "undefined" && request_context_dto_1.RequestContext) === "function" ? _c : Object, typeof (_d = typeof auth_login_input_dto_1.LoginInput !== "undefined" && auth_login_input_dto_1.LoginInput) === "function" ? _d : Object]),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], AuthController.prototype, "login", null);
__decorate([
    (0, common_1.Post)('refresh-token'),
    (0, swagger_1.ApiOperation)({
        summary: 'Atualizar token da api',
        description: 'Renova o token de acesso usando um refresh token válido',
        requestBody: {
            description: 'Refresh token para renovação',
            required: true,
            content: {
                'application/json': {
                    schema: {
                        $ref: '#/components/schemas/RefreshTokenInput',
                    },
                    examples: {
                        'refresh-token': {
                            summary: 'Renovação de Token',
                            description: 'Exemplo de renovação usando refresh token',
                            value: {
                                refreshToken: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c'
                            }
                        }
                    }
                }
            }
        }
    }),
    (0, swagger_1.ApiResponse)({
        status: common_1.HttpStatus.OK,
        type: (0, base_api_response_dto_1.SwaggerBaseApiResponse)(auth_token_output_dto_1.AuthTokenOutput),
    }),
    (0, swagger_1.ApiResponse)({
        status: common_1.HttpStatus.UNAUTHORIZED,
        type: base_api_response_dto_1.BaseApiErrorResponse,
    }),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, common_1.UseGuards)(jwt_refresh_guard_1.JwtRefreshGuard),
    (0, common_1.UseInterceptors)(common_1.ClassSerializerInterceptor),
    __param(0, (0, req_context_decorator_1.ReqContext)()),
    __param(1, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof request_context_dto_1.RequestContext !== "undefined" && request_context_dto_1.RequestContext) === "function" ? _f : Object, typeof (_g = typeof auth_refresh_token_input_dto_1.RefreshTokenInput !== "undefined" && auth_refresh_token_input_dto_1.RefreshTokenInput) === "function" ? _g : Object]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], AuthController.prototype, "refreshToken", null);
__decorate([
    (0, common_1.Get)('status'),
    (0, public_decorator_1.Public)(),
    (0, swagger_1.ApiOperation)({
        summary: 'Verificar status do serviço de autenticação',
    }),
    (0, swagger_1.ApiResponse)({
        status: common_1.HttpStatus.OK,
        schema: {
            type: 'object',
            properties: {
                status: { type: 'string', example: 'online' },
                message: { type: 'string', example: 'Serviço de autenticação está funcionando' },
                timestamp: { type: 'string', format: 'date-time', example: '2023-01-01T00:00:00.000Z' },
            },
        },
    }),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Object)
], AuthController.prototype, "getStatus", null);
exports.AuthController = AuthController = AuthController_1 = __decorate([
    (0, swagger_1.ApiTags)('Autenticação'),
    (0, common_1.Controller)('auth'),
    __metadata("design:paramtypes", [typeof (_a = typeof auth_service_1.AuthService !== "undefined" && auth_service_1.AuthService) === "function" ? _a : Object, typeof (_b = typeof logger_service_1.AppLogger !== "undefined" && logger_service_1.AppLogger) === "function" ? _b : Object])
], AuthController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGF1dGhcXGNvbnRyb2xsZXJzXFxhdXRoLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FVd0I7QUFDeEIsNkNBQXFFO0FBRXJFLG1GQUlpRDtBQUNqRCx1RUFBK0Q7QUFDL0QsOEZBQWdGO0FBQ2hGLDBGQUFrRjtBQUNsRix1RUFBMEQ7QUFDMUQsdUZBQXlFO0FBQ3pFLHlFQUFnRTtBQUNoRSxtRUFBOEQ7QUFDOUQsaUVBQTREO0FBQzVELDJEQUF1RDtBQUN2RCxxRUFBd0Q7QUFJakQsSUFBTSxjQUFjLHNCQUFwQixNQUFNLGNBQWM7SUFFTjtJQUNBO0lBRm5CLFlBQ21CLFdBQXdCLEVBQ3hCLE1BQWlCO1FBRGpCLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQ3hCLFdBQU0sR0FBTixNQUFNLENBQVc7UUFFbEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsZ0JBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBdURLLEFBQU4sS0FBSyxDQUFDLEtBQUssQ0FDSyxHQUFtQixFQUN6QixVQUFzQjtRQUU5QixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksYUFBYSxDQUFDLENBQUM7UUFFdEQsTUFBTSxTQUFTLEdBQUcsTUFBTSxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUVwRCwyQ0FBMkM7UUFDM0MsTUFBTSxRQUFRLEdBQUcsSUFBSSx1Q0FBZSxFQUFtQixDQUFDO1FBQ3hELFFBQVEsQ0FBQyxJQUFJLEdBQUcsU0FBUyxDQUFDO1FBQzFCLFFBQVEsQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBRW5CLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFzQ0ssQUFBTixL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VSxDQUFDLEVBQUU7UUFDckIsTUFBTSxFQUFFO1lBQ04sSUFBSSxFQUFFLFFBQVE7WUFDZCxVQUFVLEVBQUU7Z0JBQ1YsTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFO2dCQUM3QyxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSwwQ0FBMEMsRUFBRTtnQkFDaEYsU0FBUyxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRTthQUN4RjtTQUNGO0tBQ0YsQ0FBQztJQUNELElBQUEsaUJBQVEsRUFBQyxtQkFBVSxDQUFDLEVBQUUsQ0FBQzs7OzsrQ0FPdkI7eUJBeEpVLGNBQWM7SUFGMUIsSUFBQSxpQkFBTyxFQUFDLGNBQWMsQ0FBQztJQUN2QixJQUFBLG1CQUFVLEVBQUMsTUFBTSxDQUFDO3lEQUdlLDBCQUFXLG9CQUFYLDBCQUFXLG9EQUNoQiwwQkFBUyxvQkFBVCwwQkFBUztHQUh6QixjQUFjLENBeUoxQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcYXV0aFxcY29udHJvbGxlcnNcXGF1dGguY29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBCb2R5LFxuICBDbGFzc1NlcmlhbGl6ZXJJbnRlcmNlcHRvcixcbiAgQ29udHJvbGxlcixcbiAgR2V0LFxuICBIdHRwQ29kZSxcbiAgSHR0cFN0YXR1cyxcbiAgUG9zdCxcbiAgVXNlR3VhcmRzLFxuICBVc2VJbnRlcmNlcHRvcnMsXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IEFwaU9wZXJhdGlvbiwgQXBpUmVzcG9uc2UsIEFwaVRhZ3MgfSBmcm9tICdAbmVzdGpzL3N3YWdnZXInO1xuXG5pbXBvcnQge1xuICBCYXNlQXBpRXJyb3JSZXNwb25zZSxcbiAgQmFzZUFwaVJlc3BvbnNlLFxuICBTd2FnZ2VyQmFzZUFwaVJlc3BvbnNlLFxufSBmcm9tICcuLi8uLi9zaGFyZWQvZHRvcy9iYXNlLWFwaS1yZXNwb25zZS5kdG8nO1xuaW1wb3J0IHsgQXBwTG9nZ2VyIH0gZnJvbSAnLi4vLi4vc2hhcmVkL2xvZ2dlci9sb2dnZXIuc2VydmljZSc7XG5pbXBvcnQgeyBSZXFDb250ZXh0IH0gZnJvbSAnLi4vLi4vc2hhcmVkL3JlcXVlc3QtY29udGV4dC9yZXEtY29udGV4dC5kZWNvcmF0b3InO1xuaW1wb3J0IHsgUmVxdWVzdENvbnRleHQgfSBmcm9tICcuLi8uLi9zaGFyZWQvcmVxdWVzdC1jb250ZXh0L3JlcXVlc3QtY29udGV4dC5kdG8nO1xuaW1wb3J0IHsgTG9naW5JbnB1dCB9IGZyb20gJy4uL2R0b3MvYXV0aC1sb2dpbi1pbnB1dC5kdG8nO1xuaW1wb3J0IHsgUmVmcmVzaFRva2VuSW5wdXQgfSBmcm9tICcuLi9kdG9zL2F1dGgtcmVmcmVzaC10b2tlbi1pbnB1dC5kdG8nO1xuaW1wb3J0IHsgQXV0aFRva2VuT3V0cHV0IH0gZnJvbSAnLi4vZHRvcy9hdXRoLXRva2VuLW91dHB1dC5kdG8nO1xuaW1wb3J0IHsgSnd0UmVmcmVzaEd1YXJkIH0gZnJvbSAnLi4vZ3VhcmRzL2p3dC1yZWZyZXNoLmd1YXJkJztcbmltcG9ydCB7IExvY2FsQXV0aEd1YXJkIH0gZnJvbSAnLi4vZ3VhcmRzL2xvY2FsLWF1dGguZ3VhcmQnO1xuaW1wb3J0IHsgQXV0aFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UnO1xuaW1wb3J0IHsgUHVibGljIH0gZnJvbSAnLi4vZGVjb3JhdG9ycy9wdWJsaWMuZGVjb3JhdG9yJztcblxuQEFwaVRhZ3MoJ0F1dGVudGljYcOnw6NvJylcbkBDb250cm9sbGVyKCdhdXRoJykgXG5leHBvcnQgY2xhc3MgQXV0aENvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGF1dGhTZXJ2aWNlOiBBdXRoU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGxvZ2dlcjogQXBwTG9nZ2VyLFxuICApIHtcbiAgICB0aGlzLmxvZ2dlci5zZXRDb250ZXh0KEF1dGhDb250cm9sbGVyLm5hbWUpO1xuICB9XG4gIEBQb3N0KCdsb2dpbicpXG4gIEBQdWJsaWMoKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnRmF6ZXIgbG9naW4nLFxuICAgIGRlc2NyaXB0aW9uOiAnQXV0ZW50aWNhIHVtIHVzdcOhcmlvIG5vIHNpc3RlbWEgdXNhbmRvIGNyZWRlbmNpYWlzICh1c2VybmFtZS9wYXNzd29yZCknLFxuICAgIHJlcXVlc3RCb2R5OiB7XG4gICAgICBkZXNjcmlwdGlvbjogJ0NyZWRlbmNpYWlzIGRlIGxvZ2luJyxcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgY29udGVudDoge1xuICAgICAgICAnYXBwbGljYXRpb24vanNvbic6IHtcbiAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICRyZWY6ICcjL2NvbXBvbmVudHMvc2NoZW1hcy9Mb2dpbklucHV0JyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGV4YW1wbGVzOiB7XG4gICAgICAgICAgICAndXN1YXJpby1hZG1pbic6IHtcbiAgICAgICAgICAgICAgc3VtbWFyeTogJ0xvZ2luIGRlIEFkbWluaXN0cmFkb3InLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0V4ZW1wbG8gZGUgbG9naW4gcGFyYSB1c3XDoXJpbyBhZG1pbmlzdHJhZG9yJyxcbiAgICAgICAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICAgICAgICB1c2VybmFtZTogJ2FkbWluQHNlbXRhcy5nb3YuYnInLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiAnc2VuaGExMjMnXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAndXN1YXJpby1hc3Npc3RlbnRlJzoge1xuICAgICAgICAgICAgICBzdW1tYXJ5OiAnTG9naW4gZGUgQXNzaXN0ZW50ZSBTb2NpYWwnLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0V4ZW1wbG8gZGUgbG9naW4gcGFyYSBhc3Npc3RlbnRlIHNvY2lhbCcsXG4gICAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6ICdtYXJpYS5zaWx2YUBzZW10YXMuZ292LmJyJyxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogJ21pbmhhc2VuaGE0NTYnXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAndXN1YXJpby1jb29yZGVuYWRvcic6IHtcbiAgICAgICAgICAgICAgc3VtbWFyeTogJ0xvZ2luIGRlIENvb3JkZW5hZG9yJyxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdFeGVtcGxvIGRlIGxvZ2luIHBhcmEgY29vcmRlbmFkb3IgZGUgdW5pZGFkZScsXG4gICAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6ICdqb2FvLnNhbnRvc0BzZW10YXMuZ292LmJyJyxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogJ2Nvb3JkZW5hZG9yNzg5J1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogSHR0cFN0YXR1cy5PSyxcbiAgICB0eXBlOiBTd2FnZ2VyQmFzZUFwaVJlc3BvbnNlKEF1dGhUb2tlbk91dHB1dCksXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiBIdHRwU3RhdHVzLlVOQVVUSE9SSVpFRCxcbiAgICB0eXBlOiBCYXNlQXBpRXJyb3JSZXNwb25zZSxcbiAgfSlcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIEBVc2VHdWFyZHMoTG9jYWxBdXRoR3VhcmQpXG4gIEBVc2VJbnRlcmNlcHRvcnMoQ2xhc3NTZXJpYWxpemVySW50ZXJjZXB0b3IpXG4gIGFzeW5jIGxvZ2luKFxuICAgIEBSZXFDb250ZXh0KCkgY3R4OiBSZXF1ZXN0Q29udGV4dCxcbiAgICBAQm9keSgpIGNyZWRlbnRpYWw6IExvZ2luSW5wdXQsXG4gICk6IFByb21pc2U8QmFzZUFwaVJlc3BvbnNlPEF1dGhUb2tlbk91dHB1dD4+IHtcbiAgICB0aGlzLmxvZ2dlci5sb2coY3R4LCBgJHt0aGlzLmxvZ2luLm5hbWV9IHdhcyBjYWxsZWRgKTtcblxuICAgIGNvbnN0IGF1dGhUb2tlbiA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UubG9naW4oY3R4KTtcblxuICAgIC8vIENvbnZlcnRlciBwYXJhIG8gZm9ybWF0byBCYXNlQXBpUmVzcG9uc2VcbiAgICBjb25zdCByZXNwb25zZSA9IG5ldyBCYXNlQXBpUmVzcG9uc2U8QXV0aFRva2VuT3V0cHV0PigpO1xuICAgIHJlc3BvbnNlLmRhdGEgPSBhdXRoVG9rZW47XG4gICAgcmVzcG9uc2UubWV0YSA9IHt9O1xuXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9XG5cbiAgQFBvc3QoJ3JlZnJlc2gtdG9rZW4nKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnQXR1YWxpemFyIHRva2VuIGRhIGFwaScsXG4gICAgZGVzY3JpcHRpb246ICdSZW5vdmEgbyB0b2tlbiBkZSBhY2Vzc28gdXNhbmRvIHVtIHJlZnJlc2ggdG9rZW4gdsOhbGlkbycsXG4gICAgcmVxdWVzdEJvZHk6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiAnUmVmcmVzaCB0b2tlbiBwYXJhIHJlbm92YcOnw6NvJyxcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgY29udGVudDoge1xuICAgICAgICAnYXBwbGljYXRpb24vanNvbic6IHtcbiAgICAgICAgICBzY2hlbWE6IHtcbiAgICAgICAgICAgICRyZWY6ICcjL2NvbXBvbmVudHMvc2NoZW1hcy9SZWZyZXNoVG9rZW5JbnB1dCcsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBleGFtcGxlczoge1xuICAgICAgICAgICAgJ3JlZnJlc2gtdG9rZW4nOiB7XG4gICAgICAgICAgICAgIHN1bW1hcnk6ICdSZW5vdmHDp8OjbyBkZSBUb2tlbicsXG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRXhlbXBsbyBkZSByZW5vdmHDp8OjbyB1c2FuZG8gcmVmcmVzaCB0b2tlbicsXG4gICAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuOiAnZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnpkV0lpT2lJeE1qTTBOVFkzT0Rrd0lpd2libUZ0WlNJNklrcHZhRzRnUkc5bElpd2lhV0YwSWpveE5URTJNak01TURJeWZRLlNmbEt4d1JKU01lS0tGMlFUNGZ3cE1lSmYzNlBPazZ5SlZfYWRRc3N3NWMnXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiBIdHRwU3RhdHVzLk9LLFxuICAgIHR5cGU6IFN3YWdnZXJCYXNlQXBpUmVzcG9uc2UoQXV0aFRva2VuT3V0cHV0KSxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IEh0dHBTdGF0dXMuVU5BVVRIT1JJWkVELFxuICAgIHR5cGU6IEJhc2VBcGlFcnJvclJlc3BvbnNlLFxuICB9KVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgQFVzZUd1YXJkcyhKd3RSZWZyZXNoR3VhcmQpXG4gIEBVc2VJbnRlcmNlcHRvcnMoQ2xhc3NTZXJpYWxpemVySW50ZXJjZXB0b3IpXG4gIGFzeW5jIHJlZnJlc2hUb2tlbihcbiAgICBAUmVxQ29udGV4dCgpIGN0eDogUmVxdWVzdENvbnRleHQsXG4gICAgQEJvZHkoKSBjcmVkZW50aWFsOiBSZWZyZXNoVG9rZW5JbnB1dCxcbiAgKTogUHJvbWlzZTxCYXNlQXBpUmVzcG9uc2U8QXV0aFRva2VuT3V0cHV0Pj4ge1xuICAgIHRoaXMubG9nZ2VyLmxvZyhjdHgsIGAke3RoaXMucmVmcmVzaFRva2VuLm5hbWV9IHdhcyBjYWxsZWRgKTtcblxuICAgIGNvbnN0IGF1dGhUb2tlbiA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UucmVmcmVzaFRva2VuKGN0eCwgY3JlZGVudGlhbCk7XG5cbiAgICAvLyBDb252ZXJ0ZXIgcGFyYSBvIGZvcm1hdG8gQmFzZUFwaVJlc3BvbnNlXG4gICAgY29uc3QgcmVzcG9uc2UgPSBuZXcgQmFzZUFwaVJlc3BvbnNlPEF1dGhUb2tlbk91dHB1dD4oKTtcbiAgICByZXNwb25zZS5kYXRhID0gYXV0aFRva2VuO1xuICAgIHJlc3BvbnNlLm1ldGEgPSB7fTtcblxuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuICBcbiAgQEdldCgnc3RhdHVzJylcbiAgQFB1YmxpYygpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdWZXJpZmljYXIgc3RhdHVzIGRvIHNlcnZpw6dvIGRlIGF1dGVudGljYcOnw6NvJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IEh0dHBTdGF0dXMuT0ssXG4gICAgc2NoZW1hOiB7XG4gICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgc3RhdHVzOiB7IHR5cGU6ICdzdHJpbmcnLCBleGFtcGxlOiAnb25saW5lJyB9LFxuICAgICAgICBtZXNzYWdlOiB7IHR5cGU6ICdzdHJpbmcnLCBleGFtcGxlOiAnU2VydmnDp28gZGUgYXV0ZW50aWNhw6fDo28gZXN0w6EgZnVuY2lvbmFuZG8nIH0sXG4gICAgICAgIHRpbWVzdGFtcDogeyB0eXBlOiAnc3RyaW5nJywgZm9ybWF0OiAnZGF0ZS10aW1lJywgZXhhbXBsZTogJzIwMjMtMDEtMDFUMDA6MDA6MDAuMDAwWicgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIGdldFN0YXR1cygpOiB7IHN0YXR1czogc3RyaW5nOyBtZXNzYWdlOiBzdHJpbmc7IHRpbWVzdGFtcDogc3RyaW5nIH0ge1xuICAgIHJldHVybiB7XG4gICAgICBzdGF0dXM6ICdvbmxpbmUnLFxuICAgICAgbWVzc2FnZTogJ1NlcnZpw6dvIGRlIGF1dGVudGljYcOnw6NvIGVzdMOhIGZ1bmNpb25hbmRvJyxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==