d9a0632175c358b8ef9bfb5cf30380ad
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", { value: true });
exports.PermissionGroupMapping = void 0;
const typeorm_1 = require("typeorm");
const class_validator_1 = require("class-validator");
const permission_entity_1 = require("./permission.entity");
const permission_group_entity_1 = require("./permission-group.entity");
const usuario_entity_1 = require("./usuario.entity");
/**
 * Entidade que representa o relacionamento muitos-para-muitos entre permissões e grupos.
 *
 * Esta entidade permite associar permissões a grupos, facilitando a organização
 * e atribuição de permissões relacionadas.
 */
let PermissionGroupMapping = class PermissionGroupMapping {
    /**
     * Identificador único do mapeamento
     */
    id;
    /**
     * Referência à permissão
     */
    permissao_id;
    /**
     * Relação com a permissão
     */
    permissao;
    /**
     * Referência ao grupo
     */
    grupo_id;
    /**
     * Relação com o grupo
     */
    grupo;
    /**
     * Data de criação
     */
    created_at;
    /**
     * Usuário que criou o mapeamento
     */
    criado_por;
    /**
     * Relação com o usuário que criou o mapeamento
     */
    usuario_criador;
    // Getters e setters para compatibilidade com código existente
    get permissionId() {
        return this.permissao_id;
    }
    set permissionId(value) {
        this.permissao_id = value;
    }
    get permission() {
        return this.permissao;
    }
    set permission(value) {
        this.permissao = value;
    }
    get groupId() {
        return this.grupo_id;
    }
    set groupId(value) {
        this.grupo_id = value;
    }
    get group() {
        return this.grupo;
    }
    set group(value) {
        this.grupo = value;
    }
    get createdAt() {
        return this.created_at;
    }
    get createdBy() {
        return this.criado_por;
    }
    set createdBy(value) {
        this.criado_por = value;
    }
    /**
     * Verifica se o mapeamento foi criado por um usuário específico
     * @param usuarioId ID do usuário
     * @returns true se foi criado pelo usuário
     */
    foiCriadoPor(usuarioId) {
        return this.criado_por === usuarioId;
    }
    /**
     * Obtém uma chave única para o mapeamento
     * @returns chave única baseada em permissão e grupo
     */
    getUniqueKey() {
        return `${this.permissao_id}:${this.grupo_id}`;
    }
    /**
     * Verifica se o mapeamento é válido
     * @returns true se tem permissão e grupo válidos
     */
    isValido() {
        return !!(this.permissao_id && this.grupo_id);
    }
    /**
     * Define o criador do mapeamento
     * @param usuarioId ID do usuário criador
     */
    definirCriador(usuarioId) {
        this.criado_por = usuarioId;
    }
    /**
     * Verifica se o mapeamento pertence a um grupo específico
     * @param grupoId ID do grupo
     * @returns true se pertence ao grupo
     */
    pertenceAoGrupo(grupoId) {
        return this.grupo_id === grupoId;
    }
    /**
     * Verifica se o mapeamento contém uma permissão específica
     * @param permissaoId ID da permissão
     * @returns true se contém a permissão
     */
    contemPermissao(permissaoId) {
        return this.permissao_id === permissaoId;
    }
    /**
     * Verifica se o mapeamento foi criado recentemente (últimas 24 horas)
     * @returns true se foi criado recentemente
     */
    isCriadoRecentemente() {
        if (!this.created_at)
            return false;
        const agora = new Date();
        const umDiaAtras = new Date(agora.getTime() - 24 * 60 * 60 * 1000);
        return this.created_at > umDiaAtras;
    }
    /**
     * Calcula a idade do mapeamento em dias
     * @returns idade em dias
     */
    getIdadeEmDias() {
        if (!this.created_at)
            return 0;
        const agora = new Date();
        const diffTime = Math.abs(agora.getTime() - this.created_at.getTime());
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays;
    }
    /**
     * Verifica se o mapeamento tem criador definido
     * @returns true se tem criador
     */
    temCriador() {
        return !!this.criado_por;
    }
    /**
     * Obtém informações resumidas do mapeamento
     * @returns objeto com informações resumidas
     */
    getSummary() {
        return {
            id: this.id,
            permissao_id: this.permissao_id,
            grupo_id: this.grupo_id,
            criado_por: this.criado_por,
            created_at: this.created_at,
            idadeEmDias: this.getIdadeEmDias(),
            permissaoNome: this.permissao?.nome,
            grupoNome: this.grupo?.nome
        };
    }
    /**
     * Verifica se o mapeamento é compatível com outro mapeamento
     * @param otherMapping Outro mapeamento
     * @returns true se são compatíveis (mesmo grupo)
     */
    isCompatibleWith(otherMapping) {
        return this.grupo_id === otherMapping.grupo_id;
    }
    /**
     * Gera uma chave única estendida para o mapeamento
     * @returns chave única estendida
     */
    getExtendedUniqueKey() {
        return `permission_group_mapping_${this.permissao_id}_${this.grupo_id}_${this.id}`;
    }
    /**
     * Verifica se o mapeamento está em estado consistente
     * @returns true se está consistente
     */
    isConsistente() {
        return (!!this.id &&
            !!this.permissao_id &&
            !!this.grupo_id &&
            !!this.created_at);
    }
    /**
     * Obtém uma descrição legível do mapeamento
     * @returns descrição formatada
     */
    getDescricao() {
        const permissaoNome = this.permissao?.nome || 'Permissão não carregada';
        const grupoNome = this.grupo?.nome || 'Grupo não carregado';
        return `Grupo "${grupoNome}" -> Permissão: ${permissaoNome}`;
    }
    /**
     * Verifica se o mapeamento pode ser removido
     * @returns true se pode ser removido
     */
    podeSerRemovido() {
        // Por padrão, todos os mapeamentos podem ser removidos
        // Esta lógica pode ser expandida conforme regras de negócio
        return true;
    }
    /**
     * Clona o mapeamento (sem ID e data)
     * @returns mapeamento clonado
     */
    clone() {
        return {
            permissao_id: this.permissao_id,
            grupo_id: this.grupo_id,
            criado_por: this.criado_por
        };
    }
    /**
     * Verifica se o mapeamento é para uma permissão de administrador
     * @returns true se é permissão de admin
     */
    isAdminPermission() {
        return this.permissao?.isAdminPermission() || false;
    }
    /**
     * Verifica se o mapeamento é para uma permissão de sistema
     * @returns true se é permissão de sistema
     */
    isSystemPermission() {
        return this.permissao?.isSystemPermission() || false;
    }
    /**
     * Obtém o nível de criticidade baseado na permissão
     * @returns nível de criticidade
     */
    getCriticalityLevel() {
        return this.permissao?.getCriticalityLevel() || 'LOW';
    }
    /**
     * Verifica se o grupo está ativo
     * @returns true se o grupo está ativo
     */
    isGrupoAtivo() {
        return this.grupo?.isAtivo() || false;
    }
    /**
     * Verifica se a permissão está ativa
     * @returns true se a permissão está ativa
     */
    isPermissaoAtiva() {
        return this.permissao?.isAtiva() || false;
    }
    /**
     * Verifica se tanto o grupo quanto a permissão estão ativos
     * @returns true se ambos estão ativos
     */
    isAtivo() {
        return this.isGrupoAtivo() && this.isPermissaoAtiva();
    }
    /**
     * Formata a data de criação para exibição
     * @returns data formatada
     */
    getCriacaoFormatada() {
        return this.created_at.toLocaleString('pt-BR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
        });
    }
    /**
     * Remove informações sensíveis para logs
     * @returns objeto sanitizado
     */
    toSafeLog() {
        return {
            id: this.id,
            permissao_id: this.permissao_id,
            grupo_id: this.grupo_id,
            criado_por: this.criado_por,
            created_at: this.created_at,
            isAtivo: this.isAtivo(),
            criticalityLevel: this.getCriticalityLevel()
        };
    }
};
exports.PermissionGroupMapping = PermissionGroupMapping;
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)('uuid'),
    __metadata("design:type", String)
], PermissionGroupMapping.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'uuid', name: 'permissao_id' }),
    (0, class_validator_1.IsNotEmpty)({ message: 'ID da permissão é obrigatório' }),
    (0, class_validator_1.IsUUID)('4', { message: 'ID da permissão inválido' }),
    __metadata("design:type", String)
], PermissionGroupMapping.prototype, "permissao_id", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => permission_entity_1.Permission, { onDelete: 'CASCADE' }),
    (0, typeorm_1.JoinColumn)({ name: 'permissao_id' }),
    __metadata("design:type", typeof (_a = typeof permission_entity_1.Permission !== "undefined" && permission_entity_1.Permission) === "function" ? _a : Object)
], PermissionGroupMapping.prototype, "permissao", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'uuid', name: 'grupo_id' }),
    (0, class_validator_1.IsNotEmpty)({ message: 'ID do grupo é obrigatório' }),
    (0, class_validator_1.IsUUID)('4', { message: 'ID do grupo inválido' }),
    __metadata("design:type", String)
], PermissionGroupMapping.prototype, "grupo_id", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => permission_group_entity_1.PermissionGroup, { onDelete: 'CASCADE' }),
    (0, typeorm_1.JoinColumn)({ name: 'grupo_id' }),
    __metadata("design:type", typeof (_b = typeof permission_group_entity_1.PermissionGroup !== "undefined" && permission_group_entity_1.PermissionGroup) === "function" ? _b : Object)
], PermissionGroupMapping.prototype, "grupo", void 0);
__decorate([
    (0, typeorm_1.CreateDateColumn)({ name: 'created_at' }),
    __metadata("design:type", typeof (_c = typeof Date !== "undefined" && Date) === "function" ? _c : Object)
], PermissionGroupMapping.prototype, "created_at", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'uuid', nullable: true, name: 'criado_por' }),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsUUID)('4', { message: 'ID do criador inválido' }),
    __metadata("design:type", Object)
], PermissionGroupMapping.prototype, "criado_por", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => usuario_entity_1.Usuario, { nullable: true }),
    (0, typeorm_1.JoinColumn)({ name: 'criado_por' }),
    __metadata("design:type", Object)
], PermissionGroupMapping.prototype, "usuario_criador", void 0);
exports.PermissionGroupMapping = PermissionGroupMapping = __decorate([
    (0, typeorm_1.Entity)('mapeamento_grupo_permissao'),
    (0, typeorm_1.Index)(['permissao_id', 'grupo_id'], { unique: true }),
    (0, typeorm_1.Index)(['permissao_id']),
    (0, typeorm_1.Index)(['grupo_id']),
    (0, typeorm_1.Index)(['criado_por']),
    (0, typeorm_1.Index)(['created_at'])
], PermissionGroupMapping);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGVudGl0aWVzXFxwZXJtaXNzaW9uLWdyb3VwLW1hcHBpbmcuZW50aXR5LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSxxQ0FBaUg7QUFDakgscURBQWlFO0FBQ2pFLDJEQUFpRDtBQUNqRCx1RUFBNEQ7QUFDNUQscURBQTJDO0FBRTNDOzs7OztHQUtHO0FBT0ksSUFBTSxzQkFBc0IsR0FBNUIsTUFBTSxzQkFBc0I7SUFDakM7O09BRUc7SUFFSCxFQUFFLENBQVM7SUFFWDs7T0FFRztJQUlILFlBQVksQ0FBUztJQUVyQjs7T0FFRztJQUdILFNBQVMsQ0FBYTtJQUV0Qjs7T0FFRztJQUlILFFBQVEsQ0FBUztJQUVqQjs7T0FFRztJQUdILEtBQUssQ0FBa0I7SUFFdkI7O09BRUc7SUFFSCxVQUFVLENBQU87SUFFakI7O09BRUc7SUFJSCxVQUFVLENBQWdCO0lBRTFCOztPQUVHO0lBR0gsZUFBZSxDQUFpQjtJQUVoQyw4REFBOEQ7SUFDOUQsSUFBSSxZQUFZO1FBQ2QsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBQzNCLENBQUM7SUFFRCxJQUFJLFlBQVksQ0FBQyxLQUFhO1FBQzVCLElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDO0lBQzVCLENBQUM7SUFFRCxJQUFJLFVBQVU7UUFDWixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDeEIsQ0FBQztJQUVELElBQUksVUFBVSxDQUFDLEtBQWlCO1FBQzlCLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO0lBQ3pCLENBQUM7SUFFRCxJQUFJLE9BQU87UUFDVCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDdkIsQ0FBQztJQUVELElBQUksT0FBTyxDQUFDLEtBQWE7UUFDdkIsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDeEIsQ0FBQztJQUVELElBQUksS0FBSztR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QWYseUNBQWU7cURBQUM7QUFNdkI7SUFEQyxJQUFBLDBCQUFnQixFQUFDLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDO2tEQUM3QixJQUFJLG9CQUFKLElBQUk7MERBQUM7QUFRakI7SUFIQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDO0lBQzVELElBQUEsNEJBQVUsR0FBRTtJQUNaLElBQUEsd0JBQU0sRUFBQyxHQUFHLEVBQUUsRUFBRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsQ0FBQzs7MERBQ3pCO0FBTzFCO0lBRkMsSUFBQSxtQkFBUyxFQUFDLEdBQUcsRUFBRSxDQUFDLHdCQUFPLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUM7SUFDNUMsSUFBQSxvQkFBVSxFQUFDLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDOzsrREFDSDtpQ0F4RHJCLHNCQUFzQjtJQU5sQyxJQUFBLGdCQUFNLEVBQUMsNEJBQTRCLENBQUM7SUFDcEMsSUFBQSxlQUFLLEVBQUMsQ0FBQyxjQUFjLEVBQUUsVUFBVSxDQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7SUFDckQsSUFBQSxlQUFLLEVBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUN2QixJQUFBLGVBQUssRUFBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ25CLElBQUEsZUFBSyxFQUFDLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDckIsSUFBQSxlQUFLLEVBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQztHQUNULHNCQUFzQixDQTBXbEMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGVudGl0aWVzXFxwZXJtaXNzaW9uLWdyb3VwLW1hcHBpbmcuZW50aXR5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbHVtbiwgQ3JlYXRlRGF0ZUNvbHVtbiwgRW50aXR5LCBKb2luQ29sdW1uLCBNYW55VG9PbmUsIFByaW1hcnlHZW5lcmF0ZWRDb2x1bW4sIEluZGV4IH0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQgeyBJc05vdEVtcHR5LCBJc1VVSUQsIElzT3B0aW9uYWwgfSBmcm9tICdjbGFzcy12YWxpZGF0b3InO1xuaW1wb3J0IHsgUGVybWlzc2lvbiB9IGZyb20gJy4vcGVybWlzc2lvbi5lbnRpdHknO1xuaW1wb3J0IHsgUGVybWlzc2lvbkdyb3VwIH0gZnJvbSAnLi9wZXJtaXNzaW9uLWdyb3VwLmVudGl0eSc7XG5pbXBvcnQgeyBVc3VhcmlvIH0gZnJvbSAnLi91c3VhcmlvLmVudGl0eSc7XG5cbi8qKlxuICogRW50aWRhZGUgcXVlIHJlcHJlc2VudGEgbyByZWxhY2lvbmFtZW50byBtdWl0b3MtcGFyYS1tdWl0b3MgZW50cmUgcGVybWlzc8O1ZXMgZSBncnVwb3MuXG4gKiBcbiAqIEVzdGEgZW50aWRhZGUgcGVybWl0ZSBhc3NvY2lhciBwZXJtaXNzw7VlcyBhIGdydXBvcywgZmFjaWxpdGFuZG8gYSBvcmdhbml6YcOnw6NvXG4gKiBlIGF0cmlidWnDp8OjbyBkZSBwZXJtaXNzw7VlcyByZWxhY2lvbmFkYXMuXG4gKi9cbkBFbnRpdHkoJ21hcGVhbWVudG9fZ3J1cG9fcGVybWlzc2FvJylcbkBJbmRleChbJ3Blcm1pc3Nhb19pZCcsICdncnVwb19pZCddLCB7IHVuaXF1ZTogdHJ1ZSB9KVxuQEluZGV4KFsncGVybWlzc2FvX2lkJ10pXG5ASW5kZXgoWydncnVwb19pZCddKVxuQEluZGV4KFsnY3JpYWRvX3BvciddKVxuQEluZGV4KFsnY3JlYXRlZF9hdCddKVxuZXhwb3J0IGNsYXNzIFBlcm1pc3Npb25Hcm91cE1hcHBpbmcge1xuICAvKipcbiAgICogSWRlbnRpZmljYWRvciDDum5pY28gZG8gbWFwZWFtZW50b1xuICAgKi9cbiAgQFByaW1hcnlHZW5lcmF0ZWRDb2x1bW4oJ3V1aWQnKVxuICBpZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBSZWZlcsOqbmNpYSDDoCBwZXJtaXNzw6NvXG4gICAqL1xuICBAQ29sdW1uKHsgdHlwZTogJ3V1aWQnLCBuYW1lOiAncGVybWlzc2FvX2lkJyB9KVxuICBASXNOb3RFbXB0eSh7IG1lc3NhZ2U6ICdJRCBkYSBwZXJtaXNzw6NvIMOpIG9icmlnYXTDs3JpbycgfSlcbiAgQElzVVVJRCgnNCcsIHsgbWVzc2FnZTogJ0lEIGRhIHBlcm1pc3PDo28gaW52w6FsaWRvJyB9KVxuICBwZXJtaXNzYW9faWQ6IHN0cmluZztcblxuICAvKipcbiAgICogUmVsYcOnw6NvIGNvbSBhIHBlcm1pc3PDo29cbiAgICovXG4gIEBNYW55VG9PbmUoKCkgPT4gUGVybWlzc2lvbiwgeyBvbkRlbGV0ZTogJ0NBU0NBREUnIH0pXG4gIEBKb2luQ29sdW1uKHsgbmFtZTogJ3Blcm1pc3Nhb19pZCcgfSlcbiAgcGVybWlzc2FvOiBQZXJtaXNzaW9uO1xuXG4gIC8qKlxuICAgKiBSZWZlcsOqbmNpYSBhbyBncnVwb1xuICAgKi9cbiAgQENvbHVtbih7IHR5cGU6ICd1dWlkJywgbmFtZTogJ2dydXBvX2lkJyB9KVxuICBASXNOb3RFbXB0eSh7IG1lc3NhZ2U6ICdJRCBkbyBncnVwbyDDqSBvYnJpZ2F0w7NyaW8nIH0pXG4gIEBJc1VVSUQoJzQnLCB7IG1lc3NhZ2U6ICdJRCBkbyBncnVwbyBpbnbDoWxpZG8nIH0pXG4gIGdydXBvX2lkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFJlbGHDp8OjbyBjb20gbyBncnVwb1xuICAgKi9cbiAgQE1hbnlUb09uZSgoKSA9PiBQZXJtaXNzaW9uR3JvdXAsIHsgb25EZWxldGU6ICdDQVNDQURFJyB9KVxuICBASm9pbkNvbHVtbih7IG5hbWU6ICdncnVwb19pZCcgfSlcbiAgZ3J1cG86IFBlcm1pc3Npb25Hcm91cDtcblxuICAvKipcbiAgICogRGF0YSBkZSBjcmlhw6fDo29cbiAgICovXG4gIEBDcmVhdGVEYXRlQ29sdW1uKHsgbmFtZTogJ2NyZWF0ZWRfYXQnIH0pXG4gIGNyZWF0ZWRfYXQ6IERhdGU7XG5cbiAgLyoqXG4gICAqIFVzdcOhcmlvIHF1ZSBjcmlvdSBvIG1hcGVhbWVudG9cbiAgICovXG4gIEBDb2x1bW4oeyB0eXBlOiAndXVpZCcsIG51bGxhYmxlOiB0cnVlLCBuYW1lOiAnY3JpYWRvX3BvcicgfSlcbiAgQElzT3B0aW9uYWwoKVxuICBASXNVVUlEKCc0JywgeyBtZXNzYWdlOiAnSUQgZG8gY3JpYWRvciBpbnbDoWxpZG8nIH0pXG4gIGNyaWFkb19wb3I6IHN0cmluZyB8IG51bGw7XG5cbiAgLyoqXG4gICAqIFJlbGHDp8OjbyBjb20gbyB1c3XDoXJpbyBxdWUgY3Jpb3UgbyBtYXBlYW1lbnRvXG4gICAqL1xuICBATWFueVRvT25lKCgpID0+IFVzdWFyaW8sIHsgbnVsbGFibGU6IHRydWUgfSlcbiAgQEpvaW5Db2x1bW4oeyBuYW1lOiAnY3JpYWRvX3BvcicgfSlcbiAgdXN1YXJpb19jcmlhZG9yOiBVc3VhcmlvIHwgbnVsbDtcblxuICAvLyBHZXR0ZXJzIGUgc2V0dGVycyBwYXJhIGNvbXBhdGliaWxpZGFkZSBjb20gY8OzZGlnbyBleGlzdGVudGVcbiAgZ2V0IHBlcm1pc3Npb25JZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnBlcm1pc3Nhb19pZDtcbiAgfVxuXG4gIHNldCBwZXJtaXNzaW9uSWQodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMucGVybWlzc2FvX2lkID0gdmFsdWU7XG4gIH1cblxuICBnZXQgcGVybWlzc2lvbigpOiBQZXJtaXNzaW9uIHtcbiAgICByZXR1cm4gdGhpcy5wZXJtaXNzYW87XG4gIH1cblxuICBzZXQgcGVybWlzc2lvbih2YWx1ZTogUGVybWlzc2lvbikge1xuICAgIHRoaXMucGVybWlzc2FvID0gdmFsdWU7XG4gIH1cblxuICBnZXQgZ3JvdXBJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmdydXBvX2lkO1xuICB9XG5cbiAgc2V0IGdyb3VwSWQodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMuZ3J1cG9faWQgPSB2YWx1ZTtcbiAgfVxuXG4gIGdldCBncm91cCgpOiBQZXJtaXNzaW9uR3JvdXAge1xuICAgIHJldHVybiB0aGlzLmdydXBvO1xuICB9XG5cbiAgc2V0IGdyb3VwKHZhbHVlOiBQZXJtaXNzaW9uR3JvdXApIHtcbiAgICB0aGlzLmdydXBvID0gdmFsdWU7XG4gIH1cblxuICBnZXQgY3JlYXRlZEF0KCk6IERhdGUge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZWRfYXQ7XG4gIH1cblxuICBnZXQgY3JlYXRlZEJ5KCk6IHN0cmluZyB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLmNyaWFkb19wb3I7XG4gIH1cblxuICBzZXQgY3JlYXRlZEJ5KHZhbHVlOiBzdHJpbmcgfCBudWxsKSB7XG4gICAgdGhpcy5jcmlhZG9fcG9yID0gdmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBtYXBlYW1lbnRvIGZvaSBjcmlhZG8gcG9yIHVtIHVzdcOhcmlvIGVzcGVjw61maWNvXG4gICAqIEBwYXJhbSB1c3VhcmlvSWQgSUQgZG8gdXN1w6FyaW9cbiAgICogQHJldHVybnMgdHJ1ZSBzZSBmb2kgY3JpYWRvIHBlbG8gdXN1w6FyaW9cbiAgICovXG4gIGZvaUNyaWFkb1Bvcih1c3VhcmlvSWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNyaWFkb19wb3IgPT09IHVzdWFyaW9JZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gdW1hIGNoYXZlIMO6bmljYSBwYXJhIG8gbWFwZWFtZW50b1xuICAgKiBAcmV0dXJucyBjaGF2ZSDDum5pY2EgYmFzZWFkYSBlbSBwZXJtaXNzw6NvIGUgZ3J1cG9cbiAgICovXG4gIGdldFVuaXF1ZUtleSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBgJHt0aGlzLnBlcm1pc3Nhb19pZH06JHt0aGlzLmdydXBvX2lkfWA7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBtYXBlYW1lbnRvIMOpIHbDoWxpZG9cbiAgICogQHJldHVybnMgdHJ1ZSBzZSB0ZW0gcGVybWlzc8OjbyBlIGdydXBvIHbDoWxpZG9zXG4gICAqL1xuICBpc1ZhbGlkbygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISEodGhpcy5wZXJtaXNzYW9faWQgJiYgdGhpcy5ncnVwb19pZCk7XG4gIH1cblxuICAvKipcbiAgICogRGVmaW5lIG8gY3JpYWRvciBkbyBtYXBlYW1lbnRvXG4gICAqIEBwYXJhbSB1c3VhcmlvSWQgSUQgZG8gdXN1w6FyaW8gY3JpYWRvclxuICAgKi9cbiAgZGVmaW5pckNyaWFkb3IodXN1YXJpb0lkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNyaWFkb19wb3IgPSB1c3VhcmlvSWQ7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBtYXBlYW1lbnRvIHBlcnRlbmNlIGEgdW0gZ3J1cG8gZXNwZWPDrWZpY29cbiAgICogQHBhcmFtIGdydXBvSWQgSUQgZG8gZ3J1cG9cbiAgICogQHJldHVybnMgdHJ1ZSBzZSBwZXJ0ZW5jZSBhbyBncnVwb1xuICAgKi9cbiAgcGVydGVuY2VBb0dydXBvKGdydXBvSWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmdydXBvX2lkID09PSBncnVwb0lkO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIG8gbWFwZWFtZW50byBjb250w6ltIHVtYSBwZXJtaXNzw6NvIGVzcGVjw61maWNhXG4gICAqIEBwYXJhbSBwZXJtaXNzYW9JZCBJRCBkYSBwZXJtaXNzw6NvXG4gICAqIEByZXR1cm5zIHRydWUgc2UgY29udMOpbSBhIHBlcm1pc3PDo29cbiAgICovXG4gIGNvbnRlbVBlcm1pc3NhbyhwZXJtaXNzYW9JZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMucGVybWlzc2FvX2lkID09PSBwZXJtaXNzYW9JZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIG1hcGVhbWVudG8gZm9pIGNyaWFkbyByZWNlbnRlbWVudGUgKMO6bHRpbWFzIDI0IGhvcmFzKVxuICAgKiBAcmV0dXJucyB0cnVlIHNlIGZvaSBjcmlhZG8gcmVjZW50ZW1lbnRlXG4gICAqL1xuICBpc0NyaWFkb1JlY2VudGVtZW50ZSgpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMuY3JlYXRlZF9hdCkgcmV0dXJuIGZhbHNlO1xuICAgIFxuICAgIGNvbnN0IGFnb3JhID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCB1bURpYUF0cmFzID0gbmV3IERhdGUoYWdvcmEuZ2V0VGltZSgpIC0gMjQgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgXG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlZF9hdCA+IHVtRGlhQXRyYXM7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYSBhIGlkYWRlIGRvIG1hcGVhbWVudG8gZW0gZGlhc1xuICAgKiBAcmV0dXJucyBpZGFkZSBlbSBkaWFzXG4gICAqL1xuICBnZXRJZGFkZUVtRGlhcygpOiBudW1iZXIge1xuICAgIGlmICghdGhpcy5jcmVhdGVkX2F0KSByZXR1cm4gMDtcbiAgICBcbiAgICBjb25zdCBhZ29yYSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgZGlmZlRpbWUgPSBNYXRoLmFicyhhZ29yYS5nZXRUaW1lKCkgLSB0aGlzLmNyZWF0ZWRfYXQuZ2V0VGltZSgpKTtcbiAgICBjb25zdCBkaWZmRGF5cyA9IE1hdGguY2VpbChkaWZmVGltZSAvICgxMDAwICogNjAgKiA2MCAqIDI0KSk7XG4gICAgXG4gICAgcmV0dXJuIGRpZmZEYXlzO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIG8gbWFwZWFtZW50byB0ZW0gY3JpYWRvciBkZWZpbmlkb1xuICAgKiBAcmV0dXJucyB0cnVlIHNlIHRlbSBjcmlhZG9yXG4gICAqL1xuICB0ZW1DcmlhZG9yKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMuY3JpYWRvX3BvcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gaW5mb3JtYcOnw7VlcyByZXN1bWlkYXMgZG8gbWFwZWFtZW50b1xuICAgKiBAcmV0dXJucyBvYmpldG8gY29tIGluZm9ybWHDp8O1ZXMgcmVzdW1pZGFzXG4gICAqL1xuICBnZXRTdW1tYXJ5KCk6IHtcbiAgICBpZDogc3RyaW5nO1xuICAgIHBlcm1pc3Nhb19pZDogc3RyaW5nO1xuICAgIGdydXBvX2lkOiBzdHJpbmc7XG4gICAgY3JpYWRvX3Bvcjogc3RyaW5nIHwgbnVsbDtcbiAgICBjcmVhdGVkX2F0OiBEYXRlO1xuICAgIGlkYWRlRW1EaWFzOiBudW1iZXI7XG4gICAgcGVybWlzc2FvTm9tZT86IHN0cmluZztcbiAgICBncnVwb05vbWU/OiBzdHJpbmc7XG4gIH0ge1xuICAgIHJldHVybiB7XG4gICAgICBpZDogdGhpcy5pZCxcbiAgICAgIHBlcm1pc3Nhb19pZDogdGhpcy5wZXJtaXNzYW9faWQsXG4gICAgICBncnVwb19pZDogdGhpcy5ncnVwb19pZCxcbiAgICAgIGNyaWFkb19wb3I6IHRoaXMuY3JpYWRvX3BvcixcbiAgICAgIGNyZWF0ZWRfYXQ6IHRoaXMuY3JlYXRlZF9hdCxcbiAgICAgIGlkYWRlRW1EaWFzOiB0aGlzLmdldElkYWRlRW1EaWFzKCksXG4gICAgICBwZXJtaXNzYW9Ob21lOiB0aGlzLnBlcm1pc3Nhbz8ubm9tZSxcbiAgICAgIGdydXBvTm9tZTogdGhpcy5ncnVwbz8ubm9tZVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBtYXBlYW1lbnRvIMOpIGNvbXBhdMOtdmVsIGNvbSBvdXRybyBtYXBlYW1lbnRvXG4gICAqIEBwYXJhbSBvdGhlck1hcHBpbmcgT3V0cm8gbWFwZWFtZW50b1xuICAgKiBAcmV0dXJucyB0cnVlIHNlIHPDo28gY29tcGF0w612ZWlzIChtZXNtbyBncnVwbylcbiAgICovXG4gIGlzQ29tcGF0aWJsZVdpdGgob3RoZXJNYXBwaW5nOiBQZXJtaXNzaW9uR3JvdXBNYXBwaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZ3J1cG9faWQgPT09IG90aGVyTWFwcGluZy5ncnVwb19pZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXJhIHVtYSBjaGF2ZSDDum5pY2EgZXN0ZW5kaWRhIHBhcmEgbyBtYXBlYW1lbnRvXG4gICAqIEByZXR1cm5zIGNoYXZlIMO6bmljYSBlc3RlbmRpZGFcbiAgICovXG4gIGdldEV4dGVuZGVkVW5pcXVlS2V5KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBwZXJtaXNzaW9uX2dyb3VwX21hcHBpbmdfJHt0aGlzLnBlcm1pc3Nhb19pZH1fJHt0aGlzLmdydXBvX2lkfV8ke3RoaXMuaWR9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIG1hcGVhbWVudG8gZXN0w6EgZW0gZXN0YWRvIGNvbnNpc3RlbnRlXG4gICAqIEByZXR1cm5zIHRydWUgc2UgZXN0w6EgY29uc2lzdGVudGVcbiAgICovXG4gIGlzQ29uc2lzdGVudGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgICEhdGhpcy5pZCAmJlxuICAgICAgISF0aGlzLnBlcm1pc3Nhb19pZCAmJlxuICAgICAgISF0aGlzLmdydXBvX2lkICYmXG4gICAgICAhIXRoaXMuY3JlYXRlZF9hdFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogT2J0w6ltIHVtYSBkZXNjcmnDp8OjbyBsZWfDrXZlbCBkbyBtYXBlYW1lbnRvXG4gICAqIEByZXR1cm5zIGRlc2NyacOnw6NvIGZvcm1hdGFkYVxuICAgKi9cbiAgZ2V0RGVzY3JpY2FvKCk6IHN0cmluZyB7XG4gICAgY29uc3QgcGVybWlzc2FvTm9tZSA9IHRoaXMucGVybWlzc2FvPy5ub21lIHx8ICdQZXJtaXNzw6NvIG7Do28gY2FycmVnYWRhJztcbiAgICBjb25zdCBncnVwb05vbWUgPSB0aGlzLmdydXBvPy5ub21lIHx8ICdHcnVwbyBuw6NvIGNhcnJlZ2Fkbyc7XG4gICAgcmV0dXJuIGBHcnVwbyBcIiR7Z3J1cG9Ob21lfVwiIC0+IFBlcm1pc3PDo286ICR7cGVybWlzc2FvTm9tZX1gO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIG8gbWFwZWFtZW50byBwb2RlIHNlciByZW1vdmlkb1xuICAgKiBAcmV0dXJucyB0cnVlIHNlIHBvZGUgc2VyIHJlbW92aWRvXG4gICAqL1xuICBwb2RlU2VyUmVtb3ZpZG8oKTogYm9vbGVhbiB7XG4gICAgLy8gUG9yIHBhZHLDo28sIHRvZG9zIG9zIG1hcGVhbWVudG9zIHBvZGVtIHNlciByZW1vdmlkb3NcbiAgICAvLyBFc3RhIGzDs2dpY2EgcG9kZSBzZXIgZXhwYW5kaWRhIGNvbmZvcm1lIHJlZ3JhcyBkZSBuZWfDs2Npb1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIENsb25hIG8gbWFwZWFtZW50byAoc2VtIElEIGUgZGF0YSlcbiAgICogQHJldHVybnMgbWFwZWFtZW50byBjbG9uYWRvXG4gICAqL1xuICBjbG9uZSgpOiBQYXJ0aWFsPFBlcm1pc3Npb25Hcm91cE1hcHBpbmc+IHtcbiAgICByZXR1cm4ge1xuICAgICAgcGVybWlzc2FvX2lkOiB0aGlzLnBlcm1pc3Nhb19pZCxcbiAgICAgIGdydXBvX2lkOiB0aGlzLmdydXBvX2lkLFxuICAgICAgY3JpYWRvX3BvcjogdGhpcy5jcmlhZG9fcG9yXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIG1hcGVhbWVudG8gw6kgcGFyYSB1bWEgcGVybWlzc8OjbyBkZSBhZG1pbmlzdHJhZG9yXG4gICAqIEByZXR1cm5zIHRydWUgc2Ugw6kgcGVybWlzc8OjbyBkZSBhZG1pblxuICAgKi9cbiAgaXNBZG1pblBlcm1pc3Npb24oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMucGVybWlzc2FvPy5pc0FkbWluUGVybWlzc2lvbigpIHx8IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIG8gbWFwZWFtZW50byDDqSBwYXJhIHVtYSBwZXJtaXNzw6NvIGRlIHNpc3RlbWFcbiAgICogQHJldHVybnMgdHJ1ZSBzZSDDqSBwZXJtaXNzw6NvIGRlIHNpc3RlbWFcbiAgICovXG4gIGlzU3lzdGVtUGVybWlzc2lvbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5wZXJtaXNzYW8/LmlzU3lzdGVtUGVybWlzc2lvbigpIHx8IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIE9idMOpbSBvIG7DrXZlbCBkZSBjcml0aWNpZGFkZSBiYXNlYWRvIG5hIHBlcm1pc3PDo29cbiAgICogQHJldHVybnMgbsOtdmVsIGRlIGNyaXRpY2lkYWRlXG4gICAqL1xuICBnZXRDcml0aWNhbGl0eUxldmVsKCk6ICdMT1cnIHwgJ01FRElVTScgfCAnSElHSCcgfCAnQ1JJVElDQUwnIHtcbiAgICByZXR1cm4gdGhpcy5wZXJtaXNzYW8/LmdldENyaXRpY2FsaXR5TGV2ZWwoKSB8fCAnTE9XJztcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIGdydXBvIGVzdMOhIGF0aXZvXG4gICAqIEByZXR1cm5zIHRydWUgc2UgbyBncnVwbyBlc3TDoSBhdGl2b1xuICAgKi9cbiAgaXNHcnVwb0F0aXZvKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmdydXBvPy5pc0F0aXZvKCkgfHwgZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgYSBwZXJtaXNzw6NvIGVzdMOhIGF0aXZhXG4gICAqIEByZXR1cm5zIHRydWUgc2UgYSBwZXJtaXNzw6NvIGVzdMOhIGF0aXZhXG4gICAqL1xuICBpc1Blcm1pc3Nhb0F0aXZhKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnBlcm1pc3Nhbz8uaXNBdGl2YSgpIHx8IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIHRhbnRvIG8gZ3J1cG8gcXVhbnRvIGEgcGVybWlzc8OjbyBlc3TDo28gYXRpdm9zXG4gICAqIEByZXR1cm5zIHRydWUgc2UgYW1ib3MgZXN0w6NvIGF0aXZvc1xuICAgKi9cbiAgaXNBdGl2bygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc0dydXBvQXRpdm8oKSAmJiB0aGlzLmlzUGVybWlzc2FvQXRpdmEoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JtYXRhIGEgZGF0YSBkZSBjcmlhw6fDo28gcGFyYSBleGliacOnw6NvXG4gICAqIEByZXR1cm5zIGRhdGEgZm9ybWF0YWRhXG4gICAqL1xuICBnZXRDcmlhY2FvRm9ybWF0YWRhKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlZF9hdC50b0xvY2FsZVN0cmluZygncHQtQlInLCB7XG4gICAgICB5ZWFyOiAnbnVtZXJpYycsXG4gICAgICBtb250aDogJzItZGlnaXQnLFxuICAgICAgZGF5OiAnMi1kaWdpdCcsXG4gICAgICBob3VyOiAnMi1kaWdpdCcsXG4gICAgICBtaW51dGU6ICcyLWRpZ2l0J1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBpbmZvcm1hw6fDtWVzIHNlbnPDrXZlaXMgcGFyYSBsb2dzXG4gICAqIEByZXR1cm5zIG9iamV0byBzYW5pdGl6YWRvXG4gICAqL1xuICB0b1NhZmVMb2coKToge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgcGVybWlzc2FvX2lkOiBzdHJpbmc7XG4gICAgZ3J1cG9faWQ6IHN0cmluZztcbiAgICBjcmlhZG9fcG9yOiBzdHJpbmcgfCBudWxsO1xuICAgIGNyZWF0ZWRfYXQ6IERhdGU7XG4gICAgaXNBdGl2bzogYm9vbGVhbjtcbiAgICBjcml0aWNhbGl0eUxldmVsOiBzdHJpbmc7XG4gIH0ge1xuICAgIHJldHVybiB7XG4gICAgICBpZDogdGhpcy5pZCxcbiAgICAgIHBlcm1pc3Nhb19pZDogdGhpcy5wZXJtaXNzYW9faWQsXG4gICAgICBncnVwb19pZDogdGhpcy5ncnVwb19pZCxcbiAgICAgIGNyaWFkb19wb3I6IHRoaXMuY3JpYWRvX3BvcixcbiAgICAgIGNyZWF0ZWRfYXQ6IHRoaXMuY3JlYXRlZF9hdCxcbiAgICAgIGlzQXRpdm86IHRoaXMuaXNBdGl2bygpLFxuICAgICAgY3JpdGljYWxpdHlMZXZlbDogdGhpcy5nZXRDcml0aWNhbGl0eUxldmVsKClcbiAgICB9O1xuICB9XG59Il0sInZlcnNpb24iOjN9