7028068922108f92cc7362d85a08bd5e
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f;
Object.defineProperty(exports, "__esModule", { value: true });
exports.PapelCidadao = void 0;
const typeorm_1 = require("typeorm");
const cidadao_entity_1 = require("./cidadao.entity");
const composicao_familiar_entity_1 = require("./composicao-familiar.entity");
const tipo_papel_enum_1 = require("../enums/tipo-papel.enum");
/**
 * Entidade de Papel do Cidadão
 *
 * Estabelece uma relação N:M entre cidadãos e os papéis que podem assumir no sistema.
 * Um mesmo cidadão pode ter múltiplos papéis em diferentes contextos.
 */
let PapelCidadao = class PapelCidadao {
    id;
    cidadao_id;
    cidadao;
    composicao_familiar_id;
    composicao_familiar;
    tipo_papel;
    metadados;
    ativo;
    created_at;
    updated_at;
    removed_at;
    // Getters e Setters
    get cidadaoId() {
        return this.cidadao_id;
    }
    set cidadaoId(value) {
        this.cidadao_id = value;
    }
    get composicaoFamiliarId() {
        return this.composicao_familiar_id;
    }
    set composicaoFamiliarId(value) {
        this.composicao_familiar_id = value;
    }
    get tipoPapel() {
        return this.tipo_papel;
    }
    set tipoPapel(value) {
        this.tipo_papel = value;
    }
    get createdAt() {
        return this.created_at;
    }
    get updatedAt() {
        return this.updated_at;
    }
    get removedAt() {
        return this.removed_at;
    }
    // Métodos Utilitários
    /**
     * Verifica se o papel foi criado recentemente (últimas 24 horas)
     */
    isCriadoRecentemente() {
        const agora = new Date();
        const umDiaAtras = new Date(agora.getTime() - 24 * 60 * 60 * 1000);
        return this.created_at > umDiaAtras;
    }
    /**
     * Calcula a idade do papel em dias
     */
    getIdadeEmDias() {
        const agora = new Date();
        const diffTime = Math.abs(agora.getTime() - this.created_at.getTime());
        return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    }
    /**
     * Verifica se o papel está ativo
     */
    isAtivo() {
        return this.ativo && !this.removed_at;
    }
    /**
     * Verifica se o papel foi removido
     */
    foiRemovido() {
        return !!this.removed_at;
    }
    /**
     * Verifica se é um papel de beneficiário
     */
    isBeneficiario() {
        return this.tipo_papel === tipo_papel_enum_1.TipoPapel.BENEFICIARIO;
    }
    /**
     * Verifica se é um papel de representante legal
     */
    isRepresentanteLegal() {
        return this.tipo_papel === tipo_papel_enum_1.TipoPapel.REPRESENTANTE_LEGAL;
    }
    /**
     * Verifica se é um papel de dependente
     */
    isDependente() {
        return this.tipo_papel === tipo_papel_enum_1.TipoPapel.DEPENDENTE;
    }
    /**
     * Verifica se tem grau de parentesco definido
     */
    temGrauParentesco() {
        return !!this.metadados?.grau_parentesco;
    }
    /**
     * Obtém o grau de parentesco
     */
    getGrauParentesco() {
        return this.metadados?.grau_parentesco || null;
    }
    /**
     * Verifica se tem documento de representação
     */
    temDocumentoRepresentacao() {
        return !!this.metadados?.documento_representacao;
    }
    /**
     * Verifica se a representação está válida (não expirou)
     */
    isRepresentacaoValida() {
        if (!this.metadados?.data_validade_representacao) {
            return true; // Se não tem data de validade, considera válida
        }
        return new Date(this.metadados.data_validade_representacao) > new Date();
    }
    /**
     * Verifica se pertence a uma composição familiar específica
     */
    pertenceAComposicaoFamiliar(composicaoId) {
        return this.composicao_familiar_id === composicaoId;
    }
    /**
     * Verifica se pertence a um cidadão específico
     */
    pertenceAoCidadao(cidadaoId) {
        return this.cidadao_id === cidadaoId;
    }
    /**
     * Obtém um resumo do papel
     */
    getSummary() {
        const status = this.isAtivo() ? 'Ativo' : 'Inativo';
        const grau = this.temGrauParentesco()
            ? ` (${this.getGrauParentesco()})`
            : '';
        return `${this.tipo_papel}${grau} - ${status}`;
    }
    /**
     * Gera uma chave única para o papel
     */
    getUniqueKey() {
        return `${this.cidadao_id}_${this.tipo_papel}_${this.composicao_familiar_id || 'null'}`;
    }
    /**
     * Verifica se o papel é consistente
     */
    isConsistente() {
        // Verifica se tem cidadão
        if (!this.cidadao_id)
            return false;
        // Verifica se tem tipo de papel
        if (!this.tipo_papel)
            return false;
        // Se é representante legal, deve ter documento
        if (this.isRepresentanteLegal() && !this.temDocumentoRepresentacao()) {
            return false;
        }
        // Se tem data de validade, deve estar válida
        if (this.metadados?.data_validade_representacao &&
            !this.isRepresentacaoValida()) {
            return false;
        }
        return true;
    }
    /**
     * Verifica se pode ser removido
     */
    podeSerRemovido() {
        // Não pode remover se já foi removido
        if (this.foiRemovido())
            return false;
        // Responsável familiar só pode ser removido se houver outro responsável
        // Esta verificação seria feita no serviço
        return true;
    }
    /**
     * Clona o papel (sem ID)
     */
    clone() {
        return {
            cidadao_id: this.cidadao_id,
            composicao_familiar_id: this.composicao_familiar_id,
            tipo_papel: this.tipo_papel,
            metadados: this.metadados ? { ...this.metadados } : undefined,
            ativo: this.ativo,
        };
    }
    /**
     * Verifica se requer documentação especial
     */
    requerDocumentacaoEspecial() {
        return this.isRepresentanteLegal();
    }
    /**
     * Obtém a descrição do tipo de papel
     */
    getDescricaoTipoPapel() {
        const descricoes = {
            [tipo_papel_enum_1.TipoPapel.REQUERENTE]: 'Solicitante',
            [tipo_papel_enum_1.TipoPapel.BENEFICIARIO]: 'Beneficiário',
            [tipo_papel_enum_1.TipoPapel.REPRESENTANTE_LEGAL]: 'Representante Legal',
            [tipo_papel_enum_1.TipoPapel.DEPENDENTE]: 'Dependente',
        };
        return descricoes[this.tipo_papel] || this.tipo_papel;
    }
    /**
     * Formata a data de criação
     */
    getCriacaoFormatada() {
        return this.created_at.toLocaleDateString('pt-BR');
    }
    /**
     * Formata a data de atualização
     */
    getAtualizacaoFormatada() {
        return this.updated_at.toLocaleDateString('pt-BR');
    }
    /**
     * Remove informações sensíveis para logs
     */
    toSafeLog() {
        return {
            id: this.id,
            tipo_papel: this.tipo_papel,
            ativo: this.ativo,
            created_at: this.created_at,
            updated_at: this.updated_at,
        };
    }
    /**
     * Verifica se o papel expira em breve (próximos 30 dias)
     */
    expiraEmBreve() {
        if (!this.metadados?.data_validade_representacao) {
            return false;
        }
        const dataValidade = new Date(this.metadados.data_validade_representacao);
        const trintaDiasFrente = new Date();
        trintaDiasFrente.setDate(trintaDiasFrente.getDate() + 30);
        return dataValidade <= trintaDiasFrente;
    }
    /**
     * Obtém sugestões de verificação para o papel
     */
    getSugestoesVerificacao() {
        const sugestoes = [];
        if (this.isRepresentanteLegal() && !this.temDocumentoRepresentacao()) {
            sugestoes.push('Adicionar documento de representação legal');
        }
        if (this.expiraEmBreve()) {
            sugestoes.push('Renovar documento de representação (expira em breve)');
        }
        if (!this.temGrauParentesco() && this.isDependente()) {
            sugestoes.push('Definir grau de parentesco para dependente');
        }
        if (!this.isConsistente()) {
            sugestoes.push('Verificar consistência dos dados do papel');
        }
        return sugestoes;
    }
};
exports.PapelCidadao = PapelCidadao;
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)('uuid'),
    __metadata("design:type", String)
], PapelCidadao.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'cidadao_id', type: 'uuid' }),
    __metadata("design:type", String)
], PapelCidadao.prototype, "cidadao_id", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => cidadao_entity_1.Cidadao, { onDelete: 'CASCADE' }),
    (0, typeorm_1.JoinColumn)({ name: 'cidadao_id' }),
    __metadata("design:type", typeof (_a = typeof cidadao_entity_1.Cidadao !== "undefined" && cidadao_entity_1.Cidadao) === "function" ? _a : Object)
], PapelCidadao.prototype, "cidadao", void 0);
__decorate([
    (0, typeorm_1.Column)({ name: 'composicao_familiar_id', type: 'uuid', nullable: true }),
    __metadata("design:type", String)
], PapelCidadao.prototype, "composicao_familiar_id", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => composicao_familiar_entity_1.ComposicaoFamiliar, { onDelete: 'SET NULL' }),
    (0, typeorm_1.JoinColumn)({ name: 'composicao_familiar_id' }),
    __metadata("design:type", typeof (_b = typeof composicao_familiar_entity_1.ComposicaoFamiliar !== "undefined" && composicao_familiar_entity_1.ComposicaoFamiliar) === "function" ? _b : Object)
], PapelCidadao.prototype, "composicao_familiar", void 0);
__decorate([
    (0, typeorm_1.Column)({
        name: 'tipo_papel',
        type: 'enum',
        enum: tipo_papel_enum_1.TipoPapel,
        enumName: 'tipo_papel',
    }),
    __metadata("design:type", typeof (_c = typeof tipo_papel_enum_1.PaperType !== "undefined" && tipo_papel_enum_1.PaperType) === "function" ? _c : Object)
], PapelCidadao.prototype, "tipo_papel", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'jsonb', nullable: true }),
    __metadata("design:type", Object)
], PapelCidadao.prototype, "metadados", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'boolean', default: true }),
    __metadata("design:type", Boolean)
], PapelCidadao.prototype, "ativo", void 0);
__decorate([
    (0, typeorm_1.CreateDateColumn)({ name: 'created_at' }),
    __metadata("design:type", typeof (_d = typeof Date !== "undefined" && Date) === "function" ? _d : Object)
], PapelCidadao.prototype, "created_at", void 0);
__decorate([
    (0, typeorm_1.UpdateDateColumn)({ name: 'updated_at' }),
    __metadata("design:type", typeof (_e = typeof Date !== "undefined" && Date) === "function" ? _e : Object)
], PapelCidadao.prototype, "updated_at", void 0);
__decorate([
    (0, typeorm_1.DeleteDateColumn)({ name: 'removed_at' }),
    __metadata("design:type", typeof (_f = typeof Date !== "undefined" && Date) === "function" ? _f : Object)
], PapelCidadao.prototype, "removed_at", void 0);
exports.PapelCidadao = PapelCidadao = __decorate([
    (0, typeorm_1.Entity)('papel_cidadao'),
    (0, typeorm_1.Index)(['cidadao_id', 'tipo_papel'], { unique: true })
], PapelCidadao);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGVudGl0aWVzXFxwYXBlbC1jaWRhZGFvLmVudGl0eS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEscUNBVWlCO0FBQ2pCLHFEQUEyQztBQUMzQyw2RUFBa0U7QUFDbEUsOERBQWdFO0FBRWhFOzs7OztHQUtHO0FBR0ksSUFBTSxZQUFZLEdBQWxCLE1BQU0sWUFBWTtJQUV2QixFQUFFLENBQVM7SUFHWCxVQUFVLENBQVM7SUFJbkIsT0FBTyxDQUFVO0lBR2pCLHNCQUFzQixDQUFTO0lBSS9CLG1CQUFtQixDQUFxQjtJQVF4QyxVQUFVLENBQVk7SUFHdEIsU0FBUyxDQUtQO0lBR0YsS0FBSyxDQUFVO0lBR2YsVUFBVSxDQUFPO0lBR2pCLFVBQVUsQ0FBTztJQUdqQixVQUFVLENBQU87SUFFakIsb0JBQW9CO0lBQ3BCLElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN6QixDQUFDO0lBRUQsSUFBSSxTQUFTLENBQUMsS0FBYTtRQUN6QixJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztJQUMxQixDQUFDO0lBRUQsSUFBSSxvQkFBb0I7UUFDdEIsT0FBTyxJQUFJLENBQUMsc0JBQXNCLENBQUM7SUFDckMsQ0FBQztJQUVELElBQUksb0JBQW9CLENBQUMsS0FBYTtRQUNwQyxJQUFJLENBQUMsc0JBQXNCLEdBQUcsS0FBSyxDQUFDO0lBQ3RDLENBQUM7SUFFRCxJQUFJLFNBQVM7UUFDWCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDekIsQ0FBQztJQUVELElBQUksU0FBUyxDQUFDLEtBQWdCO1FBQzVCLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO0lBQzFCLENBQUM7SUFFRCxJQUFJLFNBQVM7UUFDWCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDekIsQ0FBQztJQUVELElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN6QixDQUFDO0lBRUQsSUFBSSxTQUFTO1FBQ1gsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxzQkFBc0I7SUFFdEI7O09BRUc7SUFDSCxvQkFBb0I7UUFDbEIsTUFBTSxLQUFLLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUN6QixNQUFNLFVBQVUsR0FBRyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDbkUsT0FBTyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztJQUN0QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxjQUFjO1FBQ1osTUFBTSxLQUFLLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUN6QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDdkUsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLElBQUksR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsT0FBTztRQUNMLE9BQU8sSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDeEMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsV0FBVztRQUNULE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDM0IsQ0FBQztJQUVEOztPQUVHO0lBQ0gsY0FBYztRQUNaLE9BQU8sSUFBSSxDQUFDLFVBQVUsS0FBSywyQkFBUyxDQUFDLFlBQVksQ0FBQztJQUNwRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxvQkFBb0I7UUFDbEIsT0FBTyxJQUFJLENBQUMsVUFBVSxLQUFLLDJCQUFTLENBQUMsbUJBQW1CLENBQUM7SUFDM0QsQ0FBQztJQUVEOztPQUVHO0lBQ0gsWUFBWTtRQUNWLE9BQU8sSUFBSSxDQUFDLFVBQVUsS0FBSywyQkFBUyxDQUFDLFVBQVUsQ0FBQztJQUNsRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxpQkFBaUI7UUFDZixPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLGVBQWUsQ0FBQztJQUMzQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxpQkFBaUI7UUFDZixPQUFPLElBQUksQ0FBQyxTQUFTLEVBQUUsZUFBZSxJQUFJLElBQUksQ0FBQztJQUNqRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCx5QkFBeUI7UUFDdkIsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSx1QkFBdUIsQ0FBQztJQUNuRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxxQkFBcUI7UUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsMkJBQTJCLEVBQUUsQ0FBQztZQUNqRCxPQUFPLElBQUksQ0FBQyxDQUFDLGdEQUFnRDtRQUMvRCxDQUFDO1FBQ0QsT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLDJCQUEyQixDQUFDLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUMzRSxDQUFDO0lBRUQ7O09BRUc7SUFDSCwyQkFBMkIsQ0FBQyxZQUFvQjtRQUM5QyxPQUFPLElBQUksQ0FBQyxzQkFBc0IsS0FBSyxZQUFZLENBQUM7SUFDdEQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsaUJBQWlCLENBQUMsU0FBaUI7UUFDakMsT0FBTyxJQUFJLENBQUMsVUFBVSxLQUFLLFNBQVMsQ0FBQztJQUN2QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxVQUFVO1FBQ1IsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUNwRCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsaUJBQWlCLEVBQUU7WUFDbkMsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLGlCQUFpQixFQUFFLEdBQUc7WUFDbEMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNQLE9BQU8sR0FBRyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksTUFBTSxNQUFNLEVBQUUsQ0FBQztJQUNqRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxZQUFZO1FBQ1YsT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsc0JBQXNCLElBQUksTUFBTSxFQUFFLENBQUM7SUFDMUYsQ0FBQztJQUVEOztPQUVHO0lBQ0gsYUFBYTtRQUNYLDBCQUEwQjtRQUMxQixJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVU7WUFBRSxPQUFPLEtBQUssQ0FBQztRQUVuQyxnQ0FBZ0M7UUFDaEMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVO1lBQUUsT0FBTyxLQUFLLENBQUM7UUFFbkMsK0NBQStDO1FBQy9DLElBQUksSUFBSSxDQUFDLG9CQUFvQixFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMseUJBQXlCLEVBQUUsRUFBRSxDQUFDO1lBQ3JFLE9BQU8sS0FBSyxDQUFDO1FBQ2YsQ0FBQztRQUVELDZDQUE2QztRQUM3QyxJQUNFLElBQUksQ0FBQyxTQUFTLEVBQUUsMkJBQTJCO1lBQzNDLENBQUMsSUFBSSxDQUFDLHFCQUFxQixFQUFFLEVBQzdCLENBQUM7WUFDRCxPQUFPLEtBQUssQ0FBQztRQUNmLENBQUM7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRDs7T0FFRztJQUNILGVBQWU7UUFDYixzQ0FBc0M7UUFDdEMsSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQUUsT0FBTyxLQUFLLENBQUM7UUFFckMsd0VBQXdFO1FBQ3hFLDBDQUEwQztRQUMxQyxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUs7UUFDSCxPQUFPO1lBQ0wsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO1lBQzNCLHNCQUFzQixFQUFFLElBQUksQ0FBQyxzQkFBc0I7WUFDbkQsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO1lBQzNCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTO1lBQzdELEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztTQUNsQixDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0gsMEJBQTBCO1FBQ3hCLE9BQU8sSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7SUFDckMsQ0FBQztJQUVEOztPQUVHO0lBQ0gscUJBQXFCO1FBQ25CLE1BQU0sVUFBVSxHQUFHO1lBQ2pCLENBQUMsMkJBQVMsQ0FBQyxVQUFVLENBQUMsRUFBRSxhQUFhO1lBQ3JDLENBQUMsMkJBQVMsQ0FBQyxZQUFZLENBQUMsRUFBRSxjQUFjO1lBQ3hDLENBQUMsMkJBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxFQUFFLHFCQUFxQjtZQUN0RCxDQUFDLDJCQUFTLENBQUMsVUFBVSxDQUFDLEVBQUUsWUFBWTtTQUNyQyxDQUFDO1FBQ0YsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDeEQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsbUJBQW1CO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCx1QkFBdUI7UUFDckIsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFFRDs7T0FFRztJQUNILFNBQVM7UUFDUCxPQUFPO1lBQ0wsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFO1lBQ1gsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO1lBQzNCLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztZQUNqQixVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVU7WUFDM0IsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO1NBQzVCLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDSCxhQUFhO1FBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsMkJBQTJCLEVBQUUsQ0FBQztZQUNqRCxPQUFPLEtBQUssQ0FBQztRQUNmLENBQUM7UUFFRCxNQUFNLFlBQVksR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLDJCQUEyQixDQUFDLENBQUM7UUFDMUUsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3BDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUUxRCxPQUFPLFlBQVksSUFBSSxnQkFBZ0IsQ0FBQztJQUMxQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCx1QkFBdUI7UUFDckIsTUFBTSxTQUFTLEdBQWEsRUFBRSxDQUFDO1FBRS9CLElBQUksSUFBSSxDQUFDLG9CQUFvQixFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMseUJBQXlCLEVBQUUsRUFBRSxDQUFDO1lBQ3JFLFNBQVMsQ0FBQyxJQUFJLENBQUMsNENBQTRDLENBQUMsQ0FBQztRQUMvRCxDQUFDO1FBRUQsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFLEVBQUUsQ0FBQztZQUN6QixTQUFTLENBQUMsSUFBSSxDQUFDLHNEQUFzRCxDQUFDLENBQUM7UUFDekUsQ0FBQztRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFLEVBQUUsQ0FBQztZQUNyRCxTQUFTLENBQUMsSUFBSSxDQUFDLDRDQUE0QyxDQUFDLENBQUM7UUFDL0QsQ0FBQztRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLEVBQUUsQ0FBQztZQUMxQixTQUFTLENBQUMsSUFBSSxDQUFDLDJDQUEyQyxDQUFDLENBQUM7UUFDOUQsQ0FBQztRQUVELE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7Q0FDRixDQUFBO0FBbFZZLG9DQUFZO0FBRXZCO0lBREMsSUFBQSxnQ0FBc0IsRUFBQyxNQUFNLENBQUM7O3dDQUNwQjtBQUdYO0lBREMsSUFBQSxnQkFBTSxFQUFDLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLENBQUM7O2dEQUMxQjtBQUluQjtJQUZDLElBQUEsbUJBQVMsRUFBQyxHQUFHLEVBQUUsQ0FBQyx3QkFBTyxFQUFFLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxDQUFDO0lBQ2pELElBQUEsb0JBQVUsRUFBQyxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsQ0FBQztrREFDMUIsd0JBQU8sb0JBQVAsd0JBQU87NkNBQUM7QUFHakI7SUFEQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsd0JBQXdCLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUM7OzREQUMxQztBQUkvQjtJQUZDLElBQUEsbUJBQVMsRUFBQyxHQUFHLEVBQUUsQ0FBQywrQ0FBa0IsRUFBRSxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUUsQ0FBQztJQUM3RCxJQUFBLG9CQUFVLEVBQUMsRUFBRSxJQUFJLEVBQUUsd0JBQXdCLEVBQUUsQ0FBQztrREFDMUIsK0NBQWtCLG9CQUFsQiwrQ0FBa0I7eURBQUM7QUFReEM7SUFOQyxJQUFBLGdCQUFNLEVBQUM7UUFDTixJQUFJLEVBQUUsWUFBWTtRQUNsQixJQUFJLEVBQUUsTUFBTTtRQUNaLElBQUksRUFBRSwyQkFBUztRQUNmLFFBQVEsRUFBRSxZQUFZO0tBQ3ZCLENBQUM7a0RBQ1UsMkJBQVMsb0JBQVQsMkJBQVM7Z0RBQUM7QUFHdEI7SUFEQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQzs7K0NBTXhDO0FBR0Y7SUFEQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQzs7MkNBQzVCO0FBR2Y7SUFEQyxJQUFBLDBCQUFnQixFQUFDLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDO2tEQUM3QixJQUFJLG9CQUFKLElBQUk7Z0RBQUM7QUFHakI7SUFEQyxJQUFBLDBCQUFnQixFQUFDLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDO2tEQUM3QixJQUFJLG9CQUFKLElBQUk7Z0RBQUM7QUFHakI7SUFEQyxJQUFBLDBCQUFnQixFQUFDLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDO2tEQUM3QixJQUFJLG9CQUFKLElBQUk7Z0RBQUM7dUJBNUNOLFlBQVk7SUFGeEIsSUFBQSxnQkFBTSxFQUFDLGVBQWUsQ0FBQztJQUN2QixJQUFBLGVBQUssRUFBQyxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQztHQUN6QyxZQUFZLENBa1Z4QiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcZW50aXRpZXNcXHBhcGVsLWNpZGFkYW8uZW50aXR5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEVudGl0eSxcbiAgUHJpbWFyeUdlbmVyYXRlZENvbHVtbixcbiAgQ29sdW1uLFxuICBDcmVhdGVEYXRlQ29sdW1uLFxuICBVcGRhdGVEYXRlQ29sdW1uLFxuICBEZWxldGVEYXRlQ29sdW1uLFxuICBNYW55VG9PbmUsXG4gIEpvaW5Db2x1bW4sXG4gIEluZGV4LFxufSBmcm9tICd0eXBlb3JtJztcbmltcG9ydCB7IENpZGFkYW8gfSBmcm9tICcuL2NpZGFkYW8uZW50aXR5JztcbmltcG9ydCB7IENvbXBvc2ljYW9GYW1pbGlhciB9IGZyb20gJy4vY29tcG9zaWNhby1mYW1pbGlhci5lbnRpdHknO1xuaW1wb3J0IHsgVGlwb1BhcGVsLCBQYXBlclR5cGUgfSBmcm9tICcuLi9lbnVtcy90aXBvLXBhcGVsLmVudW0nO1xuXG4vKipcbiAqIEVudGlkYWRlIGRlIFBhcGVsIGRvIENpZGFkw6NvXG4gKlxuICogRXN0YWJlbGVjZSB1bWEgcmVsYcOnw6NvIE46TSBlbnRyZSBjaWRhZMOjb3MgZSBvcyBwYXDDqWlzIHF1ZSBwb2RlbSBhc3N1bWlyIG5vIHNpc3RlbWEuXG4gKiBVbSBtZXNtbyBjaWRhZMOjbyBwb2RlIHRlciBtw7psdGlwbG9zIHBhcMOpaXMgZW0gZGlmZXJlbnRlcyBjb250ZXh0b3MuXG4gKi9cbkBFbnRpdHkoJ3BhcGVsX2NpZGFkYW8nKVxuQEluZGV4KFsnY2lkYWRhb19pZCcsICd0aXBvX3BhcGVsJ10sIHsgdW5pcXVlOiB0cnVlIH0pXG5leHBvcnQgY2xhc3MgUGFwZWxDaWRhZGFvIHtcbiAgQFByaW1hcnlHZW5lcmF0ZWRDb2x1bW4oJ3V1aWQnKVxuICBpZDogc3RyaW5nO1xuXG4gIEBDb2x1bW4oeyBuYW1lOiAnY2lkYWRhb19pZCcsIHR5cGU6ICd1dWlkJyB9KVxuICBjaWRhZGFvX2lkOiBzdHJpbmc7XG5cbiAgQE1hbnlUb09uZSgoKSA9PiBDaWRhZGFvLCB7IG9uRGVsZXRlOiAnQ0FTQ0FERScgfSlcbiAgQEpvaW5Db2x1bW4oeyBuYW1lOiAnY2lkYWRhb19pZCcgfSlcbiAgY2lkYWRhbzogQ2lkYWRhbztcblxuICBAQ29sdW1uKHsgbmFtZTogJ2NvbXBvc2ljYW9fZmFtaWxpYXJfaWQnLCB0eXBlOiAndXVpZCcsIG51bGxhYmxlOiB0cnVlIH0pXG4gIGNvbXBvc2ljYW9fZmFtaWxpYXJfaWQ6IHN0cmluZztcblxuICBATWFueVRvT25lKCgpID0+IENvbXBvc2ljYW9GYW1pbGlhciwgeyBvbkRlbGV0ZTogJ1NFVCBOVUxMJyB9KVxuICBASm9pbkNvbHVtbih7IG5hbWU6ICdjb21wb3NpY2FvX2ZhbWlsaWFyX2lkJyB9KVxuICBjb21wb3NpY2FvX2ZhbWlsaWFyOiBDb21wb3NpY2FvRmFtaWxpYXI7XG5cbiAgQENvbHVtbih7XG4gICAgbmFtZTogJ3RpcG9fcGFwZWwnLFxuICAgIHR5cGU6ICdlbnVtJyxcbiAgICBlbnVtOiBUaXBvUGFwZWwsXG4gICAgZW51bU5hbWU6ICd0aXBvX3BhcGVsJyxcbiAgfSlcbiAgdGlwb19wYXBlbDogUGFwZXJUeXBlO1xuXG4gIEBDb2x1bW4oeyB0eXBlOiAnanNvbmInLCBudWxsYWJsZTogdHJ1ZSB9KVxuICBtZXRhZGFkb3M6IHtcbiAgICBncmF1X3BhcmVudGVzY28/OiBzdHJpbmc7XG4gICAgZG9jdW1lbnRvX3JlcHJlc2VudGFjYW8/OiBzdHJpbmc7XG4gICAgZGF0YV92YWxpZGFkZV9yZXByZXNlbnRhY2FvPzogRGF0ZTtcbiAgICBba2V5OiBzdHJpbmddOiBhbnk7XG4gIH07XG5cbiAgQENvbHVtbih7IHR5cGU6ICdib29sZWFuJywgZGVmYXVsdDogdHJ1ZSB9KVxuICBhdGl2bzogYm9vbGVhbjtcblxuICBAQ3JlYXRlRGF0ZUNvbHVtbih7IG5hbWU6ICdjcmVhdGVkX2F0JyB9KVxuICBjcmVhdGVkX2F0OiBEYXRlO1xuXG4gIEBVcGRhdGVEYXRlQ29sdW1uKHsgbmFtZTogJ3VwZGF0ZWRfYXQnIH0pXG4gIHVwZGF0ZWRfYXQ6IERhdGU7XG5cbiAgQERlbGV0ZURhdGVDb2x1bW4oeyBuYW1lOiAncmVtb3ZlZF9hdCcgfSlcbiAgcmVtb3ZlZF9hdDogRGF0ZTtcblxuICAvLyBHZXR0ZXJzIGUgU2V0dGVyc1xuICBnZXQgY2lkYWRhb0lkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY2lkYWRhb19pZDtcbiAgfVxuXG4gIHNldCBjaWRhZGFvSWQodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMuY2lkYWRhb19pZCA9IHZhbHVlO1xuICB9XG5cbiAgZ2V0IGNvbXBvc2ljYW9GYW1pbGlhcklkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY29tcG9zaWNhb19mYW1pbGlhcl9pZDtcbiAgfVxuXG4gIHNldCBjb21wb3NpY2FvRmFtaWxpYXJJZCh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5jb21wb3NpY2FvX2ZhbWlsaWFyX2lkID0gdmFsdWU7XG4gIH1cblxuICBnZXQgdGlwb1BhcGVsKCk6IFBhcGVyVHlwZSB7XG4gICAgcmV0dXJuIHRoaXMudGlwb19wYXBlbDtcbiAgfVxuXG4gIHNldCB0aXBvUGFwZWwodmFsdWU6IFBhcGVyVHlwZSkge1xuICAgIHRoaXMudGlwb19wYXBlbCA9IHZhbHVlO1xuICB9XG5cbiAgZ2V0IGNyZWF0ZWRBdCgpOiBEYXRlIHtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGVkX2F0O1xuICB9XG5cbiAgZ2V0IHVwZGF0ZWRBdCgpOiBEYXRlIHtcbiAgICByZXR1cm4gdGhpcy51cGRhdGVkX2F0O1xuICB9XG5cbiAgZ2V0IHJlbW92ZWRBdCgpOiBEYXRlIHtcbiAgICByZXR1cm4gdGhpcy5yZW1vdmVkX2F0O1xuICB9XG5cbiAgLy8gTcOpdG9kb3MgVXRpbGl0w6FyaW9zXG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIG8gcGFwZWwgZm9pIGNyaWFkbyByZWNlbnRlbWVudGUgKMO6bHRpbWFzIDI0IGhvcmFzKVxuICAgKi9cbiAgaXNDcmlhZG9SZWNlbnRlbWVudGUoKTogYm9vbGVhbiB7XG4gICAgY29uc3QgYWdvcmEgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHVtRGlhQXRyYXMgPSBuZXcgRGF0ZShhZ29yYS5nZXRUaW1lKCkgLSAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGVkX2F0ID4gdW1EaWFBdHJhcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhIGEgaWRhZGUgZG8gcGFwZWwgZW0gZGlhc1xuICAgKi9cbiAgZ2V0SWRhZGVFbURpYXMoKTogbnVtYmVyIHtcbiAgICBjb25zdCBhZ29yYSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgZGlmZlRpbWUgPSBNYXRoLmFicyhhZ29yYS5nZXRUaW1lKCkgLSB0aGlzLmNyZWF0ZWRfYXQuZ2V0VGltZSgpKTtcbiAgICByZXR1cm4gTWF0aC5jZWlsKGRpZmZUaW1lIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIHBhcGVsIGVzdMOhIGF0aXZvXG4gICAqL1xuICBpc0F0aXZvKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmF0aXZvICYmICF0aGlzLnJlbW92ZWRfYXQ7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBwYXBlbCBmb2kgcmVtb3ZpZG9cbiAgICovXG4gIGZvaVJlbW92aWRvKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMucmVtb3ZlZF9hdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSDDqSB1bSBwYXBlbCBkZSBiZW5lZmljacOhcmlvXG4gICAqL1xuICBpc0JlbmVmaWNpYXJpbygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy50aXBvX3BhcGVsID09PSBUaXBvUGFwZWwuQkVORUZJQ0lBUklPO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIMOpIHVtIHBhcGVsIGRlIHJlcHJlc2VudGFudGUgbGVnYWxcbiAgICovXG4gIGlzUmVwcmVzZW50YW50ZUxlZ2FsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnRpcG9fcGFwZWwgPT09IFRpcG9QYXBlbC5SRVBSRVNFTlRBTlRFX0xFR0FMO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIMOpIHVtIHBhcGVsIGRlIGRlcGVuZGVudGVcbiAgICovXG4gIGlzRGVwZW5kZW50ZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy50aXBvX3BhcGVsID09PSBUaXBvUGFwZWwuREVQRU5ERU5URTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSB0ZW0gZ3JhdSBkZSBwYXJlbnRlc2NvIGRlZmluaWRvXG4gICAqL1xuICB0ZW1HcmF1UGFyZW50ZXNjbygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISF0aGlzLm1ldGFkYWRvcz8uZ3JhdV9wYXJlbnRlc2NvO1xuICB9XG5cbiAgLyoqXG4gICAqIE9idMOpbSBvIGdyYXUgZGUgcGFyZW50ZXNjb1xuICAgKi9cbiAgZ2V0R3JhdVBhcmVudGVzY28oKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMubWV0YWRhZG9zPy5ncmF1X3BhcmVudGVzY28gfHwgbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSB0ZW0gZG9jdW1lbnRvIGRlIHJlcHJlc2VudGHDp8Ojb1xuICAgKi9cbiAgdGVtRG9jdW1lbnRvUmVwcmVzZW50YWNhbygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISF0aGlzLm1ldGFkYWRvcz8uZG9jdW1lbnRvX3JlcHJlc2VudGFjYW87XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgYSByZXByZXNlbnRhw6fDo28gZXN0w6EgdsOhbGlkYSAobsOjbyBleHBpcm91KVxuICAgKi9cbiAgaXNSZXByZXNlbnRhY2FvVmFsaWRhKCk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5tZXRhZGFkb3M/LmRhdGFfdmFsaWRhZGVfcmVwcmVzZW50YWNhbykge1xuICAgICAgcmV0dXJuIHRydWU7IC8vIFNlIG7Do28gdGVtIGRhdGEgZGUgdmFsaWRhZGUsIGNvbnNpZGVyYSB2w6FsaWRhXG4gICAgfVxuICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLm1ldGFkYWRvcy5kYXRhX3ZhbGlkYWRlX3JlcHJlc2VudGFjYW8pID4gbmV3IERhdGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBwZXJ0ZW5jZSBhIHVtYSBjb21wb3Npw6fDo28gZmFtaWxpYXIgZXNwZWPDrWZpY2FcbiAgICovXG4gIHBlcnRlbmNlQUNvbXBvc2ljYW9GYW1pbGlhcihjb21wb3NpY2FvSWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNvbXBvc2ljYW9fZmFtaWxpYXJfaWQgPT09IGNvbXBvc2ljYW9JZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBwZXJ0ZW5jZSBhIHVtIGNpZGFkw6NvIGVzcGVjw61maWNvXG4gICAqL1xuICBwZXJ0ZW5jZUFvQ2lkYWRhbyhjaWRhZGFvSWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNpZGFkYW9faWQgPT09IGNpZGFkYW9JZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gdW0gcmVzdW1vIGRvIHBhcGVsXG4gICAqL1xuICBnZXRTdW1tYXJ5KCk6IHN0cmluZyB7XG4gICAgY29uc3Qgc3RhdHVzID0gdGhpcy5pc0F0aXZvKCkgPyAnQXRpdm8nIDogJ0luYXRpdm8nO1xuICAgIGNvbnN0IGdyYXUgPSB0aGlzLnRlbUdyYXVQYXJlbnRlc2NvKClcbiAgICAgID8gYCAoJHt0aGlzLmdldEdyYXVQYXJlbnRlc2NvKCl9KWBcbiAgICAgIDogJyc7XG4gICAgcmV0dXJuIGAke3RoaXMudGlwb19wYXBlbH0ke2dyYXV9IC0gJHtzdGF0dXN9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXJhIHVtYSBjaGF2ZSDDum5pY2EgcGFyYSBvIHBhcGVsXG4gICAqL1xuICBnZXRVbmlxdWVLZXkoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYCR7dGhpcy5jaWRhZGFvX2lkfV8ke3RoaXMudGlwb19wYXBlbH1fJHt0aGlzLmNvbXBvc2ljYW9fZmFtaWxpYXJfaWQgfHwgJ251bGwnfWA7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBwYXBlbCDDqSBjb25zaXN0ZW50ZVxuICAgKi9cbiAgaXNDb25zaXN0ZW50ZSgpOiBib29sZWFuIHtcbiAgICAvLyBWZXJpZmljYSBzZSB0ZW0gY2lkYWTDo29cbiAgICBpZiAoIXRoaXMuY2lkYWRhb19pZCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgLy8gVmVyaWZpY2Egc2UgdGVtIHRpcG8gZGUgcGFwZWxcbiAgICBpZiAoIXRoaXMudGlwb19wYXBlbCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgLy8gU2Ugw6kgcmVwcmVzZW50YW50ZSBsZWdhbCwgZGV2ZSB0ZXIgZG9jdW1lbnRvXG4gICAgaWYgKHRoaXMuaXNSZXByZXNlbnRhbnRlTGVnYWwoKSAmJiAhdGhpcy50ZW1Eb2N1bWVudG9SZXByZXNlbnRhY2FvKCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBTZSB0ZW0gZGF0YSBkZSB2YWxpZGFkZSwgZGV2ZSBlc3RhciB2w6FsaWRhXG4gICAgaWYgKFxuICAgICAgdGhpcy5tZXRhZGFkb3M/LmRhdGFfdmFsaWRhZGVfcmVwcmVzZW50YWNhbyAmJlxuICAgICAgIXRoaXMuaXNSZXByZXNlbnRhY2FvVmFsaWRhKClcbiAgICApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBwb2RlIHNlciByZW1vdmlkb1xuICAgKi9cbiAgcG9kZVNlclJlbW92aWRvKCk6IGJvb2xlYW4ge1xuICAgIC8vIE7Do28gcG9kZSByZW1vdmVyIHNlIGrDoSBmb2kgcmVtb3ZpZG9cbiAgICBpZiAodGhpcy5mb2lSZW1vdmlkbygpKSByZXR1cm4gZmFsc2U7XG5cbiAgICAvLyBSZXNwb25zw6F2ZWwgZmFtaWxpYXIgc8OzIHBvZGUgc2VyIHJlbW92aWRvIHNlIGhvdXZlciBvdXRybyByZXNwb25zw6F2ZWxcbiAgICAvLyBFc3RhIHZlcmlmaWNhw6fDo28gc2VyaWEgZmVpdGEgbm8gc2VydmnDp29cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbG9uYSBvIHBhcGVsIChzZW0gSUQpXG4gICAqL1xuICBjbG9uZSgpOiBQYXJ0aWFsPFBhcGVsQ2lkYWRhbz4ge1xuICAgIHJldHVybiB7XG4gICAgICBjaWRhZGFvX2lkOiB0aGlzLmNpZGFkYW9faWQsXG4gICAgICBjb21wb3NpY2FvX2ZhbWlsaWFyX2lkOiB0aGlzLmNvbXBvc2ljYW9fZmFtaWxpYXJfaWQsXG4gICAgICB0aXBvX3BhcGVsOiB0aGlzLnRpcG9fcGFwZWwsXG4gICAgICBtZXRhZGFkb3M6IHRoaXMubWV0YWRhZG9zID8geyAuLi50aGlzLm1ldGFkYWRvcyB9IDogdW5kZWZpbmVkLFxuICAgICAgYXRpdm86IHRoaXMuYXRpdm8sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSByZXF1ZXIgZG9jdW1lbnRhw6fDo28gZXNwZWNpYWxcbiAgICovXG4gIHJlcXVlckRvY3VtZW50YWNhb0VzcGVjaWFsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzUmVwcmVzZW50YW50ZUxlZ2FsKCk7XG4gIH1cblxuICAvKipcbiAgICogT2J0w6ltIGEgZGVzY3Jpw6fDo28gZG8gdGlwbyBkZSBwYXBlbFxuICAgKi9cbiAgZ2V0RGVzY3JpY2FvVGlwb1BhcGVsKCk6IHN0cmluZyB7XG4gICAgY29uc3QgZGVzY3JpY29lcyA9IHtcbiAgICAgIFtUaXBvUGFwZWwuUkVRVUVSRU5URV06ICdTb2xpY2l0YW50ZScsXG4gICAgICBbVGlwb1BhcGVsLkJFTkVGSUNJQVJJT106ICdCZW5lZmljacOhcmlvJyxcbiAgICAgIFtUaXBvUGFwZWwuUkVQUkVTRU5UQU5URV9MRUdBTF06ICdSZXByZXNlbnRhbnRlIExlZ2FsJyxcbiAgICAgIFtUaXBvUGFwZWwuREVQRU5ERU5URV06ICdEZXBlbmRlbnRlJyxcbiAgICB9O1xuICAgIHJldHVybiBkZXNjcmljb2VzW3RoaXMudGlwb19wYXBlbF0gfHwgdGhpcy50aXBvX3BhcGVsO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdGEgYSBkYXRhIGRlIGNyaWHDp8Ojb1xuICAgKi9cbiAgZ2V0Q3JpYWNhb0Zvcm1hdGFkYSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZWRfYXQudG9Mb2NhbGVEYXRlU3RyaW5nKCdwdC1CUicpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdGEgYSBkYXRhIGRlIGF0dWFsaXphw6fDo29cbiAgICovXG4gIGdldEF0dWFsaXphY2FvRm9ybWF0YWRhKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMudXBkYXRlZF9hdC50b0xvY2FsZURhdGVTdHJpbmcoJ3B0LUJSJyk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGluZm9ybWHDp8O1ZXMgc2Vuc8OtdmVpcyBwYXJhIGxvZ3NcbiAgICovXG4gIHRvU2FmZUxvZygpOiBQYXJ0aWFsPFBhcGVsQ2lkYWRhbz4ge1xuICAgIHJldHVybiB7XG4gICAgICBpZDogdGhpcy5pZCxcbiAgICAgIHRpcG9fcGFwZWw6IHRoaXMudGlwb19wYXBlbCxcbiAgICAgIGF0aXZvOiB0aGlzLmF0aXZvLFxuICAgICAgY3JlYXRlZF9hdDogdGhpcy5jcmVhdGVkX2F0LFxuICAgICAgdXBkYXRlZF9hdDogdGhpcy51cGRhdGVkX2F0LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBwYXBlbCBleHBpcmEgZW0gYnJldmUgKHByw7N4aW1vcyAzMCBkaWFzKVxuICAgKi9cbiAgZXhwaXJhRW1CcmV2ZSgpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMubWV0YWRhZG9zPy5kYXRhX3ZhbGlkYWRlX3JlcHJlc2VudGFjYW8pIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBkYXRhVmFsaWRhZGUgPSBuZXcgRGF0ZSh0aGlzLm1ldGFkYWRvcy5kYXRhX3ZhbGlkYWRlX3JlcHJlc2VudGFjYW8pO1xuICAgIGNvbnN0IHRyaW50YURpYXNGcmVudGUgPSBuZXcgRGF0ZSgpO1xuICAgIHRyaW50YURpYXNGcmVudGUuc2V0RGF0ZSh0cmludGFEaWFzRnJlbnRlLmdldERhdGUoKSArIDMwKTtcblxuICAgIHJldHVybiBkYXRhVmFsaWRhZGUgPD0gdHJpbnRhRGlhc0ZyZW50ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gc3VnZXN0w7VlcyBkZSB2ZXJpZmljYcOnw6NvIHBhcmEgbyBwYXBlbFxuICAgKi9cbiAgZ2V0U3VnZXN0b2VzVmVyaWZpY2FjYW8oKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHN1Z2VzdG9lczogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmICh0aGlzLmlzUmVwcmVzZW50YW50ZUxlZ2FsKCkgJiYgIXRoaXMudGVtRG9jdW1lbnRvUmVwcmVzZW50YWNhbygpKSB7XG4gICAgICBzdWdlc3RvZXMucHVzaCgnQWRpY2lvbmFyIGRvY3VtZW50byBkZSByZXByZXNlbnRhw6fDo28gbGVnYWwnKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5leHBpcmFFbUJyZXZlKCkpIHtcbiAgICAgIHN1Z2VzdG9lcy5wdXNoKCdSZW5vdmFyIGRvY3VtZW50byBkZSByZXByZXNlbnRhw6fDo28gKGV4cGlyYSBlbSBicmV2ZSknKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMudGVtR3JhdVBhcmVudGVzY28oKSAmJiB0aGlzLmlzRGVwZW5kZW50ZSgpKSB7XG4gICAgICBzdWdlc3RvZXMucHVzaCgnRGVmaW5pciBncmF1IGRlIHBhcmVudGVzY28gcGFyYSBkZXBlbmRlbnRlJyk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmlzQ29uc2lzdGVudGUoKSkge1xuICAgICAgc3VnZXN0b2VzLnB1c2goJ1ZlcmlmaWNhciBjb25zaXN0w6puY2lhIGRvcyBkYWRvcyBkbyBwYXBlbCcpO1xuICAgIH1cblxuICAgIHJldHVybiBzdWdlc3RvZXM7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==