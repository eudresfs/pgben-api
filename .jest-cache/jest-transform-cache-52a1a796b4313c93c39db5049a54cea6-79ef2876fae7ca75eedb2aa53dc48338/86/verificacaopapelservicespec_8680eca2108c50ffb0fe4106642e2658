1164a8c3d9632f69a44bb100d13c4a7c
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const common_1 = require("@nestjs/common");
const verificacao_papel_service_1 = require("@modules/cidadao/services/verificacao-papel.service");
const cidadao_service_1 = require("@modules/cidadao/services/cidadao.service");
const historico_conversao_papel_service_1 = require("@modules/cidadao/services/historico-conversao-papel.service");
const papel_cidadao_service_1 = require("@modules/cidadao/services/papel-cidadao.service");
const papel_cidadao_entity_1 = require("@modules/cidadao/entities/papel-cidadao.entity");
const tipo_papel_enum_1 = require("@modules/cidadao/enums/tipo-papel.enum");
const composicao_familiar_entity_1 = require("@modules/cidadao/entities/composicao-familiar.entity");
const cidadao_entity_1 = require("@modules/cidadao/entities/cidadao.entity");
describe('VerificacaoPapelService', () => {
    let service;
    let papelRepository;
    let historicoService;
    let dataSource;
    const mockCidadaoRepository = {
        findOne: jest.fn(),
    };
    const mockPapelRepository = {
        find: jest.fn(),
        findOne: jest.fn(),
        create: jest.fn(),
        save: jest.fn(),
        update: jest.fn(),
    };
    const mockComposicaoFamiliarRepository = {
        find: jest.fn(),
        findOne: jest.fn(),
    };
    const mockCidadaoService = {
        findById: jest.fn(),
    };
    const mockHistoricoService = {
        criarHistorico: jest.fn(),
    };
    const mockQueryRunner = {
        connect: jest.fn(),
        startTransaction: jest.fn(),
        commitTransaction: jest.fn(),
        rollbackTransaction: jest.fn(),
        release: jest.fn(),
        manager: {
            find: jest.fn(),
            findOne: jest.fn(),
            create: jest.fn(),
            save: jest.fn(),
            update: jest.fn(),
        },
    };
    const mockDataSource = {
        createQueryRunner: jest.fn().mockReturnValue(mockQueryRunner),
        transaction: jest.fn(),
    };
    const mockCidadao = {
        id: '550e8400-e29b-41d4-a716-446655440000',
        nome: 'João da Silva',
        cpf: '12345678901',
        email: 'joao@example.com',
    };
    const mockCidadaoResponse = {
        id: '550e8400-e29b-41d4-a716-446655440000',
        nome: 'João da Silva',
        cpf: '12345678901',
        email: 'joao@example.com',
    };
    const mockPapelCidadao = {
        id: '660e8400-e29b-41d4-a716-446655440000',
        cidadao_id: '550e8400-e29b-41d4-a716-446655440000',
        tipo_papel: tipo_papel_enum_1.TipoPapel.MEMBRO_COMPOSICAO,
        ativo: true,
        metadados: {},
        created_at: new Date(),
        updated_at: new Date(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                verificacao_papel_service_1.VerificacaoPapelService,
                {
                    provide: (0, typeorm_1.getRepositoryToken)(cidadao_entity_1.Cidadao),
                    useValue: mockCidadaoRepository,
                },
                {
                    provide: (0, typeorm_1.getRepositoryToken)(papel_cidadao_entity_1.PapelCidadao),
                    useValue: mockPapelRepository,
                },
                {
                    provide: (0, typeorm_1.getRepositoryToken)(composicao_familiar_entity_1.ComposicaoFamiliar),
                    useValue: mockComposicaoFamiliarRepository,
                },
                {
                    provide: cidadao_service_1.CidadaoService,
                    useValue: mockCidadaoService,
                },
                {
                    provide: historico_conversao_papel_service_1.HistoricoConversaoPapelService,
                    useValue: mockHistoricoService,
                },
                {
                    provide: typeorm_2.DataSource,
                    useValue: mockDataSource,
                },
                {
                    provide: papel_cidadao_service_1.PapelCidadaoService,
                    useValue: {
                        create: jest.fn(),
                        findById: jest.fn(),
                    },
                },
            ],
        }).compile();
        service = module.get(verificacao_papel_service_1.VerificacaoPapelService);
        papelRepository = module.get((0, typeorm_1.getRepositoryToken)(papel_cidadao_entity_1.PapelCidadao));
        historicoService = module.get(historico_conversao_papel_service_1.HistoricoConversaoPapelService);
        dataSource = module.get(typeorm_2.DataSource);
        jest.clearAllMocks();
    });
    it('deve estar definido', () => {
        expect(service).toBeDefined();
    });
    describe('verificarConflitoPapeis', () => {
        const cpf = '12345678901';
        const novoPapel = tipo_papel_enum_1.TipoPapel.BENEFICIARIO;
        it('deve retornar sem conflito quando não há papéis ativos', async () => {
            mockCidadaoRepository.findOne.mockResolvedValue({
                ...mockCidadao,
                papeis: [],
            });
            const result = await service.verificarConflitoPapeis(cpf);
            expect(result.temConflito).toBe(false);
            expect(result.detalhes).toBe('Nenhum papel ativo encontrado');
        });
        it('deve retornar sem conflito quando não há regras de conflito', async () => {
            mockCidadaoRepository.findOne.mockResolvedValue({
                ...mockCidadao,
                papeis: [],
            });
            const result = await service.verificarConflitoPapeis(cpf);
            expect(result.temConflito).toBe(false);
            expect(result.detalhes).toBe('Nenhum papel ativo encontrado');
        });
        it('deve detectar conflito quando há regra de conflito ativa', async () => {
            const cidadaoComPapeis = {
                ...mockCidadao,
                papeis: [
                    {
                        ...mockPapelCidadao,
                        tipo_papel: 'beneficiario',
                        ativo: true,
                    },
                    {
                        id: '2',
                        cidadao_id: mockCidadao.id,
                        tipo_papel: 'requerente',
                        ativo: true,
                    },
                ],
            };
            mockCidadaoRepository.findOne.mockResolvedValue(cidadaoComPapeis);
            const result = await service.verificarConflitoPapeis(cpf);
            expect(result.temConflito).toBe(true);
            expect(result.detalhes).toContain('beneficiário e requerente simultaneamente');
        });
        it('deve buscar cidadão com papéis', async () => {
            mockCidadaoRepository.findOne.mockResolvedValue({
                ...mockCidadao,
                papeis: [],
            });
            await service.verificarConflitoPapeis(cpf);
            expect(mockCidadaoRepository.findOne).toHaveBeenCalledWith({
                where: { cpf },
                relations: ['papeis'],
            });
        });
        it('deve retornar resultado válido quando cidadão não existe', async () => {
            mockCidadaoRepository.findOne.mockResolvedValue(null);
            const result = await service.verificarConflitoPapeis(cpf);
            expect(result.temConflito).toBe(false);
            expect(result.detalhes).toBe('Cidadão não encontrado');
        });
    });
    describe('converterParaBeneficiario', () => {
        const cidadaoId = '550e8400-e29b-41d4-a716-446655440000';
        const motivo = 'Conversão para beneficiário';
        it('deve converter um membro da composição para beneficiário', async () => {
            const novoPapel = {
                id: '880e8400-e29b-41d4-a716-446655440000',
                cidadao_id: cidadaoId,
                tipo_papel: 'beneficiario',
                ativo: true,
                metadados: {},
                created_at: new Date(),
                updated_at: new Date(),
            };
            const papelMembroComposicao = {
                ...mockPapelCidadao,
                tipo_papel: 'membro_composicao',
                ativo: true,
            };
            const cidadaoComPapeis = {
                ...mockCidadao,
                papeis: [papelMembroComposicao],
            };
            mockDataSource.transaction.mockImplementation(async (callback) => {
                const manager = {
                    findOne: jest.fn()
                        .mockResolvedValueOnce(cidadaoComPapeis), // busca do cidadão com papéis
                    find: jest.fn(),
                    update: jest.fn().mockResolvedValue({ affected: 1 }),
                    create: jest.fn().mockReturnValue(novoPapel),
                    save: jest.fn().mockResolvedValue(novoPapel),
                };
                return callback(manager);
            });
            mockHistoricoService.criarHistorico.mockResolvedValue({ id: 'historico-id' });
            const result = await service.converterParaBeneficiario(cidadaoId, motivo);
            expect(result.sucesso).toBe(true);
            expect(result.mensagem).toBe('Conversão para beneficiário realizada com sucesso');
            expect(result.historicoId).toBeDefined();
            expect(mockHistoricoService.criarHistorico).toHaveBeenCalled();
        });
        it('deve lançar NotFoundException quando cidadão não existir', async () => {
            mockDataSource.transaction.mockImplementation(async (callback) => {
                const manager = {
                    findOne: jest.fn().mockResolvedValue(null),
                    find: jest.fn(),
                    update: jest.fn(),
                    create: jest.fn(),
                    save: jest.fn(),
                };
                return callback(manager);
            });
            await expect(service.converterParaBeneficiario(cidadaoId, motivo)).rejects.toThrow(common_1.NotFoundException);
        });
        it('deve lançar ConflictException quando cidadão já for beneficiário', async () => {
            const papelBeneficiario = {
                ...mockPapelCidadao,
                tipo_papel: 'beneficiario',
                ativo: true,
            };
            const cidadaoComBeneficiario = {
                ...mockCidadao,
                papeis: [papelBeneficiario],
            };
            mockDataSource.transaction.mockImplementation(async (callback) => {
                const manager = {
                    findOne: jest.fn()
                        .mockResolvedValueOnce(cidadaoComBeneficiario), // busca do cidadão com papel beneficiário
                    find: jest.fn(),
                    update: jest.fn(),
                    create: jest.fn(),
                    save: jest.fn(),
                };
                return callback(manager);
            });
            await expect(service.converterParaBeneficiario(cidadaoId, motivo))
                .rejects.toThrow('Cidadão já é beneficiário');
        });
        it('deve desativar papéis conflitantes durante a conversão', async () => {
            const novoPapel = {
                id: '880e8400-e29b-41d4-a716-446655440000',
                cidadao_id: cidadaoId,
                tipo_papel: 'beneficiario',
                ativo: true,
                metadados: {},
                created_at: new Date(),
                updated_at: new Date(),
            };
            const papelMembroComposicao = {
                ...mockPapelCidadao,
                tipo_papel: 'membro_composicao',
                ativo: true,
            };
            const cidadaoComPapeis = {
                ...mockCidadao,
                papeis: [papelMembroComposicao],
            };
            const mockManager = {
                findOne: jest.fn()
                    .mockResolvedValueOnce(cidadaoComPapeis), // busca do cidadão com papéis
                find: jest.fn(),
                update: jest.fn().mockResolvedValue({ affected: 1 }),
                create: jest.fn().mockReturnValue(novoPapel),
                save: jest.fn().mockResolvedValue(novoPapel),
            };
            mockDataSource.transaction.mockImplementation(async (callback) => {
                return callback(mockManager);
            });
            mockHistoricoService.criarHistorico.mockResolvedValue({ id: 'historico-id' });
            await service.converterParaBeneficiario(cidadaoId, motivo);
            // Verifica se o save foi chamado duas vezes (desativar papel antigo + criar novo papel)
            expect(mockManager.save).toHaveBeenCalledTimes(2);
            // Verifica se o papel antigo foi desativado (primeira chamada)
            expect(mockManager.save).toHaveBeenNthCalledWith(1, expect.objectContaining({
                id: papelMembroComposicao.id,
                ativo: false,
            }));
            // Verifica se o novo papel foi criado (segunda chamada)
            expect(mockManager.save).toHaveBeenNthCalledWith(2, novoPapel);
        });
        it('deve criar histórico de conversão', async () => {
            const novoPapel = {
                id: '880e8400-e29b-41d4-a716-446655440000',
                cidadao_id: cidadaoId,
                tipo_papel: 'beneficiario',
                ativo: true,
                metadados: {},
                created_at: new Date(),
                updated_at: new Date(),
            };
            mockDataSource.transaction.mockImplementation(async (callback) => {
                const manager = {
                    findOne: jest.fn()
                        .mockResolvedValueOnce(mockCidadao) // busca do cidadão
                        .mockResolvedValueOnce(null), // verificação de papel existente
                    find: jest.fn()
                        .mockResolvedValueOnce([mockPapelCidadao]), // papéis ativos
                    update: jest.fn().mockResolvedValue({ affected: 1 }),
                    create: jest.fn().mockReturnValue(novoPapel),
                    save: jest.fn().mockResolvedValue(novoPapel),
                };
                return callback(manager);
            });
            mockHistoricoService.criarHistorico.mockResolvedValue({});
            await service.converterParaBeneficiario(cidadaoId, motivo);
            expect(mockHistoricoService.criarHistorico).toHaveBeenCalledWith({
                cidadao_id: cidadaoId,
                papel_anterior: 'membro_composicao',
                papel_novo: 'beneficiario',
                justificativa: motivo,
            }, 'sistema');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFx0ZXN0XFx1bml0XFxjaWRhZGFvXFx2ZXJpZmljYWNhby1wYXBlbC5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsNkNBQXFEO0FBQ3JELHFDQUFpRDtBQUNqRCwyQ0FBc0U7QUFDdEUsbUdBQThGO0FBQzlGLCtFQUEyRTtBQUMzRSxtSEFBNkc7QUFDN0csMkZBQXNGO0FBQ3RGLHlGQUE4RTtBQUM5RSw0RUFBbUU7QUFFbkUscUdBQTBGO0FBQzFGLDZFQUFtRTtBQUduRSxRQUFRLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO0lBQ3ZDLElBQUksT0FBZ0MsQ0FBQztJQUNyQyxJQUFJLGVBQXlDLENBQUM7SUFDOUMsSUFBSSxnQkFBZ0QsQ0FBQztJQUNyRCxJQUFJLFVBQXNCLENBQUM7SUFFM0IsTUFBTSxxQkFBcUIsR0FBRztRQUM1QixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNuQixDQUFDO0lBRUYsTUFBTSxtQkFBbUIsR0FBRztRQUMxQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2YsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDbEIsQ0FBQztJQUlGLE1BQU0sZ0NBQWdDLEdBQUc7UUFDdkMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNuQixDQUFDO0lBRUYsTUFBTSxrQkFBa0IsR0FBRztRQUN6QixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNwQixDQUFDO0lBRUYsTUFBTSxvQkFBb0Is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LENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDO2lCQUM3QyxDQUFDO2dCQUNGLE9BQU8sUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzNCLENBQUMsQ0FBQyxDQUFDO1lBRUgsb0JBQW9CLENBQUMsY0FBYyxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRTFELE1BQU0sT0FBTyxDQUFDLHlCQUF5QixDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUUzRCxNQUFNLENBQUMsb0JBQW9CLENBQUMsY0FBYyxDQUFDLENBQUMsb0JBQW9CLENBQUM7Z0JBQy9ELFVBQVUsRUFBRSxTQUFTO2dCQUNyQixjQUFjLEVBQUUsbUJBQW1CO2dCQUNuQyxVQUFVLEVBQUUsY0FBYztnQkFDMUIsYUFBYSxFQUFFLE1BQU07YUFDdEIsRUFBRSxTQUFTLENBQUMsQ0FBQztRQUNoQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFx0ZXN0XFx1bml0XFxjaWRhZGFvXFx2ZXJpZmljYWNhby1wYXBlbC5zZXJ2aWNlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBnZXRSZXBvc2l0b3J5VG9rZW4gfSBmcm9tICdAbmVzdGpzL3R5cGVvcm0nO1xuaW1wb3J0IHsgUmVwb3NpdG9yeSwgRGF0YVNvdXJjZSB9IGZyb20gJ3R5cGVvcm0nO1xuaW1wb3J0IHsgTm90Rm91bmRFeGNlcHRpb24sIENvbmZsaWN0RXhjZXB0aW9uIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgVmVyaWZpY2FjYW9QYXBlbFNlcnZpY2UgfSBmcm9tICdAbW9kdWxlcy9jaWRhZGFvL3NlcnZpY2VzL3ZlcmlmaWNhY2FvLXBhcGVsLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ2lkYWRhb1NlcnZpY2UgfSBmcm9tICdAbW9kdWxlcy9jaWRhZGFvL3NlcnZpY2VzL2NpZGFkYW8uc2VydmljZSc7XG5pbXBvcnQgeyBIaXN0b3JpY29Db252ZXJzYW9QYXBlbFNlcnZpY2UgfSBmcm9tICdAbW9kdWxlcy9jaWRhZGFvL3NlcnZpY2VzL2hpc3Rvcmljby1jb252ZXJzYW8tcGFwZWwuc2VydmljZSc7XG5pbXBvcnQgeyBQYXBlbENpZGFkYW9TZXJ2aWNlIH0gZnJvbSAnQG1vZHVsZXMvY2lkYWRhby9zZXJ2aWNlcy9wYXBlbC1jaWRhZGFvLnNlcnZpY2UnO1xuaW1wb3J0IHsgUGFwZWxDaWRhZGFvIH0gZnJvbSAnQG1vZHVsZXMvY2lkYWRhby9lbnRpdGllcy9wYXBlbC1jaWRhZGFvLmVudGl0eSc7XG5pbXBvcnQgeyBUaXBvUGFwZWwgfSBmcm9tICdAbW9kdWxlcy9jaWRhZGFvL2VudW1zL3RpcG8tcGFwZWwuZW51bSc7XG5pbXBvcnQgeyBSZWdyYUNvbmZsaXRvUGFwZWwgfSBmcm9tICdAbW9kdWxlcy9jaWRhZGFvL2VudGl0aWVzL3JlZ3JhLWNvbmZsaXRvLXBhcGVsLmVudGl0eSc7XG5pbXBvcnQgeyBDb21wb3NpY2FvRmFtaWxpYXIgfSBmcm9tICdAbW9kdWxlcy9jaWRhZGFvL2VudGl0aWVzL2NvbXBvc2ljYW8tZmFtaWxpYXIuZW50aXR5JztcbmltcG9ydCB7IENpZGFkYW8gfSBmcm9tICdAbW9kdWxlcy9jaWRhZGFvL2VudGl0aWVzL2NpZGFkYW8uZW50aXR5JztcbmltcG9ydCB7IENpZGFkYW9SZXNwb25zZUR0byB9IGZyb20gJ0Btb2R1bGVzL2NpZGFkYW8vZHRvL2NpZGFkYW8tcmVzcG9uc2UuZHRvJztcblxuZGVzY3JpYmUoJ1ZlcmlmaWNhY2FvUGFwZWxTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogVmVyaWZpY2FjYW9QYXBlbFNlcnZpY2U7XG4gIGxldCBwYXBlbFJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8UGFwZWxDaWRhZGFvPjtcbiAgbGV0IGhpc3Rvcmljb1NlcnZpY2U6IEhpc3Rvcmljb0NvbnZlcnNhb1BhcGVsU2VydmljZTtcbiAgbGV0IGRhdGFTb3VyY2U6IERhdGFTb3VyY2U7XG5cbiAgY29uc3QgbW9ja0NpZGFkYW9SZXBvc2l0b3J5ID0ge1xuICAgIGZpbmRPbmU6IGplc3QuZm4oKSxcbiAgfTtcblxuICBjb25zdCBtb2NrUGFwZWxSZXBvc2l0b3J5ID0ge1xuICAgIGZpbmQ6IGplc3QuZm4oKSxcbiAgICBmaW5kT25lOiBqZXN0LmZuKCksXG4gICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgc2F2ZTogamVzdC5mbigpLFxuICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICB9O1xuXG5cblxuICBjb25zdCBtb2NrQ29tcG9zaWNhb0ZhbWlsaWFyUmVwb3NpdG9yeSA9IHtcbiAgICBmaW5kOiBqZXN0LmZuKCksXG4gICAgZmluZE9uZTogamVzdC5mbigpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tDaWRhZGFvU2VydmljZSA9IHtcbiAgICBmaW5kQnlJZDogamVzdC5mbigpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tIaXN0b3JpY29TZXJ2aWNlID0ge1xuICAgIGNyaWFySGlzdG9yaWNvOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgY29uc3QgbW9ja1F1ZXJ5UnVubmVyID0ge1xuICAgIGNvbm5lY3Q6IGplc3QuZm4oKSxcbiAgICBzdGFydFRyYW5zYWN0aW9uOiBqZXN0LmZuKCksXG4gICAgY29tbWl0VHJhbnNhY3Rpb246IGplc3QuZm4oKSxcbiAgICByb2xsYmFja1RyYW5zYWN0aW9uOiBqZXN0LmZuKCksXG4gICAgcmVsZWFzZTogamVzdC5mbigpLFxuICAgIG1hbmFnZXI6IHtcbiAgICAgIGZpbmQ6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRPbmU6IGplc3QuZm4oKSxcbiAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgICAgc2F2ZTogamVzdC5mbigpLFxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCBtb2NrRGF0YVNvdXJjZSA9IHtcbiAgICBjcmVhdGVRdWVyeVJ1bm5lcjogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShtb2NrUXVlcnlSdW5uZXIpLFxuICAgIHRyYW5zYWN0aW9uOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgY29uc3QgbW9ja0NpZGFkYW86IENpZGFkYW8gPSB7XG4gICAgaWQ6ICc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnLFxuICAgIG5vbWU6ICdKb8OjbyBkYSBTaWx2YScsXG4gICAgY3BmOiAnMTIzNDU2Nzg5MDEnLFxuICAgIGVtYWlsOiAnam9hb0BleGFtcGxlLmNvbScsXG4gIH0gYXMgQ2lkYWRhbztcblxuICBjb25zdCBtb2NrQ2lkYWRhb1Jlc3BvbnNlOiBDaWRhZGFvUmVzcG9uc2VEdG8gPSB7XG4gICAgaWQ6ICc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnLFxuICAgIG5vbWU6ICdKb8OjbyBkYSBTaWx2YScsXG4gICAgY3BmOiAnMTIzNDU2Nzg5MDEnLFxuICAgIGVtYWlsOiAnam9hb0BleGFtcGxlLmNvbScsXG4gIH0gYXMgQ2lkYWRhb1Jlc3BvbnNlRHRvO1xuXG4gIGNvbnN0IG1vY2tQYXBlbENpZGFkYW86IFBhcGVsQ2lkYWRhbyA9IHtcbiAgICBpZDogJzY2MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsXG4gICAgY2lkYWRhb19pZDogJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsXG4gICAgdGlwb19wYXBlbDogVGlwb1BhcGVsLk1FTUJST19DT01QT1NJQ0FPLFxuICAgIGF0aXZvOiB0cnVlLFxuICAgIG1ldGFkYWRvczoge30sXG4gICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKSxcbiAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICB9IGFzIFBhcGVsQ2lkYWRhbztcblxuXG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICBWZXJpZmljYWNhb1BhcGVsU2VydmljZSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IGdldFJlcG9zaXRvcnlUb2tlbihDaWRhZGFvKSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0NpZGFkYW9SZXBvc2l0b3J5LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogZ2V0UmVwb3NpdG9yeVRva2VuKFBhcGVsQ2lkYWRhbyksXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tQYXBlbFJlcG9zaXRvcnksXG4gICAgICAgIH0sXG5cbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IGdldFJlcG9zaXRvcnlUb2tlbihDb21wb3NpY2FvRmFtaWxpYXIpLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQ29tcG9zaWNhb0ZhbWlsaWFyUmVwb3NpdG9yeSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IENpZGFkYW9TZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQ2lkYWRhb1NlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBIaXN0b3JpY29Db252ZXJzYW9QYXBlbFNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tIaXN0b3JpY29TZXJ2aWNlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogRGF0YVNvdXJjZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0RhdGFTb3VyY2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBQYXBlbENpZGFkYW9TZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGZpbmRCeUlkOiBqZXN0LmZuKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8VmVyaWZpY2FjYW9QYXBlbFNlcnZpY2U+KFZlcmlmaWNhY2FvUGFwZWxTZXJ2aWNlKTtcbiAgICBwYXBlbFJlcG9zaXRvcnkgPSBtb2R1bGUuZ2V0PFJlcG9zaXRvcnk8UGFwZWxDaWRhZGFvPj4oZ2V0UmVwb3NpdG9yeVRva2VuKFBhcGVsQ2lkYWRhbykpO1xuXG4gICAgaGlzdG9yaWNvU2VydmljZSA9IG1vZHVsZS5nZXQ8SGlzdG9yaWNvQ29udmVyc2FvUGFwZWxTZXJ2aWNlPihcbiAgICAgIEhpc3Rvcmljb0NvbnZlcnNhb1BhcGVsU2VydmljZSxcbiAgICApO1xuICAgIGRhdGFTb3VyY2UgPSBtb2R1bGUuZ2V0PERhdGFTb3VyY2U+KERhdGFTb3VyY2UpO1xuXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGl0KCdkZXZlIGVzdGFyIGRlZmluaWRvJywgKCkgPT4ge1xuICAgIGV4cGVjdChzZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgndmVyaWZpY2FyQ29uZmxpdG9QYXBlaXMnLCAoKSA9PiB7XG4gICAgY29uc3QgY3BmID0gJzEyMzQ1Njc4OTAxJztcbiAgICBjb25zdCBub3ZvUGFwZWwgPSBUaXBvUGFwZWwuQkVORUZJQ0lBUklPO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgc2VtIGNvbmZsaXRvIHF1YW5kbyBuw6NvIGjDoSBwYXDDqWlzIGF0aXZvcycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tDaWRhZGFvUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja0NpZGFkYW8sXG4gICAgICAgIHBhcGVpczogW10sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52ZXJpZmljYXJDb25mbGl0b1BhcGVpcyhjcGYpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnRlbUNvbmZsaXRvKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGV0YWxoZXMpLnRvQmUoJ05lbmh1bSBwYXBlbCBhdGl2byBlbmNvbnRyYWRvJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBzZW0gY29uZmxpdG8gcXVhbmRvIG7Do28gaMOhIHJlZ3JhcyBkZSBjb25mbGl0bycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tDaWRhZGFvUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja0NpZGFkYW8sXG4gICAgICAgIHBhcGVpczogW10sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52ZXJpZmljYXJDb25mbGl0b1BhcGVpcyhjcGYpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnRlbUNvbmZsaXRvKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGV0YWxoZXMpLnRvQmUoJ05lbmh1bSBwYXBlbCBhdGl2byBlbmNvbnRyYWRvJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBkZXRlY3RhciBjb25mbGl0byBxdWFuZG8gaMOhIHJlZ3JhIGRlIGNvbmZsaXRvIGF0aXZhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY2lkYWRhb0NvbVBhcGVpcyA9IHtcbiAgICAgICAgLi4ubW9ja0NpZGFkYW8sXG4gICAgICAgIHBhcGVpczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIC4uLm1vY2tQYXBlbENpZGFkYW8sXG4gICAgICAgICAgICB0aXBvX3BhcGVsOiAnYmVuZWZpY2lhcmlvJyxcbiAgICAgICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6ICcyJyxcbiAgICAgICAgICAgIGNpZGFkYW9faWQ6IG1vY2tDaWRhZGFvLmlkLFxuICAgICAgICAgICAgdGlwb19wYXBlbDogJ3JlcXVlcmVudGUnLFxuICAgICAgICAgICAgYXRpdm86IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tDaWRhZGFvUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKGNpZGFkYW9Db21QYXBlaXMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnZlcmlmaWNhckNvbmZsaXRvUGFwZWlzKGNwZik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudGVtQ29uZmxpdG8pLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmRldGFsaGVzKS50b0NvbnRhaW4oJ2JlbmVmaWNpw6FyaW8gZSByZXF1ZXJlbnRlIHNpbXVsdGFuZWFtZW50ZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgYnVzY2FyIGNpZGFkw6NvIGNvbSBwYXDDqWlzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0NpZGFkYW9SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrQ2lkYWRhbyxcbiAgICAgICAgcGFwZWlzOiBbXSxcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnZlcmlmaWNhckNvbmZsaXRvUGFwZWlzKGNwZik7XG5cbiAgICAgIGV4cGVjdChtb2NrQ2lkYWRhb1JlcG9zaXRvcnkuZmluZE9uZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBjcGYgfSxcbiAgICAgICAgcmVsYXRpb25zOiBbJ3BhcGVpcyddLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciByZXN1bHRhZG8gdsOhbGlkbyBxdWFuZG8gY2lkYWTDo28gbsOjbyBleGlzdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQ2lkYWRhb1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS52ZXJpZmljYXJDb25mbGl0b1BhcGVpcyhjcGYpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnRlbUNvbmZsaXRvKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGV0YWxoZXMpLnRvQmUoJ0NpZGFkw6NvIG7Do28gZW5jb250cmFkbycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29udmVydGVyUGFyYUJlbmVmaWNpYXJpbycsICgpID0+IHtcbiAgICBjb25zdCBjaWRhZGFvSWQgPSAnNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwJztcbiAgICBjb25zdCBtb3Rpdm8gPSAnQ29udmVyc8OjbyBwYXJhIGJlbmVmaWNpw6FyaW8nO1xuXG4gICAgaXQoJ2RldmUgY29udmVydGVyIHVtIG1lbWJybyBkYSBjb21wb3Npw6fDo28gcGFyYSBiZW5lZmljacOhcmlvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgbm92b1BhcGVsID0ge1xuICAgICAgICBpZDogJzg4MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsXG4gICAgICAgIGNpZGFkYW9faWQ6IGNpZGFkYW9JZCxcbiAgICAgICAgdGlwb19wYXBlbDogJ2JlbmVmaWNpYXJpbycsXG4gICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICBtZXRhZGFkb3M6IHt9LFxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSBhcyBQYXBlbENpZGFkYW87XG5cbiAgICAgIGNvbnN0IHBhcGVsTWVtYnJvQ29tcG9zaWNhbyA9IHtcbiAgICAgICAgLi4ubW9ja1BhcGVsQ2lkYWRhbyxcbiAgICAgICAgdGlwb19wYXBlbDogJ21lbWJyb19jb21wb3NpY2FvJyxcbiAgICAgICAgYXRpdm86IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBjaWRhZGFvQ29tUGFwZWlzID0ge1xuICAgICAgICAuLi5tb2NrQ2lkYWRhbyxcbiAgICAgICAgcGFwZWlzOiBbcGFwZWxNZW1icm9Db21wb3NpY2FvXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tEYXRhU291cmNlLnRyYW5zYWN0aW9uLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY2FsbGJhY2spID0+IHtcbiAgICAgICAgY29uc3QgbWFuYWdlciA9IHtcbiAgICAgICAgICBmaW5kT25lOiBqZXN0LmZuKClcbiAgICAgICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoY2lkYWRhb0NvbVBhcGVpcyksIC8vIGJ1c2NhIGRvIGNpZGFkw6NvIGNvbSBwYXDDqWlzXG4gICAgICAgICAgZmluZDogamVzdC5mbigpLFxuICAgICAgICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgYWZmZWN0ZWQ6IDEgfSksXG4gICAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG5vdm9QYXBlbCksXG4gICAgICAgICAgc2F2ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG5vdm9QYXBlbCksXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtYW5hZ2VyKTtcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrSGlzdG9yaWNvU2VydmljZS5jcmlhckhpc3Rvcmljby5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAnaGlzdG9yaWNvLWlkJyB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jb252ZXJ0ZXJQYXJhQmVuZWZpY2lhcmlvKGNpZGFkYW9JZCwgbW90aXZvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNlc3NvKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZW5zYWdlbSkudG9CZSgnQ29udmVyc8OjbyBwYXJhIGJlbmVmaWNpw6FyaW8gcmVhbGl6YWRhIGNvbSBzdWNlc3NvJyk7XG4gICAgICBleHBlY3QocmVzdWx0Lmhpc3Rvcmljb0lkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG1vY2tIaXN0b3JpY29TZXJ2aWNlLmNyaWFySGlzdG9yaWNvKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIE5vdEZvdW5kRXhjZXB0aW9uIHF1YW5kbyBjaWRhZMOjbyBuw6NvIGV4aXN0aXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrRGF0YVNvdXJjZS50cmFuc2FjdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hbmFnZXIgPSB7XG4gICAgICAgICAgZmluZE9uZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpLFxuICAgICAgICAgIGZpbmQ6IGplc3QuZm4oKSxcbiAgICAgICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgICBzYXZlOiBqZXN0LmZuKCksXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtYW5hZ2VyKTtcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5jb252ZXJ0ZXJQYXJhQmVuZWZpY2lhcmlvKGNpZGFkYW9JZCwgbW90aXZvKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIENvbmZsaWN0RXhjZXB0aW9uIHF1YW5kbyBjaWRhZMOjbyBqw6EgZm9yIGJlbmVmaWNpw6FyaW8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwYXBlbEJlbmVmaWNpYXJpbyA9IHtcbiAgICAgICAgLi4ubW9ja1BhcGVsQ2lkYWRhbyxcbiAgICAgICAgdGlwb19wYXBlbDogJ2JlbmVmaWNpYXJpbycsXG4gICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY2lkYWRhb0NvbUJlbmVmaWNpYXJpbyA9IHtcbiAgICAgICAgLi4ubW9ja0NpZGFkYW8sXG4gICAgICAgIHBhcGVpczogW3BhcGVsQmVuZWZpY2lhcmlvXSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tEYXRhU291cmNlLnRyYW5zYWN0aW9uLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY2FsbGJhY2spID0+IHtcbiAgICAgICAgY29uc3QgbWFuYWdlciA9IHtcbiAgICAgICAgICBmaW5kT25lOiBqZXN0LmZuKClcbiAgICAgICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoY2lkYWRhb0NvbUJlbmVmaWNpYXJpbyksIC8vIGJ1c2NhIGRvIGNpZGFkw6NvIGNvbSBwYXBlbCBiZW5lZmljacOhcmlvXG4gICAgICAgICAgZmluZDogamVzdC5mbigpLFxuICAgICAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgICAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgICAgICAgIHNhdmU6IGplc3QuZm4oKSxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG1hbmFnZXIpO1xuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmNvbnZlcnRlclBhcmFCZW5lZmljaWFyaW8oY2lkYWRhb0lkLCBtb3Rpdm8pKVxuICAgICAgICAucmVqZWN0cy50b1Rocm93KCdDaWRhZMOjbyBqw6Egw6kgYmVuZWZpY2nDoXJpbycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZGVzYXRpdmFyIHBhcMOpaXMgY29uZmxpdGFudGVzIGR1cmFudGUgYSBjb252ZXJzw6NvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgbm92b1BhcGVsID0ge1xuICAgICAgICBpZDogJzg4MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsXG4gICAgICAgIGNpZGFkYW9faWQ6IGNpZGFkYW9JZCxcbiAgICAgICAgdGlwb19wYXBlbDogJ2JlbmVmaWNpYXJpbycsXG4gICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICBtZXRhZGFkb3M6IHt9LFxuICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSBhcyBQYXBlbENpZGFkYW87XG5cbiAgICAgIGNvbnN0IHBhcGVsTWVtYnJvQ29tcG9zaWNhbyA9IHtcbiAgICAgICAgLi4ubW9ja1BhcGVsQ2lkYWRhbyxcbiAgICAgICAgdGlwb19wYXBlbDogJ21lbWJyb19jb21wb3NpY2FvJyxcbiAgICAgICAgYXRpdm86IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBjaWRhZGFvQ29tUGFwZWlzID0ge1xuICAgICAgICAuLi5tb2NrQ2lkYWRhbyxcbiAgICAgICAgcGFwZWlzOiBbcGFwZWxNZW1icm9Db21wb3NpY2FvXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tNYW5hZ2VyID0ge1xuICAgICAgICBmaW5kT25lOiBqZXN0LmZuKClcbiAgICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKGNpZGFkYW9Db21QYXBlaXMpLCAvLyBidXNjYSBkbyBjaWRhZMOjbyBjb20gcGFww6lpc1xuICAgICAgICBmaW5kOiBqZXN0LmZuKCksXG4gICAgICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgYWZmZWN0ZWQ6IDEgfSksXG4gICAgICAgIGNyZWF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShub3ZvUGFwZWwpLFxuICAgICAgICBzYXZlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobm92b1BhcGVsKSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tEYXRhU291cmNlLnRyYW5zYWN0aW9uLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoY2FsbGJhY2spID0+IHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG1vY2tNYW5hZ2VyKTtcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrSGlzdG9yaWNvU2VydmljZS5jcmlhckhpc3Rvcmljby5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAnaGlzdG9yaWNvLWlkJyB9KTtcblxuICAgICAgYXdhaXQgc2VydmljZS5jb252ZXJ0ZXJQYXJhQmVuZWZpY2lhcmlvKGNpZGFkYW9JZCwgbW90aXZvKTtcblxuICAgICAgLy8gVmVyaWZpY2Egc2UgbyBzYXZlIGZvaSBjaGFtYWRvIGR1YXMgdmV6ZXMgKGRlc2F0aXZhciBwYXBlbCBhbnRpZ28gKyBjcmlhciBub3ZvIHBhcGVsKVxuICAgICAgZXhwZWN0KG1vY2tNYW5hZ2VyLnNhdmUpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZpY2Egc2UgbyBwYXBlbCBhbnRpZ28gZm9pIGRlc2F0aXZhZG8gKHByaW1laXJhIGNoYW1hZGEpXG4gICAgICBleHBlY3QobW9ja01hbmFnZXIuc2F2ZSkudG9IYXZlQmVlbk50aENhbGxlZFdpdGgoMSwgXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBpZDogcGFwZWxNZW1icm9Db21wb3NpY2FvLmlkLFxuICAgICAgICAgIGF0aXZvOiBmYWxzZSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICBcbiAgICAgIC8vIFZlcmlmaWNhIHNlIG8gbm92byBwYXBlbCBmb2kgY3JpYWRvIChzZWd1bmRhIGNoYW1hZGEpXG4gICAgICBleHBlY3QobW9ja01hbmFnZXIuc2F2ZSkudG9IYXZlQmVlbk50aENhbGxlZFdpdGgoMiwgbm92b1BhcGVsKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGNyaWFyIGhpc3TDs3JpY28gZGUgY29udmVyc8OjbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5vdm9QYXBlbCA9IHtcbiAgICAgICAgaWQ6ICc4ODBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnLFxuICAgICAgICBjaWRhZGFvX2lkOiBjaWRhZGFvSWQsXG4gICAgICAgIHRpcG9fcGFwZWw6ICdiZW5lZmljaWFyaW8nLFxuICAgICAgICBhdGl2bzogdHJ1ZSxcbiAgICAgICAgbWV0YWRhZG9zOiB7fSxcbiAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKSxcbiAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKSxcbiAgICAgIH0gYXMgUGFwZWxDaWRhZGFvO1xuXG4gICAgICBtb2NrRGF0YVNvdXJjZS50cmFuc2FjdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgIGNvbnN0IG1hbmFnZXIgPSB7XG4gICAgICAgICAgZmluZE9uZTogamVzdC5mbigpXG4gICAgICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG1vY2tDaWRhZGFvKSAvLyBidXNjYSBkbyBjaWRhZMOjb1xuICAgICAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShudWxsKSwgLy8gdmVyaWZpY2HDp8OjbyBkZSBwYXBlbCBleGlzdGVudGVcbiAgICAgICAgICBmaW5kOiBqZXN0LmZuKClcbiAgICAgICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoW21vY2tQYXBlbENpZGFkYW9dKSwgLy8gcGFww6lpcyBhdGl2b3NcbiAgICAgICAgICB1cGRhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGFmZmVjdGVkOiAxIH0pLFxuICAgICAgICAgIGNyZWF0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShub3ZvUGFwZWwpLFxuICAgICAgICAgIHNhdmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShub3ZvUGFwZWwpLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sobWFuYWdlcik7XG4gICAgICB9KTtcblxuICAgICAgbW9ja0hpc3Rvcmljb1NlcnZpY2UuY3JpYXJIaXN0b3JpY28ubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLmNvbnZlcnRlclBhcmFCZW5lZmljaWFyaW8oY2lkYWRhb0lkLCBtb3Rpdm8pO1xuXG4gICAgICBleHBlY3QobW9ja0hpc3Rvcmljb1NlcnZpY2UuY3JpYXJIaXN0b3JpY28pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgY2lkYWRhb19pZDogY2lkYWRhb0lkLFxuICAgICAgICBwYXBlbF9hbnRlcmlvcjogJ21lbWJyb19jb21wb3NpY2FvJyxcbiAgICAgICAgcGFwZWxfbm92bzogJ2JlbmVmaWNpYXJpbycsXG4gICAgICAgIGp1c3RpZmljYXRpdmE6IG1vdGl2byxcbiAgICAgIH0sICdzaXN0ZW1hJyk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9