d0730e84c3d8560e0358089d792e9401
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const pagamento_controller_1 = require("../../../controllers/pagamento.controller");
const pagamento_service_1 = require("../../../services/pagamento.service");
const integracao_cidadao_service_1 = require("../../../services/integracao-cidadao.service");
const status_pagamento_enum_1 = require("../../../enums/status-pagamento.enum");
const common_1 = require("@nestjs/common");
/**
 * Testes unitários para PagamentoController
 *
 * Valida o comportamento dos endpoints de pagamento, garantindo que os controladores
 * interagem corretamente com os serviços subjacentes e retornam as respostas esperadas.
 */
describe('PagamentoController', () => {
    let controller;
    let pagamentoService;
    let integracaoCidadaoService;
    // Mock de um pagamento para ser utilizado nos testes
    const pagamentoMock = {
        id: 'pagamento-id-1',
        solicitacaoId: 'solicitacao-id-1',
        valor: 500,
        status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
        metodoPagamento: 'pix',
        infoBancariaId: 'info-bancaria-id-1',
        dataLiberacao: new Date(),
        dataCriacao: new Date(),
        dataAtualizacao: new Date(),
        liberadoPor: 'usuario-id-1',
        observacoes: 'Pagamento de benefício eventual'
    };
    // Mock da lista de pagamentos
    const pagamentosListMock = [
        pagamentoMock,
        {
            ...pagamentoMock,
            id: 'pagamento-id-2',
            solicitacaoId: 'solicitacao-id-2',
            valor: 300
        }
    ];
    // Mock de resposta paginada
    const paginatedResponseMock = {
        items: pagamentosListMock,
        total: pagamentosListMock.length,
        page: 1,
        limit: 10
    };
    // Mock das informações bancárias
    const infoBancariasMock = [
        {
            id: 'info-bancaria-id-1',
            banco: '001',
            nomeBanco: 'Banco do Brasil',
            agencia: '1234',
            conta: '12345-6',
            tipoConta: 'Corrente',
            principal: true
        },
        {
            id: 'info-bancaria-id-2',
            pixTipo: 'email',
            pixChave: 'u***@e***.com',
            principal: false
        }
    ];
    // Mock do request para simular o usuário autenticado
    const mockRequest = {
        user: {
            id: 'usuario-id-1',
            nome: 'Usuário Teste',
            perfil: 'operador'
        }
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            controllers: [pagamento_controller_1.PagamentoController],
            providers: [
                {
                    provide: pagamento_service_1.PagamentoService,
                    useValue: {
                        createPagamento: jest.fn().mockResolvedValue(pagamentoMock),
                        findOne: jest.fn().mockResolvedValue(pagamentoMock),
                        findOneWithRelations: jest.fn().mockResolvedValue(pagamentoMock),
                        findAll: jest.fn().mockResolvedValue(paginatedResponseMock),
                        findPendentes: jest.fn().mockResolvedValue(paginatedResponseMock),
                        atualizarStatus: jest.fn().mockResolvedValue({
                            ...pagamentoMock,
                            status: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO
                        }),
                        cancelarPagamento: jest.fn().mockResolvedValue({
                            ...pagamentoMock,
                            status: status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO,
                            motivoCancelamento: 'Cancelado a pedido do beneficiário',
                            dataCancelamento: new Date()
                        })
                    }
                },
                {
                    provide: integracao_cidadao_service_1.IntegracaoCidadaoService,
                    useValue: {
                        obterInformacoesBancarias: jest.fn().mockResolvedValue(infoBancariasMock)
                    }
                }
            ],
        }).compile();
        controller = module.get(pagamento_controller_1.PagamentoController);
        pagamentoService = module.get(pagamento_service_1.PagamentoService);
        integracaoCidadaoService = module.get(integracao_cidadao_service_1.IntegracaoCidadaoService);
    });
    it('deve estar definido', () => {
        expect(controller).toBeDefined();
    });
    describe('createPagamento', () => {
        it('deve criar um pagamento com sucesso', async () => {
            // Arrange
            const solicitacaoId = 'solicitacao-id-1';
            const createDto = {
                infoBancariaId: 'info-bancaria-id-1',
                valor: 500,
                dataLiberacao: new Date(),
                metodoPagamento: 'pix',
                observacoes: 'Pagamento teste'
            };
            // Act
            const resultado = await controller.createPagamento(solicitacaoId, createDto, mockRequest);
            // Assert
            expect(resultado).toEqual(pagamentoMock);
            expect(pagamentoService.createPagamento).toHaveBeenCalledWith(solicitacaoId, createDto, mockRequest.user.id);
        });
        it('deve lançar erro quando o serviço falha na criação', async () => {
            // Arrange
            const solicitacaoId = 'solicitacao-id-1';
            const createDto = {
                infoBancariaId: 'info-bancaria-id-1',
                valor: 500,
                dataLiberacao: new Date(),
                metodoPagamento: 'pix',
                observacoes: 'Pagamento teste'
            };
            jest.spyOn(pagamentoService, 'createPagamento').mockRejectedValue(new common_1.ConflictException('Erro ao criar pagamento'));
            // Act & Assert
            await expect(controller.createPagamento(solicitacaoId, createDto, mockRequest)).rejects.toThrow(common_1.ConflictException);
        });
    });
    describe('getPagamento', () => {
        it('deve retornar um pagamento pelo ID', async () => {
            // Arrange
            const pagamentoId = 'pagamento-id-1';
            // Act
            const resultado = await controller.getPagamento(pagamentoId);
            // Assert
            expect(resultado).toEqual(pagamentoMock);
            expect(pagamentoService.findOneWithRelations).toHaveBeenCalledWith(pagamentoId);
        });
        it('deve lançar erro quando o pagamento não existe', async () => {
            // Arrange
            const pagamentoId = 'pagamento-inexistente';
            jest.spyOn(pagamentoService, 'findOneWithRelations').mockResolvedValue(null);
            // Act & Assert
            await expect(controller.getPagamento(pagamentoId)).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('listarPagamentos', () => {
        it('deve retornar lista paginada de pagamentos', async () => {
            // Arrange
            const filterDto = {
                status: status_pagamento_enum_1.StatusPagamentoEnum.LIBERADO,
                page: 1,
                limit: 10
            };
            // Act
            const resultado = await controller.listarPagamentos(filterDto);
            // Assert
            expect(resultado).toEqual(paginatedResponseMock);
            expect(pagamentoService.findAll).toHaveBeenCalledWith(filterDto);
        });
    });
    describe('listarPagamentosPendentes', () => {
        it('deve retornar lista paginada de pagamentos pendentes', async () => {
            // Arrange
            const query = {
                unidadeId: 'unidade-id-1',
                tipoBeneficioId: 'tipo-beneficio-id-1',
                page: 1,
                limit: 10
            };
            // Act
            const resultado = await controller.listarPagamentosPendentes(query);
            // Assert
            expect(resultado).toEqual(paginatedResponseMock);
            expect(pagamentoService.findPendentes).toHaveBeenCalledWith(query);
        });
    });
    describe('atualizarStatus', () => {
        it('deve atualizar o status de um pagamento', async () => {
            // Arrange
            const pagamentoId = 'pagamento-id-1';
            const updateDto = {
                status: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO
            };
            const pagamentoAtualizado = {
                ...pagamentoMock,
                status: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO
            };
            // Act
            const resultado = await controller.atualizarStatus(pagamentoId, updateDto, mockRequest);
            // Assert
            expect(resultado).toEqual(pagamentoAtualizado);
            expect(pagamentoService.atualizarStatus).toHaveBeenCalledWith(pagamentoId, updateDto.status, mockRequest.user.id);
        });
        it('deve lançar erro quando o pagamento não existe', async () => {
            // Arrange
            const pagamentoId = 'pagamento-inexistente';
            const updateDto = {
                status: status_pagamento_enum_1.StatusPagamentoEnum.CONFIRMADO
            };
            jest.spyOn(pagamentoService, 'atualizarStatus').mockRejectedValue(new common_1.NotFoundException('Pagamento não encontrado'));
            // Act & Assert
            await expect(controller.atualizarStatus(pagamentoId, updateDto, mockRequest)).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('cancelarPagamento', () => {
        it('deve cancelar um pagamento com sucesso', async () => {
            // Arrange
            const pagamentoId = 'pagamento-id-1';
            const cancelarDto = {
                motivoCancelamento: 'Cancelado a pedido do beneficiário'
            };
            const pagamentoCancelado = {
                ...pagamentoMock,
                status: status_pagamento_enum_1.StatusPagamentoEnum.CANCELADO,
                motivoCancelamento: 'Cancelado a pedido do beneficiário',
                dataCancelamento: expect.any(Date)
            };
            // Act
            const resultado = await controller.cancelarPagamento(pagamentoId, cancelarDto, mockRequest);
            // Assert
            expect(resultado).toEqual(pagamentoCancelado);
            expect(pagamentoService.cancelarPagamento).toHaveBeenCalledWith(pagamentoId, mockRequest.user.id, cancelarDto.motivoCancelamento);
        });
    });
    describe('getInfoBancarias', () => {
        it('deve retornar informações bancárias de um beneficiário', async () => {
            // Arrange
            const beneficiarioId = 'beneficiario-id-1';
            // Act
            const resultado = await controller.getInfoBancarias(beneficiarioId);
            // Assert
            expect(resultado).toEqual(infoBancariasMock);
            expect(integracaoCidadaoService.obterInformacoesBancarias).toHaveBeenCalledWith(beneficiarioId);
        });
        it('deve lançar erro quando o beneficiário não existe', async () => {
            // Arrange
            const beneficiarioId = 'beneficiario-inexistente';
            jest.spyOn(integracaoCidadaoService, 'obterInformacoesBancarias').mockRejectedValue(new common_1.NotFoundException('Beneficiário não encontrado'));
            // Act & Assert
            await expect(controller.getInfoBancarias(beneficiarioId)).rejects.toThrow(common_1.NotFoundException);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcdGVzdHNcXHVuaXRcXGNvbnRyb2xsZXJzXFxwYWdhbWVudG8uY29udHJvbGxlci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELG9GQUFnRjtBQUNoRiwyRUFBdUU7QUFDdkUsNkZBQXdGO0FBQ3hGLGdGQUEyRTtBQUMzRSwyQ0FBc0U7QUFNdEU7Ozs7O0dBS0c7QUFDSCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBQ25DLElBQUksVUFBK0IsQ0FBQztJQUNwQyxJQUFJLGdCQUFrQyxDQUFDO0lBQ3ZDLElBQUksd0JBQWtELENBQUM7SUFFdkQscURBQXFEO0lBQ3JELE1BQU0sYUFBYSxHQUFHO1FBQ3BCLEVBQUUsRUFBRSxnQkFBZ0I7UUFDcEIsYUFBYSxFQUFFLGtCQUFrQjtRQUNqQyxLQUFLLEVBQUUsR0FBRztRQUNWLE1BQU0sRUFBRSwyQ0FBbUIsQ0FBQyxRQUFRO1FBQ3BDLGVBQWUsRUFBRSxLQUFLO1FBQ3RCLGNBQWMsRUFBRSxvQkFBb0I7UUFDcEMsYUFBYSxFQUFFLElBQUksSUFBSSxFQUFFO1FBQ3pCLFdBQVcsRUFBRSxJQUFJLElBQUksRUFBRTtRQUN2QixlQUFlLEVBQUUsSUFBSSxJQUFJLEVBQUU7UUFDM0IsV0FBVyxFQUFFLGNBQWM7UUFDM0IsV0FBVyxFQUFFLGlDQUFpQztLQUMvQyxDQUFDO0lBRUYsOEJBQThCO0lBQzlCLE1BQU0sa0JBQWtCLEdBQUc7UUFDekIsYUFBYTtRQUNiO1lBQ0UsR0FBRyxhQUFhO1lBQ2hCLEVBQUUsRUFBRSxnQkFBZ0I7WUFDcEIsYUFBYSxFQUFFLGtCQUFrQjtZQUNqQyxLQUFLLEVBQUUsR0FBRztTQUNYO0tBQ0YsQ0FBQztJQUVGLDRCQUE0QjtJQUM1QixNQUFNLHFCQUFxQixHQUFHO1FBQzVCLEtBQUssRUFBRSxrQkFBa0I7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LENBQUM7WUFFcEUsU0FBUztZQUNULE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUM3QyxNQUFNLENBQUMsd0JBQXdCLENBQUMseUJBQXlCLENBQUMsQ0FBQyxvQkFBb0IsQ0FDN0UsY0FBYyxDQUNmLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxtREFBbUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNqRSxVQUFVO1lBQ1YsTUFBTSxjQUFjLEdBQUcsMEJBQTBCLENBQUM7WUFFbEQsSUFBSSxDQUFDLEtBQUssQ0FBQyx3QkFBd0IsRUFBRSwyQkFBMkIsQ0FBQyxDQUFDLGlCQUFpQixDQUNqRixJQUFJLDBCQUFpQixDQUFDLDZCQUE2QixDQUFDLENBQ3JELENBQUM7WUFFRixlQUFlO1lBQ2YsTUFBTSxNQUFNLENBQ1YsVUFBVSxDQUFDLGdCQUFnQixDQUFDLGNBQWMsQ0FBQyxDQUM1QyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsMEJBQWlCLENBQUMsQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcdGVzdHNcXHVuaXRcXGNvbnRyb2xsZXJzXFxwYWdhbWVudG8uY29udHJvbGxlci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgUGFnYW1lbnRvQ29udHJvbGxlciB9IGZyb20gJy4uLy4uLy4uL2NvbnRyb2xsZXJzL3BhZ2FtZW50by5jb250cm9sbGVyJztcbmltcG9ydCB7IFBhZ2FtZW50b1NlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9wYWdhbWVudG8uc2VydmljZSc7XG5pbXBvcnQgeyBJbnRlZ3JhY2FvQ2lkYWRhb1NlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9pbnRlZ3JhY2FvLWNpZGFkYW8uc2VydmljZSc7XG5pbXBvcnQgeyBTdGF0dXNQYWdhbWVudG9FbnVtIH0gZnJvbSAnLi4vLi4vLi4vZW51bXMvc3RhdHVzLXBhZ2FtZW50by5lbnVtJztcbmltcG9ydCB7IE5vdEZvdW5kRXhjZXB0aW9uLCBDb25mbGljdEV4Y2VwdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IFBhZ2FtZW50b0NyZWF0ZUR0byB9IGZyb20gJy4uLy4uLy4uL2R0b3MvcGFnYW1lbnRvLWNyZWF0ZS5kdG8nO1xuaW1wb3J0IHsgQXR1YWxpemFyU3RhdHVzRHRvIH0gZnJvbSAnLi4vLi4vLi4vZHRvcy9hdHVhbGl6YXItc3RhdHVzLmR0byc7XG5pbXBvcnQgeyBDYW5jZWxhclBhZ2FtZW50b0R0byB9IGZyb20gJy4uLy4uLy4uL2R0b3MvY2FuY2VsYXItcGFnYW1lbnRvLmR0byc7XG5pbXBvcnQgeyBGaWx0ZXJQYWdhbWVudG9EdG8gfSBmcm9tICcuLi8uLi8uLi9kdG9zL2ZpbHRlci1wYWdhbWVudG8uZHRvJztcblxuLyoqXG4gKiBUZXN0ZXMgdW5pdMOhcmlvcyBwYXJhIFBhZ2FtZW50b0NvbnRyb2xsZXJcbiAqIFxuICogVmFsaWRhIG8gY29tcG9ydGFtZW50byBkb3MgZW5kcG9pbnRzIGRlIHBhZ2FtZW50bywgZ2FyYW50aW5kbyBxdWUgb3MgY29udHJvbGFkb3Jlc1xuICogaW50ZXJhZ2VtIGNvcnJldGFtZW50ZSBjb20gb3Mgc2VydmnDp29zIHN1YmphY2VudGVzIGUgcmV0b3JuYW0gYXMgcmVzcG9zdGFzIGVzcGVyYWRhcy5cbiAqL1xuZGVzY3JpYmUoJ1BhZ2FtZW50b0NvbnRyb2xsZXInLCAoKSA9PiB7XG4gIGxldCBjb250cm9sbGVyOiBQYWdhbWVudG9Db250cm9sbGVyO1xuICBsZXQgcGFnYW1lbnRvU2VydmljZTogUGFnYW1lbnRvU2VydmljZTtcbiAgbGV0IGludGVncmFjYW9DaWRhZGFvU2VydmljZTogSW50ZWdyYWNhb0NpZGFkYW9TZXJ2aWNlO1xuXG4gIC8vIE1vY2sgZGUgdW0gcGFnYW1lbnRvIHBhcmEgc2VyIHV0aWxpemFkbyBub3MgdGVzdGVzXG4gIGNvbnN0IHBhZ2FtZW50b01vY2sgPSB7XG4gICAgaWQ6ICdwYWdhbWVudG8taWQtMScsXG4gICAgc29saWNpdGFjYW9JZDogJ3NvbGljaXRhY2FvLWlkLTEnLFxuICAgIHZhbG9yOiA1MDAsXG4gICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPLFxuICAgIG1ldG9kb1BhZ2FtZW50bzogJ3BpeCcsXG4gICAgaW5mb0JhbmNhcmlhSWQ6ICdpbmZvLWJhbmNhcmlhLWlkLTEnLFxuICAgIGRhdGFMaWJlcmFjYW86IG5ldyBEYXRlKCksXG4gICAgZGF0YUNyaWFjYW86IG5ldyBEYXRlKCksXG4gICAgZGF0YUF0dWFsaXphY2FvOiBuZXcgRGF0ZSgpLFxuICAgIGxpYmVyYWRvUG9yOiAndXN1YXJpby1pZC0xJyxcbiAgICBvYnNlcnZhY29lczogJ1BhZ2FtZW50byBkZSBiZW5lZsOtY2lvIGV2ZW50dWFsJ1xuICB9O1xuXG4gIC8vIE1vY2sgZGEgbGlzdGEgZGUgcGFnYW1lbnRvc1xuICBjb25zdCBwYWdhbWVudG9zTGlzdE1vY2sgPSBbXG4gICAgcGFnYW1lbnRvTW9jayxcbiAgICB7XG4gICAgICAuLi5wYWdhbWVudG9Nb2NrLFxuICAgICAgaWQ6ICdwYWdhbWVudG8taWQtMicsXG4gICAgICBzb2xpY2l0YWNhb0lkOiAnc29saWNpdGFjYW8taWQtMicsXG4gICAgICB2YWxvcjogMzAwXG4gICAgfVxuICBdO1xuXG4gIC8vIE1vY2sgZGUgcmVzcG9zdGEgcGFnaW5hZGFcbiAgY29uc3QgcGFnaW5hdGVkUmVzcG9uc2VNb2NrID0ge1xuICAgIGl0ZW1zOiBwYWdhbWVudG9zTGlzdE1vY2ssXG4gICAgdG90YWw6IHBhZ2FtZW50b3NMaXN0TW9jay5sZW5ndGgsXG4gICAgcGFnZTogMSxcbiAgICBsaW1pdDogMTBcbiAgfTtcblxuICAvLyBNb2NrIGRhcyBpbmZvcm1hw6fDtWVzIGJhbmPDoXJpYXNcbiAgY29uc3QgaW5mb0JhbmNhcmlhc01vY2sgPSBbXG4gICAge1xuICAgICAgaWQ6ICdpbmZvLWJhbmNhcmlhLWlkLTEnLFxuICAgICAgYmFuY286ICcwMDEnLFxuICAgICAgbm9tZUJhbmNvOiAnQmFuY28gZG8gQnJhc2lsJyxcbiAgICAgIGFnZW5jaWE6ICcxMjM0JyxcbiAgICAgIGNvbnRhOiAnMTIzNDUtNicsXG4gICAgICB0aXBvQ29udGE6ICdDb3JyZW50ZScsXG4gICAgICBwcmluY2lwYWw6IHRydWVcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAnaW5mby1iYW5jYXJpYS1pZC0yJyxcbiAgICAgIHBpeFRpcG86ICdlbWFpbCcsXG4gICAgICBwaXhDaGF2ZTogJ3UqKipAZSoqKi5jb20nLFxuICAgICAgcHJpbmNpcGFsOiBmYWxzZVxuICAgIH1cbiAgXTtcblxuICAvLyBNb2NrIGRvIHJlcXVlc3QgcGFyYSBzaW11bGFyIG8gdXN1w6FyaW8gYXV0ZW50aWNhZG9cbiAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgdXNlcjoge1xuICAgICAgaWQ6ICd1c3VhcmlvLWlkLTEnLFxuICAgICAgbm9tZTogJ1VzdcOhcmlvIFRlc3RlJyxcbiAgICAgIHBlcmZpbDogJ29wZXJhZG9yJ1xuICAgIH1cbiAgfTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgY29udHJvbGxlcnM6IFtQYWdhbWVudG9Db250cm9sbGVyXSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogUGFnYW1lbnRvU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZToge1xuICAgICAgICAgICAgY3JlYXRlUGFnYW1lbnRvOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUocGFnYW1lbnRvTW9jayksXG4gICAgICAgICAgICBmaW5kT25lOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUocGFnYW1lbnRvTW9jayksXG4gICAgICAgICAgICBmaW5kT25lV2l0aFJlbGF0aW9uczogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHBhZ2FtZW50b01vY2spLFxuICAgICAgICAgICAgZmluZEFsbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHBhZ2luYXRlZFJlc3BvbnNlTW9jayksXG4gICAgICAgICAgICBmaW5kUGVuZGVudGVzOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUocGFnaW5hdGVkUmVzcG9uc2VNb2NrKSxcbiAgICAgICAgICAgIGF0dWFsaXphclN0YXR1czogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgICAgLi4ucGFnYW1lbnRvTW9jayxcbiAgICAgICAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkNPTkZJUk1BRE9cbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgY2FuY2VsYXJQYWdhbWVudG86IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgICAgIC4uLnBhZ2FtZW50b01vY2ssXG4gICAgICAgICAgICAgIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5DQU5DRUxBRE8sXG4gICAgICAgICAgICAgIG1vdGl2b0NhbmNlbGFtZW50bzogJ0NhbmNlbGFkbyBhIHBlZGlkbyBkbyBiZW5lZmljacOhcmlvJyxcbiAgICAgICAgICAgICAgZGF0YUNhbmNlbGFtZW50bzogbmV3IERhdGUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBJbnRlZ3JhY2FvQ2lkYWRhb1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIG9idGVySW5mb3JtYWNvZXNCYW5jYXJpYXM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShpbmZvQmFuY2FyaWFzTW9jaylcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgY29udHJvbGxlciA9IG1vZHVsZS5nZXQ8UGFnYW1lbnRvQ29udHJvbGxlcj4oUGFnYW1lbnRvQ29udHJvbGxlcik7XG4gICAgcGFnYW1lbnRvU2VydmljZSA9IG1vZHVsZS5nZXQ8UGFnYW1lbnRvU2VydmljZT4oUGFnYW1lbnRvU2VydmljZSk7XG4gICAgaW50ZWdyYWNhb0NpZGFkYW9TZXJ2aWNlID0gbW9kdWxlLmdldDxJbnRlZ3JhY2FvQ2lkYWRhb1NlcnZpY2U+KEludGVncmFjYW9DaWRhZGFvU2VydmljZSk7XG4gIH0pO1xuXG4gIGl0KCdkZXZlIGVzdGFyIGRlZmluaWRvJywgKCkgPT4ge1xuICAgIGV4cGVjdChjb250cm9sbGVyKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlUGFnYW1lbnRvJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGNyaWFyIHVtIHBhZ2FtZW50byBjb20gc3VjZXNzbycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHNvbGljaXRhY2FvSWQgPSAnc29saWNpdGFjYW8taWQtMSc7XG4gICAgICBjb25zdCBjcmVhdGVEdG86IFBhZ2FtZW50b0NyZWF0ZUR0byA9IHtcbiAgICAgICAgaW5mb0JhbmNhcmlhSWQ6ICdpbmZvLWJhbmNhcmlhLWlkLTEnLFxuICAgICAgICB2YWxvcjogNTAwLFxuICAgICAgICBkYXRhTGliZXJhY2FvOiBuZXcgRGF0ZSgpLFxuICAgICAgICBtZXRvZG9QYWdhbWVudG86ICdwaXgnLFxuICAgICAgICBvYnNlcnZhY29lczogJ1BhZ2FtZW50byB0ZXN0ZSdcbiAgICAgIH07XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0YWRvID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGVQYWdhbWVudG8oXG4gICAgICAgIHNvbGljaXRhY2FvSWQsXG4gICAgICAgIGNyZWF0ZUR0byxcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgYW55XG4gICAgICApO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHRhZG8pLnRvRXF1YWwocGFnYW1lbnRvTW9jayk7XG4gICAgICBleHBlY3QocGFnYW1lbnRvU2VydmljZS5jcmVhdGVQYWdhbWVudG8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBzb2xpY2l0YWNhb0lkLFxuICAgICAgICBjcmVhdGVEdG8sXG4gICAgICAgIG1vY2tSZXF1ZXN0LnVzZXIuaWRcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIGVycm8gcXVhbmRvIG8gc2VydmnDp28gZmFsaGEgbmEgY3JpYcOnw6NvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qgc29saWNpdGFjYW9JZCA9ICdzb2xpY2l0YWNhby1pZC0xJztcbiAgICAgIGNvbnN0IGNyZWF0ZUR0bzogUGFnYW1lbnRvQ3JlYXRlRHRvID0ge1xuICAgICAgICBpbmZvQmFuY2FyaWFJZDogJ2luZm8tYmFuY2FyaWEtaWQtMScsXG4gICAgICAgIHZhbG9yOiA1MDAsXG4gICAgICAgIGRhdGFMaWJlcmFjYW86IG5ldyBEYXRlKCksXG4gICAgICAgIG1ldG9kb1BhZ2FtZW50bzogJ3BpeCcsXG4gICAgICAgIG9ic2VydmFjb2VzOiAnUGFnYW1lbnRvIHRlc3RlJ1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgamVzdC5zcHlPbihwYWdhbWVudG9TZXJ2aWNlLCAnY3JlYXRlUGFnYW1lbnRvJykubW9ja1JlamVjdGVkVmFsdWUoXG4gICAgICAgIG5ldyBDb25mbGljdEV4Y2VwdGlvbignRXJybyBhbyBjcmlhciBwYWdhbWVudG8nKVxuICAgICAgKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuY3JlYXRlUGFnYW1lbnRvKHNvbGljaXRhY2FvSWQsIGNyZWF0ZUR0bywgbW9ja1JlcXVlc3QgYXMgYW55KVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coQ29uZmxpY3RFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UGFnYW1lbnRvJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIHVtIHBhZ2FtZW50byBwZWxvIElEJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcGFnYW1lbnRvSWQgPSAncGFnYW1lbnRvLWlkLTEnO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdGFkbyA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0UGFnYW1lbnRvKHBhZ2FtZW50b0lkKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0YWRvKS50b0VxdWFsKHBhZ2FtZW50b01vY2spO1xuICAgICAgZXhwZWN0KHBhZ2FtZW50b1NlcnZpY2UuZmluZE9uZVdpdGhSZWxhdGlvbnMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHBhZ2FtZW50b0lkKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGxhbsOnYXIgZXJybyBxdWFuZG8gbyBwYWdhbWVudG8gbsOjbyBleGlzdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBwYWdhbWVudG9JZCA9ICdwYWdhbWVudG8taW5leGlzdGVudGUnO1xuICAgICAgXG4gICAgICBqZXN0LnNweU9uKHBhZ2FtZW50b1NlcnZpY2UsICdmaW5kT25lV2l0aFJlbGF0aW9ucycpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgY29udHJvbGxlci5nZXRQYWdhbWVudG8ocGFnYW1lbnRvSWQpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdsaXN0YXJQYWdhbWVudG9zJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIGxpc3RhIHBhZ2luYWRhIGRlIHBhZ2FtZW50b3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBmaWx0ZXJEdG86IEZpbHRlclBhZ2FtZW50b0R0byA9IHtcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLkxJQkVSQURPLFxuICAgICAgICBwYWdlOiAxLFxuICAgICAgICBsaW1pdDogMTBcbiAgICAgIH07XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0YWRvID0gYXdhaXQgY29udHJvbGxlci5saXN0YXJQYWdhbWVudG9zKGZpbHRlckR0byk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdGFkbykudG9FcXVhbChwYWdpbmF0ZWRSZXNwb25zZU1vY2spO1xuICAgICAgZXhwZWN0KHBhZ2FtZW50b1NlcnZpY2UuZmluZEFsbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZmlsdGVyRHRvKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xpc3RhclBhZ2FtZW50b3NQZW5kZW50ZXMnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgbGlzdGEgcGFnaW5hZGEgZGUgcGFnYW1lbnRvcyBwZW5kZW50ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBxdWVyeSA9IHtcbiAgICAgICAgdW5pZGFkZUlkOiAndW5pZGFkZS1pZC0xJyxcbiAgICAgICAgdGlwb0JlbmVmaWNpb0lkOiAndGlwby1iZW5lZmljaW8taWQtMScsXG4gICAgICAgIHBhZ2U6IDEsXG4gICAgICAgIGxpbWl0OiAxMFxuICAgICAgfTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHRhZG8gPSBhd2FpdCBjb250cm9sbGVyLmxpc3RhclBhZ2FtZW50b3NQZW5kZW50ZXMocXVlcnkpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHRhZG8pLnRvRXF1YWwocGFnaW5hdGVkUmVzcG9uc2VNb2NrKTtcbiAgICAgIGV4cGVjdChwYWdhbWVudG9TZXJ2aWNlLmZpbmRQZW5kZW50ZXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHF1ZXJ5KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2F0dWFsaXphclN0YXR1cycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBhdHVhbGl6YXIgbyBzdGF0dXMgZGUgdW0gcGFnYW1lbnRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcGFnYW1lbnRvSWQgPSAncGFnYW1lbnRvLWlkLTEnO1xuICAgICAgY29uc3QgdXBkYXRlRHRvOiBBdHVhbGl6YXJTdGF0dXNEdG8gPSB7XG4gICAgICAgIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5DT05GSVJNQURPXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCBwYWdhbWVudG9BdHVhbGl6YWRvID0ge1xuICAgICAgICAuLi5wYWdhbWVudG9Nb2NrLFxuICAgICAgICBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uQ09ORklSTUFET1xuICAgICAgfTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHRhZG8gPSBhd2FpdCBjb250cm9sbGVyLmF0dWFsaXphclN0YXR1cyhcbiAgICAgICAgcGFnYW1lbnRvSWQsXG4gICAgICAgIHVwZGF0ZUR0byxcbiAgICAgICAgbW9ja1JlcXVlc3QgYXMgYW55XG4gICAgICApO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHRhZG8pLnRvRXF1YWwocGFnYW1lbnRvQXR1YWxpemFkbyk7XG4gICAgICBleHBlY3QocGFnYW1lbnRvU2VydmljZS5hdHVhbGl6YXJTdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBwYWdhbWVudG9JZCxcbiAgICAgICAgdXBkYXRlRHRvLnN0YXR1cyxcbiAgICAgICAgbW9ja1JlcXVlc3QudXNlci5pZFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGxhbsOnYXIgZXJybyBxdWFuZG8gbyBwYWdhbWVudG8gbsOjbyBleGlzdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBwYWdhbWVudG9JZCA9ICdwYWdhbWVudG8taW5leGlzdGVudGUnO1xuICAgICAgY29uc3QgdXBkYXRlRHRvOiBBdHVhbGl6YXJTdGF0dXNEdG8gPSB7XG4gICAgICAgIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5DT05GSVJNQURPXG4gICAgICB9O1xuICAgICAgXG4gICAgICBqZXN0LnNweU9uKHBhZ2FtZW50b1NlcnZpY2UsICdhdHVhbGl6YXJTdGF0dXMnKS5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdQYWdhbWVudG8gbsOjbyBlbmNvbnRyYWRvJylcbiAgICAgICk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmF0dWFsaXphclN0YXR1cyhwYWdhbWVudG9JZCwgdXBkYXRlRHRvLCBtb2NrUmVxdWVzdCBhcyBhbnkpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjYW5jZWxhclBhZ2FtZW50bycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBjYW5jZWxhciB1bSBwYWdhbWVudG8gY29tIHN1Y2Vzc28nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBwYWdhbWVudG9JZCA9ICdwYWdhbWVudG8taWQtMSc7XG4gICAgICBjb25zdCBjYW5jZWxhckR0bzogQ2FuY2VsYXJQYWdhbWVudG9EdG8gPSB7XG4gICAgICAgIG1vdGl2b0NhbmNlbGFtZW50bzogJ0NhbmNlbGFkbyBhIHBlZGlkbyBkbyBiZW5lZmljacOhcmlvJ1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3QgcGFnYW1lbnRvQ2FuY2VsYWRvID0ge1xuICAgICAgICAuLi5wYWdhbWVudG9Nb2NrLFxuICAgICAgICBzdGF0dXM6IFN0YXR1c1BhZ2FtZW50b0VudW0uQ0FOQ0VMQURPLFxuICAgICAgICBtb3Rpdm9DYW5jZWxhbWVudG86ICdDYW5jZWxhZG8gYSBwZWRpZG8gZG8gYmVuZWZpY2nDoXJpbycsXG4gICAgICAgIGRhdGFDYW5jZWxhbWVudG86IGV4cGVjdC5hbnkoRGF0ZSlcbiAgICAgIH07XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0YWRvID0gYXdhaXQgY29udHJvbGxlci5jYW5jZWxhclBhZ2FtZW50byhcbiAgICAgICAgcGFnYW1lbnRvSWQsXG4gICAgICAgIGNhbmNlbGFyRHRvLFxuICAgICAgICBtb2NrUmVxdWVzdCBhcyBhbnlcbiAgICAgICk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdGFkbykudG9FcXVhbChwYWdhbWVudG9DYW5jZWxhZG8pO1xuICAgICAgZXhwZWN0KHBhZ2FtZW50b1NlcnZpY2UuY2FuY2VsYXJQYWdhbWVudG8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBwYWdhbWVudG9JZCxcbiAgICAgICAgbW9ja1JlcXVlc3QudXNlci5pZCxcbiAgICAgICAgY2FuY2VsYXJEdG8ubW90aXZvQ2FuY2VsYW1lbnRvXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0SW5mb0JhbmNhcmlhcycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSByZXRvcm5hciBpbmZvcm1hw6fDtWVzIGJhbmPDoXJpYXMgZGUgdW0gYmVuZWZpY2nDoXJpbycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGJlbmVmaWNpYXJpb0lkID0gJ2JlbmVmaWNpYXJpby1pZC0xJztcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHRhZG8gPSBhd2FpdCBjb250cm9sbGVyLmdldEluZm9CYW5jYXJpYXMoYmVuZWZpY2lhcmlvSWQpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHRhZG8pLnRvRXF1YWwoaW5mb0JhbmNhcmlhc01vY2spO1xuICAgICAgZXhwZWN0KGludGVncmFjYW9DaWRhZGFvU2VydmljZS5vYnRlckluZm9ybWFjb2VzQmFuY2FyaWFzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgYmVuZWZpY2lhcmlvSWRcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIGVycm8gcXVhbmRvIG8gYmVuZWZpY2nDoXJpbyBuw6NvIGV4aXN0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGJlbmVmaWNpYXJpb0lkID0gJ2JlbmVmaWNpYXJpby1pbmV4aXN0ZW50ZSc7XG4gICAgICBcbiAgICAgIGplc3Quc3B5T24oaW50ZWdyYWNhb0NpZGFkYW9TZXJ2aWNlLCAnb2J0ZXJJbmZvcm1hY29lc0JhbmNhcmlhcycpLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ0JlbmVmaWNpw6FyaW8gbsOjbyBlbmNvbnRyYWRvJylcbiAgICAgICk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBjb250cm9sbGVyLmdldEluZm9CYW5jYXJpYXMoYmVuZWZpY2lhcmlvSWQpXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=