fc114a722c9e5572e85a5f7c686f19ac
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const request = __importStar(require("supertest"));
const typeorm_1 = require("@nestjs/typeorm");
const config_1 = require("@nestjs/config");
const jwt_1 = require("@nestjs/jwt");
const axios_1 = require("@nestjs/axios");
const pagamento_module_1 = require("../../pagamento.module");
const entities_1 = require("../../entities");
const status_pagamento_enum_1 = require("../../enums/status-pagamento.enum");
const metodo_pagamento_enum_1 = require("../../enums/metodo-pagamento.enum");
const pagamento_service_1 = require("../../services/pagamento.service");
const auditoria_pagamento_service_1 = require("../../services/auditoria-pagamento.service");
/**
 * Testes de integração para confirmações de recebimento de pagamento
 *
 * Verifica o funcionamento correto das operações de registro, consulta
 * e listagem de confirmações de recebimento de pagamentos.
 *
 * @author Equipe PGBen
 */
describe('Confirmações de Recebimento (Integration)', () => {
    let app;
    let jwtService;
    let pagamentoService;
    let auditoriaPagamentoService;
    let pagamentoRepository;
    let confirmacaoRepository;
    // Dados de teste
    const usuarioId = 'usuario-teste-id';
    const gestorId = 'gestor-teste-id';
    const unidadeId = 'unidade-teste-id';
    const pagamentoId = 'pagamento-teste-id';
    const confirmacaoId = 'confirmacao-teste-id';
    const beneficiarioId = 'beneficiario-teste-id';
    // Mock dos repositórios
    const mockPagamentoRepository = {
        findOne: jest.fn(),
        save: jest.fn(),
        update: jest.fn(),
    };
    const mockConfirmacaoRepository = {
        create: jest.fn(),
        save: jest.fn(),
        findOne: jest.fn(),
        find: jest.fn(),
        findAndCount: jest.fn(),
    };
    // Mock do serviço de auditoria
    const mockAuditoriaPagamentoService = {
        logConfirmacaoRecebimento: jest.fn(),
        logErroProcessamento: jest.fn(),
        logTentativaAcessoNaoAutorizado: jest.fn(),
    };
    beforeAll(async () => {
        const moduleFixture = await testing_1.Test.createTestingModule({
            imports: [
                pagamento_module_1.PagamentoModule,
                config_1.ConfigModule.forRoot({
                    isGlobal: true,
                    envFilePath: '.env.test',
                }),
                jwt_1.JwtModule.registerAsync({
                    imports: [config_1.ConfigModule],
                    useFactory: (configService) => ({
                        secret: configService.get('JWT_SECRET') || 'teste-secret',
                        signOptions: { expiresIn: '1h' },
                    }),
                    inject: [config_1.ConfigService],
                }),
                axios_1.HttpModule,
            ],
            providers: [
                {
                    provide: (0, typeorm_1.getRepositoryToken)(entities_1.Pagamento),
                    useValue: mockPagamentoRepository,
                },
                {
                    provide: (0, typeorm_1.getRepositoryToken)(entities_1.ConfirmacaoRecebimento),
                    useValue: mockConfirmacaoRepository,
                },
                {
                    provide: (0, typeorm_1.getRepositoryToken)(entities_1.ComprovantePagamento),
                    useValue: {},
                },
                {
                    provide: auditoria_pagamento_service_1.AuditoriaPagamentoService,
                    useValue: mockAuditoriaPagamentoService,
                },
            ],
        }).compile();
        app = moduleFixture.createNestApplication();
        jwtService = moduleFixture.get(jwt_1.JwtService);
        pagamentoService = moduleFixture.get(pagamento_service_1.PagamentoService);
        auditoriaPagamentoService = moduleFixture.get(auditoria_pagamento_service_1.AuditoriaPagamentoService);
        pagamentoRepository = moduleFixture.get((0, typeorm_1.getRepositoryToken)(entities_1.Pagamento));
        confirmacaoRepository = moduleFixture.get((0, typeorm_1.getRepositoryToken)(entities_1.ConfirmacaoRecebimento));
        await app.init();
    });
    afterAll(async () => {
        await app.close();
    });
    beforeEach(() => {
        jest.clearAllMocks();
        // Configurar mocks padrão
        mockPagamentoRepository.findOne.mockImplementation((options) => {
            if (options.where?.id === pagamentoId) {
                return Promise.resolve({
                    id: pagamentoId,
                    status: status_pagamento_enum_1.StatusPagamentoEnum.PAGO,
                    unidadeId,
                    beneficiarioId,
                    valor: 500.0,
                    metodoPagamento: metodo_pagamento_enum_1.MetodoPagamentoEnum.PIX,
                });
            }
            return Promise.resolve(null);
        });
        mockConfirmacaoRepository.findOne.mockImplementation((options) => {
            if (options.where?.id === confirmacaoId) {
                return Promise.resolve({
                    id: confirmacaoId,
                    pagamentoId,
                    dataConfirmacao: new Date(),
                    observacoes: 'Pagamento recebido via PIX',
                    numeroProtocolo: '123456789',
                    confirmadoPor: beneficiarioId,
                    createdAt: new Date(),
                });
            }
            else if (options.where?.pagamentoId === pagamentoId) {
                return Promise.resolve({
                    id: confirmacaoId,
                    pagamentoId,
                    dataConfirmacao: new Date(),
                    observacoes: 'Pagamento recebido via PIX',
                    numeroProtocolo: '123456789',
                    confirmadoPor: beneficiarioId,
                    createdAt: new Date(),
                });
            }
            return Promise.resolve(null);
        });
        mockConfirmacaoRepository.create.mockImplementation((dto) => ({
            id: confirmacaoId,
            pagamentoId: dto.pagamentoId,
            dataConfirmacao: dto.dataConfirmacao || new Date(),
            observacoes: dto.observacoes,
            numeroProtocolo: dto.numeroProtocolo || '123456789',
            confirmadoPor: dto.confirmadoPor || beneficiarioId,
            createdAt: new Date(),
        }));
        mockConfirmacaoRepository.save.mockImplementation((dto) => Promise.resolve(dto));
    });
    // Função auxiliar para gerar tokens JWT
    const gerarToken = (userId, perfis = ['usuario'], unidadeId = 'unidade-teste-id') => {
        return jwtService.sign({
            sub: userId,
            perfis,
            unidade: unidadeId,
        });
    };
    describe('Registro de Confirmações', () => {
        it('deve registrar confirmação de recebimento com sucesso', async () => {
            const token = gerarToken(beneficiarioId);
            const response = await request(app.getHttpServer())
                .post(`/pagamentos/${pagamentoId}/confirmar`)
                .set('Authorization', `Bearer ${token}`)
                .send({
                observacoes: 'Pagamento recebido via PIX',
                dataConfirmacao: new Date().toISOString(),
            });
            expect(response.status).toBe(201);
            expect(response.body).toHaveProperty('id');
            expect(response.body.pagamentoId).toBe(pagamentoId);
            expect(mockConfirmacaoRepository.create).toHaveBeenCalled();
            expect(mockConfirmacaoRepository.save).toHaveBeenCalled();
            expect(auditoriaPagamentoService.logConfirmacaoRecebimento).toHaveBeenCalled();
        });
        it('deve rejeitar confirmação para pagamento não encontrado', async () => {
            // Sobrescrever mock para este teste
            mockPagamentoRepository.findOne.mockResolvedValueOnce(null);
            const token = gerarToken(beneficiarioId);
            const response = await request(app.getHttpServer())
                .post(`/pagamentos/pagamento-inexistente/confirmar`)
                .set('Authorization', `Bearer ${token}`)
                .send({
                observacoes: 'Pagamento recebido via PIX',
                dataConfirmacao: new Date().toISOString(),
            });
            expect(response.status).toBe(404);
            expect(response.body.message).toContain('não encontrado');
        });
        it('deve rejeitar confirmação sem dados obrigatórios', async () => {
            const token = gerarToken(beneficiarioId);
            const response = await request(app.getHttpServer())
                .post(`/pagamentos/${pagamentoId}/confirmar`)
                .set('Authorization', `Bearer ${token}`)
                .send({
                // Faltando observacoes
                dataConfirmacao: new Date().toISOString(),
            });
            expect(response.status).toBe(400);
            expect(response.body.message).toContain('observacoes');
        });
        it('deve rejeitar confirmação duplicada', async () => {
            // Mock para simular que já existe confirmação para o pagamento
            mockConfirmacaoRepository.findOne.mockImplementation((options) => {
                if (options.where?.pagamentoId === pagamentoId) {
                    return Promise.resolve({
                        id: confirmacaoId,
                        pagamentoId,
                        dataConfirmacao: new Date(),
                        observacoes: 'Confirmação anterior',
                        confirmadoPor: beneficiarioId,
                    });
                }
                return Promise.resolve(null);
            });
            const token = gerarToken(beneficiarioId);
            const response = await request(app.getHttpServer())
                .post(`/pagamentos/${pagamentoId}/confirmar`)
                .set('Authorization', `Bearer ${token}`)
                .send({
                observacoes: 'Segunda confirmação',
                dataConfirmacao: new Date().toISOString(),
            });
            expect(response.status).toBe(409); // Conflict
            expect(response.body.message).toContain('já possui uma confirmação');
        });
    });
    describe('Consulta de Confirmações', () => {
        it('deve buscar confirmação por ID com sucesso', async () => {
            const token = gerarToken(gestorId, ['gestor'], unidadeId);
            const response = await request(app.getHttpServer())
                .get(`/confirmacoes/${confirmacaoId}`)
                .set('Authorization', `Bearer ${token}`);
            expect(response.status).toBe(200);
            expect(response.body).toHaveProperty('id', confirmacaoId);
            expect(response.body).toHaveProperty('pagamentoId', pagamentoId);
        });
        it('deve buscar confirmação por pagamentoId com sucesso', async () => {
            const token = gerarToken(gestorId, ['gestor'], unidadeId);
            const response = await request(app.getHttpServer())
                .get(`/pagamentos/${pagamentoId}/confirmacao`)
                .set('Authorization', `Bearer ${token}`);
            expect(response.status).toBe(200);
            expect(response.body).toHaveProperty('id', confirmacaoId);
            expect(response.body).toHaveProperty('pagamentoId', pagamentoId);
        });
        it('deve retornar 404 ao buscar confirmação inexistente', async () => {
            // Sobrescrever mock para este teste
            mockConfirmacaoRepository.findOne.mockResolvedValueOnce(null);
            const token = gerarToken(gestorId, ['gestor'], unidadeId);
            const response = await request(app.getHttpServer())
                .get(`/confirmacoes/confirmacao-inexistente`)
                .set('Authorization', `Bearer ${token}`);
            expect(response.status).toBe(404);
            expect(response.body.message).toContain('não encontrada');
        });
        it('deve listar confirmações com paginação', async () => {
            // Mock para listar confirmações
            mockConfirmacaoRepository.findAndCount.mockResolvedValueOnce([
                [
                    {
                        id: confirmacaoId,
                        pagamentoId,
                        dataConfirmacao: new Date(),
                        observacoes: 'Pagamento recebido via PIX',
                        numeroProtocolo: '123456789',
                        confirmadoPor: beneficiarioId,
                        createdAt: new Date(),
                    },
                    {
                        id: 'confirmacao-id-2',
                        pagamentoId: 'outro-pagamento-id',
                        dataConfirmacao: new Date(),
                        observacoes: 'Outro pagamento recebido',
                        numeroProtocolo: '987654321',
                        confirmadoPor: 'outro-beneficiario-id',
                        createdAt: new Date(),
                    },
                ],
                2, // Total count
            ]);
            const token = gerarToken(gestorId, ['gestor'], unidadeId);
            const response = await request(app.getHttpServer())
                .get(`/confirmacoes`)
                .query({ page: 1, limit: 10 })
                .set('Authorization', `Bearer ${token}`);
            expect(response.status).toBe(200);
            expect(response.body).toHaveProperty('items');
            expect(response.body).toHaveProperty('meta');
            expect(response.body.items).toBeInstanceOf(Array);
            expect(response.body.items).toHaveLength(2);
            expect(response.body.meta.totalItems).toBe(2);
        });
    });
    describe('Segurança e Autorização', () => {
        it('deve permitir beneficiário confirmar próprio pagamento', async () => {
            // Sobrescrever mock para este teste
            mockPagamentoRepository.findOne.mockResolvedValueOnce({
                id: pagamentoId,
                status: status_pagamento_enum_1.StatusPagamentoEnum.PAGO,
                unidadeId,
                beneficiarioId,
                valor: 500.0,
            });
            const token = gerarToken(beneficiarioId);
            const response = await request(app.getHttpServer())
                .post(`/pagamentos/${pagamentoId}/confirmar`)
                .set('Authorization', `Bearer ${token}`)
                .send({
                observacoes: 'Confirmação pelo beneficiário',
                dataConfirmacao: new Date().toISOString(),
            });
            expect(response.status).toBe(201);
        });
        it('deve permitir gestor registrar confirmação', async () => {
            const token = gerarToken(gestorId, ['gestor'], unidadeId);
            const response = await request(app.getHttpServer())
                .post(`/pagamentos/${pagamentoId}/confirmar`)
                .set('Authorization', `Bearer ${token}`)
                .send({
                observacoes: 'Confirmação pelo gestor',
                dataConfirmacao: new Date().toISOString(),
                confirmadoPor: beneficiarioId,
            });
            expect(response.status).toBe(201);
        });
        it('deve rejeitar acesso de usuário sem permissão às confirmações', async () => {
            const token = gerarToken('outro-usuario', ['usuario_basico'], 'outra-unidade');
            const response = await request(app.getHttpServer())
                .get(`/confirmacoes`)
                .set('Authorization', `Bearer ${token}`);
            expect(response.status).toBe(403);
            expect(mockAuditoriaPagamentoService.logTentativaAcessoNaoAutorizado).toHaveBeenCalled();
        });
        it('deve rejeitar confirmação de pagamento de outra unidade', async () => {
            // Sobrescrever mock para este teste
            mockPagamentoRepository.findOne.mockResolvedValueOnce({
                id: pagamentoId,
                status: status_pagamento_enum_1.StatusPagamentoEnum.PAGO,
                unidadeId: 'outra-unidade-id',
                beneficiarioId: 'outro-beneficiario-id',
                valor: 500.0,
            });
            const token = gerarToken(usuarioId, ['usuario'], unidadeId);
            const response = await request(app.getHttpServer())
                .post(`/pagamentos/${pagamentoId}/confirmar`)
                .set('Authorization', `Bearer ${token}`)
                .send({
                observacoes: 'Tentativa de confirmação',
                dataConfirmacao: new Date().toISOString(),
            });
            expect(response.status).toBe(403);
            expect(mockAuditoriaPagamentoService.logTentativaAcessoNaoAutorizado).toHaveBeenCalled();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcdGVzdHNcXGludGVncmF0aW9uXFxjb25maXJtYWNvZXMuc3BlYy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZDQUFzRDtBQUV0RCxtREFBcUM7QUFDckMsNkNBQXFEO0FBRXJELDJDQUE2RDtBQUM3RCxxQ0FBb0Q7QUFDcEQseUNBQTJDO0FBRTNDLDZEQUF5RDtBQUN6RCw2Q0FJd0I7QUFDeEIsNkVBQXdFO0FBQ3hFLDZFQUF3RTtBQUN4RSx3RUFBb0U7QUFDcEUsNEZBQXVGO0FBRXZGOzs7Ozs7O0dBT0c7QUFDSCxRQUFRLENBQUMsMkNBQTJDLEVBQUUsR0FBRyxFQUFFO0lBQ3pELElBQUksR0FBcUIsQ0FBQztJQUMxQixJQUFJLFVBQXNCLENBQUM7SUFDM0IsSUFBSSxnQkFBa0MsQ0FBQztJQUN2QyxJQUFJLHlCQUFvRCxDQUFDO0lBRXpELElBQUksbUJBQTBDLENBQUM7SUFDL0MsSUFBSSxxQkFBeUQsQ0FBQztJQUU5RCxpQkFBaUI7SUFDakIsTUFBTSxTQUFTLEdBQUcsa0JBQWtCLENBQUM7SUFDckMsTUFBTSxRQUFRLEdBQUcsaUJBQWlCLENBQUM7SUFDbkMsTUFBTSxTQUFTLEdBQUcsa0JBQWtCLENBQUM7SUFDckMsTUFBTSxXQUFXLEdBQUcsb0JBQW9CLENBQUM7SUFDekMsTUFBTSxhQUFhLEdBQUcsc0JBQXNCLENBQUM7SUFDN0MsTUFBTSxjQUFjLEdBQUcsdUJBQXVCLENBQUM7SUFFL0Msd0JBQXdCO0lBQ3hCLE1BQU0sdUJBQXVCLEdBQUc7UUFDOUIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbEIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDZixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNsQixDQUFD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SCxNQUFNLEtBQUssR0FBRyxVQUFVLENBQUMsU0FBUyxFQUFFLENBQUMsU0FBUyxDQUFDLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFFNUQsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxDQUFDO2lCQUNoRCxJQUFJLENBQUMsZUFBZSxXQUFXLFlBQVksQ0FBQztpQkFDNUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxVQUFVLEtBQUssRUFBRSxDQUFDO2lCQUN2QyxJQUFJLENBQUM7Z0JBQ0osV0FBVyxFQUFFLDBCQUEwQjtnQkFDdkMsZUFBZSxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2FBQzFDLENBQUMsQ0FBQztZQUVMLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sQ0FDSiw2QkFBNkIsQ0FBQywrQkFBK0IsQ0FDOUQsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xccGFnYW1lbnRvXFx0ZXN0c1xcaW50ZWdyYXRpb25cXGNvbmZpcm1hY29lcy5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgSU5lc3RBcHBsaWNhdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCAqIGFzIHJlcXVlc3QgZnJvbSAnc3VwZXJ0ZXN0JztcbmltcG9ydCB7IGdldFJlcG9zaXRvcnlUb2tlbiB9IGZyb20gJ0BuZXN0anMvdHlwZW9ybSc7XG5pbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQgeyBDb25maWdNb2R1bGUsIENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZyc7XG5pbXBvcnQgeyBKd3RNb2R1bGUsIEp3dFNlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2p3dCc7XG5pbXBvcnQgeyBIdHRwTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy9heGlvcyc7XG5cbmltcG9ydCB7IFBhZ2FtZW50b01vZHVsZSB9IGZyb20gJy4uLy4uL3BhZ2FtZW50by5tb2R1bGUnO1xuaW1wb3J0IHtcbiAgUGFnYW1lbnRvLFxuICBDb21wcm92YW50ZVBhZ2FtZW50byxcbiAgQ29uZmlybWFjYW9SZWNlYmltZW50byxcbn0gZnJvbSAnLi4vLi4vZW50aXRpZXMnO1xuaW1wb3J0IHsgU3RhdHVzUGFnYW1lbnRvRW51bSB9IGZyb20gJy4uLy4uL2VudW1zL3N0YXR1cy1wYWdhbWVudG8uZW51bSc7XG5pbXBvcnQgeyBNZXRvZG9QYWdhbWVudG9FbnVtIH0gZnJvbSAnLi4vLi4vZW51bXMvbWV0b2RvLXBhZ2FtZW50by5lbnVtJztcbmltcG9ydCB7IFBhZ2FtZW50b1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9wYWdhbWVudG8uc2VydmljZSc7XG5pbXBvcnQgeyBBdWRpdG9yaWFQYWdhbWVudG9TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvYXVkaXRvcmlhLXBhZ2FtZW50by5zZXJ2aWNlJztcblxuLyoqXG4gKiBUZXN0ZXMgZGUgaW50ZWdyYcOnw6NvIHBhcmEgY29uZmlybWHDp8O1ZXMgZGUgcmVjZWJpbWVudG8gZGUgcGFnYW1lbnRvXG4gKlxuICogVmVyaWZpY2EgbyBmdW5jaW9uYW1lbnRvIGNvcnJldG8gZGFzIG9wZXJhw6fDtWVzIGRlIHJlZ2lzdHJvLCBjb25zdWx0YVxuICogZSBsaXN0YWdlbSBkZSBjb25maXJtYcOnw7VlcyBkZSByZWNlYmltZW50byBkZSBwYWdhbWVudG9zLlxuICpcbiAqIEBhdXRob3IgRXF1aXBlIFBHQmVuXG4gKi9cbmRlc2NyaWJlKCdDb25maXJtYcOnw7VlcyBkZSBSZWNlYmltZW50byAoSW50ZWdyYXRpb24pJywgKCkgPT4ge1xuICBsZXQgYXBwOiBJTmVzdEFwcGxpY2F0aW9uO1xuICBsZXQgand0U2VydmljZTogSnd0U2VydmljZTtcbiAgbGV0IHBhZ2FtZW50b1NlcnZpY2U6IFBhZ2FtZW50b1NlcnZpY2U7XG4gIGxldCBhdWRpdG9yaWFQYWdhbWVudG9TZXJ2aWNlOiBBdWRpdG9yaWFQYWdhbWVudG9TZXJ2aWNlO1xuXG4gIGxldCBwYWdhbWVudG9SZXBvc2l0b3J5OiBSZXBvc2l0b3J5PFBhZ2FtZW50bz47XG4gIGxldCBjb25maXJtYWNhb1JlcG9zaXRvcnk6IFJlcG9zaXRvcnk8Q29uZmlybWFjYW9SZWNlYmltZW50bz47XG5cbiAgLy8gRGFkb3MgZGUgdGVzdGVcbiAgY29uc3QgdXN1YXJpb0lkID0gJ3VzdWFyaW8tdGVzdGUtaWQnO1xuICBjb25zdCBnZXN0b3JJZCA9ICdnZXN0b3ItdGVzdGUtaWQnO1xuICBjb25zdCB1bmlkYWRlSWQgPSAndW5pZGFkZS10ZXN0ZS1pZCc7XG4gIGNvbnN0IHBhZ2FtZW50b0lkID0gJ3BhZ2FtZW50by10ZXN0ZS1pZCc7XG4gIGNvbnN0IGNvbmZpcm1hY2FvSWQgPSAnY29uZmlybWFjYW8tdGVzdGUtaWQnO1xuICBjb25zdCBiZW5lZmljaWFyaW9JZCA9ICdiZW5lZmljaWFyaW8tdGVzdGUtaWQnO1xuXG4gIC8vIE1vY2sgZG9zIHJlcG9zaXTDs3Jpb3NcbiAgY29uc3QgbW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkgPSB7XG4gICAgZmluZE9uZTogamVzdC5mbigpLFxuICAgIHNhdmU6IGplc3QuZm4oKSxcbiAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgfTtcblxuICBjb25zdCBtb2NrQ29uZmlybWFjYW9SZXBvc2l0b3J5ID0ge1xuICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgIHNhdmU6IGplc3QuZm4oKSxcbiAgICBmaW5kT25lOiBqZXN0LmZuKCksXG4gICAgZmluZDogamVzdC5mbigpLFxuICAgIGZpbmRBbmRDb3VudDogamVzdC5mbigpLFxuICB9O1xuXG4gIC8vIE1vY2sgZG8gc2VydmnDp28gZGUgYXVkaXRvcmlhXG4gIGNvbnN0IG1vY2tBdWRpdG9yaWFQYWdhbWVudG9TZXJ2aWNlID0ge1xuICAgIGxvZ0NvbmZpcm1hY2FvUmVjZWJpbWVudG86IGplc3QuZm4oKSxcbiAgICBsb2dFcnJvUHJvY2Vzc2FtZW50bzogamVzdC5mbigpLFxuICAgIGxvZ1RlbnRhdGl2YUFjZXNzb05hb0F1dG9yaXphZG86IGplc3QuZm4oKSxcbiAgfTtcblxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZUZpeHR1cmU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgaW1wb3J0czogW1xuICAgICAgICBQYWdhbWVudG9Nb2R1bGUsXG4gICAgICAgIENvbmZpZ01vZHVsZS5mb3JSb290KHtcbiAgICAgICAgICBpc0dsb2JhbDogdHJ1ZSxcbiAgICAgICAgICBlbnZGaWxlUGF0aDogJy5lbnYudGVzdCcsXG4gICAgICAgIH0pLFxuICAgICAgICBKd3RNb2R1bGUucmVnaXN0ZXJBc3luYyh7XG4gICAgICAgICAgaW1wb3J0czogW0NvbmZpZ01vZHVsZV0sXG4gICAgICAgICAgdXNlRmFjdG9yeTogKGNvbmZpZ1NlcnZpY2U6IENvbmZpZ1NlcnZpY2UpID0+ICh7XG4gICAgICAgICAgICBzZWNyZXQ6IGNvbmZpZ1NlcnZpY2UuZ2V0KCdKV1RfU0VDUkVUJykgfHwgJ3Rlc3RlLXNlY3JldCcsXG4gICAgICAgICAgICBzaWduT3B0aW9uczogeyBleHBpcmVzSW46ICcxaCcgfSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBpbmplY3Q6IFtDb25maWdTZXJ2aWNlXSxcbiAgICAgICAgfSksXG4gICAgICAgIEh0dHBNb2R1bGUsXG4gICAgICBdLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBnZXRSZXBvc2l0b3J5VG9rZW4oUGFnYW1lbnRvKSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja1BhZ2FtZW50b1JlcG9zaXRvcnksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBnZXRSZXBvc2l0b3J5VG9rZW4oQ29uZmlybWFjYW9SZWNlYmltZW50byksXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tDb25maXJtYWNhb1JlcG9zaXRvcnksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBnZXRSZXBvc2l0b3J5VG9rZW4oQ29tcHJvdmFudGVQYWdhbWVudG8pLFxuICAgICAgICAgIHVzZVZhbHVlOiB7fSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IEF1ZGl0b3JpYVBhZ2FtZW50b1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tBdWRpdG9yaWFQYWdhbWVudG9TZXJ2aWNlLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBhcHAgPSBtb2R1bGVGaXh0dXJlLmNyZWF0ZU5lc3RBcHBsaWNhdGlvbigpO1xuICAgIGp3dFNlcnZpY2UgPSBtb2R1bGVGaXh0dXJlLmdldDxKd3RTZXJ2aWNlPihKd3RTZXJ2aWNlKTtcbiAgICBwYWdhbWVudG9TZXJ2aWNlID0gbW9kdWxlRml4dHVyZS5nZXQ8UGFnYW1lbnRvU2VydmljZT4oUGFnYW1lbnRvU2VydmljZSk7XG4gICAgYXVkaXRvcmlhUGFnYW1lbnRvU2VydmljZSA9IG1vZHVsZUZpeHR1cmUuZ2V0PEF1ZGl0b3JpYVBhZ2FtZW50b1NlcnZpY2U+KFxuICAgICAgQXVkaXRvcmlhUGFnYW1lbnRvU2VydmljZSxcbiAgICApO1xuXG4gICAgcGFnYW1lbnRvUmVwb3NpdG9yeSA9IG1vZHVsZUZpeHR1cmUuZ2V0PFJlcG9zaXRvcnk8UGFnYW1lbnRvPj4oXG4gICAgICBnZXRSZXBvc2l0b3J5VG9rZW4oUGFnYW1lbnRvKSxcbiAgICApO1xuICAgIGNvbmZpcm1hY2FvUmVwb3NpdG9yeSA9IG1vZHVsZUZpeHR1cmUuZ2V0PFxuICAgICAgUmVwb3NpdG9yeTxDb25maXJtYWNhb1JlY2ViaW1lbnRvPlxuICAgID4oZ2V0UmVwb3NpdG9yeVRva2VuKENvbmZpcm1hY2FvUmVjZWJpbWVudG8pKTtcblxuICAgIGF3YWl0IGFwcC5pbml0KCk7XG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBhcHAuY2xvc2UoKTtcbiAgfSk7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG5cbiAgICAvLyBDb25maWd1cmFyIG1vY2tzIHBhZHLDo29cbiAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5maW5kT25lLm1vY2tJbXBsZW1lbnRhdGlvbigob3B0aW9ucykgPT4ge1xuICAgICAgaWYgKG9wdGlvbnMud2hlcmU/LmlkID09PSBwYWdhbWVudG9JZCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgICBpZDogcGFnYW1lbnRvSWQsXG4gICAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLlBBR08sXG4gICAgICAgICAgdW5pZGFkZUlkLFxuICAgICAgICAgIGJlbmVmaWNpYXJpb0lkLFxuICAgICAgICAgIHZhbG9yOiA1MDAuMCxcbiAgICAgICAgICBtZXRvZG9QYWdhbWVudG86IE1ldG9kb1BhZ2FtZW50b0VudW0uUElYLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfSk7XG5cbiAgICBtb2NrQ29uZmlybWFjYW9SZXBvc2l0b3J5LmZpbmRPbmUubW9ja0ltcGxlbWVudGF0aW9uKChvcHRpb25zKSA9PiB7XG4gICAgICBpZiAob3B0aW9ucy53aGVyZT8uaWQgPT09IGNvbmZpcm1hY2FvSWQpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgICAgaWQ6IGNvbmZpcm1hY2FvSWQsXG4gICAgICAgICAgcGFnYW1lbnRvSWQsXG4gICAgICAgICAgZGF0YUNvbmZpcm1hY2FvOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIG9ic2VydmFjb2VzOiAnUGFnYW1lbnRvIHJlY2ViaWRvIHZpYSBQSVgnLFxuICAgICAgICAgIG51bWVyb1Byb3RvY29sbzogJzEyMzQ1Njc4OScsXG4gICAgICAgICAgY29uZmlybWFkb1BvcjogYmVuZWZpY2lhcmlvSWQsXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy53aGVyZT8ucGFnYW1lbnRvSWQgPT09IHBhZ2FtZW50b0lkKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICAgIGlkOiBjb25maXJtYWNhb0lkLFxuICAgICAgICAgIHBhZ2FtZW50b0lkLFxuICAgICAgICAgIGRhdGFDb25maXJtYWNhbzogbmV3IERhdGUoKSxcbiAgICAgICAgICBvYnNlcnZhY29lczogJ1BhZ2FtZW50byByZWNlYmlkbyB2aWEgUElYJyxcbiAgICAgICAgICBudW1lcm9Qcm90b2NvbG86ICcxMjM0NTY3ODknLFxuICAgICAgICAgIGNvbmZpcm1hZG9Qb3I6IGJlbmVmaWNpYXJpb0lkLFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgIH0pO1xuXG4gICAgbW9ja0NvbmZpcm1hY2FvUmVwb3NpdG9yeS5jcmVhdGUubW9ja0ltcGxlbWVudGF0aW9uKChkdG8pID0+ICh7XG4gICAgICBpZDogY29uZmlybWFjYW9JZCxcbiAgICAgIHBhZ2FtZW50b0lkOiBkdG8ucGFnYW1lbnRvSWQsXG4gICAgICBkYXRhQ29uZmlybWFjYW86IGR0by5kYXRhQ29uZmlybWFjYW8gfHwgbmV3IERhdGUoKSxcbiAgICAgIG9ic2VydmFjb2VzOiBkdG8ub2JzZXJ2YWNvZXMsXG4gICAgICBudW1lcm9Qcm90b2NvbG86IGR0by5udW1lcm9Qcm90b2NvbG8gfHwgJzEyMzQ1Njc4OScsXG4gICAgICBjb25maXJtYWRvUG9yOiBkdG8uY29uZmlybWFkb1BvciB8fCBiZW5lZmljaWFyaW9JZCxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB9KSk7XG5cbiAgICBtb2NrQ29uZmlybWFjYW9SZXBvc2l0b3J5LnNhdmUubW9ja0ltcGxlbWVudGF0aW9uKChkdG8pID0+XG4gICAgICBQcm9taXNlLnJlc29sdmUoZHRvKSxcbiAgICApO1xuICB9KTtcblxuICAvLyBGdW7Dp8OjbyBhdXhpbGlhciBwYXJhIGdlcmFyIHRva2VucyBKV1RcbiAgY29uc3QgZ2VyYXJUb2tlbiA9IChcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBwZXJmaXM6IHN0cmluZ1tdID0gWyd1c3VhcmlvJ10sXG4gICAgdW5pZGFkZUlkOiBzdHJpbmcgPSAndW5pZGFkZS10ZXN0ZS1pZCcsXG4gICkgPT4ge1xuICAgIHJldHVybiBqd3RTZXJ2aWNlLnNpZ24oe1xuICAgICAgc3ViOiB1c2VySWQsXG4gICAgICBwZXJmaXMsXG4gICAgICB1bmlkYWRlOiB1bmlkYWRlSWQsXG4gICAgfSk7XG4gIH07XG5cbiAgZGVzY3JpYmUoJ1JlZ2lzdHJvIGRlIENvbmZpcm1hw6fDtWVzJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJlZ2lzdHJhciBjb25maXJtYcOnw6NvIGRlIHJlY2ViaW1lbnRvIGNvbSBzdWNlc3NvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdG9rZW4gPSBnZXJhclRva2VuKGJlbmVmaWNpYXJpb0lkKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5wb3N0KGAvcGFnYW1lbnRvcy8ke3BhZ2FtZW50b0lkfS9jb25maXJtYXJgKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VufWApXG4gICAgICAgIC5zZW5kKHtcbiAgICAgICAgICBvYnNlcnZhY29lczogJ1BhZ2FtZW50byByZWNlYmlkbyB2aWEgUElYJyxcbiAgICAgICAgICBkYXRhQ29uZmlybWFjYW86IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAxKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnaWQnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnBhZ2FtZW50b0lkKS50b0JlKHBhZ2FtZW50b0lkKTtcblxuICAgICAgZXhwZWN0KG1vY2tDb25maXJtYWNhb1JlcG9zaXRvcnkuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja0NvbmZpcm1hY2FvUmVwb3NpdG9yeS5zYXZlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QoXG4gICAgICAgIGF1ZGl0b3JpYVBhZ2FtZW50b1NlcnZpY2UubG9nQ29uZmlybWFjYW9SZWNlYmltZW50byxcbiAgICAgICkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVqZWl0YXIgY29uZmlybWHDp8OjbyBwYXJhIHBhZ2FtZW50byBuw6NvIGVuY29udHJhZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBTb2JyZXNjcmV2ZXIgbW9jayBwYXJhIGVzdGUgdGVzdGVcbiAgICAgIG1vY2tQYWdhbWVudG9SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG51bGwpO1xuXG4gICAgICBjb25zdCB0b2tlbiA9IGdlcmFyVG9rZW4oYmVuZWZpY2lhcmlvSWQpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLnBvc3QoYC9wYWdhbWVudG9zL3BhZ2FtZW50by1pbmV4aXN0ZW50ZS9jb25maXJtYXJgKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VufWApXG4gICAgICAgIC5zZW5kKHtcbiAgICAgICAgICBvYnNlcnZhY29lczogJ1BhZ2FtZW50byByZWNlYmlkbyB2aWEgUElYJyxcbiAgICAgICAgICBkYXRhQ29uZmlybWFjYW86IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNDA0KTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm1lc3NhZ2UpLnRvQ29udGFpbignbsOjbyBlbmNvbnRyYWRvJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZWplaXRhciBjb25maXJtYcOnw6NvIHNlbSBkYWRvcyBvYnJpZ2F0w7NyaW9zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdG9rZW4gPSBnZXJhclRva2VuKGJlbmVmaWNpYXJpb0lkKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5wb3N0KGAvcGFnYW1lbnRvcy8ke3BhZ2FtZW50b0lkfS9jb25maXJtYXJgKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VufWApXG4gICAgICAgIC5zZW5kKHtcbiAgICAgICAgICAvLyBGYWx0YW5kbyBvYnNlcnZhY29lc1xuICAgICAgICAgIGRhdGFDb25maXJtYWNhbzogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDApO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9Db250YWluKCdvYnNlcnZhY29lcycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVqZWl0YXIgY29uZmlybWHDp8OjbyBkdXBsaWNhZGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIHBhcmEgc2ltdWxhciBxdWUgasOhIGV4aXN0ZSBjb25maXJtYcOnw6NvIHBhcmEgbyBwYWdhbWVudG9cbiAgICAgIG1vY2tDb25maXJtYWNhb1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrSW1wbGVtZW50YXRpb24oKG9wdGlvbnMpID0+IHtcbiAgICAgICAgaWYgKG9wdGlvbnMud2hlcmU/LnBhZ2FtZW50b0lkID09PSBwYWdhbWVudG9JZCkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICAgICAgaWQ6IGNvbmZpcm1hY2FvSWQsXG4gICAgICAgICAgICBwYWdhbWVudG9JZCxcbiAgICAgICAgICAgIGRhdGFDb25maXJtYWNhbzogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIG9ic2VydmFjb2VzOiAnQ29uZmlybWHDp8OjbyBhbnRlcmlvcicsXG4gICAgICAgICAgICBjb25maXJtYWRvUG9yOiBiZW5lZmljaWFyaW9JZCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHRva2VuID0gZ2VyYXJUb2tlbihiZW5lZmljaWFyaW9JZCk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAucG9zdChgL3BhZ2FtZW50b3MvJHtwYWdhbWVudG9JZH0vY29uZmlybWFyYClcbiAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHt0b2tlbn1gKVxuICAgICAgICAuc2VuZCh7XG4gICAgICAgICAgb2JzZXJ2YWNvZXM6ICdTZWd1bmRhIGNvbmZpcm1hw6fDo28nLFxuICAgICAgICAgIGRhdGFDb25maXJtYWNhbzogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDkpOyAvLyBDb25mbGljdFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9Db250YWluKCdqw6EgcG9zc3VpIHVtYSBjb25maXJtYcOnw6NvJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdDb25zdWx0YSBkZSBDb25maXJtYcOnw7VlcycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBidXNjYXIgY29uZmlybWHDp8OjbyBwb3IgSUQgY29tIHN1Y2Vzc28nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0b2tlbiA9IGdlcmFyVG9rZW4oZ2VzdG9ySWQsIFsnZ2VzdG9yJ10sIHVuaWRhZGVJZCk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAuZ2V0KGAvY29uZmlybWFjb2VzLyR7Y29uZmlybWFjYW9JZH1gKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VufWApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ2lkJywgY29uZmlybWFjYW9JZCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ3BhZ2FtZW50b0lkJywgcGFnYW1lbnRvSWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgYnVzY2FyIGNvbmZpcm1hw6fDo28gcG9yIHBhZ2FtZW50b0lkIGNvbSBzdWNlc3NvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdG9rZW4gPSBnZXJhclRva2VuKGdlc3RvcklkLCBbJ2dlc3RvciddLCB1bmlkYWRlSWQpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLmdldChgL3BhZ2FtZW50b3MvJHtwYWdhbWVudG9JZH0vY29uZmlybWFjYW9gKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VufWApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ2lkJywgY29uZmlybWFjYW9JZCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ3BhZ2FtZW50b0lkJywgcGFnYW1lbnRvSWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgNDA0IGFvIGJ1c2NhciBjb25maXJtYcOnw6NvIGluZXhpc3RlbnRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU29icmVzY3JldmVyIG1vY2sgcGFyYSBlc3RlIHRlc3RlXG4gICAgICBtb2NrQ29uZmlybWFjYW9SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG51bGwpO1xuXG4gICAgICBjb25zdCB0b2tlbiA9IGdlcmFyVG9rZW4oZ2VzdG9ySWQsIFsnZ2VzdG9yJ10sIHVuaWRhZGVJZCk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAuZ2V0KGAvY29uZmlybWFjb2VzL2NvbmZpcm1hY2FvLWluZXhpc3RlbnRlYClcbiAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHt0b2tlbn1gKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDQpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9Db250YWluKCduw6NvIGVuY29udHJhZGEnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGxpc3RhciBjb25maXJtYcOnw7VlcyBjb20gcGFnaW5hw6fDo28nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIHBhcmEgbGlzdGFyIGNvbmZpcm1hw6fDtWVzXG4gICAgICBtb2NrQ29uZmlybWFjYW9SZXBvc2l0b3J5LmZpbmRBbmRDb3VudC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoW1xuICAgICAgICBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6IGNvbmZpcm1hY2FvSWQsXG4gICAgICAgICAgICBwYWdhbWVudG9JZCxcbiAgICAgICAgICAgIGRhdGFDb25maXJtYWNhbzogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIG9ic2VydmFjb2VzOiAnUGFnYW1lbnRvIHJlY2ViaWRvIHZpYSBQSVgnLFxuICAgICAgICAgICAgbnVtZXJvUHJvdG9jb2xvOiAnMTIzNDU2Nzg5JyxcbiAgICAgICAgICAgIGNvbmZpcm1hZG9Qb3I6IGJlbmVmaWNpYXJpb0lkLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6ICdjb25maXJtYWNhby1pZC0yJyxcbiAgICAgICAgICAgIHBhZ2FtZW50b0lkOiAnb3V0cm8tcGFnYW1lbnRvLWlkJyxcbiAgICAgICAgICAgIGRhdGFDb25maXJtYWNhbzogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIG9ic2VydmFjb2VzOiAnT3V0cm8gcGFnYW1lbnRvIHJlY2ViaWRvJyxcbiAgICAgICAgICAgIG51bWVyb1Byb3RvY29sbzogJzk4NzY1NDMyMScsXG4gICAgICAgICAgICBjb25maXJtYWRvUG9yOiAnb3V0cm8tYmVuZWZpY2lhcmlvLWlkJyxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICAyLCAvLyBUb3RhbCBjb3VudFxuICAgICAgXSk7XG5cbiAgICAgIGNvbnN0IHRva2VuID0gZ2VyYXJUb2tlbihnZXN0b3JJZCwgWydnZXN0b3InXSwgdW5pZGFkZUlkKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5nZXQoYC9jb25maXJtYWNvZXNgKVxuICAgICAgICAucXVlcnkoeyBwYWdlOiAxLCBsaW1pdDogMTAgfSlcbiAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHt0b2tlbn1gKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdpdGVtcycpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdtZXRhJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5pdGVtcykudG9CZUluc3RhbmNlT2YoQXJyYXkpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuaXRlbXMpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm1ldGEudG90YWxJdGVtcykudG9CZSgyKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NlZ3VyYW7Dp2EgZSBBdXRvcml6YcOnw6NvJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHBlcm1pdGlyIGJlbmVmaWNpw6FyaW8gY29uZmlybWFyIHByw7NwcmlvIHBhZ2FtZW50bycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNvYnJlc2NyZXZlciBtb2NrIHBhcmEgZXN0ZSB0ZXN0ZVxuICAgICAgbW9ja1BhZ2FtZW50b1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICBpZDogcGFnYW1lbnRvSWQsXG4gICAgICAgIHN0YXR1czogU3RhdHVzUGFnYW1lbnRvRW51bS5QQUdPLFxuICAgICAgICB1bmlkYWRlSWQsXG4gICAgICAgIGJlbmVmaWNpYXJpb0lkLFxuICAgICAgICB2YWxvcjogNTAwLjAsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdG9rZW4gPSBnZXJhclRva2VuKGJlbmVmaWNpYXJpb0lkKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5wb3N0KGAvcGFnYW1lbnRvcy8ke3BhZ2FtZW50b0lkfS9jb25maXJtYXJgKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VufWApXG4gICAgICAgIC5zZW5kKHtcbiAgICAgICAgICBvYnNlcnZhY29lczogJ0NvbmZpcm1hw6fDo28gcGVsbyBiZW5lZmljacOhcmlvJyxcbiAgICAgICAgICBkYXRhQ29uZmlybWFjYW86IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAxKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHBlcm1pdGlyIGdlc3RvciByZWdpc3RyYXIgY29uZmlybWHDp8OjbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gZ2VyYXJUb2tlbihnZXN0b3JJZCwgWydnZXN0b3InXSwgdW5pZGFkZUlkKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5wb3N0KGAvcGFnYW1lbnRvcy8ke3BhZ2FtZW50b0lkfS9jb25maXJtYXJgKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VufWApXG4gICAgICAgIC5zZW5kKHtcbiAgICAgICAgICBvYnNlcnZhY29lczogJ0NvbmZpcm1hw6fDo28gcGVsbyBnZXN0b3InLFxuICAgICAgICAgIGRhdGFDb25maXJtYWNhbzogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGNvbmZpcm1hZG9Qb3I6IGJlbmVmaWNpYXJpb0lkLFxuICAgICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVqZWl0YXIgYWNlc3NvIGRlIHVzdcOhcmlvIHNlbSBwZXJtaXNzw6NvIMOgcyBjb25maXJtYcOnw7VlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRva2VuID0gZ2VyYXJUb2tlbihcbiAgICAgICAgJ291dHJvLXVzdWFyaW8nLFxuICAgICAgICBbJ3VzdWFyaW9fYmFzaWNvJ10sXG4gICAgICAgICdvdXRyYS11bmlkYWRlJyxcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAuZ2V0KGAvY29uZmlybWFjb2VzYClcbiAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHt0b2tlbn1gKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDMpO1xuICAgICAgZXhwZWN0KFxuICAgICAgICBtb2NrQXVkaXRvcmlhUGFnYW1lbnRvU2VydmljZS5sb2dUZW50YXRpdmFBY2Vzc29OYW9BdXRvcml6YWRvLFxuICAgICAgKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZWplaXRhciBjb25maXJtYcOnw6NvIGRlIHBhZ2FtZW50byBkZSBvdXRyYSB1bmlkYWRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU29icmVzY3JldmVyIG1vY2sgcGFyYSBlc3RlIHRlc3RlXG4gICAgICBtb2NrUGFnYW1lbnRvUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgIGlkOiBwYWdhbWVudG9JZCxcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNQYWdhbWVudG9FbnVtLlBBR08sXG4gICAgICAgIHVuaWRhZGVJZDogJ291dHJhLXVuaWRhZGUtaWQnLFxuICAgICAgICBiZW5lZmljaWFyaW9JZDogJ291dHJvLWJlbmVmaWNpYXJpby1pZCcsXG4gICAgICAgIHZhbG9yOiA1MDAuMCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB0b2tlbiA9IGdlcmFyVG9rZW4odXN1YXJpb0lkLCBbJ3VzdWFyaW8nXSwgdW5pZGFkZUlkKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5wb3N0KGAvcGFnYW1lbnRvcy8ke3BhZ2FtZW50b0lkfS9jb25maXJtYXJgKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VufWApXG4gICAgICAgIC5zZW5kKHtcbiAgICAgICAgICBvYnNlcnZhY29lczogJ1RlbnRhdGl2YSBkZSBjb25maXJtYcOnw6NvJyxcbiAgICAgICAgICBkYXRhQ29uZmlybWFjYW86IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNDAzKTtcbiAgICAgIGV4cGVjdChcbiAgICAgICAgbW9ja0F1ZGl0b3JpYVBhZ2FtZW50b1NlcnZpY2UubG9nVGVudGF0aXZhQWNlc3NvTmFvQXV0b3JpemFkbyxcbiAgICAgICkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9