6186725fe4481893069ada539cb84521
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const config_1 = require("@nestjs/config");
const hybrid_cache_service_1 = require("./hybrid-cache.service");
const health_check_service_1 = require("./health-check.service");
const cache_service_1 = require("../cache/cache.service");
describe('HybridCacheService', () => {
    let service;
    let healthCheckService;
    let cacheService;
    let configService;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                hybrid_cache_service_1.HybridCacheService,
                {
                    provide: config_1.ConfigService,
                    useValue: {
                        get: jest.fn((key, defaultValue) => {
                            const config = {
                                'CACHE_L1_MAX_SIZE': '100',
                                'CACHE_DEFAULT_TTL': '60000',
                                'CACHE_ENABLE_L2': 'true',
                                'CACHE_ENABLE_WARMING': 'true',
                                'CACHE_WARMING_INTERVAL': '30000'
                            };
                            return config[key] || defaultValue;
                        })
                    }
                },
                {
                    provide: health_check_service_1.HealthCheckService,
                    useValue: {
                        isRedisAvailable: jest.fn()
                    }
                },
                {
                    provide: cache_service_1.CacheService,
                    useValue: {
                        get: jest.fn(),
                        set: jest.fn(),
                        del: jest.fn(),
                        has: jest.fn()
                    }
                }
            ]
        }).compile();
        service = module.get(hybrid_cache_service_1.HybridCacheService);
        healthCheckService = module.get(health_check_service_1.HealthCheckService);
        cacheService = module.get(cache_service_1.CacheService);
        configService = module.get(config_1.ConfigService);
        // Reset metrics before each test
        service.resetMetrics();
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('get', () => {
        it('deve retornar valor do cache L1 quando disponível', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            // Simular valor no L1
            await service.set(key, value, 60000, 'medium');
            // Act
            const result = await service.get(key);
            // Assert
            expect(result).toEqual(value);
        });
        it('deve buscar no cache L2 quando L1 miss e L2 disponível', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockResolvedValue(value);
            // Act
            const result = await service.get(key);
            // Assert
            expect(result).toEqual(value);
            expect(cacheService.get).toHaveBeenCalledWith(key);
        });
        it('deve retornar null quando não encontrado em nenhum cache', async () => {
            // Arrange
            const key = 'test-key';
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockResolvedValue(null);
            // Act
            const result = await service.get(key);
            // Assert
            expect(result).toBeNull();
        });
        it('deve funcionar apenas com L1 quando L2 indisponível', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(false);
            // Adicionar ao L1
            await service.set(key, value, 60000, 'medium');
            // Act
            const result = await service.get(key);
            // Assert
            expect(result).toEqual(value);
            expect(cacheService.get).not.toHaveBeenCalled();
        });
    });
    describe('set', () => {
        it('deve armazenar no cache L1', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            // Act
            await service.set(key, value, 60000, 'medium');
            // Assert
            const result = await service.get(key);
            expect(result).toEqual(value);
        });
        it('deve armazenar no cache L2 quando disponível', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.set.mockResolvedValue(undefined);
            // Act
            await service.set(key, value, 60000, 'medium');
            // Assert
            expect(cacheService.set).toHaveBeenCalledWith(key, value, 60000);
        });
        it('deve funcionar apenas com L1 quando L2 indisponível', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(false);
            // Act
            await service.set(key, value, 60000, 'medium');
            // Assert
            const result = await service.get(key);
            expect(result).toEqual(value);
            expect(cacheService.set).not.toHaveBeenCalled();
        });
    });
    describe('del', () => {
        it('deve remover do cache L1', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            await service.set(key, value, 60000, 'medium');
            // Act
            await service.del(key);
            // Assert
            const result = await service.get(key);
            expect(result).toBeNull();
        });
        it('deve remover do cache L2 quando disponível', async () => {
            // Arrange
            const key = 'test-key';
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.del.mockResolvedValue(undefined);
            // Act
            await service.del(key);
            // Assert
            expect(cacheService.del).toHaveBeenCalledWith(key);
        });
    });
    describe('has', () => {
        it('deve retornar true quando chave existe no L1', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            await service.set(key, value, 60000, 'medium');
            // Act
            const result = await service.has(key);
            // Assert
            expect(result).toBe(true);
        });
        it('deve verificar no L2 quando não existe no L1', async () => {
            // Arrange
            const key = 'test-key';
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.has.mockResolvedValue(true);
            // Act
            const result = await service.has(key);
            // Assert
            expect(result).toBe(true);
            expect(cacheService.has).toHaveBeenCalledWith(key);
        });
        it('deve retornar false quando não existe em nenhum cache', async () => {
            // Arrange
            const key = 'test-key';
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.has.mockResolvedValue(false);
            // Act
            const result = await service.has(key);
            // Assert
            expect(result).toBe(false);
        });
    });
    describe('getOrSet', () => {
        it('deve retornar valor existente do cache', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'cached-value' };
            const factory = jest.fn().mockResolvedValue({ data: 'new-value' });
            await service.set(key, value, 60000, 'medium');
            // Act
            const result = await service.getOrSet(key, factory, 60000, 'medium');
            // Assert
            expect(result).toEqual(value);
            expect(factory).not.toHaveBeenCalled();
        });
        it('deve executar factory e armazenar quando valor não existe', async () => {
            // Arrange
            const key = 'test-key';
            const newValue = { data: 'new-value' };
            const factory = jest.fn().mockResolvedValue(newValue);
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockResolvedValue(null);
            // Act
            const result = await service.getOrSet(key, factory, 60000, 'medium');
            // Assert
            expect(result).toEqual(newValue);
            expect(factory).toHaveBeenCalled();
        });
    });
    describe('eviction', () => {
        it('deve remover entradas expiradas durante limpeza', async () => {
            // Arrange
            const key1 = 'expired-key';
            const key2 = 'valid-key';
            const value1 = 'value1';
            const value2 = 'value2';
            // Simular entrada expirada
            await service.set(key1, value1, -1000, 'low'); // TTL negativo = expirado
            await service.set(key2, value2, 60000, 'medium');
            // Act
            await service['cleanupExpiredCache']();
            // Assert
            expect(await service.get(key1)).toBeNull();
            expect(await service.get(key2)).toBe(value2);
        });
    });
    describe('métricas', () => {
        it('deve calcular métricas corretamente', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockResolvedValue(null);
            // Simular algumas operações
            await service.get(key); // L1 miss, L2 miss
            await service.set(key, value, 60000, 'medium');
            await service.get(key); // L1 hit
            // Act
            const metrics = service.getMetrics();
            // Assert
            expect(metrics.l1Hits).toBe(1);
            expect(metrics.l1Misses).toBe(1);
            expect(metrics.l2Misses).toBe(1);
            expect(metrics.l1HitRate).toBe(50);
            expect(metrics.overallHitRate).toBeCloseTo(33.33, 2);
        });
        it('deve resetar métricas corretamente', () => {
            // Arrange - simular algumas operações
            service['metrics'] = {
                l1Hits: 10,
                l1Misses: 5,
                l2Hits: 3,
                l2Misses: 2,
                evictions: 1,
                warmingOperations: 2,
                failovers: 1
            };
            // Act
            service.resetMetrics();
            // Assert
            const metrics = service.getMetrics();
            expect(metrics.l1Hits).toBe(0);
            expect(metrics.l1Misses).toBe(0);
            expect(metrics.l2Hits).toBe(0);
            expect(metrics.l2Misses).toBe(0);
            expect(metrics.evictions).toBe(0);
            expect(metrics.warmingOperations).toBe(0);
            expect(metrics.failovers).toBe(0);
        });
    });
    describe('clear', () => {
        it('deve limpar todos os caches', async () => {
            // Arrange
            const key1 = 'key1';
            const key2 = 'key2';
            const value1 = 'value1';
            const value2 = 'value2';
            await service.set(key1, value1, 60000, 'medium');
            await service.set(key2, value2, 60000, 'medium');
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            // Act
            await service.clear();
            // Assert
            expect(await service.get(key1)).toBeUndefined();
            expect(await service.get(key2)).toBeUndefined();
        });
    });
    describe('warming', () => {
        it('deve aquecer cache com chaves críticas', async () => {
            // Arrange
            const criticalKey = 'critical-key';
            const value = { data: 'critical-value' };
            // Marcar como crítica
            await service.set(criticalKey, value, 60000, 'critical');
            // Simular que não está no L1 mas está no L2
            service['l1Cache'].clear();
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockResolvedValue(value);
            // Act
            await service['performCacheWarming']();
            // Assert
            const result = await service.get(criticalKey);
            expect(result).toEqual(value);
        });
    });
    describe('error handling', () => {
        it('deve lidar com erros do L2 graciosamente', async () => {
            // Arrange
            const key = 'test-key';
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockRejectedValue(new Error('Redis error'));
            // Act & Assert
            const result = await service.get(key);
            expect(result).toBeNull();
            // Verificar se erro foi registrado nas métricas
            const metrics = service.getMetrics();
            expect(metrics.failovers).toBeGreaterThan(0);
        });
        it('deve continuar funcionando com L1 quando L2 falha', async () => {
            // Arrange
            const key = 'test-key';
            const value = { data: 'test-value' };
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.set.mockRejectedValue(new Error('Redis error'));
            // Act
            await service.set(key, value, 60000, 'medium');
            // Assert - deve funcionar com L1
            const result = await service.get(key);
            expect(result).toEqual(value);
        });
    });
    describe('priority handling', () => {
        it('deve tratar prioridades corretamente', async () => {
            // Arrange
            const criticalKey = 'critical-key';
            const lowKey = 'low-key';
            const value = { data: 'test' };
            const factory = async () => value;
            // Act
            service.registerCriticalKey(criticalKey, factory);
            await service.getOrSet(lowKey, factory, 60000, 'low');
            // Assert - chave crítica deve estar marcada
            expect(service['criticalKeys'].has(criticalKey)).toBe(true);
            expect(service['criticalKeys'].has(lowKey)).toBe(false);
        });
    });
    describe('concurrent operations', () => {
        it('deve lidar com operações concorrentes', async () => {
            // Arrange
            const key = 'concurrent-key';
            const factory = jest.fn().mockResolvedValue({ data: 'factory-value' });
            healthCheckService.isRedisAvailable.mockResolvedValue(true);
            cacheService.get.mockResolvedValue(null);
            // Act - múltiplas chamadas simultâneas
            const promises = [
                service.getOrSet(key, factory, 60000, 'medium'),
                service.getOrSet(key, factory, 60000, 'medium'),
                service.getOrSet(key, factory, 60000, 'medium')
            ];
            const results = await Promise.all(promises);
            // Assert - factory deve ser chamado apenas uma vez
            expect(factory).toHaveBeenCalledTimes(1);
            results.forEach(result => {
                expect(result).toEqual({ data: 'factory-value' });
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXHNoYXJlZFxcc2VydmljZXNcXGh5YnJpZC1jYWNoZS5zZXJ2aWNlLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFDdEQsMkNBQStDO0FBRS9DLGlFQUE0RDtBQUM1RCxpRUFBNEQ7QUFDNUQsMERBQXNEO0FBRXRELFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7SUFDbEMsSUFBSSxPQUEyQixDQUFDO0lBQ2hDLElBQUksa0JBQW1ELENBQUM7SUFDeEQsSUFBSSxZQUF1QyxDQUFDO0lBQzVDLElBQUksYUFBeUMsQ0FBQztJQUU5QyxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFNBQVMsRUFBRTtnQkFDVCx5Q0FBa0I7Z0JBQ2xCO29CQUNFLE9BQU8sRUFBRSxzQkFBYTtvQkFDdEIsUUFBUSxFQUFFO3dCQUNSLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBVyxFQUFFLFlBQWtCLEVBQUUsRUFBRTs0QkFDL0MsTUFBTSxNQUFNLEdBQUc7Z0NBQ2IsbUJBQW1CLEVBQUUsS0FBSztnQ0FDMUIsbUJBQW1CLEVBQUUsT0FBTztnQ0FDNUIsaUJBQWlCLEVBQUUsTUFBTTtnQ0FDekIsc0JBQXNCLEVBQUUsTUFBTTtnQ0FDOUIsd0JBQXdCLEVBQUUsT0FBTzs2QkFDbEMsQ0FBQzs0QkFDRixPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxZQUFZLENBQUM7d0JBQ3JDLENBQUMsQ0FBQztxQkFDSDtpQkFDRjtnQkFDRDtvQkFDRSxPQUFPLEVBQUUseUNBQWtCO29CQUMzQixRQUFRLEVBQUU7d0JBQ1IsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtxQkFDNUI7aUJBQ0Y7Z0JBQ0Q7b0JBQ0UsT0FBTyxFQUFFLDRCQUFZO29CQUNyQixRQUFRLEVBQUU7d0JBQ1IsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7d0JBQ2QsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7d0JBQ2QsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7d0JBQ2QsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7cUJBQ2Y7aUJBQ0Y7YUFDRjtTQUNGLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUViLE9BQU8sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFxQix5Q0FBa0IsQ0FBQyxDQUFDO1FBQzdELGtCQUFrQixHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMseUNBQWtCLENBQUMsQ0FBQztRQUNwRCxZQUFZLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyw0QkFBWSxDQUFDLENBQUM7UUFDeEMsYUFBYSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsc0JBQWEsQ0FBQyxDQUFDO1FBRTFDLGlDQUFpQztRQUNqQyxPQUFPLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDekIsQ0FBQyxDQUFDLENBQUM7SUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUU7UUFDbkIsRUFBRSxDQUFDLG1EQUFtRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pFLFVBQVU7WUFDVixNQUFNLEdBQUcsR0FBRyxVQUFVLENBQUM7WUFDdkIsTUFBTSxLQUFLLEdBQUcsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLENBQUM7WUFFckMsc0JBQXNCO1lBQ3RCLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztZQUUvQyxNQUFNO1lBQ04sTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRXRDLFNBQVM7WUFDVCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHdEQUF3RCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3RFLFVBQVU7WUFDVixNQUFNLEdBQUcsR0FBRyxVQUFVLENBQUM7WUFDdkIsTUFBTSxLQUFLLEdBQUcsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLENBQUM7WUFFckMsa0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDNUQsWUFBWSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUUxQyxNQUFNO1lBQ04sTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRXRDLFNBQVM7WUFDVCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDckQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMERBQTBELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEUsVUFBVTtZQUNWLE1BQU0sR0FBRyxHQUFHLFVBQVUsQ0FBQztZQUV2QixrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM1RCxZQUFZLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXpDLE1BQU07WUFDTixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFdEMsU0FBUztZQUNULE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM1QixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxxREFBcUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNuRSxVQUFVO1lBQ1YsTUFBTSxHQUFHLEdBQUcsVUFBVSxDQUFDO1lBQ3ZCLE1BQU0sS0FBSyxHQUFHLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDO1lBRXJDLGtCQUFrQixDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRTdELGtCQUFrQjtZQUNsQixNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFL0MsTUFBTTtZQUNOLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUV0QyxTQUFTO1lBQ1QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM5QixNQUFNLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ2xELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRTtRQUNuQixFQUFFLENBQUMsNEJBQTRCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDMUMsVUFBVTtZQUNWLE1BQU0sR0FBRyxHQUFHLFVBQVUsQ0FBQztZQUN2QixNQUFNLEtBQUssR0FBRyxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsQ0FBQztZQUVyQyxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUU1RCxNQUFNO1lBQ04sTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRS9DLFNBQVM7WUFDVCxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1RCxVQUFVO1lBQ1YsTUFBTSxHQUFHLEdBQUcsVUFBVSxDQUFDO1lBQ3ZCLE1BQU0sS0FBSyxHQUFHLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDO1lBRXJDLGtCQUFrQixDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzVELFlBQVksQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFOUMsTUFBTTtZQUNOLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztZQUUvQyxTQUFTO1lBQ1QsTUFBTSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxvQkFBb0IsQ0FDM0MsR0FBRyxFQUNILEtBQUssRUFDTCxLQUFLLENBQ04sQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHFEQUFxRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ25FLFVBQVU7WUFDVixNQUFNLEdBQUcsR0FBRyxVQUFVLENBQUM7WUFDdkIsTUFBTSxLQUFLLEdBQUcsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLENBQUM7WUFFckMsa0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFN0QsTUFBTTtZQUNOLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztZQUUvQyxTQUFTO1lBQ1QsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDOUIsTUFBTSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUU7UUFDbkIsRUFBRSxDQUFDLDBCQUEwQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3hDLFVBQVU7WUFDVixNQUFNLEdBQUcsR0FBRyxVQUFVLENBQUM7WUFDdkIsTUFBTSxLQUFLLEdBQUcsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLENBQUM7WUFFckMsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRS9DLE1BQU07WUFDTixNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFdkIsU0FBUztZQUNULE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNENBQTRDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDMUQsVUFBVTtZQUNWLE1BQU0sR0FBRyxHQUFHLFVBQVUsQ0FBQztZQUV2QixrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM1RCxZQUFZLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRTlDLE1BQU07WUFDTixNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFdkIsU0FBUztZQUNULE1BQU0sQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDckQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFO1FBQ25CLEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1RCxVQUFVO1lBQ1YsTUFBTSxHQUFHLEdBQUcsVUFBVSxDQUFDO1lBQ3ZCLE1BQU0sS0FBSyxHQUFHLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDO1lBRXJDLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztZQUUvQyxNQUFNO1lBQ04sTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRXRDLFNBQVM7WUFDVCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVCLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzVELFVBQVU7WUFDVixNQUFNLEdBQUcsR0FBRyxVQUFVLENBQUM7WUFFdkIsa0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDNUQsWUFBWSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUV6QyxNQUFNO1lBQ04sTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRXRDLFNBQVM7WUFDVCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFCLE1BQU0sQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDckQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsdURBQXVELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDckUsVUFBVTtZQUNWLE1BQU0sR0FBRyxHQUFHLFVBQVUsQ0FBQztZQUV2QixrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM1RCxZQUFZLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRTFDLE1BQU07WUFDTixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFdEMsU0FBUztZQUNULE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFO1FBQ3hCLEVBQUUsQ0FBQyx3Q0FBd0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN0RCxVQUFVO1lBQ1YsTUFBTSxHQUFHLEdBQUcsVUFBVSxDQUFDO1lBQ3ZCLE1BQU0sS0FBSyxHQUFHLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxDQUFDO1lBQ3ZDLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDO1lBRW5FLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztZQUUvQyxNQUFNO1lBQ04sTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRXJFLFNBQVM7WUFDVCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyREFBMkQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6RSxVQUFVO1lBQ1YsTUFBTSxHQUFHLEdBQUcsVUFBVSxDQUFDO1lBQ3ZCLE1BQU0sUUFBUSxHQUFHLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxDQUFDO1lBQ3ZDLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUV0RCxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM1RCxZQUFZLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXpDLE1BQU07WUFDTixNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFckUsU0FBUztZQUNULE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDakMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDckMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFO1FBQ3hCLEVBQUUsQ0FBQyxpREFBaUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvRCxVQUFVO1lBQ1YsTUFBTSxJQUFJLEdBQUcsYUFBYSxDQUFDO1lBQzNCLE1BQU0sSUFBSSxHQUFHLFdBQVcsQ0FBQztZQUN6QixNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUM7WUFDeEIsTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDO1lBRXhCLDJCQUEyQjtZQUMzQixNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLDBCQUEwQjtZQUN6RSxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFakQsTUFBTTtZQUNOLE1BQU0sT0FBTyxDQUFDLHFCQUFxQixDQUFDLEVBQUUsQ0FBQztZQUV2QyxTQUFTO1lBQ1QsTUFBTSxDQUFDLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQzNDLE1BQU0sQ0FBQyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDL0MsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFO1FBQ3hCLEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNuRCxVQUFVO1lBQ1YsTUFBTSxHQUFHLEdBQUcsVUFBVSxDQUFDO1lBQ3ZCLE1BQU0sS0FBSyxHQUFHLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDO1lBRXJDLGtCQUFrQixDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzVELFlBQVksQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFekMsNEJBQTRCO1lBQzVCLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLG1CQUFtQjtZQUMzQyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDL0MsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsU0FBUztZQUVqQyxNQUFNO1lBQ04sTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBRXJDLFNBQVM7WUFDVCxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQixNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqQyxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNuQyxNQUFNLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDdkQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsb0NBQW9DLEVBQUUsR0FBRyxFQUFFO1lBQzVDLHNDQUFzQztZQUN0QyxPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUc7Z0JBQ25CLE1BQU0sRUFBRSxFQUFFO2dCQUNWLFFBQVEsRUFBRSxDQUFDO2dCQUNYLE1BQU0sRUFBRSxDQUFDO2dCQUNULFFBQVEsRUFBRSxDQUFDO2dCQUNYLFNBQVMsRUFBRSxDQUFDO2dCQUNaLGlCQUFpQixFQUFFLENBQUM7Z0JBQ3BCLFNBQVMsRUFBRSxDQUFDO2FBQ2IsQ0FBQztZQUVGLE1BQU07WUFDTixPQUFPLENBQUMsWUFBWSxFQUFFLENBQUM7WUFFdkIsU0FBUztZQUNULE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUNyQyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQixNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqQyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQixNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtRQUNyQixFQUFFLENBQUMsNkJBQTZCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDM0MsVUFBVTtZQUNWLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQztZQUNwQixNQUFNLElBQUksR0FBRyxNQUFNLENBQUM7WUFDcEIsTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDO1lBQ3hCLE1BQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQztZQUV4QixNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDakQsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRWpELGtCQUFrQixDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBRTVELE1BQU07WUFDTixNQUFNLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUV0QixTQUFTO1lBQ1QsTUFBTSxDQUFDLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUU7UUFDdkIsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3RELFVBQVU7WUFDVixNQUFNLFdBQVcsR0FBRyxjQUFjLENBQUM7WUFDbkMsTUFBTSxLQUFLLEdBQUcsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQztZQUV6QyxzQkFBc0I7WUFDdEIsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBRXpELDRDQUE0QztZQUM1QyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDM0Isa0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDNUQsWUFBWSxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUUxQyxNQUFNO1lBQ04sTUFBTSxPQUFPLENBQUMscUJBQXFCLENBQUMsRUFBRSxDQUFDO1lBRXZDLFNBQVM7WUFDVCxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDOUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtRQUM5QixFQUFFLENBQUMsMENBQTBDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEQsVUFBVTtZQUNWLE1BQU0sR0FBRyxHQUFHLFVBQVUsQ0FBQztZQUV2QixrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM1RCxZQUFZLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLElBQUksS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7WUFFN0QsZUFBZTtZQUNmLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0QyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7WUFFMUIsZ0RBQWdEO1lBQy9DLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUNyQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxtREFBbUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNqRSxVQUFVO1lBQ1YsTUFBTSxHQUFHLEdBQUcsVUFBVSxDQUFDO1lBQ3ZCLE1BQU0sS0FBSyxHQUFHLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxDQUFDO1lBRXJDLGtCQUFrQixDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzVELFlBQVksQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsSUFBSSxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztZQUU3RCxNQUFNO1lBQ04sTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRS9DLGlDQUFpQztZQUNqQyxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUNqQyxFQUFFLENBQUMsc0NBQXNDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDcEQsVUFBVTtZQUNWLE1BQU0sV0FBVyxHQUFHLGNBQWMsQ0FBQztZQUNuQyxNQUFNLE1BQU0sR0FBRyxTQUFTLENBQUM7WUFDekIsTUFBTSxLQUFLLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLENBQUM7WUFDL0IsTUFBTSxPQUFPLEdBQUcsS0FBSyxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFFbEMsTUFBTTtZQUNOLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDbEQsTUFBTSxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBRXRELDRDQUE0QztZQUM1QyxNQUFNLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM1RCxNQUFNLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRTtRQUNyQyxFQUFFLENBQUMsdUNBQXVDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDckQsVUFBVTtZQUNWLE1BQU0sR0FBRyxHQUFHLGdCQUFnQixDQUFDO1lBQzdCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsQ0FBQyxDQUFDO1lBRXZFLGtCQUFrQixDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzVELFlBQVksQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFekMsdUNBQXVDO1lBQ3ZDLE1BQU0sUUFBUSxHQUFHO2dCQUNmLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDO2dCQUMvQyxPQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQztnQkFDL0MsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLENBQUM7YUFDaEQsQ0FBQztZQUVGLE1BQU0sT0FBTyxHQUFHLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUU1QyxtREFBbUQ7WUFDbkQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQ3ZCLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLENBQUMsQ0FBQztZQUNwRCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcc2hhcmVkXFxzZXJ2aWNlc1xcaHlicmlkLWNhY2hlLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZyc7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBIeWJyaWRDYWNoZVNlcnZpY2UgfSBmcm9tICcuL2h5YnJpZC1jYWNoZS5zZXJ2aWNlJztcbmltcG9ydCB7IEhlYWx0aENoZWNrU2VydmljZSB9IGZyb20gJy4vaGVhbHRoLWNoZWNrLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ2FjaGVTZXJ2aWNlIH0gZnJvbSAnLi4vY2FjaGUvY2FjaGUuc2VydmljZSc7XG5cbmRlc2NyaWJlKCdIeWJyaWRDYWNoZVNlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBzZXJ2aWNlOiBIeWJyaWRDYWNoZVNlcnZpY2U7XG4gIGxldCBoZWFsdGhDaGVja1NlcnZpY2U6IGplc3QuTW9ja2VkPEhlYWx0aENoZWNrU2VydmljZT47XG4gIGxldCBjYWNoZVNlcnZpY2U6IGplc3QuTW9ja2VkPENhY2hlU2VydmljZT47XG4gIGxldCBjb25maWdTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxDb25maWdTZXJ2aWNlPjtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIEh5YnJpZENhY2hlU2VydmljZSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IENvbmZpZ1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIGdldDogamVzdC5mbigoa2V5OiBzdHJpbmcsIGRlZmF1bHRWYWx1ZT86IGFueSkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgICAgICAgICAgJ0NBQ0hFX0wxX01BWF9TSVpFJzogJzEwMCcsXG4gICAgICAgICAgICAgICAgJ0NBQ0hFX0RFRkFVTFRfVFRMJzogJzYwMDAwJyxcbiAgICAgICAgICAgICAgICAnQ0FDSEVfRU5BQkxFX0wyJzogJ3RydWUnLFxuICAgICAgICAgICAgICAgICdDQUNIRV9FTkFCTEVfV0FSTUlORyc6ICd0cnVlJyxcbiAgICAgICAgICAgICAgICAnQ0FDSEVfV0FSTUlOR19JTlRFUlZBTCc6ICczMDAwMCdcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ1trZXldIHx8IGRlZmF1bHRWYWx1ZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogSGVhbHRoQ2hlY2tTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICBpc1JlZGlzQXZhaWxhYmxlOiBqZXN0LmZuKClcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBDYWNoZVNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIGdldDogamVzdC5mbigpLFxuICAgICAgICAgICAgc2V0OiBqZXN0LmZuKCksXG4gICAgICAgICAgICBkZWw6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGhhczogamVzdC5mbigpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBdXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8SHlicmlkQ2FjaGVTZXJ2aWNlPihIeWJyaWRDYWNoZVNlcnZpY2UpO1xuICAgIGhlYWx0aENoZWNrU2VydmljZSA9IG1vZHVsZS5nZXQoSGVhbHRoQ2hlY2tTZXJ2aWNlKTtcbiAgICBjYWNoZVNlcnZpY2UgPSBtb2R1bGUuZ2V0KENhY2hlU2VydmljZSk7XG4gICAgY29uZmlnU2VydmljZSA9IG1vZHVsZS5nZXQoQ29uZmlnU2VydmljZSk7XG5cbiAgICAvLyBSZXNldCBtZXRyaWNzIGJlZm9yZSBlYWNoIHRlc3RcbiAgICBzZXJ2aWNlLnJlc2V0TWV0cmljcygpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0JywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIHZhbG9yIGRvIGNhY2hlIEwxIHF1YW5kbyBkaXNwb27DrXZlbCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0LWtleSc7XG4gICAgICBjb25zdCB2YWx1ZSA9IHsgZGF0YTogJ3Rlc3QtdmFsdWUnIH07XG4gICAgICBcbiAgICAgIC8vIFNpbXVsYXIgdmFsb3Igbm8gTDFcbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2V0KGtleSwgdmFsdWUsIDYwMDAwLCAnbWVkaXVtJyk7XG4gICAgICBcbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXQoa2V5KTtcbiAgICAgIFxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHZhbHVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGJ1c2NhciBubyBjYWNoZSBMMiBxdWFuZG8gTDEgbWlzcyBlIEwyIGRpc3BvbsOtdmVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIGNvbnN0IHZhbHVlID0geyBkYXRhOiAndGVzdC12YWx1ZScgfTtcbiAgICAgIFxuICAgICAgaGVhbHRoQ2hlY2tTZXJ2aWNlLmlzUmVkaXNBdmFpbGFibGUubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKHZhbHVlKTtcbiAgICAgIFxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldChrZXkpO1xuICAgICAgXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodmFsdWUpO1xuICAgICAgZXhwZWN0KGNhY2hlU2VydmljZS5nZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGtleSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBudWxsIHF1YW5kbyBuw6NvIGVuY29udHJhZG8gZW0gbmVuaHVtIGNhY2hlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIFxuICAgICAgaGVhbHRoQ2hlY2tTZXJ2aWNlLmlzUmVkaXNBdmFpbGFibGUubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0KGtleSk7XG4gICAgICBcbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGZ1bmNpb25hciBhcGVuYXMgY29tIEwxIHF1YW5kbyBMMiBpbmRpc3BvbsOtdmVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIGNvbnN0IHZhbHVlID0geyBkYXRhOiAndGVzdC12YWx1ZScgfTtcbiAgICAgIFxuICAgICAgaGVhbHRoQ2hlY2tTZXJ2aWNlLmlzUmVkaXNBdmFpbGFibGUubW9ja1Jlc29sdmVkVmFsdWUoZmFsc2UpO1xuICAgICAgXG4gICAgICAvLyBBZGljaW9uYXIgYW8gTDFcbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2V0KGtleSwgdmFsdWUsIDYwMDAwLCAnbWVkaXVtJyk7XG4gICAgICBcbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXQoa2V5KTtcbiAgICAgIFxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHZhbHVlKTtcbiAgICAgIGV4cGVjdChjYWNoZVNlcnZpY2UuZ2V0KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2V0JywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGFybWF6ZW5hciBubyBjYWNoZSBMMScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0LWtleSc7XG4gICAgICBjb25zdCB2YWx1ZSA9IHsgZGF0YTogJ3Rlc3QtdmFsdWUnIH07XG4gICAgICBcbiAgICAgIGhlYWx0aENoZWNrU2VydmljZS5pc1JlZGlzQXZhaWxhYmxlLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgICAgXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2V0KGtleSwgdmFsdWUsIDYwMDAwLCAnbWVkaXVtJyk7XG4gICAgICBcbiAgICAgIC8vIEFzc2VydFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXQoa2V5KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodmFsdWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgYXJtYXplbmFyIG5vIGNhY2hlIEwyIHF1YW5kbyBkaXNwb27DrXZlbCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0LWtleSc7XG4gICAgICBjb25zdCB2YWx1ZSA9IHsgZGF0YTogJ3Rlc3QtdmFsdWUnIH07XG4gICAgICBcbiAgICAgIGhlYWx0aENoZWNrU2VydmljZS5pc1JlZGlzQXZhaWxhYmxlLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgICAgY2FjaGVTZXJ2aWNlLnNldC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuICAgICAgXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2V0KGtleSwgdmFsdWUsIDYwMDAwLCAnbWVkaXVtJyk7XG4gICAgICBcbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGNhY2hlU2VydmljZS5zZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBrZXksXG4gICAgICAgIHZhbHVlLFxuICAgICAgICA2MDAwMFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGZ1bmNpb25hciBhcGVuYXMgY29tIEwxIHF1YW5kbyBMMiBpbmRpc3BvbsOtdmVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIGNvbnN0IHZhbHVlID0geyBkYXRhOiAndGVzdC12YWx1ZScgfTtcbiAgICAgIFxuICAgICAgaGVhbHRoQ2hlY2tTZXJ2aWNlLmlzUmVkaXNBdmFpbGFibGUubW9ja1Jlc29sdmVkVmFsdWUoZmFsc2UpO1xuICAgICAgXG4gICAgICAvLyBBY3RcbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2V0KGtleSwgdmFsdWUsIDYwMDAwLCAnbWVkaXVtJyk7XG4gICAgICBcbiAgICAgIC8vIEFzc2VydFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXQoa2V5KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodmFsdWUpO1xuICAgICAgZXhwZWN0KGNhY2hlU2VydmljZS5zZXQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdkZWwnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmVtb3ZlciBkbyBjYWNoZSBMMScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0LWtleSc7XG4gICAgICBjb25zdCB2YWx1ZSA9IHsgZGF0YTogJ3Rlc3QtdmFsdWUnIH07XG4gICAgICBcbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2V0KGtleSwgdmFsdWUsIDYwMDAwLCAnbWVkaXVtJyk7XG4gICAgICBcbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgc2VydmljZS5kZWwoa2V5KTtcbiAgICAgIFxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldChrZXkpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJlbW92ZXIgZG8gY2FjaGUgTDIgcXVhbmRvIGRpc3BvbsOtdmVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIFxuICAgICAgaGVhbHRoQ2hlY2tTZXJ2aWNlLmlzUmVkaXNBdmFpbGFibGUubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgICBjYWNoZVNlcnZpY2UuZGVsLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG4gICAgICBcbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgc2VydmljZS5kZWwoa2V5KTtcbiAgICAgIFxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoY2FjaGVTZXJ2aWNlLmRlbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoa2V5KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hhcycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSByZXRvcm5hciB0cnVlIHF1YW5kbyBjaGF2ZSBleGlzdGUgbm8gTDEnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBrZXkgPSAndGVzdC1rZXknO1xuICAgICAgY29uc3QgdmFsdWUgPSB7IGRhdGE6ICd0ZXN0LXZhbHVlJyB9O1xuICAgICAgXG4gICAgICBhd2FpdCBzZXJ2aWNlLnNldChrZXksIHZhbHVlLCA2MDAwMCwgJ21lZGl1bScpO1xuICAgICAgXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuaGFzKGtleSk7XG4gICAgICBcbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHZlcmlmaWNhciBubyBMMiBxdWFuZG8gbsOjbyBleGlzdGUgbm8gTDEnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBrZXkgPSAndGVzdC1rZXknO1xuICAgICAgXG4gICAgICBoZWFsdGhDaGVja1NlcnZpY2UuaXNSZWRpc0F2YWlsYWJsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIGNhY2hlU2VydmljZS5oYXMubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgICBcbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5oYXMoa2V5KTtcbiAgICAgIFxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGNhY2hlU2VydmljZS5oYXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGtleSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBmYWxzZSBxdWFuZG8gbsOjbyBleGlzdGUgZW0gbmVuaHVtIGNhY2hlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIFxuICAgICAgaGVhbHRoQ2hlY2tTZXJ2aWNlLmlzUmVkaXNBdmFpbGFibGUubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgICBjYWNoZVNlcnZpY2UuaGFzLm1vY2tSZXNvbHZlZFZhbHVlKGZhbHNlKTtcbiAgICAgIFxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmhhcyhrZXkpO1xuICAgICAgXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0T3JTZXQnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgdmFsb3IgZXhpc3RlbnRlIGRvIGNhY2hlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIGNvbnN0IHZhbHVlID0geyBkYXRhOiAnY2FjaGVkLXZhbHVlJyB9O1xuICAgICAgY29uc3QgZmFjdG9yeSA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGRhdGE6ICduZXctdmFsdWUnIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCBzZXJ2aWNlLnNldChrZXksIHZhbHVlLCA2MDAwMCwgJ21lZGl1bScpO1xuICAgICAgXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0T3JTZXQoa2V5LCBmYWN0b3J5LCA2MDAwMCwgJ21lZGl1bScpO1xuICAgICAgXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwodmFsdWUpO1xuICAgICAgZXhwZWN0KGZhY3RvcnkpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBleGVjdXRhciBmYWN0b3J5IGUgYXJtYXplbmFyIHF1YW5kbyB2YWxvciBuw6NvIGV4aXN0ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0LWtleSc7XG4gICAgICBjb25zdCBuZXdWYWx1ZSA9IHsgZGF0YTogJ25ldy12YWx1ZScgfTtcbiAgICAgIGNvbnN0IGZhY3RvcnkgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobmV3VmFsdWUpO1xuICAgICAgXG4gICAgICBoZWFsdGhDaGVja1NlcnZpY2UuaXNSZWRpc0F2YWlsYWJsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBcbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRPclNldChrZXksIGZhY3RvcnksIDYwMDAwLCAnbWVkaXVtJyk7XG4gICAgICBcbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChuZXdWYWx1ZSk7XG4gICAgICBleHBlY3QoZmFjdG9yeSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXZpY3Rpb24nLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmVtb3ZlciBlbnRyYWRhcyBleHBpcmFkYXMgZHVyYW50ZSBsaW1wZXphJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5MSA9ICdleHBpcmVkLWtleSc7XG4gICAgICBjb25zdCBrZXkyID0gJ3ZhbGlkLWtleSc7XG4gICAgICBjb25zdCB2YWx1ZTEgPSAndmFsdWUxJztcbiAgICAgIGNvbnN0IHZhbHVlMiA9ICd2YWx1ZTInO1xuICAgICAgXG4gICAgICAvLyBTaW11bGFyIGVudHJhZGEgZXhwaXJhZGFcbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2V0KGtleTEsIHZhbHVlMSwgLTEwMDAsICdsb3cnKTsgLy8gVFRMIG5lZ2F0aXZvID0gZXhwaXJhZG9cbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2V0KGtleTIsIHZhbHVlMiwgNjAwMDAsICdtZWRpdW0nKTtcbiAgICAgIFxuICAgICAgLy8gQWN0XG4gICAgICBhd2FpdCBzZXJ2aWNlWydjbGVhbnVwRXhwaXJlZENhY2hlJ10oKTtcbiAgICAgIFxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QoYXdhaXQgc2VydmljZS5nZXQoa2V5MSkpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QoYXdhaXQgc2VydmljZS5nZXQoa2V5MikpLnRvQmUodmFsdWUyKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ23DqXRyaWNhcycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBjYWxjdWxhciBtw6l0cmljYXMgY29ycmV0YW1lbnRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3Qga2V5ID0gJ3Rlc3Qta2V5JztcbiAgICAgIGNvbnN0IHZhbHVlID0geyBkYXRhOiAndGVzdC12YWx1ZScgfTtcbiAgICAgIFxuICAgICAgaGVhbHRoQ2hlY2tTZXJ2aWNlLmlzUmVkaXNBdmFpbGFibGUubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSk7XG4gICAgICBjYWNoZVNlcnZpY2UuZ2V0Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgXG4gICAgICAvLyBTaW11bGFyIGFsZ3VtYXMgb3BlcmHDp8O1ZXNcbiAgICAgIGF3YWl0IHNlcnZpY2UuZ2V0KGtleSk7IC8vIEwxIG1pc3MsIEwyIG1pc3NcbiAgICAgIGF3YWl0IHNlcnZpY2Uuc2V0KGtleSwgdmFsdWUsIDYwMDAwLCAnbWVkaXVtJyk7XG4gICAgICBhd2FpdCBzZXJ2aWNlLmdldChrZXkpOyAvLyBMMSBoaXRcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCBtZXRyaWNzID0gc2VydmljZS5nZXRNZXRyaWNzKCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1ldHJpY3MubDFIaXRzKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KG1ldHJpY3MubDFNaXNzZXMpLnRvQmUoMSk7XG4gICAgICBleHBlY3QobWV0cmljcy5sMk1pc3NlcykudG9CZSgxKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLmwxSGl0UmF0ZSkudG9CZSg1MCk7XG4gICAgICBleHBlY3QobWV0cmljcy5vdmVyYWxsSGl0UmF0ZSkudG9CZUNsb3NlVG8oMzMuMzMsIDIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVzZXRhciBtw6l0cmljYXMgY29ycmV0YW1lbnRlJywgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZSAtIHNpbXVsYXIgYWxndW1hcyBvcGVyYcOnw7Vlc1xuICAgICAgc2VydmljZVsnbWV0cmljcyddID0ge1xuICAgICAgICBsMUhpdHM6IDEwLFxuICAgICAgICBsMU1pc3NlczogNSxcbiAgICAgICAgbDJIaXRzOiAzLFxuICAgICAgICBsMk1pc3NlczogMixcbiAgICAgICAgZXZpY3Rpb25zOiAxLFxuICAgICAgICB3YXJtaW5nT3BlcmF0aW9uczogMixcbiAgICAgICAgZmFpbG92ZXJzOiAxXG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBBY3RcbiAgICAgIHNlcnZpY2UucmVzZXRNZXRyaWNzKCk7XG4gICAgICBcbiAgICAgIC8vIEFzc2VydFxuICAgICAgY29uc3QgbWV0cmljcyA9IHNlcnZpY2UuZ2V0TWV0cmljcygpO1xuICAgICAgZXhwZWN0KG1ldHJpY3MubDFIaXRzKS50b0JlKDApO1xuICAgICAgZXhwZWN0KG1ldHJpY3MubDFNaXNzZXMpLnRvQmUoMCk7XG4gICAgICBleHBlY3QobWV0cmljcy5sMkhpdHMpLnRvQmUoMCk7XG4gICAgICBleHBlY3QobWV0cmljcy5sMk1pc3NlcykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLmV2aWN0aW9ucykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLndhcm1pbmdPcGVyYXRpb25zKS50b0JlKDApO1xuICAgICAgZXhwZWN0KG1ldHJpY3MuZmFpbG92ZXJzKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2xlYXInLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgbGltcGFyIHRvZG9zIG9zIGNhY2hlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGtleTEgPSAna2V5MSc7XG4gICAgICBjb25zdCBrZXkyID0gJ2tleTInO1xuICAgICAgY29uc3QgdmFsdWUxID0gJ3ZhbHVlMSc7XG4gICAgICBjb25zdCB2YWx1ZTIgPSAndmFsdWUyJztcbiAgICAgIFxuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5MSwgdmFsdWUxLCA2MDAwMCwgJ21lZGl1bScpO1xuICAgICAgYXdhaXQgc2VydmljZS5zZXQoa2V5MiwgdmFsdWUyLCA2MDAwMCwgJ21lZGl1bScpO1xuICAgICAgXG4gICAgICBoZWFsdGhDaGVja1NlcnZpY2UuaXNSZWRpc0F2YWlsYWJsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIFxuICAgICAgLy8gQWN0XG4gICAgICBhd2FpdCBzZXJ2aWNlLmNsZWFyKCk7XG4gICAgICBcbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KGF3YWl0IHNlcnZpY2UuZ2V0KGtleTEpKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICBleHBlY3QoYXdhaXQgc2VydmljZS5nZXQoa2V5MikpLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3dhcm1pbmcnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgYXF1ZWNlciBjYWNoZSBjb20gY2hhdmVzIGNyw610aWNhcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGNyaXRpY2FsS2V5ID0gJ2NyaXRpY2FsLWtleSc7XG4gICAgICBjb25zdCB2YWx1ZSA9IHsgZGF0YTogJ2NyaXRpY2FsLXZhbHVlJyB9O1xuICAgICAgXG4gICAgICAvLyBNYXJjYXIgY29tbyBjcsOtdGljYVxuICAgICAgYXdhaXQgc2VydmljZS5zZXQoY3JpdGljYWxLZXksIHZhbHVlLCA2MDAwMCwgJ2NyaXRpY2FsJyk7XG4gICAgICBcbiAgICAgIC8vIFNpbXVsYXIgcXVlIG7Do28gZXN0w6Egbm8gTDEgbWFzIGVzdMOhIG5vIEwyXG4gICAgICBzZXJ2aWNlWydsMUNhY2hlJ10uY2xlYXIoKTtcbiAgICAgIGhlYWx0aENoZWNrU2VydmljZS5pc1JlZGlzQXZhaWxhYmxlLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVzb2x2ZWRWYWx1ZSh2YWx1ZSk7XG4gICAgICBcbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgc2VydmljZVsncGVyZm9ybUNhY2hlV2FybWluZyddKCk7XG4gICAgICBcbiAgICAgIC8vIEFzc2VydFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXQoY3JpdGljYWxLZXkpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh2YWx1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdlcnJvciBoYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBsaWRhciBjb20gZXJyb3MgZG8gTDIgZ3JhY2lvc2FtZW50ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGtleSA9ICd0ZXN0LWtleSc7XG4gICAgICBcbiAgICAgIGhlYWx0aENoZWNrU2VydmljZS5pc1JlZGlzQXZhaWxhYmxlLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgICAgY2FjaGVTZXJ2aWNlLmdldC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1JlZGlzIGVycm9yJykpO1xuICAgICAgXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0KGtleSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgICAgXG4gICAgICAvLyBWZXJpZmljYXIgc2UgZXJybyBmb2kgcmVnaXN0cmFkbyBuYXMgbcOpdHJpY2FzXG4gICAgICAgY29uc3QgbWV0cmljcyA9IHNlcnZpY2UuZ2V0TWV0cmljcygpO1xuICAgICAgIGV4cGVjdChtZXRyaWNzLmZhaWxvdmVycykudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgY29udGludWFyIGZ1bmNpb25hbmRvIGNvbSBMMSBxdWFuZG8gTDIgZmFsaGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBrZXkgPSAndGVzdC1rZXknO1xuICAgICAgY29uc3QgdmFsdWUgPSB7IGRhdGE6ICd0ZXN0LXZhbHVlJyB9O1xuICAgICAgXG4gICAgICBoZWFsdGhDaGVja1NlcnZpY2UuaXNSZWRpc0F2YWlsYWJsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIGNhY2hlU2VydmljZS5zZXQubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdSZWRpcyBlcnJvcicpKTtcbiAgICAgIFxuICAgICAgLy8gQWN0XG4gICAgICBhd2FpdCBzZXJ2aWNlLnNldChrZXksIHZhbHVlLCA2MDAwMCwgJ21lZGl1bScpO1xuICAgICAgXG4gICAgICAvLyBBc3NlcnQgLSBkZXZlIGZ1bmNpb25hciBjb20gTDFcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0KGtleSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHZhbHVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ByaW9yaXR5IGhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHRyYXRhciBwcmlvcmlkYWRlcyBjb3JyZXRhbWVudGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBjcml0aWNhbEtleSA9ICdjcml0aWNhbC1rZXknO1xuICAgICAgY29uc3QgbG93S2V5ID0gJ2xvdy1rZXknO1xuICAgICAgY29uc3QgdmFsdWUgPSB7IGRhdGE6ICd0ZXN0JyB9O1xuICAgICAgY29uc3QgZmFjdG9yeSA9IGFzeW5jICgpID0+IHZhbHVlO1xuICAgICAgXG4gICAgICAvLyBBY3RcbiAgICAgIHNlcnZpY2UucmVnaXN0ZXJDcml0aWNhbEtleShjcml0aWNhbEtleSwgZmFjdG9yeSk7XG4gICAgICBhd2FpdCBzZXJ2aWNlLmdldE9yU2V0KGxvd0tleSwgZmFjdG9yeSwgNjAwMDAsICdsb3cnKTtcbiAgICAgIFxuICAgICAgLy8gQXNzZXJ0IC0gY2hhdmUgY3LDrXRpY2EgZGV2ZSBlc3RhciBtYXJjYWRhXG4gICAgICBleHBlY3Qoc2VydmljZVsnY3JpdGljYWxLZXlzJ10uaGFzKGNyaXRpY2FsS2V5KSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlWydjcml0aWNhbEtleXMnXS5oYXMobG93S2V5KSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjb25jdXJyZW50IG9wZXJhdGlvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgbGlkYXIgY29tIG9wZXJhw6fDtWVzIGNvbmNvcnJlbnRlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGtleSA9ICdjb25jdXJyZW50LWtleSc7XG4gICAgICBjb25zdCBmYWN0b3J5ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogJ2ZhY3RvcnktdmFsdWUnIH0pO1xuICAgICAgXG4gICAgICBoZWFsdGhDaGVja1NlcnZpY2UuaXNSZWRpc0F2YWlsYWJsZS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICAgIGNhY2hlU2VydmljZS5nZXQubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBcbiAgICAgIC8vIEFjdCAtIG3Dumx0aXBsYXMgY2hhbWFkYXMgc2ltdWx0w6JuZWFzXG4gICAgICBjb25zdCBwcm9taXNlcyA9IFtcbiAgICAgICAgc2VydmljZS5nZXRPclNldChrZXksIGZhY3RvcnksIDYwMDAwLCAnbWVkaXVtJyksXG4gICAgICAgIHNlcnZpY2UuZ2V0T3JTZXQoa2V5LCBmYWN0b3J5LCA2MDAwMCwgJ21lZGl1bScpLFxuICAgICAgICBzZXJ2aWNlLmdldE9yU2V0KGtleSwgZmFjdG9yeSwgNjAwMDAsICdtZWRpdW0nKVxuICAgICAgXTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTtcbiAgICAgIFxuICAgICAgLy8gQXNzZXJ0IC0gZmFjdG9yeSBkZXZlIHNlciBjaGFtYWRvIGFwZW5hcyB1bWEgdmV6XG4gICAgICBleHBlY3QoZmFjdG9yeSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgcmVzdWx0cy5mb3JFYWNoKHJlc3VsdCA9PiB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoeyBkYXRhOiAnZmFjdG9yeS12YWx1ZScgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=