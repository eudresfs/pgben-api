{"file":"C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\entities\\usuario.entity.ts","mappings":"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","names":[],"sources":["C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\entities\\usuario.entity.ts"],"sourcesContent":["import {\n  Entity,\n  PrimaryGeneratedColumn,\n  Column,\n  CreateDateColumn,\n  UpdateDateColumn,\n  DeleteDateColumn,\n  OneToMany,\n  ManyToOne,\n  JoinColumn,\n  Index,\n} from 'typeorm';\nimport { Exclude } from 'class-transformer';\nimport { RefreshToken } from './refresh-token.entity';\nimport { Unidade } from './unidade.entity';\nimport { Setor } from './setor.entity';\nimport { IsCPF, IsTelefone } from '../shared/validators/br-validators';\nimport {\n  IsNotEmpty,\n  IsString,\n  Length,\n  MaxLength,\n  MinLength,\n  Validate,\n  IsEmail,\n  IsEnum,\n  IsOptional,\n  IsBoolean,\n} from 'class-validator';\nimport { IsStrongPassword } from '../shared/validators/strong-password.validator';\nimport { Role } from './role.entity';\nimport { Status } from '../enums/status.enum';\n\n/**\n * Entidade de Usuário\n *\n * Representa um usuário do sistema com suas informações básicas,\n * credenciais de acesso e relacionamentos com outras entidades.\n */\n@Entity('usuario')\n@Index(['email'], { unique: true })\n@Index(['cpf'], { unique: true })\n@Index(['matricula'], { unique: true })\n@Index(['status'])\n@Index(['role_id'])\n@Index(['unidade_id'])\nexport class Usuario {\n  @PrimaryGeneratedColumn('uuid')\n  id: string;\n\n  @Column({ length: 255 })\n  @IsNotEmpty({ message: 'Nome é obrigatório' })\n  @IsString({ message: 'Nome deve ser uma string' })\n  @MinLength(2, { message: 'Nome deve ter no mínimo 2 caracteres' })\n  @MaxLength(255, { message: 'Nome deve ter no máximo 255 caracteres' })\n  nome: string;\n\n  @Column({ unique: true, length: 255 })\n  @IsNotEmpty({ message: 'Email é obrigatório' })\n  @IsEmail({}, { message: 'Email deve ter um formato válido' })\n  @MaxLength(255, { message: 'Email deve ter no máximo 255 caracteres' })\n  email: string;\n\n  @Column({ name: 'senha_hash' })\n  @Exclude()\n  @IsNotEmpty({ message: 'Senha é obrigatória' })\n  @IsString({ message: 'Senha deve ser uma string' })\n  @Validate(IsStrongPassword, {\n    message:\n      'Senha deve ter no mínimo 8 caracteres, incluindo maiúscula, minúscula, número e caractere especial',\n  })\n  senhaHash: string;\n\n  @Column({ unique: true, length: 11 })\n  @IsNotEmpty({ message: 'CPF é obrigatório' })\n  @IsString({ message: 'CPF deve ser uma string' })\n  @Length(11, 11, { message: 'CPF deve ter exatamente 11 caracteres' })\n  @Validate(IsCPF, { message: 'CPF inválido' })\n  cpf: string;\n\n  @Column({ nullable: true, length: 15 })\n  @IsOptional()\n  @IsString({ message: 'Telefone deve ser uma string' })\n  @MaxLength(15, { message: 'Telefone deve ter no máximo 15 caracteres' })\n  @Validate(IsTelefone, { message: 'Telefone inválido' })\n  telefone?: string;\n\n  @Column({ unique: true, length: 20 })\n  @IsNotEmpty({ message: 'Matrícula é obrigatória' })\n  @IsString({ message: 'Matrícula deve ser uma string' })\n  @MinLength(3, { message: 'Matrícula deve ter no mínimo 3 caracteres' })\n  @MaxLength(20, { message: 'Matrícula deve ter no máximo 20 caracteres' })\n  matricula: string;\n\n  @Column({ name: 'role_id', nullable: true })\n  role_id: string;\n\n  @ManyToOne(() => Role, (role) => role.usuarios, {\n    nullable: false,\n    eager: false,\n  })\n  @JoinColumn({ name: 'role_id' })\n  role: Role;\n\n  @Column({ name: 'unidade_id', nullable: true })\n  unidade_id: string;\n\n  @ManyToOne(() => Unidade, (unidade) => unidade.usuarios, {\n    nullable: true,\n    eager: false,\n  })\n  @JoinColumn({ name: 'unidade_id' })\n  unidade: Unidade;\n\n  @Column({ name: 'setor_id', nullable: true })\n  setor_id: string;\n\n  @ManyToOne(() => Setor, (setor) => setor.usuarios, {\n    nullable: true,\n    eager: false,\n  })\n  @JoinColumn({ name: 'setor_id' })\n  setor: Setor;\n\n  @Column({\n    type: 'enum',\n    enum: Status,\n    default: Status.ATIVO,\n    enumName: 'status_usuario',\n  })\n  @IsOptional()\n  @IsEnum(Status, { message: 'Status deve ser ATIVO ou INATIVO' })\n  status: Status;\n\n  @Column({ name: 'primeiro_acesso', default: true })\n  @IsOptional()\n  @IsBoolean({ message: 'Primeiro acesso deve ser um valor booleano' })\n  primeiro_acesso: boolean;\n\n  @Column({ name: 'tentativas_login', default: 0 })\n  @IsOptional()\n  tentativas_login: number;\n\n  @Column({ name: 'ultimo_login', nullable: true })\n  @IsOptional()\n  ultimo_login: Date;\n\n  @OneToMany(() => RefreshToken, (refreshToken) => refreshToken.usuario, {\n    cascade: ['remove'],\n    lazy: true,\n  })\n  refreshTokens: RefreshToken[];\n\n  @CreateDateColumn({ name: 'created_at' })\n  created_at: Date;\n\n  @UpdateDateColumn({ name: 'updated_at' })\n  updated_at: Date;\n\n  @DeleteDateColumn({ name: 'removed_at' })\n  removed_at: Date;\n\n  /**\n   * Verifica se o usuário está ativo\n   * @returns true se o usuário estiver ativo\n   */\n  isAtivo(): boolean {\n    return this.status === Status.ATIVO;\n  }\n\n  /**\n   * Ativa o usuário\n   */\n  ativar(): void {\n    this.status = Status.ATIVO;\n  }\n\n  /**\n   * Desativa o usuário\n   */\n  desativar(): void {\n    this.status = Status.INATIVO;\n  }\n\n  /**\n   * Verifica se é o primeiro acesso do usuário\n   * @returns true se for o primeiro acesso\n   */\n  isPrimeiroAcesso(): boolean {\n    return this.primeiro_acesso;\n  }\n\n  /**\n   * Marca que o usuário já fez o primeiro acesso\n   */\n  marcarPrimeiroAcessoRealizado(): void {\n    this.primeiro_acesso = false;\n  }\n\n  /**\n   * Obtém o nome completo formatado\n   * @returns nome formatado\n   */\n  getNomeFormatado(): string {\n    return this.nome.trim();\n  }\n\n  /**\n   * Verifica se o usuário pode ser deletado\n   * @returns true se pode ser deletado\n   */\n  podeSerDeletado(): boolean {\n    return this.status === Status.INATIVO;\n  }\n}\n"],"version":3}