f2fb6276fa92c182ce582b495add51d7
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var PdfStrategy_1;
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.PdfStrategy = void 0;
const common_1 = require("@nestjs/common");
const pdfkit_1 = __importDefault(require("pdfkit"));
const fs = __importStar(require("fs"));
const temp_files_service_1 = require("../services/temp-files.service");
/**
 * Estratégia de geração de relatórios em formato PDF
 *
 * Implementa a geração de relatórios em formato PDF usando PDFKit
 */
let PdfStrategy = PdfStrategy_1 = class PdfStrategy {
    tempFilesService;
    logger = new common_1.Logger(PdfStrategy_1.name);
    constructor(tempFilesService) {
        this.tempFilesService = tempFilesService;
    }
    /**
     * Gera um relatório em formato PDF
     * @param tipo Tipo de relatório
     * @param dados Dados do relatório
     * @param opcoes Opções de configuração
     * @returns Buffer contendo o PDF gerado
     */
    async gerar(tipo, dados, opcoes) {
        this.logger.log(`Gerando relatório PDF do tipo: ${tipo}`);
        // Criar arquivo temporário
        const tempFilePath = this.tempFilesService.getTempFilePath('relatorio-pdf', 'pdf');
        try {
            // Criar documento PDF
            const doc = new pdfkit_1.default({
                margin: 50,
                size: 'A4',
            });
            // Conectar stream do PDF ao arquivo temporário
            const stream = fs.createWriteStream(tempFilePath);
            doc.pipe(stream);
            // Adicionar título
            doc
                .fontSize(20)
                .font('Helvetica-Bold')
                .text(this.getTitulo(tipo), { align: 'center' });
            doc.moveDown();
            // Adicionar período
            if (opcoes.dataInicio && opcoes.dataFim) {
                const dataInicio = new Date(opcoes.dataInicio).toLocaleDateString('pt-BR');
                const dataFim = new Date(opcoes.dataFim).toLocaleDateString('pt-BR');
                doc
                    .fontSize(12)
                    .font('Helvetica')
                    .text(`Período: ${dataInicio} a ${dataFim}`, { align: 'center' });
                doc.moveDown(2);
            }
            // Adicionar conteúdo específico conforme o tipo de relatório
            switch (tipo) {
                case 'beneficios-concedidos':
                    await this.gerarBeneficiosConcedidos(doc, dados, opcoes);
                    break;
                case 'solicitacoes-por-status':
                    await this.gerarSolicitacoesPorStatus(doc, dados, opcoes);
                    break;
                case 'atendimentos-por-unidade':
                    await this.gerarAtendimentosPorUnidade(doc, dados, opcoes);
                    break;
                default:
                    doc
                        .fontSize(12)
                        .font('Helvetica')
                        .text('Tipo de relatório não implementado');
            }
            // Adicionar rodapé com data de geração
            const pageCount = doc.bufferedPageRange().count;
            for (let i = 0; i < pageCount; i++) {
                doc.switchToPage(i);
                doc
                    .fontSize(8)
                    .font('Helvetica')
                    .text(`Gerado em: ${new Date().toLocaleString('pt-BR')} - Página ${i + 1} de ${pageCount}`, 50, doc.page.height - 50, { align: 'center' });
            }
            // Finalizar documento
            doc.end();
            // Aguardar finalização da gravação
            return new Promise((resolve, reject) => {
                stream.on('finish', () => {
                    try {
                        const buffer = this.tempFilesService.readAndRemove(tempFilePath);
                        resolve(buffer);
                    }
                    catch (error) {
                        reject(error);
                    }
                });
                stream.on('error', (error) => {
                    reject(error);
                });
            });
        }
        catch (error) {
            this.logger.error(`Erro ao gerar relatório PDF: ${error.message}`);
            // Tentar limpar arquivo temporário em caso de erro
            try {
                if (fs.existsSync(tempFilePath)) {
                    fs.unlinkSync(tempFilePath);
                }
            }
            catch (cleanupError) {
                this.logger.warn(`Erro ao limpar arquivo temporário: ${cleanupError.message}`);
            }
            throw error;
        }
    }
    /**
     * Retorna o tipo MIME para arquivos PDF
     */
    getMimeType() {
        return 'application/pdf';
    }
    /**
     * Retorna a extensão para arquivos PDF
     */
    getExtensao() {
        return 'pdf';
    }
    /**
     * Retorna o título do relatório com base no tipo
     * @param tipo Tipo de relatório
     * @returns Título formatado
     */
    getTitulo(tipo) {
        switch (tipo) {
            case 'beneficios-concedidos':
                return 'Relatório de Benefícios Concedidos';
            case 'solicitacoes-por-status':
                return 'Relatório de Solicitações por Status';
            case 'atendimentos-por-unidade':
                return 'Relatório de Atendimentos por Unidade';
            default:
                return 'Relatório';
        }
    }
    /**
     * Gera conteúdo para relatório de benefícios concedidos
     * @param doc Documento PDF
     * @param dados Dados para o relatório
     * @param opcoes Opções de configuração
     */
    async gerarBeneficiosConcedidos(doc, dados, opcoes) {
        // Adicionar cabeçalho da tabela
        this.desenharCabecalhoTabela(doc, [
            'Protocolo',
            'Beneficiário',
            'Benefício',
            'Unidade',
            'Data Liberação',
        ]);
        // Adicionar linhas da tabela
        let alturaLinha = 160;
        const alturaMaxima = doc.page.height - 100;
        for (const solicitacao of dados) {
            // Verificar se precisa adicionar nova página
            if (alturaLinha > alturaMaxima) {
                doc.addPage();
                alturaLinha = 100;
                this.desenharCabecalhoTabela(doc, [
                    'Protocolo',
                    'Beneficiário',
                    'Benefício',
                    'Unidade',
                    'Data Liberação',
                ]);
            }
            // Desenhar linha
            doc
                .font('Helvetica')
                .fontSize(10)
                .text(solicitacao.protocolo || '', 50, alturaLinha, { width: 80 })
                .text(solicitacao.beneficiario?.nome || 'N/A', 130, alturaLinha, {
                width: 150,
            })
                .text(solicitacao.tipo_beneficio?.nome || 'N/A', 280, alturaLinha, {
                width: 100,
            })
                .text(solicitacao.unidade?.nome || 'N/A', 380, alturaLinha, {
                width: 100,
            })
                .text(solicitacao.data_liberacao
                ? new Date(solicitacao.data_liberacao).toLocaleDateString('pt-BR')
                : 'N/A', 480, alturaLinha);
            alturaLinha += 20;
        }
        // Adicionar resumo
        doc.moveDown(2);
        doc
            .font('Helvetica-Bold')
            .fontSize(12)
            .text(`Total de benefícios concedidos: ${dados.length}`);
    }
    /**
     * Gera conteúdo para relatório de solicitações por status
     * @param doc Documento PDF
     * @param dados Dados para o relatório
     * @param opcoes Opções de configuração
     */
    async gerarSolicitacoesPorStatus(doc, dados, opcoes) {
        const statusList = Object.keys(dados);
        // Adicionar resumo
        doc
            .font('Helvetica-Bold')
            .fontSize(12)
            .text('Resumo por Status:', { underline: true });
        doc.moveDown();
        let totalGeral = 0;
        for (const status of statusList) {
            const quantidade = dados[status].length;
            totalGeral += quantidade;
            doc
                .font('Helvetica')
                .fontSize(10)
                .text(`${status}: ${quantidade} solicitações`);
        }
        doc.moveDown();
        doc
            .font('Helvetica-Bold')
            .fontSize(10)
            .text(`Total Geral: ${totalGeral} solicitações`);
        doc.moveDown(2);
        // Adicionar detalhamento por status
        for (const status of statusList) {
            doc.addPage();
            doc
                .font('Helvetica-Bold')
                .fontSize(14)
                .text(`Solicitações com Status: ${status}`, { align: 'center' });
            doc.moveDown();
            // Adicionar cabeçalho da tabela
            this.desenharCabecalhoTabela(doc, [
                'Protocolo',
                'Beneficiário',
                'Benefício',
                'Unidade',
                'Data Abertura',
            ]);
            // Adicionar linhas da tabela
            let alturaLinha = 160;
            const alturaMaxima = doc.page.height - 100;
            for (const solicitacao of dados[status]) {
                // Verificar se precisa adicionar nova página
                if (alturaLinha > alturaMaxima) {
                    doc.addPage();
                    alturaLinha = 100;
                    this.desenharCabecalhoTabela(doc, [
                        'Protocolo',
                        'Beneficiário',
                        'Benefício',
                        'Unidade',
                        'Data Abertura',
                    ]);
                }
                // Desenhar linha
                doc
                    .font('Helvetica')
                    .fontSize(10)
                    .text(solicitacao.protocolo || '', 50, alturaLinha, { width: 80 })
                    .text(solicitacao.beneficiario?.nome || 'N/A', 130, alturaLinha, {
                    width: 150,
                })
                    .text(solicitacao.tipo_beneficio?.nome || 'N/A', 280, alturaLinha, {
                    width: 100,
                })
                    .text(solicitacao.unidade?.nome || 'N/A', 380, alturaLinha, {
                    width: 100,
                })
                    .text(solicitacao.data_abertura
                    ? new Date(solicitacao.data_abertura).toLocaleDateString('pt-BR')
                    : 'N/A', 480, alturaLinha);
                alturaLinha += 20;
            }
        }
    }
    /**
     * Gera conteúdo para relatório de atendimentos por unidade
     * @param doc Documento PDF
     * @param dados Dados para o relatório
     * @param opcoes Opções de configuração
     */
    async gerarAtendimentosPorUnidade(doc, dados, opcoes) {
        // Adicionar cabeçalho da tabela
        this.desenharCabecalhoTabela(doc, [
            'Unidade',
            'Total Solicit.',
            'Liberadas',
            'Pendentes',
            'Taxa Aprovação',
        ]);
        // Adicionar linhas da tabela
        let alturaLinha = 160;
        const alturaMaxima = doc.page.height - 100;
        for (const item of dados) {
            const taxaAprovacao = item.totalSolicitacoes > 0
                ? ((item.solicitacoesLiberadas / item.totalSolicitacoes) *
                    100).toFixed(2)
                : '0.00';
            // Desenhar linha
            doc
                .font('Helvetica')
                .fontSize(10)
                .text(item.unidade.nome || 'N/A', 50, alturaLinha, { width: 150 })
                .text(item.totalSolicitacoes.toString(), 200, alturaLinha, {
                width: 80,
            })
                .text(item.solicitacoesLiberadas.toString(), 280, alturaLinha, {
                width: 80,
            })
                .text(item.solicitacoesPendentes.toString(), 360, alturaLinha, {
                width: 80,
            })
                .text(`${taxaAprovacao}%`, 440, alturaLinha, { width: 80 });
            alturaLinha += 20;
        }
        // Adicionar totais
        doc.moveDown(2);
        const totais = dados.reduce((acc, item) => {
            acc.total += item.totalSolicitacoes;
            acc.liberadas += item.solicitacoesLiberadas;
            acc.pendentes += item.solicitacoesPendentes;
            return acc;
        }, { total: 0, liberadas: 0, pendentes: 0 });
        const taxaGeral = totais.total > 0
            ? ((totais.liberadas / totais.total) * 100).toFixed(2)
            : '0.00';
        doc
            .font('Helvetica-Bold')
            .fontSize(12)
            .text(`Total Geral: ${totais.total} solicitações`);
        doc
            .font('Helvetica')
            .fontSize(10)
            .text(`Liberadas: ${totais.liberadas} | Pendentes: ${totais.pendentes} | Taxa de Aprovação: ${taxaGeral}%`);
    }
    /**
     * Desenha o cabeçalho de uma tabela no PDF
     * @param doc Documento PDF
     * @param colunas Array com os títulos das colunas
     */
    desenharCabecalhoTabela(doc, colunas) {
        const y = 130;
        // Desenhar retângulo de fundo
        doc.rect(50, y, doc.page.width - 100, 20).fill('#f0f0f0');
        // Desenhar títulos das colunas
        doc.fillColor('black');
        doc.font('Helvetica-Bold').fontSize(10);
        // Posicionar cada coluna (ajustar conforme necessário)
        const posicoes = [50, 130, 280, 380, 480];
        colunas.forEach((coluna, index) => {
            doc.text(coluna, posicoes[index], y + 5);
        });
        // Linha horizontal abaixo do cabeçalho
        doc
            .moveTo(50, y + 20)
            .lineTo(doc.page.width - 50, y + 20)
            .stroke();
    }
};
exports.PdfStrategy = PdfStrategy;
exports.PdfStrategy = PdfStrategy = PdfStrategy_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof temp_files_service_1.TempFilesService !== "undefined" && temp_files_service_1.TempFilesService) === "function" ? _a : Object])
], PdfStrategy);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHJlbGF0b3Jpb3MtdW5pZmljYWRvXFxzdHJhdGVnaWVzXFxwZGYuc3RyYXRlZ3kudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBb0Q7QUFFcEQsb0RBQWlDO0FBQ2pDLHVDQUF5QjtBQUN6Qix1RUFBa0U7QUFFbEU7Ozs7R0FJRztBQUVJLElBQU0sV0FBVyxtQkFBakIsTUFBTSxXQUFXO0lBR087SUFGWixNQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsYUFBVyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXZELFlBQTZCLGdCQUFrQztRQUFsQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO0lBQUcsQ0FBQztJQUVuRTs7Ozs7O09BTUc7SUFDSCxLQUFLLENBQUMsS0FBSyxDQUFDLElBQVksRUFBRSxLQUFVLEVBQUUsTUFBVztRQUMvQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxrQ0FBa0MsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUUxRCwyQkFBMkI7UUFDM0IsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGVBQWUsQ0FDeEQsZUFBZSxFQUNmLEtBQUssQ0FDTixDQUFDO1FBRUYsSUFBSSxDQUFDO1lBQ0gsc0JBQXNCO1lBQ3RCLE1BQU0sR0FBRyxHQUFHLElBQUksZ0JBQVcsQ0FBQztnQkFDMUIsTUFBTSxFQUFFLEVBQUU7Z0JBQ1YsSUFBSSxFQUFFLElBQUk7YUFDWCxDQUFDLENBQUM7WUFFSCwrQ0FBK0M7WUFDL0MsTUFBTSxNQUFNLEdBQUcsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ2xELEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFFakIsbUJBQW1CO1lBQ25CLEdBQUc7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Q0FBQyxDQUFDLENBQUM7UUFFSCx1Q0FBdUM7UUFDdkMsR0FBRzthQUNBLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQzthQUNsQixNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUM7YUFDbkMsTUFBTSxFQUFFLENBQUM7SUFDZCxDQUFDO0NBQ0YsQ0FBQTtBQXBiWSxrQ0FBVztzQkFBWCxXQUFXO0lBRHZCLElBQUEsbUJBQVUsR0FBRTt5REFJb0MscUNBQWdCLG9CQUFoQixxQ0FBZ0I7R0FIcEQsV0FBVyxDQW9idkIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHJlbGF0b3Jpb3MtdW5pZmljYWRvXFxzdHJhdGVnaWVzXFxwZGYuc3RyYXRlZ3kudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTG9nZ2VyIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgUmVsYXRvcmlvU3RyYXRlZ3kgfSBmcm9tICcuLi9pbnRlcmZhY2VzL3JlbGF0b3Jpby1zdHJhdGVneS5pbnRlcmZhY2UnO1xuaW1wb3J0IFBERkRvY3VtZW50IGZyb20gJ3BkZmtpdCc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgeyBUZW1wRmlsZXNTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvdGVtcC1maWxlcy5zZXJ2aWNlJztcblxuLyoqXG4gKiBFc3RyYXTDqWdpYSBkZSBnZXJhw6fDo28gZGUgcmVsYXTDs3Jpb3MgZW0gZm9ybWF0byBQREZcbiAqXG4gKiBJbXBsZW1lbnRhIGEgZ2VyYcOnw6NvIGRlIHJlbGF0w7NyaW9zIGVtIGZvcm1hdG8gUERGIHVzYW5kbyBQREZLaXRcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFBkZlN0cmF0ZWd5IGltcGxlbWVudHMgUmVsYXRvcmlvU3RyYXRlZ3kge1xuICBwcml2YXRlIHJlYWRvbmx5IGxvZ2dlciA9IG5ldyBMb2dnZXIoUGRmU3RyYXRlZ3kubmFtZSk7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSB0ZW1wRmlsZXNTZXJ2aWNlOiBUZW1wRmlsZXNTZXJ2aWNlKSB7fVxuXG4gIC8qKlxuICAgKiBHZXJhIHVtIHJlbGF0w7NyaW8gZW0gZm9ybWF0byBQREZcbiAgICogQHBhcmFtIHRpcG8gVGlwbyBkZSByZWxhdMOzcmlvXG4gICAqIEBwYXJhbSBkYWRvcyBEYWRvcyBkbyByZWxhdMOzcmlvXG4gICAqIEBwYXJhbSBvcGNvZXMgT3DDp8O1ZXMgZGUgY29uZmlndXJhw6fDo29cbiAgICogQHJldHVybnMgQnVmZmVyIGNvbnRlbmRvIG8gUERGIGdlcmFkb1xuICAgKi9cbiAgYXN5bmMgZ2VyYXIodGlwbzogc3RyaW5nLCBkYWRvczogYW55LCBvcGNvZXM6IGFueSk6IFByb21pc2U8QnVmZmVyPiB7XG4gICAgdGhpcy5sb2dnZXIubG9nKGBHZXJhbmRvIHJlbGF0w7NyaW8gUERGIGRvIHRpcG86ICR7dGlwb31gKTtcblxuICAgIC8vIENyaWFyIGFycXVpdm8gdGVtcG9yw6FyaW9cbiAgICBjb25zdCB0ZW1wRmlsZVBhdGggPSB0aGlzLnRlbXBGaWxlc1NlcnZpY2UuZ2V0VGVtcEZpbGVQYXRoKFxuICAgICAgJ3JlbGF0b3Jpby1wZGYnLFxuICAgICAgJ3BkZicsXG4gICAgKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBDcmlhciBkb2N1bWVudG8gUERGXG4gICAgICBjb25zdCBkb2MgPSBuZXcgUERGRG9jdW1lbnQoe1xuICAgICAgICBtYXJnaW46IDUwLFxuICAgICAgICBzaXplOiAnQTQnLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENvbmVjdGFyIHN0cmVhbSBkbyBQREYgYW8gYXJxdWl2byB0ZW1wb3LDoXJpb1xuICAgICAgY29uc3Qgc3RyZWFtID0gZnMuY3JlYXRlV3JpdGVTdHJlYW0odGVtcEZpbGVQYXRoKTtcbiAgICAgIGRvYy5waXBlKHN0cmVhbSk7XG5cbiAgICAgIC8vIEFkaWNpb25hciB0w610dWxvXG4gICAgICBkb2NcbiAgICAgICAgLmZvbnRTaXplKDIwKVxuICAgICAgICAuZm9udCgnSGVsdmV0aWNhLUJvbGQnKVxuICAgICAgICAudGV4dCh0aGlzLmdldFRpdHVsbyh0aXBvKSwgeyBhbGlnbjogJ2NlbnRlcicgfSk7XG4gICAgICBkb2MubW92ZURvd24oKTtcblxuICAgICAgLy8gQWRpY2lvbmFyIHBlcsOtb2RvXG4gICAgICBpZiAob3Bjb2VzLmRhdGFJbmljaW8gJiYgb3Bjb2VzLmRhdGFGaW0pIHtcbiAgICAgICAgY29uc3QgZGF0YUluaWNpbyA9IG5ldyBEYXRlKG9wY29lcy5kYXRhSW5pY2lvKS50b0xvY2FsZURhdGVTdHJpbmcoXG4gICAgICAgICAgJ3B0LUJSJyxcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgZGF0YUZpbSA9IG5ldyBEYXRlKG9wY29lcy5kYXRhRmltKS50b0xvY2FsZURhdGVTdHJpbmcoJ3B0LUJSJyk7XG4gICAgICAgIGRvY1xuICAgICAgICAgIC5mb250U2l6ZSgxMilcbiAgICAgICAgICAuZm9udCgnSGVsdmV0aWNhJylcbiAgICAgICAgICAudGV4dChgUGVyw61vZG86ICR7ZGF0YUluaWNpb30gYSAke2RhdGFGaW19YCwgeyBhbGlnbjogJ2NlbnRlcicgfSk7XG4gICAgICAgIGRvYy5tb3ZlRG93bigyKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWRpY2lvbmFyIGNvbnRlw7pkbyBlc3BlY8OtZmljbyBjb25mb3JtZSBvIHRpcG8gZGUgcmVsYXTDs3Jpb1xuICAgICAgc3dpdGNoICh0aXBvKSB7XG4gICAgICAgIGNhc2UgJ2JlbmVmaWNpb3MtY29uY2VkaWRvcyc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5nZXJhckJlbmVmaWNpb3NDb25jZWRpZG9zKGRvYywgZGFkb3MsIG9wY29lcyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3NvbGljaXRhY29lcy1wb3Itc3RhdHVzJzpcbiAgICAgICAgICBhd2FpdCB0aGlzLmdlcmFyU29saWNpdGFjb2VzUG9yU3RhdHVzKGRvYywgZGFkb3MsIG9wY29lcyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2F0ZW5kaW1lbnRvcy1wb3ItdW5pZGFkZSc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5nZXJhckF0ZW5kaW1lbnRvc1BvclVuaWRhZGUoZG9jLCBkYWRvcywgb3Bjb2VzKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBkb2NcbiAgICAgICAgICAgIC5mb250U2l6ZSgxMilcbiAgICAgICAgICAgIC5mb250KCdIZWx2ZXRpY2EnKVxuICAgICAgICAgICAgLnRleHQoJ1RpcG8gZGUgcmVsYXTDs3JpbyBuw6NvIGltcGxlbWVudGFkbycpO1xuICAgICAgfVxuXG4gICAgICAvLyBBZGljaW9uYXIgcm9kYXDDqSBjb20gZGF0YSBkZSBnZXJhw6fDo29cbiAgICAgIGNvbnN0IHBhZ2VDb3VudCA9IGRvYy5idWZmZXJlZFBhZ2VSYW5nZSgpLmNvdW50O1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWdlQ291bnQ7IGkrKykge1xuICAgICAgICBkb2Muc3dpdGNoVG9QYWdlKGkpO1xuICAgICAgICBkb2NcbiAgICAgICAgICAuZm9udFNpemUoOClcbiAgICAgICAgICAuZm9udCgnSGVsdmV0aWNhJylcbiAgICAgICAgICAudGV4dChcbiAgICAgICAgICAgIGBHZXJhZG8gZW06ICR7bmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygncHQtQlInKX0gLSBQw6FnaW5hICR7aSArIDF9IGRlICR7cGFnZUNvdW50fWAsXG4gICAgICAgICAgICA1MCxcbiAgICAgICAgICAgIGRvYy5wYWdlLmhlaWdodCAtIDUwLFxuICAgICAgICAgICAgeyBhbGlnbjogJ2NlbnRlcicgfSxcbiAgICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBGaW5hbGl6YXIgZG9jdW1lbnRvXG4gICAgICBkb2MuZW5kKCk7XG5cbiAgICAgIC8vIEFndWFyZGFyIGZpbmFsaXphw6fDo28gZGEgZ3JhdmHDp8Ojb1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgc3RyZWFtLm9uKCdmaW5pc2gnLCAoKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMudGVtcEZpbGVzU2VydmljZS5yZWFkQW5kUmVtb3ZlKHRlbXBGaWxlUGF0aCk7XG4gICAgICAgICAgICByZXNvbHZlKGJ1ZmZlcik7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBzdHJlYW0ub24oJ2Vycm9yJywgKGVycm9yKSA9PiB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEVycm8gYW8gZ2VyYXIgcmVsYXTDs3JpbyBQREY6ICR7ZXJyb3IubWVzc2FnZX1gKTtcblxuICAgICAgLy8gVGVudGFyIGxpbXBhciBhcnF1aXZvIHRlbXBvcsOhcmlvIGVtIGNhc28gZGUgZXJyb1xuICAgICAgdHJ5IHtcbiAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmModGVtcEZpbGVQYXRoKSkge1xuICAgICAgICAgIGZzLnVubGlua1N5bmModGVtcEZpbGVQYXRoKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoY2xlYW51cEVycm9yKSB7XG4gICAgICAgIHRoaXMubG9nZ2VyLndhcm4oXG4gICAgICAgICAgYEVycm8gYW8gbGltcGFyIGFycXVpdm8gdGVtcG9yw6FyaW86ICR7Y2xlYW51cEVycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldG9ybmEgbyB0aXBvIE1JTUUgcGFyYSBhcnF1aXZvcyBQREZcbiAgICovXG4gIGdldE1pbWVUeXBlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuICdhcHBsaWNhdGlvbi9wZGYnO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldG9ybmEgYSBleHRlbnPDo28gcGFyYSBhcnF1aXZvcyBQREZcbiAgICovXG4gIGdldEV4dGVuc2FvKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuICdwZGYnO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldG9ybmEgbyB0w610dWxvIGRvIHJlbGF0w7NyaW8gY29tIGJhc2Ugbm8gdGlwb1xuICAgKiBAcGFyYW0gdGlwbyBUaXBvIGRlIHJlbGF0w7NyaW9cbiAgICogQHJldHVybnMgVMOtdHVsbyBmb3JtYXRhZG9cbiAgICovXG4gIHByaXZhdGUgZ2V0VGl0dWxvKHRpcG86IHN0cmluZyk6IHN0cmluZyB7XG4gICAgc3dpdGNoICh0aXBvKSB7XG4gICAgICBjYXNlICdiZW5lZmljaW9zLWNvbmNlZGlkb3MnOlxuICAgICAgICByZXR1cm4gJ1JlbGF0w7NyaW8gZGUgQmVuZWbDrWNpb3MgQ29uY2VkaWRvcyc7XG4gICAgICBjYXNlICdzb2xpY2l0YWNvZXMtcG9yLXN0YXR1cyc6XG4gICAgICAgIHJldHVybiAnUmVsYXTDs3JpbyBkZSBTb2xpY2l0YcOnw7VlcyBwb3IgU3RhdHVzJztcbiAgICAgIGNhc2UgJ2F0ZW5kaW1lbnRvcy1wb3ItdW5pZGFkZSc6XG4gICAgICAgIHJldHVybiAnUmVsYXTDs3JpbyBkZSBBdGVuZGltZW50b3MgcG9yIFVuaWRhZGUnO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuICdSZWxhdMOzcmlvJztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VyYSBjb250ZcO6ZG8gcGFyYSByZWxhdMOzcmlvIGRlIGJlbmVmw61jaW9zIGNvbmNlZGlkb3NcbiAgICogQHBhcmFtIGRvYyBEb2N1bWVudG8gUERGXG4gICAqIEBwYXJhbSBkYWRvcyBEYWRvcyBwYXJhIG8gcmVsYXTDs3Jpb1xuICAgKiBAcGFyYW0gb3Bjb2VzIE9ww6fDtWVzIGRlIGNvbmZpZ3VyYcOnw6NvXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdlcmFyQmVuZWZpY2lvc0NvbmNlZGlkb3MoXG4gICAgZG9jOiBQREZLaXQuUERGRG9jdW1lbnQsXG4gICAgZGFkb3M6IGFueVtdLFxuICAgIG9wY29lczogYW55LFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBBZGljaW9uYXIgY2FiZcOnYWxobyBkYSB0YWJlbGFcbiAgICB0aGlzLmRlc2VuaGFyQ2FiZWNhbGhvVGFiZWxhKGRvYywgW1xuICAgICAgJ1Byb3RvY29sbycsXG4gICAgICAnQmVuZWZpY2nDoXJpbycsXG4gICAgICAnQmVuZWbDrWNpbycsXG4gICAgICAnVW5pZGFkZScsXG4gICAgICAnRGF0YSBMaWJlcmHDp8OjbycsXG4gICAgXSk7XG5cbiAgICAvLyBBZGljaW9uYXIgbGluaGFzIGRhIHRhYmVsYVxuICAgIGxldCBhbHR1cmFMaW5oYSA9IDE2MDtcbiAgICBjb25zdCBhbHR1cmFNYXhpbWEgPSBkb2MucGFnZS5oZWlnaHQgLSAxMDA7XG5cbiAgICBmb3IgKGNvbnN0IHNvbGljaXRhY2FvIG9mIGRhZG9zKSB7XG4gICAgICAvLyBWZXJpZmljYXIgc2UgcHJlY2lzYSBhZGljaW9uYXIgbm92YSBww6FnaW5hXG4gICAgICBpZiAoYWx0dXJhTGluaGEgPiBhbHR1cmFNYXhpbWEpIHtcbiAgICAgICAgZG9jLmFkZFBhZ2UoKTtcbiAgICAgICAgYWx0dXJhTGluaGEgPSAxMDA7XG4gICAgICAgIHRoaXMuZGVzZW5oYXJDYWJlY2FsaG9UYWJlbGEoZG9jLCBbXG4gICAgICAgICAgJ1Byb3RvY29sbycsXG4gICAgICAgICAgJ0JlbmVmaWNpw6FyaW8nLFxuICAgICAgICAgICdCZW5lZsOtY2lvJyxcbiAgICAgICAgICAnVW5pZGFkZScsXG4gICAgICAgICAgJ0RhdGEgTGliZXJhw6fDo28nLFxuICAgICAgICBdKTtcbiAgICAgIH1cblxuICAgICAgLy8gRGVzZW5oYXIgbGluaGFcbiAgICAgIGRvY1xuICAgICAgICAuZm9udCgnSGVsdmV0aWNhJylcbiAgICAgICAgLmZvbnRTaXplKDEwKVxuICAgICAgICAudGV4dChzb2xpY2l0YWNhby5wcm90b2NvbG8gfHwgJycsIDUwLCBhbHR1cmFMaW5oYSwgeyB3aWR0aDogODAgfSlcbiAgICAgICAgLnRleHQoc29saWNpdGFjYW8uYmVuZWZpY2lhcmlvPy5ub21lIHx8ICdOL0EnLCAxMzAsIGFsdHVyYUxpbmhhLCB7XG4gICAgICAgICAgd2lkdGg6IDE1MCxcbiAgICAgICAgfSlcbiAgICAgICAgLnRleHQoc29saWNpdGFjYW8udGlwb19iZW5lZmljaW8/Lm5vbWUgfHwgJ04vQScsIDI4MCwgYWx0dXJhTGluaGEsIHtcbiAgICAgICAgICB3aWR0aDogMTAwLFxuICAgICAgICB9KVxuICAgICAgICAudGV4dChzb2xpY2l0YWNhby51bmlkYWRlPy5ub21lIHx8ICdOL0EnLCAzODAsIGFsdHVyYUxpbmhhLCB7XG4gICAgICAgICAgd2lkdGg6IDEwMCxcbiAgICAgICAgfSlcbiAgICAgICAgLnRleHQoXG4gICAgICAgICAgc29saWNpdGFjYW8uZGF0YV9saWJlcmFjYW9cbiAgICAgICAgICAgID8gbmV3IERhdGUoc29saWNpdGFjYW8uZGF0YV9saWJlcmFjYW8pLnRvTG9jYWxlRGF0ZVN0cmluZygncHQtQlInKVxuICAgICAgICAgICAgOiAnTi9BJyxcbiAgICAgICAgICA0ODAsXG4gICAgICAgICAgYWx0dXJhTGluaGEsXG4gICAgICAgICk7XG5cbiAgICAgIGFsdHVyYUxpbmhhICs9IDIwO1xuICAgIH1cblxuICAgIC8vIEFkaWNpb25hciByZXN1bW9cbiAgICBkb2MubW92ZURvd24oMik7XG4gICAgZG9jXG4gICAgICAuZm9udCgnSGVsdmV0aWNhLUJvbGQnKVxuICAgICAgLmZvbnRTaXplKDEyKVxuICAgICAgLnRleHQoYFRvdGFsIGRlIGJlbmVmw61jaW9zIGNvbmNlZGlkb3M6ICR7ZGFkb3MubGVuZ3RofWApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlcmEgY29udGXDumRvIHBhcmEgcmVsYXTDs3JpbyBkZSBzb2xpY2l0YcOnw7VlcyBwb3Igc3RhdHVzXG4gICAqIEBwYXJhbSBkb2MgRG9jdW1lbnRvIFBERlxuICAgKiBAcGFyYW0gZGFkb3MgRGFkb3MgcGFyYSBvIHJlbGF0w7NyaW9cbiAgICogQHBhcmFtIG9wY29lcyBPcMOnw7VlcyBkZSBjb25maWd1cmHDp8Ojb1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZXJhclNvbGljaXRhY29lc1BvclN0YXR1cyhcbiAgICBkb2M6IFBERktpdC5QREZEb2N1bWVudCxcbiAgICBkYWRvczogYW55LFxuICAgIG9wY29lczogYW55LFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBzdGF0dXNMaXN0ID0gT2JqZWN0LmtleXMoZGFkb3MpO1xuXG4gICAgLy8gQWRpY2lvbmFyIHJlc3Vtb1xuICAgIGRvY1xuICAgICAgLmZvbnQoJ0hlbHZldGljYS1Cb2xkJylcbiAgICAgIC5mb250U2l6ZSgxMilcbiAgICAgIC50ZXh0KCdSZXN1bW8gcG9yIFN0YXR1czonLCB7IHVuZGVybGluZTogdHJ1ZSB9KTtcbiAgICBkb2MubW92ZURvd24oKTtcblxuICAgIGxldCB0b3RhbEdlcmFsID0gMDtcbiAgICBmb3IgKGNvbnN0IHN0YXR1cyBvZiBzdGF0dXNMaXN0KSB7XG4gICAgICBjb25zdCBxdWFudGlkYWRlID0gZGFkb3Nbc3RhdHVzXS5sZW5ndGg7XG4gICAgICB0b3RhbEdlcmFsICs9IHF1YW50aWRhZGU7XG4gICAgICBkb2NcbiAgICAgICAgLmZvbnQoJ0hlbHZldGljYScpXG4gICAgICAgIC5mb250U2l6ZSgxMClcbiAgICAgICAgLnRleHQoYCR7c3RhdHVzfTogJHtxdWFudGlkYWRlfSBzb2xpY2l0YcOnw7Vlc2ApO1xuICAgIH1cblxuICAgIGRvYy5tb3ZlRG93bigpO1xuICAgIGRvY1xuICAgICAgLmZvbnQoJ0hlbHZldGljYS1Cb2xkJylcbiAgICAgIC5mb250U2l6ZSgxMClcbiAgICAgIC50ZXh0KGBUb3RhbCBHZXJhbDogJHt0b3RhbEdlcmFsfSBzb2xpY2l0YcOnw7Vlc2ApO1xuICAgIGRvYy5tb3ZlRG93bigyKTtcblxuICAgIC8vIEFkaWNpb25hciBkZXRhbGhhbWVudG8gcG9yIHN0YXR1c1xuICAgIGZvciAoY29uc3Qgc3RhdHVzIG9mIHN0YXR1c0xpc3QpIHtcbiAgICAgIGRvYy5hZGRQYWdlKCk7XG4gICAgICBkb2NcbiAgICAgICAgLmZvbnQoJ0hlbHZldGljYS1Cb2xkJylcbiAgICAgICAgLmZvbnRTaXplKDE0KVxuICAgICAgICAudGV4dChgU29saWNpdGHDp8O1ZXMgY29tIFN0YXR1czogJHtzdGF0dXN9YCwgeyBhbGlnbjogJ2NlbnRlcicgfSk7XG4gICAgICBkb2MubW92ZURvd24oKTtcblxuICAgICAgLy8gQWRpY2lvbmFyIGNhYmXDp2FsaG8gZGEgdGFiZWxhXG4gICAgICB0aGlzLmRlc2VuaGFyQ2FiZWNhbGhvVGFiZWxhKGRvYywgW1xuICAgICAgICAnUHJvdG9jb2xvJyxcbiAgICAgICAgJ0JlbmVmaWNpw6FyaW8nLFxuICAgICAgICAnQmVuZWbDrWNpbycsXG4gICAgICAgICdVbmlkYWRlJyxcbiAgICAgICAgJ0RhdGEgQWJlcnR1cmEnLFxuICAgICAgXSk7XG5cbiAgICAgIC8vIEFkaWNpb25hciBsaW5oYXMgZGEgdGFiZWxhXG4gICAgICBsZXQgYWx0dXJhTGluaGEgPSAxNjA7XG4gICAgICBjb25zdCBhbHR1cmFNYXhpbWEgPSBkb2MucGFnZS5oZWlnaHQgLSAxMDA7XG5cbiAgICAgIGZvciAoY29uc3Qgc29saWNpdGFjYW8gb2YgZGFkb3Nbc3RhdHVzXSkge1xuICAgICAgICAvLyBWZXJpZmljYXIgc2UgcHJlY2lzYSBhZGljaW9uYXIgbm92YSBww6FnaW5hXG4gICAgICAgIGlmIChhbHR1cmFMaW5oYSA+IGFsdHVyYU1heGltYSkge1xuICAgICAgICAgIGRvYy5hZGRQYWdlKCk7XG4gICAgICAgICAgYWx0dXJhTGluaGEgPSAxMDA7XG4gICAgICAgICAgdGhpcy5kZXNlbmhhckNhYmVjYWxob1RhYmVsYShkb2MsIFtcbiAgICAgICAgICAgICdQcm90b2NvbG8nLFxuICAgICAgICAgICAgJ0JlbmVmaWNpw6FyaW8nLFxuICAgICAgICAgICAgJ0JlbmVmw61jaW8nLFxuICAgICAgICAgICAgJ1VuaWRhZGUnLFxuICAgICAgICAgICAgJ0RhdGEgQWJlcnR1cmEnLFxuICAgICAgICAgIF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGVzZW5oYXIgbGluaGFcbiAgICAgICAgZG9jXG4gICAgICAgICAgLmZvbnQoJ0hlbHZldGljYScpXG4gICAgICAgICAgLmZvbnRTaXplKDEwKVxuICAgICAgICAgIC50ZXh0KHNvbGljaXRhY2FvLnByb3RvY29sbyB8fCAnJywgNTAsIGFsdHVyYUxpbmhhLCB7IHdpZHRoOiA4MCB9KVxuICAgICAgICAgIC50ZXh0KHNvbGljaXRhY2FvLmJlbmVmaWNpYXJpbz8ubm9tZSB8fCAnTi9BJywgMTMwLCBhbHR1cmFMaW5oYSwge1xuICAgICAgICAgICAgd2lkdGg6IDE1MCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC50ZXh0KHNvbGljaXRhY2FvLnRpcG9fYmVuZWZpY2lvPy5ub21lIHx8ICdOL0EnLCAyODAsIGFsdHVyYUxpbmhhLCB7XG4gICAgICAgICAgICB3aWR0aDogMTAwLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRleHQoc29saWNpdGFjYW8udW5pZGFkZT8ubm9tZSB8fCAnTi9BJywgMzgwLCBhbHR1cmFMaW5oYSwge1xuICAgICAgICAgICAgd2lkdGg6IDEwMCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC50ZXh0KFxuICAgICAgICAgICAgc29saWNpdGFjYW8uZGF0YV9hYmVydHVyYVxuICAgICAgICAgICAgICA/IG5ldyBEYXRlKHNvbGljaXRhY2FvLmRhdGFfYWJlcnR1cmEpLnRvTG9jYWxlRGF0ZVN0cmluZygncHQtQlInKVxuICAgICAgICAgICAgICA6ICdOL0EnLFxuICAgICAgICAgICAgNDgwLFxuICAgICAgICAgICAgYWx0dXJhTGluaGEsXG4gICAgICAgICAgKTtcblxuICAgICAgICBhbHR1cmFMaW5oYSArPSAyMDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VyYSBjb250ZcO6ZG8gcGFyYSByZWxhdMOzcmlvIGRlIGF0ZW5kaW1lbnRvcyBwb3IgdW5pZGFkZVxuICAgKiBAcGFyYW0gZG9jIERvY3VtZW50byBQREZcbiAgICogQHBhcmFtIGRhZG9zIERhZG9zIHBhcmEgbyByZWxhdMOzcmlvXG4gICAqIEBwYXJhbSBvcGNvZXMgT3DDp8O1ZXMgZGUgY29uZmlndXJhw6fDo29cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2VyYXJBdGVuZGltZW50b3NQb3JVbmlkYWRlKFxuICAgIGRvYzogUERGS2l0LlBERkRvY3VtZW50LFxuICAgIGRhZG9zOiBhbnlbXSxcbiAgICBvcGNvZXM6IGFueSxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gQWRpY2lvbmFyIGNhYmXDp2FsaG8gZGEgdGFiZWxhXG4gICAgdGhpcy5kZXNlbmhhckNhYmVjYWxob1RhYmVsYShkb2MsIFtcbiAgICAgICdVbmlkYWRlJyxcbiAgICAgICdUb3RhbCBTb2xpY2l0LicsXG4gICAgICAnTGliZXJhZGFzJyxcbiAgICAgICdQZW5kZW50ZXMnLFxuICAgICAgJ1RheGEgQXByb3Zhw6fDo28nLFxuICAgIF0pO1xuXG4gICAgLy8gQWRpY2lvbmFyIGxpbmhhcyBkYSB0YWJlbGFcbiAgICBsZXQgYWx0dXJhTGluaGEgPSAxNjA7XG4gICAgY29uc3QgYWx0dXJhTWF4aW1hID0gZG9jLnBhZ2UuaGVpZ2h0IC0gMTAwO1xuXG4gICAgZm9yIChjb25zdCBpdGVtIG9mIGRhZG9zKSB7XG4gICAgICBjb25zdCB0YXhhQXByb3ZhY2FvID1cbiAgICAgICAgaXRlbS50b3RhbFNvbGljaXRhY29lcyA+IDBcbiAgICAgICAgICA/IChcbiAgICAgICAgICAgICAgKGl0ZW0uc29saWNpdGFjb2VzTGliZXJhZGFzIC8gaXRlbS50b3RhbFNvbGljaXRhY29lcykgKlxuICAgICAgICAgICAgICAxMDBcbiAgICAgICAgICAgICkudG9GaXhlZCgyKVxuICAgICAgICAgIDogJzAuMDAnO1xuXG4gICAgICAvLyBEZXNlbmhhciBsaW5oYVxuICAgICAgZG9jXG4gICAgICAgIC5mb250KCdIZWx2ZXRpY2EnKVxuICAgICAgICAuZm9udFNpemUoMTApXG4gICAgICAgIC50ZXh0KGl0ZW0udW5pZGFkZS5ub21lIHx8ICdOL0EnLCA1MCwgYWx0dXJhTGluaGEsIHsgd2lkdGg6IDE1MCB9KVxuICAgICAgICAudGV4dChpdGVtLnRvdGFsU29saWNpdGFjb2VzLnRvU3RyaW5nKCksIDIwMCwgYWx0dXJhTGluaGEsIHtcbiAgICAgICAgICB3aWR0aDogODAsXG4gICAgICAgIH0pXG4gICAgICAgIC50ZXh0KGl0ZW0uc29saWNpdGFjb2VzTGliZXJhZGFzLnRvU3RyaW5nKCksIDI4MCwgYWx0dXJhTGluaGEsIHtcbiAgICAgICAgICB3aWR0aDogODAsXG4gICAgICAgIH0pXG4gICAgICAgIC50ZXh0KGl0ZW0uc29saWNpdGFjb2VzUGVuZGVudGVzLnRvU3RyaW5nKCksIDM2MCwgYWx0dXJhTGluaGEsIHtcbiAgICAgICAgICB3aWR0aDogODAsXG4gICAgICAgIH0pXG4gICAgICAgIC50ZXh0KGAke3RheGFBcHJvdmFjYW99JWAsIDQ0MCwgYWx0dXJhTGluaGEsIHsgd2lkdGg6IDgwIH0pO1xuXG4gICAgICBhbHR1cmFMaW5oYSArPSAyMDtcbiAgICB9XG5cbiAgICAvLyBBZGljaW9uYXIgdG90YWlzXG4gICAgZG9jLm1vdmVEb3duKDIpO1xuICAgIGNvbnN0IHRvdGFpcyA9IGRhZG9zLnJlZHVjZShcbiAgICAgIChhY2MsIGl0ZW0pID0+IHtcbiAgICAgICAgYWNjLnRvdGFsICs9IGl0ZW0udG90YWxTb2xpY2l0YWNvZXM7XG4gICAgICAgIGFjYy5saWJlcmFkYXMgKz0gaXRlbS5zb2xpY2l0YWNvZXNMaWJlcmFkYXM7XG4gICAgICAgIGFjYy5wZW5kZW50ZXMgKz0gaXRlbS5zb2xpY2l0YWNvZXNQZW5kZW50ZXM7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9LFxuICAgICAgeyB0b3RhbDogMCwgbGliZXJhZGFzOiAwLCBwZW5kZW50ZXM6IDAgfSxcbiAgICApO1xuXG4gICAgY29uc3QgdGF4YUdlcmFsID1cbiAgICAgIHRvdGFpcy50b3RhbCA+IDBcbiAgICAgICAgPyAoKHRvdGFpcy5saWJlcmFkYXMgLyB0b3RhaXMudG90YWwpICogMTAwKS50b0ZpeGVkKDIpXG4gICAgICAgIDogJzAuMDAnO1xuXG4gICAgZG9jXG4gICAgICAuZm9udCgnSGVsdmV0aWNhLUJvbGQnKVxuICAgICAgLmZvbnRTaXplKDEyKVxuICAgICAgLnRleHQoYFRvdGFsIEdlcmFsOiAke3RvdGFpcy50b3RhbH0gc29saWNpdGHDp8O1ZXNgKTtcbiAgICBkb2NcbiAgICAgIC5mb250KCdIZWx2ZXRpY2EnKVxuICAgICAgLmZvbnRTaXplKDEwKVxuICAgICAgLnRleHQoXG4gICAgICAgIGBMaWJlcmFkYXM6ICR7dG90YWlzLmxpYmVyYWRhc30gfCBQZW5kZW50ZXM6ICR7dG90YWlzLnBlbmRlbnRlc30gfCBUYXhhIGRlIEFwcm92YcOnw6NvOiAke3RheGFHZXJhbH0lYCxcbiAgICAgICk7XG4gIH1cblxuICAvKipcbiAgICogRGVzZW5oYSBvIGNhYmXDp2FsaG8gZGUgdW1hIHRhYmVsYSBubyBQREZcbiAgICogQHBhcmFtIGRvYyBEb2N1bWVudG8gUERGXG4gICAqIEBwYXJhbSBjb2x1bmFzIEFycmF5IGNvbSBvcyB0w610dWxvcyBkYXMgY29sdW5hc1xuICAgKi9cbiAgcHJpdmF0ZSBkZXNlbmhhckNhYmVjYWxob1RhYmVsYShcbiAgICBkb2M6IFBERktpdC5QREZEb2N1bWVudCxcbiAgICBjb2x1bmFzOiBzdHJpbmdbXSxcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgeSA9IDEzMDtcblxuICAgIC8vIERlc2VuaGFyIHJldMOibmd1bG8gZGUgZnVuZG9cbiAgICBkb2MucmVjdCg1MCwgeSwgZG9jLnBhZ2Uud2lkdGggLSAxMDAsIDIwKS5maWxsKCcjZjBmMGYwJyk7XG5cbiAgICAvLyBEZXNlbmhhciB0w610dWxvcyBkYXMgY29sdW5hc1xuICAgIGRvYy5maWxsQ29sb3IoJ2JsYWNrJyk7XG4gICAgZG9jLmZvbnQoJ0hlbHZldGljYS1Cb2xkJykuZm9udFNpemUoMTApO1xuXG4gICAgLy8gUG9zaWNpb25hciBjYWRhIGNvbHVuYSAoYWp1c3RhciBjb25mb3JtZSBuZWNlc3PDoXJpbylcbiAgICBjb25zdCBwb3NpY29lcyA9IFs1MCwgMTMwLCAyODAsIDM4MCwgNDgwXTtcblxuICAgIGNvbHVuYXMuZm9yRWFjaCgoY29sdW5hLCBpbmRleCkgPT4ge1xuICAgICAgZG9jLnRleHQoY29sdW5hLCBwb3NpY29lc1tpbmRleF0sIHkgKyA1KTtcbiAgICB9KTtcblxuICAgIC8vIExpbmhhIGhvcml6b250YWwgYWJhaXhvIGRvIGNhYmXDp2FsaG9cbiAgICBkb2NcbiAgICAgIC5tb3ZlVG8oNTAsIHkgKyAyMClcbiAgICAgIC5saW5lVG8oZG9jLnBhZ2Uud2lkdGggLSA1MCwgeSArIDIwKVxuICAgICAgLnN0cm9rZSgpO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=