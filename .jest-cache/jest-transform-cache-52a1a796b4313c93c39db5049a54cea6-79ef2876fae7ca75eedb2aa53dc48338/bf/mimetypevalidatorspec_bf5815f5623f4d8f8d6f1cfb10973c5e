ea40b85018b9337b4fbeac504775d94b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const mime_type_validator_1 = require("../mime-type.validator");
const documento_config_1 = require("../../config/documento.config");
describe('MimeTypeValidator', () => {
    let validator;
    beforeEach(() => {
        validator = new mime_type_validator_1.MimeTypeValidator();
    });
    describe('validateMimeType', () => {
        it('deve validar um PDF válido', async () => {
            // Criar um buffer que simula um PDF (com magic number correto)
            const pdfBuffer = Buffer.from([
                0x25,
                0x50,
                0x44,
                0x46, // %PDF magic number
                ...Buffer.from('-1.4\n%âãÏÓ\n'), // PDF header
            ]);
            const result = await validator.validateMimeType(pdfBuffer, 'application/pdf', 'documento.pdf', pdfBuffer.length);
            expect(result.isValid).toBe(true);
            expect(result.detectedMimeType).toBe('application/pdf');
            expect(result.fileExtension).toBe('pdf');
        });
        it('deve rejeitar arquivo com extensão perigosa', async () => {
            const buffer = Buffer.from('conteúdo qualquer');
            const result = await validator.validateMimeType(buffer, 'application/octet-stream', 'malware.exe', buffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.hasDangerousExtension).toBe(true);
            expect(result.message).toContain('Extensão de arquivo não permitida');
        });
        it('deve rejeitar tipo MIME bloqueado', async () => {
            const buffer = Buffer.from('conteúdo');
            const result = await validator.validateMimeType(buffer, 'text/javascript', 'script.js', buffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.isBlockedMimeType).toBe(true);
            expect(result.message).toContain('Tipo MIME bloqueado');
        });
        it('deve rejeitar arquivo que excede tamanho máximo', async () => {
            const buffer = Buffer.from('conteúdo');
            const largeSize = 25 * 1024 * 1024; // 25MB (maior que o limite global)
            const result = await validator.validateMimeType(buffer, 'application/pdf', 'documento.pdf', largeSize);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.exceedsMaxSize).toBe(true);
            expect(result.message).toContain('excede o tamanho máximo');
        });
        it('deve detectar mismatch entre tipo declarado e detectado', async () => {
            // Buffer que simula uma imagem JPEG
            const jpegBuffer = Buffer.from([
                0xff,
                0xd8,
                0xff,
                0xe0, // JPEG magic number
                ...Buffer.from('fake jpeg content'),
            ]);
            const result = await validator.validateMimeType(jpegBuffer, 'application/pdf', // Tipo declarado incorreto
            'imagem.jpg', jpegBuffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.magicNumberMismatch).toBe(true);
            expect(result.message).toContain('não corresponde ao tipo real');
        });
        it('deve validar arquivo de texto simples', async () => {
            const textBuffer = Buffer.from('Este é um arquivo de texto simples.\nCom quebras de linha.');
            const result = await validator.validateMimeType(textBuffer, 'text/plain', 'documento.txt', textBuffer.length);
            expect(result.isValid).toBe(true);
            expect(result.detectedMimeType).toBe('text/plain');
        });
        it('deve detectar conteúdo suspeito em arquivo', async () => {
            const suspiciousBuffer = Buffer.from(`
        Conteúdo normal do arquivo
        <script>alert('xss')</script>
        Mais conteúdo
      `);
            const result = await validator.validateMimeType(suspiciousBuffer, 'text/plain', 'arquivo.txt', suspiciousBuffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.isSuspicious).toBe(true);
            expect(result.securityFlags?.hasEmbeddedContent).toBe(true);
            expect(result.message).toContain('conteúdo suspeito');
        });
        it('deve detectar JavaScript em PDF', async () => {
            const pdfWithJsBuffer = Buffer.from(`
        %PDF-1.4
        /JavaScript (alert('malicious'))
        /JS (document.cookie)
        resto do conteúdo PDF
      `);
            const result = await validator.validateMimeType(pdfWithJsBuffer, 'application/pdf', 'documento.pdf', pdfWithJsBuffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.isSuspicious).toBe(true);
            expect(result.message).toContain('JavaScript incorporado');
        });
        it('deve detectar alta densidade de caracteres não-ASCII', async () => {
            // Criar buffer com muitos caracteres não-ASCII (possível ofuscação)
            const obfuscatedBuffer = Buffer.from('texto' + '\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89'.repeat(20));
            const result = await validator.validateMimeType(obfuscatedBuffer, 'text/plain', 'arquivo.txt', obfuscatedBuffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.isSuspicious).toBe(true);
            expect(result.message).toContain('caracteres não-ASCII');
        });
    });
    describe('generateFileHash', () => {
        it('deve gerar hash SHA256 consistente', () => {
            const buffer = Buffer.from('conteúdo de teste');
            const hash1 = validator.generateFileHash(buffer);
            const hash2 = validator.generateFileHash(buffer);
            expect(hash1).toBe(hash2);
            expect(hash1).toHaveLength(64); // SHA256 em hex
            expect(hash1).toMatch(/^[a-f0-9]{64}$/);
        });
        it('deve gerar hashes diferentes para conteúdos diferentes', () => {
            const buffer1 = Buffer.from('conteúdo 1');
            const buffer2 = Buffer.from('conteúdo 2');
            const hash1 = validator.generateFileHash(buffer1);
            const hash2 = validator.generateFileHash(buffer2);
            expect(hash1).not.toBe(hash2);
        });
    });
    describe('requiresEncryption', () => {
        it('deve retornar true para documentos sensíveis', () => {
            const sensitiveTypes = [
                'application/pdf',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
            ];
            sensitiveTypes.forEach((mimeType) => {
                expect(validator.requiresEncryption(mimeType)).toBe(true);
            });
        });
        it('deve retornar false para imagens', () => {
            const imageTypes = ['image/jpeg', 'image/png'];
            imageTypes.forEach((mimeType) => {
                expect(validator.requiresEncryption(mimeType)).toBe(false);
            });
        });
    });
    describe('allowsThumbnail', () => {
        it('deve retornar true para imagens', () => {
            const imageTypes = ['image/jpeg', 'image/png'];
            imageTypes.forEach((mimeType) => {
                expect(validator.allowsThumbnail(mimeType)).toBe(true);
            });
        });
        it('deve retornar true para PDFs', () => {
            expect(validator.allowsThumbnail('application/pdf')).toBe(true);
        });
        it('deve retornar false para documentos do Office', () => {
            const officeTypes = [
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            ];
            officeTypes.forEach((mimeType) => {
                expect(validator.allowsThumbnail(mimeType)).toBe(false);
            });
        });
    });
    describe('analyzeFileContent', () => {
        it('deve detectar tags de script', () => {
            const content = Buffer.from('<script>alert("xss")</script>');
            const result = validator['analyzeFileContent'](content, 'text/html');
            expect(result.isSuspicious).toBe(true);
            expect(result.hasEmbeddedContent).toBe(true);
            expect(result.reason).toContain('script');
        });
        it('deve detectar URLs javascript', () => {
            const content = Buffer.from('href="javascript:alert(1)"');
            const result = validator['analyzeFileContent'](content, 'text/html');
            expect(result.isSuspicious).toBe(true);
            expect(result.hasEmbeddedContent).toBe(true);
        });
        it('deve detectar event handlers', () => {
            const content = Buffer.from('<img onload="malicious()" />');
            const result = validator['analyzeFileContent'](content, 'text/html');
            expect(result.isSuspicious).toBe(true);
            expect(result.hasEmbeddedContent).toBe(true);
        });
        it('deve detectar null bytes', () => {
            const content = Buffer.from('texto\x00com\x00null\x00bytes');
            const result = validator['analyzeFileContent'](content, 'text/plain');
            expect(result.isSuspicious).toBe(true);
        });
        it('não deve detectar conteúdo normal como suspeito', () => {
            const content = Buffer.from(`
        Este é um documento normal.
        Contém texto, números 123 e pontuação!
        Email: usuario@exemplo.com
        URL: https://exemplo.com
      `);
            const result = validator['analyzeFileContent'](content, 'text/plain');
            expect(result.isSuspicious).toBe(false);
            expect(result.hasEmbeddedContent).toBe(false);
        });
    });
    describe('extractFileExtension', () => {
        it('deve extrair extensão corretamente', () => {
            const testCases = [
                { filename: 'documento.pdf', expected: 'pdf' },
                { filename: 'imagem.JPEG', expected: 'jpeg' },
                { filename: 'arquivo.com.extensao.txt', expected: 'txt' },
                { filename: 'sem_extensao', expected: '' },
                { filename: '.hidden', expected: 'hidden' },
            ];
            testCases.forEach(({ filename, expected }) => {
                const result = validator['extractFileExtension'](filename);
                expect(result).toBe(expected);
            });
        });
    });
    describe('integração com configuração', () => {
        it('deve usar configurações do documento.config', () => {
            // Verificar se os tipos permitidos estão sendo usados
            const allowedTypes = Object.values(documento_config_1.MIME_TYPE_CONFIGS).flatMap((config) => config.mimeTypes);
            expect(allowedTypes).toContain('application/pdf');
            expect(allowedTypes).toContain('image/jpeg');
            expect(allowedTypes).toContain('text/plain');
        });
        it('deve usar tipos bloqueados da configuração', () => {
            expect(documento_config_1.BLOCKED_MIME_TYPES).toContain('text/javascript');
            expect(documento_config_1.BLOCKED_MIME_TYPES).toContain('application/zip');
            expect(documento_config_1.BLOCKED_MIME_TYPES).toContain('image/svg+xml');
        });
    });
    describe('casos de uso reais', () => {
        it('deve processar upload de certidão de nascimento (PDF)', async () => {
            const pdfBuffer = Buffer.from([
                0x25,
                0x50,
                0x44,
                0x46, // %PDF
                ...Buffer.from('-1.4\nCertidão de Nascimento\nNome: João da Silva'),
            ]);
            const result = await validator.validateMimeType(pdfBuffer, 'application/pdf', 'certidao_nascimento.pdf', pdfBuffer.length);
            expect(result.isValid).toBe(true);
            expect(result.detectedMimeType).toBe('application/pdf');
        });
        it('deve processar upload de foto de documento (JPEG)', async () => {
            const jpegBuffer = Buffer.from([
                0xff,
                0xd8,
                0xff,
                0xe0, // JPEG magic
                ...Buffer.from('fake jpeg image data'),
            ]);
            const result = await validator.validateMimeType(jpegBuffer, 'image/jpeg', 'foto_documento.jpg', jpegBuffer.length);
            expect(result.isValid).toBe(true);
            expect(result.detectedMimeType).toBe('image/jpeg');
        });
        it('deve rejeitar tentativa de upload de malware', async () => {
            const malwareBuffer = Buffer.from('MZ\x90\x00'); // PE header
            const result = await validator.validateMimeType(malwareBuffer, 'application/pdf', 'documento.exe', malwareBuffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.hasDangerousExtension).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGRvY3VtZW50b1xcdmFsaWRhdG9yc1xcX190ZXN0c19fXFxtaW1lLXR5cGUudmFsaWRhdG9yLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSxnRUFBMkQ7QUFDM0Qsb0VBR3VDO0FBSXZDLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsSUFBSSxTQUE0QixDQUFDO0lBRWpDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxTQUFTLEdBQUcsSUFBSSx1Q0FBaUIsRUFBRSxDQUFDO0lBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxFQUFFLENBQUMsNEJBQTRCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDMUMsK0RBQStEO1lBQy9ELE1BQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7Z0JBQzVCLElBQUk7Z0JBQ0osSUFBSTtnQkFDSixJQUFJO2dCQUNKLElBQUksRUFBRSxvQkFBb0I7Z0JBQzFCLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsRUFBRSxhQUFhO2FBQy9DLENBQUMsQ0FBQztZQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sU0FBUyxDQUFDLGdCQUFnQixDQUM3QyxTQUFTLEVBQ1QsaUJBQWlCLEVBQ2pCLGVBQWUsRUFDZixTQUFTLENBQUMsTUFBTSxDQUNqQixDQUFDO1lBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1lBQ3hELE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxD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QWEsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsWUFBWTtZQUU3RCxNQUFNLE1BQU0sR0FBRyxNQUFNLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FDN0MsYUFBYSxFQUNiLGlCQUFpQixFQUNqQixlQUFlLEVBQ2YsYUFBYSxDQUFDLE1BQU0sQ0FDckIsQ0FBQztZQUVGLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ25DLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFLHFCQUFxQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2pFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xcZG9jdW1lbnRvXFx2YWxpZGF0b3JzXFxfX3Rlc3RzX19cXG1pbWUtdHlwZS52YWxpZGF0b3Iuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNaW1lVHlwZVZhbGlkYXRvciB9IGZyb20gJy4uL21pbWUtdHlwZS52YWxpZGF0b3InO1xuaW1wb3J0IHtcbiAgTUlNRV9UWVBFX0NPTkZJR1MsXG4gIEJMT0NLRURfTUlNRV9UWVBFUyxcbn0gZnJvbSAnLi4vLi4vY29uZmlnL2RvY3VtZW50by5jb25maWcnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcblxuZGVzY3JpYmUoJ01pbWVUeXBlVmFsaWRhdG9yJywgKCkgPT4ge1xuICBsZXQgdmFsaWRhdG9yOiBNaW1lVHlwZVZhbGlkYXRvcjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICB2YWxpZGF0b3IgPSBuZXcgTWltZVR5cGVWYWxpZGF0b3IoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZhbGlkYXRlTWltZVR5cGUnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgdmFsaWRhciB1bSBQREYgdsOhbGlkbycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyaWFyIHVtIGJ1ZmZlciBxdWUgc2ltdWxhIHVtIFBERiAoY29tIG1hZ2ljIG51bWJlciBjb3JyZXRvKVxuICAgICAgY29uc3QgcGRmQnVmZmVyID0gQnVmZmVyLmZyb20oW1xuICAgICAgICAweDI1LFxuICAgICAgICAweDUwLFxuICAgICAgICAweDQ0LFxuICAgICAgICAweDQ2LCAvLyAlUERGIG1hZ2ljIG51bWJlclxuICAgICAgICAuLi5CdWZmZXIuZnJvbSgnLTEuNFxcbiXDosOjw4/Dk1xcbicpLCAvLyBQREYgaGVhZGVyXG4gICAgICBdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdG9yLnZhbGlkYXRlTWltZVR5cGUoXG4gICAgICAgIHBkZkJ1ZmZlcixcbiAgICAgICAgJ2FwcGxpY2F0aW9uL3BkZicsXG4gICAgICAgICdkb2N1bWVudG8ucGRmJyxcbiAgICAgICAgcGRmQnVmZmVyLmxlbmd0aCxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGV0ZWN0ZWRNaW1lVHlwZSkudG9CZSgnYXBwbGljYXRpb24vcGRmJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpbGVFeHRlbnNpb24pLnRvQmUoJ3BkZicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVqZWl0YXIgYXJxdWl2byBjb20gZXh0ZW5zw6NvIHBlcmlnb3NhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20oJ2NvbnRlw7pkbyBxdWFscXVlcicpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0b3IudmFsaWRhdGVNaW1lVHlwZShcbiAgICAgICAgYnVmZmVyLFxuICAgICAgICAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyxcbiAgICAgICAgJ21hbHdhcmUuZXhlJyxcbiAgICAgICAgYnVmZmVyLmxlbmd0aCxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnNlY3VyaXR5RmxhZ3M/Lmhhc0Rhbmdlcm91c0V4dGVuc2lvbikudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9Db250YWluKCdFeHRlbnPDo28gZGUgYXJxdWl2byBuw6NvIHBlcm1pdGlkYScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVqZWl0YXIgdGlwbyBNSU1FIGJsb3F1ZWFkbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCdjb250ZcO6ZG8nKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdG9yLnZhbGlkYXRlTWltZVR5cGUoXG4gICAgICAgIGJ1ZmZlcixcbiAgICAgICAgJ3RleHQvamF2YXNjcmlwdCcsXG4gICAgICAgICdzY3JpcHQuanMnLFxuICAgICAgICBidWZmZXIubGVuZ3RoLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc2VjdXJpdHlGbGFncz8uaXNCbG9ja2VkTWltZVR5cGUpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbignVGlwbyBNSU1FIGJsb3F1ZWFkbycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVqZWl0YXIgYXJxdWl2byBxdWUgZXhjZWRlIHRhbWFuaG8gbcOheGltbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCdjb250ZcO6ZG8nKTtcbiAgICAgIGNvbnN0IGxhcmdlU2l6ZSA9IDI1ICogMTAyNCAqIDEwMjQ7IC8vIDI1TUIgKG1haW9yIHF1ZSBvIGxpbWl0ZSBnbG9iYWwpXG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZhbGlkYXRvci52YWxpZGF0ZU1pbWVUeXBlKFxuICAgICAgICBidWZmZXIsXG4gICAgICAgICdhcHBsaWNhdGlvbi9wZGYnLFxuICAgICAgICAnZG9jdW1lbnRvLnBkZicsXG4gICAgICAgIGxhcmdlU2l6ZSxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnNlY3VyaXR5RmxhZ3M/LmV4Y2VlZHNNYXhTaXplKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0NvbnRhaW4oJ2V4Y2VkZSBvIHRhbWFuaG8gbcOheGltbycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZGV0ZWN0YXIgbWlzbWF0Y2ggZW50cmUgdGlwbyBkZWNsYXJhZG8gZSBkZXRlY3RhZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBCdWZmZXIgcXVlIHNpbXVsYSB1bWEgaW1hZ2VtIEpQRUdcbiAgICAgIGNvbnN0IGpwZWdCdWZmZXIgPSBCdWZmZXIuZnJvbShbXG4gICAgICAgIDB4ZmYsXG4gICAgICAgIDB4ZDgsXG4gICAgICAgIDB4ZmYsXG4gICAgICAgIDB4ZTAsIC8vIEpQRUcgbWFnaWMgbnVtYmVyXG4gICAgICAgIC4uLkJ1ZmZlci5mcm9tKCdmYWtlIGpwZWcgY29udGVudCcpLFxuICAgICAgXSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZhbGlkYXRvci52YWxpZGF0ZU1pbWVUeXBlKFxuICAgICAgICBqcGVnQnVmZmVyLFxuICAgICAgICAnYXBwbGljYXRpb24vcGRmJywgLy8gVGlwbyBkZWNsYXJhZG8gaW5jb3JyZXRvXG4gICAgICAgICdpbWFnZW0uanBnJyxcbiAgICAgICAganBlZ0J1ZmZlci5sZW5ndGgsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmlzVmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zZWN1cml0eUZsYWdzPy5tYWdpY051bWJlck1pc21hdGNoKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0NvbnRhaW4oJ27Do28gY29ycmVzcG9uZGUgYW8gdGlwbyByZWFsJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSB2YWxpZGFyIGFycXVpdm8gZGUgdGV4dG8gc2ltcGxlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRleHRCdWZmZXIgPSBCdWZmZXIuZnJvbShcbiAgICAgICAgJ0VzdGUgw6kgdW0gYXJxdWl2byBkZSB0ZXh0byBzaW1wbGVzLlxcbkNvbSBxdWVicmFzIGRlIGxpbmhhLicsXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0b3IudmFsaWRhdGVNaW1lVHlwZShcbiAgICAgICAgdGV4dEJ1ZmZlcixcbiAgICAgICAgJ3RleHQvcGxhaW4nLFxuICAgICAgICAnZG9jdW1lbnRvLnR4dCcsXG4gICAgICAgIHRleHRCdWZmZXIubGVuZ3RoLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kZXRlY3RlZE1pbWVUeXBlKS50b0JlKCd0ZXh0L3BsYWluJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBkZXRlY3RhciBjb250ZcO6ZG8gc3VzcGVpdG8gZW0gYXJxdWl2bycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN1c3BpY2lvdXNCdWZmZXIgPSBCdWZmZXIuZnJvbShgXG4gICAgICAgIENvbnRlw7pkbyBub3JtYWwgZG8gYXJxdWl2b1xuICAgICAgICA8c2NyaXB0PmFsZXJ0KCd4c3MnKTwvc2NyaXB0PlxuICAgICAgICBNYWlzIGNvbnRlw7pkb1xuICAgICAgYCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZhbGlkYXRvci52YWxpZGF0ZU1pbWVUeXBlKFxuICAgICAgICBzdXNwaWNpb3VzQnVmZmVyLFxuICAgICAgICAndGV4dC9wbGFpbicsXG4gICAgICAgICdhcnF1aXZvLnR4dCcsXG4gICAgICAgIHN1c3BpY2lvdXNCdWZmZXIubGVuZ3RoLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc2VjdXJpdHlGbGFncz8uaXNTdXNwaWNpb3VzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zZWN1cml0eUZsYWdzPy5oYXNFbWJlZGRlZENvbnRlbnQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbignY29udGXDumRvIHN1c3BlaXRvJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBkZXRlY3RhciBKYXZhU2NyaXB0IGVtIFBERicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBkZldpdGhKc0J1ZmZlciA9IEJ1ZmZlci5mcm9tKGBcbiAgICAgICAgJVBERi0xLjRcbiAgICAgICAgL0phdmFTY3JpcHQgKGFsZXJ0KCdtYWxpY2lvdXMnKSlcbiAgICAgICAgL0pTIChkb2N1bWVudC5jb29raWUpXG4gICAgICAgIHJlc3RvIGRvIGNvbnRlw7pkbyBQREZcbiAgICAgIGApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0b3IudmFsaWRhdGVNaW1lVHlwZShcbiAgICAgICAgcGRmV2l0aEpzQnVmZmVyLFxuICAgICAgICAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAgICAgJ2RvY3VtZW50by5wZGYnLFxuICAgICAgICBwZGZXaXRoSnNCdWZmZXIubGVuZ3RoLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc2VjdXJpdHlGbGFncz8uaXNTdXNwaWNpb3VzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0NvbnRhaW4oJ0phdmFTY3JpcHQgaW5jb3Jwb3JhZG8nKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGRldGVjdGFyIGFsdGEgZGVuc2lkYWRlIGRlIGNhcmFjdGVyZXMgbsOjby1BU0NJSScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyaWFyIGJ1ZmZlciBjb20gbXVpdG9zIGNhcmFjdGVyZXMgbsOjby1BU0NJSSAocG9zc8OtdmVsIG9mdXNjYcOnw6NvKVxuICAgICAgY29uc3Qgb2JmdXNjYXRlZEJ1ZmZlciA9IEJ1ZmZlci5mcm9tKFxuICAgICAgICAndGV4dG8nICsgJ1xceDgwXFx4ODFcXHg4MlxceDgzXFx4ODRcXHg4NVxceDg2XFx4ODdcXHg4OFxceDg5Jy5yZXBlYXQoMjApLFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdG9yLnZhbGlkYXRlTWltZVR5cGUoXG4gICAgICAgIG9iZnVzY2F0ZWRCdWZmZXIsXG4gICAgICAgICd0ZXh0L3BsYWluJyxcbiAgICAgICAgJ2FycXVpdm8udHh0JyxcbiAgICAgICAgb2JmdXNjYXRlZEJ1ZmZlci5sZW5ndGgsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmlzVmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zZWN1cml0eUZsYWdzPy5pc1N1c3BpY2lvdXMpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbignY2FyYWN0ZXJlcyBuw6NvLUFTQ0lJJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZW5lcmF0ZUZpbGVIYXNoJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGdlcmFyIGhhc2ggU0hBMjU2IGNvbnNpc3RlbnRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20oJ2NvbnRlw7pkbyBkZSB0ZXN0ZScpO1xuXG4gICAgICBjb25zdCBoYXNoMSA9IHZhbGlkYXRvci5nZW5lcmF0ZUZpbGVIYXNoKGJ1ZmZlcik7XG4gICAgICBjb25zdCBoYXNoMiA9IHZhbGlkYXRvci5nZW5lcmF0ZUZpbGVIYXNoKGJ1ZmZlcik7XG5cbiAgICAgIGV4cGVjdChoYXNoMSkudG9CZShoYXNoMik7XG4gICAgICBleHBlY3QoaGFzaDEpLnRvSGF2ZUxlbmd0aCg2NCk7IC8vIFNIQTI1NiBlbSBoZXhcbiAgICAgIGV4cGVjdChoYXNoMSkudG9NYXRjaCgvXlthLWYwLTldezY0fSQvKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGdlcmFyIGhhc2hlcyBkaWZlcmVudGVzIHBhcmEgY29udGXDumRvcyBkaWZlcmVudGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgYnVmZmVyMSA9IEJ1ZmZlci5mcm9tKCdjb250ZcO6ZG8gMScpO1xuICAgICAgY29uc3QgYnVmZmVyMiA9IEJ1ZmZlci5mcm9tKCdjb250ZcO6ZG8gMicpO1xuXG4gICAgICBjb25zdCBoYXNoMSA9IHZhbGlkYXRvci5nZW5lcmF0ZUZpbGVIYXNoKGJ1ZmZlcjEpO1xuICAgICAgY29uc3QgaGFzaDIgPSB2YWxpZGF0b3IuZ2VuZXJhdGVGaWxlSGFzaChidWZmZXIyKTtcblxuICAgICAgZXhwZWN0KGhhc2gxKS5ub3QudG9CZShoYXNoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZXF1aXJlc0VuY3J5cHRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgdHJ1ZSBwYXJhIGRvY3VtZW50b3Mgc2Vuc8OtdmVpcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNlbnNpdGl2ZVR5cGVzID0gW1xuICAgICAgICAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAgICAgJ2FwcGxpY2F0aW9uL21zd29yZCcsXG4gICAgICAgICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudCcsXG4gICAgICBdO1xuXG4gICAgICBzZW5zaXRpdmVUeXBlcy5mb3JFYWNoKChtaW1lVHlwZSkgPT4ge1xuICAgICAgICBleHBlY3QodmFsaWRhdG9yLnJlcXVpcmVzRW5jcnlwdGlvbihtaW1lVHlwZSkpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIGZhbHNlIHBhcmEgaW1hZ2VucycsICgpID0+IHtcbiAgICAgIGNvbnN0IGltYWdlVHlwZXMgPSBbJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvcG5nJ107XG5cbiAgICAgIGltYWdlVHlwZXMuZm9yRWFjaCgobWltZVR5cGUpID0+IHtcbiAgICAgICAgZXhwZWN0KHZhbGlkYXRvci5yZXF1aXJlc0VuY3J5cHRpb24obWltZVR5cGUpKS50b0JlKGZhbHNlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYWxsb3dzVGh1bWJuYWlsJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIHRydWUgcGFyYSBpbWFnZW5zJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW1hZ2VUeXBlcyA9IFsnaW1hZ2UvanBlZycsICdpbWFnZS9wbmcnXTtcblxuICAgICAgaW1hZ2VUeXBlcy5mb3JFYWNoKChtaW1lVHlwZSkgPT4ge1xuICAgICAgICBleHBlY3QodmFsaWRhdG9yLmFsbG93c1RodW1ibmFpbChtaW1lVHlwZSkpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIHRydWUgcGFyYSBQREZzJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci5hbGxvd3NUaHVtYm5haWwoJ2FwcGxpY2F0aW9uL3BkZicpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgZmFsc2UgcGFyYSBkb2N1bWVudG9zIGRvIE9mZmljZScsICgpID0+IHtcbiAgICAgIGNvbnN0IG9mZmljZVR5cGVzID0gW1xuICAgICAgICAnYXBwbGljYXRpb24vbXN3b3JkJyxcbiAgICAgICAgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50JyxcbiAgICAgICAgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0JyxcbiAgICAgIF07XG5cbiAgICAgIG9mZmljZVR5cGVzLmZvckVhY2goKG1pbWVUeXBlKSA9PiB7XG4gICAgICAgIGV4cGVjdCh2YWxpZGF0b3IuYWxsb3dzVGh1bWJuYWlsKG1pbWVUeXBlKSkudG9CZShmYWxzZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FuYWx5emVGaWxlQ29udGVudCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBkZXRlY3RhciB0YWdzIGRlIHNjcmlwdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBCdWZmZXIuZnJvbSgnPHNjcmlwdD5hbGVydChcInhzc1wiKTwvc2NyaXB0PicpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0b3JbJ2FuYWx5emVGaWxlQ29udGVudCddKGNvbnRlbnQsICd0ZXh0L2h0bWwnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1N1c3BpY2lvdXMpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lmhhc0VtYmVkZGVkQ29udGVudCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVhc29uKS50b0NvbnRhaW4oJ3NjcmlwdCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZGV0ZWN0YXIgVVJMcyBqYXZhc2NyaXB0JywgKCkgPT4ge1xuICAgICAgY29uc3QgY29udGVudCA9IEJ1ZmZlci5mcm9tKCdocmVmPVwiamF2YXNjcmlwdDphbGVydCgxKVwiJyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRvclsnYW5hbHl6ZUZpbGVDb250ZW50J10oY29udGVudCwgJ3RleHQvaHRtbCcpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmlzU3VzcGljaW91cykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuaGFzRW1iZWRkZWRDb250ZW50KS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZGV0ZWN0YXIgZXZlbnQgaGFuZGxlcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb250ZW50ID0gQnVmZmVyLmZyb20oJzxpbWcgb25sb2FkPVwibWFsaWNpb3VzKClcIiAvPicpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0b3JbJ2FuYWx5emVGaWxlQ29udGVudCddKGNvbnRlbnQsICd0ZXh0L2h0bWwnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1N1c3BpY2lvdXMpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lmhhc0VtYmVkZGVkQ29udGVudCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGRldGVjdGFyIG51bGwgYnl0ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb250ZW50ID0gQnVmZmVyLmZyb20oJ3RleHRvXFx4MDBjb21cXHgwMG51bGxcXHgwMGJ5dGVzJyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRvclsnYW5hbHl6ZUZpbGVDb250ZW50J10oY29udGVudCwgJ3RleHQvcGxhaW4nKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1N1c3BpY2lvdXMpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnbsOjbyBkZXZlIGRldGVjdGFyIGNvbnRlw7pkbyBub3JtYWwgY29tbyBzdXNwZWl0bycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBCdWZmZXIuZnJvbShgXG4gICAgICAgIEVzdGUgw6kgdW0gZG9jdW1lbnRvIG5vcm1hbC5cbiAgICAgICAgQ29udMOpbSB0ZXh0bywgbsO6bWVyb3MgMTIzIGUgcG9udHVhw6fDo28hXG4gICAgICAgIEVtYWlsOiB1c3VhcmlvQGV4ZW1wbG8uY29tXG4gICAgICAgIFVSTDogaHR0cHM6Ly9leGVtcGxvLmNvbVxuICAgICAgYCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRvclsnYW5hbHl6ZUZpbGVDb250ZW50J10oY29udGVudCwgJ3RleHQvcGxhaW4nKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1N1c3BpY2lvdXMpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5oYXNFbWJlZGRlZENvbnRlbnQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXh0cmFjdEZpbGVFeHRlbnNpb24nLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgZXh0cmFpciBleHRlbnPDo28gY29ycmV0YW1lbnRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdENhc2VzID0gW1xuICAgICAgICB7IGZpbGVuYW1lOiAnZG9jdW1lbnRvLnBkZicsIGV4cGVjdGVkOiAncGRmJyB9LFxuICAgICAgICB7IGZpbGVuYW1lOiAnaW1hZ2VtLkpQRUcnLCBleHBlY3RlZDogJ2pwZWcnIH0sXG4gICAgICAgIHsgZmlsZW5hbWU6ICdhcnF1aXZvLmNvbS5leHRlbnNhby50eHQnLCBleHBlY3RlZDogJ3R4dCcgfSxcbiAgICAgICAgeyBmaWxlbmFtZTogJ3NlbV9leHRlbnNhbycsIGV4cGVjdGVkOiAnJyB9LFxuICAgICAgICB7IGZpbGVuYW1lOiAnLmhpZGRlbicsIGV4cGVjdGVkOiAnaGlkZGVuJyB9LFxuICAgICAgXTtcblxuICAgICAgdGVzdENhc2VzLmZvckVhY2goKHsgZmlsZW5hbWUsIGV4cGVjdGVkIH0pID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdG9yWydleHRyYWN0RmlsZUV4dGVuc2lvbiddKGZpbGVuYW1lKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShleHBlY3RlZCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ludGVncmHDp8OjbyBjb20gY29uZmlndXJhw6fDo28nLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgdXNhciBjb25maWd1cmHDp8O1ZXMgZG8gZG9jdW1lbnRvLmNvbmZpZycsICgpID0+IHtcbiAgICAgIC8vIFZlcmlmaWNhciBzZSBvcyB0aXBvcyBwZXJtaXRpZG9zIGVzdMOjbyBzZW5kbyB1c2Fkb3NcbiAgICAgIGNvbnN0IGFsbG93ZWRUeXBlcyA9IE9iamVjdC52YWx1ZXMoTUlNRV9UWVBFX0NPTkZJR1MpLmZsYXRNYXAoXG4gICAgICAgIChjb25maWcpID0+IGNvbmZpZy5taW1lVHlwZXMsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoYWxsb3dlZFR5cGVzKS50b0NvbnRhaW4oJ2FwcGxpY2F0aW9uL3BkZicpO1xuICAgICAgZXhwZWN0KGFsbG93ZWRUeXBlcykudG9Db250YWluKCdpbWFnZS9qcGVnJyk7XG4gICAgICBleHBlY3QoYWxsb3dlZFR5cGVzKS50b0NvbnRhaW4oJ3RleHQvcGxhaW4nKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHVzYXIgdGlwb3MgYmxvcXVlYWRvcyBkYSBjb25maWd1cmHDp8OjbycsICgpID0+IHtcbiAgICAgIGV4cGVjdChCTE9DS0VEX01JTUVfVFlQRVMpLnRvQ29udGFpbigndGV4dC9qYXZhc2NyaXB0Jyk7XG4gICAgICBleHBlY3QoQkxPQ0tFRF9NSU1FX1RZUEVTKS50b0NvbnRhaW4oJ2FwcGxpY2F0aW9uL3ppcCcpO1xuICAgICAgZXhwZWN0KEJMT0NLRURfTUlNRV9UWVBFUykudG9Db250YWluKCdpbWFnZS9zdmcreG1sJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjYXNvcyBkZSB1c28gcmVhaXMnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcHJvY2Vzc2FyIHVwbG9hZCBkZSBjZXJ0aWTDo28gZGUgbmFzY2ltZW50byAoUERGKScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBkZkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKFtcbiAgICAgICAgMHgyNSxcbiAgICAgICAgMHg1MCxcbiAgICAgICAgMHg0NCxcbiAgICAgICAgMHg0NiwgLy8gJVBERlxuICAgICAgICAuLi5CdWZmZXIuZnJvbSgnLTEuNFxcbkNlcnRpZMOjbyBkZSBOYXNjaW1lbnRvXFxuTm9tZTogSm/Do28gZGEgU2lsdmEnKSxcbiAgICAgIF0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0b3IudmFsaWRhdGVNaW1lVHlwZShcbiAgICAgICAgcGRmQnVmZmVyLFxuICAgICAgICAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAgICAgJ2NlcnRpZGFvX25hc2NpbWVudG8ucGRmJyxcbiAgICAgICAgcGRmQnVmZmVyLmxlbmd0aCxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGV0ZWN0ZWRNaW1lVHlwZSkudG9CZSgnYXBwbGljYXRpb24vcGRmJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBwcm9jZXNzYXIgdXBsb2FkIGRlIGZvdG8gZGUgZG9jdW1lbnRvIChKUEVHKScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGpwZWdCdWZmZXIgPSBCdWZmZXIuZnJvbShbXG4gICAgICAgIDB4ZmYsXG4gICAgICAgIDB4ZDgsXG4gICAgICAgIDB4ZmYsXG4gICAgICAgIDB4ZTAsIC8vIEpQRUcgbWFnaWNcbiAgICAgICAgLi4uQnVmZmVyLmZyb20oJ2Zha2UganBlZyBpbWFnZSBkYXRhJyksXG4gICAgICBdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdG9yLnZhbGlkYXRlTWltZVR5cGUoXG4gICAgICAgIGpwZWdCdWZmZXIsXG4gICAgICAgICdpbWFnZS9qcGVnJyxcbiAgICAgICAgJ2ZvdG9fZG9jdW1lbnRvLmpwZycsXG4gICAgICAgIGpwZWdCdWZmZXIubGVuZ3RoLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kZXRlY3RlZE1pbWVUeXBlKS50b0JlKCdpbWFnZS9qcGVnJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZWplaXRhciB0ZW50YXRpdmEgZGUgdXBsb2FkIGRlIG1hbHdhcmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtYWx3YXJlQnVmZmVyID0gQnVmZmVyLmZyb20oJ01aXFx4OTBcXHgwMCcpOyAvLyBQRSBoZWFkZXJcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdG9yLnZhbGlkYXRlTWltZVR5cGUoXG4gICAgICAgIG1hbHdhcmVCdWZmZXIsXG4gICAgICAgICdhcHBsaWNhdGlvbi9wZGYnLFxuICAgICAgICAnZG9jdW1lbnRvLmV4ZScsXG4gICAgICAgIG1hbHdhcmVCdWZmZXIubGVuZ3RoLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc2VjdXJpdHlGbGFncz8uaGFzRGFuZ2Vyb3VzRXh0ZW5zaW9uKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9