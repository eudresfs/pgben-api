d0b1c5c23370f3888046b4768d6a263d
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var EmailChannelService_1;
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.EmailChannelService = void 0;
const common_1 = require("@nestjs/common");
const config_1 = require("@nestjs/config");
const template_renderer_service_1 = require("../services/template-renderer.service");
/**
 * Implementação do canal de notificação por e-mail
 *
 * Responsável pelo envio de notificações através de e-mail utilizando
 * o serviço SMTP configurado no sistema
 */
let EmailChannelService = EmailChannelService_1 = class EmailChannelService {
    configService;
    templateRenderer;
    canal_id = 'email';
    logger = new common_1.Logger(EmailChannelService_1.name);
    constructor(configService, templateRenderer) {
        this.configService = configService;
        this.templateRenderer = templateRenderer;
    }
    /**
     * Envia uma notificação por e-mail
     *
     * @param notificacao Notificação a ser enviada
     * @returns Resultado do envio
     */
    async enviar(notificacao) {
        try {
            this.logger.log(`Iniciando envio de email para destinatário: ${notificacao.destinatario_id}`);
            // Obter template relacionado à notificação
            const template = notificacao.template;
            if (!template.canais_suportados.includes('email')) {
                throw new Error(`Template ${template.id} não suporta o canal de email`);
            }
            // Renderizar template com os dados de contexto
            const { assunto, conteudo } = this.templateRenderer.renderizarNotificacao(template, notificacao.dados_contexto);
            // Simula a integração com um serviço de email (como Nodemailer)
            // Na implementação real, isso se conectaria ao serviço SMTP configurado
            await this.simularEnvioEmail(notificacao.destinatario_id, assunto, conteudo);
            const dataEnvio = new Date();
            this.logger.log(`Email enviado com sucesso para ${notificacao.destinatario_id}`);
            return {
                sucesso: true,
                mensagem: 'Email enviado com sucesso',
                data_envio: dataEnvio,
                dados_resposta: {
                    canal: 'email',
                    destinatario: notificacao.destinatario_id,
                    assunto,
                },
            };
        }
        catch (error) {
            this.logger.error(`Erro ao enviar email para ${notificacao.destinatario_id}: ${error.message}`, error.stack);
            return {
                sucesso: false,
                mensagem: `Falha ao enviar email: ${error.message}`,
                data_envio: new Date(),
                erro: error,
            };
        }
    }
    /**
     * Verifica se o canal de email está disponível para envio
     *
     * @returns Status de disponibilidade
     */
    async verificarDisponibilidade() {
        try {
            // Verificar configurações SMTP e conectividade
            const smtpHost = this.configService.get('EMAIL_SMTP_HOST');
            const smtpPort = this.configService.get('EMAIL_SMTP_PORT');
            if (!smtpHost || !smtpPort) {
                this.logger.warn('Configurações SMTP incompletas ou ausentes');
                return false;
            }
            // Na implementação real, poderia testar conectividade ao servidor SMTP
            return true;
        }
        catch (error) {
            this.logger.error(`Erro ao verificar disponibilidade do canal de email: ${error.message}`);
            return false;
        }
    }
    /**
     * Método para simular o envio de email (apenas para demonstração)
     * Na implementação real, seria substituído pela integração com um serviço como Nodemailer
     */
    async simularEnvioEmail(destinatario, assunto, conteudo) {
        // Simula latência de rede e processamento
        await new Promise((resolve) => setTimeout(resolve, 100));
        this.logger.debug(`
      === SIMULAÇÃO DE EMAIL ===
      Para: ${destinatario}
      Assunto: ${assunto}
      Conteúdo: ${conteudo.substring(0, 100)}${conteudo.length > 100 ? '...' : ''}
      ==========================
    `);
        // Simulação de registro para fins de auditoria
        this.registrarEnvioAuditoria(destinatario, assunto);
    }
    /**
     * Registra o envio de email no sistema de auditoria
     * Integração com o módulo de auditoria existente no sistema
     */
    registrarEnvioAuditoria(destinatario, assunto) {
        this.logger.debug(`Registrando envio de email em logs de auditoria: ${destinatario} - ${assunto}`);
        // Na implementação real, integraria com o serviço de auditoria do sistema
    }
};
exports.EmailChannelService = EmailChannelService;
exports.EmailChannelService = EmailChannelService = EmailChannelService_1 = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof config_1.ConfigService !== "undefined" && config_1.ConfigService) === "function" ? _a : Object, typeof (_b = typeof template_renderer_service_1.TemplateRendererService !== "undefined" && template_renderer_service_1.TemplateRendererService) === "function" ? _b : Object])
], EmailChannelService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXG5vdGlmaWNhY2FvXFxjaGFubmVsc1xcZW1haWwtY2hhbm5lbC5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQW9EO0FBQ3BELDJDQUErQztBQU0vQyxxRkFBZ0Y7QUFFaEY7Ozs7O0dBS0c7QUFFSSxJQUFNLG1CQUFtQiwyQkFBekIsTUFBTSxtQkFBbUI7SUFLcEI7SUFDQTtJQUxELFFBQVEsR0FBRyxPQUFPLENBQUM7SUFDWCxNQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMscUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFL0QsWUFDVSxhQUE0QixFQUM1QixnQkFBeUM7UUFEekMsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDNUIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUF5QjtJQUNoRCxDQUFDO0lBRUo7Ozs7O09BS0c7SUFDSCxLQUFLLENBQUMsTUFBTSxDQUFDLFdBQStCO1FBQzFDLElBQUksQ0FBQztZQUNILElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUNiLCtDQUErQyxXQUFXLENBQUMsZUFBZSxFQUFFLENBQzdFLENBQUM7WUFFRiwyQ0FBMkM7WUFDM0MsTUFBTSxRQUFRLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FBQztZQUV0QyxJQUFJLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxPQUFjLENBQUMsRUFBRSxDQUFDO2dCQUN6RCxNQUFNLElBQUksS0FBSyxDQUFDLFlBQVksUUFBUSxDQUFDLEVBQUUsK0JBQStCLENBQUMsQ0FBQztZQUMxRSxDQUFDO1lBRUQsK0NBQStDO1lBQy9DLE1BQU0sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLHFCQUFxQixDQUN2RSxRQUFRLEVBQ1IsV0FBVyxDQUFDLGNBQWMsQ0FDM0IsQ0FB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QUE7QUFySVksa0RBQW1COzhCQUFuQixtQkFBbUI7SUFEL0IsSUFBQSxtQkFBVSxHQUFFO3lEQU1jLHNCQUFhLG9CQUFiLHNCQUFhLG9EQUNWLG1EQUF1QixvQkFBdkIsbURBQXVCO0dBTnhDLG1CQUFtQixDQXFJL0IiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXG5vdGlmaWNhY2FvXFxjaGFubmVsc1xcZW1haWwtY2hhbm5lbC5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIExvZ2dlciB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IENvbmZpZ1NlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2NvbmZpZyc7XG5pbXBvcnQge1xuICBDYW5hbE5vdGlmaWNhY2FvLFxuICBSZXN1bHRhZG9FbnZpbyxcbn0gZnJvbSAnLi4vaW50ZXJmYWNlcy9ub3RpZmljYXRpb24tY2hhbm5lbC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgTm90aWZpY2FjYW9TaXN0ZW1hLCBOb3RpZmljYXRpb25UZW1wbGF0ZSB9IGZyb20gJy4uLy4uLy4uL2VudGl0aWVzJztcbmltcG9ydCB7IFRlbXBsYXRlUmVuZGVyZXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvdGVtcGxhdGUtcmVuZGVyZXIuc2VydmljZSc7XG5cbi8qKlxuICogSW1wbGVtZW50YcOnw6NvIGRvIGNhbmFsIGRlIG5vdGlmaWNhw6fDo28gcG9yIGUtbWFpbFxuICpcbiAqIFJlc3BvbnPDoXZlbCBwZWxvIGVudmlvIGRlIG5vdGlmaWNhw6fDtWVzIGF0cmF2w6lzIGRlIGUtbWFpbCB1dGlsaXphbmRvXG4gKiBvIHNlcnZpw6dvIFNNVFAgY29uZmlndXJhZG8gbm8gc2lzdGVtYVxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRW1haWxDaGFubmVsU2VydmljZSBpbXBsZW1lbnRzIENhbmFsTm90aWZpY2FjYW8ge1xuICByZWFkb25seSBjYW5hbF9pZCA9ICdlbWFpbCc7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihFbWFpbENoYW5uZWxTZXJ2aWNlLm5hbWUpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgY29uZmlnU2VydmljZTogQ29uZmlnU2VydmljZSxcbiAgICBwcml2YXRlIHRlbXBsYXRlUmVuZGVyZXI6IFRlbXBsYXRlUmVuZGVyZXJTZXJ2aWNlLFxuICApIHt9XG5cbiAgLyoqXG4gICAqIEVudmlhIHVtYSBub3RpZmljYcOnw6NvIHBvciBlLW1haWxcbiAgICpcbiAgICogQHBhcmFtIG5vdGlmaWNhY2FvIE5vdGlmaWNhw6fDo28gYSBzZXIgZW52aWFkYVxuICAgKiBAcmV0dXJucyBSZXN1bHRhZG8gZG8gZW52aW9cbiAgICovXG4gIGFzeW5jIGVudmlhcihub3RpZmljYWNhbzogTm90aWZpY2FjYW9TaXN0ZW1hKTogUHJvbWlzZTxSZXN1bHRhZG9FbnZpbz4ge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgIGBJbmljaWFuZG8gZW52aW8gZGUgZW1haWwgcGFyYSBkZXN0aW5hdMOhcmlvOiAke25vdGlmaWNhY2FvLmRlc3RpbmF0YXJpb19pZH1gLFxuICAgICAgKTtcblxuICAgICAgLy8gT2J0ZXIgdGVtcGxhdGUgcmVsYWNpb25hZG8gw6Agbm90aWZpY2HDp8Ojb1xuICAgICAgY29uc3QgdGVtcGxhdGUgPSBub3RpZmljYWNhby50ZW1wbGF0ZTtcblxuICAgICAgaWYgKCF0ZW1wbGF0ZS5jYW5haXNfc3Vwb3J0YWRvcy5pbmNsdWRlcygnZW1haWwnIGFzIGFueSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUZW1wbGF0ZSAke3RlbXBsYXRlLmlkfSBuw6NvIHN1cG9ydGEgbyBjYW5hbCBkZSBlbWFpbGApO1xuICAgICAgfVxuXG4gICAgICAvLyBSZW5kZXJpemFyIHRlbXBsYXRlIGNvbSBvcyBkYWRvcyBkZSBjb250ZXh0b1xuICAgICAgY29uc3QgeyBhc3N1bnRvLCBjb250ZXVkbyB9ID0gdGhpcy50ZW1wbGF0ZVJlbmRlcmVyLnJlbmRlcml6YXJOb3RpZmljYWNhbyhcbiAgICAgICAgdGVtcGxhdGUsXG4gICAgICAgIG5vdGlmaWNhY2FvLmRhZG9zX2NvbnRleHRvLFxuICAgICAgKTtcblxuICAgICAgLy8gU2ltdWxhIGEgaW50ZWdyYcOnw6NvIGNvbSB1bSBzZXJ2acOnbyBkZSBlbWFpbCAoY29tbyBOb2RlbWFpbGVyKVxuICAgICAgLy8gTmEgaW1wbGVtZW50YcOnw6NvIHJlYWwsIGlzc28gc2UgY29uZWN0YXJpYSBhbyBzZXJ2acOnbyBTTVRQIGNvbmZpZ3VyYWRvXG4gICAgICBhd2FpdCB0aGlzLnNpbXVsYXJFbnZpb0VtYWlsKFxuICAgICAgICBub3RpZmljYWNhby5kZXN0aW5hdGFyaW9faWQsXG4gICAgICAgIGFzc3VudG8sXG4gICAgICAgIGNvbnRldWRvLFxuICAgICAgKTtcblxuICAgICAgY29uc3QgZGF0YUVudmlvID0gbmV3IERhdGUoKTtcblxuICAgICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgICBgRW1haWwgZW52aWFkbyBjb20gc3VjZXNzbyBwYXJhICR7bm90aWZpY2FjYW8uZGVzdGluYXRhcmlvX2lkfWAsXG4gICAgICApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNlc3NvOiB0cnVlLFxuICAgICAgICBtZW5zYWdlbTogJ0VtYWlsIGVudmlhZG8gY29tIHN1Y2Vzc28nLFxuICAgICAgICBkYXRhX2VudmlvOiBkYXRhRW52aW8sXG4gICAgICAgIGRhZG9zX3Jlc3Bvc3RhOiB7XG4gICAgICAgICAgY2FuYWw6ICdlbWFpbCcsXG4gICAgICAgICAgZGVzdGluYXRhcmlvOiBub3RpZmljYWNhby5kZXN0aW5hdGFyaW9faWQsXG4gICAgICAgICAgYXNzdW50byxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJybyBhbyBlbnZpYXIgZW1haWwgcGFyYSAke25vdGlmaWNhY2FvLmRlc3RpbmF0YXJpb19pZH06ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICBlcnJvci5zdGFjayxcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Vzc286IGZhbHNlLFxuICAgICAgICBtZW5zYWdlbTogYEZhbGhhIGFvIGVudmlhciBlbWFpbDogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICAgIGRhdGFfZW52aW86IG5ldyBEYXRlKCksXG4gICAgICAgIGVycm86IGVycm9yLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBjYW5hbCBkZSBlbWFpbCBlc3TDoSBkaXNwb27DrXZlbCBwYXJhIGVudmlvXG4gICAqXG4gICAqIEByZXR1cm5zIFN0YXR1cyBkZSBkaXNwb25pYmlsaWRhZGVcbiAgICovXG4gIGFzeW5jIHZlcmlmaWNhckRpc3BvbmliaWxpZGFkZSgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVmVyaWZpY2FyIGNvbmZpZ3VyYcOnw7VlcyBTTVRQIGUgY29uZWN0aXZpZGFkZVxuICAgICAgY29uc3Qgc210cEhvc3QgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0PHN0cmluZz4oJ0VNQUlMX1NNVFBfSE9TVCcpO1xuICAgICAgY29uc3Qgc210cFBvcnQgPSB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0PG51bWJlcj4oJ0VNQUlMX1NNVFBfUE9SVCcpO1xuXG4gICAgICBpZiAoIXNtdHBIb3N0IHx8ICFzbXRwUG9ydCkge1xuICAgICAgICB0aGlzLmxvZ2dlci53YXJuKCdDb25maWd1cmHDp8O1ZXMgU01UUCBpbmNvbXBsZXRhcyBvdSBhdXNlbnRlcycpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIC8vIE5hIGltcGxlbWVudGHDp8OjbyByZWFsLCBwb2RlcmlhIHRlc3RhciBjb25lY3RpdmlkYWRlIGFvIHNlcnZpZG9yIFNNVFBcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gdmVyaWZpY2FyIGRpc3BvbmliaWxpZGFkZSBkbyBjYW5hbCBkZSBlbWFpbDogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNw6l0b2RvIHBhcmEgc2ltdWxhciBvIGVudmlvIGRlIGVtYWlsIChhcGVuYXMgcGFyYSBkZW1vbnN0cmHDp8OjbylcbiAgICogTmEgaW1wbGVtZW50YcOnw6NvIHJlYWwsIHNlcmlhIHN1YnN0aXR1w61kbyBwZWxhIGludGVncmHDp8OjbyBjb20gdW0gc2VydmnDp28gY29tbyBOb2RlbWFpbGVyXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNpbXVsYXJFbnZpb0VtYWlsKFxuICAgIGRlc3RpbmF0YXJpbzogc3RyaW5nLFxuICAgIGFzc3VudG86IHN0cmluZyxcbiAgICBjb250ZXVkbzogc3RyaW5nLFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBTaW11bGEgbGF0w6puY2lhIGRlIHJlZGUgZSBwcm9jZXNzYW1lbnRvXG4gICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG5cbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgXG4gICAgICA9PT0gU0lNVUxBw4fDg08gREUgRU1BSUwgPT09XG4gICAgICBQYXJhOiAke2Rlc3RpbmF0YXJpb31cbiAgICAgIEFzc3VudG86ICR7YXNzdW50b31cbiAgICAgIENvbnRlw7pkbzogJHtjb250ZXVkby5zdWJzdHJpbmcoMCwgMTAwKX0ke2NvbnRldWRvLmxlbmd0aCA+IDEwMCA/ICcuLi4nIDogJyd9XG4gICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIGApO1xuXG4gICAgLy8gU2ltdWxhw6fDo28gZGUgcmVnaXN0cm8gcGFyYSBmaW5zIGRlIGF1ZGl0b3JpYVxuICAgIHRoaXMucmVnaXN0cmFyRW52aW9BdWRpdG9yaWEoZGVzdGluYXRhcmlvLCBhc3N1bnRvKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RyYSBvIGVudmlvIGRlIGVtYWlsIG5vIHNpc3RlbWEgZGUgYXVkaXRvcmlhXG4gICAqIEludGVncmHDp8OjbyBjb20gbyBtw7NkdWxvIGRlIGF1ZGl0b3JpYSBleGlzdGVudGUgbm8gc2lzdGVtYVxuICAgKi9cbiAgcHJpdmF0ZSByZWdpc3RyYXJFbnZpb0F1ZGl0b3JpYShkZXN0aW5hdGFyaW86IHN0cmluZywgYXNzdW50bzogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5sb2dnZXIuZGVidWcoXG4gICAgICBgUmVnaXN0cmFuZG8gZW52aW8gZGUgZW1haWwgZW0gbG9ncyBkZSBhdWRpdG9yaWE6ICR7ZGVzdGluYXRhcmlvfSAtICR7YXNzdW50b31gLFxuICAgICk7XG4gICAgLy8gTmEgaW1wbGVtZW50YcOnw6NvIHJlYWwsIGludGVncmFyaWEgY29tIG8gc2VydmnDp28gZGUgYXVkaXRvcmlhIGRvIHNpc3RlbWFcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9