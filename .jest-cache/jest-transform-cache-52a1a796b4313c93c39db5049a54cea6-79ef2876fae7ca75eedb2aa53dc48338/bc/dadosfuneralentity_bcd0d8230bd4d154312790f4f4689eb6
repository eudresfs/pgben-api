da79d4e87e662ac9ce50bde27e796800
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g, _h;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DadosFuneral = void 0;
const typeorm_1 = require("typeorm");
const class_validator_1 = require("class-validator");
const solicitacao_entity_1 = require("./solicitacao.entity");
const enums_1 = require("../enums");
/**
 * Entidade para armazenar dados específicos do cidadão para Auxílio Funeral
 *
 * Armazena informações específicas necessárias para a solicitação do benefício
 * de Auxílio Funeral, como dados do falecido, tipo de urna, etc.
 */
let DadosFuneral = class DadosFuneral {
    id;
    solicitacao_id;
    solicitacao;
    nome_completo_falecido;
    data_obito;
    local_obito;
    data_autorizacao;
    grau_parentesco_requerente;
    tipo_urna_necessaria;
    observacoes_especiais;
    numero_certidao_obito;
    cartorio_emissor;
    created_at;
    updated_at;
    removed_at;
    // Getters
    get createdAt() {
        return this.created_at;
    }
    get updatedAt() {
        return this.updated_at;
    }
    get removedAt() {
        return this.removed_at;
    }
    // Métodos Utilitários
    /**
     * Verifica se é parente de primeiro grau
     */
    isParentePrimeiroGrau() {
        const primeiroGrau = [
            enums_1.ParentescoEnum.CONJUGE,
            enums_1.ParentescoEnum.FILHO,
            enums_1.ParentescoEnum.PAI,
            enums_1.ParentescoEnum.MAE,
        ];
        return primeiroGrau.includes(this.grau_parentesco_requerente);
    }
    /**
     * Verifica se é parente de segundo grau
     */
    isParenteSegundoGrau() {
        const segundoGrau = [
            enums_1.ParentescoEnum.IRMAO,
            enums_1.ParentescoEnum.AVO,
            enums_1.ParentescoEnum.NETO
        ];
        return segundoGrau.includes(this.grau_parentesco_requerente);
    }
    /**
     * Calcula dias entre óbito e solicitação
     */
    calcularDiasAposObito() {
        const hoje = new Date();
        const dataObito = new Date(this.data_obito);
        const diffTime = Math.abs(hoje.getTime() - dataObito.getTime());
        return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    }
    /**
     * Verifica se está no prazo para solicitação
     */
    estaNoPrazoSolicitacao(prazoMaximoDias) {
        return this.calcularDiasAposObito() <= prazoMaximoDias;
    }
    /**
     * Verifica se é caso de urgência (óbito recente)
     */
    isCasoUrgencia() {
        return this.calcularDiasAposObito() <= 3;
    }
    /**
     * Determina prioridade baseada no grau de parentesco
     */
    calcularPrioridadeParentesco() {
        if (this.isParentePrimeiroGrau())
            return 100;
        if (this.isParenteSegundoGrau())
            return 80;
        return 60;
    }
    /**
     * Verifica se precisa de urna especial
     */
    precisaUrnaEspecial() {
        return [
            enums_1.TipoUrnaEnum.INFANTIL,
            enums_1.TipoUrnaEnum.ESPECIAL,
            enums_1.TipoUrnaEnum.OBESO,
        ].includes(this.tipo_urna_necessaria);
    }
    /**
     * Valida se os dados estão completos para submissão
     */
    validarDadosCompletos() {
        const erros = [];
        if (!this.nome_completo_falecido || this.nome_completo_falecido.trim().length === 0) {
            erros.push('Nome completo do falecido é obrigatório');
        }
        if (!this.data_obito) {
            erros.push('Data do óbito é obrigatória');
        }
        if (!this.local_obito || this.local_obito.trim().length === 0) {
            erros.push('Local do óbito é obrigatório');
        }
        if (!this.data_autorizacao) {
            erros.push('Data da autorização é obrigatória');
        }
        if (!this.grau_parentesco_requerente) {
            erros.push('Grau de parentesco do requerente é obrigatório');
        }
        if (!this.tipo_urna_necessaria) {
            erros.push('Tipo de urna necessária é obrigatório');
        }
        // Validação de datas
        if (this.data_obito && this.data_autorizacao) {
            const dataObito = new Date(this.data_obito);
            const dataAutorizacao = new Date(this.data_autorizacao);
            if (dataObito > dataAutorizacao) {
                erros.push('Data da autorização não pode ser anterior à data do óbito');
            }
        }
        return {
            valido: erros.length === 0,
            erros
        };
    }
};
exports.DadosFuneral = DadosFuneral;
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)('uuid'),
    __metadata("design:type", String)
], DadosFuneral.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_validator_1.IsNotEmpty)({ message: 'ID da solicitação é obrigatório' }),
    __metadata("design:type", String)
], DadosFuneral.prototype, "solicitacao_id", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => solicitacao_entity_1.Solicitacao, { onDelete: 'CASCADE' }),
    (0, typeorm_1.JoinColumn)({ name: 'solicitacao_id' }),
    __metadata("design:type", typeof (_a = typeof solicitacao_entity_1.Solicitacao !== "undefined" && solicitacao_entity_1.Solicitacao) === "function" ? _a : Object)
], DadosFuneral.prototype, "solicitacao", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_validator_1.IsNotEmpty)({ message: 'Nome completo do falecido é obrigatório' }),
    __metadata("design:type", String)
], DadosFuneral.prototype, "nome_completo_falecido", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'date' }),
    (0, class_validator_1.IsNotEmpty)({ message: 'Data do óbito é obrigatória' }),
    (0, class_validator_1.IsDateString)({}, { message: 'Data do óbito deve ser uma data válida' }),
    __metadata("design:type", typeof (_b = typeof Date !== "undefined" && Date) === "function" ? _b : Object)
], DadosFuneral.prototype, "data_obito", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_validator_1.IsNotEmpty)({ message: 'Local do óbito é obrigatório' }),
    __metadata("design:type", String)
], DadosFuneral.prototype, "local_obito", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'date' }),
    (0, class_validator_1.IsNotEmpty)({ message: 'Data da autorização é obrigatória' }),
    (0, class_validator_1.IsDateString)({}, { message: 'Data da autorização deve ser uma data válida' }),
    __metadata("design:type", typeof (_c = typeof Date !== "undefined" && Date) === "function" ? _c : Object)
], DadosFuneral.prototype, "data_autorizacao", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'enum',
        enum: enums_1.ParentescoEnum,
        enumName: 'grau_parentesco',
    }),
    (0, class_validator_1.IsNotEmpty)({ message: 'Grau de parentesco é obrigatório' }),
    (0, class_validator_1.IsEnum)(enums_1.ParentescoEnum, { message: 'Grau de parentesco inválido' }),
    __metadata("design:type", typeof (_d = typeof enums_1.ParentescoEnum !== "undefined" && enums_1.ParentescoEnum) === "function" ? _d : Object)
], DadosFuneral.prototype, "grau_parentesco_requerente", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'enum',
        enum: enums_1.TipoUrnaEnum,
        enumName: 'tipo_urna',
    }),
    (0, class_validator_1.IsNotEmpty)({ message: 'Tipo de urna é obrigatório' }),
    (0, class_validator_1.IsEnum)(enums_1.TipoUrnaEnum, { message: 'Tipo de urna inválido' }),
    __metadata("design:type", typeof (_e = typeof enums_1.TipoUrnaEnum !== "undefined" && enums_1.TipoUrnaEnum) === "function" ? _e : Object)
], DadosFuneral.prototype, "tipo_urna_necessaria", void 0);
__decorate([
    (0, typeorm_1.Column)('text', { nullable: true }),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", String)
], DadosFuneral.prototype, "observacoes_especiais", void 0);
__decorate([
    (0, typeorm_1.Column)({ nullable: true }),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", String)
], DadosFuneral.prototype, "numero_certidao_obito", void 0);
__decorate([
    (0, typeorm_1.Column)({ nullable: true }),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", String)
], DadosFuneral.prototype, "cartorio_emissor", void 0);
__decorate([
    (0, typeorm_1.CreateDateColumn)(),
    __metadata("design:type", typeof (_f = typeof Date !== "undefined" && Date) === "function" ? _f : Object)
], DadosFuneral.prototype, "created_at", void 0);
__decorate([
    (0, typeorm_1.UpdateDateColumn)(),
    __metadata("design:type", typeof (_g = typeof Date !== "undefined" && Date) === "function" ? _g : Object)
], DadosFuneral.prototype, "updated_at", void 0);
__decorate([
    (0, typeorm_1.DeleteDateColumn)(),
    __metadata("design:type", typeof (_h = typeof Date !== "undefined" && Date) === "function" ? _h : Object)
], DadosFuneral.prototype, "removed_at", void 0);
exports.DadosFuneral = DadosFuneral = __decorate([
    (0, typeorm_1.Entity)('dados_funeral'),
    (0, typeorm_1.Index)(['solicitacao_id'], { unique: true })
], DadosFuneral);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGVudGl0aWVzXFxkYWRvcy1mdW5lcmFsLmVudGl0eS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEscUNBVWlCO0FBQ2pCLHFEQUt5QjtBQUN6Qiw2REFBbUQ7QUFDbkQsb0NBQXdEO0FBR3hEOzs7OztHQUtHO0FBR0ksSUFBTSxZQUFZLEdBQWxCLE1BQU0sWUFBWTtJQUV2QixFQUFFLENBQVM7SUFJWCxjQUFjLENBQVM7SUFJdkIsV0FBVyxDQUFjO0lBSXpCLHNCQUFzQixDQUFTO0lBSy9CLFVBQVUsQ0FBTztJQUlqQixXQUFXLENBQVM7SUFLcEIsZ0JBQWdCLENBQU87SUFTdkIsMEJBQTBCLENBQWlCO0lBUzNDLG9CQUFvQixDQUFlO0lBSW5DLHFCQUFxQixDQUFVO0lBSS9CLHFCQUFxQixDQUFVO0lBSS9CLGdCQUFnQixDQUFVO0lBRzFCLFVBQVUsQ0FBTztJQUdqQixVQUFVLENBQU87SUFHakIsVUFBVSxDQUFPO0lBRWpCLFVBQVU7SUFDVixJQUFJLFNBQVM7UUFDWCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDekIsQ0FBQztJQUVELElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN6QixDQUFDO0lBRUQsSUFBSSxTQUFTO1FBQ1gsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxzQkFBc0I7SUFFdEI7O09BRUc7SUFDSCxxQkFBcUI7UUFDbkIsTUFBTSxZQUFZLEdBQUc7WUFDbkIsc0JBQWMsQ0FBQyxPQUFPO1lBQ3RCLHNCQUFjLENBQUMsS0FBSztZQUNwQixzQkFBYyxDQUFDLEdBQUc7WUFDbEIsc0JBQWMsQ0FBQyxHQUFHO1NBQ25CLENBQUM7UUFFRixPQUFPLFlBQVksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUM7SUFDaEUsQ0FBQztJQUVEOztPQUVHO0lBQ0gsb0JBQW9CO1FBQ2xCLE1BQU0sV0FBVyxHQUFHO1lBQ2xCLHNCQUFjLENBQUMsS0FBSztZQUNwQixzQkFBYyxDQUFDLEdBQUc7WUFDbEIsc0JBQWMsQ0FBQyxJQUFJO1NBQ3BCLENBQUM7UUFFRixPQUFPLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUM7SUFDL0QsQ0FBQztJQUVEOztPQUVHO0lBQ0gscUJBQXFCO1FBQ25CLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDeEIsTUFBTSxTQUFTLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzVDLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLFNBQVMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBQ2hFLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFFRDs7T0FFRztJQUNILHNCQUFzQixDQUFDLGVBQXVCO1FBQzVDLE9BQU8sSUFBSSxDQUFDLHFCQUFxQixFQUFFLElBQUksZUFBZSxDQUFDO0lBQ3pELENBQUM7SUFFRDs7T0FFRztJQUNILGNBQWM7UUFDWixPQUFPLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCw0QkFBNEI7UUFDMUIsSUFBSSxJQUFJLENBQUMscUJBQXFCLEVBQUU7WUFBRSxPQUFPLEdBQUcsQ0FBQztRQUM3QyxJQUFJLElBQUksQ0FBQyxvQkFBb0IsRUFBRTtZQUFFLE9BQU8sRUFBRSxDQUFDO1FBQzNDLE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztJQUVEOztPQUVHO0lBQ0gsbUJBQW1CO1FBQ2pCLE9BQU87WUFDTCxvQkFBWSxDQUFDLFFBQVE7WUFDckIsb0JBQVksQ0FBQyxRQUFRO1lBQ3JCLG9CQUFZLENBQUMsS0FBSztTQUNuQixDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxxQkFBcUI7UUFDbkIsTUFBTSxLQUFLLEdBQWEsRUFBRSxDQUFDO1FBRTNCLElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLElBQUksSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksRUFBRSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUNwRixLQUFLLENBQUMsSUFBSSxDQUFDLHlDQUF5QyxDQUFDLENBQUM7UUFDeEQsQ0FBQztRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDckIsS0FBSyxDQUFDLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1FBQzVDLENBQUM7UUFFRCxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUM5RCxLQUFLLENBQUMsSUFBSSxDQUFDLDhCQUE4QixDQUFDLENBQUM7UUFDN0MsQ0FBQztRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUMzQixLQUFLLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxDQUFDLENBQUM7UUFDbEQsQ0FBQztRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsMEJBQTBCLEVBQUUsQ0FBQztZQUNyQyxLQUFLLENBQUMsSUFBSSxDQUFDLGdEQUFnRCxDQUFDLENBQUM7UUFDL0QsQ0FBQztRQUVELElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztZQUMvQixLQUFLLENBQUMsSUFBSSxDQUFDLHVDQUF1QyxDQUFDLENBQUM7UUFDdEQsQ0FBQztRQUVELHFCQUFxQjtRQUNyQixJQUFJLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDN0MsTUFBTSxTQUFTLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzVDLE1BQU0sZUFBZSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBRXhELElBQUksU0FBUyxHQUFHLGVBQWUsRUFBRSxDQUFDO2dCQUNoQyxLQUFLLENBQUMsSUFBSSxDQUFDLDJEQUEyRCxDQUFDLENBQUM7WUFDMUUsQ0FBQztRQUNILENBQUM7UUFFRCxPQUFPO1lBQ0wsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQztZQUMxQixLQUFLO1NBQ04sQ0FBQztJQUNKLENBQUM7Q0FDRixDQUFBO0FBeE1ZLG9DQUFZO0FBRXZCO0lBREMsSUFBQSxnQ0FBc0IsRUFBQyxNQUFNLENBQUM7O3dDQUNwQjtBQUlYO0lBRkMsSUFBQSxnQkFBTSxHQUFFO0lBQ1IsSUFBQSw0QkFBVSxFQUFDLEVBQUUsT0FBTyxFQUFFLGlDQUFpQyxFQUFFLENBQUM7O29EQUNwQztBQUl2QjtJQUZDLElBQUEsbUJBQVMsRUFBQyxHQUFHLEVBQUUsQ0FBQyxnQ0FBVyxFQUFFLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxDQUFDO0lBQ3JELElBQUEsb0JBQVUsRUFBQyxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxDQUFDO2tEQUMxQixnQ0FBVyxvQkFBWCxnQ0FBVztpREFBQztBQUl6QjtJQUZDLElBQUEsZ0JBQU0sR0FBRTtJQUNSLElBQUEsNEJBQVUsRUFBQyxFQUFFLE9BQU8sRUFBRSx5Q0FBeUMsRUFBRSxDQUFDOzs0REFDcEM7QUFLL0I7SUFIQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLENBQUM7SUFDeEIsSUFBQSw0QkFBVSxFQUFDLEVBQUUsT0FBTyxFQUFFLDZCQUE2QixFQUFFLENBQUM7SUFDdEQsSUFBQSw4QkFBWSxFQUFDLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSx3Q0FBd0MsRUFBRSxDQUFDO2tEQUM1RCxJQUFJLG9CQUFKLElBQUk7Z0RBQUM7QUFJakI7SUFGQyxJQUFBLGdCQUFNLEdBQUU7SUFDUixJQUFBLDRCQUFVLEVBQUMsRUFBRSxPQUFPLEVBQUUsOEJBQThCLEVBQUUsQ0FBQzs7aURBQ3BDO0FBS3BCO0lBSEMsSUFBQSxnQkFBTSxFQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDO0lBQ3hCLElBQUEsNEJBQVUsRUFBQyxFQUFFLE9BQU8sRUFBRSxtQ0FBbUMsRUFBRSxDQUFDO0lBQzVELElBQUEsOEJBQVksRUFBQyxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsOENBQThDLEVBQUUsQ0FBQztrREFDNUQsSUFBSSxvQkFBSixJQUFJO3NEQUFDO0FBU3ZCO0lBUEMsSUFBQSxnQkFBTSxFQUFDO1FBQ04sSUFBSSxFQUFFLE1BQU07UUFDWixJQUFJLEVBQUUsc0JBQWM7UUFDcEIsUUFBUSxFQUFFLGlCQUFpQjtLQUM1QixDQUFDO0lBQ0QsSUFBQSw0QkFBVSxFQUFDLEVBQUUsT0FBTyxFQUFFLGtDQUFrQyxFQUFFLENBQUM7SUFDM0QsSUFBQSx3QkFBTSxFQUFDLHNCQUFjLEVBQUUsRUFBRSxPQUFPLEVBQUUsNkJBQTZCLEVBQUUsQ0FBQztrREFDdkMsc0JBQWMsb0JBQWQsc0JBQWM7Z0VBQUM7QUFTM0M7SUFQQyxJQUFBLGdCQUFNLEVBQUM7UUFDTixJQUFJLEVBQUUsTUFBTTtRQUNaLElBQUksRUFBRSxvQkFBWTtRQUNsQixRQUFRLEVBQUUsV0FBVztLQUN0QixDQUFDO0lBQ0QsSUFBQSw0QkFBVSxFQUFDLEVBQUUsT0FBTyxFQUFFLDRCQUE0QixFQUFFLENBQUM7SUFDckQsSUFBQSx3QkFBTSxFQUFDLG9CQUFZLEVBQUUsRUFBRSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsQ0FBQztrREFDckMsb0JBQVksb0JBQVosb0JBQVk7MERBQUM7QUFJbkM7SUFGQyxJQUFBLGdCQUFNLEVBQUMsTUFBTSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDO0lBQ2xDLElBQUEsNEJBQVUsR0FBRTs7MkRBQ2tCO0FBSS9CO0lBRkMsSUFBQSxnQkFBTSxFQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDO0lBQzFCLElBQUEsNEJBQVUsR0FBRTs7MkRBQ2tCO0FBSS9CO0lBRkMsSUFBQSxnQkFBTSxFQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDO0lBQzFCLElBQUEsNEJBQVUsR0FBRTs7c0RBQ2E7QUFHMUI7SUFEQyxJQUFBLDBCQUFnQixHQUFFO2tEQUNQLElBQUksb0JBQUosSUFBSTtnREFBQztBQUdqQjtJQURDLElBQUEsMEJBQWdCLEdBQUU7a0RBQ1AsSUFBSSxvQkFBSixJQUFJO2dEQUFDO0FBR2pCO0lBREMsSUFBQSwwQkFBZ0IsR0FBRTtrREFDUCxJQUFJLG9CQUFKLElBQUk7Z0RBQUM7dUJBbkVOLFlBQVk7SUFGeEIsSUFBQSxnQkFBTSxFQUFDLGVBQWUsQ0FBQztJQUN2QixJQUFBLGVBQUssRUFBQyxDQUFDLGdCQUFnQixDQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7R0FDL0IsWUFBWSxDQXdNeEIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGVudGl0aWVzXFxkYWRvcy1mdW5lcmFsLmVudGl0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBFbnRpdHksXG4gIFByaW1hcnlHZW5lcmF0ZWRDb2x1bW4sXG4gIENvbHVtbixcbiAgQ3JlYXRlRGF0ZUNvbHVtbixcbiAgVXBkYXRlRGF0ZUNvbHVtbixcbiAgRGVsZXRlRGF0ZUNvbHVtbixcbiAgTWFueVRvT25lLFxuICBKb2luQ29sdW1uLFxuICBJbmRleCxcbn0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQge1xuICBJc05vdEVtcHR5LFxuICBJc0RhdGVTdHJpbmcsXG4gIElzRW51bSxcbiAgSXNPcHRpb25hbCxcbn0gZnJvbSAnY2xhc3MtdmFsaWRhdG9yJztcbmltcG9ydCB7IFNvbGljaXRhY2FvIH0gZnJvbSAnLi9zb2xpY2l0YWNhby5lbnRpdHknO1xuaW1wb3J0IHsgVGlwb1VybmFFbnVtLCBQYXJlbnRlc2NvRW51bSB9IGZyb20gJy4uL2VudW1zJztcblxuXG4vKipcbiAqIEVudGlkYWRlIHBhcmEgYXJtYXplbmFyIGRhZG9zIGVzcGVjw61maWNvcyBkbyBjaWRhZMOjbyBwYXJhIEF1eMOtbGlvIEZ1bmVyYWxcbiAqXG4gKiBBcm1hemVuYSBpbmZvcm1hw6fDtWVzIGVzcGVjw61maWNhcyBuZWNlc3PDoXJpYXMgcGFyYSBhIHNvbGljaXRhw6fDo28gZG8gYmVuZWbDrWNpb1xuICogZGUgQXV4w61saW8gRnVuZXJhbCwgY29tbyBkYWRvcyBkbyBmYWxlY2lkbywgdGlwbyBkZSB1cm5hLCBldGMuXG4gKi9cbkBFbnRpdHkoJ2RhZG9zX2Z1bmVyYWwnKVxuQEluZGV4KFsnc29saWNpdGFjYW9faWQnXSwgeyB1bmlxdWU6IHRydWUgfSlcbmV4cG9ydCBjbGFzcyBEYWRvc0Z1bmVyYWwge1xuICBAUHJpbWFyeUdlbmVyYXRlZENvbHVtbigndXVpZCcpXG4gIGlkOiBzdHJpbmc7XG5cbiAgQENvbHVtbigpXG4gIEBJc05vdEVtcHR5KHsgbWVzc2FnZTogJ0lEIGRhIHNvbGljaXRhw6fDo28gw6kgb2JyaWdhdMOzcmlvJyB9KVxuICBzb2xpY2l0YWNhb19pZDogc3RyaW5nO1xuXG4gIEBNYW55VG9PbmUoKCkgPT4gU29saWNpdGFjYW8sIHsgb25EZWxldGU6ICdDQVNDQURFJyB9KVxuICBASm9pbkNvbHVtbih7IG5hbWU6ICdzb2xpY2l0YWNhb19pZCcgfSlcbiAgc29saWNpdGFjYW86IFNvbGljaXRhY2FvO1xuXG4gIEBDb2x1bW4oKVxuICBASXNOb3RFbXB0eSh7IG1lc3NhZ2U6ICdOb21lIGNvbXBsZXRvIGRvIGZhbGVjaWRvIMOpIG9icmlnYXTDs3JpbycgfSlcbiAgbm9tZV9jb21wbGV0b19mYWxlY2lkbzogc3RyaW5nO1xuXG4gIEBDb2x1bW4oeyB0eXBlOiAnZGF0ZScgfSlcbiAgQElzTm90RW1wdHkoeyBtZXNzYWdlOiAnRGF0YSBkbyDDs2JpdG8gw6kgb2JyaWdhdMOzcmlhJyB9KVxuICBASXNEYXRlU3RyaW5nKHt9LCB7IG1lc3NhZ2U6ICdEYXRhIGRvIMOzYml0byBkZXZlIHNlciB1bWEgZGF0YSB2w6FsaWRhJyB9KVxuICBkYXRhX29iaXRvOiBEYXRlO1xuXG4gIEBDb2x1bW4oKVxuICBASXNOb3RFbXB0eSh7IG1lc3NhZ2U6ICdMb2NhbCBkbyDDs2JpdG8gw6kgb2JyaWdhdMOzcmlvJyB9KVxuICBsb2NhbF9vYml0bzogc3RyaW5nO1xuXG4gIEBDb2x1bW4oeyB0eXBlOiAnZGF0ZScgfSlcbiAgQElzTm90RW1wdHkoeyBtZXNzYWdlOiAnRGF0YSBkYSBhdXRvcml6YcOnw6NvIMOpIG9icmlnYXTDs3JpYScgfSlcbiAgQElzRGF0ZVN0cmluZyh7fSwgeyBtZXNzYWdlOiAnRGF0YSBkYSBhdXRvcml6YcOnw6NvIGRldmUgc2VyIHVtYSBkYXRhIHbDoWxpZGEnIH0pXG4gIGRhdGFfYXV0b3JpemFjYW86IERhdGU7XG5cbiAgQENvbHVtbih7XG4gICAgdHlwZTogJ2VudW0nLFxuICAgIGVudW06IFBhcmVudGVzY29FbnVtLFxuICAgIGVudW1OYW1lOiAnZ3JhdV9wYXJlbnRlc2NvJyxcbiAgfSlcbiAgQElzTm90RW1wdHkoeyBtZXNzYWdlOiAnR3JhdSBkZSBwYXJlbnRlc2NvIMOpIG9icmlnYXTDs3JpbycgfSlcbiAgQElzRW51bShQYXJlbnRlc2NvRW51bSwgeyBtZXNzYWdlOiAnR3JhdSBkZSBwYXJlbnRlc2NvIGludsOhbGlkbycgfSlcbiAgZ3JhdV9wYXJlbnRlc2NvX3JlcXVlcmVudGU6IFBhcmVudGVzY29FbnVtO1xuXG4gIEBDb2x1bW4oe1xuICAgIHR5cGU6ICdlbnVtJyxcbiAgICBlbnVtOiBUaXBvVXJuYUVudW0sXG4gICAgZW51bU5hbWU6ICd0aXBvX3VybmEnLFxuICB9KVxuICBASXNOb3RFbXB0eSh7IG1lc3NhZ2U6ICdUaXBvIGRlIHVybmEgw6kgb2JyaWdhdMOzcmlvJyB9KVxuICBASXNFbnVtKFRpcG9Vcm5hRW51bSwgeyBtZXNzYWdlOiAnVGlwbyBkZSB1cm5hIGludsOhbGlkbycgfSlcbiAgdGlwb191cm5hX25lY2Vzc2FyaWE6IFRpcG9Vcm5hRW51bTtcblxuICBAQ29sdW1uKCd0ZXh0JywgeyBudWxsYWJsZTogdHJ1ZSB9KVxuICBASXNPcHRpb25hbCgpXG4gIG9ic2VydmFjb2VzX2VzcGVjaWFpcz86IHN0cmluZztcblxuICBAQ29sdW1uKHsgbnVsbGFibGU6IHRydWUgfSlcbiAgQElzT3B0aW9uYWwoKVxuICBudW1lcm9fY2VydGlkYW9fb2JpdG8/OiBzdHJpbmc7XG5cbiAgQENvbHVtbih7IG51bGxhYmxlOiB0cnVlIH0pXG4gIEBJc09wdGlvbmFsKClcbiAgY2FydG9yaW9fZW1pc3Nvcj86IHN0cmluZztcblxuICBAQ3JlYXRlRGF0ZUNvbHVtbigpXG4gIGNyZWF0ZWRfYXQ6IERhdGU7XG5cbiAgQFVwZGF0ZURhdGVDb2x1bW4oKVxuICB1cGRhdGVkX2F0OiBEYXRlO1xuXG4gIEBEZWxldGVEYXRlQ29sdW1uKClcbiAgcmVtb3ZlZF9hdDogRGF0ZTtcblxuICAvLyBHZXR0ZXJzXG4gIGdldCBjcmVhdGVkQXQoKTogRGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlZF9hdDtcbiAgfVxuXG4gIGdldCB1cGRhdGVkQXQoKTogRGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMudXBkYXRlZF9hdDtcbiAgfVxuXG4gIGdldCByZW1vdmVkQXQoKTogRGF0ZSB7XG4gICAgcmV0dXJuIHRoaXMucmVtb3ZlZF9hdDtcbiAgfVxuXG4gIC8vIE3DqXRvZG9zIFV0aWxpdMOhcmlvc1xuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSDDqSBwYXJlbnRlIGRlIHByaW1laXJvIGdyYXVcbiAgICovXG4gIGlzUGFyZW50ZVByaW1laXJvR3JhdSgpOiBib29sZWFuIHtcbiAgICBjb25zdCBwcmltZWlyb0dyYXUgPSBbXG4gICAgICBQYXJlbnRlc2NvRW51bS5DT05KVUdFLFxuICAgICAgUGFyZW50ZXNjb0VudW0uRklMSE8sXG4gICAgICBQYXJlbnRlc2NvRW51bS5QQUksXG4gICAgICBQYXJlbnRlc2NvRW51bS5NQUUsXG4gICAgXTtcbiAgICBcbiAgICByZXR1cm4gcHJpbWVpcm9HcmF1LmluY2x1ZGVzKHRoaXMuZ3JhdV9wYXJlbnRlc2NvX3JlcXVlcmVudGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIMOpIHBhcmVudGUgZGUgc2VndW5kbyBncmF1XG4gICAqL1xuICBpc1BhcmVudGVTZWd1bmRvR3JhdSgpOiBib29sZWFuIHtcbiAgICBjb25zdCBzZWd1bmRvR3JhdSA9IFtcbiAgICAgIFBhcmVudGVzY29FbnVtLklSTUFPLFxuICAgICAgUGFyZW50ZXNjb0VudW0uQVZPLFxuICAgICAgUGFyZW50ZXNjb0VudW0uTkVUT1xuICAgIF07XG4gICAgXG4gICAgcmV0dXJuIHNlZ3VuZG9HcmF1LmluY2x1ZGVzKHRoaXMuZ3JhdV9wYXJlbnRlc2NvX3JlcXVlcmVudGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGEgZGlhcyBlbnRyZSDDs2JpdG8gZSBzb2xpY2l0YcOnw6NvXG4gICAqL1xuICBjYWxjdWxhckRpYXNBcG9zT2JpdG8oKTogbnVtYmVyIHtcbiAgICBjb25zdCBob2plID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBkYXRhT2JpdG8gPSBuZXcgRGF0ZSh0aGlzLmRhdGFfb2JpdG8pO1xuICAgIGNvbnN0IGRpZmZUaW1lID0gTWF0aC5hYnMoaG9qZS5nZXRUaW1lKCkgLSBkYXRhT2JpdG8uZ2V0VGltZSgpKTtcbiAgICByZXR1cm4gTWF0aC5jZWlsKGRpZmZUaW1lIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBlc3TDoSBubyBwcmF6byBwYXJhIHNvbGljaXRhw6fDo29cbiAgICovXG4gIGVzdGFOb1ByYXpvU29saWNpdGFjYW8ocHJhem9NYXhpbW9EaWFzOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jYWxjdWxhckRpYXNBcG9zT2JpdG8oKSA8PSBwcmF6b01heGltb0RpYXM7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2Ugw6kgY2FzbyBkZSB1cmfDqm5jaWEgKMOzYml0byByZWNlbnRlKVxuICAgKi9cbiAgaXNDYXNvVXJnZW5jaWEoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY2FsY3VsYXJEaWFzQXBvc09iaXRvKCkgPD0gMztcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmEgcHJpb3JpZGFkZSBiYXNlYWRhIG5vIGdyYXUgZGUgcGFyZW50ZXNjb1xuICAgKi9cbiAgY2FsY3VsYXJQcmlvcmlkYWRlUGFyZW50ZXNjbygpOiBudW1iZXIge1xuICAgIGlmICh0aGlzLmlzUGFyZW50ZVByaW1laXJvR3JhdSgpKSByZXR1cm4gMTAwO1xuICAgIGlmICh0aGlzLmlzUGFyZW50ZVNlZ3VuZG9HcmF1KCkpIHJldHVybiA4MDtcbiAgICByZXR1cm4gNjA7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgcHJlY2lzYSBkZSB1cm5hIGVzcGVjaWFsXG4gICAqL1xuICBwcmVjaXNhVXJuYUVzcGVjaWFsKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBbXG4gICAgICBUaXBvVXJuYUVudW0uSU5GQU5USUwsXG4gICAgICBUaXBvVXJuYUVudW0uRVNQRUNJQUwsXG4gICAgICBUaXBvVXJuYUVudW0uT0JFU08sXG4gICAgXS5pbmNsdWRlcyh0aGlzLnRpcG9fdXJuYV9uZWNlc3NhcmlhKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGEgc2Ugb3MgZGFkb3MgZXN0w6NvIGNvbXBsZXRvcyBwYXJhIHN1Ym1pc3PDo29cbiAgICovXG4gIHZhbGlkYXJEYWRvc0NvbXBsZXRvcygpOiB7IHZhbGlkbzogYm9vbGVhbjsgZXJyb3M6IHN0cmluZ1tdIH0ge1xuICAgIGNvbnN0IGVycm9zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKCF0aGlzLm5vbWVfY29tcGxldG9fZmFsZWNpZG8gfHwgdGhpcy5ub21lX2NvbXBsZXRvX2ZhbGVjaWRvLnRyaW0oKS5sZW5ndGggPT09IDApIHtcbiAgICAgIGVycm9zLnB1c2goJ05vbWUgY29tcGxldG8gZG8gZmFsZWNpZG8gw6kgb2JyaWdhdMOzcmlvJyk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmRhdGFfb2JpdG8pIHtcbiAgICAgIGVycm9zLnB1c2goJ0RhdGEgZG8gw7NiaXRvIMOpIG9icmlnYXTDs3JpYScpO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5sb2NhbF9vYml0byB8fCB0aGlzLmxvY2FsX29iaXRvLnRyaW0oKS5sZW5ndGggPT09IDApIHtcbiAgICAgIGVycm9zLnB1c2goJ0xvY2FsIGRvIMOzYml0byDDqSBvYnJpZ2F0w7NyaW8nKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuZGF0YV9hdXRvcml6YWNhbykge1xuICAgICAgZXJyb3MucHVzaCgnRGF0YSBkYSBhdXRvcml6YcOnw6NvIMOpIG9icmlnYXTDs3JpYScpO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5ncmF1X3BhcmVudGVzY29fcmVxdWVyZW50ZSkge1xuICAgICAgZXJyb3MucHVzaCgnR3JhdSBkZSBwYXJlbnRlc2NvIGRvIHJlcXVlcmVudGUgw6kgb2JyaWdhdMOzcmlvJyk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnRpcG9fdXJuYV9uZWNlc3NhcmlhKSB7XG4gICAgICBlcnJvcy5wdXNoKCdUaXBvIGRlIHVybmEgbmVjZXNzw6FyaWEgw6kgb2JyaWdhdMOzcmlvJyk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhw6fDo28gZGUgZGF0YXNcbiAgICBpZiAodGhpcy5kYXRhX29iaXRvICYmIHRoaXMuZGF0YV9hdXRvcml6YWNhbykge1xuICAgICAgY29uc3QgZGF0YU9iaXRvID0gbmV3IERhdGUodGhpcy5kYXRhX29iaXRvKTtcbiAgICAgIGNvbnN0IGRhdGFBdXRvcml6YWNhbyA9IG5ldyBEYXRlKHRoaXMuZGF0YV9hdXRvcml6YWNhbyk7XG4gICAgICBcbiAgICAgIGlmIChkYXRhT2JpdG8gPiBkYXRhQXV0b3JpemFjYW8pIHtcbiAgICAgICAgZXJyb3MucHVzaCgnRGF0YSBkYSBhdXRvcml6YcOnw6NvIG7Do28gcG9kZSBzZXIgYW50ZXJpb3Igw6AgZGF0YSBkbyDDs2JpdG8nKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdmFsaWRvOiBlcnJvcy5sZW5ndGggPT09IDAsXG4gICAgICBlcnJvc1xuICAgIH07XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=