0fddada535bfe910bae9ed38168b308a
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", { value: true });
exports.MetricasValoresController = void 0;
const common_1 = require("@nestjs/common");
const swagger_1 = require("@nestjs/swagger");
const jwt_auth_guard_1 = require("../../../shared/guards/jwt-auth.guard");
const roles_guard_1 = require("../../../auth/guards/roles.guard");
const role_decorator_1 = require("../../../auth/decorators/role.decorator");
const roles_constants_1 = require("../../../shared/constants/roles.constants");
const metricas_service_1 = require("../services/metricas.service");
const metricas_coleta_service_1 = require("../services/metricas-coleta.service");
const metrica_snapshot_dto_1 = require("../dto/metrica-snapshot.dto");
/**
 * Controlador para consulta de valores de métricas
 *
 * Este controlador fornece endpoints para:
 * 1. Consultar o valor atual de uma métrica
 * 2. Obter séries históricas de valores
 * 3. Comparar valores entre períodos
 * 4. Executar coleta manual de métricas
 */
let MetricasValoresController = class MetricasValoresController {
    metricasService;
    metricasColetaService;
    constructor(metricasService, metricasColetaService) {
        this.metricasService = metricasService;
        this.metricasColetaService = metricasColetaService;
    }
    /**
     * Obtém o valor atual de uma métrica específica
     */
    async obterValorAtual(codigo, query) {
        // Temporariamente retornando dados mockados até que o método seja implementado
        return {
            metrica: codigo,
            valor: 42,
            unidade: '%',
            timestamp: new Date(),
            dimensoes: query.dimensoes || {},
        };
    }
    /**
     * Obtém a série histórica de valores de uma métrica
     */
    async obterSerieHistorica(codigo, query) {
        // Temporariamente retornando dados mockados até que o método seja implementado
        return {
            metrica: codigo,
            dados: [
                { timestamp: new Date(query.data_inicial), valor: 35 },
                { timestamp: new Date(Date.now()), valor: 42 },
            ],
            periodo: {
                inicio: query.data_inicial,
                fim: query.data_final,
            },
            dimensoes: query.dimensoes || {},
        };
    }
    /**
     * Compara valores de uma métrica entre períodos
     */
    async compararPeriodos(codigo, periodo1Inicio, periodo1Fim, periodo2Inicio, periodo2Fim, granularidade) {
        // Temporariamente retornando dados mockados até que o método seja implementado
        return {
            metrica: codigo,
            periodo1: {
                inicio: periodo1Inicio,
                fim: periodo1Fim,
                valor: 35,
            },
            periodo2: {
                inicio: periodo2Inicio,
                fim: periodo2Fim,
                valor: 42,
            },
            variacao: {
                absoluta: 7,
                percentual: 20,
            },
            granularidade: granularidade || 'dia',
        };
    }
    /**
     * Executa coleta manual de uma métrica
     */
    async executarColetaManual(dto) {
        return this.metricasColetaService.coletarMetricaManual(dto.codigo, dto.dimensoes);
    }
};
exports.MetricasValoresController = MetricasValoresController;
__decorate([
    (0, common_1.Get)(':codigo'),
    (0, role_decorator_1.Roles)(roles_constants_1.ROLES.ADMIN, roles_constants_1.ROLES.GESTOR, roles_constants_1.ROLES.TECNICO),
    (0, swagger_1.ApiOperation)({ summary: 'Obtém o valor atual de uma métrica' }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Valor da métrica retornado com sucesso',
    }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Métrica não encontrada' }),
    __param(0, (0, common_1.Param)('codigo')),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, typeof (_c = typeof metrica_snapshot_dto_1.ConsultaValorMetricaDto !== "undefined" && metrica_snapshot_dto_1.ConsultaValorMetricaDto) === "function" ? _c : Object]),
    __metadata("design:returntype", Promise)
], MetricasValoresController.prototype, "obterValorAtual", null);
__decorate([
    (0, common_1.Get)(':codigo/historico'),
    (0, role_decorator_1.Roles)(roles_constants_1.ROLES.ADMIN, roles_constants_1.ROLES.GESTOR, roles_constants_1.ROLES.TECNICO),
    (0, swagger_1.ApiOperation)({ summary: 'Obtém série histórica de valores de uma métrica' }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Série histórica retornada com sucesso',
    }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Métrica não encontrada' }),
    __param(0, (0, common_1.Param)('codigo')),
    __param(1, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, typeof (_d = typeof metrica_snapshot_dto_1.ConsultaSerieTemporalDto !== "undefined" && metrica_snapshot_dto_1.ConsultaSerieTemporalDto) === "function" ? _d : Object]),
    __metadata("design:returntype", Promise)
], MetricasValoresController.prototype, "obterSerieHistorica", null);
__decorate([
    (0, common_1.Get)(':codigo/comparativo'),
    (0, role_decorator_1.Roles)(roles_constants_1.ROLES.ADMIN, roles_constants_1.ROLES.GESTOR, roles_constants_1.ROLES.TECNICO),
    (0, swagger_1.ApiOperation)({ summary: 'Compara valores de uma métrica entre períodos' }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Comparativo retornado com sucesso',
    }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Métrica não encontrada' }),
    __param(0, (0, common_1.Param)('codigo')),
    __param(1, (0, common_1.Query)('periodo1Inicio')),
    __param(2, (0, common_1.Query)('periodo1Fim')),
    __param(3, (0, common_1.Query)('periodo2Inicio')),
    __param(4, (0, common_1.Query)('periodo2Fim')),
    __param(5, (0, common_1.Query)('granularidade')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, typeof (_e = typeof Date !== "undefined" && Date) === "function" ? _e : Object, typeof (_f = typeof Date !== "undefined" && Date) === "function" ? _f : Object, typeof (_g = typeof Date !== "undefined" && Date) === "function" ? _g : Object, typeof (_h = typeof Date !== "undefined" && Date) === "function" ? _h : Object, String]),
    __metadata("design:returntype", Promise)
], MetricasValoresController.prototype, "compararPeriodos", null);
__decorate([
    (0, common_1.Post)('coleta-manual'),
    (0, role_decorator_1.Roles)(roles_constants_1.ROLES.ADMIN, roles_constants_1.ROLES.GESTOR),
    (0, swagger_1.ApiOperation)({ summary: 'Executa coleta manual de uma métrica' }),
    (0, swagger_1.ApiResponse)({ status: 201, description: 'Coleta executada com sucesso' }),
    (0, swagger_1.ApiResponse)({ status: 404, description: 'Métrica não encontrada' }),
    __param(0, (0, common_1.Body)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_j = typeof metrica_snapshot_dto_1.ColetaManualMetricaDto !== "undefined" && metrica_snapshot_dto_1.ColetaManualMetricaDto) === "function" ? _j : Object]),
    __metadata("design:returntype", Promise)
], MetricasValoresController.prototype, "executarColetaManual", null);
exports.MetricasValoresController = MetricasValoresController = __decorate([
    (0, swagger_1.ApiTags)('Métricas e Dashboard'),
    (0, swagger_1.ApiBearerAuth)(),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, common_1.Controller)('metricas/valores'),
    __metadata("design:paramtypes", [typeof (_a = typeof metricas_service_1.MetricasService !== "undefined" && metricas_service_1.MetricasService) === "function" ? _a : Object, typeof (_b = typeof metricas_coleta_service_1.MetricasColetaService !== "undefined" && metricas_coleta_service_1.MetricasColetaService) === "function" ? _b : Object])
], MetricasValoresController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXG1ldHJpY2FzXFxjb250cm9sbGVyc1xcbWV0cmljYXMtdmFsb3Jlcy5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FRd0I7QUFDeEIsNkNBS3lCO0FBQ3pCLDBFQUFxRTtBQUNyRSxrRUFBOEQ7QUFDOUQsNEVBQWdFO0FBQ2hFLCtFQUFrRTtBQUVsRSxtRUFBK0Q7QUFDL0QsaUZBQTRFO0FBQzVFLHNFQUlxQztBQUVyQzs7Ozs7Ozs7R0FRRztBQUtJLElBQU0seUJBQXlCLEdBQS9CLE1BQU0seUJBQXlCO0lBRWpCO0lBQ0E7SUFGbkIsWUFDbUIsZUFBZ0MsRUFDaEMscUJBQTRDO1FBRDVDLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUNoQywwQkFBcUIsR0FBckIscUJBQXFCLENBQXVCO0lBQzVELENBQUM7SUFFSjs7T0FFRztJQVNHLEFBQU4sS0FBSyxDQUFDLGVBQWUsQ0FDRixNQUFjLEVBQ3RCLEtBQThCO1FBRXZDLCtFQUErRTtRQUMvRSxPQUFPO1lBQ0wsT0FBTyxFQUFFLE1BQU07WUFDZixLQUFLLEVBQUUsRUFBRTtZQUNULE9BQU8sRUFBRSxHQUFHO1lBQ1osU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO1lBQ3JCLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUyxJQUFJLEVBQUU7U0FDakMsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQVNHLEFBQU4sS0FBSyxDQUFDLG1CQUFtQixDQUNOLE1BQWMsRUFDdEIsS0FBK0I7UUFFeEMsK0VBQStFO1FBQy9FLE9BQU87WUFDTCxPQUFPLEVBQUUsTUFBTTtZQUNmLEtBQUssRUFBRTtnQkFDTCxFQUFFLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRTtnQkFDdEQsRUFB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REFBTSw2Q0FBc0Isb0JBQXRCLDZDQUFzQjs7cUVBSzdEO29DQWxIVSx5QkFBeUI7SUFKckMsSUFBQSxpQkFBTyxFQUFDLHNCQUFzQixDQUFDO0lBQy9CLElBQUEsdUJBQWEsR0FBRTtJQUNmLElBQUEsa0JBQVMsRUFBQyw2QkFBWSxFQUFFLHdCQUFVLENBQUM7SUFDbkMsSUFBQSxtQkFBVSxFQUFDLGtCQUFrQixDQUFDO3lEQUdPLGtDQUFlLG9CQUFmLGtDQUFlLG9EQUNULCtDQUFxQixvQkFBckIsK0NBQXFCO0dBSHBELHlCQUF5QixDQW1IckMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXG1ldHJpY2FzXFxjb250cm9sbGVyc1xcbWV0cmljYXMtdmFsb3Jlcy5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbnRyb2xsZXIsXG4gIEdldCxcbiAgUG9zdCxcbiAgQm9keSxcbiAgUGFyYW0sXG4gIFF1ZXJ5LFxuICBVc2VHdWFyZHMsXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7XG4gIEFwaVRhZ3MsXG4gIEFwaU9wZXJhdGlvbixcbiAgQXBpUmVzcG9uc2UsXG4gIEFwaUJlYXJlckF1dGgsXG59IGZyb20gJ0BuZXN0anMvc3dhZ2dlcic7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IFJvbGVzR3VhcmQgfSBmcm9tICcuLi8uLi8uLi9hdXRoL2d1YXJkcy9yb2xlcy5ndWFyZCc7XG5pbXBvcnQgeyBSb2xlcyB9IGZyb20gJy4uLy4uLy4uL2F1dGgvZGVjb3JhdG9ycy9yb2xlLmRlY29yYXRvcic7XG5pbXBvcnQgeyBST0xFUyB9IGZyb20gJy4uLy4uLy4uL3NoYXJlZC9jb25zdGFudHMvcm9sZXMuY29uc3RhbnRzJztcblxuaW1wb3J0IHsgTWV0cmljYXNTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvbWV0cmljYXMuc2VydmljZSc7XG5pbXBvcnQgeyBNZXRyaWNhc0NvbGV0YVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9tZXRyaWNhcy1jb2xldGEuc2VydmljZSc7XG5pbXBvcnQge1xuICBDb2xldGFNYW51YWxNZXRyaWNhRHRvLFxuICBDb25zdWx0YVZhbG9yTWV0cmljYUR0byxcbiAgQ29uc3VsdGFTZXJpZVRlbXBvcmFsRHRvLFxufSBmcm9tICcuLi9kdG8vbWV0cmljYS1zbmFwc2hvdC5kdG8nO1xuXG4vKipcbiAqIENvbnRyb2xhZG9yIHBhcmEgY29uc3VsdGEgZGUgdmFsb3JlcyBkZSBtw6l0cmljYXNcbiAqXG4gKiBFc3RlIGNvbnRyb2xhZG9yIGZvcm5lY2UgZW5kcG9pbnRzIHBhcmE6XG4gKiAxLiBDb25zdWx0YXIgbyB2YWxvciBhdHVhbCBkZSB1bWEgbcOpdHJpY2FcbiAqIDIuIE9idGVyIHPDqXJpZXMgaGlzdMOzcmljYXMgZGUgdmFsb3Jlc1xuICogMy4gQ29tcGFyYXIgdmFsb3JlcyBlbnRyZSBwZXLDrW9kb3NcbiAqIDQuIEV4ZWN1dGFyIGNvbGV0YSBtYW51YWwgZGUgbcOpdHJpY2FzXG4gKi9cbkBBcGlUYWdzKCdNw6l0cmljYXMgZSBEYXNoYm9hcmQnKVxuQEFwaUJlYXJlckF1dGgoKVxuQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQsIFJvbGVzR3VhcmQpXG5AQ29udHJvbGxlcignbWV0cmljYXMvdmFsb3JlcycpXG5leHBvcnQgY2xhc3MgTWV0cmljYXNWYWxvcmVzQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgbWV0cmljYXNTZXJ2aWNlOiBNZXRyaWNhc1NlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBtZXRyaWNhc0NvbGV0YVNlcnZpY2U6IE1ldHJpY2FzQ29sZXRhU2VydmljZSxcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gbyB2YWxvciBhdHVhbCBkZSB1bWEgbcOpdHJpY2EgZXNwZWPDrWZpY2FcbiAgICovXG4gIEBHZXQoJzpjb2RpZ28nKVxuICBAUm9sZXMoUk9MRVMuQURNSU4sIFJPTEVTLkdFU1RPUiwgUk9MRVMuVEVDTklDTylcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdPYnTDqW0gbyB2YWxvciBhdHVhbCBkZSB1bWEgbcOpdHJpY2EnIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgZGVzY3JpcHRpb246ICdWYWxvciBkYSBtw6l0cmljYSByZXRvcm5hZG8gY29tIHN1Y2Vzc28nLFxuICB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IDQwNCwgZGVzY3JpcHRpb246ICdNw6l0cmljYSBuw6NvIGVuY29udHJhZGEnIH0pXG4gIGFzeW5jIG9idGVyVmFsb3JBdHVhbChcbiAgICBAUGFyYW0oJ2NvZGlnbycpIGNvZGlnbzogc3RyaW5nLFxuICAgIEBRdWVyeSgpIHF1ZXJ5OiBDb25zdWx0YVZhbG9yTWV0cmljYUR0byxcbiAgKSB7XG4gICAgLy8gVGVtcG9yYXJpYW1lbnRlIHJldG9ybmFuZG8gZGFkb3MgbW9ja2Fkb3MgYXTDqSBxdWUgbyBtw6l0b2RvIHNlamEgaW1wbGVtZW50YWRvXG4gICAgcmV0dXJuIHtcbiAgICAgIG1ldHJpY2E6IGNvZGlnbyxcbiAgICAgIHZhbG9yOiA0MixcbiAgICAgIHVuaWRhZGU6ICclJyxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGRpbWVuc29lczogcXVlcnkuZGltZW5zb2VzIHx8IHt9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogT2J0w6ltIGEgc8OpcmllIGhpc3TDs3JpY2EgZGUgdmFsb3JlcyBkZSB1bWEgbcOpdHJpY2FcbiAgICovXG4gIEBHZXQoJzpjb2RpZ28vaGlzdG9yaWNvJylcbiAgQFJvbGVzKFJPTEVTLkFETUlOLCBST0xFUy5HRVNUT1IsIFJPTEVTLlRFQ05JQ08pXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnT2J0w6ltIHPDqXJpZSBoaXN0w7NyaWNhIGRlIHZhbG9yZXMgZGUgdW1hIG3DqXRyaWNhJyB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnU8OpcmllIGhpc3TDs3JpY2EgcmV0b3JuYWRhIGNvbSBzdWNlc3NvJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDQsIGRlc2NyaXB0aW9uOiAnTcOpdHJpY2EgbsOjbyBlbmNvbnRyYWRhJyB9KVxuICBhc3luYyBvYnRlclNlcmllSGlzdG9yaWNhKFxuICAgIEBQYXJhbSgnY29kaWdvJykgY29kaWdvOiBzdHJpbmcsXG4gICAgQFF1ZXJ5KCkgcXVlcnk6IENvbnN1bHRhU2VyaWVUZW1wb3JhbER0byxcbiAgKSB7XG4gICAgLy8gVGVtcG9yYXJpYW1lbnRlIHJldG9ybmFuZG8gZGFkb3MgbW9ja2Fkb3MgYXTDqSBxdWUgbyBtw6l0b2RvIHNlamEgaW1wbGVtZW50YWRvXG4gICAgcmV0dXJuIHtcbiAgICAgIG1ldHJpY2E6IGNvZGlnbyxcbiAgICAgIGRhZG9zOiBbXG4gICAgICAgIHsgdGltZXN0YW1wOiBuZXcgRGF0ZShxdWVyeS5kYXRhX2luaWNpYWwpLCB2YWxvcjogMzUgfSxcbiAgICAgICAgeyB0aW1lc3RhbXA6IG5ldyBEYXRlKERhdGUubm93KCkpLCB2YWxvcjogNDIgfSxcbiAgICAgIF0sXG4gICAgICBwZXJpb2RvOiB7XG4gICAgICAgIGluaWNpbzogcXVlcnkuZGF0YV9pbmljaWFsLFxuICAgICAgICBmaW06IHF1ZXJ5LmRhdGFfZmluYWwsXG4gICAgICB9LFxuICAgICAgZGltZW5zb2VzOiBxdWVyeS5kaW1lbnNvZXMgfHwge30sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wYXJhIHZhbG9yZXMgZGUgdW1hIG3DqXRyaWNhIGVudHJlIHBlcsOtb2Rvc1xuICAgKi9cbiAgQEdldCgnOmNvZGlnby9jb21wYXJhdGl2bycpXG4gIEBSb2xlcyhST0xFUy5BRE1JTiwgUk9MRVMuR0VTVE9SLCBST0xFUy5URUNOSUNPKVxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0NvbXBhcmEgdmFsb3JlcyBkZSB1bWEgbcOpdHJpY2EgZW50cmUgcGVyw61vZG9zJyB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnQ29tcGFyYXRpdm8gcmV0b3JuYWRvIGNvbSBzdWNlc3NvJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiA0MDQsIGRlc2NyaXB0aW9uOiAnTcOpdHJpY2EgbsOjbyBlbmNvbnRyYWRhJyB9KVxuICBhc3luYyBjb21wYXJhclBlcmlvZG9zKFxuICAgIEBQYXJhbSgnY29kaWdvJykgY29kaWdvOiBzdHJpbmcsXG4gICAgQFF1ZXJ5KCdwZXJpb2RvMUluaWNpbycpIHBlcmlvZG8xSW5pY2lvOiBEYXRlLFxuICAgIEBRdWVyeSgncGVyaW9kbzFGaW0nKSBwZXJpb2RvMUZpbTogRGF0ZSxcbiAgICBAUXVlcnkoJ3BlcmlvZG8ySW5pY2lvJykgcGVyaW9kbzJJbmljaW86IERhdGUsXG4gICAgQFF1ZXJ5KCdwZXJpb2RvMkZpbScpIHBlcmlvZG8yRmltOiBEYXRlLFxuICAgIEBRdWVyeSgnZ3JhbnVsYXJpZGFkZScpIGdyYW51bGFyaWRhZGU6IHN0cmluZyxcbiAgKSB7XG4gICAgLy8gVGVtcG9yYXJpYW1lbnRlIHJldG9ybmFuZG8gZGFkb3MgbW9ja2Fkb3MgYXTDqSBxdWUgbyBtw6l0b2RvIHNlamEgaW1wbGVtZW50YWRvXG4gICAgcmV0dXJuIHtcbiAgICAgIG1ldHJpY2E6IGNvZGlnbyxcbiAgICAgIHBlcmlvZG8xOiB7XG4gICAgICAgIGluaWNpbzogcGVyaW9kbzFJbmljaW8sXG4gICAgICAgIGZpbTogcGVyaW9kbzFGaW0sXG4gICAgICAgIHZhbG9yOiAzNSxcbiAgICAgIH0sXG4gICAgICBwZXJpb2RvMjoge1xuICAgICAgICBpbmljaW86IHBlcmlvZG8ySW5pY2lvLFxuICAgICAgICBmaW06IHBlcmlvZG8yRmltLFxuICAgICAgICB2YWxvcjogNDIsXG4gICAgICB9LFxuICAgICAgdmFyaWFjYW86IHtcbiAgICAgICAgYWJzb2x1dGE6IDcsXG4gICAgICAgIHBlcmNlbnR1YWw6IDIwLFxuICAgICAgfSxcbiAgICAgIGdyYW51bGFyaWRhZGU6IGdyYW51bGFyaWRhZGUgfHwgJ2RpYScsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRhIGNvbGV0YSBtYW51YWwgZGUgdW1hIG3DqXRyaWNhXG4gICAqL1xuICBAUG9zdCgnY29sZXRhLW1hbnVhbCcpXG4gIEBSb2xlcyhST0xFUy5BRE1JTiwgUk9MRVMuR0VTVE9SKVxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0V4ZWN1dGEgY29sZXRhIG1hbnVhbCBkZSB1bWEgbcOpdHJpY2EnIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogMjAxLCBkZXNjcmlwdGlvbjogJ0NvbGV0YSBleGVjdXRhZGEgY29tIHN1Y2Vzc28nIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogNDA0LCBkZXNjcmlwdGlvbjogJ03DqXRyaWNhIG7Do28gZW5jb250cmFkYScgfSlcbiAgYXN5bmMgZXhlY3V0YXJDb2xldGFNYW51YWwoQEJvZHkoKSBkdG86IENvbGV0YU1hbnVhbE1ldHJpY2FEdG8pIHtcbiAgICByZXR1cm4gdGhpcy5tZXRyaWNhc0NvbGV0YVNlcnZpY2UuY29sZXRhck1ldHJpY2FNYW51YWwoXG4gICAgICBkdG8uY29kaWdvLFxuICAgICAgZHRvLmRpbWVuc29lcyxcbiAgICApO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=