2ffb01d353294d8496d10383e9436ead
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", { value: true });
exports.TipoBeneficioSchema = void 0;
const typeorm_1 = require("typeorm");
const class_validator_1 = require("class-validator");
const tipo_beneficio_entity_1 = require("./tipo-beneficio.entity");
const enums_1 = require("@/enums");
/**
 * Entidade para mapear tipos de benefícios com suas estruturas de dados específicas
 *
 * Esta entidade relaciona cada tipo de benefício com a estrutura tipada
 * da entidade de dados correspondente, eliminando a necessidade de
 * formulários dinâmicos separados.
 */
let TipoBeneficioSchema = class TipoBeneficioSchema {
    id;
    tipo_beneficio_id;
    tipo_beneficio;
    entidade_dados; // 'DadosNatalidade', 'DadosAluguelSocial', etc.
    schema_estrutura;
    versao;
    status;
    observacoes;
    created_at;
    updated_at;
    removed_at;
    /**
     * Verifica se o schema foi criado recentemente (últimas 24 horas)
     */
    isRecente() {
        const umDiaAtras = new Date();
        umDiaAtras.setDate(umDiaAtras.getDate() - 1);
        return this.created_at > umDiaAtras;
    }
    /**
     * Obtém os campos obrigatórios do schema
     */
    getCamposObrigatorios() {
        return this.schema_estrutura.campos.filter((campo) => campo.obrigatorio);
    }
    /**
     * Obtém os campos opcionais do schema
     */
    getCamposOpcionais() {
        return this.schema_estrutura.campos.filter((campo) => !campo.obrigatorio);
    }
    /**
     * Busca um campo específico por nome
     */
    getCampoPorNome(nome) {
        return this.schema_estrutura.campos.find((campo) => campo.nome === nome);
    }
    /**
     * Valida se a estrutura do schema está correta
     */
    validarEstrutura() {
        const erros = [];
        if (!this.schema_estrutura.campos ||
            this.schema_estrutura.campos.length === 0) {
            erros.push('Schema deve conter pelo menos um campo');
        }
        // Validar campos únicos
        const nomesCampos = this.schema_estrutura.campos.map((c) => c.nome);
        const nomesUnicos = new Set(nomesCampos);
        if (nomesCampos.length !== nomesUnicos.size) {
            erros.push('Nomes de campos devem ser únicos');
        }
        // Validar dependências
        this.schema_estrutura.campos.forEach((campo) => {
            if (campo.dependeDe) {
                const campoReferenciado = this.getCampoPorNome(campo.dependeDe.campo);
                if (!campoReferenciado) {
                    erros.push(`Campo '${campo.nome}' depende de campo inexistente '${campo.dependeDe.campo}'`);
                }
            }
        });
        return {
            valido: erros.length === 0,
            erros,
        };
    }
};
exports.TipoBeneficioSchema = TipoBeneficioSchema;
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)('uuid'),
    __metadata("design:type", String)
], TipoBeneficioSchema.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_validator_1.IsNotEmpty)({ message: 'ID do tipo de benefício é obrigatório' }),
    __metadata("design:type", String)
], TipoBeneficioSchema.prototype, "tipo_beneficio_id", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => tipo_beneficio_entity_1.TipoBeneficio, { onDelete: 'CASCADE' }),
    (0, typeorm_1.JoinColumn)({ name: 'tipo_beneficio_id' }),
    __metadata("design:type", typeof (_a = typeof tipo_beneficio_entity_1.TipoBeneficio !== "undefined" && tipo_beneficio_entity_1.TipoBeneficio) === "function" ? _a : Object)
], TipoBeneficioSchema.prototype, "tipo_beneficio", void 0);
__decorate([
    (0, typeorm_1.Column)('varchar', { length: 100 }),
    (0, class_validator_1.IsNotEmpty)({ message: 'Nome da entidade de dados é obrigatório' }),
    __metadata("design:type", String)
], TipoBeneficioSchema.prototype, "entidade_dados", void 0);
__decorate([
    (0, typeorm_1.Column)('jsonb'),
    (0, class_validator_1.IsNotEmpty)({ message: 'Estrutura do schema é obrigatória' }),
    __metadata("design:type", Object)
], TipoBeneficioSchema.prototype, "schema_estrutura", void 0);
__decorate([
    (0, typeorm_1.Column)('varchar', { length: 20, default: '1.0.0' }),
    __metadata("design:type", String)
], TipoBeneficioSchema.prototype, "versao", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'enum',
        enum: enums_1.Status,
        enumName: 'status_enum',
        default: enums_1.Status.ATIVO,
    }),
    __metadata("design:type", typeof (_b = typeof enums_1.Status !== "undefined" && enums_1.Status) === "function" ? _b : Object)
], TipoBeneficioSchema.prototype, "status", void 0);
__decorate([
    (0, typeorm_1.Column)('text', { nullable: true }),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", String)
], TipoBeneficioSchema.prototype, "observacoes", void 0);
__decorate([
    (0, typeorm_1.CreateDateColumn)(),
    __metadata("design:type", typeof (_c = typeof Date !== "undefined" && Date) === "function" ? _c : Object)
], TipoBeneficioSchema.prototype, "created_at", void 0);
__decorate([
    (0, typeorm_1.UpdateDateColumn)(),
    __metadata("design:type", typeof (_d = typeof Date !== "undefined" && Date) === "function" ? _d : Object)
], TipoBeneficioSchema.prototype, "updated_at", void 0);
__decorate([
    (0, typeorm_1.DeleteDateColumn)(),
    __metadata("design:type", typeof (_e = typeof Date !== "undefined" && Date) === "function" ? _e : Object)
], TipoBeneficioSchema.prototype, "removed_at", void 0);
exports.TipoBeneficioSchema = TipoBeneficioSchema = __decorate([
    (0, typeorm_1.Entity)('tipo_beneficio_schema'),
    (0, typeorm_1.Index)(['tipo_beneficio_id'], { unique: true })
], TipoBeneficioSchema);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGVudGl0aWVzXFx0aXBvLWJlbmVmaWNpby1zY2hlbWEuZW50aXR5LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSxxQ0FVaUI7QUFDakIscURBQW9FO0FBQ3BFLG1FQUF3RDtBQUN4RCxtQ0FBaUM7QUFvQ2pDOzs7Ozs7R0FNRztBQUdJLElBQU0sbUJBQW1CLEdBQXpCLE1BQU0sbUJBQW1CO0lBRTlCLEVBQUUsQ0FBUztJQUlYLGlCQUFpQixDQUFTO0lBSTFCLGNBQWMsQ0FBZ0I7SUFJOUIsY0FBYyxDQUFTLENBQUMsZ0RBQWdEO0lBSXhFLGdCQUFnQixDQUdkO0lBR0YsTUFBTSxDQUFTO0lBUWYsTUFBTSxDQUFTO0lBSWYsV0FBVyxDQUFVO0lBR3JCLFVBQVUsQ0FBTztJQUdqQixVQUFVLENBQU87SUFHakIsVUFBVSxDQUFRO0lBRWxCOztPQUVHO0lBQ0gsU0FBUztRQUNQLE1BQU0sVUFBVSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDOUIsVUFBVSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDN0MsT0FBTyxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztJQUN0QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxxQkFBcUI7UUFDbkIsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQzNFLENBQUM7SUFFRDs7T0FFRztJQUNILGtCQUFrQjtRQUNoQixPQUFPLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUM1RSxDQUFD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SSxFQUFFLGNBQU07UUFDWixRQUFRLEVBQUUsYUFBYTtRQUN2QixPQUFPLEVBQUUsY0FBTSxDQUFDLEtBQUs7S0FDdEIsQ0FBQztrREFDTSxjQUFNLG9CQUFOLGNBQU07bURBQUM7QUFJZjtJQUZDLElBQUEsZ0JBQU0sRUFBQyxNQUFNLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUM7SUFDbEMsSUFBQSw0QkFBVSxHQUFFOzt3REFDUTtBQUdyQjtJQURDLElBQUEsMEJBQWdCLEdBQUU7a0RBQ1AsSUFBSSxvQkFBSixJQUFJO3VEQUFDO0FBR2pCO0lBREMsSUFBQSwwQkFBZ0IsR0FBRTtrREFDUCxJQUFJLG9CQUFKLElBQUk7dURBQUM7QUFHakI7SUFEQyxJQUFBLDBCQUFnQixHQUFFO2tEQUNOLElBQUksb0JBQUosSUFBSTt1REFBQzs4QkE3Q1AsbUJBQW1CO0lBRi9CLElBQUEsZ0JBQU0sRUFBQyx1QkFBdUIsQ0FBQztJQUMvQixJQUFBLGVBQUssRUFBQyxDQUFDLG1CQUFtQixDQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7R0FDbEMsbUJBQW1CLENBa0gvQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcZW50aXRpZXNcXHRpcG8tYmVuZWZpY2lvLXNjaGVtYS5lbnRpdHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRW50aXR5LFxuICBQcmltYXJ5R2VuZXJhdGVkQ29sdW1uLFxuICBDb2x1bW4sXG4gIENyZWF0ZURhdGVDb2x1bW4sXG4gIFVwZGF0ZURhdGVDb2x1bW4sXG4gIERlbGV0ZURhdGVDb2x1bW4sXG4gIE1hbnlUb09uZSxcbiAgSm9pbkNvbHVtbixcbiAgSW5kZXgsXG59IGZyb20gJ3R5cGVvcm0nO1xuaW1wb3J0IHsgSXNOb3RFbXB0eSwgSXNCb29sZWFuLCBJc09wdGlvbmFsIH0gZnJvbSAnY2xhc3MtdmFsaWRhdG9yJztcbmltcG9ydCB7IFRpcG9CZW5lZmljaW8gfSBmcm9tICcuL3RpcG8tYmVuZWZpY2lvLmVudGl0eSc7XG5pbXBvcnQgeyBTdGF0dXMgfSBmcm9tICdAL2VudW1zJztcblxuLyoqXG4gKiBJbnRlcmZhY2UgcGFyYSBkZWZpbmlyIGEgZXN0cnV0dXJhIGRlIHVtIGNhbXBvIGRhIGVudGlkYWRlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ2FtcG9Fc3RydXR1cmEge1xuICBub21lOiBzdHJpbmc7XG4gIHRpcG86ICdzdHJpbmcnIHwgJ251bWJlcicgfCAnYm9vbGVhbicgfCAnZGF0ZScgfCAnZW51bScgfCAnYXJyYXknO1xuICBvYnJpZ2F0b3JpbzogYm9vbGVhbjtcbiAgbGFiZWw6IHN0cmluZztcbiAgZGVzY3JpY2FvPzogc3RyaW5nO1xuICB2YWxpZGFjb2VzPzoge1xuICAgIG1pbj86IG51bWJlcjtcbiAgICBtYXg/OiBudW1iZXI7XG4gICAgcGF0dGVybj86IHN0cmluZztcbiAgICBvcGNvZXM/OiBzdHJpbmdbXTtcbiAgfTtcbiAgb3Bjb2VzPzogc3RyaW5nW107XG4gIGRlcGVuZGVEZT86IHtcbiAgICBjYW1wbzogc3RyaW5nO1xuICAgIHZhbG9yOiBhbnk7XG4gICAgY29uZGljYW86ICdpZ3VhbCcgfCAnZGlmZXJlbnRlJyB8ICdtYWlvcicgfCAnbWVub3InIHwgJ2NvbnRlbSc7XG4gIH07XG59XG5cbi8qKlxuICogSW50ZXJmYWNlIHBhcmEgbWV0YWRhZG9zIGRhIGVzdHJ1dHVyYVxuICovXG5leHBvcnQgaW50ZXJmYWNlIE1ldGFkYWRvc0VzdHJ1dHVyYSB7XG4gIHZlcnNhbzogc3RyaW5nO1xuICBkZXNjcmljYW86IHN0cmluZztcbiAgY2F0ZWdvcmlhOiBzdHJpbmc7XG4gIHRhZ3M/OiBzdHJpbmdbXTtcbiAgY29uZmlndXJhY29lcz86IFJlY29yZDxzdHJpbmcsIGFueT47XG59XG5cbi8qKlxuICogRW50aWRhZGUgcGFyYSBtYXBlYXIgdGlwb3MgZGUgYmVuZWbDrWNpb3MgY29tIHN1YXMgZXN0cnV0dXJhcyBkZSBkYWRvcyBlc3BlY8OtZmljYXNcbiAqXG4gKiBFc3RhIGVudGlkYWRlIHJlbGFjaW9uYSBjYWRhIHRpcG8gZGUgYmVuZWbDrWNpbyBjb20gYSBlc3RydXR1cmEgdGlwYWRhXG4gKiBkYSBlbnRpZGFkZSBkZSBkYWRvcyBjb3JyZXNwb25kZW50ZSwgZWxpbWluYW5kbyBhIG5lY2Vzc2lkYWRlIGRlXG4gKiBmb3JtdWzDoXJpb3MgZGluw6JtaWNvcyBzZXBhcmFkb3MuXG4gKi9cbkBFbnRpdHkoJ3RpcG9fYmVuZWZpY2lvX3NjaGVtYScpXG5ASW5kZXgoWyd0aXBvX2JlbmVmaWNpb19pZCddLCB7IHVuaXF1ZTogdHJ1ZSB9KVxuZXhwb3J0IGNsYXNzIFRpcG9CZW5lZmljaW9TY2hlbWEge1xuICBAUHJpbWFyeUdlbmVyYXRlZENvbHVtbigndXVpZCcpXG4gIGlkOiBzdHJpbmc7XG5cbiAgQENvbHVtbigpXG4gIEBJc05vdEVtcHR5KHsgbWVzc2FnZTogJ0lEIGRvIHRpcG8gZGUgYmVuZWbDrWNpbyDDqSBvYnJpZ2F0w7NyaW8nIH0pXG4gIHRpcG9fYmVuZWZpY2lvX2lkOiBzdHJpbmc7XG5cbiAgQE1hbnlUb09uZSgoKSA9PiBUaXBvQmVuZWZpY2lvLCB7IG9uRGVsZXRlOiAnQ0FTQ0FERScgfSlcbiAgQEpvaW5Db2x1bW4oeyBuYW1lOiAndGlwb19iZW5lZmljaW9faWQnIH0pXG4gIHRpcG9fYmVuZWZpY2lvOiBUaXBvQmVuZWZpY2lvO1xuXG4gIEBDb2x1bW4oJ3ZhcmNoYXInLCB7IGxlbmd0aDogMTAwIH0pXG4gIEBJc05vdEVtcHR5KHsgbWVzc2FnZTogJ05vbWUgZGEgZW50aWRhZGUgZGUgZGFkb3Mgw6kgb2JyaWdhdMOzcmlvJyB9KVxuICBlbnRpZGFkZV9kYWRvczogc3RyaW5nOyAvLyAnRGFkb3NOYXRhbGlkYWRlJywgJ0RhZG9zQWx1Z3VlbFNvY2lhbCcsIGV0Yy5cblxuICBAQ29sdW1uKCdqc29uYicpXG4gIEBJc05vdEVtcHR5KHsgbWVzc2FnZTogJ0VzdHJ1dHVyYSBkbyBzY2hlbWEgw6kgb2JyaWdhdMOzcmlhJyB9KVxuICBzY2hlbWFfZXN0cnV0dXJhOiB7XG4gICAgY2FtcG9zOiBDYW1wb0VzdHJ1dHVyYVtdO1xuICAgIG1ldGFkYWRvczogTWV0YWRhZG9zRXN0cnV0dXJhO1xuICB9O1xuXG4gIEBDb2x1bW4oJ3ZhcmNoYXInLCB7IGxlbmd0aDogMjAsIGRlZmF1bHQ6ICcxLjAuMCcgfSlcbiAgdmVyc2FvOiBzdHJpbmc7XG5cbiAgQENvbHVtbih7XG4gICAgdHlwZTogJ2VudW0nLFxuICAgIGVudW06IFN0YXR1cyxcbiAgICBlbnVtTmFtZTogJ3N0YXR1c19lbnVtJyxcbiAgICBkZWZhdWx0OiBTdGF0dXMuQVRJVk8sXG4gIH0pXG4gIHN0YXR1czogU3RhdHVzO1xuXG4gIEBDb2x1bW4oJ3RleHQnLCB7IG51bGxhYmxlOiB0cnVlIH0pXG4gIEBJc09wdGlvbmFsKClcbiAgb2JzZXJ2YWNvZXM/OiBzdHJpbmc7XG5cbiAgQENyZWF0ZURhdGVDb2x1bW4oKVxuICBjcmVhdGVkX2F0OiBEYXRlO1xuXG4gIEBVcGRhdGVEYXRlQ29sdW1uKClcbiAgdXBkYXRlZF9hdDogRGF0ZTtcblxuICBARGVsZXRlRGF0ZUNvbHVtbigpXG4gIHJlbW92ZWRfYXQ/OiBEYXRlO1xuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIHNjaGVtYSBmb2kgY3JpYWRvIHJlY2VudGVtZW50ZSAow7psdGltYXMgMjQgaG9yYXMpXG4gICAqL1xuICBpc1JlY2VudGUoKTogYm9vbGVhbiB7XG4gICAgY29uc3QgdW1EaWFBdHJhcyA9IG5ldyBEYXRlKCk7XG4gICAgdW1EaWFBdHJhcy5zZXREYXRlKHVtRGlhQXRyYXMuZ2V0RGF0ZSgpIC0gMSk7XG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlZF9hdCA+IHVtRGlhQXRyYXM7XG4gIH1cblxuICAvKipcbiAgICogT2J0w6ltIG9zIGNhbXBvcyBvYnJpZ2F0w7NyaW9zIGRvIHNjaGVtYVxuICAgKi9cbiAgZ2V0Q2FtcG9zT2JyaWdhdG9yaW9zKCk6IENhbXBvRXN0cnV0dXJhW10ge1xuICAgIHJldHVybiB0aGlzLnNjaGVtYV9lc3RydXR1cmEuY2FtcG9zLmZpbHRlcigoY2FtcG8pID0+IGNhbXBvLm9icmlnYXRvcmlvKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gb3MgY2FtcG9zIG9wY2lvbmFpcyBkbyBzY2hlbWFcbiAgICovXG4gIGdldENhbXBvc09wY2lvbmFpcygpOiBDYW1wb0VzdHJ1dHVyYVtdIHtcbiAgICByZXR1cm4gdGhpcy5zY2hlbWFfZXN0cnV0dXJhLmNhbXBvcy5maWx0ZXIoKGNhbXBvKSA9PiAhY2FtcG8ub2JyaWdhdG9yaW8pO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhIHVtIGNhbXBvIGVzcGVjw61maWNvIHBvciBub21lXG4gICAqL1xuICBnZXRDYW1wb1Bvck5vbWUobm9tZTogc3RyaW5nKTogQ2FtcG9Fc3RydXR1cmEgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLnNjaGVtYV9lc3RydXR1cmEuY2FtcG9zLmZpbmQoKGNhbXBvKSA9PiBjYW1wby5ub21lID09PSBub21lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGEgc2UgYSBlc3RydXR1cmEgZG8gc2NoZW1hIGVzdMOhIGNvcnJldGFcbiAgICovXG4gIHZhbGlkYXJFc3RydXR1cmEoKTogeyB2YWxpZG86IGJvb2xlYW47IGVycm9zOiBzdHJpbmdbXSB9IHtcbiAgICBjb25zdCBlcnJvczogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmIChcbiAgICAgICF0aGlzLnNjaGVtYV9lc3RydXR1cmEuY2FtcG9zIHx8XG4gICAgICB0aGlzLnNjaGVtYV9lc3RydXR1cmEuY2FtcG9zLmxlbmd0aCA9PT0gMFxuICAgICkge1xuICAgICAgZXJyb3MucHVzaCgnU2NoZW1hIGRldmUgY29udGVyIHBlbG8gbWVub3MgdW0gY2FtcG8nKTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGFyIGNhbXBvcyDDum5pY29zXG4gICAgY29uc3Qgbm9tZXNDYW1wb3MgPSB0aGlzLnNjaGVtYV9lc3RydXR1cmEuY2FtcG9zLm1hcCgoYykgPT4gYy5ub21lKTtcbiAgICBjb25zdCBub21lc1VuaWNvcyA9IG5ldyBTZXQobm9tZXNDYW1wb3MpO1xuICAgIGlmIChub21lc0NhbXBvcy5sZW5ndGggIT09IG5vbWVzVW5pY29zLnNpemUpIHtcbiAgICAgIGVycm9zLnB1c2goJ05vbWVzIGRlIGNhbXBvcyBkZXZlbSBzZXIgw7puaWNvcycpO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXIgZGVwZW5kw6puY2lhc1xuICAgIHRoaXMuc2NoZW1hX2VzdHJ1dHVyYS5jYW1wb3MuZm9yRWFjaCgoY2FtcG8pID0+IHtcbiAgICAgIGlmIChjYW1wby5kZXBlbmRlRGUpIHtcbiAgICAgICAgY29uc3QgY2FtcG9SZWZlcmVuY2lhZG8gPSB0aGlzLmdldENhbXBvUG9yTm9tZShjYW1wby5kZXBlbmRlRGUuY2FtcG8pO1xuICAgICAgICBpZiAoIWNhbXBvUmVmZXJlbmNpYWRvKSB7XG4gICAgICAgICAgZXJyb3MucHVzaChcbiAgICAgICAgICAgIGBDYW1wbyAnJHtjYW1wby5ub21lfScgZGVwZW5kZSBkZSBjYW1wbyBpbmV4aXN0ZW50ZSAnJHtjYW1wby5kZXBlbmRlRGUuY2FtcG99J2AsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHZhbGlkbzogZXJyb3MubGVuZ3RoID09PSAwLFxuICAgICAgZXJyb3MsXG4gICAgfTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9