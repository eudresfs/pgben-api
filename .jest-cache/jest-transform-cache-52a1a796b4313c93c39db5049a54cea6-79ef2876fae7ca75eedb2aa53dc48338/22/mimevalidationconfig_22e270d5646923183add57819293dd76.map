{"file":"C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\modules\\documento\\config\\mime-validation.config.ts","mappings":"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","names":[],"sources":["C:\\Users\\eudre\\OneDrive\\Desktop\\Projetos\\pgben\\pgben-server\\src\\modules\\documento\\config\\mime-validation.config.ts"],"sourcesContent":["/**\n * Configuração de Validação MIME\n *\n * Define tipos MIME permitidos e configurações de segurança\n * para upload de documentos no sistema SEMTAS\n */\n\nexport interface MimeValidationConfig {\n  allowedMimeTypes: string[];\n  maxFileSize: number;\n  allowedExtensions: string[];\n  strictValidation: boolean;\n  scanForMalware: boolean;\n}\n\n/**\n * Tipos MIME permitidos para documentos oficiais\n */\nexport const ALLOWED_MIME_TYPES = {\n  // Documentos PDF\n  PDF: 'application/pdf',\n\n  // Imagens\n  JPEG: 'image/jpeg',\n  JPG: 'image/jpg',\n  PNG: 'image/png',\n\n  // Documentos do Microsoft Office\n  DOC: 'application/msword',\n  DOCX: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  XLS: 'application/vnd.ms-excel',\n  XLSX: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n\n  // Documentos do LibreOffice/OpenOffice\n  ODT: 'application/vnd.oasis.opendocument.text',\n  ODS: 'application/vnd.oasis.opendocument.spreadsheet',\n\n  // Texto simples\n  TXT: 'text/plain',\n} as const;\n\n/**\n * Extensões de arquivo permitidas\n */\nexport const ALLOWED_EXTENSIONS = [\n  '.pdf',\n  '.jpg',\n  '.jpeg',\n  '.png',\n  '.doc',\n  '.docx',\n  '.xls',\n  '.xlsx',\n  '.odt',\n  '.ods',\n  '.txt',\n] as const;\n\n/**\n * Configuração padrão de validação MIME\n */\nexport const DEFAULT_MIME_VALIDATION_CONFIG: MimeValidationConfig = {\n  allowedMimeTypes: Object.values(ALLOWED_MIME_TYPES),\n  maxFileSize: 10 * 1024 * 1024, // 10MB\n  allowedExtensions: [...ALLOWED_EXTENSIONS],\n  strictValidation: true,\n  scanForMalware: false, // Pode ser habilitado em produção\n};\n\n/**\n * Configuração específica por tipo de benefício\n */\nexport const BENEFIT_SPECIFIC_MIME_CONFIG = {\n  AUXILIO_NATALIDADE: {\n    ...DEFAULT_MIME_VALIDATION_CONFIG,\n    allowedMimeTypes: [\n      ALLOWED_MIME_TYPES.PDF,\n      ALLOWED_MIME_TYPES.JPEG,\n      ALLOWED_MIME_TYPES.JPG,\n      ALLOWED_MIME_TYPES.PNG,\n    ],\n    maxFileSize: 5 * 1024 * 1024, // 5MB para documentos de natalidade\n  },\n\n  ALUGUEL_SOCIAL: {\n    ...DEFAULT_MIME_VALIDATION_CONFIG,\n    allowedMimeTypes: [\n      ALLOWED_MIME_TYPES.PDF,\n      ALLOWED_MIME_TYPES.JPEG,\n      ALLOWED_MIME_TYPES.JPG,\n      ALLOWED_MIME_TYPES.PNG,\n      ALLOWED_MIME_TYPES.DOC,\n      ALLOWED_MIME_TYPES.DOCX,\n    ],\n    maxFileSize: 8 * 1024 * 1024, // 8MB para documentos de aluguel\n  },\n\n  DEFAULT: DEFAULT_MIME_VALIDATION_CONFIG,\n} as const;\n\n/**\n * Mapeamento de extensão para tipo MIME\n */\nexport const EXTENSION_TO_MIME_MAP = {\n  '.pdf': ALLOWED_MIME_TYPES.PDF,\n  '.jpg': ALLOWED_MIME_TYPES.JPEG,\n  '.jpeg': ALLOWED_MIME_TYPES.JPEG,\n  '.png': ALLOWED_MIME_TYPES.PNG,\n  '.doc': ALLOWED_MIME_TYPES.DOC,\n  '.docx': ALLOWED_MIME_TYPES.DOCX,\n  '.xls': ALLOWED_MIME_TYPES.XLS,\n  '.xlsx': ALLOWED_MIME_TYPES.XLSX,\n  '.odt': ALLOWED_MIME_TYPES.ODT,\n  '.ods': ALLOWED_MIME_TYPES.ODS,\n  '.txt': ALLOWED_MIME_TYPES.TXT,\n} as const;\n\n/**\n * Tipos MIME perigosos que devem ser sempre rejeitados\n */\nexport const DANGEROUS_MIME_TYPES = [\n  'application/x-executable',\n  'application/x-msdownload',\n  'application/x-msdos-program',\n  'application/x-msi',\n  'application/x-bat',\n  'application/x-sh',\n  'application/javascript',\n  'text/javascript',\n  'application/x-javascript',\n  'text/html',\n  'application/x-php',\n  'application/x-httpd-php',\n  'application/x-python-code',\n  'application/java-archive',\n  'application/x-java-archive',\n] as const;\n\n/**\n * Função para obter configuração MIME por tipo de benefício\n */\nexport function getMimeConfigForBenefit(\n  tipoBeneficio?: string,\n): MimeValidationConfig {\n  if (!tipoBeneficio) {\n    return BENEFIT_SPECIFIC_MIME_CONFIG.DEFAULT;\n  }\n\n  const normalizedType = tipoBeneficio.toUpperCase().replace(/\\s+/g, '_');\n\n  return (\n    (BENEFIT_SPECIFIC_MIME_CONFIG as any)[normalizedType] ||\n    BENEFIT_SPECIFIC_MIME_CONFIG.DEFAULT\n  );\n}\n\n/**\n * Função para validar se um tipo MIME é permitido\n */\nexport function isMimeTypeAllowed(\n  mimeType: string,\n  config: MimeValidationConfig,\n): boolean {\n  // Verificar se não é um tipo perigoso\n  if (DANGEROUS_MIME_TYPES.includes(mimeType as any)) {\n    return false;\n  }\n\n  // Verificar se está na lista de permitidos\n  return config.allowedMimeTypes.includes(mimeType);\n}\n\n/**\n * Função para validar extensão de arquivo\n */\nexport function isExtensionAllowed(\n  filename: string,\n  config: MimeValidationConfig,\n): boolean {\n  const extension = filename.toLowerCase().substring(filename.lastIndexOf('.'));\n  return config.allowedExtensions.includes(extension);\n}\n\n/**\n * Função para obter tipo MIME esperado baseado na extensão\n */\nexport function getExpectedMimeType(filename: string): string | null {\n  const extension = filename.toLowerCase().substring(filename.lastIndexOf('.'));\n  return (\n    EXTENSION_TO_MIME_MAP[extension as keyof typeof EXTENSION_TO_MIME_MAP] ||\n    null\n  );\n}\n"],"version":3}