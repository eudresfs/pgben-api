d502eb4bab0060aab94fdad565eed8d6
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", { value: true });
exports.PasswordResetController = void 0;
const common_1 = require("@nestjs/common");
const swagger_1 = require("@nestjs/swagger");
const throttler_1 = require("@nestjs/throttler");
const password_reset_service_1 = require("../services/password-reset.service");
const password_reset_dto_1 = require("../dtos/password-reset.dto");
const get_client_info_decorator_1 = require("../../common/decorators/get-client-info.decorator");
const client_info_interface_1 = require("../../common/interfaces/client-info.interface");
const jwt_auth_guard_1 = require("../guards/jwt-auth.guard");
const roles_guard_1 = require("../guards/roles.guard");
const role_decorator_1 = require("../decorators/role.decorator");
const roles_constants_1 = require("../../shared/constants/roles.constants");
// Usando DTOs do arquivo password-reset.dto.ts
let PasswordResetController = class PasswordResetController {
    passwordResetService;
    constructor(passwordResetService) {
        this.passwordResetService = passwordResetService;
    }
    async requestPasswordReset(requestDto, clientInfo) {
        return this.passwordResetService.requestPasswordReset(requestDto, clientInfo);
    }
    async resetPassword(resetDto, clientInfo) {
        return this.passwordResetService.resetPassword(resetDto, clientInfo);
    }
    async validateToken(token) {
        if (!token) {
            throw new common_1.BadRequestException('Token é obrigatório');
        }
        return this.passwordResetService.validateToken(token);
    }
    async getPasswordResetStats() {
        // Convertendo o resultado para o formato esperado pelo DTO
        const stats = await this.passwordResetService.getPasswordResetStats();
        return {
            ...stats,
            successfulResetsLast24h: stats.usedTokens || 0,
            expiredTokensLast24h: stats.expiredTokens || 0,
            successRate: ((stats.usedTokens || 0) / (stats.totalRequests || 1)) * 100,
            uniqueUsersLast24h: stats.requestsLast24h || 0
        };
    }
    async cleanupExpiredTokens() {
        const deletedCount = await this.passwordResetService.cleanupExpiredTokens();
        return {
            message: 'Tokens expirados removidos com sucesso',
            deletedCount,
            timestamp: new Date().toISOString(),
        };
    }
    async getTokenStats() {
        return this.passwordResetService.getTokenStats();
    }
};
exports.PasswordResetController = PasswordResetController;
__decorate([
    (0, common_1.Post)('request'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, throttler_1.Throttle)({ default: { limit: 3, ttl: 60000 } }) // 3 tentativas por minuto
    ,
    (0, swagger_1.ApiOperation)({
        summary: 'Solicitar recuperação de senha',
        description: 'Envia um email com link para redefinir a senha do usuário',
    }),
    (0, swagger_1.ApiBody)({ type: password_reset_dto_1.ForgotPasswordDto }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Solicitação processada com sucesso',
        type: password_reset_dto_1.ResetPasswordResponseDto,
    }),
    (0, swagger_1.ApiResponse)({
        status: 400,
        description: 'Dados inválidos ou muitas tentativas',
    }),
    (0, swagger_1.ApiResponse)({
        status: 429,
        description: 'Muitas tentativas - rate limit excedido',
    }),
    (0, swagger_1.ApiResponse)({
        status: 500,
        description: 'Erro interno do servidor',
    }),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, get_client_info_decorator_1.GetClientInfo)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof password_reset_dto_1.ForgotPasswordDto !== "undefined" && password_reset_dto_1.ForgotPasswordDto) === "function" ? _b : Object, typeof (_c = typeof client_info_interface_1.ClientInfo !== "undefined" && client_info_interface_1.ClientInfo) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], PasswordResetController.prototype, "requestPasswordReset", null);
__decorate([
    (0, common_1.Post)('reset'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, throttler_1.Throttle)({ default: { limit: 5, ttl: 60000 } }) // 5 tentativas por minuto
    ,
    (0, swagger_1.ApiOperation)({
        summary: 'Redefinir senha',
        description: 'Redefine a senha do usuário usando o token recebido por email',
    }),
    (0, swagger_1.ApiBody)({ type: password_reset_dto_1.ResetPasswordDto }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Senha redefinida com sucesso',
        type: password_reset_dto_1.ResetPasswordResponseDto,
    }),
    (0, swagger_1.ApiResponse)({
        status: 400,
        description: 'Dados inválidos ou senhas não coincidem',
    }),
    (0, swagger_1.ApiResponse)({
        status: 401,
        description: 'Token inválido ou expirado',
    }),
    (0, swagger_1.ApiResponse)({
        status: 404,
        description: 'Usuário não encontrado',
    }),
    (0, swagger_1.ApiResponse)({
        status: 429,
        description: 'Muitas tentativas - rate limit excedido',
    }),
    (0, swagger_1.ApiResponse)({
        status: 500,
        description: 'Erro interno do servidor',
    }),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, get_client_info_decorator_1.GetClientInfo)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof password_reset_dto_1.ResetPasswordDto !== "undefined" && password_reset_dto_1.ResetPasswordDto) === "function" ? _e : Object, typeof (_f = typeof client_info_interface_1.ClientInfo !== "undefined" && client_info_interface_1.ClientInfo) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], PasswordResetController.prototype, "resetPassword", null);
__decorate([
    (0, common_1.Get)('validate-token'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, throttler_1.Throttle)({ default: { limit: 10, ttl: 60000 } }) // 10 tentativas por minuto
    ,
    (0, swagger_1.ApiOperation)({
        summary: 'Validar token de recuperação',
        description: 'Verifica se um token de recuperação é válido e não expirado',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'token',
        description: 'Token de recuperação para validação',
        example: 'abc123def456...',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Status de validação do token',
        type: password_reset_dto_1.ValidateTokenResponseDto,
    }),
    (0, swagger_1.ApiResponse)({
        status: 400,
        description: 'Token não fornecido',
    }),
    (0, swagger_1.ApiResponse)({
        status: 429,
        description: 'Muitas tentativas - rate limit excedido',
    }),
    __param(0, (0, common_1.Query)('token')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], PasswordResetController.prototype, "validateToken", null);
__decorate([
    (0, common_1.Get)('stats'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, role_decorator_1.Roles)(roles_constants_1.ROLES.ADMIN, roles_constants_1.ROLES.GESTOR),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiOperation)({
        summary: 'Estatísticas de recuperação de senha',
        description: 'Obtém estatísticas sobre solicitações de recuperação de senha (apenas admins)',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Estatísticas obtidas com sucesso',
        type: password_reset_dto_1.PasswordResetStatsDto,
    }),
    (0, swagger_1.ApiResponse)({
        status: 401,
        description: 'Token de autenticação inválido',
    }),
    (0, swagger_1.ApiResponse)({
        status: 403,
        description: 'Acesso negado - permissões insuficientes',
    }),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_j = typeof Promise !== "undefined" && Promise) === "function" ? _j : Object)
], PasswordResetController.prototype, "getPasswordResetStats", null);
__decorate([
    (0, common_1.Post)('cleanup-expired'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, role_decorator_1.Roles)(roles_constants_1.ROLES.ADMIN, roles_constants_1.ROLES.SUPER_ADMIN),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiOperation)({
        summary: 'Limpar tokens expirados',
        description: 'Remove manualmente tokens de recuperação expirados (apenas admins)',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Tokens expirados removidos com sucesso',
        schema: {
            type: 'object',
            properties: {
                message: { type: 'string', example: 'Tokens expirados removidos com sucesso' },
                deletedCount: { type: 'number', example: 15 },
                timestamp: { type: 'string', example: '2024-01-15T10:30:00Z' },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({
        status: 401,
        description: 'Token de autenticação inválido',
    }),
    (0, swagger_1.ApiResponse)({
        status: 403,
        description: 'Acesso negado - permissões insuficientes',
    }),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_k = typeof Promise !== "undefined" && Promise) === "function" ? _k : Object)
], PasswordResetController.prototype, "cleanupExpiredTokens", null);
__decorate([
    (0, common_1.Get)('token-stats'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, role_decorator_1.Roles)(roles_constants_1.ROLES.ADMIN, roles_constants_1.ROLES.SUPER_ADMIN),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiOperation)({
        summary: 'Estatísticas detalhadas de tokens',
        description: 'Obtém estatísticas detalhadas sobre tokens de recuperação (apenas admins)',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Estatísticas obtidas com sucesso',
        schema: {
            type: 'object',
            properties: {
                total: { type: 'number', example: 100 },
                active: { type: 'number', example: 5 },
                expired: { type: 'number', example: 80 },
                used: { type: 'number', example: 15 },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({
        status: 401,
        description: 'Token de autenticação inválido',
    }),
    (0, swagger_1.ApiResponse)({
        status: 403,
        description: 'Acesso negado - permissões insuficientes',
    }),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], PasswordResetController.prototype, "getTokenStats", null);
exports.PasswordResetController = PasswordResetController = __decorate([
    (0, swagger_1.ApiTags)('Recuperação de Senha'),
    (0, common_1.Controller)('auth/password-reset'),
    (0, swagger_1.ApiExtraModels)(password_reset_dto_1.ForgotPasswordDto, password_reset_dto_1.ResetPasswordDto, password_reset_dto_1.ValidateTokenDto, password_reset_dto_1.ResetPasswordResponseDto, password_reset_dto_1.ValidateTokenResponseDto, password_reset_dto_1.PasswordResetStatsDto),
    (0, common_1.UsePipes)(new common_1.ValidationPipe({ transform: true, whitelist: true })),
    __metadata("design:paramtypes", [typeof (_a = typeof password_reset_service_1.PasswordResetService !== "undefined" && password_reset_service_1.PasswordResetService) === "function" ? _a : Object])
], PasswordResetController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGF1dGhcXGNvbnRyb2xsZXJzXFxwYXNzd29yZC1yZXNldC5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FZd0I7QUFDeEIsNkNBUXlCO0FBQ3pCLGlEQUE2QztBQUU3QywrRUFBMEU7QUFDMUUsbUVBT29DO0FBQ3BDLGlHQUFrRjtBQUNsRix5RkFBMkU7QUFDM0UsNkRBQXdEO0FBQ3hELHVEQUFtRDtBQUNuRCxpRUFBcUQ7QUFFckQsNEVBQStEO0FBRS9ELCtDQUErQztBQU14QyxJQUFNLHVCQUF1QixHQUE3QixNQUFNLHVCQUF1QjtJQUNMO0lBQTdCLFlBQTZCLG9CQUEwQztRQUExQyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO0lBQUcsQ0FBQztJQTJCckUsQUFBTixLQUFLLENBQUMsb0JBQW9CLENBQ2hCLFVBQW1DLEVBQzFCLFVBQXNCO1FBRXZDLE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDLG9CQUFvQixDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUNoRixDQUFDO0lBbUNLLEFBQU4sS0FBSyxDQUFDLGFBQWEsQ0FDVCxRQUEwQixFQUNqQixVQUFzQjtRQUV2QyxPQUFPLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7SUEyQkssQUFBTixLQUFLLENBQUMsYUFBYSxDQUNELEtBQWE7UUFFN0IsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ1gsTUFBTSxJQUFJLDRCQUFtQixDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDdkQsQ0FBQztRQUVELE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN4RCxDQUFDO0lBdUJLLEFBQU4sS0FBSyxDQUFDLHFCQUFxQjtRQUN6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ZCw2Q0FBb0Isb0JBQXBCLDZDQUFvQjtHQUQ1RCx1QkFBdUIsQ0E2Tm5DIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxhdXRoXFxjb250cm9sbGVyc1xccGFzc3dvcmQtcmVzZXQuY29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb250cm9sbGVyLFxuICBQb3N0LFxuICBCb2R5LFxuICBHZXQsXG4gIFF1ZXJ5LFxuICBIdHRwQ29kZSxcbiAgSHR0cFN0YXR1cyxcbiAgVXNlR3VhcmRzLFxuICBWYWxpZGF0aW9uUGlwZSxcbiAgVXNlUGlwZXMsXG4gIEJhZFJlcXVlc3RFeGNlcHRpb24sXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7XG4gIEFwaVRhZ3MsXG4gIEFwaU9wZXJhdGlvbixcbiAgQXBpUmVzcG9uc2UsXG4gIEFwaUJvZHksXG4gIEFwaVF1ZXJ5LFxuICBBcGlCZWFyZXJBdXRoLFxuICBBcGlFeHRyYU1vZGVscyxcbn0gZnJvbSAnQG5lc3Rqcy9zd2FnZ2VyJztcbmltcG9ydCB7IFRocm90dGxlIH0gZnJvbSAnQG5lc3Rqcy90aHJvdHRsZXInO1xuaW1wb3J0IHsgSXNFbWFpbCwgSXNTdHJpbmcsIE1pbkxlbmd0aCwgTWF0Y2hlcyB9IGZyb20gJ2NsYXNzLXZhbGlkYXRvcic7XG5pbXBvcnQgeyBQYXNzd29yZFJlc2V0U2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3Bhc3N3b3JkLXJlc2V0LnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgUmVzZXRQYXNzd29yZER0byxcbiAgRm9yZ290UGFzc3dvcmREdG8gYXMgUmVxdWVzdFBhc3N3b3JkUmVzZXREdG8sXG4gIFZhbGlkYXRlVG9rZW5EdG8sXG4gIFJlc2V0UGFzc3dvcmRSZXNwb25zZUR0byxcbiAgVmFsaWRhdGVUb2tlblJlc3BvbnNlRHRvLFxuICBQYXNzd29yZFJlc2V0U3RhdHNEdG8sXG59IGZyb20gJy4uL2R0b3MvcGFzc3dvcmQtcmVzZXQuZHRvJztcbmltcG9ydCB7IEdldENsaWVudEluZm8gfSBmcm9tICcuLi8uLi9jb21tb24vZGVjb3JhdG9ycy9nZXQtY2xpZW50LWluZm8uZGVjb3JhdG9yJztcbmltcG9ydCB7IENsaWVudEluZm8gfSBmcm9tICcuLi8uLi9jb21tb24vaW50ZXJmYWNlcy9jbGllbnQtaW5mby5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgSnd0QXV0aEd1YXJkIH0gZnJvbSAnLi4vZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IFJvbGVzR3VhcmQgfSBmcm9tICcuLi9ndWFyZHMvcm9sZXMuZ3VhcmQnO1xuaW1wb3J0IHsgUm9sZXMgfSBmcm9tICcuLi9kZWNvcmF0b3JzL3JvbGUuZGVjb3JhdG9yJztcbmltcG9ydCB7IFJvbGUgfSBmcm9tICcuLi9lbnVtcy9yb2xlLmVudW0nO1xuaW1wb3J0IHsgUk9MRVMgfSBmcm9tICcuLi8uLi9zaGFyZWQvY29uc3RhbnRzL3JvbGVzLmNvbnN0YW50cyc7XG5cbi8vIFVzYW5kbyBEVE9zIGRvIGFycXVpdm8gcGFzc3dvcmQtcmVzZXQuZHRvLnRzXG5cbkBBcGlUYWdzKCdSZWN1cGVyYcOnw6NvIGRlIFNlbmhhJylcbkBDb250cm9sbGVyKCdhdXRoL3Bhc3N3b3JkLXJlc2V0JylcbkBBcGlFeHRyYU1vZGVscyhSZXF1ZXN0UGFzc3dvcmRSZXNldER0bywgUmVzZXRQYXNzd29yZER0bywgVmFsaWRhdGVUb2tlbkR0bywgUmVzZXRQYXNzd29yZFJlc3BvbnNlRHRvLCBWYWxpZGF0ZVRva2VuUmVzcG9uc2VEdG8sIFBhc3N3b3JkUmVzZXRTdGF0c0R0bylcbkBVc2VQaXBlcyhuZXcgVmFsaWRhdGlvblBpcGUoeyB0cmFuc2Zvcm06IHRydWUsIHdoaXRlbGlzdDogdHJ1ZSB9KSlcbmV4cG9ydCBjbGFzcyBQYXNzd29yZFJlc2V0Q29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgcGFzc3dvcmRSZXNldFNlcnZpY2U6IFBhc3N3b3JkUmVzZXRTZXJ2aWNlKSB7fVxuXG4gIEBQb3N0KCdyZXF1ZXN0JylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIEBUaHJvdHRsZSh7IGRlZmF1bHQ6IHsgbGltaXQ6IDMsIHR0bDogNjAwMDAgfSB9KSAvLyAzIHRlbnRhdGl2YXMgcG9yIG1pbnV0b1xuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnU29saWNpdGFyIHJlY3VwZXJhw6fDo28gZGUgc2VuaGEnLFxuICAgIGRlc2NyaXB0aW9uOiAnRW52aWEgdW0gZW1haWwgY29tIGxpbmsgcGFyYSByZWRlZmluaXIgYSBzZW5oYSBkbyB1c3XDoXJpbycsXG4gIH0pXG4gIEBBcGlCb2R5KHsgdHlwZTogUmVxdWVzdFBhc3N3b3JkUmVzZXREdG8gfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBkZXNjcmlwdGlvbjogJ1NvbGljaXRhw6fDo28gcHJvY2Vzc2FkYSBjb20gc3VjZXNzbycsXG4gICAgdHlwZTogUmVzZXRQYXNzd29yZFJlc3BvbnNlRHRvLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNDAwLFxuICAgIGRlc2NyaXB0aW9uOiAnRGFkb3MgaW52w6FsaWRvcyBvdSBtdWl0YXMgdGVudGF0aXZhcycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiA0MjksXG4gICAgZGVzY3JpcHRpb246ICdNdWl0YXMgdGVudGF0aXZhcyAtIHJhdGUgbGltaXQgZXhjZWRpZG8nLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNTAwLFxuICAgIGRlc2NyaXB0aW9uOiAnRXJybyBpbnRlcm5vIGRvIHNlcnZpZG9yJyxcbiAgfSlcbiAgYXN5bmMgcmVxdWVzdFBhc3N3b3JkUmVzZXQoXG4gICAgQEJvZHkoKSByZXF1ZXN0RHRvOiBSZXF1ZXN0UGFzc3dvcmRSZXNldER0byxcbiAgICBAR2V0Q2xpZW50SW5mbygpIGNsaWVudEluZm86IENsaWVudEluZm8sXG4gICk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMucGFzc3dvcmRSZXNldFNlcnZpY2UucmVxdWVzdFBhc3N3b3JkUmVzZXQocmVxdWVzdER0bywgY2xpZW50SW5mbyk7XG4gIH1cblxuICBAUG9zdCgncmVzZXQnKVxuICBASHR0cENvZGUoSHR0cFN0YXR1cy5PSylcbiAgQFRocm90dGxlKHsgZGVmYXVsdDogeyBsaW1pdDogNSwgdHRsOiA2MDAwMCB9IH0pIC8vIDUgdGVudGF0aXZhcyBwb3IgbWludXRvXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdSZWRlZmluaXIgc2VuaGEnLFxuICAgIGRlc2NyaXB0aW9uOiAnUmVkZWZpbmUgYSBzZW5oYSBkbyB1c3XDoXJpbyB1c2FuZG8gbyB0b2tlbiByZWNlYmlkbyBwb3IgZW1haWwnLFxuICB9KVxuICBAQXBpQm9keSh7IHR5cGU6IFJlc2V0UGFzc3dvcmREdG8gfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBkZXNjcmlwdGlvbjogJ1NlbmhhIHJlZGVmaW5pZGEgY29tIHN1Y2Vzc28nLFxuICAgIHR5cGU6IFJlc2V0UGFzc3dvcmRSZXNwb25zZUR0byxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDQwMCxcbiAgICBkZXNjcmlwdGlvbjogJ0RhZG9zIGludsOhbGlkb3Mgb3Ugc2VuaGFzIG7Do28gY29pbmNpZGVtJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDQwMSxcbiAgICBkZXNjcmlwdGlvbjogJ1Rva2VuIGludsOhbGlkbyBvdSBleHBpcmFkbycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiA0MDQsXG4gICAgZGVzY3JpcHRpb246ICdVc3XDoXJpbyBuw6NvIGVuY29udHJhZG8nLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNDI5LFxuICAgIGRlc2NyaXB0aW9uOiAnTXVpdGFzIHRlbnRhdGl2YXMgLSByYXRlIGxpbWl0IGV4Y2VkaWRvJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDUwMCxcbiAgICBkZXNjcmlwdGlvbjogJ0Vycm8gaW50ZXJubyBkbyBzZXJ2aWRvcicsXG4gIH0pXG4gIGFzeW5jIHJlc2V0UGFzc3dvcmQoXG4gICAgQEJvZHkoKSByZXNldER0bzogUmVzZXRQYXNzd29yZER0byxcbiAgICBAR2V0Q2xpZW50SW5mbygpIGNsaWVudEluZm86IENsaWVudEluZm8sXG4gICk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMucGFzc3dvcmRSZXNldFNlcnZpY2UucmVzZXRQYXNzd29yZChyZXNldER0bywgY2xpZW50SW5mbyk7XG4gIH1cblxuICBAR2V0KCd2YWxpZGF0ZS10b2tlbicpXG4gIEBIdHRwQ29kZShIdHRwU3RhdHVzLk9LKVxuICBAVGhyb3R0bGUoeyBkZWZhdWx0OiB7IGxpbWl0OiAxMCwgdHRsOiA2MDAwMCB9IH0pIC8vIDEwIHRlbnRhdGl2YXMgcG9yIG1pbnV0b1xuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnVmFsaWRhciB0b2tlbiBkZSByZWN1cGVyYcOnw6NvJyxcbiAgICBkZXNjcmlwdGlvbjogJ1ZlcmlmaWNhIHNlIHVtIHRva2VuIGRlIHJlY3VwZXJhw6fDo28gw6kgdsOhbGlkbyBlIG7Do28gZXhwaXJhZG8nLFxuICB9KVxuICBAQXBpUXVlcnkoe1xuICAgIG5hbWU6ICd0b2tlbicsXG4gICAgZGVzY3JpcHRpb246ICdUb2tlbiBkZSByZWN1cGVyYcOnw6NvIHBhcmEgdmFsaWRhw6fDo28nLFxuICAgIGV4YW1wbGU6ICdhYmMxMjNkZWY0NTYuLi4nLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnU3RhdHVzIGRlIHZhbGlkYcOnw6NvIGRvIHRva2VuJyxcbiAgICB0eXBlOiBWYWxpZGF0ZVRva2VuUmVzcG9uc2VEdG8sXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiA0MDAsXG4gICAgZGVzY3JpcHRpb246ICdUb2tlbiBuw6NvIGZvcm5lY2lkbycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiA0MjksXG4gICAgZGVzY3JpcHRpb246ICdNdWl0YXMgdGVudGF0aXZhcyAtIHJhdGUgbGltaXQgZXhjZWRpZG8nLFxuICB9KVxuICBhc3luYyB2YWxpZGF0ZVRva2VuKFxuICAgIEBRdWVyeSgndG9rZW4nKSB0b2tlbjogc3RyaW5nLFxuICApOiBQcm9taXNlPFZhbGlkYXRlVG9rZW5SZXNwb25zZUR0bz4ge1xuICAgIGlmICghdG9rZW4pIHtcbiAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKCdUb2tlbiDDqSBvYnJpZ2F0w7NyaW8nKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wYXNzd29yZFJlc2V0U2VydmljZS52YWxpZGF0ZVRva2VuKHRva2VuKTtcbiAgfVxuXG4gIEBHZXQoJ3N0YXRzJylcbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQsIFJvbGVzR3VhcmQpXG4gIEBSb2xlcyhST0xFUy5BRE1JTiwgUk9MRVMuR0VTVE9SKVxuICBAQXBpQmVhcmVyQXV0aCgpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdFc3RhdMOtc3RpY2FzIGRlIHJlY3VwZXJhw6fDo28gZGUgc2VuaGEnLFxuICAgIGRlc2NyaXB0aW9uOiAnT2J0w6ltIGVzdGF0w61zdGljYXMgc29icmUgc29saWNpdGHDp8O1ZXMgZGUgcmVjdXBlcmHDp8OjbyBkZSBzZW5oYSAoYXBlbmFzIGFkbWlucyknLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnRXN0YXTDrXN0aWNhcyBvYnRpZGFzIGNvbSBzdWNlc3NvJyxcbiAgICB0eXBlOiBQYXNzd29yZFJlc2V0U3RhdHNEdG8sXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiA0MDEsXG4gICAgZGVzY3JpcHRpb246ICdUb2tlbiBkZSBhdXRlbnRpY2HDp8OjbyBpbnbDoWxpZG8nLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNDAzLFxuICAgIGRlc2NyaXB0aW9uOiAnQWNlc3NvIG5lZ2FkbyAtIHBlcm1pc3PDtWVzIGluc3VmaWNpZW50ZXMnLFxuICB9KVxuICBhc3luYyBnZXRQYXNzd29yZFJlc2V0U3RhdHMoKTogUHJvbWlzZTxhbnk+IHtcbiAgICAvLyBDb252ZXJ0ZW5kbyBvIHJlc3VsdGFkbyBwYXJhIG8gZm9ybWF0byBlc3BlcmFkbyBwZWxvIERUT1xuICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgdGhpcy5wYXNzd29yZFJlc2V0U2VydmljZS5nZXRQYXNzd29yZFJlc2V0U3RhdHMoKTtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uc3RhdHMsXG4gICAgICBzdWNjZXNzZnVsUmVzZXRzTGFzdDI0aDogc3RhdHMudXNlZFRva2VucyB8fCAwLFxuICAgICAgZXhwaXJlZFRva2Vuc0xhc3QyNGg6IHN0YXRzLmV4cGlyZWRUb2tlbnMgfHwgMCxcbiAgICAgIHN1Y2Nlc3NSYXRlOiAoKHN0YXRzLnVzZWRUb2tlbnMgfHwgMCkgLyAoc3RhdHMudG90YWxSZXF1ZXN0cyB8fCAxKSkgKiAxMDAsXG4gICAgICB1bmlxdWVVc2Vyc0xhc3QyNGg6IHN0YXRzLnJlcXVlc3RzTGFzdDI0aCB8fCAwXG4gICAgfTtcbiAgfVxuXG4gIEBQb3N0KCdjbGVhbnVwLWV4cGlyZWQnKVxuICBAVXNlR3VhcmRzKEp3dEF1dGhHdWFyZCwgUm9sZXNHdWFyZClcbiAgQFJvbGVzKFJPTEVTLkFETUlOLCBST0xFUy5TVVBFUl9BRE1JTilcbiAgQEFwaUJlYXJlckF1dGgoKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnTGltcGFyIHRva2VucyBleHBpcmFkb3MnLFxuICAgIGRlc2NyaXB0aW9uOiAnUmVtb3ZlIG1hbnVhbG1lbnRlIHRva2VucyBkZSByZWN1cGVyYcOnw6NvIGV4cGlyYWRvcyAoYXBlbmFzIGFkbWlucyknLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnVG9rZW5zIGV4cGlyYWRvcyByZW1vdmlkb3MgY29tIHN1Y2Vzc28nLFxuICAgIHNjaGVtYToge1xuICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIG1lc3NhZ2U6IHsgdHlwZTogJ3N0cmluZycsIGV4YW1wbGU6ICdUb2tlbnMgZXhwaXJhZG9zIHJlbW92aWRvcyBjb20gc3VjZXNzbycgfSxcbiAgICAgICAgZGVsZXRlZENvdW50OiB7IHR5cGU6ICdudW1iZXInLCBleGFtcGxlOiAxNSB9LFxuICAgICAgICB0aW1lc3RhbXA6IHsgdHlwZTogJ3N0cmluZycsIGV4YW1wbGU6ICcyMDI0LTAxLTE1VDEwOjMwOjAwWicgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDQwMSxcbiAgICBkZXNjcmlwdGlvbjogJ1Rva2VuIGRlIGF1dGVudGljYcOnw6NvIGludsOhbGlkbycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiA0MDMsXG4gICAgZGVzY3JpcHRpb246ICdBY2Vzc28gbmVnYWRvIC0gcGVybWlzc8O1ZXMgaW5zdWZpY2llbnRlcycsXG4gIH0pXG4gIGFzeW5jIGNsZWFudXBFeHBpcmVkVG9rZW5zKCk6IFByb21pc2U8e1xuICAgIG1lc3NhZ2U6IHN0cmluZztcbiAgICBkZWxldGVkQ291bnQ6IG51bWJlcjtcbiAgICB0aW1lc3RhbXA6IHN0cmluZztcbiAgfT4ge1xuICAgIGNvbnN0IGRlbGV0ZWRDb3VudCA9IGF3YWl0IHRoaXMucGFzc3dvcmRSZXNldFNlcnZpY2UuY2xlYW51cEV4cGlyZWRUb2tlbnMoKTtcbiAgICByZXR1cm4ge1xuICAgICAgbWVzc2FnZTogJ1Rva2VucyBleHBpcmFkb3MgcmVtb3ZpZG9zIGNvbSBzdWNlc3NvJyxcbiAgICAgIGRlbGV0ZWRDb3VudCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG4gIH1cblxuICBAR2V0KCd0b2tlbi1zdGF0cycpXG4gIEBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkLCBSb2xlc0d1YXJkKVxuICBAUm9sZXMoUk9MRVMuQURNSU4sIFJPTEVTLlNVUEVSX0FETUlOKVxuICBAQXBpQmVhcmVyQXV0aCgpXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdFc3RhdMOtc3RpY2FzIGRldGFsaGFkYXMgZGUgdG9rZW5zJyxcbiAgICBkZXNjcmlwdGlvbjogJ09idMOpbSBlc3RhdMOtc3RpY2FzIGRldGFsaGFkYXMgc29icmUgdG9rZW5zIGRlIHJlY3VwZXJhw6fDo28gKGFwZW5hcyBhZG1pbnMpJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBkZXNjcmlwdGlvbjogJ0VzdGF0w61zdGljYXMgb2J0aWRhcyBjb20gc3VjZXNzbycsXG4gICAgc2NoZW1hOiB7XG4gICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgdG90YWw6IHsgdHlwZTogJ251bWJlcicsIGV4YW1wbGU6IDEwMCB9LFxuICAgICAgICBhY3RpdmU6IHsgdHlwZTogJ251bWJlcicsIGV4YW1wbGU6IDUgfSxcbiAgICAgICAgZXhwaXJlZDogeyB0eXBlOiAnbnVtYmVyJywgZXhhbXBsZTogODAgfSxcbiAgICAgICAgdXNlZDogeyB0eXBlOiAnbnVtYmVyJywgZXhhbXBsZTogMTUgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDQwMSxcbiAgICBkZXNjcmlwdGlvbjogJ1Rva2VuIGRlIGF1dGVudGljYcOnw6NvIGludsOhbGlkbycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiA0MDMsXG4gICAgZGVzY3JpcHRpb246ICdBY2Vzc28gbmVnYWRvIC0gcGVybWlzc8O1ZXMgaW5zdWZpY2llbnRlcycsXG4gIH0pXG4gIGFzeW5jIGdldFRva2VuU3RhdHMoKTogUHJvbWlzZTx7XG4gICAgdG90YWw6IG51bWJlcjtcbiAgICBhY3RpdmU6IG51bWJlcjtcbiAgICBleHBpcmVkOiBudW1iZXI7XG4gICAgdXNlZDogbnVtYmVyO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMucGFzc3dvcmRSZXNldFNlcnZpY2UuZ2V0VG9rZW5TdGF0cygpO1xuICB9XG59Il0sInZlcnNpb24iOjN9