50e5404116cc69a1577312ce8c7462bd
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const jwt_1 = require("@nestjs/jwt");
const sse_guard_1 = require("../guards/sse.guard");
describe('SseGuard', () => {
    let guard;
    let jwtService;
    const mockJwtService = {
        verifyAsync: jest.fn(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                sse_guard_1.SseGuard,
                {
                    provide: jwt_1.JwtService,
                    useValue: mockJwtService,
                },
            ],
        }).compile();
        guard = module.get(sse_guard_1.SseGuard);
        jwtService = module.get(jwt_1.JwtService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    const createMockExecutionContext = (request) => {
        return {
            switchToHttp: () => ({
                getRequest: () => request,
            }),
        };
    };
    it('should be defined', () => {
        expect(guard).toBeDefined();
    });
    describe('canActivate', () => {
        it('should allow access with valid token in query parameter', async () => {
            const validToken = 'valid.jwt.token';
            const mockPayload = { id: 'user-123', email: 'test@example.com' };
            mockJwtService.verifyAsync.mockResolvedValue(mockPayload);
            const mockRequest = {
                query: { token: validToken },
                headers: {},
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(true);
            expect(mockRequest['user']).toEqual(mockPayload);
            expect(jwtService.verifyAsync).toHaveBeenCalledWith(validToken);
        });
        it('should allow access with valid token in Authorization header', async () => {
            const validToken = 'valid.jwt.token';
            const mockPayload = { id: 'user-123', email: 'test@example.com' };
            mockJwtService.verifyAsync.mockResolvedValue(mockPayload);
            const mockRequest = {
                query: {},
                headers: { authorization: `Bearer ${validToken}` },
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(true);
            expect(mockRequest['user']).toEqual(mockPayload);
            expect(jwtService.verifyAsync).toHaveBeenCalledWith(validToken);
        });
        it('should allow access with valid token in cookie', async () => {
            const validToken = 'valid.jwt.token';
            const mockPayload = { id: 'user-123', email: 'test@example.com' };
            mockJwtService.verifyAsync.mockResolvedValue(mockPayload);
            const mockRequest = {
                query: {},
                headers: {},
                cookies: { access_token: validToken },
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(true);
            expect(mockRequest['user']).toEqual(mockPayload);
            expect(jwtService.verifyAsync).toHaveBeenCalledWith(validToken);
        });
        it('should prioritize query parameter over header', async () => {
            const queryToken = 'query.jwt.token';
            const headerToken = 'header.jwt.token';
            const mockPayload = { id: 'user-123', email: 'test@example.com' };
            mockJwtService.verifyAsync.mockResolvedValue(mockPayload);
            const mockRequest = {
                query: { token: queryToken },
                headers: { authorization: `Bearer ${headerToken}` },
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(true);
            expect(jwtService.verifyAsync).toHaveBeenCalledWith(queryToken);
            expect(jwtService.verifyAsync).not.toHaveBeenCalledWith(headerToken);
        });
        it('should prioritize header over cookie', async () => {
            const headerToken = 'header.jwt.token';
            const cookieToken = 'cookie.jwt.token';
            const mockPayload = { id: 'user-123', email: 'test@example.com' };
            mockJwtService.verifyAsync.mockResolvedValue(mockPayload);
            const mockRequest = {
                query: {},
                headers: { authorization: `Bearer ${headerToken}` },
                cookies: { access_token: cookieToken },
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(true);
            expect(jwtService.verifyAsync).toHaveBeenCalledWith(headerToken);
            expect(jwtService.verifyAsync).not.toHaveBeenCalledWith(cookieToken);
        });
        it('should deny access when no token is provided', async () => {
            const mockRequest = {
                query: {},
                headers: {},
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(false);
            expect(jwtService.verifyAsync).not.toHaveBeenCalled();
        });
        it('should deny access when token is invalid', async () => {
            const invalidToken = 'invalid.jwt.token';
            mockJwtService.verifyAsync.mockRejectedValue(new Error('Invalid token'));
            const mockRequest = {
                query: { token: invalidToken },
                headers: {},
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(false);
            expect(jwtService.verifyAsync).toHaveBeenCalledWith(invalidToken);
        });
        it('should deny access when token is expired', async () => {
            const expiredToken = 'expired.jwt.token';
            mockJwtService.verifyAsync.mockRejectedValue(new Error('Token expired'));
            const mockRequest = {
                query: { token: expiredToken },
                headers: {},
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(false);
            expect(jwtService.verifyAsync).toHaveBeenCalledWith(expiredToken);
        });
        it('should handle malformed Authorization header', async () => {
            const mockRequest = {
                query: {},
                headers: { authorization: 'InvalidFormat' },
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(false);
            expect(jwtService.verifyAsync).not.toHaveBeenCalled();
        });
        it('should handle empty Authorization header', async () => {
            const mockRequest = {
                query: {},
                headers: { authorization: 'Bearer ' },
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(false);
            expect(jwtService.verifyAsync).not.toHaveBeenCalled();
        });
        it('should handle empty token in query parameter', async () => {
            const mockRequest = {
                query: { token: '' },
                headers: {},
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(false);
            expect(jwtService.verifyAsync).not.toHaveBeenCalled();
        });
        it('should handle empty cookie token', async () => {
            const mockRequest = {
                query: {},
                headers: {},
                cookies: { access_token: '' },
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(false);
            expect(jwtService.verifyAsync).not.toHaveBeenCalled();
        });
        it('should handle JWT service throwing unexpected error', async () => {
            const validToken = 'valid.jwt.token';
            mockJwtService.verifyAsync.mockRejectedValue(new Error('Unexpected error'));
            const mockRequest = {
                query: { token: validToken },
                headers: {},
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(false);
            expect(jwtService.verifyAsync).toHaveBeenCalledWith(validToken);
        });
        it('should handle missing request object', async () => {
            const context = {
                switchToHttp: () => ({
                    getRequest: () => null,
                }),
            };
            const result = await guard.canActivate(context);
            expect(result).toBe(false);
            expect(jwtService.verifyAsync).not.toHaveBeenCalled();
        });
        it('should handle request without query, headers, or cookies', async () => {
            const mockRequest = {};
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(false);
            expect(jwtService.verifyAsync).not.toHaveBeenCalled();
        });
        it('should extract token correctly from complex Authorization header', async () => {
            const validToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c';
            const mockPayload = { id: 'user-123', email: 'test@example.com' };
            mockJwtService.verifyAsync.mockResolvedValue(mockPayload);
            const mockRequest = {
                query: {},
                headers: { authorization: `Bearer ${validToken}` },
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(true);
            expect(jwtService.verifyAsync).toHaveBeenCalledWith(validToken);
        });
        it('should handle case-insensitive Authorization header', async () => {
            const validToken = 'valid.jwt.token';
            const mockPayload = { id: 'user-123', email: 'test@example.com' };
            mockJwtService.verifyAsync.mockResolvedValue(mockPayload);
            const mockRequest = {
                query: {},
                headers: { Authorization: `Bearer ${validToken}` }, // Capital A
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(true);
            expect(jwtService.verifyAsync).toHaveBeenCalledWith(validToken);
        });
        it('should set user in request object when token is valid', async () => {
            const validToken = 'valid.jwt.token';
            const mockPayload = {
                id: 'user-123',
                email: 'test@example.com',
                roles: ['user'],
                iat: 1234567890,
                exp: 1234567890 + 3600,
            };
            mockJwtService.verifyAsync.mockResolvedValue(mockPayload);
            const mockRequest = {
                query: { token: validToken },
                headers: {},
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(true);
            expect(mockRequest.user).toEqual(mockPayload);
            expect(mockRequest.user.id).toBe('user-123');
            expect(mockRequest.user.email).toBe('test@example.com');
        });
        it('should not set user in request object when token is invalid', async () => {
            const invalidToken = 'invalid.jwt.token';
            mockJwtService.verifyAsync.mockRejectedValue(new Error('Invalid token'));
            const mockRequest = {
                query: { token: invalidToken },
                headers: {},
                cookies: {},
            };
            const context = createMockExecutionContext(mockRequest);
            const result = await guard.canActivate(context);
            expect(result).toBe(false);
            expect(mockRequest.user).toBeUndefined();
        });
    });
    describe('extractToken', () => {
        it('should extract token from query parameter first', () => {
            const queryToken = 'query-token';
            const headerToken = 'header-token';
            const cookieToken = 'cookie-token';
            const mockRequest = {
                query: { token: queryToken },
                headers: { authorization: `Bearer ${headerToken}` },
                cookies: { access_token: cookieToken },
            };
            const extractedToken = guard['extractToken'](mockRequest);
            expect(extractedToken).toBe(queryToken);
        });
        it('should extract token from Authorization header when query is empty', () => {
            const headerToken = 'header-token';
            const cookieToken = 'cookie-token';
            const mockRequest = {
                query: {},
                headers: { authorization: `Bearer ${headerToken}` },
                cookies: { access_token: cookieToken },
            };
            const extractedToken = guard['extractToken'](mockRequest);
            expect(extractedToken).toBe(headerToken);
        });
        it('should extract token from cookie when query and header are empty', () => {
            const cookieToken = 'cookie-token';
            const mockRequest = {
                query: {},
                headers: {},
                cookies: { access_token: cookieToken },
            };
            const extractedToken = guard['extractToken'](mockRequest);
            expect(extractedToken).toBe(cookieToken);
        });
        it('should return null when no token is found', () => {
            const mockRequest = {
                query: {},
                headers: {},
                cookies: {},
            };
            const extractedToken = guard['extractToken'](mockRequest);
            expect(extractedToken).toBeNull();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXG5vdGlmaWNhY2FvXFx0ZXN0c1xcc3NlLmd1YXJkLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFFdEQscUNBQXlDO0FBQ3pDLG1EQUErQztBQUcvQyxRQUFRLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRTtJQUN4QixJQUFJLEtBQWUsQ0FBQztJQUNwQixJQUFJLFVBQXNCLENBQUM7SUFFM0IsTUFBTSxjQUFjLEdBQUc7UUFDckIsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDdkIsQ0FBQztJQUVGLFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixNQUFNLE1BQU0sR0FBa0IsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDM0QsU0FBUyxFQUFFO2dCQUNULG9CQUFRO2dCQUNSO29CQUNFLE9BQU8sRUFBRSxnQkFBVTtvQkFDbkIsUUFBUSxFQUFFLGNBQWM7aUJBQ3pCO2FBQ0Y7U0FDRixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixLQUFLLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBVyxvQkFBUSxDQUFDLENBQUM7UUFDdkMsVUFBVSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQWEsZ0JBQVUsQ0FBQyxDQUFDO0lBQ2xELENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILE1BQU0sMEJBQTBCLEdBQUcsQ0FBQyxPQUF5QixFQUFvQixFQUFFO1FBQ2pGLE9BQU87WUFDTCxZQUFZLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztnQkFDbkIsVUFBVSxFQUFFLEdBQUcsRUFBRSxDQUFDLE9BQU87YUFDMUIsQ0FBQztTQUNpQixDQUFDO0lBQ3hCLENBQUMsQ0FBQztJQUVGLEVB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QyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xcbm90aWZpY2FjYW9cXHRlc3RzXFxzc2UuZ3VhcmQuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IEV4ZWN1dGlvbkNvbnRleHQgfSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBKd3RTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9qd3QnO1xuaW1wb3J0IHsgU3NlR3VhcmQgfSBmcm9tICcuLi9ndWFyZHMvc3NlLmd1YXJkJztcbmltcG9ydCB7IFJlcXVlc3QgfSBmcm9tICdleHByZXNzJztcblxuZGVzY3JpYmUoJ1NzZUd1YXJkJywgKCkgPT4ge1xuICBsZXQgZ3VhcmQ6IFNzZUd1YXJkO1xuICBsZXQgand0U2VydmljZTogSnd0U2VydmljZTtcblxuICBjb25zdCBtb2NrSnd0U2VydmljZSA9IHtcbiAgICB2ZXJpZnlBc3luYzogamVzdC5mbigpLFxuICB9O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgU3NlR3VhcmQsXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBKd3RTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrSnd0U2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgZ3VhcmQgPSBtb2R1bGUuZ2V0PFNzZUd1YXJkPihTc2VHdWFyZCk7XG4gICAgand0U2VydmljZSA9IG1vZHVsZS5nZXQ8Snd0U2VydmljZT4oSnd0U2VydmljZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGNvbnN0IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0ID0gKHJlcXVlc3Q6IFBhcnRpYWw8UmVxdWVzdD4pOiBFeGVjdXRpb25Db250ZXh0ID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgc3dpdGNoVG9IdHRwOiAoKSA9PiAoe1xuICAgICAgICBnZXRSZXF1ZXN0OiAoKSA9PiByZXF1ZXN0LFxuICAgICAgfSksXG4gICAgfSBhcyBFeGVjdXRpb25Db250ZXh0O1xuICB9O1xuXG4gIGl0KCdzaG91bGQgYmUgZGVmaW5lZCcsICgpID0+IHtcbiAgICBleHBlY3QoZ3VhcmQpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjYW5BY3RpdmF0ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFsbG93IGFjY2VzcyB3aXRoIHZhbGlkIHRva2VuIGluIHF1ZXJ5IHBhcmFtZXRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkVG9rZW4gPSAndmFsaWQuand0LnRva2VuJztcbiAgICAgIGNvbnN0IG1vY2tQYXlsb2FkID0geyBpZDogJ3VzZXItMTIzJywgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyB9O1xuICAgICAgXG4gICAgICBtb2NrSnd0U2VydmljZS52ZXJpZnlBc3luYy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGF5bG9hZCk7XG5cbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBxdWVyeTogeyB0b2tlbjogdmFsaWRUb2tlbiB9LFxuICAgICAgICBoZWFkZXJzOiB7fSxcbiAgICAgICAgY29va2llczoge30sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQobW9ja1JlcXVlc3QpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobW9ja1JlcXVlc3RbJ3VzZXInXSkudG9FcXVhbChtb2NrUGF5bG9hZCk7XG4gICAgICBleHBlY3Qoand0U2VydmljZS52ZXJpZnlBc3luYykudG9IYXZlQmVlbkNhbGxlZFdpdGgodmFsaWRUb2tlbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGFjY2VzcyB3aXRoIHZhbGlkIHRva2VuIGluIEF1dGhvcml6YXRpb24gaGVhZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsaWRUb2tlbiA9ICd2YWxpZC5qd3QudG9rZW4nO1xuICAgICAgY29uc3QgbW9ja1BheWxvYWQgPSB7IGlkOiAndXNlci0xMjMnLCBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nIH07XG4gICAgICBcbiAgICAgIG1vY2tKd3RTZXJ2aWNlLnZlcmlmeUFzeW5jLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQYXlsb2FkKTtcblxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIHF1ZXJ5OiB7fSxcbiAgICAgICAgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dmFsaWRUb2tlbn1gIH0sXG4gICAgICAgIGNvb2tpZXM6IHt9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KG1vY2tSZXF1ZXN0KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KG1vY2tSZXF1ZXN0Wyd1c2VyJ10pLnRvRXF1YWwobW9ja1BheWxvYWQpO1xuICAgICAgZXhwZWN0KGp3dFNlcnZpY2UudmVyaWZ5QXN5bmMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHZhbGlkVG9rZW4pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBhY2Nlc3Mgd2l0aCB2YWxpZCB0b2tlbiBpbiBjb29raWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZFRva2VuID0gJ3ZhbGlkLmp3dC50b2tlbic7XG4gICAgICBjb25zdCBtb2NrUGF5bG9hZCA9IHsgaWQ6ICd1c2VyLTEyMycsIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScgfTtcbiAgICAgIFxuICAgICAgbW9ja0p3dFNlcnZpY2UudmVyaWZ5QXN5bmMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BheWxvYWQpO1xuXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgcXVlcnk6IHt9LFxuICAgICAgICBoZWFkZXJzOiB7fSxcbiAgICAgICAgY29va2llczogeyBhY2Nlc3NfdG9rZW46IHZhbGlkVG9rZW4gfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBndWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChtb2NrUmVxdWVzdFsndXNlciddKS50b0VxdWFsKG1vY2tQYXlsb2FkKTtcbiAgICAgIGV4cGVjdChqd3RTZXJ2aWNlLnZlcmlmeUFzeW5jKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh2YWxpZFRva2VuKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJpb3JpdGl6ZSBxdWVyeSBwYXJhbWV0ZXIgb3ZlciBoZWFkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBxdWVyeVRva2VuID0gJ3F1ZXJ5Lmp3dC50b2tlbic7XG4gICAgICBjb25zdCBoZWFkZXJUb2tlbiA9ICdoZWFkZXIuand0LnRva2VuJztcbiAgICAgIGNvbnN0IG1vY2tQYXlsb2FkID0geyBpZDogJ3VzZXItMTIzJywgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyB9O1xuICAgICAgXG4gICAgICBtb2NrSnd0U2VydmljZS52ZXJpZnlBc3luYy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGF5bG9hZCk7XG5cbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBxdWVyeTogeyB0b2tlbjogcXVlcnlUb2tlbiB9LFxuICAgICAgICBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtoZWFkZXJUb2tlbn1gIH0sXG4gICAgICAgIGNvb2tpZXM6IHt9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KG1vY2tSZXF1ZXN0KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGp3dFNlcnZpY2UudmVyaWZ5QXN5bmMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHF1ZXJ5VG9rZW4pO1xuICAgICAgZXhwZWN0KGp3dFNlcnZpY2UudmVyaWZ5QXN5bmMpLm5vdC50b0hhdmVCZWVuQ2FsbGVkV2l0aChoZWFkZXJUb2tlbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByaW9yaXRpemUgaGVhZGVyIG92ZXIgY29va2llJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaGVhZGVyVG9rZW4gPSAnaGVhZGVyLmp3dC50b2tlbic7XG4gICAgICBjb25zdCBjb29raWVUb2tlbiA9ICdjb29raWUuand0LnRva2VuJztcbiAgICAgIGNvbnN0IG1vY2tQYXlsb2FkID0geyBpZDogJ3VzZXItMTIzJywgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyB9O1xuICAgICAgXG4gICAgICBtb2NrSnd0U2VydmljZS52ZXJpZnlBc3luYy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGF5bG9hZCk7XG5cbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBxdWVyeToge30sXG4gICAgICAgIGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke2hlYWRlclRva2VufWAgfSxcbiAgICAgICAgY29va2llczogeyBhY2Nlc3NfdG9rZW46IGNvb2tpZVRva2VuIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQobW9ja1JlcXVlc3QpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3Qoand0U2VydmljZS52ZXJpZnlBc3luYykudG9IYXZlQmVlbkNhbGxlZFdpdGgoaGVhZGVyVG9rZW4pO1xuICAgICAgZXhwZWN0KGp3dFNlcnZpY2UudmVyaWZ5QXN5bmMpLm5vdC50b0hhdmVCZWVuQ2FsbGVkV2l0aChjb29raWVUb2tlbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlbnkgYWNjZXNzIHdoZW4gbm8gdG9rZW4gaXMgcHJvdmlkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgcXVlcnk6IHt9LFxuICAgICAgICBoZWFkZXJzOiB7fSxcbiAgICAgICAgY29va2llczoge30sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQobW9ja1JlcXVlc3QpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KGp3dFNlcnZpY2UudmVyaWZ5QXN5bmMpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlbnkgYWNjZXNzIHdoZW4gdG9rZW4gaXMgaW52YWxpZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRUb2tlbiA9ICdpbnZhbGlkLmp3dC50b2tlbic7XG4gICAgICBcbiAgICAgIG1vY2tKd3RTZXJ2aWNlLnZlcmlmeUFzeW5jLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignSW52YWxpZCB0b2tlbicpKTtcblxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIHF1ZXJ5OiB7IHRva2VuOiBpbnZhbGlkVG9rZW4gfSxcbiAgICAgICAgaGVhZGVyczoge30sXG4gICAgICAgIGNvb2tpZXM6IHt9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KG1vY2tSZXF1ZXN0KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChqd3RTZXJ2aWNlLnZlcmlmeUFzeW5jKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChpbnZhbGlkVG9rZW4pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZW55IGFjY2VzcyB3aGVuIHRva2VuIGlzIGV4cGlyZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBleHBpcmVkVG9rZW4gPSAnZXhwaXJlZC5qd3QudG9rZW4nO1xuICAgICAgXG4gICAgICBtb2NrSnd0U2VydmljZS52ZXJpZnlBc3luYy5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1Rva2VuIGV4cGlyZWQnKSk7XG5cbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBxdWVyeTogeyB0b2tlbjogZXhwaXJlZFRva2VuIH0sXG4gICAgICAgIGhlYWRlcnM6IHt9LFxuICAgICAgICBjb29raWVzOiB7fSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBndWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3Qoand0U2VydmljZS52ZXJpZnlBc3luYykudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwaXJlZFRva2VuKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1hbGZvcm1lZCBBdXRob3JpemF0aW9uIGhlYWRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBxdWVyeToge30sXG4gICAgICAgIGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogJ0ludmFsaWRGb3JtYXQnIH0sXG4gICAgICAgIGNvb2tpZXM6IHt9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KG1vY2tSZXF1ZXN0KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChqd3RTZXJ2aWNlLnZlcmlmeUFzeW5jKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgQXV0aG9yaXphdGlvbiBoZWFkZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgcXVlcnk6IHt9LFxuICAgICAgICBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246ICdCZWFyZXIgJyB9LFxuICAgICAgICBjb29raWVzOiB7fSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBndWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3Qoand0U2VydmljZS52ZXJpZnlBc3luYykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHRva2VuIGluIHF1ZXJ5IHBhcmFtZXRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBxdWVyeTogeyB0b2tlbjogJycgfSxcbiAgICAgICAgaGVhZGVyczoge30sXG4gICAgICAgIGNvb2tpZXM6IHt9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KG1vY2tSZXF1ZXN0KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChqd3RTZXJ2aWNlLnZlcmlmeUFzeW5jKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgY29va2llIHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIHF1ZXJ5OiB7fSxcbiAgICAgICAgaGVhZGVyczoge30sXG4gICAgICAgIGNvb2tpZXM6IHsgYWNjZXNzX3Rva2VuOiAnJyB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KG1vY2tSZXF1ZXN0KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChqd3RTZXJ2aWNlLnZlcmlmeUFzeW5jKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgSldUIHNlcnZpY2UgdGhyb3dpbmcgdW5leHBlY3RlZCBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkVG9rZW4gPSAndmFsaWQuand0LnRva2VuJztcbiAgICAgIFxuICAgICAgbW9ja0p3dFNlcnZpY2UudmVyaWZ5QXN5bmMubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdVbmV4cGVjdGVkIGVycm9yJykpO1xuXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgcXVlcnk6IHsgdG9rZW46IHZhbGlkVG9rZW4gfSxcbiAgICAgICAgaGVhZGVyczoge30sXG4gICAgICAgIGNvb2tpZXM6IHt9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KG1vY2tSZXF1ZXN0KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChqd3RTZXJ2aWNlLnZlcmlmeUFzeW5jKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh2YWxpZFRva2VuKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1pc3NpbmcgcmVxdWVzdCBvYmplY3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb250ZXh0ID0ge1xuICAgICAgICBzd2l0Y2hUb0h0dHA6ICgpID0+ICh7XG4gICAgICAgICAgZ2V0UmVxdWVzdDogKCkgPT4gbnVsbCxcbiAgICAgICAgfSksXG4gICAgICB9IGFzIEV4ZWN1dGlvbkNvbnRleHQ7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChqd3RTZXJ2aWNlLnZlcmlmeUFzeW5jKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcmVxdWVzdCB3aXRob3V0IHF1ZXJ5LCBoZWFkZXJzLCBvciBjb29raWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7fSBhcyBSZXF1ZXN0O1xuXG4gICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQobW9ja1JlcXVlc3QpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KGp3dFNlcnZpY2UudmVyaWZ5QXN5bmMpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV4dHJhY3QgdG9rZW4gY29ycmVjdGx5IGZyb20gY29tcGxleCBBdXRob3JpemF0aW9uIGhlYWRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkVG9rZW4gPSAnZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnpkV0lpT2lJeE1qTTBOVFkzT0Rrd0lpd2libUZ0WlNJNklrcHZhRzRnUkc5bElpd2lhV0YwSWpveE5URTJNak01TURJeWZRLlNmbEt4d1JKU01lS0tGMlFUNGZ3cE1lSmYzNlBPazZ5SlZfYWRRc3N3NWMnO1xuICAgICAgY29uc3QgbW9ja1BheWxvYWQgPSB7IGlkOiAndXNlci0xMjMnLCBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nIH07XG4gICAgICBcbiAgICAgIG1vY2tKd3RTZXJ2aWNlLnZlcmlmeUFzeW5jLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQYXlsb2FkKTtcblxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIHF1ZXJ5OiB7fSxcbiAgICAgICAgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dmFsaWRUb2tlbn1gIH0sXG4gICAgICAgIGNvb2tpZXM6IHt9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29udGV4dCA9IGNyZWF0ZU1vY2tFeGVjdXRpb25Db250ZXh0KG1vY2tSZXF1ZXN0KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGd1YXJkLmNhbkFjdGl2YXRlKGNvbnRleHQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGp3dFNlcnZpY2UudmVyaWZ5QXN5bmMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHZhbGlkVG9rZW4pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY2FzZS1pbnNlbnNpdGl2ZSBBdXRob3JpemF0aW9uIGhlYWRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkVG9rZW4gPSAndmFsaWQuand0LnRva2VuJztcbiAgICAgIGNvbnN0IG1vY2tQYXlsb2FkID0geyBpZDogJ3VzZXItMTIzJywgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyB9O1xuICAgICAgXG4gICAgICBtb2NrSnd0U2VydmljZS52ZXJpZnlBc3luYy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUGF5bG9hZCk7XG5cbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBxdWVyeToge30sXG4gICAgICAgIGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3ZhbGlkVG9rZW59YCB9LCAvLyBDYXBpdGFsIEFcbiAgICAgICAgY29va2llczoge30sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBjb250ZXh0ID0gY3JlYXRlTW9ja0V4ZWN1dGlvbkNvbnRleHQobW9ja1JlcXVlc3QpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ3VhcmQuY2FuQWN0aXZhdGUoY29udGV4dCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3Qoand0U2VydmljZS52ZXJpZnlBc3luYykudG9IYXZlQmVlbkNhbGxlZFdpdGgodmFsaWRUb2tlbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNldCB1c2VyIGluIHJlcXVlc3Qgb2JqZWN0IHdoZW4gdG9rZW4gaXMgdmFsaWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZFRva2VuID0gJ3ZhbGlkLmp3dC50b2tlbic7XG4gICAgICBjb25zdCBtb2NrUGF5bG9hZCA9IHtcbiAgICAgICAgaWQ6ICd1c2VyLTEyMycsXG4gICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgIHJvbGVzOiBbJ3VzZXInXSxcbiAgICAgICAgaWF0OiAxMjM0NTY3ODkwLFxuICAgICAgICBleHA6IDEyMzQ1Njc4OTAgKyAzNjAwLFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgbW9ja0p3dFNlcnZpY2UudmVyaWZ5QXN5bmMubW9ja1Jlc29sdmVkVmFsdWUobW9ja1BheWxvYWQpO1xuXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgcXVlcnk6IHsgdG9rZW46IHZhbGlkVG9rZW4gfSxcbiAgICAgICAgaGVhZGVyczoge30sXG4gICAgICAgIGNvb2tpZXM6IHt9LFxuICAgICAgfSBhcyBhbnk7XG5cbiAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBndWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChtb2NrUmVxdWVzdC51c2VyKS50b0VxdWFsKG1vY2tQYXlsb2FkKTtcbiAgICAgIGV4cGVjdChtb2NrUmVxdWVzdC51c2VyLmlkKS50b0JlKCd1c2VyLTEyMycpO1xuICAgICAgZXhwZWN0KG1vY2tSZXF1ZXN0LnVzZXIuZW1haWwpLnRvQmUoJ3Rlc3RAZXhhbXBsZS5jb20nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IHNldCB1c2VyIGluIHJlcXVlc3Qgb2JqZWN0IHdoZW4gdG9rZW4gaXMgaW52YWxpZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRUb2tlbiA9ICdpbnZhbGlkLmp3dC50b2tlbic7XG4gICAgICBcbiAgICAgIG1vY2tKd3RTZXJ2aWNlLnZlcmlmeUFzeW5jLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignSW52YWxpZCB0b2tlbicpKTtcblxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIHF1ZXJ5OiB7IHRva2VuOiBpbnZhbGlkVG9rZW4gfSxcbiAgICAgICAgaGVhZGVyczoge30sXG4gICAgICAgIGNvb2tpZXM6IHt9LFxuICAgICAgfSBhcyBhbnk7XG5cbiAgICAgIGNvbnN0IGNvbnRleHQgPSBjcmVhdGVNb2NrRXhlY3V0aW9uQ29udGV4dChtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBndWFyZC5jYW5BY3RpdmF0ZShjb250ZXh0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QobW9ja1JlcXVlc3QudXNlcikudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXh0cmFjdFRva2VuJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXh0cmFjdCB0b2tlbiBmcm9tIHF1ZXJ5IHBhcmFtZXRlciBmaXJzdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHF1ZXJ5VG9rZW4gPSAncXVlcnktdG9rZW4nO1xuICAgICAgY29uc3QgaGVhZGVyVG9rZW4gPSAnaGVhZGVyLXRva2VuJztcbiAgICAgIGNvbnN0IGNvb2tpZVRva2VuID0gJ2Nvb2tpZS10b2tlbic7XG5cbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBxdWVyeTogeyB0b2tlbjogcXVlcnlUb2tlbiB9LFxuICAgICAgICBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtoZWFkZXJUb2tlbn1gIH0sXG4gICAgICAgIGNvb2tpZXM6IHsgYWNjZXNzX3Rva2VuOiBjb29raWVUb2tlbiB9LFxuICAgICAgfSBhcyBhbnk7XG5cbiAgICAgIGNvbnN0IGV4dHJhY3RlZFRva2VuID0gZ3VhcmRbJ2V4dHJhY3RUb2tlbiddKG1vY2tSZXF1ZXN0KTtcbiAgICAgIGV4cGVjdChleHRyYWN0ZWRUb2tlbikudG9CZShxdWVyeVRva2VuKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXh0cmFjdCB0b2tlbiBmcm9tIEF1dGhvcml6YXRpb24gaGVhZGVyIHdoZW4gcXVlcnkgaXMgZW1wdHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBoZWFkZXJUb2tlbiA9ICdoZWFkZXItdG9rZW4nO1xuICAgICAgY29uc3QgY29va2llVG9rZW4gPSAnY29va2llLXRva2VuJztcblxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIHF1ZXJ5OiB7fSxcbiAgICAgICAgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7aGVhZGVyVG9rZW59YCB9LFxuICAgICAgICBjb29raWVzOiB7IGFjY2Vzc190b2tlbjogY29va2llVG9rZW4gfSxcbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICBjb25zdCBleHRyYWN0ZWRUb2tlbiA9IGd1YXJkWydleHRyYWN0VG9rZW4nXShtb2NrUmVxdWVzdCk7XG4gICAgICBleHBlY3QoZXh0cmFjdGVkVG9rZW4pLnRvQmUoaGVhZGVyVG9rZW4pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleHRyYWN0IHRva2VuIGZyb20gY29va2llIHdoZW4gcXVlcnkgYW5kIGhlYWRlciBhcmUgZW1wdHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb29raWVUb2tlbiA9ICdjb29raWUtdG9rZW4nO1xuXG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgcXVlcnk6IHt9LFxuICAgICAgICBoZWFkZXJzOiB7fSxcbiAgICAgICAgY29va2llczogeyBhY2Nlc3NfdG9rZW46IGNvb2tpZVRva2VuIH0sXG4gICAgICB9IGFzIGFueTtcblxuICAgICAgY29uc3QgZXh0cmFjdGVkVG9rZW4gPSBndWFyZFsnZXh0cmFjdFRva2VuJ10obW9ja1JlcXVlc3QpO1xuICAgICAgZXhwZWN0KGV4dHJhY3RlZFRva2VuKS50b0JlKGNvb2tpZVRva2VuKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgd2hlbiBubyB0b2tlbiBpcyBmb3VuZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBxdWVyeToge30sXG4gICAgICAgIGhlYWRlcnM6IHt9LFxuICAgICAgICBjb29raWVzOiB7fSxcbiAgICAgIH0gYXMgYW55O1xuXG4gICAgICBjb25zdCBleHRyYWN0ZWRUb2tlbiA9IGd1YXJkWydleHRyYWN0VG9rZW4nXShtb2NrUmVxdWVzdCk7XG4gICAgICBleHBlY3QoZXh0cmFjdGVkVG9rZW4pLnRvQmVOdWxsKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9