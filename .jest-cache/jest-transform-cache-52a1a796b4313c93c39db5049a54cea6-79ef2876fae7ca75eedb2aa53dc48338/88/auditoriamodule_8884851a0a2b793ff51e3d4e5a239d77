1f3e9e6c61067fc888e20aa090c128f0
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var AuditoriaModule_1;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuditoriaModule = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("@nestjs/typeorm");
const bull_1 = require("@nestjs/bull");
const jwt_1 = require("@nestjs/jwt");
const config_1 = require("@nestjs/config");
const schedule_adapter_module_1 = require("../../shared/schedule/schedule-adapter.module");
const auth_module_1 = require("../../auth/auth.module");
// Entidades
const entities_1 = require("../../entities");
// Serviços Core
const auditoria_service_1 = require("./services/auditoria.service");
const auditoria_queue_service_1 = require("./services/auditoria-queue.service");
const auditoria_queue_processor_1 = require("./services/auditoria-queue.processor");
// Serviços Especializados
const auditoria_signature_service_1 = require("./services/auditoria-signature.service");
const auditoria_exportacao_service_1 = require("./services/auditoria-exportacao.service");
const auditoria_monitoramento_service_1 = require("./services/auditoria-monitoramento.service");
// Controladores
const auditoria_controller_1 = require("./controllers/auditoria.controller");
const auditoria_exportacao_controller_1 = require("./controllers/auditoria-exportacao.controller");
const auditoria_monitoramento_controller_1 = require("./controllers/auditoria-monitoramento.controller");
// Middleware
const auditoria_middleware_1 = require("./middlewares/auditoria.middleware");
// Repositórios
const log_auditoria_repository_1 = require("./repositories/log-auditoria.repository");
/**
 * Módulo de Auditoria Unificado
 *
 * Responsável por registrar e gerenciar logs de auditoria do sistema,
 * garantindo a rastreabilidade das operações e compliance com LGPD.
 *
 * Funcionalidades:
 * - Registro automático de operações via middleware e interceptores
 * - Proteção contra tampering usando assinaturas JWT
 * - Compressão de dados para otimização de espaço
 * - Particionamento de tabelas para melhor performance
 * - Exportação de logs em diferentes formatos
 * - Monitoramento de performance e integridade
 * - Processamento assíncrono via filas
 *
 * Este módulo é global e deve ser importado apenas pelo módulo principal (AppModule).
 * Os serviços são exportados para serem usados em qualquer outro módulo sem necessidade de reimportação.
 */
let AuditoriaModule = AuditoriaModule_1 = class AuditoriaModule {
    logger = new common_1.Logger(AuditoriaModule_1.name);
    /**
     * Configura o middleware de auditoria para todas as rotas da API
     * Restaurado com tratamento de erros
     */
    configure(consumer) {
        try {
            consumer
                .apply(auditoria_middleware_1.AuditoriaMiddleware)
                .exclude({ path: 'health', method: common_1.RequestMethod.ALL }, { path: 'metrics', method: common_1.RequestMethod.ALL }, { path: 'api-docs', method: common_1.RequestMethod.ALL }, { path: 'auditoria/monitoramento', method: common_1.RequestMethod.ALL })
                .forRoutes({ path: '*', method: common_1.RequestMethod.ALL });
            this.logger.log('Middleware de auditoria configurado com sucesso');
        }
        catch (error) {
            this.logger.error(`Erro ao configurar middleware de auditoria: ${error.message}`);
            // Não propagar erro para não bloquear a inicialização da aplicação
        }
    }
};
exports.AuditoriaModule = AuditoriaModule;
exports.AuditoriaModule = AuditoriaModule = AuditoriaModule_1 = __decorate([
    (0, common_1.Global)(),
    (0, common_1.Module)({
        imports: [
            // Configuração do TypeORM para entidades do módulo
            typeorm_1.TypeOrmModule.forFeature([entities_1.LogAuditoria]),
            // Configuração assíncrona do BullModule
            bull_1.BullModule.registerQueueAsync({
                name: 'auditoria',
                imports: [config_1.ConfigModule],
                useFactory: (configService) => ({
                    redis: {
                        host: configService.get('REDIS_HOST', 'localhost'),
                        port: configService.get('REDIS_PORT', 6379),
                    },
                }),
                inject: [config_1.ConfigService],
            }),
            // Módulo de agendamento de tarefas
            schedule_adapter_module_1.ScheduleAdapterModule,
            // Módulo de autenticação (para JwtAuthGuard e JwtBlacklistService)
            (0, common_1.forwardRef)(() => auth_module_1.AuthModule),
            // Configuração assíncrona do JwtModule
            jwt_1.JwtModule.registerAsync({
                imports: [config_1.ConfigModule],
                useFactory: (configService) => ({
                    secret: configService.get('JWT_SECRET'),
                    signOptions: { expiresIn: '1d' },
                }),
                inject: [config_1.ConfigService],
            }),
        ],
        controllers: [
            auditoria_controller_1.AuditoriaController,
            auditoria_exportacao_controller_1.AuditoriaExportacaoController,
            auditoria_monitoramento_controller_1.AuditoriaMonitoramentoController,
        ],
        providers: [
            // Serviços Core
            auditoria_service_1.AuditoriaService,
            auditoria_queue_service_1.AuditoriaQueueService,
            auditoria_queue_processor_1.AuditoriaQueueProcessor,
            // Repositórios
            log_auditoria_repository_1.LogAuditoriaRepository,
            // Serviços Especializados
            auditoria_signature_service_1.AuditoriaSignatureService,
            auditoria_exportacao_service_1.AuditoriaExportacaoService,
            auditoria_monitoramento_service_1.AuditoriaMonitoramentoService,
        ],
        exports: [
            // Exporta os serviços principais para uso em outros módulos
            auditoria_service_1.AuditoriaService,
            auditoria_queue_service_1.AuditoriaQueueService,
            log_auditoria_repository_1.LogAuditoriaRepository,
            auditoria_signature_service_1.AuditoriaSignatureService,
        ],
    })
], AuditoriaModule);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGF1ZGl0b3JpYVxcYXVkaXRvcmlhLm1vZHVsZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUEsMkNBUXdCO0FBQ3hCLDZDQUFnRDtBQUNoRCx1Q0FBMEM7QUFDMUMscUNBQXdDO0FBQ3hDLDJDQUE2RDtBQUM3RCwyRkFBc0Y7QUFDdEYsd0RBQW9EO0FBRXBELFlBQVk7QUFDWiw2Q0FBOEM7QUFFOUMsZ0JBQWdCO0FBQ2hCLG9FQUFnRTtBQUNoRSxnRkFBMkU7QUFDM0Usb0ZBQStFO0FBRS9FLDBCQUEwQjtBQUMxQix3RkFBbUY7QUFDbkYsMEZBQXFGO0FBQ3JGLGdHQUEyRjtBQUUzRixnQkFBZ0I7QUFDaEIsNkVBQXlFO0FBQ3pFLG1HQUE4RjtBQUM5Rix5R0FBb0c7QUFFcEcsYUFBYTtBQUNiLDZFQUF5RTtBQUV6RSxlQUFlO0FBQ2Ysc0ZBQWlGO0FBRWpGOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRztBQStESSxJQUFNLGVBQWUsdUJBQXJCLE1BQU0sZUFBZTtJQUNULE1BQU0sR0FBRyxJQUFJLGVBQU0sQ0FBQyxpQkFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNEOzs7T0FHRztJQUNILFNBQVMsQ0FBQyxRQUE0QjtRQUNwQyxJQUFJLENBQUM7WUFDSCxRQUFRO2lCQUNMLEtBQUssQ0FBQywwQ0FBbUIsQ0FBQztpQkFDMUIsT0FBTyxDQUNOLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsc0JBQWEsQ0FBQyxHQUFHLEVBQUUsRUFDN0MsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxzQkFBYSxDQUFDLEdBQUcsRUFBRSxFQUM5QyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLHNCQUFhLENBQUMsR0FBRyxFQUFFLEVBQy9DLEVBQUUsSUFBSSxFQUFFLHlCQUF5QixFQUFFLE1BQU0sRUFBRSxzQkFBYSxDQUFDLEdBQUcsRUFBRSxDQUMvRDtpQkFDQSxTQUFTLENBQUMsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxzQkFBYSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFFdkQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsaURBQWlELENBQUMsQ0FBQztRQUNyRSxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUNmLCtDQUErQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQy9ELENBQUM7WUFDRixtRUFBbUU7UUFDckUsQ0FBQztJQUNILENBQUM7Q0FDRixDQUFBO0FBMUJZLDBDQUFlOzBCQUFmLGVBQWU7SUE5RDNCLElBQUEsZUFBTSxHQUFFO0lBQ1IsSUFBQSxlQUFNLEVBQUM7UUFDTixPQUFPLEVBQUU7WUFDUCxtREFBbUQ7WUFDbkQsdUJBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQyx1QkFBWSxDQUFDLENBQUM7WUFFeEMsd0NBQXdDO1lBQ3hDLGlCQUFVLENBQUMsa0JBQWtCLENBQUM7Z0JBQzVCLElBQUksRUFBRSxXQUFXO2dCQUNqQixPQUFPLEVBQUUsQ0FBQyxxQkFBWSxDQUFDO2dCQUN2QixVQUFVLEVBQUUsQ0FBQyxhQUE0QixFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUM3QyxLQUFLLEVBQUU7d0JBQ0wsSUFBSSxFQUFFLGFBQWEsQ0FBQyxHQUFHLENBQVMsWUFBWSxFQUFFLFdBQVcsQ0FBQzt3QkFDMUQsSUFBSSxFQUFFLGFBQWEsQ0FBQyxHQUFHLENBQVMsWUFBWSxFQUFFLElBQUksQ0FBQztxQkFDcEQ7aUJBQ0YsQ0FBQztnQkFDRixNQUFNLEVBQUUsQ0FBQyxzQkFBYSxDQUFDO2FBQ3hCLENBQUM7WUFFRixtQ0FBbUM7WUFDbkMsK0NBQXFCO1lBRXJCLG1FQUFtRTtZQUNuRSxJQUFBLG1CQUFVLEVBQUMsR0FBRyxFQUFFLENBQUMsd0JBQVUsQ0FBQztZQUU1Qix1Q0FBdUM7WUFDdkMsZUFBUyxDQUFDLGFBQWEsQ0FBQztnQkFDdEIsT0FBTyxFQUFFLENBQUMscUJBQVksQ0FBQztnQkFDdkIsVUFBVSxFQUFFLENBQUMsYUFBNEIsRUFBRSxFQUFFLENBQUMsQ0FBQztvQkFDN0MsTUFBTSxFQUFFLGFBQWEsQ0FBQyxHQUFHLENBQVMsWUFBWSxDQUFDO29CQUMvQyxXQUFXLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFO2lCQUNqQyxDQUFDO2dCQUNGLE1BQU0sRUFBRSxDQUFDLHNCQUFhLENBQUM7YUFDeEIsQ0FBQztTQUNIO1FBQ0QsV0FBVyxFQUFFO1lBQ1gsMENBQW1CO1lBQ25CLCtEQUE2QjtZQUM3QixxRUFBZ0M7U0FDakM7UUFDRCxTQUFTLEVBQUU7WUFDVCxnQkFBZ0I7WUFDaEIsb0NBQWdCO1lBQ2hCLCtDQUFxQjtZQUNyQixtREFBdUI7WUFFdkIsZUFBZTtZQUNmLGlEQUFzQjtZQUV0QiwwQkFBMEI7WUFDMUIsdURBQXlCO1lBQ3pCLHlEQUEwQjtZQUMxQiwrREFBNkI7U0FDOUI7UUFDRCxPQUFPLEVBQUU7WUFDUCw0REFBNEQ7WUFDNUQsb0NBQWdCO1lBQ2hCLCtDQUFxQjtZQUNyQixpREFBc0I7WUFDdEIsdURBQXlCO1NBQzFCO0tBQ0YsQ0FBQztHQUNXLGVBQWUsQ0EwQjNCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxtb2R1bGVzXFxhdWRpdG9yaWFcXGF1ZGl0b3JpYS5tb2R1bGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgR2xvYmFsLFxuICBNb2R1bGUsXG4gIE5lc3RNb2R1bGUsXG4gIE1pZGRsZXdhcmVDb25zdW1lcixcbiAgUmVxdWVzdE1ldGhvZCxcbiAgTG9nZ2VyLFxuICBmb3J3YXJkUmVmLFxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XG5pbXBvcnQgeyBUeXBlT3JtTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90eXBlb3JtJztcbmltcG9ydCB7IEJ1bGxNb2R1bGUgfSBmcm9tICdAbmVzdGpzL2J1bGwnO1xuaW1wb3J0IHsgSnd0TW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy9qd3QnO1xuaW1wb3J0IHsgQ29uZmlnTW9kdWxlLCBDb25maWdTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9jb25maWcnO1xuaW1wb3J0IHsgU2NoZWR1bGVBZGFwdGVyTW9kdWxlIH0gZnJvbSAnLi4vLi4vc2hhcmVkL3NjaGVkdWxlL3NjaGVkdWxlLWFkYXB0ZXIubW9kdWxlJztcbmltcG9ydCB7IEF1dGhNb2R1bGUgfSBmcm9tICcuLi8uLi9hdXRoL2F1dGgubW9kdWxlJztcblxuLy8gRW50aWRhZGVzXG5pbXBvcnQgeyBMb2dBdWRpdG9yaWEgfSBmcm9tICcuLi8uLi9lbnRpdGllcyc7XG5cbi8vIFNlcnZpw6dvcyBDb3JlXG5pbXBvcnQgeyBBdWRpdG9yaWFTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9hdWRpdG9yaWEuc2VydmljZSc7XG5pbXBvcnQgeyBBdWRpdG9yaWFRdWV1ZVNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL2F1ZGl0b3JpYS1xdWV1ZS5zZXJ2aWNlJztcbmltcG9ydCB7IEF1ZGl0b3JpYVF1ZXVlUHJvY2Vzc29yIH0gZnJvbSAnLi9zZXJ2aWNlcy9hdWRpdG9yaWEtcXVldWUucHJvY2Vzc29yJztcblxuLy8gU2VydmnDp29zIEVzcGVjaWFsaXphZG9zXG5pbXBvcnQgeyBBdWRpdG9yaWFTaWduYXR1cmVTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9hdWRpdG9yaWEtc2lnbmF0dXJlLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXVkaXRvcmlhRXhwb3J0YWNhb1NlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL2F1ZGl0b3JpYS1leHBvcnRhY2FvLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXVkaXRvcmlhTW9uaXRvcmFtZW50b1NlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL2F1ZGl0b3JpYS1tb25pdG9yYW1lbnRvLnNlcnZpY2UnO1xuXG4vLyBDb250cm9sYWRvcmVzXG5pbXBvcnQgeyBBdWRpdG9yaWFDb250cm9sbGVyIH0gZnJvbSAnLi9jb250cm9sbGVycy9hdWRpdG9yaWEuY29udHJvbGxlcic7XG5pbXBvcnQgeyBBdWRpdG9yaWFFeHBvcnRhY2FvQ29udHJvbGxlciB9IGZyb20gJy4vY29udHJvbGxlcnMvYXVkaXRvcmlhLWV4cG9ydGFjYW8uY29udHJvbGxlcic7XG5pbXBvcnQgeyBBdWRpdG9yaWFNb25pdG9yYW1lbnRvQ29udHJvbGxlciB9IGZyb20gJy4vY29udHJvbGxlcnMvYXVkaXRvcmlhLW1vbml0b3JhbWVudG8uY29udHJvbGxlcic7XG5cbi8vIE1pZGRsZXdhcmVcbmltcG9ydCB7IEF1ZGl0b3JpYU1pZGRsZXdhcmUgfSBmcm9tICcuL21pZGRsZXdhcmVzL2F1ZGl0b3JpYS5taWRkbGV3YXJlJztcblxuLy8gUmVwb3NpdMOzcmlvc1xuaW1wb3J0IHsgTG9nQXVkaXRvcmlhUmVwb3NpdG9yeSB9IGZyb20gJy4vcmVwb3NpdG9yaWVzL2xvZy1hdWRpdG9yaWEucmVwb3NpdG9yeSc7XG5cbi8qKlxuICogTcOzZHVsbyBkZSBBdWRpdG9yaWEgVW5pZmljYWRvXG4gKlxuICogUmVzcG9uc8OhdmVsIHBvciByZWdpc3RyYXIgZSBnZXJlbmNpYXIgbG9ncyBkZSBhdWRpdG9yaWEgZG8gc2lzdGVtYSxcbiAqIGdhcmFudGluZG8gYSByYXN0cmVhYmlsaWRhZGUgZGFzIG9wZXJhw6fDtWVzIGUgY29tcGxpYW5jZSBjb20gTEdQRC5cbiAqXG4gKiBGdW5jaW9uYWxpZGFkZXM6XG4gKiAtIFJlZ2lzdHJvIGF1dG9tw6F0aWNvIGRlIG9wZXJhw6fDtWVzIHZpYSBtaWRkbGV3YXJlIGUgaW50ZXJjZXB0b3Jlc1xuICogLSBQcm90ZcOnw6NvIGNvbnRyYSB0YW1wZXJpbmcgdXNhbmRvIGFzc2luYXR1cmFzIEpXVFxuICogLSBDb21wcmVzc8OjbyBkZSBkYWRvcyBwYXJhIG90aW1pemHDp8OjbyBkZSBlc3Bhw6dvXG4gKiAtIFBhcnRpY2lvbmFtZW50byBkZSB0YWJlbGFzIHBhcmEgbWVsaG9yIHBlcmZvcm1hbmNlXG4gKiAtIEV4cG9ydGHDp8OjbyBkZSBsb2dzIGVtIGRpZmVyZW50ZXMgZm9ybWF0b3NcbiAqIC0gTW9uaXRvcmFtZW50byBkZSBwZXJmb3JtYW5jZSBlIGludGVncmlkYWRlXG4gKiAtIFByb2Nlc3NhbWVudG8gYXNzw61uY3Jvbm8gdmlhIGZpbGFzXG4gKlxuICogRXN0ZSBtw7NkdWxvIMOpIGdsb2JhbCBlIGRldmUgc2VyIGltcG9ydGFkbyBhcGVuYXMgcGVsbyBtw7NkdWxvIHByaW5jaXBhbCAoQXBwTW9kdWxlKS5cbiAqIE9zIHNlcnZpw6dvcyBzw6NvIGV4cG9ydGFkb3MgcGFyYSBzZXJlbSB1c2Fkb3MgZW0gcXVhbHF1ZXIgb3V0cm8gbcOzZHVsbyBzZW0gbmVjZXNzaWRhZGUgZGUgcmVpbXBvcnRhw6fDo28uXG4gKi9cbkBHbG9iYWwoKVxuQE1vZHVsZSh7XG4gIGltcG9ydHM6IFtcbiAgICAvLyBDb25maWd1cmHDp8OjbyBkbyBUeXBlT1JNIHBhcmEgZW50aWRhZGVzIGRvIG3Ds2R1bG9cbiAgICBUeXBlT3JtTW9kdWxlLmZvckZlYXR1cmUoW0xvZ0F1ZGl0b3JpYV0pLFxuXG4gICAgLy8gQ29uZmlndXJhw6fDo28gYXNzw61uY3JvbmEgZG8gQnVsbE1vZHVsZVxuICAgIEJ1bGxNb2R1bGUucmVnaXN0ZXJRdWV1ZUFzeW5jKHtcbiAgICAgIG5hbWU6ICdhdWRpdG9yaWEnLFxuICAgICAgaW1wb3J0czogW0NvbmZpZ01vZHVsZV0sXG4gICAgICB1c2VGYWN0b3J5OiAoY29uZmlnU2VydmljZTogQ29uZmlnU2VydmljZSkgPT4gKHtcbiAgICAgICAgcmVkaXM6IHtcbiAgICAgICAgICBob3N0OiBjb25maWdTZXJ2aWNlLmdldDxzdHJpbmc+KCdSRURJU19IT1NUJywgJ2xvY2FsaG9zdCcpLFxuICAgICAgICAgIHBvcnQ6IGNvbmZpZ1NlcnZpY2UuZ2V0PG51bWJlcj4oJ1JFRElTX1BPUlQnLCA2Mzc5KSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgICAgaW5qZWN0OiBbQ29uZmlnU2VydmljZV0sXG4gICAgfSksXG5cbiAgICAvLyBNw7NkdWxvIGRlIGFnZW5kYW1lbnRvIGRlIHRhcmVmYXNcbiAgICBTY2hlZHVsZUFkYXB0ZXJNb2R1bGUsXG5cbiAgICAvLyBNw7NkdWxvIGRlIGF1dGVudGljYcOnw6NvIChwYXJhIEp3dEF1dGhHdWFyZCBlIEp3dEJsYWNrbGlzdFNlcnZpY2UpXG4gICAgZm9yd2FyZFJlZigoKSA9PiBBdXRoTW9kdWxlKSxcblxuICAgIC8vIENvbmZpZ3VyYcOnw6NvIGFzc8OtbmNyb25hIGRvIEp3dE1vZHVsZVxuICAgIEp3dE1vZHVsZS5yZWdpc3RlckFzeW5jKHtcbiAgICAgIGltcG9ydHM6IFtDb25maWdNb2R1bGVdLFxuICAgICAgdXNlRmFjdG9yeTogKGNvbmZpZ1NlcnZpY2U6IENvbmZpZ1NlcnZpY2UpID0+ICh7XG4gICAgICAgIHNlY3JldDogY29uZmlnU2VydmljZS5nZXQ8c3RyaW5nPignSldUX1NFQ1JFVCcpLFxuICAgICAgICBzaWduT3B0aW9uczogeyBleHBpcmVzSW46ICcxZCcgfSxcbiAgICAgIH0pLFxuICAgICAgaW5qZWN0OiBbQ29uZmlnU2VydmljZV0sXG4gICAgfSksXG4gIF0sXG4gIGNvbnRyb2xsZXJzOiBbXG4gICAgQXVkaXRvcmlhQ29udHJvbGxlcixcbiAgICBBdWRpdG9yaWFFeHBvcnRhY2FvQ29udHJvbGxlcixcbiAgICBBdWRpdG9yaWFNb25pdG9yYW1lbnRvQ29udHJvbGxlcixcbiAgXSxcbiAgcHJvdmlkZXJzOiBbXG4gICAgLy8gU2VydmnDp29zIENvcmVcbiAgICBBdWRpdG9yaWFTZXJ2aWNlLFxuICAgIEF1ZGl0b3JpYVF1ZXVlU2VydmljZSxcbiAgICBBdWRpdG9yaWFRdWV1ZVByb2Nlc3NvcixcblxuICAgIC8vIFJlcG9zaXTDs3Jpb3NcbiAgICBMb2dBdWRpdG9yaWFSZXBvc2l0b3J5LFxuXG4gICAgLy8gU2VydmnDp29zIEVzcGVjaWFsaXphZG9zXG4gICAgQXVkaXRvcmlhU2lnbmF0dXJlU2VydmljZSxcbiAgICBBdWRpdG9yaWFFeHBvcnRhY2FvU2VydmljZSxcbiAgICBBdWRpdG9yaWFNb25pdG9yYW1lbnRvU2VydmljZSxcbiAgXSxcbiAgZXhwb3J0czogW1xuICAgIC8vIEV4cG9ydGEgb3Mgc2VydmnDp29zIHByaW5jaXBhaXMgcGFyYSB1c28gZW0gb3V0cm9zIG3Ds2R1bG9zXG4gICAgQXVkaXRvcmlhU2VydmljZSxcbiAgICBBdWRpdG9yaWFRdWV1ZVNlcnZpY2UsXG4gICAgTG9nQXVkaXRvcmlhUmVwb3NpdG9yeSxcbiAgICBBdWRpdG9yaWFTaWduYXR1cmVTZXJ2aWNlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBBdWRpdG9yaWFNb2R1bGUgaW1wbGVtZW50cyBOZXN0TW9kdWxlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBsb2dnZXIgPSBuZXcgTG9nZ2VyKEF1ZGl0b3JpYU1vZHVsZS5uYW1lKTtcbiAgLyoqXG4gICAqIENvbmZpZ3VyYSBvIG1pZGRsZXdhcmUgZGUgYXVkaXRvcmlhIHBhcmEgdG9kYXMgYXMgcm90YXMgZGEgQVBJXG4gICAqIFJlc3RhdXJhZG8gY29tIHRyYXRhbWVudG8gZGUgZXJyb3NcbiAgICovXG4gIGNvbmZpZ3VyZShjb25zdW1lcjogTWlkZGxld2FyZUNvbnN1bWVyKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN1bWVyXG4gICAgICAgIC5hcHBseShBdWRpdG9yaWFNaWRkbGV3YXJlKVxuICAgICAgICAuZXhjbHVkZShcbiAgICAgICAgICB7IHBhdGg6ICdoZWFsdGgnLCBtZXRob2Q6IFJlcXVlc3RNZXRob2QuQUxMIH0sXG4gICAgICAgICAgeyBwYXRoOiAnbWV0cmljcycsIG1ldGhvZDogUmVxdWVzdE1ldGhvZC5BTEwgfSxcbiAgICAgICAgICB7IHBhdGg6ICdhcGktZG9jcycsIG1ldGhvZDogUmVxdWVzdE1ldGhvZC5BTEwgfSxcbiAgICAgICAgICB7IHBhdGg6ICdhdWRpdG9yaWEvbW9uaXRvcmFtZW50bycsIG1ldGhvZDogUmVxdWVzdE1ldGhvZC5BTEwgfSwgLy8gRXZpdGFyIHJlY3Vyc8Ojb1xuICAgICAgICApXG4gICAgICAgIC5mb3JSb3V0ZXMoeyBwYXRoOiAnKicsIG1ldGhvZDogUmVxdWVzdE1ldGhvZC5BTEwgfSk7XG5cbiAgICAgIHRoaXMubG9nZ2VyLmxvZygnTWlkZGxld2FyZSBkZSBhdWRpdG9yaWEgY29uZmlndXJhZG8gY29tIHN1Y2Vzc28nKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvIGFvIGNvbmZpZ3VyYXIgbWlkZGxld2FyZSBkZSBhdWRpdG9yaWE6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgKTtcbiAgICAgIC8vIE7Do28gcHJvcGFnYXIgZXJybyBwYXJhIG7Do28gYmxvcXVlYXIgYSBpbmljaWFsaXphw6fDo28gZGEgYXBsaWNhw6fDo29cbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==