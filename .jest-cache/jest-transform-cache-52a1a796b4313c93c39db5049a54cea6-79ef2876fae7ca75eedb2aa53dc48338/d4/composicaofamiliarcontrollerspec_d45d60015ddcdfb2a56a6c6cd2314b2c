ac764a740ec403f3ff08d8fd17551139
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const composicao_familiar_controller_1 = require("./composicao-familiar.controller");
const composicao_familiar_service_1 = require("../services/composicao-familiar.service");
const common_1 = require("@nestjs/common");
const escolaridade_enum_1 = require("../enums/escolaridade.enum");
const parentesco_enum_1 = require("../enums/parentesco.enum");
describe('ComposicaoFamiliarController', () => {
    let controller;
    let service;
    const mockComposicaoFamiliarService = {
        create: jest.fn(),
        findByCidadao: jest.fn(),
        findOne: jest.fn(),
        update: jest.fn(),
        remove: jest.fn(),
        findByCpf: jest.fn(),
    };
    const mockComposicaoFamiliarResponse = {
        id: '123e4567-e89b-12d3-a456-426614174000',
        cidadao_id: '123e4567-e89b-12d3-a456-426614174001',
        nome: 'João Silva',
        cpf: '123.456.789-00',
        nis: '12345678901',
        idade: 25,
        ocupacao: 'Estudante',
        escolaridade: escolaridade_enum_1.EscolaridadeEnum.MEDIO_INCOMPLETO,
        parentesco: parentesco_enum_1.ParentescoEnum.FILHO,
        renda: 1500.00,
        observacoes: 'Observações de teste',
        created_at: new Date('2024-01-01T10:00:00Z'),
        updated_at: new Date('2024-01-01T10:00:00Z'),
        ativo: true,
        cpf_formatado: '',
        escolaridade_descricao: '',
        parentesco_descricao: ''
    };
    const mockPaginatedResponse = {
        data: [mockComposicaoFamiliarResponse],
        meta: {
            total: 1,
            page: 1,
            limit: 10,
            totalPages: 1,
            hasNext: false,
            hasPrev: false,
        },
        estatisticas: {
            totalMembros: 1,
            rendaTotal: 1500.00,
            rendaMedia: 1500.00,
            idadeMedia: 25,
            membrosComRenda: 1,
        },
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            controllers: [composicao_familiar_controller_1.ComposicaoFamiliarController],
            providers: [
                {
                    provide: composicao_familiar_service_1.ComposicaoFamiliarService,
                    useValue: mockComposicaoFamiliarService,
                },
            ],
        }).compile();
        controller = module.get(composicao_familiar_controller_1.ComposicaoFamiliarController);
        service = module.get(composicao_familiar_service_1.ComposicaoFamiliarService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    it('should be defined', () => {
        expect(controller).toBeDefined();
    });
    describe('create', () => {
        const createDto = {
            cidadao_id: '123e4567-e89b-12d3-a456-426614174001',
            nome: 'João Silva',
            cpf: '12345678900',
            nis: '12345678901',
            idade: 25,
            ocupacao: 'Estudante',
            escolaridade: escolaridade_enum_1.EscolaridadeEnum.MEDIO_COMPLETO,
            parentesco: parentesco_enum_1.ParentescoEnum.FILHO,
            renda: 1500.00,
            observacoes: 'Observações de teste',
        };
        const mockRequest = {
            user: { id: 'user123' },
        };
        it('should create a new composicao familiar member', async () => {
            mockComposicaoFamiliarService.create.mockResolvedValue(mockComposicaoFamiliarResponse);
            const result = await controller.create(createDto, mockRequest);
            expect(service.create).toHaveBeenCalledWith(createDto, 'user123');
            expect(result).toEqual(mockComposicaoFamiliarResponse);
        });
        it('should throw ConflictException when member already exists', async () => {
            mockComposicaoFamiliarService.create.mockRejectedValue(new common_1.ConflictException('Já existe um membro com este CPF na composição familiar'));
            await expect(controller.create(createDto, mockRequest))
                .rejects.toThrow(common_1.ConflictException);
        });
        it('should throw BadRequestException for invalid data', async () => {
            mockComposicaoFamiliarService.create.mockRejectedValue(new common_1.BadRequestException('CPF inválido'));
            await expect(controller.create(createDto, mockRequest))
                .rejects.toThrow(common_1.BadRequestException);
        });
    });
    describe('findByCidadao', () => {
        const cidadaoId = '123e4567-e89b-12d3-a456-426614174001';
        const query = { page: 1, limit: 10 };
        it('should return paginated composicao familiar members', async () => {
            mockComposicaoFamiliarService.findByCidadao.mockResolvedValue(mockPaginatedResponse);
            const result = await controller.findByCidadao(cidadaoId, query.page, query.limit);
            expect(service.findByCidadao).toHaveBeenCalledWith(cidadaoId, query);
            expect(result).toEqual(mockPaginatedResponse);
        });
        it('should throw NotFoundException when cidadao does not exist', async () => {
            mockComposicaoFamiliarService.findByCidadao.mockRejectedValue(new common_1.NotFoundException('Cidadão não encontrado'));
            await expect(controller.findByCidadao(cidadaoId, 1, 10))
                .rejects.toThrow(common_1.NotFoundException);
        });
        it('should use default pagination values', async () => {
            mockComposicaoFamiliarService.findByCidadao.mockResolvedValue(mockPaginatedResponse);
            await controller.findByCidadao(cidadaoId, 1, 10);
            expect(service.findByCidadao).toHaveBeenCalledWith(cidadaoId, {
                page: 1,
                limit: 10,
            });
        });
    });
    describe('findOne', () => {
        const id = '123e4567-e89b-12d3-a456-426614174000';
        it('should return a composicao familiar member', async () => {
            mockComposicaoFamiliarService.findOne.mockResolvedValue(mockComposicaoFamiliarResponse);
            const result = await controller.findOne(id);
            expect(service.findOne).toHaveBeenCalledWith(id);
            expect(result).toEqual(mockComposicaoFamiliarResponse);
        });
        it('should throw NotFoundException when member does not exist', async () => {
            mockComposicaoFamiliarService.findOne.mockRejectedValue(new common_1.NotFoundException('Membro da composição familiar não encontrado'));
            await expect(controller.findOne(id))
                .rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('update', () => {
        const id = '123e4567-e89b-12d3-a456-426614174000';
        const updateDto = {
            nome: 'João Silva Atualizado',
            renda: 2000.00,
        };
        const mockRequest = {
            user: { id: 'user123' },
        };
        it('should update a composicao familiar member', async () => {
            const updatedResponse = {
                ...mockComposicaoFamiliarResponse,
                nome: 'João Silva Atualizado',
                renda: 2000.00,
            };
            mockComposicaoFamiliarService.update.mockResolvedValue(updatedResponse);
            const result = await controller.update(id, updateDto, mockRequest);
            expect(service.update).toHaveBeenCalledWith(id, updateDto, 'user123');
            expect(result).toEqual(updatedResponse);
        });
        it('should throw NotFoundException when member does not exist', async () => {
            mockComposicaoFamiliarService.update.mockRejectedValue(new common_1.NotFoundException('Membro da composição familiar não encontrado'));
            await expect(controller.update(id, updateDto, mockRequest))
                .rejects.toThrow(common_1.NotFoundException);
        });
        it('should throw ConflictException for duplicate data', async () => {
            mockComposicaoFamiliarService.update.mockRejectedValue(new common_1.ConflictException('Já existe um membro com este nome na composição familiar'));
            await expect(controller.update(id, updateDto, mockRequest))
                .rejects.toThrow(common_1.ConflictException);
        });
    });
    describe('remove', () => {
        const id = '123e4567-e89b-12d3-a456-426614174000';
        const mockRequest = {
            user: { id: 'user123' },
        };
        it('should remove a composicao familiar member', async () => {
            mockComposicaoFamiliarService.remove.mockResolvedValue(undefined);
            await controller.remove(id, mockRequest);
            expect(service.remove).toHaveBeenCalledWith(id, 'user123');
        });
        it('should throw NotFoundException when member does not exist', async () => {
            mockComposicaoFamiliarService.remove.mockRejectedValue(new common_1.NotFoundException('Membro da composição familiar não encontrado'));
            await expect(controller.remove(id, mockRequest))
                .rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('findByCpf', () => {
        const cpf = '12345678900';
        it('should return composicao familiar members by CPF', async () => {
            const expectedResponse = [mockComposicaoFamiliarResponse];
            mockComposicaoFamiliarService.findByCpf.mockResolvedValue(expectedResponse);
            const result = await controller.findByCpf(cpf);
            expect(service.findByCpf).toHaveBeenCalledWith(cpf);
            expect(result).toEqual(expectedResponse);
        });
        it('should throw BadRequestException for invalid CPF', async () => {
            mockComposicaoFamiliarService.findByCpf.mockRejectedValue(new common_1.BadRequestException('CPF deve ter 11 dígitos'));
            await expect(controller.findByCpf('123'))
                .rejects.toThrow(common_1.BadRequestException);
        });
        it('should return empty array when no members found', async () => {
            mockComposicaoFamiliarService.findByCpf.mockResolvedValue([]);
            const result = await controller.findByCpf(cpf);
            expect(result).toEqual([]);
        });
    });
    describe('Input validation', () => {
        it('should validate UUID format for ID parameters', async () => {
            const invalidId = 'invalid-uuid';
            // O controller deve validar UUIDs através dos decorators
            // Este teste verifica se a validação está configurada corretamente
            expect(() => {
                // Simulação de validação de UUID
                const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
                if (!uuidRegex.test(invalidId)) {
                    throw new common_1.BadRequestException('ID deve ser um UUID válido');
                }
            }).toThrow(common_1.BadRequestException);
        });
        it('should validate pagination parameters', () => {
            const invalidQuery = { page: -1, limit: 0 };
            // Validação de parâmetros de paginação
            expect(() => {
                if (invalidQuery.page < 1 || invalidQuery.limit < 1) {
                    throw new common_1.BadRequestException('Parâmetros de paginação inválidos');
                }
            }).toThrow(common_1.BadRequestException);
        });
    });
    describe('Error handling', () => {
        it('should handle service errors gracefully', async () => {
            const createDto = {
                cidadao_id: '123e4567-e89b-12d3-a456-426614174001',
                nome: 'João Silva',
                cpf: '12345678900',
                nis: '12345678901',
                idade: 25,
                ocupacao: 'Estudante',
                escolaridade: escolaridade_enum_1.EscolaridadeEnum.MEDIO_COMPLETO,
                parentesco: parentesco_enum_1.ParentescoEnum.FILHO,
            };
            const mockRequest = { user: { id: 'user123' } };
            mockComposicaoFamiliarService.create.mockRejectedValue(new Error('Erro interno do servidor'));
            await expect(controller.create(createDto, mockRequest))
                .rejects.toThrow('Erro interno do servidor');
        });
    });
    describe('Authorization', () => {
        it('should extract user ID from request', async () => {
            const createDto = {
                cidadao_id: '123e4567-e89b-12d3-a456-426614174001',
                nome: 'João Silva',
                cpf: '12345678900',
                nis: '12345678901',
                idade: 25,
                ocupacao: 'Estudante',
                escolaridade: escolaridade_enum_1.EscolaridadeEnum.MEDIO_COMPLETO,
                parentesco: parentesco_enum_1.ParentescoEnum.FILHO,
            };
            const mockRequest = { user: { id: 'user123' } };
            mockComposicaoFamiliarService.create.mockResolvedValue(mockComposicaoFamiliarResponse);
            await controller.create(createDto, mockRequest);
            expect(service.create).toHaveBeenCalledWith(createDto, 'user123');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGNpZGFkYW9cXGNvbnRyb2xsZXJzXFxjb21wb3NpY2FvLWZhbWlsaWFyLmNvbnRyb2xsZXIuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCxxRkFBZ0Y7QUFDaEYseUZBQW9GO0FBT3BGLDJDQUl3QjtBQUN4QixrRUFBOEQ7QUFDOUQsOERBQTBEO0FBRTFELFFBQVEsQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7SUFDNUMsSUFBSSxVQUF3QyxDQUFDO0lBQzdDLElBQUksT0FBa0MsQ0FBQztJQUV2QyxNQUFNLDZCQUE2QixHQUFHO1FBQ3BDLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3hCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ3JCLENBQUM7SUFFRixNQUFNLDhCQUE4QixHQUFrQztRQUNwRSxFQUFFLEVBQUUsc0NBQXNDO1FBQzFDLFVBQVUsRUFBRSxzQ0FBc0M7UUFDbEQsSUFBSSxFQUFFLFlBQVk7UUFDbEIsR0FBRyxFQUFFLGdCQUFnQjtRQUNyQixHQUFHLEVBQUUsYUFBYTtRQUNsQixLQUFLLEVBQUUsRUFBRTtRQUNULFFBQVEsRUFBRSxXQUFXO1FBQ3JCLFlBQVksRUFBRSxvQ0FBZ0IsQ0FBQyxnQkFBZ0I7UUFDL0MsVUFBVSxFQUFFLGdDQUFjLENBQUMsS0FBSztRQUNoQyxLQUFLLEVBQUUsT0FBTztRQUNkLFdBQVcsRUFBRSxzQkFBc0I7UUFDbkMsVUFBVSxFQUFFLElBQUksSUFBSSxDQUFDLHNCQUFzQixDQUFDO1FBQzVDLFVBQVUsRUFBRSxJQUFJLElBQUksQ0FBQyxzQkFBc0IsQ0FBQztRQUM1QyxLQUFLLEVBQUUsSUFBSTtRQUNYLGFBQWEsRUFBRSxFQUFFO1FBQ2pCLHNCQUFzQixFQUFFLEVBQUU7UUFDMUIsb0JBQW9CLEVBQUUsRUFBRTtLQUN6QixDQUFDO0lBRUYsTUFBTSxxQkFBcUIsR0FBMkM7UUFDcEUsSUFBSSxFQUFFLENBQUMsOEJBQThCLENBQUM7UUFDdEMsSUFBSSxFQUFFO1lBQ0osS0FBSyxFQUFFLENBQUM7WUFDUixJQUFJLEVBQUUsQ0FBQztZQUNQLEtBQUssRUFBRSxFQUFFO1lBQ1QsVUFBVSxFQUFFLENBQUM7WUFDYixPQUFPLEVBQUUsS0FBSztZQUNkLE9BQU8sRUFBRSxLQUFLO1NBQ2Y7UUFDRCxZQUFZLEVBQUU7WUFDWixZQUFZLEVBQUUsQ0FBQztZQUNmLFVBQVUsRUFBRSxPQUFPO1lBQ25CLFVBQVUsRUFBRSxPQUFPO1lBQ25CLFVBQVUsRUFBRSxFQUFFO1lBQ2QsZUFBZSxFQUFFLENBQUM7U0FDbkI7S0FDRixDQUFDO0lBRUYsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxXQUFXLEVBQUUsQ0FBQyw2REFBNEIsQ0FBQztZQUMzQyxTQUFTLEVBQUU7Z0JBQ1Q7b0JBQ0UsT0FBTyxFQUFFLHVEQUF5QjtvQkFDbEMsUUFBUSxFQUFFLDZCQUE2QjtpQkFDeEM7YUFDRjtTQUNGLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUViLFVBQVUsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUErQiw2REFBNEIsQ0FBQyxDQUFDO1FBQ3BGLE9BQU8sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUE0Qix1REFBeUIsQ0FBQyxDQUFDO0lBQzdFLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7UUFDM0IsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ25DLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7UUFDdEIsTUFBTSxTQUFTLEdBQWdDO1lBQzdDLFVBQVUsRUFBRSxzQ0FBc0M7WUFDbEQsSUFBSSxFQUFFLFlBQVk7WUFDbEIsR0FBRyxFQUFFLGFBQWE7WUFDbEIsR0FBRyxFQUFFLGFBQWE7WUFDbEIsS0FBSyxFQUFFLEVBQUU7WUFDVCxRQUFRLEVBQUUsV0FBVztZQUNyQixZQUFZLEVBQUUsb0NBQWdCLENBQUMsY0FBYztZQUM3QyxVQUFVLEVBQUUsZ0NBQWMsQ0FBQyxLQUFLO1lBQ2hDLEtBQUssRUFBRSxPQUFPO1lBQ2QsV0FBVyxFQUFFLHNCQUFzQjtTQUNwQyxDQUFDO1FBRUYsTUFBTSxXQUFXLEdBQUc7WUFDbEIsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRTtTQUN4QixDQUFDO1FBRUYsRUFBRSxDQUFDLGdEQUFnRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzlELDZCQUE2QixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1lBRXZGLE1BQU0sTUFBTSxHQUFHLE1BQU0sVUFBVSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsV0FBa0IsQ0FBQyxDQUFDO1lBRXRFLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQ2xFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsOEJBQThCLENBQUMsQ0FBQztRQUN6RCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyREFBMkQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6RSw2QkFBNkIsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQ3BELElBQUksMEJBQWlCLENBQUMseURBQXlELENBQUMsQ0FDakYsQ0FBQztZQUVGLE1BQU0sTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLFdBQWtCLENBQUMsQ0FBQztpQkFDM0QsT0FBTyxDQUFDLE9BQU8sQ0FBQywwQkFBaUIsQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG1EQUFtRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pFLDZCQUE2QixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FDcEQsSUFBSSw0QkFBbUIsQ0FBQyxjQUFjLENBQUMsQ0FDeEMsQ0FBQztZQUVGLE1BQU0sTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLFdBQWtCLENBQUMsQ0FBQztpQkFDM0QsT0FBTyxDQUFDLE9BQU8sQ0FBQyw0QkFBbUIsQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtRQUM3QixNQUFNLFNBQVMsR0FBRyxzQ0FBc0MsQ0FBQztRQUN6RCxNQUFNLEtBQUssR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDO1FBRXJDLEVBQUUsQ0FBQyxxREFBcUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNuRSw2QkFBNkIsQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMscUJBQXFCLENBQUMsQ0FBQztZQUVyRixNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRWxGLE1BQU0sQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUMsb0JBQW9CLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3JFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUNoRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw0REFBNEQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMxRSw2QkFBNkIsQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQzNELElBQUksMEJBQWlCLENBQUMsd0JBQXdCLENBQUMsQ0FDaEQsQ0FBQztZQUVGLE1BQU0sTUFBTSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztpQkFDckQsT0FBTyxDQUFDLE9BQU8sQ0FBQywwQkFBaUIsQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BELDZCQUE2QixDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1lBRXJGLE1BQU0sVUFBVSxDQUFDLGFBQWEsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRWpELE1BQU0sQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUMsb0JBQW9CLENBQUMsU0FBUyxFQUFFO2dCQUM1RCxJQUFJLEVBQUUsQ0FBQztnQkFDUCxLQUFLLEVBQUUsRUFBRTthQUNWLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRTtRQUN2QixNQUFNLEVBQUUsR0FBRyxzQ0FBc0MsQ0FBQztRQUVsRCxFQUFFLENBQUMsNENBQTRDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDMUQsNkJBQTZCLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLDhCQUE4QixDQUFDLENBQUM7WUFFeEYsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRTVDLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsb0JBQW9CLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDakQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1FBQ3pELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDJEQUEyRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3pFLDZCQUE2QixDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FDckQsSUFBSSwwQkFBaUIsQ0FBQyw4Q0FBOEMsQ0FBQyxDQUN0RSxDQUFDO1lBRUYsTUFBTSxNQUFNLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztpQkFDakMsT0FBTyxDQUFDLE9BQU8sQ0FBQywwQkFBaUIsQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRTtRQUN0QixNQUFNLEVBQUUsR0FBRyxzQ0FBc0MsQ0FBQztRQUNsRCxNQUFNLFNBQVMsR0FBZ0M7WUFDN0MsSUFBSSxFQUFFLHVCQUF1QjtZQUM3QixLQUFLLEVBQUUsT0FBTztTQUNmLENBQUM7UUFFRixNQUFNLFdBQVcsR0FBRztZQUNsQixJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFO1NBQ3hCLENBQUM7UUFFRixFQUFFLENBQUMsNENBQTRDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDMUQsTUFBTSxlQUFlLEdBQUc7Z0JBQ3RCLEdBQUcsOEJBQThCO2dCQUNqQyxJQUFJLEVBQUUsdUJBQXVCO2dCQUM3QixLQUFLLEVBQUUsT0FBTzthQUNmLENBQUM7WUFDRiw2QkFBNkIsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsZUFBZSxDQUFDLENBQUM7WUFFeEUsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsV0FBa0IsQ0FBQyxDQUFDO1lBRTFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztZQUN0RSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDJEQUEyRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3pFLDZCQUE2QixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FDcEQsSUFBSSwwQkFBaUIsQ0FBQyw4Q0FBOEMsQ0FBQyxDQUN0RSxDQUFDO1lBRUYsTUFBTSxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLFdBQWtCLENBQUMsQ0FBQztpQkFDL0QsT0FBTyxDQUFDLE9BQU8sQ0FBQywwQkFBaUIsQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG1EQUFtRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pFLDZCQUE2QixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FDcEQsSUFBSSwwQkFBaUIsQ0FBQywwREFBMEQsQ0FBQyxDQUNsRixDQUFDO1lBRUYsTUFBTSxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLFdBQWtCLENBQUMsQ0FBQztpQkFDL0QsT0FBTyxDQUFDLE9BQU8sQ0FBQywwQkFBaUIsQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRTtRQUN0QixNQUFNLEVBQUUsR0FBRyxzQ0FBc0MsQ0FBQztRQUNsRCxNQUFNLFdBQVcsR0FBRztZQUNsQixJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFO1NBQ3hCLENBQUM7UUFFRixFQUFFLENBQUMsNENBQTRDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDMUQsNkJBQTZCLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRWxFLE1BQU0sVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsV0FBa0IsQ0FBQyxDQUFDO1lBRWhELE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsRUFBRSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQzdELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDJEQUEyRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3pFLDZCQUE2QixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FDcEQsSUFBSSwwQkFBaUIsQ0FBQyw4Q0FBOEMsQ0FBQyxDQUN0RSxDQUFDO1lBRUYsTUFBTSxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsV0FBa0IsQ0FBQyxDQUFDO2lCQUNwRCxPQUFPLENBQUMsT0FBTyxDQUFDLDBCQUFpQixDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFO1FBQ3pCLE1BQU0sR0FBRyxHQUFHLGFBQWEsQ0FBQztRQUUxQixFQUFFLENBQUMsa0RBQWtELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDaEUsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLDhCQUE4QixDQUFDLENBQUM7WUFDMUQsNkJBQTZCLENBQUMsU0FBUyxDQUFDLGlCQUFpQixDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFFNUUsTUFBTSxNQUFNLEdBQUcsTUFBTSxVQUFVLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRS9DLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDcEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzNDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGtEQUFrRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2hFLDZCQUE2QixDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FDdkQsSUFBSSw0QkFBbUIsQ0FBQyx5QkFBeUIsQ0FBQyxDQUNuRCxDQUFDO1lBRUYsTUFBTSxNQUFNLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztpQkFDdEMsT0FBTyxDQUFDLE9BQU8sQ0FBQyw0QkFBbUIsQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGlEQUFpRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9ELDZCQUE2QixDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUU5RCxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFL0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM3QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxFQUFFLENBQUMsK0NBQStDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDN0QsTUFBTSxTQUFTLEdBQUcsY0FBYyxDQUFDO1lBRWpDLHlEQUF5RDtZQUN6RCxtRUFBbUU7WUFDbkUsTUFBTSxDQUFDLEdBQUcsRUFBRTtnQkFDVixpQ0FBaUM7Z0JBQ2pDLE1BQU0sU0FBUyxHQUFHLDRFQUE0RSxDQUFDO2dCQUMvRixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO29CQUMvQixNQUFNLElBQUksNEJBQW1CLENBQUMsNEJBQTRCLENBQUMsQ0FBQztnQkFDOUQsQ0FBQztZQUNILENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyw0QkFBbUIsQ0FBQyxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUMvQyxNQUFNLFlBQVksR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFFNUMsdUNBQXVDO1lBQ3ZDLE1BQU0sQ0FBQyxHQUFHLEVBQUU7Z0JBQ1YsSUFBSSxZQUFZLENBQUMsSUFBSSxHQUFHLENBQUMsSUFBSSxZQUFZLENBQUMsS0FBSyxHQUFHLENBQUMsRUFBRSxDQUFDO29CQUNwRCxNQUFNLElBQUksNEJBQW1CLENBQUMsbUNBQW1DLENBQUMsQ0FBQztnQkFDckUsQ0FBQztZQUNILENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyw0QkFBbUIsQ0FBQyxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLEVBQUUsQ0FBQyx5Q0FBeUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN2RCxNQUFNLFNBQVMsR0FBZ0M7Z0JBQzdDLFVBQVUsRUFBRSxzQ0FBc0M7Z0JBQ2xELElBQUksRUFBRSxZQUFZO2dCQUNsQixHQUFHLEVBQUUsYUFBYTtnQkFDbEIsR0FBRyxFQUFFLGFBQWE7Z0JBQ2xCLEtBQUssRUFBRSxFQUFFO2dCQUNULFFBQVEsRUFBRSxXQUFXO2dCQUNyQixZQUFZLEVBQUUsb0NBQWdCLENBQUMsY0FBYztnQkFDN0MsVUFBVSxFQUFFLGdDQUFjLENBQUMsS0FBSzthQUNqQyxDQUFDO1lBRUYsTUFBTSxXQUFXLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLEVBQUUsQ0FBQztZQUVoRCw2QkFBNkIsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQ3BELElBQUksS0FBSyxDQUFDLDBCQUEwQixDQUFDLENBQ3RDLENBQUM7WUFFRixNQUFNLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxXQUFrQixDQUFDLENBQUM7aUJBQzNELE9BQU8sQ0FBQyxPQUFPLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUNqRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7UUFDN0IsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ25ELE1BQU0sU0FBUyxHQUFnQztnQkFDN0MsVUFBVSxFQUFFLHNDQUFzQztnQkFDbEQsSUFBSSxFQUFFLFlBQVk7Z0JBQ2xCLEdBQUcsRUFBRSxhQUFhO2dCQUNsQixHQUFHLEVBQUUsYUFBYTtnQkFDbEIsS0FBSyxFQUFFLEVBQUU7Z0JBQ1QsUUFBUSxFQUFFLFdBQVc7Z0JBQ3JCLFlBQVksRUFBRSxvQ0FBZ0IsQ0FBQyxjQUFjO2dCQUM3QyxVQUFVLEVBQUUsZ0NBQWMsQ0FBQyxLQUFLO2FBQ2pDLENBQUM7WUFFRixNQUFNLFdBQVcsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsRUFBRSxDQUFDO1lBQ2hELDZCQUE2QixDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1lBRXZGLE1BQU0sVUFBVSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsV0FBa0IsQ0FBQyxDQUFDO1lBRXZELE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ3BFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xcY2lkYWRhb1xcY29udHJvbGxlcnNcXGNvbXBvc2ljYW8tZmFtaWxpYXIuY29udHJvbGxlci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xyXG5pbXBvcnQgeyBDb21wb3NpY2FvRmFtaWxpYXJDb250cm9sbGVyIH0gZnJvbSAnLi9jb21wb3NpY2FvLWZhbWlsaWFyLmNvbnRyb2xsZXInO1xyXG5pbXBvcnQgeyBDb21wb3NpY2FvRmFtaWxpYXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvY29tcG9zaWNhby1mYW1pbGlhci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ3JlYXRlQ29tcG9zaWNhb0ZhbWlsaWFyRHRvIH0gZnJvbSAnLi4vZHRvL2NyZWF0ZS1jb21wb3NpY2FvLWZhbWlsaWFyLmR0byc7XHJcbmltcG9ydCB7IFVwZGF0ZUNvbXBvc2ljYW9GYW1pbGlhckR0byB9IGZyb20gJy4uL2R0by91cGRhdGUtY29tcG9zaWNhby1mYW1pbGlhci5kdG8nO1xyXG5pbXBvcnQge1xyXG4gIENvbXBvc2ljYW9GYW1pbGlhclJlc3BvbnNlRHRvLFxyXG4gIENvbXBvc2ljYW9GYW1pbGlhclBhZ2luYXRlZFJlc3BvbnNlRHRvLFxyXG59IGZyb20gJy4uL2R0by9jb21wb3NpY2FvLWZhbWlsaWFyLXJlc3BvbnNlLmR0byc7XHJcbmltcG9ydCB7XHJcbiAgTm90Rm91bmRFeGNlcHRpb24sXHJcbiAgQ29uZmxpY3RFeGNlcHRpb24sXHJcbiAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcclxufSBmcm9tICdAbmVzdGpzL2NvbW1vbic7XHJcbmltcG9ydCB7IEVzY29sYXJpZGFkZUVudW0gfSBmcm9tICcuLi9lbnVtcy9lc2NvbGFyaWRhZGUuZW51bSc7XHJcbmltcG9ydCB7IFBhcmVudGVzY29FbnVtIH0gZnJvbSAnLi4vZW51bXMvcGFyZW50ZXNjby5lbnVtJztcclxuXHJcbmRlc2NyaWJlKCdDb21wb3NpY2FvRmFtaWxpYXJDb250cm9sbGVyJywgKCkgPT4ge1xyXG4gIGxldCBjb250cm9sbGVyOiBDb21wb3NpY2FvRmFtaWxpYXJDb250cm9sbGVyO1xyXG4gIGxldCBzZXJ2aWNlOiBDb21wb3NpY2FvRmFtaWxpYXJTZXJ2aWNlO1xyXG5cclxuICBjb25zdCBtb2NrQ29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZSA9IHtcclxuICAgIGNyZWF0ZTogamVzdC5mbigpLFxyXG4gICAgZmluZEJ5Q2lkYWRhbzogamVzdC5mbigpLFxyXG4gICAgZmluZE9uZTogamVzdC5mbigpLFxyXG4gICAgdXBkYXRlOiBqZXN0LmZuKCksXHJcbiAgICByZW1vdmU6IGplc3QuZm4oKSxcclxuICAgIGZpbmRCeUNwZjogamVzdC5mbigpLFxyXG4gIH07XHJcblxyXG4gIGNvbnN0IG1vY2tDb21wb3NpY2FvRmFtaWxpYXJSZXNwb25zZTogQ29tcG9zaWNhb0ZhbWlsaWFyUmVzcG9uc2VEdG8gPSB7XHJcbiAgICBpZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsXHJcbiAgICBjaWRhZGFvX2lkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAxJyxcclxuICAgIG5vbWU6ICdKb8OjbyBTaWx2YScsXHJcbiAgICBjcGY6ICcxMjMuNDU2Ljc4OS0wMCcsXHJcbiAgICBuaXM6ICcxMjM0NTY3ODkwMScsXHJcbiAgICBpZGFkZTogMjUsXHJcbiAgICBvY3VwYWNhbzogJ0VzdHVkYW50ZScsXHJcbiAgICBlc2NvbGFyaWRhZGU6IEVzY29sYXJpZGFkZUVudW0uTUVESU9fSU5DT01QTEVUTyxcclxuICAgIHBhcmVudGVzY286IFBhcmVudGVzY29FbnVtLkZJTEhPLFxyXG4gICAgcmVuZGE6IDE1MDAuMDAsXHJcbiAgICBvYnNlcnZhY29lczogJ09ic2VydmHDp8O1ZXMgZGUgdGVzdGUnLFxyXG4gICAgY3JlYXRlZF9hdDogbmV3IERhdGUoJzIwMjQtMDEtMDFUMTA6MDA6MDBaJyksXHJcbiAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgnMjAyNC0wMS0wMVQxMDowMDowMFonKSxcclxuICAgIGF0aXZvOiB0cnVlLFxyXG4gICAgY3BmX2Zvcm1hdGFkbzogJycsXHJcbiAgICBlc2NvbGFyaWRhZGVfZGVzY3JpY2FvOiAnJyxcclxuICAgIHBhcmVudGVzY29fZGVzY3JpY2FvOiAnJ1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IG1vY2tQYWdpbmF0ZWRSZXNwb25zZTogQ29tcG9zaWNhb0ZhbWlsaWFyUGFnaW5hdGVkUmVzcG9uc2VEdG8gPSB7XHJcbiAgICBkYXRhOiBbbW9ja0NvbXBvc2ljYW9GYW1pbGlhclJlc3BvbnNlXSxcclxuICAgIG1ldGE6IHtcclxuICAgICAgdG90YWw6IDEsXHJcbiAgICAgIHBhZ2U6IDEsXHJcbiAgICAgIGxpbWl0OiAxMCxcclxuICAgICAgdG90YWxQYWdlczogMSxcclxuICAgICAgaGFzTmV4dDogZmFsc2UsXHJcbiAgICAgIGhhc1ByZXY6IGZhbHNlLFxyXG4gICAgfSxcclxuICAgIGVzdGF0aXN0aWNhczoge1xyXG4gICAgICB0b3RhbE1lbWJyb3M6IDEsXHJcbiAgICAgIHJlbmRhVG90YWw6IDE1MDAuMDAsXHJcbiAgICAgIHJlbmRhTWVkaWE6IDE1MDAuMDAsXHJcbiAgICAgIGlkYWRlTWVkaWE6IDI1LFxyXG4gICAgICBtZW1icm9zQ29tUmVuZGE6IDEsXHJcbiAgICB9LFxyXG4gIH07XHJcblxyXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xyXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcclxuICAgICAgY29udHJvbGxlcnM6IFtDb21wb3NpY2FvRmFtaWxpYXJDb250cm9sbGVyXSxcclxuICAgICAgcHJvdmlkZXJzOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcHJvdmlkZTogQ29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZSxcclxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQ29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZSxcclxuICAgICAgICB9LFxyXG4gICAgICBdLFxyXG4gICAgfSkuY29tcGlsZSgpO1xyXG5cclxuICAgIGNvbnRyb2xsZXIgPSBtb2R1bGUuZ2V0PENvbXBvc2ljYW9GYW1pbGlhckNvbnRyb2xsZXI+KENvbXBvc2ljYW9GYW1pbGlhckNvbnRyb2xsZXIpO1xyXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8Q29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZT4oQ29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZSk7XHJcbiAgfSk7XHJcblxyXG4gIGFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCBiZSBkZWZpbmVkJywgKCkgPT4ge1xyXG4gICAgZXhwZWN0KGNvbnRyb2xsZXIpLnRvQmVEZWZpbmVkKCk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjcmVhdGUnLCAoKSA9PiB7XHJcbiAgICBjb25zdCBjcmVhdGVEdG86IENyZWF0ZUNvbXBvc2ljYW9GYW1pbGlhckR0byA9IHtcclxuICAgICAgY2lkYWRhb19pZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMScsXHJcbiAgICAgIG5vbWU6ICdKb8OjbyBTaWx2YScsXHJcbiAgICAgIGNwZjogJzEyMzQ1Njc4OTAwJyxcclxuICAgICAgbmlzOiAnMTIzNDU2Nzg5MDEnLFxyXG4gICAgICBpZGFkZTogMjUsXHJcbiAgICAgIG9jdXBhY2FvOiAnRXN0dWRhbnRlJyxcclxuICAgICAgZXNjb2xhcmlkYWRlOiBFc2NvbGFyaWRhZGVFbnVtLk1FRElPX0NPTVBMRVRPLFxyXG4gICAgICBwYXJlbnRlc2NvOiBQYXJlbnRlc2NvRW51bS5GSUxITyxcclxuICAgICAgcmVuZGE6IDE1MDAuMDAsXHJcbiAgICAgIG9ic2VydmFjb2VzOiAnT2JzZXJ2YcOnw7VlcyBkZSB0ZXN0ZScsXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xyXG4gICAgICB1c2VyOiB7IGlkOiAndXNlcjEyMycgfSxcclxuICAgIH07XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYSBuZXcgY29tcG9zaWNhbyBmYW1pbGlhciBtZW1iZXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tDb21wb3NpY2FvRmFtaWxpYXJTZXJ2aWNlLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ29tcG9zaWNhb0ZhbWlsaWFyUmVzcG9uc2UpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5jcmVhdGUoY3JlYXRlRHRvLCBtb2NrUmVxdWVzdCBhcyBhbnkpO1xyXG5cclxuICAgICAgZXhwZWN0KHNlcnZpY2UuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChjcmVhdGVEdG8sICd1c2VyMTIzJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0NvbXBvc2ljYW9GYW1pbGlhclJlc3BvbnNlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgQ29uZmxpY3RFeGNlcHRpb24gd2hlbiBtZW1iZXIgYWxyZWFkeSBleGlzdHMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tDb21wb3NpY2FvRmFtaWxpYXJTZXJ2aWNlLmNyZWF0ZS5tb2NrUmVqZWN0ZWRWYWx1ZShcclxuICAgICAgICBuZXcgQ29uZmxpY3RFeGNlcHRpb24oJ0rDoSBleGlzdGUgdW0gbWVtYnJvIGNvbSBlc3RlIENQRiBuYSBjb21wb3Npw6fDo28gZmFtaWxpYXInKSxcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmNyZWF0ZShjcmVhdGVEdG8sIG1vY2tSZXF1ZXN0IGFzIGFueSkpXHJcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdyhDb25mbGljdEV4Y2VwdGlvbik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHRocm93IEJhZFJlcXVlc3RFeGNlcHRpb24gZm9yIGludmFsaWQgZGF0YScsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja0NvbXBvc2ljYW9GYW1pbGlhclNlcnZpY2UuY3JlYXRlLm1vY2tSZWplY3RlZFZhbHVlKFxyXG4gICAgICAgIG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKCdDUEYgaW52w6FsaWRvJyksXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5jcmVhdGUoY3JlYXRlRHRvLCBtb2NrUmVxdWVzdCBhcyBhbnkpKVxyXG4gICAgICAgIC5yZWplY3RzLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2ZpbmRCeUNpZGFkYW8nLCAoKSA9PiB7XHJcbiAgICBjb25zdCBjaWRhZGFvSWQgPSAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAxJztcclxuICAgIGNvbnN0IHF1ZXJ5ID0geyBwYWdlOiAxLCBsaW1pdDogMTAgfTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBwYWdpbmF0ZWQgY29tcG9zaWNhbyBmYW1pbGlhciBtZW1iZXJzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrQ29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZS5maW5kQnlDaWRhZGFvLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQYWdpbmF0ZWRSZXNwb25zZSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRCeUNpZGFkYW8oY2lkYWRhb0lkLCBxdWVyeS5wYWdlLCBxdWVyeS5saW1pdCk7XHJcblxyXG4gICAgICBleHBlY3Qoc2VydmljZS5maW5kQnlDaWRhZGFvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChjaWRhZGFvSWQsIHF1ZXJ5KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUGFnaW5hdGVkUmVzcG9uc2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBOb3RGb3VuZEV4Y2VwdGlvbiB3aGVuIGNpZGFkYW8gZG9lcyBub3QgZXhpc3QnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tDb21wb3NpY2FvRmFtaWxpYXJTZXJ2aWNlLmZpbmRCeUNpZGFkYW8ubW9ja1JlamVjdGVkVmFsdWUoXHJcbiAgICAgICAgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdDaWRhZMOjbyBuw6NvIGVuY29udHJhZG8nKSxcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmZpbmRCeUNpZGFkYW8oY2lkYWRhb0lkLCAxLCAxMCkpXHJcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHVzZSBkZWZhdWx0IHBhZ2luYXRpb24gdmFsdWVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrQ29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZS5maW5kQnlDaWRhZGFvLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQYWdpbmF0ZWRSZXNwb25zZSk7XHJcblxyXG4gICAgICBhd2FpdCBjb250cm9sbGVyLmZpbmRCeUNpZGFkYW8oY2lkYWRhb0lkLCAxLCAxMCk7XHJcblxyXG4gICAgICBleHBlY3Qoc2VydmljZS5maW5kQnlDaWRhZGFvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChjaWRhZGFvSWQsIHtcclxuICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgIGxpbWl0OiAxMCxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2ZpbmRPbmUnLCAoKSA9PiB7XHJcbiAgICBjb25zdCBpZCA9ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGEgY29tcG9zaWNhbyBmYW1pbGlhciBtZW1iZXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tDb21wb3NpY2FvRmFtaWxpYXJTZXJ2aWNlLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbXBvc2ljYW9GYW1pbGlhclJlc3BvbnNlKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZmluZE9uZShpZCk7XHJcblxyXG4gICAgICBleHBlY3Qoc2VydmljZS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChpZCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0NvbXBvc2ljYW9GYW1pbGlhclJlc3BvbnNlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gd2hlbiBtZW1iZXIgZG9lcyBub3QgZXhpc3QnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tDb21wb3NpY2FvRmFtaWxpYXJTZXJ2aWNlLmZpbmRPbmUubW9ja1JlamVjdGVkVmFsdWUoXHJcbiAgICAgICAgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdNZW1icm8gZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyIG7Do28gZW5jb250cmFkbycpLFxyXG4gICAgICApO1xyXG5cclxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIuZmluZE9uZShpZCkpXHJcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3VwZGF0ZScsICgpID0+IHtcclxuICAgIGNvbnN0IGlkID0gJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCc7XHJcbiAgICBjb25zdCB1cGRhdGVEdG86IFVwZGF0ZUNvbXBvc2ljYW9GYW1pbGlhckR0byA9IHtcclxuICAgICAgbm9tZTogJ0pvw6NvIFNpbHZhIEF0dWFsaXphZG8nLFxyXG4gICAgICByZW5kYTogMjAwMC4wMCxcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgIHVzZXI6IHsgaWQ6ICd1c2VyMTIzJyB9LFxyXG4gICAgfTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBhIGNvbXBvc2ljYW8gZmFtaWxpYXIgbWVtYmVyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB1cGRhdGVkUmVzcG9uc2UgPSB7XHJcbiAgICAgICAgLi4ubW9ja0NvbXBvc2ljYW9GYW1pbGlhclJlc3BvbnNlLFxyXG4gICAgICAgIG5vbWU6ICdKb8OjbyBTaWx2YSBBdHVhbGl6YWRvJyxcclxuICAgICAgICByZW5kYTogMjAwMC4wMCxcclxuICAgICAgfTtcclxuICAgICAgbW9ja0NvbXBvc2ljYW9GYW1pbGlhclNlcnZpY2UudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHVwZGF0ZWRSZXNwb25zZSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnVwZGF0ZShpZCwgdXBkYXRlRHRvLCBtb2NrUmVxdWVzdCBhcyBhbnkpO1xyXG5cclxuICAgICAgZXhwZWN0KHNlcnZpY2UudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChpZCwgdXBkYXRlRHRvLCAndXNlcjEyMycpO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHVwZGF0ZWRSZXNwb25zZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIHdoZW4gbWVtYmVyIGRvZXMgbm90IGV4aXN0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrQ29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZS51cGRhdGUubW9ja1JlamVjdGVkVmFsdWUoXHJcbiAgICAgICAgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdNZW1icm8gZGEgY29tcG9zacOnw6NvIGZhbWlsaWFyIG7Do28gZW5jb250cmFkbycpLFxyXG4gICAgICApO1xyXG5cclxuICAgICAgYXdhaXQgZXhwZWN0KGNvbnRyb2xsZXIudXBkYXRlKGlkLCB1cGRhdGVEdG8sIG1vY2tSZXF1ZXN0IGFzIGFueSkpXHJcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHRocm93IENvbmZsaWN0RXhjZXB0aW9uIGZvciBkdXBsaWNhdGUgZGF0YScsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja0NvbXBvc2ljYW9GYW1pbGlhclNlcnZpY2UudXBkYXRlLm1vY2tSZWplY3RlZFZhbHVlKFxyXG4gICAgICAgIG5ldyBDb25mbGljdEV4Y2VwdGlvbignSsOhIGV4aXN0ZSB1bSBtZW1icm8gY29tIGVzdGUgbm9tZSBuYSBjb21wb3Npw6fDo28gZmFtaWxpYXInKSxcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLnVwZGF0ZShpZCwgdXBkYXRlRHRvLCBtb2NrUmVxdWVzdCBhcyBhbnkpKVxyXG4gICAgICAgIC5yZWplY3RzLnRvVGhyb3coQ29uZmxpY3RFeGNlcHRpb24pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdyZW1vdmUnLCAoKSA9PiB7XHJcbiAgICBjb25zdCBpZCA9ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnO1xyXG4gICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XHJcbiAgICAgIHVzZXI6IHsgaWQ6ICd1c2VyMTIzJyB9LFxyXG4gICAgfTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJlbW92ZSBhIGNvbXBvc2ljYW8gZmFtaWxpYXIgbWVtYmVyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrQ29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZS5yZW1vdmUubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcclxuXHJcbiAgICAgIGF3YWl0IGNvbnRyb2xsZXIucmVtb3ZlKGlkLCBtb2NrUmVxdWVzdCBhcyBhbnkpO1xyXG5cclxuICAgICAgZXhwZWN0KHNlcnZpY2UucmVtb3ZlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChpZCwgJ3VzZXIxMjMnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gd2hlbiBtZW1iZXIgZG9lcyBub3QgZXhpc3QnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIG1vY2tDb21wb3NpY2FvRmFtaWxpYXJTZXJ2aWNlLnJlbW92ZS5tb2NrUmVqZWN0ZWRWYWx1ZShcclxuICAgICAgICBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ01lbWJybyBkYSBjb21wb3Npw6fDo28gZmFtaWxpYXIgbsOjbyBlbmNvbnRyYWRvJyksXHJcbiAgICAgICk7XHJcblxyXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5yZW1vdmUoaWQsIG1vY2tSZXF1ZXN0IGFzIGFueSkpXHJcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2ZpbmRCeUNwZicsICgpID0+IHtcclxuICAgIGNvbnN0IGNwZiA9ICcxMjM0NTY3ODkwMCc7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29tcG9zaWNhbyBmYW1pbGlhciBtZW1iZXJzIGJ5IENQRicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZXhwZWN0ZWRSZXNwb25zZSA9IFttb2NrQ29tcG9zaWNhb0ZhbWlsaWFyUmVzcG9uc2VdO1xyXG4gICAgICBtb2NrQ29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZS5maW5kQnlDcGYubW9ja1Jlc29sdmVkVmFsdWUoZXhwZWN0ZWRSZXNwb25zZSk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRCeUNwZihjcGYpO1xyXG5cclxuICAgICAgZXhwZWN0KHNlcnZpY2UuZmluZEJ5Q3BmKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChjcGYpO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKGV4cGVjdGVkUmVzcG9uc2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBCYWRSZXF1ZXN0RXhjZXB0aW9uIGZvciBpbnZhbGlkIENQRicsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja0NvbXBvc2ljYW9GYW1pbGlhclNlcnZpY2UuZmluZEJ5Q3BmLm1vY2tSZWplY3RlZFZhbHVlKFxyXG4gICAgICAgIG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKCdDUEYgZGV2ZSB0ZXIgMTEgZMOtZ2l0b3MnKSxcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmZpbmRCeUNwZignMTIzJykpXHJcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVtcHR5IGFycmF5IHdoZW4gbm8gbWVtYmVycyBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgbW9ja0NvbXBvc2ljYW9GYW1pbGlhclNlcnZpY2UuZmluZEJ5Q3BmLm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZmluZEJ5Q3BmKGNwZik7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFtdKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnSW5wdXQgdmFsaWRhdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgVVVJRCBmb3JtYXQgZm9yIElEIHBhcmFtZXRlcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGludmFsaWRJZCA9ICdpbnZhbGlkLXV1aWQnO1xyXG4gICAgICBcclxuICAgICAgLy8gTyBjb250cm9sbGVyIGRldmUgdmFsaWRhciBVVUlEcyBhdHJhdsOpcyBkb3MgZGVjb3JhdG9yc1xyXG4gICAgICAvLyBFc3RlIHRlc3RlIHZlcmlmaWNhIHNlIGEgdmFsaWRhw6fDo28gZXN0w6EgY29uZmlndXJhZGEgY29ycmV0YW1lbnRlXHJcbiAgICAgIGV4cGVjdCgoKSA9PiB7XHJcbiAgICAgICAgLy8gU2ltdWxhw6fDo28gZGUgdmFsaWRhw6fDo28gZGUgVVVJRFxyXG4gICAgICAgIGNvbnN0IHV1aWRSZWdleCA9IC9eWzAtOWEtZl17OH0tWzAtOWEtZl17NH0tWzEtNV1bMC05YS1mXXszfS1bODlhYl1bMC05YS1mXXszfS1bMC05YS1mXXsxMn0kL2k7XHJcbiAgICAgICAgaWYgKCF1dWlkUmVnZXgudGVzdChpbnZhbGlkSWQpKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignSUQgZGV2ZSBzZXIgdW0gVVVJRCB2w6FsaWRvJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KS50b1Rocm93KEJhZFJlcXVlc3RFeGNlcHRpb24pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBwYWdpbmF0aW9uIHBhcmFtZXRlcnMnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGludmFsaWRRdWVyeSA9IHsgcGFnZTogLTEsIGxpbWl0OiAwIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBWYWxpZGHDp8OjbyBkZSBwYXLDom1ldHJvcyBkZSBwYWdpbmHDp8Ojb1xyXG4gICAgICBleHBlY3QoKCkgPT4ge1xyXG4gICAgICAgIGlmIChpbnZhbGlkUXVlcnkucGFnZSA8IDEgfHwgaW52YWxpZFF1ZXJ5LmxpbWl0IDwgMSkge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ1BhcsOibWV0cm9zIGRlIHBhZ2luYcOnw6NvIGludsOhbGlkb3MnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pLnRvVGhyb3coQmFkUmVxdWVzdEV4Y2VwdGlvbik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0Vycm9yIGhhbmRsaW5nJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc2VydmljZSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgY3JlYXRlRHRvOiBDcmVhdGVDb21wb3NpY2FvRmFtaWxpYXJEdG8gPSB7XHJcbiAgICAgICAgY2lkYWRhb19pZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMScsXHJcbiAgICAgICAgbm9tZTogJ0pvw6NvIFNpbHZhJyxcclxuICAgICAgICBjcGY6ICcxMjM0NTY3ODkwMCcsXHJcbiAgICAgICAgbmlzOiAnMTIzNDU2Nzg5MDEnLFxyXG4gICAgICAgIGlkYWRlOiAyNSxcclxuICAgICAgICBvY3VwYWNhbzogJ0VzdHVkYW50ZScsXHJcbiAgICAgICAgZXNjb2xhcmlkYWRlOiBFc2NvbGFyaWRhZGVFbnVtLk1FRElPX0NPTVBMRVRPLFxyXG4gICAgICAgIHBhcmVudGVzY286IFBhcmVudGVzY29FbnVtLkZJTEhPLFxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7IHVzZXI6IHsgaWQ6ICd1c2VyMTIzJyB9IH07XHJcblxyXG4gICAgICBtb2NrQ29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZS5jcmVhdGUubW9ja1JlamVjdGVkVmFsdWUoXHJcbiAgICAgICAgbmV3IEVycm9yKCdFcnJvIGludGVybm8gZG8gc2Vydmlkb3InKSxcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLmNyZWF0ZShjcmVhdGVEdG8sIG1vY2tSZXF1ZXN0IGFzIGFueSkpXHJcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygnRXJybyBpbnRlcm5vIGRvIHNlcnZpZG9yJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0F1dGhvcml6YXRpb24nLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGV4dHJhY3QgdXNlciBJRCBmcm9tIHJlcXVlc3QnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNyZWF0ZUR0bzogQ3JlYXRlQ29tcG9zaWNhb0ZhbWlsaWFyRHRvID0ge1xyXG4gICAgICAgIGNpZGFkYW9faWQ6ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDEnLFxyXG4gICAgICAgIG5vbWU6ICdKb8OjbyBTaWx2YScsXHJcbiAgICAgICAgY3BmOiAnMTIzNDU2Nzg5MDAnLFxyXG4gICAgICAgIG5pczogJzEyMzQ1Njc4OTAxJyxcclxuICAgICAgICBpZGFkZTogMjUsXHJcbiAgICAgICAgb2N1cGFjYW86ICdFc3R1ZGFudGUnLFxyXG4gICAgICAgIGVzY29sYXJpZGFkZTogRXNjb2xhcmlkYWRlRW51bS5NRURJT19DT01QTEVUTyxcclxuICAgICAgICBwYXJlbnRlc2NvOiBQYXJlbnRlc2NvRW51bS5GSUxITyxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0geyB1c2VyOiB7IGlkOiAndXNlcjEyMycgfSB9O1xyXG4gICAgICBtb2NrQ29tcG9zaWNhb0ZhbWlsaWFyU2VydmljZS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NvbXBvc2ljYW9GYW1pbGlhclJlc3BvbnNlKTtcclxuXHJcbiAgICAgIGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlKGNyZWF0ZUR0bywgbW9ja1JlcXVlc3QgYXMgYW55KTtcclxuXHJcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoY3JlYXRlRHRvLCAndXNlcjEyMycpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==