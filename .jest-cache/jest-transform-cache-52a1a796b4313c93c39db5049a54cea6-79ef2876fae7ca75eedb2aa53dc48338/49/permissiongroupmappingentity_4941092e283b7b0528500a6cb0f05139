73a1550e3778dfdd9863b4814f4cde86
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", { value: true });
exports.PermissionGroupMapping = void 0;
const typeorm_1 = require("typeorm");
const class_validator_1 = require("class-validator");
const permission_entity_1 = require("./permission.entity");
const permission_group_entity_1 = require("./permission-group.entity");
const usuario_entity_1 = require("./usuario.entity");
/**
 * Entidade que representa o relacionamento muitos-para-muitos entre permissões e grupos.
 *
 * Esta entidade permite associar permissões a grupos, facilitando a organização
 * e atribuição de permissões relacionadas.
 */
let PermissionGroupMapping = class PermissionGroupMapping {
    /**
     * Identificador único do mapeamento
     */
    id;
    /**
     * Referência à permissão
     */
    permissao_id;
    /**
     * Relação com a permissão
     */
    permissao;
    /**
     * Referência ao grupo
     */
    grupo_id;
    /**
     * Relação com o grupo
     */
    grupo;
    /**
     * Data de criação
     */
    created_at;
    /**
     * Usuário que criou o mapeamento
     */
    criado_por;
    /**
     * Relação com o usuário que criou o mapeamento
     */
    usuario_criador;
    // Getters e setters para compatibilidade com código existente
    get permissionId() {
        return this.permissao_id;
    }
    set permissionId(value) {
        this.permissao_id = value;
    }
    get permission() {
        return this.permissao;
    }
    set permission(value) {
        this.permissao = value;
    }
    get groupId() {
        return this.grupo_id;
    }
    set groupId(value) {
        this.grupo_id = value;
    }
    get group() {
        return this.grupo;
    }
    set group(value) {
        this.grupo = value;
    }
    get createdAt() {
        return this.created_at;
    }
    get createdBy() {
        return this.criado_por;
    }
    set createdBy(value) {
        this.criado_por = value;
    }
    /**
     * Verifica se o mapeamento foi criado por um usuário específico
     * @param usuarioId ID do usuário
     * @returns true se foi criado pelo usuário
     */
    foiCriadoPor(usuarioId) {
        return this.criado_por === usuarioId;
    }
    /**
     * Obtém uma chave única para o mapeamento
     * @returns chave única baseada em permissão e grupo
     */
    getUniqueKey() {
        return `${this.permissao_id}:${this.grupo_id}`;
    }
    /**
     * Verifica se o mapeamento é válido
     * @returns true se tem permissão e grupo válidos
     */
    isValido() {
        return !!(this.permissao_id && this.grupo_id);
    }
    /**
     * Define o criador do mapeamento
     * @param usuarioId ID do usuário criador
     */
    definirCriador(usuarioId) {
        this.criado_por = usuarioId;
    }
    /**
     * Verifica se o mapeamento pertence a um grupo específico
     * @param grupoId ID do grupo
     * @returns true se pertence ao grupo
     */
    pertenceAoGrupo(grupoId) {
        return this.grupo_id === grupoId;
    }
    /**
     * Verifica se o mapeamento contém uma permissão específica
     * @param permissaoId ID da permissão
     * @returns true se contém a permissão
     */
    contemPermissao(permissaoId) {
        return this.permissao_id === permissaoId;
    }
    /**
     * Verifica se o mapeamento foi criado recentemente (últimas 24 horas)
     * @returns true se foi criado recentemente
     */
    isCriadoRecentemente() {
        if (!this.created_at)
            return false;
        const agora = new Date();
        const umDiaAtras = new Date(agora.getTime() - 24 * 60 * 60 * 1000);
        return this.created_at > umDiaAtras;
    }
    /**
     * Calcula a idade do mapeamento em dias
     * @returns idade em dias
     */
    getIdadeEmDias() {
        if (!this.created_at)
            return 0;
        const agora = new Date();
        const diffTime = Math.abs(agora.getTime() - this.created_at.getTime());
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays;
    }
    /**
     * Verifica se o mapeamento tem criador definido
     * @returns true se tem criador
     */
    temCriador() {
        return !!this.criado_por;
    }
    /**
     * Obtém informações resumidas do mapeamento
     * @returns objeto com informações resumidas
     */
    getSummary() {
        return {
            id: this.id,
            permissao_id: this.permissao_id,
            grupo_id: this.grupo_id,
            criado_por: this.criado_por,
            created_at: this.created_at,
            idadeEmDias: this.getIdadeEmDias(),
            permissaoNome: this.permissao?.nome,
            grupoNome: this.grupo?.nome,
        };
    }
    /**
     * Verifica se o mapeamento é compatível com outro mapeamento
     * @param otherMapping Outro mapeamento
     * @returns true se são compatíveis (mesmo grupo)
     */
    isCompatibleWith(otherMapping) {
        return this.grupo_id === otherMapping.grupo_id;
    }
    /**
     * Gera uma chave única estendida para o mapeamento
     * @returns chave única estendida
     */
    getExtendedUniqueKey() {
        return `permission_group_mapping_${this.permissao_id}_${this.grupo_id}_${this.id}`;
    }
    /**
     * Verifica se o mapeamento está em estado consistente
     * @returns true se está consistente
     */
    isConsistente() {
        return (!!this.id && !!this.permissao_id && !!this.grupo_id && !!this.created_at);
    }
    /**
     * Obtém uma descrição legível do mapeamento
     * @returns descrição formatada
     */
    getDescricao() {
        const permissaoNome = this.permissao?.nome || 'Permissão não carregada';
        const grupoNome = this.grupo?.nome || 'Grupo não carregado';
        return `Grupo "${grupoNome}" -> Permissão: ${permissaoNome}`;
    }
    /**
     * Verifica se o mapeamento pode ser removido
     * @returns true se pode ser removido
     */
    podeSerRemovido() {
        // Por padrão, todos os mapeamentos podem ser removidos
        // Esta lógica pode ser expandida conforme regras de negócio
        return true;
    }
    /**
     * Clona o mapeamento (sem ID e data)
     * @returns mapeamento clonado
     */
    clone() {
        return {
            permissao_id: this.permissao_id,
            grupo_id: this.grupo_id,
            criado_por: this.criado_por,
        };
    }
    /**
     * Verifica se o mapeamento é para uma permissão de administrador
     * @returns true se é permissão de admin
     */
    isAdminPermission() {
        return this.permissao?.isAdminPermission() || false;
    }
    /**
     * Verifica se o mapeamento é para uma permissão de sistema
     * @returns true se é permissão de sistema
     */
    isSystemPermission() {
        return this.permissao?.isSystemPermission() || false;
    }
    /**
     * Obtém o nível de criticidade baseado na permissão
     * @returns nível de criticidade
     */
    getCriticalityLevel() {
        return this.permissao?.getCriticalityLevel() || 'LOW';
    }
    /**
     * Verifica se o grupo está ativo
     * @returns true se o grupo está ativo
     */
    isGrupoAtivo() {
        return this.grupo?.isAtivo() || false;
    }
    /**
     * Verifica se a permissão está ativa
     * @returns true se a permissão está ativa
     */
    isPermissaoAtiva() {
        return this.permissao?.isAtiva() || false;
    }
    /**
     * Verifica se tanto o grupo quanto a permissão estão ativos
     * @returns true se ambos estão ativos
     */
    isAtivo() {
        return this.isGrupoAtivo() && this.isPermissaoAtiva();
    }
    /**
     * Formata a data de criação para exibição
     * @returns data formatada
     */
    getCriacaoFormatada() {
        return this.created_at.toLocaleString('pt-BR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
        });
    }
    /**
     * Remove informações sensíveis para logs
     * @returns objeto sanitizado
     */
    toSafeLog() {
        return {
            id: this.id,
            permissao_id: this.permissao_id,
            grupo_id: this.grupo_id,
            criado_por: this.criado_por,
            created_at: this.created_at,
            isAtivo: this.isAtivo(),
            criticalityLevel: this.getCriticalityLevel(),
        };
    }
};
exports.PermissionGroupMapping = PermissionGroupMapping;
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)('uuid'),
    __metadata("design:type", String)
], PermissionGroupMapping.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'uuid', name: 'permissao_id' }),
    (0, class_validator_1.IsNotEmpty)({ message: 'ID da permissão é obrigatório' }),
    (0, class_validator_1.IsUUID)('4', { message: 'ID da permissão inválido' }),
    __metadata("design:type", String)
], PermissionGroupMapping.prototype, "permissao_id", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => permission_entity_1.Permission, { onDelete: 'CASCADE' }),
    (0, typeorm_1.JoinColumn)({ name: 'permissao_id' }),
    __metadata("design:type", typeof (_a = typeof permission_entity_1.Permission !== "undefined" && permission_entity_1.Permission) === "function" ? _a : Object)
], PermissionGroupMapping.prototype, "permissao", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'uuid', name: 'grupo_id' }),
    (0, class_validator_1.IsNotEmpty)({ message: 'ID do grupo é obrigatório' }),
    (0, class_validator_1.IsUUID)('4', { message: 'ID do grupo inválido' }),
    __metadata("design:type", String)
], PermissionGroupMapping.prototype, "grupo_id", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => permission_group_entity_1.PermissionGroup, { onDelete: 'CASCADE' }),
    (0, typeorm_1.JoinColumn)({ name: 'grupo_id' }),
    __metadata("design:type", typeof (_b = typeof permission_group_entity_1.PermissionGroup !== "undefined" && permission_group_entity_1.PermissionGroup) === "function" ? _b : Object)
], PermissionGroupMapping.prototype, "grupo", void 0);
__decorate([
    (0, typeorm_1.CreateDateColumn)({ name: 'created_at' }),
    __metadata("design:type", typeof (_c = typeof Date !== "undefined" && Date) === "function" ? _c : Object)
], PermissionGroupMapping.prototype, "created_at", void 0);
__decorate([
    (0, typeorm_1.Column)({ type: 'uuid', nullable: true, name: 'criado_por' }),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsUUID)('4', { message: 'ID do criador inválido' }),
    __metadata("design:type", Object)
], PermissionGroupMapping.prototype, "criado_por", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => usuario_entity_1.Usuario, { nullable: true }),
    (0, typeorm_1.JoinColumn)({ name: 'criado_por' }),
    __metadata("design:type", Object)
], PermissionGroupMapping.prototype, "usuario_criador", void 0);
exports.PermissionGroupMapping = PermissionGroupMapping = __decorate([
    (0, typeorm_1.Entity)('mapeamento_grupo_permissao'),
    (0, typeorm_1.Index)(['permissao_id', 'grupo_id'], { unique: true }),
    (0, typeorm_1.Index)(['permissao_id']),
    (0, typeorm_1.Index)(['grupo_id']),
    (0, typeorm_1.Index)(['criado_por']),
    (0, typeorm_1.Index)(['created_at'])
], PermissionGroupMapping);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGVudGl0aWVzXFxwZXJtaXNzaW9uLWdyb3VwLW1hcHBpbmcuZW50aXR5LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSxxQ0FRaUI7QUFDakIscURBQWlFO0FBQ2pFLDJEQUFpRDtBQUNqRCx1RUFBNEQ7QUFDNUQscURBQTJDO0FBRTNDOzs7OztHQUtHO0FBT0ksSUFBTSxzQkFBc0IsR0FBNUIsTUFBTSxzQkFBc0I7SUFDakM7O09BRUc7SUFFSCxFQUFFLENBQVM7SUFFWDs7T0FFRztJQUlILFlBQVksQ0FBUztJQUVyQjs7T0FFRztJQUdILFNBQVMsQ0FBYTtJQUV0Qjs7T0FFRztJQUlILFFBQVEsQ0FBUztJQUVqQjs7T0FFRztJQUdILEtBQUssQ0FBa0I7SUFFdkI7O09BRUc7SUFFSCxVQUFVLENBQU87SUFFakI7O09BRUc7SUFJSCxVQUFVLENBQWdCO0lBRTFCOztPQUVHO0lBR0gsZUFBZSxDQUFpQjtJQUVoQyw4REFBOEQ7SUFDOUQsSUFBSSxZQUFZO1FBQ2QsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBQzNCLENBQUM7SUFFRCxJQUFJLFlBQVksQ0FBQyxLQUFhO1FBQzVCLElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDO0lBQzVCLENBQUM7SUFFRCxJQUFJLFVBQVU7UUFDWixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDeEIsQ0FBQztJQUVELElBQUksVUFBVSxDQUFDLEtBQWlCO1FBQzlCLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO0lBQ3pCLENBQUM7SUFFRCxJQUFJLE9BQU87UUFDVCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDdkIsQ0FBQztJQUVELElBQUksT0FBTyxDQUFDLEtBQWE7UUFDdkIsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDeEIsQ0FBQztJQUVELElBQUksS0FBSztR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Zix5Q0FBZTtxREFBQztBQU12QjtJQURDLElBQUEsMEJBQWdCLEVBQUMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLENBQUM7a0RBQzdCLElBQUksb0JBQUosSUFBSTswREFBQztBQVFqQjtJQUhDLElBQUEsZ0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLENBQUM7SUFDNUQsSUFBQSw0QkFBVSxHQUFFO0lBQ1osSUFBQSx3QkFBTSxFQUFDLEdBQUcsRUFBRSxFQUFFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxDQUFDOzswREFDekI7QUFPMUI7SUFGQyxJQUFBLG1CQUFTLEVBQUMsR0FBRyxFQUFFLENBQUMsd0JBQU8sRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUM1QyxJQUFBLG9CQUFVLEVBQUMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLENBQUM7OytEQUNIO2lDQXhEckIsc0JBQXNCO0lBTmxDLElBQUEsZ0JBQU0sRUFBQyw0QkFBNEIsQ0FBQztJQUNwQyxJQUFBLGVBQUssRUFBQyxDQUFDLGNBQWMsRUFBRSxVQUFVLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQztJQUNyRCxJQUFBLGVBQUssRUFBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3ZCLElBQUEsZUFBSyxFQUFDLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDbkIsSUFBQSxlQUFLLEVBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUNyQixJQUFBLGVBQUssRUFBQyxDQUFDLFlBQVksQ0FBQyxDQUFDO0dBQ1Qsc0JBQXNCLENBdVdsQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcZW50aXRpZXNcXHBlcm1pc3Npb24tZ3JvdXAtbWFwcGluZy5lbnRpdHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29sdW1uLFxuICBDcmVhdGVEYXRlQ29sdW1uLFxuICBFbnRpdHksXG4gIEpvaW5Db2x1bW4sXG4gIE1hbnlUb09uZSxcbiAgUHJpbWFyeUdlbmVyYXRlZENvbHVtbixcbiAgSW5kZXgsXG59IGZyb20gJ3R5cGVvcm0nO1xuaW1wb3J0IHsgSXNOb3RFbXB0eSwgSXNVVUlELCBJc09wdGlvbmFsIH0gZnJvbSAnY2xhc3MtdmFsaWRhdG9yJztcbmltcG9ydCB7IFBlcm1pc3Npb24gfSBmcm9tICcuL3Blcm1pc3Npb24uZW50aXR5JztcbmltcG9ydCB7IFBlcm1pc3Npb25Hcm91cCB9IGZyb20gJy4vcGVybWlzc2lvbi1ncm91cC5lbnRpdHknO1xuaW1wb3J0IHsgVXN1YXJpbyB9IGZyb20gJy4vdXN1YXJpby5lbnRpdHknO1xuXG4vKipcbiAqIEVudGlkYWRlIHF1ZSByZXByZXNlbnRhIG8gcmVsYWNpb25hbWVudG8gbXVpdG9zLXBhcmEtbXVpdG9zIGVudHJlIHBlcm1pc3PDtWVzIGUgZ3J1cG9zLlxuICpcbiAqIEVzdGEgZW50aWRhZGUgcGVybWl0ZSBhc3NvY2lhciBwZXJtaXNzw7VlcyBhIGdydXBvcywgZmFjaWxpdGFuZG8gYSBvcmdhbml6YcOnw6NvXG4gKiBlIGF0cmlidWnDp8OjbyBkZSBwZXJtaXNzw7VlcyByZWxhY2lvbmFkYXMuXG4gKi9cbkBFbnRpdHkoJ21hcGVhbWVudG9fZ3J1cG9fcGVybWlzc2FvJylcbkBJbmRleChbJ3Blcm1pc3Nhb19pZCcsICdncnVwb19pZCddLCB7IHVuaXF1ZTogdHJ1ZSB9KVxuQEluZGV4KFsncGVybWlzc2FvX2lkJ10pXG5ASW5kZXgoWydncnVwb19pZCddKVxuQEluZGV4KFsnY3JpYWRvX3BvciddKVxuQEluZGV4KFsnY3JlYXRlZF9hdCddKVxuZXhwb3J0IGNsYXNzIFBlcm1pc3Npb25Hcm91cE1hcHBpbmcge1xuICAvKipcbiAgICogSWRlbnRpZmljYWRvciDDum5pY28gZG8gbWFwZWFtZW50b1xuICAgKi9cbiAgQFByaW1hcnlHZW5lcmF0ZWRDb2x1bW4oJ3V1aWQnKVxuICBpZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBSZWZlcsOqbmNpYSDDoCBwZXJtaXNzw6NvXG4gICAqL1xuICBAQ29sdW1uKHsgdHlwZTogJ3V1aWQnLCBuYW1lOiAncGVybWlzc2FvX2lkJyB9KVxuICBASXNOb3RFbXB0eSh7IG1lc3NhZ2U6ICdJRCBkYSBwZXJtaXNzw6NvIMOpIG9icmlnYXTDs3JpbycgfSlcbiAgQElzVVVJRCgnNCcsIHsgbWVzc2FnZTogJ0lEIGRhIHBlcm1pc3PDo28gaW52w6FsaWRvJyB9KVxuICBwZXJtaXNzYW9faWQ6IHN0cmluZztcblxuICAvKipcbiAgICogUmVsYcOnw6NvIGNvbSBhIHBlcm1pc3PDo29cbiAgICovXG4gIEBNYW55VG9PbmUoKCkgPT4gUGVybWlzc2lvbiwgeyBvbkRlbGV0ZTogJ0NBU0NBREUnIH0pXG4gIEBKb2luQ29sdW1uKHsgbmFtZTogJ3Blcm1pc3Nhb19pZCcgfSlcbiAgcGVybWlzc2FvOiBQZXJtaXNzaW9uO1xuXG4gIC8qKlxuICAgKiBSZWZlcsOqbmNpYSBhbyBncnVwb1xuICAgKi9cbiAgQENvbHVtbih7IHR5cGU6ICd1dWlkJywgbmFtZTogJ2dydXBvX2lkJyB9KVxuICBASXNOb3RFbXB0eSh7IG1lc3NhZ2U6ICdJRCBkbyBncnVwbyDDqSBvYnJpZ2F0w7NyaW8nIH0pXG4gIEBJc1VVSUQoJzQnLCB7IG1lc3NhZ2U6ICdJRCBkbyBncnVwbyBpbnbDoWxpZG8nIH0pXG4gIGdydXBvX2lkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFJlbGHDp8OjbyBjb20gbyBncnVwb1xuICAgKi9cbiAgQE1hbnlUb09uZSgoKSA9PiBQZXJtaXNzaW9uR3JvdXAsIHsgb25EZWxldGU6ICdDQVNDQURFJyB9KVxuICBASm9pbkNvbHVtbih7IG5hbWU6ICdncnVwb19pZCcgfSlcbiAgZ3J1cG86IFBlcm1pc3Npb25Hcm91cDtcblxuICAvKipcbiAgICogRGF0YSBkZSBjcmlhw6fDo29cbiAgICovXG4gIEBDcmVhdGVEYXRlQ29sdW1uKHsgbmFtZTogJ2NyZWF0ZWRfYXQnIH0pXG4gIGNyZWF0ZWRfYXQ6IERhdGU7XG5cbiAgLyoqXG4gICAqIFVzdcOhcmlvIHF1ZSBjcmlvdSBvIG1hcGVhbWVudG9cbiAgICovXG4gIEBDb2x1bW4oeyB0eXBlOiAndXVpZCcsIG51bGxhYmxlOiB0cnVlLCBuYW1lOiAnY3JpYWRvX3BvcicgfSlcbiAgQElzT3B0aW9uYWwoKVxuICBASXNVVUlEKCc0JywgeyBtZXNzYWdlOiAnSUQgZG8gY3JpYWRvciBpbnbDoWxpZG8nIH0pXG4gIGNyaWFkb19wb3I6IHN0cmluZyB8IG51bGw7XG5cbiAgLyoqXG4gICAqIFJlbGHDp8OjbyBjb20gbyB1c3XDoXJpbyBxdWUgY3Jpb3UgbyBtYXBlYW1lbnRvXG4gICAqL1xuICBATWFueVRvT25lKCgpID0+IFVzdWFyaW8sIHsgbnVsbGFibGU6IHRydWUgfSlcbiAgQEpvaW5Db2x1bW4oeyBuYW1lOiAnY3JpYWRvX3BvcicgfSlcbiAgdXN1YXJpb19jcmlhZG9yOiBVc3VhcmlvIHwgbnVsbDtcblxuICAvLyBHZXR0ZXJzIGUgc2V0dGVycyBwYXJhIGNvbXBhdGliaWxpZGFkZSBjb20gY8OzZGlnbyBleGlzdGVudGVcbiAgZ2V0IHBlcm1pc3Npb25JZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnBlcm1pc3Nhb19pZDtcbiAgfVxuXG4gIHNldCBwZXJtaXNzaW9uSWQodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMucGVybWlzc2FvX2lkID0gdmFsdWU7XG4gIH1cblxuICBnZXQgcGVybWlzc2lvbigpOiBQZXJtaXNzaW9uIHtcbiAgICByZXR1cm4gdGhpcy5wZXJtaXNzYW87XG4gIH1cblxuICBzZXQgcGVybWlzc2lvbih2YWx1ZTogUGVybWlzc2lvbikge1xuICAgIHRoaXMucGVybWlzc2FvID0gdmFsdWU7XG4gIH1cblxuICBnZXQgZ3JvdXBJZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmdydXBvX2lkO1xuICB9XG5cbiAgc2V0IGdyb3VwSWQodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMuZ3J1cG9faWQgPSB2YWx1ZTtcbiAgfVxuXG4gIGdldCBncm91cCgpOiBQZXJtaXNzaW9uR3JvdXAge1xuICAgIHJldHVybiB0aGlzLmdydXBvO1xuICB9XG5cbiAgc2V0IGdyb3VwKHZhbHVlOiBQZXJtaXNzaW9uR3JvdXApIHtcbiAgICB0aGlzLmdydXBvID0gdmFsdWU7XG4gIH1cblxuICBnZXQgY3JlYXRlZEF0KCk6IERhdGUge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZWRfYXQ7XG4gIH1cblxuICBnZXQgY3JlYXRlZEJ5KCk6IHN0cmluZyB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLmNyaWFkb19wb3I7XG4gIH1cblxuICBzZXQgY3JlYXRlZEJ5KHZhbHVlOiBzdHJpbmcgfCBudWxsKSB7XG4gICAgdGhpcy5jcmlhZG9fcG9yID0gdmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBtYXBlYW1lbnRvIGZvaSBjcmlhZG8gcG9yIHVtIHVzdcOhcmlvIGVzcGVjw61maWNvXG4gICAqIEBwYXJhbSB1c3VhcmlvSWQgSUQgZG8gdXN1w6FyaW9cbiAgICogQHJldHVybnMgdHJ1ZSBzZSBmb2kgY3JpYWRvIHBlbG8gdXN1w6FyaW9cbiAgICovXG4gIGZvaUNyaWFkb1Bvcih1c3VhcmlvSWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNyaWFkb19wb3IgPT09IHVzdWFyaW9JZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gdW1hIGNoYXZlIMO6bmljYSBwYXJhIG8gbWFwZWFtZW50b1xuICAgKiBAcmV0dXJucyBjaGF2ZSDDum5pY2EgYmFzZWFkYSBlbSBwZXJtaXNzw6NvIGUgZ3J1cG9cbiAgICovXG4gIGdldFVuaXF1ZUtleSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBgJHt0aGlzLnBlcm1pc3Nhb19pZH06JHt0aGlzLmdydXBvX2lkfWA7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBtYXBlYW1lbnRvIMOpIHbDoWxpZG9cbiAgICogQHJldHVybnMgdHJ1ZSBzZSB0ZW0gcGVybWlzc8OjbyBlIGdydXBvIHbDoWxpZG9zXG4gICAqL1xuICBpc1ZhbGlkbygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gISEodGhpcy5wZXJtaXNzYW9faWQgJiYgdGhpcy5ncnVwb19pZCk7XG4gIH1cblxuICAvKipcbiAgICogRGVmaW5lIG8gY3JpYWRvciBkbyBtYXBlYW1lbnRvXG4gICAqIEBwYXJhbSB1c3VhcmlvSWQgSUQgZG8gdXN1w6FyaW8gY3JpYWRvclxuICAgKi9cbiAgZGVmaW5pckNyaWFkb3IodXN1YXJpb0lkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNyaWFkb19wb3IgPSB1c3VhcmlvSWQ7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBtYXBlYW1lbnRvIHBlcnRlbmNlIGEgdW0gZ3J1cG8gZXNwZWPDrWZpY29cbiAgICogQHBhcmFtIGdydXBvSWQgSUQgZG8gZ3J1cG9cbiAgICogQHJldHVybnMgdHJ1ZSBzZSBwZXJ0ZW5jZSBhbyBncnVwb1xuICAgKi9cbiAgcGVydGVuY2VBb0dydXBvKGdydXBvSWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmdydXBvX2lkID09PSBncnVwb0lkO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIG8gbWFwZWFtZW50byBjb250w6ltIHVtYSBwZXJtaXNzw6NvIGVzcGVjw61maWNhXG4gICAqIEBwYXJhbSBwZXJtaXNzYW9JZCBJRCBkYSBwZXJtaXNzw6NvXG4gICAqIEByZXR1cm5zIHRydWUgc2UgY29udMOpbSBhIHBlcm1pc3PDo29cbiAgICovXG4gIGNvbnRlbVBlcm1pc3NhbyhwZXJtaXNzYW9JZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMucGVybWlzc2FvX2lkID09PSBwZXJtaXNzYW9JZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIG1hcGVhbWVudG8gZm9pIGNyaWFkbyByZWNlbnRlbWVudGUgKMO6bHRpbWFzIDI0IGhvcmFzKVxuICAgKiBAcmV0dXJucyB0cnVlIHNlIGZvaSBjcmlhZG8gcmVjZW50ZW1lbnRlXG4gICAqL1xuICBpc0NyaWFkb1JlY2VudGVtZW50ZSgpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMuY3JlYXRlZF9hdCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgY29uc3QgYWdvcmEgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHVtRGlhQXRyYXMgPSBuZXcgRGF0ZShhZ29yYS5nZXRUaW1lKCkgLSAyNCAqIDYwICogNjAgKiAxMDAwKTtcblxuICAgIHJldHVybiB0aGlzLmNyZWF0ZWRfYXQgPiB1bURpYUF0cmFzO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGEgYSBpZGFkZSBkbyBtYXBlYW1lbnRvIGVtIGRpYXNcbiAgICogQHJldHVybnMgaWRhZGUgZW0gZGlhc1xuICAgKi9cbiAgZ2V0SWRhZGVFbURpYXMoKTogbnVtYmVyIHtcbiAgICBpZiAoIXRoaXMuY3JlYXRlZF9hdCkgcmV0dXJuIDA7XG5cbiAgICBjb25zdCBhZ29yYSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgZGlmZlRpbWUgPSBNYXRoLmFicyhhZ29yYS5nZXRUaW1lKCkgLSB0aGlzLmNyZWF0ZWRfYXQuZ2V0VGltZSgpKTtcbiAgICBjb25zdCBkaWZmRGF5cyA9IE1hdGguY2VpbChkaWZmVGltZSAvICgxMDAwICogNjAgKiA2MCAqIDI0KSk7XG5cbiAgICByZXR1cm4gZGlmZkRheXM7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBtYXBlYW1lbnRvIHRlbSBjcmlhZG9yIGRlZmluaWRvXG4gICAqIEByZXR1cm5zIHRydWUgc2UgdGVtIGNyaWFkb3JcbiAgICovXG4gIHRlbUNyaWFkb3IoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEhdGhpcy5jcmlhZG9fcG9yO1xuICB9XG5cbiAgLyoqXG4gICAqIE9idMOpbSBpbmZvcm1hw6fDtWVzIHJlc3VtaWRhcyBkbyBtYXBlYW1lbnRvXG4gICAqIEByZXR1cm5zIG9iamV0byBjb20gaW5mb3JtYcOnw7VlcyByZXN1bWlkYXNcbiAgICovXG4gIGdldFN1bW1hcnkoKToge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgcGVybWlzc2FvX2lkOiBzdHJpbmc7XG4gICAgZ3J1cG9faWQ6IHN0cmluZztcbiAgICBjcmlhZG9fcG9yOiBzdHJpbmcgfCBudWxsO1xuICAgIGNyZWF0ZWRfYXQ6IERhdGU7XG4gICAgaWRhZGVFbURpYXM6IG51bWJlcjtcbiAgICBwZXJtaXNzYW9Ob21lPzogc3RyaW5nO1xuICAgIGdydXBvTm9tZT86IHN0cmluZztcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiB0aGlzLmlkLFxuICAgICAgcGVybWlzc2FvX2lkOiB0aGlzLnBlcm1pc3Nhb19pZCxcbiAgICAgIGdydXBvX2lkOiB0aGlzLmdydXBvX2lkLFxuICAgICAgY3JpYWRvX3BvcjogdGhpcy5jcmlhZG9fcG9yLFxuICAgICAgY3JlYXRlZF9hdDogdGhpcy5jcmVhdGVkX2F0LFxuICAgICAgaWRhZGVFbURpYXM6IHRoaXMuZ2V0SWRhZGVFbURpYXMoKSxcbiAgICAgIHBlcm1pc3Nhb05vbWU6IHRoaXMucGVybWlzc2FvPy5ub21lLFxuICAgICAgZ3J1cG9Ob21lOiB0aGlzLmdydXBvPy5ub21lLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBtYXBlYW1lbnRvIMOpIGNvbXBhdMOtdmVsIGNvbSBvdXRybyBtYXBlYW1lbnRvXG4gICAqIEBwYXJhbSBvdGhlck1hcHBpbmcgT3V0cm8gbWFwZWFtZW50b1xuICAgKiBAcmV0dXJucyB0cnVlIHNlIHPDo28gY29tcGF0w612ZWlzIChtZXNtbyBncnVwbylcbiAgICovXG4gIGlzQ29tcGF0aWJsZVdpdGgob3RoZXJNYXBwaW5nOiBQZXJtaXNzaW9uR3JvdXBNYXBwaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZ3J1cG9faWQgPT09IG90aGVyTWFwcGluZy5ncnVwb19pZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXJhIHVtYSBjaGF2ZSDDum5pY2EgZXN0ZW5kaWRhIHBhcmEgbyBtYXBlYW1lbnRvXG4gICAqIEByZXR1cm5zIGNoYXZlIMO6bmljYSBlc3RlbmRpZGFcbiAgICovXG4gIGdldEV4dGVuZGVkVW5pcXVlS2V5KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBwZXJtaXNzaW9uX2dyb3VwX21hcHBpbmdfJHt0aGlzLnBlcm1pc3Nhb19pZH1fJHt0aGlzLmdydXBvX2lkfV8ke3RoaXMuaWR9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIG1hcGVhbWVudG8gZXN0w6EgZW0gZXN0YWRvIGNvbnNpc3RlbnRlXG4gICAqIEByZXR1cm5zIHRydWUgc2UgZXN0w6EgY29uc2lzdGVudGVcbiAgICovXG4gIGlzQ29uc2lzdGVudGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgICEhdGhpcy5pZCAmJiAhIXRoaXMucGVybWlzc2FvX2lkICYmICEhdGhpcy5ncnVwb19pZCAmJiAhIXRoaXMuY3JlYXRlZF9hdFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogT2J0w6ltIHVtYSBkZXNjcmnDp8OjbyBsZWfDrXZlbCBkbyBtYXBlYW1lbnRvXG4gICAqIEByZXR1cm5zIGRlc2NyacOnw6NvIGZvcm1hdGFkYVxuICAgKi9cbiAgZ2V0RGVzY3JpY2FvKCk6IHN0cmluZyB7XG4gICAgY29uc3QgcGVybWlzc2FvTm9tZSA9IHRoaXMucGVybWlzc2FvPy5ub21lIHx8ICdQZXJtaXNzw6NvIG7Do28gY2FycmVnYWRhJztcbiAgICBjb25zdCBncnVwb05vbWUgPSB0aGlzLmdydXBvPy5ub21lIHx8ICdHcnVwbyBuw6NvIGNhcnJlZ2Fkbyc7XG4gICAgcmV0dXJuIGBHcnVwbyBcIiR7Z3J1cG9Ob21lfVwiIC0+IFBlcm1pc3PDo286ICR7cGVybWlzc2FvTm9tZX1gO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIG8gbWFwZWFtZW50byBwb2RlIHNlciByZW1vdmlkb1xuICAgKiBAcmV0dXJucyB0cnVlIHNlIHBvZGUgc2VyIHJlbW92aWRvXG4gICAqL1xuICBwb2RlU2VyUmVtb3ZpZG8oKTogYm9vbGVhbiB7XG4gICAgLy8gUG9yIHBhZHLDo28sIHRvZG9zIG9zIG1hcGVhbWVudG9zIHBvZGVtIHNlciByZW1vdmlkb3NcbiAgICAvLyBFc3RhIGzDs2dpY2EgcG9kZSBzZXIgZXhwYW5kaWRhIGNvbmZvcm1lIHJlZ3JhcyBkZSBuZWfDs2Npb1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIENsb25hIG8gbWFwZWFtZW50byAoc2VtIElEIGUgZGF0YSlcbiAgICogQHJldHVybnMgbWFwZWFtZW50byBjbG9uYWRvXG4gICAqL1xuICBjbG9uZSgpOiBQYXJ0aWFsPFBlcm1pc3Npb25Hcm91cE1hcHBpbmc+IHtcbiAgICByZXR1cm4ge1xuICAgICAgcGVybWlzc2FvX2lkOiB0aGlzLnBlcm1pc3Nhb19pZCxcbiAgICAgIGdydXBvX2lkOiB0aGlzLmdydXBvX2lkLFxuICAgICAgY3JpYWRvX3BvcjogdGhpcy5jcmlhZG9fcG9yLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBtYXBlYW1lbnRvIMOpIHBhcmEgdW1hIHBlcm1pc3PDo28gZGUgYWRtaW5pc3RyYWRvclxuICAgKiBAcmV0dXJucyB0cnVlIHNlIMOpIHBlcm1pc3PDo28gZGUgYWRtaW5cbiAgICovXG4gIGlzQWRtaW5QZXJtaXNzaW9uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnBlcm1pc3Nhbz8uaXNBZG1pblBlcm1pc3Npb24oKSB8fCBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIG1hcGVhbWVudG8gw6kgcGFyYSB1bWEgcGVybWlzc8OjbyBkZSBzaXN0ZW1hXG4gICAqIEByZXR1cm5zIHRydWUgc2Ugw6kgcGVybWlzc8OjbyBkZSBzaXN0ZW1hXG4gICAqL1xuICBpc1N5c3RlbVBlcm1pc3Npb24oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMucGVybWlzc2FvPy5pc1N5c3RlbVBlcm1pc3Npb24oKSB8fCBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gbyBuw612ZWwgZGUgY3JpdGljaWRhZGUgYmFzZWFkbyBuYSBwZXJtaXNzw6NvXG4gICAqIEByZXR1cm5zIG7DrXZlbCBkZSBjcml0aWNpZGFkZVxuICAgKi9cbiAgZ2V0Q3JpdGljYWxpdHlMZXZlbCgpOiAnTE9XJyB8ICdNRURJVU0nIHwgJ0hJR0gnIHwgJ0NSSVRJQ0FMJyB7XG4gICAgcmV0dXJuIHRoaXMucGVybWlzc2FvPy5nZXRDcml0aWNhbGl0eUxldmVsKCkgfHwgJ0xPVyc7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyBncnVwbyBlc3TDoSBhdGl2b1xuICAgKiBAcmV0dXJucyB0cnVlIHNlIG8gZ3J1cG8gZXN0w6EgYXRpdm9cbiAgICovXG4gIGlzR3J1cG9BdGl2bygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5ncnVwbz8uaXNBdGl2bygpIHx8IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIGEgcGVybWlzc8OjbyBlc3TDoSBhdGl2YVxuICAgKiBAcmV0dXJucyB0cnVlIHNlIGEgcGVybWlzc8OjbyBlc3TDoSBhdGl2YVxuICAgKi9cbiAgaXNQZXJtaXNzYW9BdGl2YSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5wZXJtaXNzYW8/LmlzQXRpdmEoKSB8fCBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSB0YW50byBvIGdydXBvIHF1YW50byBhIHBlcm1pc3PDo28gZXN0w6NvIGF0aXZvc1xuICAgKiBAcmV0dXJucyB0cnVlIHNlIGFtYm9zIGVzdMOjbyBhdGl2b3NcbiAgICovXG4gIGlzQXRpdm8oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNHcnVwb0F0aXZvKCkgJiYgdGhpcy5pc1Blcm1pc3Nhb0F0aXZhKCk7XG4gIH1cblxuICAvKipcbiAgICogRm9ybWF0YSBhIGRhdGEgZGUgY3JpYcOnw6NvIHBhcmEgZXhpYmnDp8Ojb1xuICAgKiBAcmV0dXJucyBkYXRhIGZvcm1hdGFkYVxuICAgKi9cbiAgZ2V0Q3JpYWNhb0Zvcm1hdGFkYSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZWRfYXQudG9Mb2NhbGVTdHJpbmcoJ3B0LUJSJywge1xuICAgICAgeWVhcjogJ251bWVyaWMnLFxuICAgICAgbW9udGg6ICcyLWRpZ2l0JyxcbiAgICAgIGRheTogJzItZGlnaXQnLFxuICAgICAgaG91cjogJzItZGlnaXQnLFxuICAgICAgbWludXRlOiAnMi1kaWdpdCcsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGluZm9ybWHDp8O1ZXMgc2Vuc8OtdmVpcyBwYXJhIGxvZ3NcbiAgICogQHJldHVybnMgb2JqZXRvIHNhbml0aXphZG9cbiAgICovXG4gIHRvU2FmZUxvZygpOiB7XG4gICAgaWQ6IHN0cmluZztcbiAgICBwZXJtaXNzYW9faWQ6IHN0cmluZztcbiAgICBncnVwb19pZDogc3RyaW5nO1xuICAgIGNyaWFkb19wb3I6IHN0cmluZyB8IG51bGw7XG4gICAgY3JlYXRlZF9hdDogRGF0ZTtcbiAgICBpc0F0aXZvOiBib29sZWFuO1xuICAgIGNyaXRpY2FsaXR5TGV2ZWw6IHN0cmluZztcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiB0aGlzLmlkLFxuICAgICAgcGVybWlzc2FvX2lkOiB0aGlzLnBlcm1pc3Nhb19pZCxcbiAgICAgIGdydXBvX2lkOiB0aGlzLmdydXBvX2lkLFxuICAgICAgY3JpYWRvX3BvcjogdGhpcy5jcmlhZG9fcG9yLFxuICAgICAgY3JlYXRlZF9hdDogdGhpcy5jcmVhdGVkX2F0LFxuICAgICAgaXNBdGl2bzogdGhpcy5pc0F0aXZvKCksXG4gICAgICBjcml0aWNhbGl0eUxldmVsOiB0aGlzLmdldENyaXRpY2FsaXR5TGV2ZWwoKSxcbiAgICB9O1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=