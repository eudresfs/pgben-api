02af1255f0f96081bec5eaecb97eae1b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const typeorm_1 = require("@nestjs/typeorm");
const common_1 = require("@nestjs/common");
const integrador_entity_1 = require("../entities/integrador.entity");
const integrador_service_1 = require("../services/integrador.service");
/**
 * Testes unitários para o serviço de integradores.
 * Valida as operações CRUD e regras de negócio específicas.
 */
describe('IntegradorService', () => {
    let service;
    let repository;
    // Mock do repositório TypeORM
    const mockRepository = {
        create: jest.fn(),
        save: jest.fn(),
        find: jest.fn(),
        findOne: jest.fn(),
        update: jest.fn(),
        remove: jest.fn(),
    };
    // Configuração do módulo de teste
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                integrador_service_1.IntegradorService,
                {
                    provide: (0, typeorm_1.getRepositoryToken)(integrador_entity_1.Integrador),
                    useValue: mockRepository,
                },
            ],
        }).compile();
        service = module.get(integrador_service_1.IntegradorService);
        repository = module.get((0, typeorm_1.getRepositoryToken)(integrador_entity_1.Integrador));
    });
    // Limpar mocks após cada teste
    afterEach(() => {
        jest.clearAllMocks();
    });
    // Testes para verificar se o serviço foi definido corretamente
    it('deve estar definido', () => {
        expect(service).toBeDefined();
    });
    describe('create', () => {
        it('deve criar um novo integrador com sucesso', async () => {
            // Arrange
            const createDto = {
                nome: 'Integrador Teste',
                descricao: 'Descrição do integrador de teste',
                responsavel: 'João da Silva',
                emailContato: 'joao@teste.com',
                telefoneContato: '84999999999',
                permissoesEscopo: ['read:dados_basicos'],
                ipPermitidos: ['192.168.1.1'],
                ativo: true,
            };
            const integrador = {
                id: 'uuid-teste',
                ...createDto,
                dataCriacao: new Date(),
                dataAtualizacao: new Date(),
                ultimoAcesso: null,
                tokens: [],
            };
            // Configurar mock para retornar null (integrador não existe)
            mockRepository.findOne.mockResolvedValue(null);
            // Configurar mocks para criar e salvar integrador
            mockRepository.create.mockReturnValue(integrador);
            mockRepository.save.mockResolvedValue(integrador);
            // Act
            const result = await service.create(createDto);
            // Assert
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: { nome: createDto.nome },
            });
            expect(mockRepository.create).toHaveBeenCalledWith(createDto);
            expect(mockRepository.save).toHaveBeenCalledWith(integrador);
            expect(result).toBeDefined();
            expect(result.id).toEqual(integrador.id);
            expect(result.nome).toEqual(integrador.nome);
        });
        it('deve lançar ConflictException quando tentar criar integrador com nome duplicado', async () => {
            // Arrange
            const createDto = {
                nome: 'Integrador Duplicado',
                ativo: true,
            };
            // Configurar mock para retornar um integrador existente
            mockRepository.findOne.mockResolvedValue({
                id: 'uuid-existente',
                nome: 'Integrador Duplicado',
            });
            // Act & Assert
            await expect(service.create(createDto)).rejects.toThrow(common_1.ConflictException);
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: { nome: createDto.nome },
            });
            expect(mockRepository.create).not.toHaveBeenCalled();
            expect(mockRepository.save).not.toHaveBeenCalled();
        });
    });
    describe('findAll', () => {
        it('deve retornar uma lista de integradores', async () => {
            // Arrange
            const integradores = [
                {
                    id: 'uuid-1',
                    nome: 'Integrador 1',
                    dataCriacao: new Date(),
                    dataAtualizacao: new Date(),
                },
                {
                    id: 'uuid-2',
                    nome: 'Integrador 2',
                    dataCriacao: new Date(),
                    dataAtualizacao: new Date(),
                },
            ];
            mockRepository.find.mockResolvedValue(integradores);
            // Act
            const result = await service.findAll();
            // Assert
            expect(mockRepository.find).toHaveBeenCalled();
            expect(result).toHaveLength(2);
            expect(result[0].id).toEqual(integradores[0].id);
            expect(result[1].id).toEqual(integradores[1].id);
        });
    });
    describe('findById', () => {
        it('deve encontrar um integrador pelo ID', async () => {
            // Arrange
            const integrador = {
                id: 'uuid-teste',
                nome: 'Integrador Teste',
                dataCriacao: new Date(),
                dataAtualizacao: new Date(),
            };
            mockRepository.findOne.mockResolvedValue(integrador);
            // Act
            const result = await service.findById('uuid-teste');
            // Assert
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: { id: 'uuid-teste' },
            });
            expect(result).toEqual(integrador);
        });
        it('deve lançar NotFoundException quando integrador não for encontrado', async () => {
            // Arrange
            mockRepository.findOne.mockResolvedValue(null);
            // Act & Assert
            await expect(service.findById('uuid-inexistente')).rejects.toThrow(common_1.NotFoundException);
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: { id: 'uuid-inexistente' },
            });
        });
    });
    describe('update', () => {
        it('deve atualizar um integrador com sucesso', async () => {
            // Arrange
            const integrador = {
                id: 'uuid-teste',
                nome: 'Integrador Antigo',
                dataCriacao: new Date(),
                dataAtualizacao: new Date(),
            };
            const updateDto = {
                nome: 'Integrador Atualizado',
                descricao: 'Nova descrição',
            };
            const integradorAtualizado = {
                ...integrador,
                ...updateDto,
                dataAtualizacao: new Date(),
            };
            // Mock para findById
            mockRepository.findOne.mockResolvedValueOnce(integrador);
            // Mock para verificar nome duplicado
            mockRepository.findOne.mockResolvedValueOnce(null);
            // Mock para salvar
            mockRepository.save.mockResolvedValue(integradorAtualizado);
            // Act
            const result = await service.update('uuid-teste', updateDto);
            // Assert
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: { id: 'uuid-teste' },
            });
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: { nome: updateDto.nome },
            });
            expect(mockRepository.save).toHaveBeenCalled();
            expect(result.nome).toEqual(updateDto.nome);
            expect(result.descricao).toEqual(updateDto.descricao);
        });
        it('deve lançar ConflictException ao tentar atualizar para um nome duplicado', async () => {
            // Arrange
            const integrador = {
                id: 'uuid-teste',
                nome: 'Integrador Antigo',
                dataCriacao: new Date(),
                dataAtualizacao: new Date(),
            };
            const updateDto = {
                nome: 'Integrador Duplicado',
            };
            const integradorExistente = {
                id: 'outro-uuid',
                nome: 'Integrador Duplicado',
            };
            // Mock para findById
            mockRepository.findOne.mockResolvedValueOnce(integrador);
            // Mock para verificar nome duplicado - retorna outro integrador
            mockRepository.findOne.mockResolvedValueOnce(integradorExistente);
            // Act & Assert
            await expect(service.update('uuid-teste', updateDto)).rejects.toThrow(common_1.ConflictException);
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: { id: 'uuid-teste' },
            });
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: { nome: updateDto.nome },
            });
            expect(mockRepository.save).not.toHaveBeenCalled();
        });
    });
    describe('remove', () => {
        it('deve remover um integrador com sucesso', async () => {
            // Arrange
            const integrador = {
                id: 'uuid-teste',
                nome: 'Integrador para Remover',
            };
            mockRepository.findOne.mockResolvedValue(integrador);
            mockRepository.remove.mockResolvedValue(undefined);
            // Act
            await service.remove('uuid-teste');
            // Assert
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: { id: 'uuid-teste' },
            });
            expect(mockRepository.remove).toHaveBeenCalledWith(integrador);
        });
    });
    describe('toggleAtivo', () => {
        it('deve ativar um integrador inativo', async () => {
            // Arrange
            const integrador = {
                id: 'uuid-teste',
                nome: 'Integrador Test',
                ativo: false,
                dataCriacao: new Date(),
                dataAtualizacao: new Date(),
            };
            const integradorAtivado = {
                ...integrador,
                ativo: true,
            };
            mockRepository.findOne.mockResolvedValue(integrador);
            mockRepository.save.mockResolvedValue(integradorAtivado);
            // Act
            const result = await service.toggleAtivo('uuid-teste', true);
            // Assert
            expect(mockRepository.findOne).toHaveBeenCalledWith({
                where: { id: 'uuid-teste' },
            });
            expect(mockRepository.save).toHaveBeenCalledWith({
                ...integrador,
                ativo: true,
            });
            expect(result.ativo).toBe(true);
        });
    });
    describe('registrarAcesso', () => {
        it('deve atualizar o timestamp de último acesso', async () => {
            // Arrange
            mockRepository.update.mockResolvedValue({ affected: 1 });
            // Act
            await service.registrarAcesso('uuid-teste');
            // Assert
            expect(mockRepository.update).toHaveBeenCalledWith({ id: 'uuid-teste' }, { ultimoAcesso: expect.any(Date) });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGludGVncmFkb3JcXHRlc3RzXFxpbnRlZ3JhZG9yLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCw2Q0FBcUQ7QUFFckQsMkNBQXNFO0FBQ3RFLHFFQUEyRDtBQUMzRCx1RUFBbUU7QUFJbkU7OztHQUdHO0FBQ0gsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtJQUNqQyxJQUFJLE9BQTBCLENBQUM7SUFDL0IsSUFBSSxVQUFrQyxDQUFDO0lBRXZDLDhCQUE4QjtJQUM5QixNQUFNLGNBQWMsR0FBRztRQUNyQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNqQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2YsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDbEIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDakIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDbEIsQ0FBQztJQUVGLGtDQUFrQztJQUNsQyxVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFNBQVMsRUFBRTtnQkFDVCxzQ0FBaUI7Z0JBQ2pCO29CQUNFLE9BQU8sRUFBRSxJQUFBLDRCQUFrQixFQUFDLDhCQUFVLENBQUM7b0JBQ3ZDLFFBQVEsRUFBRSxjQUFjO2lCQUN6QjthQUNGO1NBQ0YsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRWIsT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQW9CLHNDQUFpQixDQUFDLENBQUM7UUFDM0QsVUFBVSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQ3JCLElBQUEs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Q0FBQyxJQUFJLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztnQkFDL0MsR0FBRyxVQUFVO2dCQUNiLEtBQUssRUFBRSxJQUFJO2FBQ1osQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7UUFDL0IsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzNELFVBQVU7WUFDVixjQUFjLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFekQsTUFBTTtZQUNOLE1BQU0sT0FBTyxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUU1QyxTQUFTO1lBQ1QsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FDaEQsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLEVBQ3BCLEVBQUUsWUFBWSxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FDbkMsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xcaW50ZWdyYWRvclxcdGVzdHNcXGludGVncmFkb3Iuc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgZ2V0UmVwb3NpdG9yeVRva2VuIH0gZnJvbSAnQG5lc3Rqcy90eXBlb3JtJztcbmltcG9ydCB7IFJlcG9zaXRvcnkgfSBmcm9tICd0eXBlb3JtJztcbmltcG9ydCB7IENvbmZsaWN0RXhjZXB0aW9uLCBOb3RGb3VuZEV4Y2VwdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IEludGVncmFkb3IgfSBmcm9tICcuLi9lbnRpdGllcy9pbnRlZ3JhZG9yLmVudGl0eSc7XG5pbXBvcnQgeyBJbnRlZ3JhZG9yU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2ludGVncmFkb3Iuc2VydmljZSc7XG5pbXBvcnQgeyBDcmVhdGVJbnRlZ3JhZG9yRHRvIH0gZnJvbSAnLi4vZHRvL2NyZWF0ZS1pbnRlZ3JhZG9yLmR0byc7XG5pbXBvcnQgeyBVcGRhdGVJbnRlZ3JhZG9yRHRvIH0gZnJvbSAnLi4vZHRvL3VwZGF0ZS1pbnRlZ3JhZG9yLmR0byc7XG5cbi8qKlxuICogVGVzdGVzIHVuaXTDoXJpb3MgcGFyYSBvIHNlcnZpw6dvIGRlIGludGVncmFkb3Jlcy5cbiAqIFZhbGlkYSBhcyBvcGVyYcOnw7VlcyBDUlVEIGUgcmVncmFzIGRlIG5lZ8OzY2lvIGVzcGVjw61maWNhcy5cbiAqL1xuZGVzY3JpYmUoJ0ludGVncmFkb3JTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogSW50ZWdyYWRvclNlcnZpY2U7XG4gIGxldCByZXBvc2l0b3J5OiBSZXBvc2l0b3J5PEludGVncmFkb3I+O1xuXG4gIC8vIE1vY2sgZG8gcmVwb3NpdMOzcmlvIFR5cGVPUk1cbiAgY29uc3QgbW9ja1JlcG9zaXRvcnkgPSB7XG4gICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgc2F2ZTogamVzdC5mbigpLFxuICAgIGZpbmQ6IGplc3QuZm4oKSxcbiAgICBmaW5kT25lOiBqZXN0LmZuKCksXG4gICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgcmVtb3ZlOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgLy8gQ29uZmlndXJhw6fDo28gZG8gbcOzZHVsbyBkZSB0ZXN0ZVxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIEludGVncmFkb3JTZXJ2aWNlLFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogZ2V0UmVwb3NpdG9yeVRva2VuKEludGVncmFkb3IpLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrUmVwb3NpdG9yeSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8SW50ZWdyYWRvclNlcnZpY2U+KEludGVncmFkb3JTZXJ2aWNlKTtcbiAgICByZXBvc2l0b3J5ID0gbW9kdWxlLmdldDxSZXBvc2l0b3J5PEludGVncmFkb3I+PihcbiAgICAgIGdldFJlcG9zaXRvcnlUb2tlbihJbnRlZ3JhZG9yKSxcbiAgICApO1xuICB9KTtcblxuICAvLyBMaW1wYXIgbW9ja3MgYXDDs3MgY2FkYSB0ZXN0ZVxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICAvLyBUZXN0ZXMgcGFyYSB2ZXJpZmljYXIgc2UgbyBzZXJ2acOnbyBmb2kgZGVmaW5pZG8gY29ycmV0YW1lbnRlXG4gIGl0KCdkZXZlIGVzdGFyIGRlZmluaWRvJywgKCkgPT4ge1xuICAgIGV4cGVjdChzZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGNyaWFyIHVtIG5vdm8gaW50ZWdyYWRvciBjb20gc3VjZXNzbycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGNyZWF0ZUR0bzogQ3JlYXRlSW50ZWdyYWRvckR0byA9IHtcbiAgICAgICAgbm9tZTogJ0ludGVncmFkb3IgVGVzdGUnLFxuICAgICAgICBkZXNjcmljYW86ICdEZXNjcmnDp8OjbyBkbyBpbnRlZ3JhZG9yIGRlIHRlc3RlJyxcbiAgICAgICAgcmVzcG9uc2F2ZWw6ICdKb8OjbyBkYSBTaWx2YScsXG4gICAgICAgIGVtYWlsQ29udGF0bzogJ2pvYW9AdGVzdGUuY29tJyxcbiAgICAgICAgdGVsZWZvbmVDb250YXRvOiAnODQ5OTk5OTk5OTknLFxuICAgICAgICBwZXJtaXNzb2VzRXNjb3BvOiBbJ3JlYWQ6ZGFkb3NfYmFzaWNvcyddLFxuICAgICAgICBpcFBlcm1pdGlkb3M6IFsnMTkyLjE2OC4xLjEnXSxcbiAgICAgICAgYXRpdm86IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBpbnRlZ3JhZG9yID0ge1xuICAgICAgICBpZDogJ3V1aWQtdGVzdGUnLFxuICAgICAgICAuLi5jcmVhdGVEdG8sXG4gICAgICAgIGRhdGFDcmlhY2FvOiBuZXcgRGF0ZSgpLFxuICAgICAgICBkYXRhQXR1YWxpemFjYW86IG5ldyBEYXRlKCksXG4gICAgICAgIHVsdGltb0FjZXNzbzogbnVsbCxcbiAgICAgICAgdG9rZW5zOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIC8vIENvbmZpZ3VyYXIgbW9jayBwYXJhIHJldG9ybmFyIG51bGwgKGludGVncmFkb3IgbsOjbyBleGlzdGUpXG4gICAgICBtb2NrUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgLy8gQ29uZmlndXJhciBtb2NrcyBwYXJhIGNyaWFyIGUgc2FsdmFyIGludGVncmFkb3JcbiAgICAgIG1vY2tSZXBvc2l0b3J5LmNyZWF0ZS5tb2NrUmV0dXJuVmFsdWUoaW50ZWdyYWRvcik7XG4gICAgICBtb2NrUmVwb3NpdG9yeS5zYXZlLm1vY2tSZXNvbHZlZFZhbHVlKGludGVncmFkb3IpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuY3JlYXRlKGNyZWF0ZUR0byk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tSZXBvc2l0b3J5LmZpbmRPbmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgbm9tZTogY3JlYXRlRHRvLm5vbWUgfSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KG1vY2tSZXBvc2l0b3J5LmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoY3JlYXRlRHRvKTtcbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5zYXZlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChpbnRlZ3JhZG9yKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmlkKS50b0VxdWFsKGludGVncmFkb3IuaWQpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5ub21lKS50b0VxdWFsKGludGVncmFkb3Iubm9tZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBsYW7Dp2FyIENvbmZsaWN0RXhjZXB0aW9uIHF1YW5kbyB0ZW50YXIgY3JpYXIgaW50ZWdyYWRvciBjb20gbm9tZSBkdXBsaWNhZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBjcmVhdGVEdG86IENyZWF0ZUludGVncmFkb3JEdG8gPSB7XG4gICAgICAgIG5vbWU6ICdJbnRlZ3JhZG9yIER1cGxpY2FkbycsXG4gICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgLy8gQ29uZmlndXJhciBtb2NrIHBhcmEgcmV0b3JuYXIgdW0gaW50ZWdyYWRvciBleGlzdGVudGVcbiAgICAgIG1vY2tSZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogJ3V1aWQtZXhpc3RlbnRlJyxcbiAgICAgICAgbm9tZTogJ0ludGVncmFkb3IgRHVwbGljYWRvJyxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmNyZWF0ZShjcmVhdGVEdG8pKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIENvbmZsaWN0RXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IG5vbWU6IGNyZWF0ZUR0by5ub21lIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5jcmVhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QobW9ja1JlcG9zaXRvcnkuc2F2ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbmRBbGwnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgdW1hIGxpc3RhIGRlIGludGVncmFkb3JlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGludGVncmFkb3JlcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAndXVpZC0xJyxcbiAgICAgICAgICBub21lOiAnSW50ZWdyYWRvciAxJyxcbiAgICAgICAgICBkYXRhQ3JpYWNhbzogbmV3IERhdGUoKSxcbiAgICAgICAgICBkYXRhQXR1YWxpemFjYW86IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ3V1aWQtMicsXG4gICAgICAgICAgbm9tZTogJ0ludGVncmFkb3IgMicsXG4gICAgICAgICAgZGF0YUNyaWFjYW86IG5ldyBEYXRlKCksXG4gICAgICAgICAgZGF0YUF0dWFsaXphY2FvOiBuZXcgRGF0ZSgpLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1JlcG9zaXRvcnkuZmluZC5tb2NrUmVzb2x2ZWRWYWx1ZShpbnRlZ3JhZG9yZXMpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZmluZEFsbCgpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5maW5kKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocmVzdWx0WzBdLmlkKS50b0VxdWFsKGludGVncmFkb3Jlc1swXS5pZCk7XG4gICAgICBleHBlY3QocmVzdWx0WzFdLmlkKS50b0VxdWFsKGludGVncmFkb3Jlc1sxXS5pZCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmaW5kQnlJZCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBlbmNvbnRyYXIgdW0gaW50ZWdyYWRvciBwZWxvIElEJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgaW50ZWdyYWRvciA9IHtcbiAgICAgICAgaWQ6ICd1dWlkLXRlc3RlJyxcbiAgICAgICAgbm9tZTogJ0ludGVncmFkb3IgVGVzdGUnLFxuICAgICAgICBkYXRhQ3JpYWNhbzogbmV3IERhdGUoKSxcbiAgICAgICAgZGF0YUF0dWFsaXphY2FvOiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgbW9ja1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShpbnRlZ3JhZG9yKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRCeUlkKCd1dWlkLXRlc3RlJyk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tSZXBvc2l0b3J5LmZpbmRPbmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6ICd1dWlkLXRlc3RlJyB9LFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKGludGVncmFkb3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbGFuw6dhciBOb3RGb3VuZEV4Y2VwdGlvbiBxdWFuZG8gaW50ZWdyYWRvciBuw6NvIGZvciBlbmNvbnRyYWRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgbW9ja1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5maW5kQnlJZCgndXVpZC1pbmV4aXN0ZW50ZScpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIE5vdEZvdW5kRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiAndXVpZC1pbmV4aXN0ZW50ZScgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBkYXRlJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGF0dWFsaXphciB1bSBpbnRlZ3JhZG9yIGNvbSBzdWNlc3NvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgaW50ZWdyYWRvciA9IHtcbiAgICAgICAgaWQ6ICd1dWlkLXRlc3RlJyxcbiAgICAgICAgbm9tZTogJ0ludGVncmFkb3IgQW50aWdvJyxcbiAgICAgICAgZGF0YUNyaWFjYW86IG5ldyBEYXRlKCksXG4gICAgICAgIGRhdGFBdHVhbGl6YWNhbzogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHVwZGF0ZUR0bzogVXBkYXRlSW50ZWdyYWRvckR0byA9IHtcbiAgICAgICAgbm9tZTogJ0ludGVncmFkb3IgQXR1YWxpemFkbycsXG4gICAgICAgIGRlc2NyaWNhbzogJ05vdmEgZGVzY3Jpw6fDo28nLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgaW50ZWdyYWRvckF0dWFsaXphZG8gPSB7XG4gICAgICAgIC4uLmludGVncmFkb3IsXG4gICAgICAgIC4uLnVwZGF0ZUR0byxcbiAgICAgICAgZGF0YUF0dWFsaXphY2FvOiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgLy8gTW9jayBwYXJhIGZpbmRCeUlkXG4gICAgICBtb2NrUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlT25jZShpbnRlZ3JhZG9yKTtcbiAgICAgIC8vIE1vY2sgcGFyYSB2ZXJpZmljYXIgbm9tZSBkdXBsaWNhZG9cbiAgICAgIG1vY2tSZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG51bGwpO1xuICAgICAgLy8gTW9jayBwYXJhIHNhbHZhclxuICAgICAgbW9ja1JlcG9zaXRvcnkuc2F2ZS5tb2NrUmVzb2x2ZWRWYWx1ZShpbnRlZ3JhZG9yQXR1YWxpemFkbyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS51cGRhdGUoJ3V1aWQtdGVzdGUnLCB1cGRhdGVEdG8pO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiAndXVpZC10ZXN0ZScgfSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KG1vY2tSZXBvc2l0b3J5LmZpbmRPbmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgbm9tZTogdXBkYXRlRHRvLm5vbWUgfSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KG1vY2tSZXBvc2l0b3J5LnNhdmUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubm9tZSkudG9FcXVhbCh1cGRhdGVEdG8ubm9tZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaWNhbykudG9FcXVhbCh1cGRhdGVEdG8uZGVzY3JpY2FvKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGxhbsOnYXIgQ29uZmxpY3RFeGNlcHRpb24gYW8gdGVudGFyIGF0dWFsaXphciBwYXJhIHVtIG5vbWUgZHVwbGljYWRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgaW50ZWdyYWRvciA9IHtcbiAgICAgICAgaWQ6ICd1dWlkLXRlc3RlJyxcbiAgICAgICAgbm9tZTogJ0ludGVncmFkb3IgQW50aWdvJyxcbiAgICAgICAgZGF0YUNyaWFjYW86IG5ldyBEYXRlKCksXG4gICAgICAgIGRhdGFBdHVhbGl6YWNhbzogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHVwZGF0ZUR0bzogVXBkYXRlSW50ZWdyYWRvckR0byA9IHtcbiAgICAgICAgbm9tZTogJ0ludGVncmFkb3IgRHVwbGljYWRvJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGludGVncmFkb3JFeGlzdGVudGUgPSB7XG4gICAgICAgIGlkOiAnb3V0cm8tdXVpZCcsXG4gICAgICAgIG5vbWU6ICdJbnRlZ3JhZG9yIER1cGxpY2FkbycsXG4gICAgICB9O1xuXG4gICAgICAvLyBNb2NrIHBhcmEgZmluZEJ5SWRcbiAgICAgIG1vY2tSZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWVPbmNlKGludGVncmFkb3IpO1xuICAgICAgLy8gTW9jayBwYXJhIHZlcmlmaWNhciBub21lIGR1cGxpY2FkbyAtIHJldG9ybmEgb3V0cm8gaW50ZWdyYWRvclxuICAgICAgbW9ja1JlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoaW50ZWdyYWRvckV4aXN0ZW50ZSk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UudXBkYXRlKCd1dWlkLXRlc3RlJywgdXBkYXRlRHRvKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBDb25mbGljdEV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja1JlcG9zaXRvcnkuZmluZE9uZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBpZDogJ3V1aWQtdGVzdGUnIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IG5vbWU6IHVwZGF0ZUR0by5ub21lIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5zYXZlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVtb3ZlJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJlbW92ZXIgdW0gaW50ZWdyYWRvciBjb20gc3VjZXNzbycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGludGVncmFkb3IgPSB7XG4gICAgICAgIGlkOiAndXVpZC10ZXN0ZScsXG4gICAgICAgIG5vbWU6ICdJbnRlZ3JhZG9yIHBhcmEgUmVtb3ZlcicsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKGludGVncmFkb3IpO1xuICAgICAgbW9ja1JlcG9zaXRvcnkucmVtb3ZlLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgc2VydmljZS5yZW1vdmUoJ3V1aWQtdGVzdGUnKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobW9ja1JlcG9zaXRvcnkuZmluZE9uZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBpZDogJ3V1aWQtdGVzdGUnIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5yZW1vdmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGludGVncmFkb3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndG9nZ2xlQXRpdm8nLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgYXRpdmFyIHVtIGludGVncmFkb3IgaW5hdGl2bycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGludGVncmFkb3IgPSB7XG4gICAgICAgIGlkOiAndXVpZC10ZXN0ZScsXG4gICAgICAgIG5vbWU6ICdJbnRlZ3JhZG9yIFRlc3QnLFxuICAgICAgICBhdGl2bzogZmFsc2UsXG4gICAgICAgIGRhdGFDcmlhY2FvOiBuZXcgRGF0ZSgpLFxuICAgICAgICBkYXRhQXR1YWxpemFjYW86IG5ldyBEYXRlKCksXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBpbnRlZ3JhZG9yQXRpdmFkbyA9IHtcbiAgICAgICAgLi4uaW50ZWdyYWRvcixcbiAgICAgICAgYXRpdm86IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKGludGVncmFkb3IpO1xuICAgICAgbW9ja1JlcG9zaXRvcnkuc2F2ZS5tb2NrUmVzb2x2ZWRWYWx1ZShpbnRlZ3JhZG9yQXRpdmFkbyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS50b2dnbGVBdGl2bygndXVpZC10ZXN0ZScsIHRydWUpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChtb2NrUmVwb3NpdG9yeS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiAndXVpZC10ZXN0ZScgfSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KG1vY2tSZXBvc2l0b3J5LnNhdmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgLi4uaW50ZWdyYWRvcixcbiAgICAgICAgYXRpdm86IHRydWUsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYXRpdm8pLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZWdpc3RyYXJBY2Vzc28nLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgYXR1YWxpemFyIG8gdGltZXN0YW1wIGRlIMO6bHRpbW8gYWNlc3NvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgbW9ja1JlcG9zaXRvcnkudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHsgYWZmZWN0ZWQ6IDEgfSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgc2VydmljZS5yZWdpc3RyYXJBY2Vzc28oJ3V1aWQtdGVzdGUnKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobW9ja1JlcG9zaXRvcnkudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgeyBpZDogJ3V1aWQtdGVzdGUnIH0sXG4gICAgICAgIHsgdWx0aW1vQWNlc3NvOiBleHBlY3QuYW55KERhdGUpIH0sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9