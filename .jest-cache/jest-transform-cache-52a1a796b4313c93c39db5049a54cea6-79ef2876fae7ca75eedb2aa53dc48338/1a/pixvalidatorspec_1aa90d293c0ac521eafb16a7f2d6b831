52cb2918254d65c152fe08830f65e558
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const pix_validator_1 = require("../../validators/pix-validator");
/**
 * Testes unitários para o validador de chaves PIX
 *
 * Verifica o funcionamento correto das validações para diferentes tipos de chaves PIX,
 * incluindo CPF, e-mail, telefone e chave aleatória.
 *
 * @author Equipe PGBen
 */
describe('PixValidator', () => {
    let validator;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [pix_validator_1.PixValidator],
        }).compile();
        validator = module.get(pix_validator_1.PixValidator);
    });
    describe('validarChavePix', () => {
        it('deve retornar false para chave vazia', () => {
            expect(validator.validarChavePix('', 'cpf')).toBe(false);
            expect(validator.validarChavePix(null, 'email')).toBe(false);
            expect(validator.validarChavePix(undefined, 'telefone')).toBe(false);
        });
        it('deve retornar false para tipo inválido', () => {
            expect(validator.validarChavePix('12345678900', 'tipo_invalido')).toBe(false);
        });
        it('deve validar corretamente chave CPF', () => {
            // CPF válido
            expect(validator.validarChavePix('12345678909', 'cpf')).toBe(true);
            // CPF com formatação
            expect(validator.validarChavePix('123.456.789-09', 'cpf')).toBe(true);
            // CPF inválido (tamanho incorreto)
            expect(validator.validarChavePix('1234567890', 'cpf')).toBe(false);
            // CPF inválido (caracteres não numéricos)
            expect(validator.validarChavePix('1234567890a', 'cpf')).toBe(false);
        });
        it('deve validar corretamente chave e-mail', () => {
            // E-mail válido
            expect(validator.validarChavePix('usuario@dominio.com', 'email')).toBe(true);
            // E-mail com subdomínio
            expect(validator.validarChavePix('usuario@sub.dominio.com.br', 'email')).toBe(true);
            // E-mail inválido (sem @)
            expect(validator.validarChavePix('usuariodominio.com', 'email')).toBe(false);
            // E-mail inválido (sem domínio)
            expect(validator.validarChavePix('usuario@', 'email')).toBe(false);
            // E-mail inválido (caracteres especiais não permitidos)
            expect(validator.validarChavePix('usuario!@dominio.com', 'email')).toBe(false);
        });
        it('deve validar corretamente chave telefone', () => {
            // Telefone válido (formato completo)
            expect(validator.validarChavePix('+5584999999999', 'telefone')).toBe(true);
            // Telefone válido (sem +)
            expect(validator.validarChavePix('5584999999999', 'telefone')).toBe(true);
            // Telefone válido (com formatação)
            expect(validator.validarChavePix('+55 (84) 99999-9999', 'telefone')).toBe(true);
            // Telefone inválido (poucos dígitos)
            expect(validator.validarChavePix('559999', 'telefone')).toBe(false);
            // Telefone inválido (caracteres não permitidos)
            expect(validator.validarChavePix('5584999999a99', 'telefone')).toBe(false);
        });
        it('deve validar corretamente chave aleatória', () => {
            // UUID válido
            expect(validator.validarChavePix('123e4567-e89b-12d3-a456-426614174000', 'aleatoria')).toBe(true);
            // Chave aleatória inválida (formato incorreto)
            expect(validator.validarChavePix('123e4567e89b12d3a456426614174000', 'aleatoria')).toBe(false);
            // Chave aleatória inválida (tamanho incorreto)
            expect(validator.validarChavePix('123e4567-e89b-12d3-a456', 'aleatoria')).toBe(false);
        });
    });
    describe('mascaraChavePix', () => {
        it('deve mascarar corretamente chave CPF', () => {
            const mascarado = validator.mascaraChavePix('12345678909', 'cpf');
            expect(mascarado).toBe('***.456.789-**');
        });
        it('deve mascarar corretamente chave e-mail', () => {
            const mascarado = validator.mascaraChavePix('usuario@dominio.com', 'email');
            expect(mascarado).toMatch(/^u\*+@d\*+\.com$/);
        });
        it('deve mascarar corretamente chave telefone', () => {
            const mascarado = validator.mascaraChavePix('5584999999999', 'telefone');
            expect(mascarado).toMatch(/^\(\*\*\) \*\*\*\*\*\-\d{4}$/);
        });
        it('deve mascarar corretamente chave aleatória', () => {
            const chave = '123e4567-e89b-12d3-a456-426614174000';
            const mascarado = validator.mascaraChavePix(chave, 'aleatoria');
            expect(mascarado.length).toBe(chave.length);
            expect(mascarado).toContain('123e4567');
            expect(mascarado).not.toBe(chave);
        });
        it('deve retornar string vazia para chave vazia', () => {
            expect(validator.mascaraChavePix('', 'cpf')).toBe('');
            expect(validator.mascaraChavePix(null, 'email')).toBe('');
            expect(validator.mascaraChavePix(undefined, 'telefone')).toBe('');
        });
    });
    describe('obterTipoChavePix', () => {
        it('deve identificar corretamente o tipo de chave CPF', () => {
            expect(validator.obterTipoChavePix('12345678909')).toBe('cpf');
            expect(validator.obterTipoChavePix('123.456.789-09')).toBe('cpf');
        });
        it('deve identificar corretamente o tipo de chave e-mail', () => {
            expect(validator.obterTipoChavePix('usuario@dominio.com')).toBe('email');
            expect(validator.obterTipoChavePix('usuario@sub.dominio.com.br')).toBe('email');
        });
        it('deve identificar corretamente o tipo de chave telefone', () => {
            expect(validator.obterTipoChavePix('+5584999999999')).toBe('telefone');
            expect(validator.obterTipoChavePix('5584999999999')).toBe('telefone');
        });
        it('deve identificar corretamente o tipo de chave aleatória', () => {
            expect(validator.obterTipoChavePix('123e4567-e89b-12d3-a456-426614174000')).toBe('aleatoria');
        });
        it('deve retornar "desconhecido" para chave de formato não reconhecido', () => {
            expect(validator.obterTipoChavePix('formato_desconhecido')).toBe('desconhecido');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcdGVzdHNcXHZhbGlkYXRvcnNcXHBpeC12YWxpZGF0b3Iuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCxrRUFBOEQ7QUFFOUQ7Ozs7Ozs7R0FPRztBQUNILFFBQVEsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO0lBQzVCLElBQUksU0FBdUIsQ0FBQztJQUU1QixVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFNBQVMsRUFBRSxDQUFDLDRCQUFZLENBQUM7U0FDMUIsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRWIsU0FBUyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQWUsNEJBQVksQ0FBQyxDQUFDO0lBQ3JELENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtRQUMvQixFQUFFLENBQUMsc0NBQXNDLEVBQUUsR0FBRyxFQUFFO1lBQzlDLE1BQU0sQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN6RCxNQUFNLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDN0QsTUFBTSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsU0FBUyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3ZFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLEdBQUcsRUFBRTtZQUNoRCxNQUFNLENBQUMsU0FBUyxD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XFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xccGFnYW1lbnRvXFx0ZXN0c1xcdmFsaWRhdG9yc1xccGl4LXZhbGlkYXRvci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgUGl4VmFsaWRhdG9yIH0gZnJvbSAnLi4vLi4vdmFsaWRhdG9ycy9waXgtdmFsaWRhdG9yJztcblxuLyoqXG4gKiBUZXN0ZXMgdW5pdMOhcmlvcyBwYXJhIG8gdmFsaWRhZG9yIGRlIGNoYXZlcyBQSVhcbiAqIFxuICogVmVyaWZpY2EgbyBmdW5jaW9uYW1lbnRvIGNvcnJldG8gZGFzIHZhbGlkYcOnw7VlcyBwYXJhIGRpZmVyZW50ZXMgdGlwb3MgZGUgY2hhdmVzIFBJWCxcbiAqIGluY2x1aW5kbyBDUEYsIGUtbWFpbCwgdGVsZWZvbmUgZSBjaGF2ZSBhbGVhdMOzcmlhLlxuICogXG4gKiBAYXV0aG9yIEVxdWlwZSBQR0JlblxuICovXG5kZXNjcmliZSgnUGl4VmFsaWRhdG9yJywgKCkgPT4ge1xuICBsZXQgdmFsaWRhdG9yOiBQaXhWYWxpZGF0b3I7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1BpeFZhbGlkYXRvcl0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgdmFsaWRhdG9yID0gbW9kdWxlLmdldDxQaXhWYWxpZGF0b3I+KFBpeFZhbGlkYXRvcik7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd2YWxpZGFyQ2hhdmVQaXgnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgZmFsc2UgcGFyYSBjaGF2ZSB2YXppYScsICgpID0+IHtcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCcnLCAnY3BmJykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgobnVsbCwgJ2VtYWlsJykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgodW5kZWZpbmVkLCAndGVsZWZvbmUnKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBmYWxzZSBwYXJhIHRpcG8gaW52w6FsaWRvJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoJzEyMzQ1Njc4OTAwJywgJ3RpcG9faW52YWxpZG8nKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSB2YWxpZGFyIGNvcnJldGFtZW50ZSBjaGF2ZSBDUEYnLCAoKSA9PiB7XG4gICAgICAvLyBDUEYgdsOhbGlkb1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoJzEyMzQ1Njc4OTA5JywgJ2NwZicpKS50b0JlKHRydWUpO1xuICAgICAgXG4gICAgICAvLyBDUEYgY29tIGZvcm1hdGHDp8Ojb1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoJzEyMy40NTYuNzg5LTA5JywgJ2NwZicpKS50b0JlKHRydWUpO1xuICAgICAgXG4gICAgICAvLyBDUEYgaW52w6FsaWRvICh0YW1hbmhvIGluY29ycmV0bylcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCcxMjM0NTY3ODkwJywgJ2NwZicpKS50b0JlKGZhbHNlKTtcbiAgICAgIFxuICAgICAgLy8gQ1BGIGludsOhbGlkbyAoY2FyYWN0ZXJlcyBuw6NvIG51bcOpcmljb3MpXG4gICAgICBleHBlY3QodmFsaWRhdG9yLnZhbGlkYXJDaGF2ZVBpeCgnMTIzNDU2Nzg5MGEnLCAnY3BmJykpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgdmFsaWRhciBjb3JyZXRhbWVudGUgY2hhdmUgZS1tYWlsJywgKCkgPT4ge1xuICAgICAgLy8gRS1tYWlsIHbDoWxpZG9cbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCd1c3VhcmlvQGRvbWluaW8uY29tJywgJ2VtYWlsJykpLnRvQmUodHJ1ZSk7XG4gICAgICBcbiAgICAgIC8vIEUtbWFpbCBjb20gc3ViZG9tw61uaW9cbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCd1c3VhcmlvQHN1Yi5kb21pbmlvLmNvbS5icicsICdlbWFpbCcpKS50b0JlKHRydWUpO1xuICAgICAgXG4gICAgICAvLyBFLW1haWwgaW52w6FsaWRvIChzZW0gQClcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCd1c3VhcmlvZG9taW5pby5jb20nLCAnZW1haWwnKSkudG9CZShmYWxzZSk7XG4gICAgICBcbiAgICAgIC8vIEUtbWFpbCBpbnbDoWxpZG8gKHNlbSBkb23DrW5pbylcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCd1c3VhcmlvQCcsICdlbWFpbCcpKS50b0JlKGZhbHNlKTtcbiAgICAgIFxuICAgICAgLy8gRS1tYWlsIGludsOhbGlkbyAoY2FyYWN0ZXJlcyBlc3BlY2lhaXMgbsOjbyBwZXJtaXRpZG9zKVxuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoJ3VzdWFyaW8hQGRvbWluaW8uY29tJywgJ2VtYWlsJykpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgdmFsaWRhciBjb3JyZXRhbWVudGUgY2hhdmUgdGVsZWZvbmUnLCAoKSA9PiB7XG4gICAgICAvLyBUZWxlZm9uZSB2w6FsaWRvIChmb3JtYXRvIGNvbXBsZXRvKVxuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoJys1NTg0OTk5OTk5OTk5JywgJ3RlbGVmb25lJykpLnRvQmUodHJ1ZSk7XG4gICAgICBcbiAgICAgIC8vIFRlbGVmb25lIHbDoWxpZG8gKHNlbSArKVxuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoJzU1ODQ5OTk5OTk5OTknLCAndGVsZWZvbmUnKSkudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgLy8gVGVsZWZvbmUgdsOhbGlkbyAoY29tIGZvcm1hdGHDp8OjbylcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCcrNTUgKDg0KSA5OTk5OS05OTk5JywgJ3RlbGVmb25lJykpLnRvQmUodHJ1ZSk7XG4gICAgICBcbiAgICAgIC8vIFRlbGVmb25lIGludsOhbGlkbyAocG91Y29zIGTDrWdpdG9zKVxuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoJzU1OTk5OScsICd0ZWxlZm9uZScpKS50b0JlKGZhbHNlKTtcbiAgICAgIFxuICAgICAgLy8gVGVsZWZvbmUgaW52w6FsaWRvIChjYXJhY3RlcmVzIG7Do28gcGVybWl0aWRvcylcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3IudmFsaWRhckNoYXZlUGl4KCc1NTg0OTk5OTk5YTk5JywgJ3RlbGVmb25lJykpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgdmFsaWRhciBjb3JyZXRhbWVudGUgY2hhdmUgYWxlYXTDs3JpYScsICgpID0+IHtcbiAgICAgIC8vIFVVSUQgdsOhbGlkb1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsICdhbGVhdG9yaWEnKSkudG9CZSh0cnVlKTtcbiAgICAgIFxuICAgICAgLy8gQ2hhdmUgYWxlYXTDs3JpYSBpbnbDoWxpZGEgKGZvcm1hdG8gaW5jb3JyZXRvKVxuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoJzEyM2U0NTY3ZTg5YjEyZDNhNDU2NDI2NjE0MTc0MDAwJywgJ2FsZWF0b3JpYScpKS50b0JlKGZhbHNlKTtcbiAgICAgIFxuICAgICAgLy8gQ2hhdmUgYWxlYXTDs3JpYSBpbnbDoWxpZGEgKHRhbWFuaG8gaW5jb3JyZXRvKVxuICAgICAgZXhwZWN0KHZhbGlkYXRvci52YWxpZGFyQ2hhdmVQaXgoJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2JywgJ2FsZWF0b3JpYScpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ21hc2NhcmFDaGF2ZVBpeCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBtYXNjYXJhciBjb3JyZXRhbWVudGUgY2hhdmUgQ1BGJywgKCkgPT4ge1xuICAgICAgY29uc3QgbWFzY2FyYWRvID0gdmFsaWRhdG9yLm1hc2NhcmFDaGF2ZVBpeCgnMTIzNDU2Nzg5MDknLCAnY3BmJyk7XG4gICAgICBleHBlY3QobWFzY2FyYWRvKS50b0JlKCcqKiouNDU2Ljc4OS0qKicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbWFzY2FyYXIgY29ycmV0YW1lbnRlIGNoYXZlIGUtbWFpbCcsICgpID0+IHtcbiAgICAgIGNvbnN0IG1hc2NhcmFkbyA9IHZhbGlkYXRvci5tYXNjYXJhQ2hhdmVQaXgoJ3VzdWFyaW9AZG9taW5pby5jb20nLCAnZW1haWwnKTtcbiAgICAgIGV4cGVjdChtYXNjYXJhZG8pLnRvTWF0Y2goL151XFwqK0BkXFwqK1xcLmNvbSQvKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIG1hc2NhcmFyIGNvcnJldGFtZW50ZSBjaGF2ZSB0ZWxlZm9uZScsICgpID0+IHtcbiAgICAgIGNvbnN0IG1hc2NhcmFkbyA9IHZhbGlkYXRvci5tYXNjYXJhQ2hhdmVQaXgoJzU1ODQ5OTk5OTk5OTknLCAndGVsZWZvbmUnKTtcbiAgICAgIGV4cGVjdChtYXNjYXJhZG8pLnRvTWF0Y2goL15cXChcXCpcXCpcXCkgXFwqXFwqXFwqXFwqXFwqXFwtXFxkezR9JC8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbWFzY2FyYXIgY29ycmV0YW1lbnRlIGNoYXZlIGFsZWF0w7NyaWEnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjaGF2ZSA9ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnO1xuICAgICAgY29uc3QgbWFzY2FyYWRvID0gdmFsaWRhdG9yLm1hc2NhcmFDaGF2ZVBpeChjaGF2ZSwgJ2FsZWF0b3JpYScpO1xuICAgICAgZXhwZWN0KG1hc2NhcmFkby5sZW5ndGgpLnRvQmUoY2hhdmUubGVuZ3RoKTtcbiAgICAgIGV4cGVjdChtYXNjYXJhZG8pLnRvQ29udGFpbignMTIzZTQ1NjcnKTtcbiAgICAgIGV4cGVjdChtYXNjYXJhZG8pLm5vdC50b0JlKGNoYXZlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIHN0cmluZyB2YXppYSBwYXJhIGNoYXZlIHZhemlhJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci5tYXNjYXJhQ2hhdmVQaXgoJycsICdjcGYnKSkudG9CZSgnJyk7XG4gICAgICBleHBlY3QodmFsaWRhdG9yLm1hc2NhcmFDaGF2ZVBpeChudWxsLCAnZW1haWwnKSkudG9CZSgnJyk7XG4gICAgICBleHBlY3QodmFsaWRhdG9yLm1hc2NhcmFDaGF2ZVBpeCh1bmRlZmluZWQsICd0ZWxlZm9uZScpKS50b0JlKCcnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ29idGVyVGlwb0NoYXZlUGl4JywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGlkZW50aWZpY2FyIGNvcnJldGFtZW50ZSBvIHRpcG8gZGUgY2hhdmUgQ1BGJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci5vYnRlclRpcG9DaGF2ZVBpeCgnMTIzNDU2Nzg5MDknKSkudG9CZSgnY3BmJyk7XG4gICAgICBleHBlY3QodmFsaWRhdG9yLm9idGVyVGlwb0NoYXZlUGl4KCcxMjMuNDU2Ljc4OS0wOScpKS50b0JlKCdjcGYnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGlkZW50aWZpY2FyIGNvcnJldGFtZW50ZSBvIHRpcG8gZGUgY2hhdmUgZS1tYWlsJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci5vYnRlclRpcG9DaGF2ZVBpeCgndXN1YXJpb0Bkb21pbmlvLmNvbScpKS50b0JlKCdlbWFpbCcpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci5vYnRlclRpcG9DaGF2ZVBpeCgndXN1YXJpb0BzdWIuZG9taW5pby5jb20uYnInKSkudG9CZSgnZW1haWwnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGlkZW50aWZpY2FyIGNvcnJldGFtZW50ZSBvIHRpcG8gZGUgY2hhdmUgdGVsZWZvbmUnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodmFsaWRhdG9yLm9idGVyVGlwb0NoYXZlUGl4KCcrNTU4NDk5OTk5OTk5OScpKS50b0JlKCd0ZWxlZm9uZScpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci5vYnRlclRpcG9DaGF2ZVBpeCgnNTU4NDk5OTk5OTk5OScpKS50b0JlKCd0ZWxlZm9uZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgaWRlbnRpZmljYXIgY29ycmV0YW1lbnRlIG8gdGlwbyBkZSBjaGF2ZSBhbGVhdMOzcmlhJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KHZhbGlkYXRvci5vYnRlclRpcG9DaGF2ZVBpeCgnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJykpLnRvQmUoJ2FsZWF0b3JpYScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgXCJkZXNjb25oZWNpZG9cIiBwYXJhIGNoYXZlIGRlIGZvcm1hdG8gbsOjbyByZWNvbmhlY2lkbycsICgpID0+IHtcbiAgICAgIGV4cGVjdCh2YWxpZGF0b3Iub2J0ZXJUaXBvQ2hhdmVQaXgoJ2Zvcm1hdG9fZGVzY29uaGVjaWRvJykpLnRvQmUoJ2Rlc2NvbmhlY2lkbycpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9