c48aa262e8447d08afc665fe6e61b627
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const usuario_controller_1 = require("./usuario.controller");
const usuario_service_1 = require("../services/usuario.service");
const jwt_auth_guard_1 = require("../../../auth/guards/jwt-auth.guard");
const permission_guard_1 = require("../../../auth/guards/permission.guard");
const unidade_entity_1 = require("../../unidade/entities/unidade.entity");
/**
 * Testes unitários para o UsuarioController
 *
 * Cobertura de testes:
 * - Listagem de usuários com filtros
 * - Busca por ID
 * - Perfil do usuário atual
 * - Criação de usuários
 * - Atualização de dados
 * - Atualização de status
 * - Atualização de senha
 * - Remoção de usuários
 */
describe('UsuarioController', () => {
    let controller;
    let service;
    const mockUsuario = {
        id: '123e4567-e89b-12d3-a456-426614174000',
        nome: 'João da Silva',
        email: 'joao.silva@semtas.natal.gov.br',
        cpf: '123.456.789-00',
        telefone: '(84) 99999-9999',
        matricula: '12345',
        senhaHash: '$2b$12$hashedpassword',
        role_id: 'ASSISTENTE_SOCIAL',
        status: 'ativo',
        primeiro_acesso: false,
        unidadeId: 'unidade-123',
        setorId: 'setor-123',
        created_at: new Date(),
        updated_at: new Date(),
        // Relacionamentos obrigatórios
        role: {
            id: 'role-123',
            nome: 'admin',
            descricao: 'Administrador',
            ativo: true,
            usuarios: [],
            created_at: new Date(),
            updated_at: new Date()
        },
        unidade: {
            id: 'unidade-123',
            nome: 'Unidade Teste',
            codigo: 'UN001',
            sigla: 'UT',
            tipo: unidade_entity_1.TipoUnidade.CRAS,
            endereco: 'Endereço Teste',
            telefone: '(84) 99999-9999',
            email: 'unidade@teste.com',
            responsavel_matricula: '12345',
            status: unidade_entity_1.StatusUnidade.ATIVO,
            usuarios: [],
            setores: [],
            created_at: new Date(),
            updated_at: new Date(),
            removed_at: null
        },
        setor: {
            id: 'setor-123',
            nome: 'Setor Teste',
            descricao: 'Setor de Teste',
            unidade_id: 'unidade-123',
            unidade: {
                id: 'unidade-123',
                nome: 'Unidade Teste',
                codigo: 'UN001',
                sigla: 'UT',
                tipo: unidade_entity_1.TipoUnidade.CRAS,
                endereco: 'Rua Teste, 123',
                telefone: '(84) 99999-9999',
                email: 'unidade@teste.com',
                responsavel_matricula: '12345',
                status: unidade_entity_1.StatusUnidade.ATIVO,
                usuarios: [],
                setores: [],
                created_at: new Date(),
                updated_at: new Date(),
                removed_at: null
            },
            usuarios: [],
            created_at: new Date(),
            updated_at: new Date()
        },
        refreshTokens: []
    };
    const mockRequest = {
        user: {
            id: '123e4567-e89b-12d3-a456-426614174000',
            email: 'joao.silva@semtas.natal.gov.br',
            role: 'ASSISTENTE_SOCIAL'
        }
    };
    beforeEach(async () => {
        const mockService = {
            findAll: jest.fn(),
            findById: jest.fn(),
            create: jest.fn(),
            update: jest.fn(),
            updateStatus: jest.fn(),
            updateSenha: jest.fn(),
            remove: jest.fn(),
            getProfile: jest.fn(),
        };
        const module = await testing_1.Test.createTestingModule({
            controllers: [usuario_controller_1.UsuarioController],
            providers: [
                {
                    provide: usuario_service_1.UsuarioService,
                    useValue: mockService,
                },
            ],
        })
            .overrideGuard(jwt_auth_guard_1.JwtAuthGuard)
            .useValue({ canActivate: jest.fn(() => true) })
            .overrideGuard(permission_guard_1.PermissionGuard)
            .useValue({ canActivate: jest.fn(() => true) })
            .compile();
        controller = module.get(usuario_controller_1.UsuarioController);
        service = module.get(usuario_service_1.UsuarioService);
    });
    describe('findAll', () => {
        it('deve retornar lista de usuários com paginação', async () => {
            const mockResult = {
                items: [mockUsuario],
                meta: {
                    total: 1,
                    page: 1,
                    limit: 10,
                    totalPages: 1
                }
            };
            service.findAll.mockResolvedValue(mockResult);
            const result = await controller.findAll(1, 10, 'João', 'ASSISTENTE_SOCIAL', 'ativo', 'unidade-123');
            expect(result).toEqual(mockResult);
            expect(service.findAll).toHaveBeenCalledWith({
                page: 1,
                limit: 10,
                search: 'João',
                role: 'ASSISTENTE_SOCIAL',
                status: unidade_entity_1.StatusUnidade.ATIVO,
                unidadeId: 'unidade-123'
            });
        });
        it('deve usar valores padrão quando parâmetros não fornecidos', async () => {
            const mockResult = {
                items: [mockUsuario],
                meta: {
                    total: 1,
                    page: 1,
                    limit: 10,
                    totalPages: 1
                }
            };
            service.findAll.mockResolvedValue(mockResult);
            await controller.findAll();
            expect(service.findAll).toHaveBeenCalledWith({
                page: undefined,
                limit: undefined,
                search: undefined,
                role: undefined,
                status: undefined,
                unidadeId: undefined
            });
        });
    });
    describe('findOne', () => {
        it('deve retornar usuário por ID', async () => {
            service.findById.mockResolvedValue(mockUsuario);
            const result = await controller.findOne('123e4567-e89b-12d3-a456-426614174000');
            expect(result).toEqual(mockUsuario);
            expect(service.findById).toHaveBeenCalledWith('123e4567-e89b-12d3-a456-426614174000');
        });
    });
    describe('getProfile', () => {
        it('deve retornar perfil do usuário atual', async () => {
            service.getProfile.mockResolvedValue(mockUsuario);
            const result = await controller.getProfile(mockRequest);
            expect(result).toEqual(mockUsuario);
            expect(service.getProfile).toHaveBeenCalledWith('123e4567-e89b-12d3-a456-426614174000');
        });
    });
    describe('create', () => {
        it('deve criar novo usuário', async () => {
            const createDto = {
                nome: 'João da Silva',
                email: 'joao.silva@semtas.natal.gov.br',
                senha: 'Senha@123',
                cpf: '123.456.789-00',
                telefone: '(84) 99999-9999',
                matricula: '12345',
                role_id: 'ASSISTENTE_SOCIAL',
                unidade_id: 'unidade-123',
                setor_id: 'setor-123'
            };
            const mockResponse = {
                data: mockUsuario,
                meta: null,
                message: null
            };
            service.create.mockResolvedValue(mockResponse);
            const result = await controller.create(createDto);
            expect(result).toEqual(mockResponse);
            expect(service.create).toHaveBeenCalledWith(createDto);
        });
    });
    describe('update', () => {
        it('deve atualizar usuário', async () => {
            const updateDto = {
                nome: 'João Silva Santos',
                cpf: '123.456.789-00',
                telefone: '(84) 88888-8888'
            };
            const mockResponse = {
                data: { ...mockUsuario, ...updateDto },
                meta: null,
                message: null
            };
            service.update.mockResolvedValue(mockResponse);
            const result = await controller.update('123e4567-e89b-12d3-a456-426614174000', updateDto);
            expect(result).toEqual(mockResponse);
            expect(service.update).toHaveBeenCalledWith('123e4567-e89b-12d3-a456-426614174000', updateDto);
        });
    });
    describe('updateStatus', () => {
        it('deve atualizar status do usuário', async () => {
            const updateStatusDto = {
                status: 'inativo'
            };
            const { senhaHash, ...usuarioAtualizado } = { ...mockUsuario, status: 'inativo' };
            service.updateStatus.mockResolvedValue(usuarioAtualizado);
            const result = await controller.updateStatus('123e4567-e89b-12d3-a456-426614174000', updateStatusDto);
            expect(result).toEqual(usuarioAtualizado);
            expect(service.updateStatus).toHaveBeenCalledWith('123e4567-e89b-12d3-a456-426614174000', updateStatusDto);
        });
    });
    describe('updateSenha', () => {
        it('deve atualizar senha do usuário', async () => {
            const updateSenhaDto = {
                senhaAtual: 'senhaAtual123',
                novaSenha: 'novaSenha123',
                confirmacaoSenha: 'novaSenha123'
            };
            const mockResponse = { message: 'Senha atualizada com sucesso' };
            service.updateSenha.mockResolvedValue(mockResponse);
            const result = await controller.updateSenha('123e4567-e89b-12d3-a456-426614174000', updateSenhaDto, mockRequest);
            expect(result).toEqual(mockResponse);
            expect(service.updateSenha).toHaveBeenCalledWith('123e4567-e89b-12d3-a456-426614174000', updateSenhaDto);
        });
    });
    describe('remove', () => {
        it('deve remover usuário', async () => {
            const mockResponse = { message: 'Usuário removido com sucesso' };
            service.remove.mockResolvedValue(undefined);
            const result = await controller.remove('123e4567-e89b-12d3-a456-426614174000');
            expect(service.remove).toHaveBeenCalledWith('123e4567-e89b-12d3-a456-426614174000');
        });
    });
    it('deve estar definido', () => {
        expect(controller).toBeDefined();
    });
    it('deve ter service injetado', () => {
        expect(service).toBeDefined();
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHVzdWFyaW9cXGNvbnRyb2xsZXJzXFx1c3VhcmlvLmNvbnRyb2xsZXIuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCw2REFBeUQ7QUFDekQsaUVBQTZEO0FBQzdELHdFQUFtRTtBQUNuRSw0RUFBd0U7QUFNeEUsMEVBQW1GO0FBRW5GOzs7Ozs7Ozs7Ozs7R0FZRztBQUNILFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsSUFBSSxVQUE2QixDQUFDO0lBQ2xDLElBQUksT0FBb0MsQ0FBQztJQUV6QyxNQUFNLFdBQVcsR0FBWTtRQUMzQixFQUFFLEVBQUUsc0NBQXNDO1FBQzFDLElBQUksRUFBRSxlQUFlO1FBQ3JCLEtBQUssRUFBRSxnQ0FBZ0M7UUFDdkMsR0FBRyxFQUFFLGdCQUFnQjtRQUNyQixRQUFRLEVBQUUsaUJBQWlCO1FBQzNCLFNBQVMsRUFBRSxPQUFPO1FBQ2xCLFNBQVMsRUFBRSx1QkFBdUI7UUFDbEMsT0FBTyxFQUFFLG1CQUFtQjtRQUM1QixNQUFNLEVBQUUsT0FBTztRQUNmLGVBQWUsRUFBRSxLQUFLO1FBQ3RCLFNBQVMsRUFBRSxhQUFhO1FBQ3hCLE9BQU8sRUFBRSxXQUFXO1FBQ3BCLFVBQVUsRUFBRSxJQUFJLElBQUksRUFBRTtRQUN0QixVQUFVLEVBQUUsSUFBSSxJQUFJLEVBQUU7UUFDdEIsK0JBQStCO1FBQy9CLElBQUksRUFBRTtZQUNKLEVBQUUsRUFBRSxVQUFVO1lBQ2QsSUFBSSxFQUFFLE9BQU87WUFDYixTQUFTLEVBQUUsZUFBZTtZQUMxQixLQUFLLEVBQUUsSUFBSTtZQUNYLFFBQVEsRUFBRSxFQUFFO1lBQ1osVUFBVSxFQUFFLElBQUksSUFBSSxFQUFFO1lBQ3RCLFVBQVUsRUFBRSxJQUFJLElBQUksRUFBRTtTQUN2QjtRQUNELE9BQU8sRUFBRTtZQUNQLEVB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QUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUU7UUFDdEIsRUFBRSxDQUFDLHNCQUFzQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BDLE1BQU0sWUFBWSxHQUFHLEVBQUUsT0FBTyxFQUFFLDhCQUE4QixFQUFFLENBQUM7WUFDakUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUU1QyxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxNQUFNLENBQUMsc0NBQXNDLENBQUMsQ0FBQztZQUUvRSxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDLHNDQUFzQyxDQUFDLENBQUM7UUFDdEYsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7UUFDN0IsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ25DLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtRQUNuQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDaEMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xcdXN1YXJpb1xcY29udHJvbGxlcnNcXHVzdWFyaW8uY29udHJvbGxlci5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgVXN1YXJpb0NvbnRyb2xsZXIgfSBmcm9tICcuL3VzdWFyaW8uY29udHJvbGxlcic7XG5pbXBvcnQgeyBVc3VhcmlvU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3VzdWFyaW8uc2VydmljZSc7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi8uLi8uLi9hdXRoL2d1YXJkcy9qd3QtYXV0aC5ndWFyZCc7XG5pbXBvcnQgeyBQZXJtaXNzaW9uR3VhcmQgfSBmcm9tICcuLi8uLi8uLi9hdXRoL2d1YXJkcy9wZXJtaXNzaW9uLmd1YXJkJztcbmltcG9ydCB7IENyZWF0ZVVzdWFyaW9EdG8gfSBmcm9tICcuLi9kdG8vY3JlYXRlLXVzdWFyaW8uZHRvJztcbmltcG9ydCB7IFVwZGF0ZVVzdWFyaW9EdG8gfSBmcm9tICcuLi9kdG8vdXBkYXRlLXVzdWFyaW8uZHRvJztcbmltcG9ydCB7IFVwZGF0ZVN0YXR1c1VzdWFyaW9EdG8gfSBmcm9tICcuLi9kdG8vdXBkYXRlLXN0YXR1cy11c3VhcmlvLmR0byc7XG5pbXBvcnQgeyBVcGRhdGVTZW5oYUR0byB9IGZyb20gJy4uL2R0by91cGRhdGUtc2VuaGEuZHRvJztcbmltcG9ydCB7IFVzdWFyaW8gfSBmcm9tICcuLi9lbnRpdGllcy91c3VhcmlvLmVudGl0eSc7XG5pbXBvcnQgeyBUaXBvVW5pZGFkZSwgU3RhdHVzVW5pZGFkZSB9IGZyb20gJy4uLy4uL3VuaWRhZGUvZW50aXRpZXMvdW5pZGFkZS5lbnRpdHknO1xuXG4vKipcbiAqIFRlc3RlcyB1bml0w6FyaW9zIHBhcmEgbyBVc3VhcmlvQ29udHJvbGxlclxuICogXG4gKiBDb2JlcnR1cmEgZGUgdGVzdGVzOlxuICogLSBMaXN0YWdlbSBkZSB1c3XDoXJpb3MgY29tIGZpbHRyb3NcbiAqIC0gQnVzY2EgcG9yIElEXG4gKiAtIFBlcmZpbCBkbyB1c3XDoXJpbyBhdHVhbFxuICogLSBDcmlhw6fDo28gZGUgdXN1w6FyaW9zXG4gKiAtIEF0dWFsaXphw6fDo28gZGUgZGFkb3NcbiAqIC0gQXR1YWxpemHDp8OjbyBkZSBzdGF0dXNcbiAqIC0gQXR1YWxpemHDp8OjbyBkZSBzZW5oYVxuICogLSBSZW1vw6fDo28gZGUgdXN1w6FyaW9zXG4gKi9cbmRlc2NyaWJlKCdVc3VhcmlvQ29udHJvbGxlcicsICgpID0+IHtcbiAgbGV0IGNvbnRyb2xsZXI6IFVzdWFyaW9Db250cm9sbGVyO1xuICBsZXQgc2VydmljZTogamVzdC5Nb2NrZWQ8VXN1YXJpb1NlcnZpY2U+O1xuXG4gIGNvbnN0IG1vY2tVc3VhcmlvOiBVc3VhcmlvID0ge1xuICAgIGlkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJyxcbiAgICBub21lOiAnSm/Do28gZGEgU2lsdmEnLFxuICAgIGVtYWlsOiAnam9hby5zaWx2YUBzZW10YXMubmF0YWwuZ292LmJyJyxcbiAgICBjcGY6ICcxMjMuNDU2Ljc4OS0wMCcsXG4gICAgdGVsZWZvbmU6ICcoODQpIDk5OTk5LTk5OTknLFxuICAgIG1hdHJpY3VsYTogJzEyMzQ1JyxcbiAgICBzZW5oYUhhc2g6ICckMmIkMTIkaGFzaGVkcGFzc3dvcmQnLFxuICAgIHJvbGVfaWQ6ICdBU1NJU1RFTlRFX1NPQ0lBTCcsXG4gICAgc3RhdHVzOiAnYXRpdm8nLFxuICAgIHByaW1laXJvX2FjZXNzbzogZmFsc2UsXG4gICAgdW5pZGFkZUlkOiAndW5pZGFkZS0xMjMnLFxuICAgIHNldG9ySWQ6ICdzZXRvci0xMjMnLFxuICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKSxcbiAgICAvLyBSZWxhY2lvbmFtZW50b3Mgb2JyaWdhdMOzcmlvc1xuICAgIHJvbGU6IHtcbiAgICAgIGlkOiAncm9sZS0xMjMnLFxuICAgICAgbm9tZTogJ2FkbWluJyxcbiAgICAgIGRlc2NyaWNhbzogJ0FkbWluaXN0cmFkb3InLFxuICAgICAgYXRpdm86IHRydWUsXG4gICAgICB1c3VhcmlvczogW10sXG4gICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKVxuICAgIH0sXG4gICAgdW5pZGFkZToge1xuICAgICAgaWQ6ICd1bmlkYWRlLTEyMycsXG4gICAgICBub21lOiAnVW5pZGFkZSBUZXN0ZScsXG4gICAgICBjb2RpZ286ICdVTjAwMScsXG4gICAgICBzaWdsYTogJ1VUJyxcbiAgICAgIHRpcG86IFRpcG9VbmlkYWRlLkNSQVMsXG4gICAgICBlbmRlcmVjbzogJ0VuZGVyZcOnbyBUZXN0ZScsXG4gICAgICB0ZWxlZm9uZTogJyg4NCkgOTk5OTktOTk5OScsXG4gICAgICBlbWFpbDogJ3VuaWRhZGVAdGVzdGUuY29tJyxcbiAgICAgIHJlc3BvbnNhdmVsX21hdHJpY3VsYTogJzEyMzQ1JyxcbiAgICAgIHN0YXR1czogU3RhdHVzVW5pZGFkZS5BVElWTyxcbiAgICAgIHVzdWFyaW9zOiBbXSxcbiAgICAgIHNldG9yZXM6IFtdLFxuICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKSxcbiAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gICAgICByZW1vdmVkX2F0OiBudWxsXG4gICAgfSxcbiAgICBzZXRvcjoge1xuICAgICAgaWQ6ICdzZXRvci0xMjMnLFxuICAgICAgbm9tZTogJ1NldG9yIFRlc3RlJyxcbiAgICAgIGRlc2NyaWNhbzogJ1NldG9yIGRlIFRlc3RlJyxcbiAgICAgIHVuaWRhZGVfaWQ6ICd1bmlkYWRlLTEyMycsXG4gICAgICB1bmlkYWRlOiB7XG4gICAgICAgIGlkOiAndW5pZGFkZS0xMjMnLFxuICAgICAgICBub21lOiAnVW5pZGFkZSBUZXN0ZScsXG4gICAgICAgIGNvZGlnbzogJ1VOMDAxJyxcbiAgICAgICAgc2lnbGE6ICdVVCcsXG4gICAgICAgIHRpcG86IFRpcG9VbmlkYWRlLkNSQVMsXG4gICAgICAgIGVuZGVyZWNvOiAnUnVhIFRlc3RlLCAxMjMnLFxuICAgICAgICB0ZWxlZm9uZTogJyg4NCkgOTk5OTktOTk5OScsXG4gICAgICAgIGVtYWlsOiAndW5pZGFkZUB0ZXN0ZS5jb20nLFxuICAgICAgICByZXNwb25zYXZlbF9tYXRyaWN1bGE6ICcxMjM0NScsXG4gICAgICAgIHN0YXR1czogU3RhdHVzVW5pZGFkZS5BVElWTyxcbiAgICAgICAgdXN1YXJpb3M6IFtdLFxuICAgICAgICAgIHNldG9yZXM6IFtdLFxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKSxcbiAgICAgICAgICByZW1vdmVkX2F0OiBudWxsXG4gICAgICAgfSxcbiAgICAgIHVzdWFyaW9zOiBbXSxcbiAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpXG4gICAgfSxcbiAgICByZWZyZXNoVG9rZW5zOiBbXVxuICB9O1xuXG4gIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgIHVzZXI6IHtcbiAgICAgIGlkOiAnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJyxcbiAgICAgIGVtYWlsOiAnam9hby5zaWx2YUBzZW10YXMubmF0YWwuZ292LmJyJyxcbiAgICAgIHJvbGU6ICdBU1NJU1RFTlRFX1NPQ0lBTCdcbiAgICB9XG4gIH07XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9ja1NlcnZpY2UgPSB7XG4gICAgICBmaW5kQWxsOiBqZXN0LmZuKCksXG4gICAgICBmaW5kQnlJZDogamVzdC5mbigpLFxuICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZVN0YXR1czogamVzdC5mbigpLFxuICAgICAgdXBkYXRlU2VuaGE6IGplc3QuZm4oKSxcbiAgICAgIHJlbW92ZTogamVzdC5mbigpLFxuICAgICAgZ2V0UHJvZmlsZTogamVzdC5mbigpLFxuICAgIH07XG5cbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgY29udHJvbGxlcnM6IFtVc3VhcmlvQ29udHJvbGxlcl0sXG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFVzdWFyaW9TZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrU2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSlcbiAgICAub3ZlcnJpZGVHdWFyZChKd3RBdXRoR3VhcmQpXG4gICAgLnVzZVZhbHVlKHsgY2FuQWN0aXZhdGU6IGplc3QuZm4oKCkgPT4gdHJ1ZSkgfSlcbiAgICAub3ZlcnJpZGVHdWFyZChQZXJtaXNzaW9uR3VhcmQpXG4gICAgLnVzZVZhbHVlKHsgY2FuQWN0aXZhdGU6IGplc3QuZm4oKCkgPT4gdHJ1ZSkgfSlcbiAgICAuY29tcGlsZSgpO1xuXG4gICAgY29udHJvbGxlciA9IG1vZHVsZS5nZXQ8VXN1YXJpb0NvbnRyb2xsZXI+KFVzdWFyaW9Db250cm9sbGVyKTtcbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldChVc3VhcmlvU2VydmljZSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmaW5kQWxsJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIGxpc3RhIGRlIHVzdcOhcmlvcyBjb20gcGFnaW5hw6fDo28nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVzdWx0ID0ge1xuICAgICAgICBpdGVtczogW21vY2tVc3VhcmlvXSxcbiAgICAgICAgbWV0YToge1xuICAgICAgICAgIHRvdGFsOiAxLFxuICAgICAgICAgIHBhZ2U6IDEsXG4gICAgICAgICAgbGltaXQ6IDEwLFxuICAgICAgICAgIHRvdGFsUGFnZXM6IDFcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgc2VydmljZS5maW5kQWxsLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXN1bHQpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRBbGwoMSwgMTAsICdKb8OjbycsICdBU1NJU1RFTlRFX1NPQ0lBTCcsICdhdGl2bycsICd1bmlkYWRlLTEyMycpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tSZXN1bHQpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZmluZEFsbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBwYWdlOiAxLFxuICAgICAgICBsaW1pdDogMTAsXG4gICAgICAgIHNlYXJjaDogJ0pvw6NvJyxcbiAgICAgICAgcm9sZTogJ0FTU0lTVEVOVEVfU09DSUFMJyxcbiAgICAgICAgc3RhdHVzOiBTdGF0dXNVbmlkYWRlLkFUSVZPLFxuICAgICAgICB1bmlkYWRlSWQ6ICd1bmlkYWRlLTEyMydcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgdXNhciB2YWxvcmVzIHBhZHLDo28gcXVhbmRvIHBhcsOibWV0cm9zIG7Do28gZm9ybmVjaWRvcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgIGl0ZW1zOiBbbW9ja1VzdWFyaW9dLFxuICAgICAgICBtZXRhOiB7XG4gICAgICAgICAgdG90YWw6IDEsXG4gICAgICAgICAgcGFnZTogMSxcbiAgICAgICAgICBsaW1pdDogMTAsXG4gICAgICAgICAgdG90YWxQYWdlczogMVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgc2VydmljZS5maW5kQWxsLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXN1bHQpO1xuXG4gICAgICBhd2FpdCBjb250cm9sbGVyLmZpbmRBbGwoKTtcblxuICAgICAgZXhwZWN0KHNlcnZpY2UuZmluZEFsbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBwYWdlOiB1bmRlZmluZWQsXG4gICAgICAgIGxpbWl0OiB1bmRlZmluZWQsXG4gICAgICAgIHNlYXJjaDogdW5kZWZpbmVkLFxuICAgICAgICByb2xlOiB1bmRlZmluZWQsXG4gICAgICAgIHN0YXR1czogdW5kZWZpbmVkLFxuICAgICAgICB1bmlkYWRlSWQ6IHVuZGVmaW5lZFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmaW5kT25lJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIHVzdcOhcmlvIHBvciBJRCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHNlcnZpY2UuZmluZEJ5SWQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzdWFyaW8pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmZpbmRPbmUoJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tVc3VhcmlvKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmZpbmRCeUlkKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRQcm9maWxlJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIHBlcmZpbCBkbyB1c3XDoXJpbyBhdHVhbCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHNlcnZpY2UuZ2V0UHJvZmlsZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXN1YXJpbyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZ2V0UHJvZmlsZShtb2NrUmVxdWVzdCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1VzdWFyaW8pO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0UHJvZmlsZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGNyaWFyIG5vdm8gdXN1w6FyaW8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjcmVhdGVEdG86IENyZWF0ZVVzdWFyaW9EdG8gPSB7XG4gICAgICAgIG5vbWU6ICdKb8OjbyBkYSBTaWx2YScsXG4gICAgICAgIGVtYWlsOiAnam9hby5zaWx2YUBzZW10YXMubmF0YWwuZ292LmJyJyxcbiAgICAgICAgc2VuaGE6ICdTZW5oYUAxMjMnLFxuICAgICAgICBjcGY6ICcxMjMuNDU2Ljc4OS0wMCcsXG4gICAgICAgIHRlbGVmb25lOiAnKDg0KSA5OTk5OS05OTk5JyxcbiAgICAgICAgbWF0cmljdWxhOiAnMTIzNDUnLFxuICAgICAgICByb2xlX2lkOiAnQVNTSVNURU5URV9TT0NJQUwnLFxuICAgICAgICB1bmlkYWRlX2lkOiAndW5pZGFkZS0xMjMnLFxuICAgICAgICBzZXRvcl9pZDogJ3NldG9yLTEyMydcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IG1vY2tSZXNwb25zZSA9IHtcbiAgICAgICAgZGF0YTogbW9ja1VzdWFyaW8sXG4gICAgICAgIG1ldGE6IG51bGwsXG4gICAgICAgIG1lc3NhZ2U6IG51bGxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIHNlcnZpY2UuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXNwb25zZSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuY3JlYXRlKGNyZWF0ZUR0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1Jlc3BvbnNlKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoY3JlYXRlRHRvKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3VwZGF0ZScsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBhdHVhbGl6YXIgdXN1w6FyaW8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1cGRhdGVEdG86IFVwZGF0ZVVzdWFyaW9EdG8gPSB7XG4gICAgICAgIG5vbWU6ICdKb8OjbyBTaWx2YSBTYW50b3MnLFxuICAgICAgICBjcGY6ICcxMjMuNDU2Ljc4OS0wMCcsXG4gICAgICAgIHRlbGVmb25lOiAnKDg0KSA4ODg4OC04ODg4J1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3QgbW9ja1Jlc3BvbnNlID0ge1xuICAgICAgICBkYXRhOiB7IC4uLm1vY2tVc3VhcmlvLCAuLi51cGRhdGVEdG8gfSxcbiAgICAgICAgbWV0YTogbnVsbCxcbiAgICAgICAgbWVzc2FnZTogbnVsbFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgc2VydmljZS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3BvbnNlKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci51cGRhdGUoJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsIHVwZGF0ZUR0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1Jlc3BvbnNlKTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcsIHVwZGF0ZUR0byk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd1cGRhdGVTdGF0dXMnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgYXR1YWxpemFyIHN0YXR1cyBkbyB1c3XDoXJpbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZVN0YXR1c0R0bzogVXBkYXRlU3RhdHVzVXN1YXJpb0R0byA9IHtcbiAgICAgICAgc3RhdHVzOiAnaW5hdGl2bydcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IHsgc2VuaGFIYXNoLCAuLi51c3VhcmlvQXR1YWxpemFkbyB9ID0geyAuLi5tb2NrVXN1YXJpbywgc3RhdHVzOiAnaW5hdGl2bycgfTtcbiAgICAgIFxuICAgICAgc2VydmljZS51cGRhdGVTdGF0dXMubW9ja1Jlc29sdmVkVmFsdWUodXN1YXJpb0F0dWFsaXphZG8pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLnVwZGF0ZVN0YXR1cygnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJywgdXBkYXRlU3RhdHVzRHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh1c3VhcmlvQXR1YWxpemFkbyk7XG4gICAgICBleHBlY3Qoc2VydmljZS51cGRhdGVTdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnLCB1cGRhdGVTdGF0dXNEdG8pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBkYXRlU2VuaGEnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgYXR1YWxpemFyIHNlbmhhIGRvIHVzdcOhcmlvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlU2VuaGFEdG86IFVwZGF0ZVNlbmhhRHRvID0ge1xuICAgICAgICBzZW5oYUF0dWFsOiAnc2VuaGFBdHVhbDEyMycsXG4gICAgICAgIG5vdmFTZW5oYTogJ25vdmFTZW5oYTEyMycsXG4gICAgICAgIGNvbmZpcm1hY2FvU2VuaGE6ICdub3ZhU2VuaGExMjMnXG4gICAgICB9O1xuICAgICAgY29uc3QgbW9ja1Jlc3BvbnNlID0geyBtZXNzYWdlOiAnU2VuaGEgYXR1YWxpemFkYSBjb20gc3VjZXNzbycgfTtcbiAgICAgIHNlcnZpY2UudXBkYXRlU2VuaGEubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3BvbnNlKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci51cGRhdGVTZW5oYSgnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAwJywgdXBkYXRlU2VuaGFEdG8sIG1vY2tSZXF1ZXN0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUmVzcG9uc2UpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UudXBkYXRlU2VuaGEpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnLCB1cGRhdGVTZW5oYUR0byk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZW1vdmUnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmVtb3ZlciB1c3XDoXJpbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXNwb25zZSA9IHsgbWVzc2FnZTogJ1VzdcOhcmlvIHJlbW92aWRvIGNvbSBzdWNlc3NvJyB9O1xuICAgICAgc2VydmljZS5yZW1vdmUubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5yZW1vdmUoJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMCcpO1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5yZW1vdmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgaXQoJ2RldmUgZXN0YXIgZGVmaW5pZG8nLCAoKSA9PiB7XG4gICAgZXhwZWN0KGNvbnRyb2xsZXIpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGl0KCdkZXZlIHRlciBzZXJ2aWNlIGluamV0YWRvJywgKCkgPT4ge1xuICAgIGV4cGVjdChzZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==