db3cef537a2d9c5dd29eaf2647e6b898
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const jwt_1 = require("@nestjs/jwt");
const config_1 = require("@nestjs/config");
const sse_service_1 = require("../services/sse.service");
const rxjs_1 = require("rxjs");
describe('SseService', () => {
    let service;
    let jwtService;
    let configService;
    const mockJwtService = {
        verifyAsync: jest.fn(),
    };
    const mockConfigService = {
        get: jest.fn((key) => {
            const config = {
                'sse.heartbeatInterval': 30000,
                'sse.connectionTimeout': 300000,
                'sse.maxConnectionsPerUser': 5,
                'sse.cleanupInterval': 60000,
            };
            return config[key];
        }),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                sse_service_1.SseService,
                {
                    provide: jwt_1.JwtService,
                    useValue: mockJwtService,
                },
                {
                    provide: config_1.ConfigService,
                    useValue: mockConfigService,
                },
            ],
        }).compile();
        service = module.get(sse_service_1.SseService);
        jwtService = module.get(jwt_1.JwtService);
        configService = module.get(config_1.ConfigService);
    });
    afterEach(() => {
        jest.clearAllMocks();
        // Limpar todas as conexões após cada teste
        service.removeAllConnections();
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('createConnection', () => {
        it('should create a new SSE connection', (done) => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            const observable = service.createConnection(userId, mockRequest);
            expect(observable).toBeInstanceOf(rxjs_1.Observable);
            // Verificar se a conexão foi adicionada
            const stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(1);
            expect(stats.activeConnections).toBe(1);
            expect(stats.connectionsByUser[userId]).toBe(1);
            done();
        });
        it('should limit connections per user', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            // Criar o máximo de conexões permitidas
            for (let i = 0; i < 5; i++) {
                service.createConnection(userId, mockRequest);
            }
            // Tentar criar uma conexão adicional
            expect(() => {
                service.createConnection(userId, mockRequest);
            }).toThrow('Máximo de conexões por usuário atingido');
        });
        it('should generate unique connection IDs', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            const connection1 = service.createConnection(userId, mockRequest);
            const connection2 = service.createConnection(userId, mockRequest);
            // As conexões devem ter IDs diferentes
            expect(connection1).not.toBe(connection2);
        });
    });
    describe('sendNotificationToUser', () => {
        it('should send notification to specific user', (done) => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            const notification = {
                id: 'notif-123',
                type: 'notification',
                data: {
                    id: 'notif-123',
                    titulo: 'Teste',
                    conteudo: 'Conteúdo de teste',
                    tipo: 'info',
                    prioridade: 'media',
                    data_criacao: new Date().toISOString(),
                    lida: false,
                },
            };
            // Criar conexão
            const observable = service.createConnection(userId, mockRequest);
            // Subscrever para receber notificações
            observable.subscribe({
                next: (event) => {
                    if (event.type === 'notification') {
                        expect(event.data.titulo).toBe('Teste');
                        done();
                    }
                },
            });
            // Enviar notificação
            const result = service.sendNotificationToUser(userId, notification);
            expect(result).toBe(true);
        });
        it('should return false when user has no connections', () => {
            const userId = 'user-without-connections';
            const notification = {
                id: 'notif-123',
                type: 'notification',
                data: {
                    id: 'notif-123',
                    titulo: 'Teste',
                    conteudo: 'Conteúdo de teste',
                    tipo: 'info',
                    prioridade: 'media',
                    data_criacao: new Date().toISOString(),
                    lida: false,
                },
            };
            const result = service.sendNotificationToUser(userId, notification);
            expect(result).toBe(false);
        });
    });
    describe('broadcastToAllUsers', () => {
        it('should send notification to all connected users', (done) => {
            const user1 = 'user-1';
            const user2 = 'user-2';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            const notification = {
                id: 'notif-broadcast',
                type: 'notification',
                data: {
                    id: 'notif-broadcast',
                    titulo: 'Broadcast',
                    conteudo: 'Mensagem para todos',
                    tipo: 'info',
                    prioridade: 'media',
                    data_criacao: new Date().toISOString(),
                    lida: false,
                },
            };
            let receivedCount = 0;
            const expectedCount = 2;
            // Criar conexões para dois usuários
            const obs1 = service.createConnection(user1, mockRequest);
            const obs2 = service.createConnection(user2, mockRequest);
            // Subscrever ambas as conexões
            [obs1, obs2].forEach((obs) => {
                obs.subscribe({
                    next: (event) => {
                        if (event.type === 'notification') {
                            receivedCount++;
                            if (receivedCount === expectedCount) {
                                done();
                            }
                        }
                    },
                });
            });
            // Enviar broadcast
            const result = service.broadcastToAllUsers(notification);
            expect(result).toBe(2); // Deve retornar o número de usuários que receberam
        });
    });
    describe('removeConnection', () => {
        it('should remove specific connection', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            // Criar conexão
            service.createConnection(userId, mockRequest);
            let stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(1);
            // Obter ID da conexão (simulado)
            const connections = service['connections'];
            const connectionId = Array.from(connections.keys())[0];
            // Remover conexão
            service.removeConnection(connectionId);
            stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(0);
            expect(stats.activeConnections).toBe(0);
        });
    });
    describe('removeUserConnections', () => {
        it('should remove all connections for a user', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            // Criar múltiplas conexões para o mesmo usuário
            service.createConnection(userId, mockRequest);
            service.createConnection(userId, mockRequest);
            service.createConnection(userId, mockRequest);
            let stats = service.getConnectionStats();
            expect(stats.connectionsByUser[userId]).toBe(3);
            // Remover todas as conexões do usuário
            const removedCount = service.removeUserConnections(userId);
            expect(removedCount).toBe(3);
            stats = service.getConnectionStats();
            expect(stats.connectionsByUser[userId]).toBeUndefined();
            expect(stats.totalConnections).toBe(0);
        });
    });
    describe('isUserConnected', () => {
        it('should return true when user has active connections', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            expect(service.isUserConnected(userId)).toBe(false);
            service.createConnection(userId, mockRequest);
            expect(service.isUserConnected(userId)).toBe(true);
        });
    });
    describe('getUserConnectionCount', () => {
        it('should return correct connection count for user', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            expect(service.getUserConnectionCount(userId)).toBe(0);
            service.createConnection(userId, mockRequest);
            expect(service.getUserConnectionCount(userId)).toBe(1);
            service.createConnection(userId, mockRequest);
            expect(service.getUserConnectionCount(userId)).toBe(2);
        });
    });
    describe('getConnectionStats', () => {
        it('should return accurate connection statistics', () => {
            const user1 = 'user-1';
            const user2 = 'user-2';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            // Estado inicial
            let stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(0);
            expect(stats.activeConnections).toBe(0);
            expect(stats.uniqueUsers).toBe(0);
            // Adicionar conexões
            service.createConnection(user1, mockRequest);
            service.createConnection(user1, mockRequest);
            service.createConnection(user2, mockRequest);
            stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(3);
            expect(stats.activeConnections).toBe(3);
            expect(stats.uniqueUsers).toBe(2);
            expect(stats.connectionsByUser[user1]).toBe(2);
            expect(stats.connectionsByUser[user2]).toBe(1);
        });
    });
    describe('heartbeat functionality', () => {
        it('should send heartbeat events', (done) => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            const observable = service.createConnection(userId, mockRequest);
            observable.subscribe({
                next: (event) => {
                    if (event.type === 'heartbeat') {
                        expect(event.data.timestamp).toBeDefined();
                        expect(event.data.server_time).toBeDefined();
                        done();
                    }
                },
            });
            // Simular envio de heartbeat
            service['sendHeartbeat']();
        });
    });
    describe('cleanup functionality', () => {
        it('should clean up inactive connections', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            // Criar conexão
            service.createConnection(userId, mockRequest);
            let stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(1);
            // Simular conexão inativa (modificar timestamp)
            const connections = service['connections'];
            const connection = Array.from(connections.values())[0];
            connection.lastActivity = new Date(Date.now() - 400000); // 6 minutos atrás
            // Executar limpeza
            service['cleanupInactiveConnections']();
            stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(0);
        });
    });
    describe('error handling', () => {
        it('should handle invalid notification data gracefully', () => {
            const userId = 'user-123';
            const invalidNotification = null;
            expect(() => {
                service.sendNotificationToUser(userId, invalidNotification);
            }).not.toThrow();
        });
        it('should handle connection errors gracefully', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            const observable = service.createConnection(userId, mockRequest);
            // Simular erro na conexão
            expect(() => {
                observable.subscribe({
                    error: (error) => {
                        expect(error).toBeDefined();
                    },
                });
            }).not.toThrow();
        });
    });
    describe('memory management', () => {
        it('should not exceed memory limits with many connections', () => {
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            // Criar muitas conexões para usuários diferentes
            for (let i = 0; i < 100; i++) {
                const userId = `user-${i}`;
                service.createConnection(userId, mockRequest);
            }
            const stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(100);
            expect(stats.uniqueUsers).toBe(100);
            // Verificar se o serviço ainda está responsivo
            expect(service.isUserConnected('user-50')).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXG5vdGlmaWNhY2FvXFx0ZXN0c1xcc3NlLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCxxQ0FBeUM7QUFDekMsMkNBQStDO0FBQy9DLHlEQUFxRDtBQUVyRCwrQkFBa0M7QUFHbEMsUUFBUSxDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUU7SUFDMUIsSUFBSSxPQUFtQixDQUFDO0lBQ3hCLElBQUksVUFBc0IsQ0FBQztJQUMzQixJQUFJLGFBQTRCLENBQUM7SUFFakMsTUFBTSxjQUFjLEdBQUc7UUFDckIsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDdkIsQ0FBQztJQUVGLE1BQU0saUJBQWlCLEdBQUc7UUFDeEIsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFXLEVBQUUsRUFBRTtZQUMzQixNQUFNLE1BQU0sR0FBRztnQkFDYix1QkFBdUIsRUFBRSxLQUFLO2dCQUM5Qix1QkFBdUIsRUFBRSxNQUFNO2dCQUMvQiwyQkFBMkIsRUFBRSxDQUFDO2dCQUM5QixxQkFBcUIsRUFBRSxLQUFLO2FBQzdCLENBQUM7WUFDRixPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNyQixDQUFDLENBQUM7S0FDSCxDQUFDO0lBRUYsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUU7Z0JBQ1Qsd0JBQVU7Z0JBQ1Y7b0JBQ0UsT0FBTyxFQUFFLGdCQUFVO29CQUNuQixRQUFRLEVBQUUsY0FBYztpQkFDekI7Z0JBQ0Q7b0JBQ0UsT0FBTyxFQUFFLHNCQUFhO29CQUN0QixRQUFRLEVBQUUsaUJBQWlCO2lCQUM1QjthQUNGO1NBQ0YsQ0FBQyxDQUFDLE9BQU8sRUFBRSxD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UUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUNqQyxFQUFFLENBQUMsdURBQXVELEVBQUUsR0FBRyxFQUFFO1lBQy9ELE1BQU0sV0FBVyxHQUFHO2dCQUNsQixFQUFFLEVBQUUsV0FBVztnQkFDZixPQUFPLEVBQUUsRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFO2FBQzdCLENBQUM7WUFFYixpREFBaUQ7WUFDakQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUM3QixNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDO2dCQUMzQixPQUFPLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQ2hELENBQUM7WUFFRCxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUMzQyxNQUFNLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3pDLE1BQU0sQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRXBDLCtDQUErQztZQUMvQyxNQUFNLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXG5vdGlmaWNhY2FvXFx0ZXN0c1xcc3NlLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IEp3dFNlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2p3dCc7XG5pbXBvcnQgeyBDb25maWdTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9jb25maWcnO1xuaW1wb3J0IHsgU3NlU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3NzZS5zZXJ2aWNlJztcbmltcG9ydCB7IFNzZU5vdGlmaWNhdGlvbiwgU3NlQ29ubmVjdGlvbiB9IGZyb20gJy4uL2ludGVyZmFjZXMvc3NlLW5vdGlmaWNhdGlvbi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgUmVxdWVzdCB9IGZyb20gJ2V4cHJlc3MnO1xuXG5kZXNjcmliZSgnU3NlU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IFNzZVNlcnZpY2U7XG4gIGxldCBqd3RTZXJ2aWNlOiBKd3RTZXJ2aWNlO1xuICBsZXQgY29uZmlnU2VydmljZTogQ29uZmlnU2VydmljZTtcblxuICBjb25zdCBtb2NrSnd0U2VydmljZSA9IHtcbiAgICB2ZXJpZnlBc3luYzogamVzdC5mbigpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tDb25maWdTZXJ2aWNlID0ge1xuICAgIGdldDogamVzdC5mbigoa2V5OiBzdHJpbmcpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgJ3NzZS5oZWFydGJlYXRJbnRlcnZhbCc6IDMwMDAwLFxuICAgICAgICAnc3NlLmNvbm5lY3Rpb25UaW1lb3V0JzogMzAwMDAwLFxuICAgICAgICAnc3NlLm1heENvbm5lY3Rpb25zUGVyVXNlcic6IDUsXG4gICAgICAgICdzc2UuY2xlYW51cEludGVydmFsJzogNjAwMDAsXG4gICAgICB9O1xuICAgICAgcmV0dXJuIGNvbmZpZ1trZXldO1xuICAgIH0pLFxuICB9O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgU3NlU2VydmljZSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IEp3dFNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tKd3RTZXJ2aWNlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQ29uZmlnU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0NvbmZpZ1NlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PFNzZVNlcnZpY2U+KFNzZVNlcnZpY2UpO1xuICAgIGp3dFNlcnZpY2UgPSBtb2R1bGUuZ2V0PEp3dFNlcnZpY2U+KEp3dFNlcnZpY2UpO1xuICAgIGNvbmZpZ1NlcnZpY2UgPSBtb2R1bGUuZ2V0PENvbmZpZ1NlcnZpY2U+KENvbmZpZ1NlcnZpY2UpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIC8vIExpbXBhciB0b2RhcyBhcyBjb25leMO1ZXMgYXDDs3MgY2FkYSB0ZXN0ZVxuICAgIHNlcnZpY2UucmVtb3ZlQWxsQ29ubmVjdGlvbnMoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBiZSBkZWZpbmVkJywgKCkgPT4ge1xuICAgIGV4cGVjdChzZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY3JlYXRlQ29ubmVjdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhIG5ldyBTU0UgY29ubmVjdGlvbicsIChkb25lKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci0xMjMnO1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyB9LFxuICAgICAgfSBhcyBSZXF1ZXN0O1xuXG4gICAgICBjb25zdCBvYnNlcnZhYmxlID0gc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXJJZCwgbW9ja1JlcXVlc3QpO1xuXG4gICAgICBleHBlY3Qob2JzZXJ2YWJsZSkudG9CZUluc3RhbmNlT2YoT2JzZXJ2YWJsZSk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciBzZSBhIGNvbmV4w6NvIGZvaSBhZGljaW9uYWRhXG4gICAgICBjb25zdCBzdGF0cyA9IHNlcnZpY2UuZ2V0Q29ubmVjdGlvblN0YXRzKCk7XG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxDb25uZWN0aW9ucykudG9CZSgxKTtcbiAgICAgIGV4cGVjdChzdGF0cy5hY3RpdmVDb25uZWN0aW9ucykudG9CZSgxKTtcbiAgICAgIGV4cGVjdChzdGF0cy5jb25uZWN0aW9uc0J5VXNlclt1c2VySWRdKS50b0JlKDEpO1xuXG4gICAgICBkb25lKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGxpbWl0IGNvbm5lY3Rpb25zIHBlciB1c2VyJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXItMTIzJztcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBpcDogJzEyNy4wLjAuMScsXG4gICAgICAgIGhlYWRlcnM6IHsgJ3VzZXItYWdlbnQnOiAndGVzdC1hZ2VudCcgfSxcbiAgICAgIH0gYXMgUmVxdWVzdDtcblxuICAgICAgLy8gQ3JpYXIgbyBtw6F4aW1vIGRlIGNvbmV4w7VlcyBwZXJtaXRpZGFzXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgICBzZXJ2aWNlLmNyZWF0ZUNvbm5lY3Rpb24odXNlcklkLCBtb2NrUmVxdWVzdCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFRlbnRhciBjcmlhciB1bWEgY29uZXjDo28gYWRpY2lvbmFsXG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICBzZXJ2aWNlLmNyZWF0ZUNvbm5lY3Rpb24odXNlcklkLCBtb2NrUmVxdWVzdCk7XG4gICAgICB9KS50b1Rocm93KCdNw6F4aW1vIGRlIGNvbmV4w7VlcyBwb3IgdXN1w6FyaW8gYXRpbmdpZG8nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgdW5pcXVlIGNvbm5lY3Rpb24gSURzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXItMTIzJztcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBpcDogJzEyNy4wLjAuMScsXG4gICAgICAgIGhlYWRlcnM6IHsgJ3VzZXItYWdlbnQnOiAndGVzdC1hZ2VudCcgfSxcbiAgICAgIH0gYXMgUmVxdWVzdDtcblxuICAgICAgY29uc3QgY29ubmVjdGlvbjEgPSBzZXJ2aWNlLmNyZWF0ZUNvbm5lY3Rpb24odXNlcklkLCBtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCBjb25uZWN0aW9uMiA9IHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VySWQsIG1vY2tSZXF1ZXN0KTtcblxuICAgICAgLy8gQXMgY29uZXjDtWVzIGRldmVtIHRlciBJRHMgZGlmZXJlbnRlc1xuICAgICAgZXhwZWN0KGNvbm5lY3Rpb24xKS5ub3QudG9CZShjb25uZWN0aW9uMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzZW5kTm90aWZpY2F0aW9uVG9Vc2VyJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2VuZCBub3RpZmljYXRpb24gdG8gc3BlY2lmaWMgdXNlcicsIChkb25lKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci0xMjMnO1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyB9LFxuICAgICAgfSBhcyBSZXF1ZXN0O1xuXG4gICAgICBjb25zdCBub3RpZmljYXRpb246IFNzZU5vdGlmaWNhdGlvbiA9IHtcbiAgICAgICAgaWQ6ICdub3RpZi0xMjMnLFxuICAgICAgICB0eXBlOiAnbm90aWZpY2F0aW9uJyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGlkOiAnbm90aWYtMTIzJyxcbiAgICAgICAgICB0aXR1bG86ICdUZXN0ZScsXG4gICAgICAgICAgY29udGV1ZG86ICdDb250ZcO6ZG8gZGUgdGVzdGUnLFxuICAgICAgICAgIHRpcG86ICdpbmZvJyxcbiAgICAgICAgICBwcmlvcmlkYWRlOiAnbWVkaWEnLFxuICAgICAgICAgIGRhdGFfY3JpYWNhbzogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGxpZGE6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgLy8gQ3JpYXIgY29uZXjDo29cbiAgICAgIGNvbnN0IG9ic2VydmFibGUgPSBzZXJ2aWNlLmNyZWF0ZUNvbm5lY3Rpb24odXNlcklkLCBtb2NrUmVxdWVzdCk7XG4gICAgICBcbiAgICAgIC8vIFN1YnNjcmV2ZXIgcGFyYSByZWNlYmVyIG5vdGlmaWNhw6fDtWVzXG4gICAgICBvYnNlcnZhYmxlLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6IChldmVudCkgPT4ge1xuICAgICAgICAgIGlmIChldmVudC50eXBlID09PSAnbm90aWZpY2F0aW9uJykge1xuICAgICAgICAgICAgZXhwZWN0KGV2ZW50LmRhdGEudGl0dWxvKS50b0JlKCdUZXN0ZScpO1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBFbnZpYXIgbm90aWZpY2HDp8Ojb1xuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS5zZW5kTm90aWZpY2F0aW9uVG9Vc2VyKHVzZXJJZCwgbm90aWZpY2F0aW9uKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSB3aGVuIHVzZXIgaGFzIG5vIGNvbm5lY3Rpb25zJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXItd2l0aG91dC1jb25uZWN0aW9ucyc7XG4gICAgICBjb25zdCBub3RpZmljYXRpb246IFNzZU5vdGlmaWNhdGlvbiA9IHtcbiAgICAgICAgaWQ6ICdub3RpZi0xMjMnLFxuICAgICAgICB0eXBlOiAnbm90aWZpY2F0aW9uJyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGlkOiAnbm90aWYtMTIzJyxcbiAgICAgICAgICB0aXR1bG86ICdUZXN0ZScsXG4gICAgICAgICAgY29udGV1ZG86ICdDb250ZcO6ZG8gZGUgdGVzdGUnLFxuICAgICAgICAgIHRpcG86ICdpbmZvJyxcbiAgICAgICAgICBwcmlvcmlkYWRlOiAnbWVkaWEnLFxuICAgICAgICAgIGRhdGFfY3JpYWNhbzogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGxpZGE6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS5zZW5kTm90aWZpY2F0aW9uVG9Vc2VyKHVzZXJJZCwgbm90aWZpY2F0aW9uKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYnJvYWRjYXN0VG9BbGxVc2VycycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNlbmQgbm90aWZpY2F0aW9uIHRvIGFsbCBjb25uZWN0ZWQgdXNlcnMnLCAoZG9uZSkgPT4ge1xuICAgICAgY29uc3QgdXNlcjEgPSAndXNlci0xJztcbiAgICAgIGNvbnN0IHVzZXIyID0gJ3VzZXItMic7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgaXA6ICcxMjcuMC4wLjEnLFxuICAgICAgICBoZWFkZXJzOiB7ICd1c2VyLWFnZW50JzogJ3Rlc3QtYWdlbnQnIH0sXG4gICAgICB9IGFzIFJlcXVlc3Q7XG5cbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbjogU3NlTm90aWZpY2F0aW9uID0ge1xuICAgICAgICBpZDogJ25vdGlmLWJyb2FkY2FzdCcsXG4gICAgICAgIHR5cGU6ICdub3RpZmljYXRpb24nLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaWQ6ICdub3RpZi1icm9hZGNhc3QnLFxuICAgICAgICAgIHRpdHVsbzogJ0Jyb2FkY2FzdCcsXG4gICAgICAgICAgY29udGV1ZG86ICdNZW5zYWdlbSBwYXJhIHRvZG9zJyxcbiAgICAgICAgICB0aXBvOiAnaW5mbycsXG4gICAgICAgICAgcHJpb3JpZGFkZTogJ21lZGlhJyxcbiAgICAgICAgICBkYXRhX2NyaWFjYW86IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBsaWRhOiBmYWxzZSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGxldCByZWNlaXZlZENvdW50ID0gMDtcbiAgICAgIGNvbnN0IGV4cGVjdGVkQ291bnQgPSAyO1xuXG4gICAgICAvLyBDcmlhciBjb25leMO1ZXMgcGFyYSBkb2lzIHVzdcOhcmlvc1xuICAgICAgY29uc3Qgb2JzMSA9IHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VyMSwgbW9ja1JlcXVlc3QpO1xuICAgICAgY29uc3Qgb2JzMiA9IHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VyMiwgbW9ja1JlcXVlc3QpO1xuXG4gICAgICAvLyBTdWJzY3JldmVyIGFtYmFzIGFzIGNvbmV4w7Vlc1xuICAgICAgW29iczEsIG9iczJdLmZvckVhY2goKG9icykgPT4ge1xuICAgICAgICBvYnMuc3Vic2NyaWJlKHtcbiAgICAgICAgICBuZXh0OiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChldmVudC50eXBlID09PSAnbm90aWZpY2F0aW9uJykge1xuICAgICAgICAgICAgICByZWNlaXZlZENvdW50Kys7XG4gICAgICAgICAgICAgIGlmIChyZWNlaXZlZENvdW50ID09PSBleHBlY3RlZENvdW50KSB7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgLy8gRW52aWFyIGJyb2FkY2FzdFxuICAgICAgY29uc3QgcmVzdWx0ID0gc2VydmljZS5icm9hZGNhc3RUb0FsbFVzZXJzKG5vdGlmaWNhdGlvbik7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKDIpOyAvLyBEZXZlIHJldG9ybmFyIG8gbsO6bWVybyBkZSB1c3XDoXJpb3MgcXVlIHJlY2ViZXJhbVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVtb3ZlQ29ubmVjdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlbW92ZSBzcGVjaWZpYyBjb25uZWN0aW9uJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXItMTIzJztcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBpcDogJzEyNy4wLjAuMScsXG4gICAgICAgIGhlYWRlcnM6IHsgJ3VzZXItYWdlbnQnOiAndGVzdC1hZ2VudCcgfSxcbiAgICAgIH0gYXMgUmVxdWVzdDtcblxuICAgICAgLy8gQ3JpYXIgY29uZXjDo29cbiAgICAgIHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VySWQsIG1vY2tSZXF1ZXN0KTtcbiAgICAgIFxuICAgICAgbGV0IHN0YXRzID0gc2VydmljZS5nZXRDb25uZWN0aW9uU3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbENvbm5lY3Rpb25zKS50b0JlKDEpO1xuXG4gICAgICAvLyBPYnRlciBJRCBkYSBjb25leMOjbyAoc2ltdWxhZG8pXG4gICAgICBjb25zdCBjb25uZWN0aW9ucyA9IHNlcnZpY2VbJ2Nvbm5lY3Rpb25zJ107XG4gICAgICBjb25zdCBjb25uZWN0aW9uSWQgPSBBcnJheS5mcm9tKGNvbm5lY3Rpb25zLmtleXMoKSlbMF07XG5cbiAgICAgIC8vIFJlbW92ZXIgY29uZXjDo29cbiAgICAgIHNlcnZpY2UucmVtb3ZlQ29ubmVjdGlvbihjb25uZWN0aW9uSWQpO1xuXG4gICAgICBzdGF0cyA9IHNlcnZpY2UuZ2V0Q29ubmVjdGlvblN0YXRzKCk7XG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxDb25uZWN0aW9ucykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChzdGF0cy5hY3RpdmVDb25uZWN0aW9ucykudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JlbW92ZVVzZXJDb25uZWN0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlbW92ZSBhbGwgY29ubmVjdGlvbnMgZm9yIGEgdXNlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyLTEyMyc7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgaXA6ICcxMjcuMC4wLjEnLFxuICAgICAgICBoZWFkZXJzOiB7ICd1c2VyLWFnZW50JzogJ3Rlc3QtYWdlbnQnIH0sXG4gICAgICB9IGFzIFJlcXVlc3Q7XG5cbiAgICAgIC8vIENyaWFyIG3Dumx0aXBsYXMgY29uZXjDtWVzIHBhcmEgbyBtZXNtbyB1c3XDoXJpb1xuICAgICAgc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXJJZCwgbW9ja1JlcXVlc3QpO1xuICAgICAgc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXJJZCwgbW9ja1JlcXVlc3QpO1xuICAgICAgc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXJJZCwgbW9ja1JlcXVlc3QpO1xuXG4gICAgICBsZXQgc3RhdHMgPSBzZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLmNvbm5lY3Rpb25zQnlVc2VyW3VzZXJJZF0pLnRvQmUoMyk7XG5cbiAgICAgIC8vIFJlbW92ZXIgdG9kYXMgYXMgY29uZXjDtWVzIGRvIHVzdcOhcmlvXG4gICAgICBjb25zdCByZW1vdmVkQ291bnQgPSBzZXJ2aWNlLnJlbW92ZVVzZXJDb25uZWN0aW9ucyh1c2VySWQpO1xuICAgICAgZXhwZWN0KHJlbW92ZWRDb3VudCkudG9CZSgzKTtcblxuICAgICAgc3RhdHMgPSBzZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLmNvbm5lY3Rpb25zQnlVc2VyW3VzZXJJZF0pLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbENvbm5lY3Rpb25zKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaXNVc2VyQ29ubmVjdGVkJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRydWUgd2hlbiB1c2VyIGhhcyBhY3RpdmUgY29ubmVjdGlvbnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci0xMjMnO1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyB9LFxuICAgICAgfSBhcyBSZXF1ZXN0O1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5pc1VzZXJDb25uZWN0ZWQodXNlcklkKSkudG9CZShmYWxzZSk7XG5cbiAgICAgIHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VySWQsIG1vY2tSZXF1ZXN0KTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmlzVXNlckNvbm5lY3RlZCh1c2VySWQpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0VXNlckNvbm5lY3Rpb25Db3VudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb3JyZWN0IGNvbm5lY3Rpb24gY291bnQgZm9yIHVzZXInLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci0xMjMnO1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyB9LFxuICAgICAgfSBhcyBSZXF1ZXN0O1xuXG4gICAgICBleHBlY3Qoc2VydmljZS5nZXRVc2VyQ29ubmVjdGlvbkNvdW50KHVzZXJJZCkpLnRvQmUoMCk7XG5cbiAgICAgIHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VySWQsIG1vY2tSZXF1ZXN0KTtcbiAgICAgIGV4cGVjdChzZXJ2aWNlLmdldFVzZXJDb25uZWN0aW9uQ291bnQodXNlcklkKSkudG9CZSgxKTtcblxuICAgICAgc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXJJZCwgbW9ja1JlcXVlc3QpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0VXNlckNvbm5lY3Rpb25Db3VudCh1c2VySWQpKS50b0JlKDIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0Q29ubmVjdGlvblN0YXRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGFjY3VyYXRlIGNvbm5lY3Rpb24gc3RhdGlzdGljcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXIxID0gJ3VzZXItMSc7XG4gICAgICBjb25zdCB1c2VyMiA9ICd1c2VyLTInO1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyB9LFxuICAgICAgfSBhcyBSZXF1ZXN0O1xuXG4gICAgICAvLyBFc3RhZG8gaW5pY2lhbFxuICAgICAgbGV0IHN0YXRzID0gc2VydmljZS5nZXRDb25uZWN0aW9uU3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbENvbm5lY3Rpb25zKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHN0YXRzLmFjdGl2ZUNvbm5lY3Rpb25zKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHN0YXRzLnVuaXF1ZVVzZXJzKS50b0JlKDApO1xuXG4gICAgICAvLyBBZGljaW9uYXIgY29uZXjDtWVzXG4gICAgICBzZXJ2aWNlLmNyZWF0ZUNvbm5lY3Rpb24odXNlcjEsIG1vY2tSZXF1ZXN0KTtcbiAgICAgIHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VyMSwgbW9ja1JlcXVlc3QpO1xuICAgICAgc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXIyLCBtb2NrUmVxdWVzdCk7XG5cbiAgICAgIHN0YXRzID0gc2VydmljZS5nZXRDb25uZWN0aW9uU3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbENvbm5lY3Rpb25zKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHN0YXRzLmFjdGl2ZUNvbm5lY3Rpb25zKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHN0YXRzLnVuaXF1ZVVzZXJzKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHN0YXRzLmNvbm5lY3Rpb25zQnlVc2VyW3VzZXIxXSkudG9CZSgyKTtcbiAgICAgIGV4cGVjdChzdGF0cy5jb25uZWN0aW9uc0J5VXNlclt1c2VyMl0pLnRvQmUoMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdoZWFydGJlYXQgZnVuY3Rpb25hbGl0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNlbmQgaGVhcnRiZWF0IGV2ZW50cycsIChkb25lKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci0xMjMnO1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyB9LFxuICAgICAgfSBhcyBSZXF1ZXN0O1xuXG4gICAgICBjb25zdCBvYnNlcnZhYmxlID0gc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXJJZCwgbW9ja1JlcXVlc3QpO1xuICAgICAgXG4gICAgICBvYnNlcnZhYmxlLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6IChldmVudCkgPT4ge1xuICAgICAgICAgIGlmIChldmVudC50eXBlID09PSAnaGVhcnRiZWF0Jykge1xuICAgICAgICAgICAgZXhwZWN0KGV2ZW50LmRhdGEudGltZXN0YW1wKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgZXhwZWN0KGV2ZW50LmRhdGEuc2VydmVyX3RpbWUpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFNpbXVsYXIgZW52aW8gZGUgaGVhcnRiZWF0XG4gICAgICBzZXJ2aWNlWydzZW5kSGVhcnRiZWF0J10oKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NsZWFudXAgZnVuY3Rpb25hbGl0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNsZWFuIHVwIGluYWN0aXZlIGNvbm5lY3Rpb25zJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXItMTIzJztcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBpcDogJzEyNy4wLjAuMScsXG4gICAgICAgIGhlYWRlcnM6IHsgJ3VzZXItYWdlbnQnOiAndGVzdC1hZ2VudCcgfSxcbiAgICAgIH0gYXMgUmVxdWVzdDtcblxuICAgICAgLy8gQ3JpYXIgY29uZXjDo29cbiAgICAgIHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VySWQsIG1vY2tSZXF1ZXN0KTtcbiAgICAgIFxuICAgICAgbGV0IHN0YXRzID0gc2VydmljZS5nZXRDb25uZWN0aW9uU3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbENvbm5lY3Rpb25zKS50b0JlKDEpO1xuXG4gICAgICAvLyBTaW11bGFyIGNvbmV4w6NvIGluYXRpdmEgKG1vZGlmaWNhciB0aW1lc3RhbXApXG4gICAgICBjb25zdCBjb25uZWN0aW9ucyA9IHNlcnZpY2VbJ2Nvbm5lY3Rpb25zJ107XG4gICAgICBjb25zdCBjb25uZWN0aW9uID0gQXJyYXkuZnJvbShjb25uZWN0aW9ucy52YWx1ZXMoKSlbMF07XG4gICAgICBjb25uZWN0aW9uLmxhc3RBY3Rpdml0eSA9IG5ldyBEYXRlKERhdGUubm93KCkgLSA0MDAwMDApOyAvLyA2IG1pbnV0b3MgYXRyw6FzXG5cbiAgICAgIC8vIEV4ZWN1dGFyIGxpbXBlemFcbiAgICAgIHNlcnZpY2VbJ2NsZWFudXBJbmFjdGl2ZUNvbm5lY3Rpb25zJ10oKTtcblxuICAgICAgc3RhdHMgPSBzZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsQ29ubmVjdGlvbnMpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdlcnJvciBoYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIG5vdGlmaWNhdGlvbiBkYXRhIGdyYWNlZnVsbHknLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci0xMjMnO1xuICAgICAgY29uc3QgaW52YWxpZE5vdGlmaWNhdGlvbiA9IG51bGwgYXMgYW55O1xuXG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICBzZXJ2aWNlLnNlbmROb3RpZmljYXRpb25Ub1VzZXIodXNlcklkLCBpbnZhbGlkTm90aWZpY2F0aW9uKTtcbiAgICAgIH0pLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25uZWN0aW9uIGVycm9ycyBncmFjZWZ1bGx5JywgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXItMTIzJztcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBpcDogJzEyNy4wLjAuMScsXG4gICAgICAgIGhlYWRlcnM6IHsgJ3VzZXItYWdlbnQnOiAndGVzdC1hZ2VudCcgfSxcbiAgICAgIH0gYXMgUmVxdWVzdDtcblxuICAgICAgY29uc3Qgb2JzZXJ2YWJsZSA9IHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VySWQsIG1vY2tSZXF1ZXN0KTtcbiAgICAgIFxuICAgICAgLy8gU2ltdWxhciBlcnJvIG5hIGNvbmV4w6NvXG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICBvYnNlcnZhYmxlLnN1YnNjcmliZSh7XG4gICAgICAgICAgZXJyb3I6IChlcnJvcikgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGVycm9yKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSkubm90LnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ21lbW9yeSBtYW5hZ2VtZW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbm90IGV4Y2VlZCBtZW1vcnkgbGltaXRzIHdpdGggbWFueSBjb25uZWN0aW9ucycsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBpcDogJzEyNy4wLjAuMScsXG4gICAgICAgIGhlYWRlcnM6IHsgJ3VzZXItYWdlbnQnOiAndGVzdC1hZ2VudCcgfSxcbiAgICAgIH0gYXMgUmVxdWVzdDtcblxuICAgICAgLy8gQ3JpYXIgbXVpdGFzIGNvbmV4w7VlcyBwYXJhIHVzdcOhcmlvcyBkaWZlcmVudGVzXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHVzZXJJZCA9IGB1c2VyLSR7aX1gO1xuICAgICAgICBzZXJ2aWNlLmNyZWF0ZUNvbm5lY3Rpb24odXNlcklkLCBtb2NrUmVxdWVzdCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN0YXRzID0gc2VydmljZS5nZXRDb25uZWN0aW9uU3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbENvbm5lY3Rpb25zKS50b0JlKDEwMCk7XG4gICAgICBleHBlY3Qoc3RhdHMudW5pcXVlVXNlcnMpLnRvQmUoMTAwKTtcblxuICAgICAgLy8gVmVyaWZpY2FyIHNlIG8gc2VydmnDp28gYWluZGEgZXN0w6EgcmVzcG9uc2l2b1xuICAgICAgZXhwZWN0KHNlcnZpY2UuaXNVc2VyQ29ubmVjdGVkKCd1c2VyLTUwJykpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9