9dfa3edc3d0ad36d14314131a4433a4f
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DadosAluguelSocial = void 0;
const typeorm_1 = require("typeorm");
const class_validator_1 = require("class-validator");
const solicitacao_entity_1 = require("./solicitacao.entity");
const enums_1 = require("../enums");
/**
 * Entidade para armazenar dados específicos do cidadão para Aluguel Social
 *
 * Armazena informações específicas necessárias para a solicitação do benefício
 * de Aluguel Social, como público prioritário, situação da moradia, etc.
 */
let DadosAluguelSocial = class DadosAluguelSocial {
    id;
    solicitacao_id;
    solicitacao;
    publico_prioritario;
    especificacoes;
    situacao_moradia_atual;
    possui_imovel_interditado;
    caso_judicializado_maria_penha;
    observacoes_adicionais;
    created_at;
    updated_at;
    removed_at;
    // Getters
    get createdAt() {
        return this.created_at;
    }
    get updatedAt() {
        return this.updated_at;
    }
    get removedAt() {
        return this.removed_at;
    }
    // Métodos Utilitários
    /**
     * Verifica se é caso de alta prioridade
     */
    isAltaPrioridade() {
        const casosAltaPrioridade = [
            enums_1.PublicoPrioritarioAluguel.MULHERES_VITIMAS_VIOLENCIA,
            enums_1.PublicoPrioritarioAluguel.ATINGIDOS_CALAMIDADE,
            enums_1.PublicoPrioritarioAluguel.SITUACAO_RISCO,
        ];
        return casosAltaPrioridade.includes(this.publico_prioritario) ||
            this.caso_judicializado_maria_penha;
    }
    /**
     * Verifica se tem especificações de vulnerabilidade
     */
    temVulnerabilidadeEspecifica() {
        if (!this.especificacoes || this.especificacoes.length === 0)
            return false;
        const vulnerabilidades = [
            enums_1.EspecificacaoAluguel.EXPLORACAO_SEXUAL,
            enums_1.EspecificacaoAluguel.VITIMA_VIOLENCIA,
            enums_1.EspecificacaoAluguel.SITUACAO_RUA,
            enums_1.EspecificacaoAluguel.DROGADICAO,
        ];
        return this.especificacoes.some(esp => vulnerabilidades.includes(esp));
    }
    /**
     * Calcula pontuação de prioridade para fila de atendimento
     */
    calcularPontuacaoPrioridade() {
        let pontuacao = 0;
        // Pontuação base por público prioritário
        switch (this.publico_prioritario) {
            case enums_1.PublicoPrioritarioAluguel.ATINGIDOS_CALAMIDADE:
                pontuacao += 100;
                break;
            case enums_1.PublicoPrioritarioAluguel.MULHERES_VITIMAS_VIOLENCIA:
                pontuacao += 90;
                break;
            case enums_1.PublicoPrioritarioAluguel.SITUACAO_RISCO:
                pontuacao += 80;
                break;
            case enums_1.PublicoPrioritarioAluguel.CRIANCAS_ADOLESCENTES:
                pontuacao += 70;
                break;
            case enums_1.PublicoPrioritarioAluguel.GESTANTES_NUTRIZES:
                pontuacao += 60;
                break;
            case enums_1.PublicoPrioritarioAluguel.IDOSOS:
                pontuacao += 50;
                break;
            case enums_1.PublicoPrioritarioAluguel.PCD:
                pontuacao += 40;
                break;
        }
        // Pontuação adicional por especificações
        if (this.especificacoes) {
            if (this.especificacoes.includes(enums_1.EspecificacaoAluguel.EXPLORACAO_SEXUAL))
                pontuacao += 50;
            if (this.especificacoes.includes(enums_1.EspecificacaoAluguel.VITIMA_VIOLENCIA))
                pontuacao += 40;
            if (this.especificacoes.includes(enums_1.EspecificacaoAluguel.SITUACAO_RUA))
                pontuacao += 30;
            if (this.especificacoes.includes(enums_1.EspecificacaoAluguel.DROGADICAO))
                pontuacao += 20;
        }
        // Pontuação por situações especiais
        if (this.caso_judicializado_maria_penha)
            pontuacao += 50;
        if (this.possui_imovel_interditado)
            pontuacao += 30;
        return pontuacao;
    }
    /**
     * Valida se os dados estão completos para submissão
     */
    validarDadosCompletos() {
        const erros = [];
        if (!this.publico_prioritario) {
            erros.push('Público prioritário é obrigatório');
        }
        if (!this.situacao_moradia_atual || this.situacao_moradia_atual.trim().length === 0) {
            erros.push('Situação da moradia atual é obrigatória');
        }
        if (this.especificacoes && this.especificacoes.length > 2) {
            erros.push('Máximo de 2 especificações permitidas');
        }
        return {
            valido: erros.length === 0,
            erros
        };
    }
};
exports.DadosAluguelSocial = DadosAluguelSocial;
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)('uuid'),
    __metadata("design:type", String)
], DadosAluguelSocial.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)(),
    (0, class_validator_1.IsNotEmpty)({ message: 'ID da solicitação é obrigatório' }),
    __metadata("design:type", String)
], DadosAluguelSocial.prototype, "solicitacao_id", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => solicitacao_entity_1.Solicitacao, { onDelete: 'CASCADE' }),
    (0, typeorm_1.JoinColumn)({ name: 'solicitacao_id' }),
    __metadata("design:type", typeof (_a = typeof solicitacao_entity_1.Solicitacao !== "undefined" && solicitacao_entity_1.Solicitacao) === "function" ? _a : Object)
], DadosAluguelSocial.prototype, "solicitacao", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'enum',
        enum: enums_1.PublicoPrioritarioAluguel,
        enumName: 'publico_prioritario_aluguel',
    }),
    (0, class_validator_1.IsNotEmpty)({ message: 'Público prioritário é obrigatório' }),
    (0, class_validator_1.IsEnum)(enums_1.PublicoPrioritarioAluguel, { message: 'Público prioritário inválido' }),
    __metadata("design:type", typeof (_b = typeof enums_1.PublicoPrioritarioAluguel !== "undefined" && enums_1.PublicoPrioritarioAluguel) === "function" ? _b : Object)
], DadosAluguelSocial.prototype, "publico_prioritario", void 0);
__decorate([
    (0, typeorm_1.Column)('simple-array', { nullable: true }),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsArray)({ message: 'Especificações devem ser um array' }),
    __metadata("design:type", Array)
], DadosAluguelSocial.prototype, "especificacoes", void 0);
__decorate([
    (0, typeorm_1.Column)('text'),
    (0, class_validator_1.IsNotEmpty)({ message: 'Situação da moradia atual é obrigatória' }),
    __metadata("design:type", String)
], DadosAluguelSocial.prototype, "situacao_moradia_atual", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: false }),
    (0, class_validator_1.IsBoolean)({ message: 'Possui imóvel interditado deve ser um booleano' }),
    __metadata("design:type", Boolean)
], DadosAluguelSocial.prototype, "possui_imovel_interditado", void 0);
__decorate([
    (0, typeorm_1.Column)({ default: false }),
    (0, class_validator_1.IsBoolean)({ message: 'Caso judicializado Lei Maria da Penha deve ser um booleano' }),
    __metadata("design:type", Boolean)
], DadosAluguelSocial.prototype, "caso_judicializado_maria_penha", void 0);
__decorate([
    (0, typeorm_1.Column)('text', { nullable: true }),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", String)
], DadosAluguelSocial.prototype, "observacoes_adicionais", void 0);
__decorate([
    (0, typeorm_1.CreateDateColumn)(),
    __metadata("design:type", typeof (_c = typeof Date !== "undefined" && Date) === "function" ? _c : Object)
], DadosAluguelSocial.prototype, "created_at", void 0);
__decorate([
    (0, typeorm_1.UpdateDateColumn)(),
    __metadata("design:type", typeof (_d = typeof Date !== "undefined" && Date) === "function" ? _d : Object)
], DadosAluguelSocial.prototype, "updated_at", void 0);
__decorate([
    (0, typeorm_1.DeleteDateColumn)(),
    __metadata("design:type", typeof (_e = typeof Date !== "undefined" && Date) === "function" ? _e : Object)
], DadosAluguelSocial.prototype, "removed_at", void 0);
exports.DadosAluguelSocial = DadosAluguelSocial = __decorate([
    (0, typeorm_1.Entity)('dados_aluguel_social'),
    (0, typeorm_1.Index)(['solicitacao_id'], { unique: true })
], DadosAluguelSocial);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGVudGl0aWVzXFxkYWRvcy1hbHVndWVsLXNvY2lhbC5lbnRpdHkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLHFDQVVpQjtBQUNqQixxREFNeUI7QUFDekIsNkRBQW1EO0FBQ25ELG9DQUEyRTtBQUUzRTs7Ozs7R0FLRztBQUdJLElBQU0sa0JBQWtCLEdBQXhCLE1BQU0sa0JBQWtCO0lBRTdCLEVBQUUsQ0FBUztJQUlYLGNBQWMsQ0FBUztJQUl2QixXQUFXLENBQWM7SUFTekIsbUJBQW1CLENBQTRCO0lBSy9DLGNBQWMsQ0FBMEI7SUFJeEMsc0JBQXNCLENBQVM7SUFJL0IseUJBQXlCLENBQVU7SUFJbkMsOEJBQThCLENBQVU7SUFJeEMsc0JBQXNCLENBQVU7SUFHaEMsVUFBVSxDQUFPO0lBR2pCLFVBQVUsQ0FBTztJQUdqQixVQUFVLENBQU87SUFFakIsVUFBVTtJQUNWLElBQUksU0FBUztRQUNYLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN6QixDQUFDO0lBRUQsSUFBSSxTQUFTO1FBQ1gsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxJQUFJLFNBQVM7UUFDWCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDekIsQ0FBQztJQUVELHNCQUFzQjtJQUV0Qjs7T0FFRztJQUNILGdCQUFnQjtRQUNkLE1BQU0sbUJBQW1CLEdBQUc7WUFDMUIsaUNBQXlCLENBQUMsMEJBQTBCO1lBQ3BELGlDQUF5QixDQUFDLG9CQUFvQjtZQUM5QyxpQ0FBeUIsQ0FBQyxjQUFjO1NBQ3pDLENBQUM7UUFFRixPQUFPLG1CQUFtQixDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDM0QsSUFBSSxDQUFDLDhCQUE4QixDQUFDO0lBQ3hDLENBQUM7SUFFRDs7T0FFRztJQUNILDRCQUE0QjtRQUMxQixJQUFJ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QUFtQyxFQUFFLENBQUM7OzBEQUNsQjtBQUl4QztJQUZDLElBQUEsZ0JBQU0sRUFBQyxNQUFNLENBQUM7SUFDZCxJQUFBLDRCQUFVLEVBQUMsRUFBRSxPQUFPLEVBQUUseUNBQXlDLEVBQUUsQ0FBQzs7a0VBQ3BDO0FBSS9CO0lBRkMsSUFBQSxnQkFBTSxFQUFDLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxDQUFDO0lBQzFCLElBQUEsMkJBQVMsRUFBQyxFQUFFLE9BQU8sRUFBRSxnREFBZ0QsRUFBRSxDQUFDOztxRUFDdEM7QUFJbkM7SUFGQyxJQUFBLGdCQUFNLEVBQUMsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLENBQUM7SUFDMUIsSUFBQSwyQkFBUyxFQUFDLEVBQUUsT0FBTyxFQUFFLDREQUE0RCxFQUFFLENBQUM7OzBFQUM3QztBQUl4QztJQUZDLElBQUEsZ0JBQU0sRUFBQyxNQUFNLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUM7SUFDbEMsSUFBQSw0QkFBVSxHQUFFOztrRUFDbUI7QUFHaEM7SUFEQyxJQUFBLDBCQUFnQixHQUFFO2tEQUNQLElBQUksb0JBQUosSUFBSTtzREFBQztBQUdqQjtJQURDLElBQUEsMEJBQWdCLEdBQUU7a0RBQ1AsSUFBSSxvQkFBSixJQUFJO3NEQUFDO0FBR2pCO0lBREMsSUFBQSwwQkFBZ0IsR0FBRTtrREFDUCxJQUFJLG9CQUFKLElBQUk7c0RBQUM7NkJBakROLGtCQUFrQjtJQUY5QixJQUFBLGdCQUFNLEVBQUMsc0JBQXNCLENBQUM7SUFDOUIsSUFBQSxlQUFLLEVBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDO0dBQy9CLGtCQUFrQixDQXFLOUIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGVudGl0aWVzXFxkYWRvcy1hbHVndWVsLXNvY2lhbC5lbnRpdHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRW50aXR5LFxuICBQcmltYXJ5R2VuZXJhdGVkQ29sdW1uLFxuICBDb2x1bW4sXG4gIENyZWF0ZURhdGVDb2x1bW4sXG4gIFVwZGF0ZURhdGVDb2x1bW4sXG4gIERlbGV0ZURhdGVDb2x1bW4sXG4gIE1hbnlUb09uZSxcbiAgSm9pbkNvbHVtbixcbiAgSW5kZXgsXG59IGZyb20gJ3R5cGVvcm0nO1xuaW1wb3J0IHtcbiAgSXNOb3RFbXB0eSxcbiAgSXNCb29sZWFuLFxuICBJc0VudW0sXG4gIElzT3B0aW9uYWwsXG4gIElzQXJyYXksXG59IGZyb20gJ2NsYXNzLXZhbGlkYXRvcic7XG5pbXBvcnQgeyBTb2xpY2l0YWNhbyB9IGZyb20gJy4vc29saWNpdGFjYW8uZW50aXR5JztcbmltcG9ydCB7IFB1YmxpY29Qcmlvcml0YXJpb0FsdWd1ZWwsIEVzcGVjaWZpY2FjYW9BbHVndWVsIH0gZnJvbSAnLi4vZW51bXMnO1xuXG4vKipcbiAqIEVudGlkYWRlIHBhcmEgYXJtYXplbmFyIGRhZG9zIGVzcGVjw61maWNvcyBkbyBjaWRhZMOjbyBwYXJhIEFsdWd1ZWwgU29jaWFsXG4gKlxuICogQXJtYXplbmEgaW5mb3JtYcOnw7VlcyBlc3BlY8OtZmljYXMgbmVjZXNzw6FyaWFzIHBhcmEgYSBzb2xpY2l0YcOnw6NvIGRvIGJlbmVmw61jaW9cbiAqIGRlIEFsdWd1ZWwgU29jaWFsLCBjb21vIHDDumJsaWNvIHByaW9yaXTDoXJpbywgc2l0dWHDp8OjbyBkYSBtb3JhZGlhLCBldGMuXG4gKi9cbkBFbnRpdHkoJ2RhZG9zX2FsdWd1ZWxfc29jaWFsJylcbkBJbmRleChbJ3NvbGljaXRhY2FvX2lkJ10sIHsgdW5pcXVlOiB0cnVlIH0pXG5leHBvcnQgY2xhc3MgRGFkb3NBbHVndWVsU29jaWFsIHtcbiAgQFByaW1hcnlHZW5lcmF0ZWRDb2x1bW4oJ3V1aWQnKVxuICBpZDogc3RyaW5nO1xuXG4gIEBDb2x1bW4oKVxuICBASXNOb3RFbXB0eSh7IG1lc3NhZ2U6ICdJRCBkYSBzb2xpY2l0YcOnw6NvIMOpIG9icmlnYXTDs3JpbycgfSlcbiAgc29saWNpdGFjYW9faWQ6IHN0cmluZztcblxuICBATWFueVRvT25lKCgpID0+IFNvbGljaXRhY2FvLCB7IG9uRGVsZXRlOiAnQ0FTQ0FERScgfSlcbiAgQEpvaW5Db2x1bW4oeyBuYW1lOiAnc29saWNpdGFjYW9faWQnIH0pXG4gIHNvbGljaXRhY2FvOiBTb2xpY2l0YWNhbztcblxuICBAQ29sdW1uKHtcbiAgICB0eXBlOiAnZW51bScsXG4gICAgZW51bTogUHVibGljb1ByaW9yaXRhcmlvQWx1Z3VlbCxcbiAgICBlbnVtTmFtZTogJ3B1YmxpY29fcHJpb3JpdGFyaW9fYWx1Z3VlbCcsXG4gIH0pXG4gIEBJc05vdEVtcHR5KHsgbWVzc2FnZTogJ1DDumJsaWNvIHByaW9yaXTDoXJpbyDDqSBvYnJpZ2F0w7NyaW8nIH0pXG4gIEBJc0VudW0oUHVibGljb1ByaW9yaXRhcmlvQWx1Z3VlbCwgeyBtZXNzYWdlOiAnUMO6YmxpY28gcHJpb3JpdMOhcmlvIGludsOhbGlkbycgfSlcbiAgcHVibGljb19wcmlvcml0YXJpbzogUHVibGljb1ByaW9yaXRhcmlvQWx1Z3VlbDtcblxuICBAQ29sdW1uKCdzaW1wbGUtYXJyYXknLCB7IG51bGxhYmxlOiB0cnVlIH0pXG4gIEBJc09wdGlvbmFsKClcbiAgQElzQXJyYXkoeyBtZXNzYWdlOiAnRXNwZWNpZmljYcOnw7VlcyBkZXZlbSBzZXIgdW0gYXJyYXknIH0pXG4gIGVzcGVjaWZpY2Fjb2VzPzogRXNwZWNpZmljYWNhb0FsdWd1ZWxbXTtcblxuICBAQ29sdW1uKCd0ZXh0JylcbiAgQElzTm90RW1wdHkoeyBtZXNzYWdlOiAnU2l0dWHDp8OjbyBkYSBtb3JhZGlhIGF0dWFsIMOpIG9icmlnYXTDs3JpYScgfSlcbiAgc2l0dWFjYW9fbW9yYWRpYV9hdHVhbDogc3RyaW5nO1xuXG4gIEBDb2x1bW4oeyBkZWZhdWx0OiBmYWxzZSB9KVxuICBASXNCb29sZWFuKHsgbWVzc2FnZTogJ1Bvc3N1aSBpbcOzdmVsIGludGVyZGl0YWRvIGRldmUgc2VyIHVtIGJvb2xlYW5vJyB9KVxuICBwb3NzdWlfaW1vdmVsX2ludGVyZGl0YWRvOiBib29sZWFuO1xuXG4gIEBDb2x1bW4oeyBkZWZhdWx0OiBmYWxzZSB9KVxuICBASXNCb29sZWFuKHsgbWVzc2FnZTogJ0Nhc28ganVkaWNpYWxpemFkbyBMZWkgTWFyaWEgZGEgUGVuaGEgZGV2ZSBzZXIgdW0gYm9vbGVhbm8nIH0pXG4gIGNhc29fanVkaWNpYWxpemFkb19tYXJpYV9wZW5oYTogYm9vbGVhbjtcblxuICBAQ29sdW1uKCd0ZXh0JywgeyBudWxsYWJsZTogdHJ1ZSB9KVxuICBASXNPcHRpb25hbCgpXG4gIG9ic2VydmFjb2VzX2FkaWNpb25haXM/OiBzdHJpbmc7XG5cbiAgQENyZWF0ZURhdGVDb2x1bW4oKVxuICBjcmVhdGVkX2F0OiBEYXRlO1xuXG4gIEBVcGRhdGVEYXRlQ29sdW1uKClcbiAgdXBkYXRlZF9hdDogRGF0ZTtcblxuICBARGVsZXRlRGF0ZUNvbHVtbigpXG4gIHJlbW92ZWRfYXQ6IERhdGU7XG5cbiAgLy8gR2V0dGVyc1xuICBnZXQgY3JlYXRlZEF0KCk6IERhdGUge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZWRfYXQ7XG4gIH1cblxuICBnZXQgdXBkYXRlZEF0KCk6IERhdGUge1xuICAgIHJldHVybiB0aGlzLnVwZGF0ZWRfYXQ7XG4gIH1cblxuICBnZXQgcmVtb3ZlZEF0KCk6IERhdGUge1xuICAgIHJldHVybiB0aGlzLnJlbW92ZWRfYXQ7XG4gIH1cblxuICAvLyBNw6l0b2RvcyBVdGlsaXTDoXJpb3NcblxuICAvKipcbiAgICogVmVyaWZpY2Egc2Ugw6kgY2FzbyBkZSBhbHRhIHByaW9yaWRhZGVcbiAgICovXG4gIGlzQWx0YVByaW9yaWRhZGUoKTogYm9vbGVhbiB7XG4gICAgY29uc3QgY2Fzb3NBbHRhUHJpb3JpZGFkZSA9IFtcbiAgICAgIFB1YmxpY29Qcmlvcml0YXJpb0FsdWd1ZWwuTVVMSEVSRVNfVklUSU1BU19WSU9MRU5DSUEsXG4gICAgICBQdWJsaWNvUHJpb3JpdGFyaW9BbHVndWVsLkFUSU5HSURPU19DQUxBTUlEQURFLFxuICAgICAgUHVibGljb1ByaW9yaXRhcmlvQWx1Z3VlbC5TSVRVQUNBT19SSVNDTyxcbiAgICBdO1xuXG4gICAgcmV0dXJuIGNhc29zQWx0YVByaW9yaWRhZGUuaW5jbHVkZXModGhpcy5wdWJsaWNvX3ByaW9yaXRhcmlvKSB8fFxuICAgICAgdGhpcy5jYXNvX2p1ZGljaWFsaXphZG9fbWFyaWFfcGVuaGE7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgdGVtIGVzcGVjaWZpY2HDp8O1ZXMgZGUgdnVsbmVyYWJpbGlkYWRlXG4gICAqL1xuICB0ZW1WdWxuZXJhYmlsaWRhZGVFc3BlY2lmaWNhKCk6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5lc3BlY2lmaWNhY29lcyB8fCB0aGlzLmVzcGVjaWZpY2Fjb2VzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgY29uc3QgdnVsbmVyYWJpbGlkYWRlcyA9IFtcbiAgICAgIEVzcGVjaWZpY2FjYW9BbHVndWVsLkVYUExPUkFDQU9fU0VYVUFMLFxuICAgICAgRXNwZWNpZmljYWNhb0FsdWd1ZWwuVklUSU1BX1ZJT0xFTkNJQSxcbiAgICAgIEVzcGVjaWZpY2FjYW9BbHVndWVsLlNJVFVBQ0FPX1JVQSxcbiAgICAgIEVzcGVjaWZpY2FjYW9BbHVndWVsLkRST0dBRElDQU8sXG4gICAgXTtcblxuICAgIHJldHVybiB0aGlzLmVzcGVjaWZpY2Fjb2VzLnNvbWUoZXNwID0+IHZ1bG5lcmFiaWxpZGFkZXMuaW5jbHVkZXMoZXNwKSk7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYSBwb250dWHDp8OjbyBkZSBwcmlvcmlkYWRlIHBhcmEgZmlsYSBkZSBhdGVuZGltZW50b1xuICAgKi9cbiAgY2FsY3VsYXJQb250dWFjYW9QcmlvcmlkYWRlKCk6IG51bWJlciB7XG4gICAgbGV0IHBvbnR1YWNhbyA9IDA7XG5cbiAgICAvLyBQb250dWHDp8OjbyBiYXNlIHBvciBww7pibGljbyBwcmlvcml0w6FyaW9cbiAgICBzd2l0Y2ggKHRoaXMucHVibGljb19wcmlvcml0YXJpbykge1xuICAgICAgY2FzZSBQdWJsaWNvUHJpb3JpdGFyaW9BbHVndWVsLkFUSU5HSURPU19DQUxBTUlEQURFOlxuICAgICAgICBwb250dWFjYW8gKz0gMTAwO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgUHVibGljb1ByaW9yaXRhcmlvQWx1Z3VlbC5NVUxIRVJFU19WSVRJTUFTX1ZJT0xFTkNJQTpcbiAgICAgICAgcG9udHVhY2FvICs9IDkwO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgUHVibGljb1ByaW9yaXRhcmlvQWx1Z3VlbC5TSVRVQUNBT19SSVNDTzpcbiAgICAgICAgcG9udHVhY2FvICs9IDgwO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgUHVibGljb1ByaW9yaXRhcmlvQWx1Z3VlbC5DUklBTkNBU19BRE9MRVNDRU5URVM6XG4gICAgICAgIHBvbnR1YWNhbyArPSA3MDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFB1YmxpY29Qcmlvcml0YXJpb0FsdWd1ZWwuR0VTVEFOVEVTX05VVFJJWkVTOlxuICAgICAgICBwb250dWFjYW8gKz0gNjA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBQdWJsaWNvUHJpb3JpdGFyaW9BbHVndWVsLklET1NPUzpcbiAgICAgICAgcG9udHVhY2FvICs9IDUwO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgUHVibGljb1ByaW9yaXRhcmlvQWx1Z3VlbC5QQ0Q6XG4gICAgICAgIHBvbnR1YWNhbyArPSA0MDtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgLy8gUG9udHVhw6fDo28gYWRpY2lvbmFsIHBvciBlc3BlY2lmaWNhw6fDtWVzXG4gICAgaWYgKHRoaXMuZXNwZWNpZmljYWNvZXMpIHtcbiAgICAgIGlmICh0aGlzLmVzcGVjaWZpY2Fjb2VzLmluY2x1ZGVzKEVzcGVjaWZpY2FjYW9BbHVndWVsLkVYUExPUkFDQU9fU0VYVUFMKSkgcG9udHVhY2FvICs9IDUwO1xuICAgICAgaWYgKHRoaXMuZXNwZWNpZmljYWNvZXMuaW5jbHVkZXMoRXNwZWNpZmljYWNhb0FsdWd1ZWwuVklUSU1BX1ZJT0xFTkNJQSkpIHBvbnR1YWNhbyArPSA0MDtcbiAgICAgIGlmICh0aGlzLmVzcGVjaWZpY2Fjb2VzLmluY2x1ZGVzKEVzcGVjaWZpY2FjYW9BbHVndWVsLlNJVFVBQ0FPX1JVQSkpIHBvbnR1YWNhbyArPSAzMDtcbiAgICAgIGlmICh0aGlzLmVzcGVjaWZpY2Fjb2VzLmluY2x1ZGVzKEVzcGVjaWZpY2FjYW9BbHVndWVsLkRST0dBRElDQU8pKSBwb250dWFjYW8gKz0gMjA7XG4gICAgfVxuXG4gICAgLy8gUG9udHVhw6fDo28gcG9yIHNpdHVhw6fDtWVzIGVzcGVjaWFpc1xuICAgIGlmICh0aGlzLmNhc29fanVkaWNpYWxpemFkb19tYXJpYV9wZW5oYSkgcG9udHVhY2FvICs9IDUwO1xuICAgIGlmICh0aGlzLnBvc3N1aV9pbW92ZWxfaW50ZXJkaXRhZG8pIHBvbnR1YWNhbyArPSAzMDtcblxuICAgIHJldHVybiBwb250dWFjYW87XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhIHNlIG9zIGRhZG9zIGVzdMOjbyBjb21wbGV0b3MgcGFyYSBzdWJtaXNzw6NvXG4gICAqL1xuICB2YWxpZGFyRGFkb3NDb21wbGV0b3MoKTogeyB2YWxpZG86IGJvb2xlYW47IGVycm9zOiBzdHJpbmdbXSB9IHtcbiAgICBjb25zdCBlcnJvczogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmICghdGhpcy5wdWJsaWNvX3ByaW9yaXRhcmlvKSB7XG4gICAgICBlcnJvcy5wdXNoKCdQw7pibGljbyBwcmlvcml0w6FyaW8gw6kgb2JyaWdhdMOzcmlvJyk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnNpdHVhY2FvX21vcmFkaWFfYXR1YWwgfHwgdGhpcy5zaXR1YWNhb19tb3JhZGlhX2F0dWFsLnRyaW0oKS5sZW5ndGggPT09IDApIHtcbiAgICAgIGVycm9zLnB1c2goJ1NpdHVhw6fDo28gZGEgbW9yYWRpYSBhdHVhbCDDqSBvYnJpZ2F0w7NyaWEnKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5lc3BlY2lmaWNhY29lcyAmJiB0aGlzLmVzcGVjaWZpY2Fjb2VzLmxlbmd0aCA+IDIpIHtcbiAgICAgIGVycm9zLnB1c2goJ03DoXhpbW8gZGUgMiBlc3BlY2lmaWNhw6fDtWVzIHBlcm1pdGlkYXMnKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdmFsaWRvOiBlcnJvcy5sZW5ndGggPT09IDAsXG4gICAgICBlcnJvc1xuICAgIH07XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=