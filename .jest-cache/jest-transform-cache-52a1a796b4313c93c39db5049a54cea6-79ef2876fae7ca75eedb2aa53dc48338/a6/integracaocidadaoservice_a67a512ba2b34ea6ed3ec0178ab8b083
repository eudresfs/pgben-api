3bec7283666428e2ee2f8fd0bba440eb
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.IntegracaoCidadaoService = void 0;
const common_1 = require("@nestjs/common");
/**
 * Serviço de integração com o módulo de Cidadão
 *
 * Implementa a comunicação entre o módulo de Pagamento e o módulo de Cidadão,
 * permitindo obter dados pessoais e informações bancárias dos beneficiários.
 *
 * @author Equipe PGBen
 */
let IntegracaoCidadaoService = class IntegracaoCidadaoService {
    // Em uma implementação real, este serviço injetaria o CidadaoService do módulo de cidadão
    // constructor(private readonly cidadaoService: CidadaoService) {}
    /**
     * Obtém dados pessoais de um cidadão pelo ID
     *
     * @param cidadaoId ID do cidadão
     * @returns Dados pessoais do cidadão
     * @throws NotFoundException se o cidadão não for encontrado
     */
    async obterDadosPessoais(cidadaoId) {
        // Em uma implementação real, chamaria o serviço de cidadão
        // const cidadao = await this.cidadaoService.findOne(cidadaoId);
        // if (!cidadao) {
        //   throw new NotFoundException('Cidadão não encontrado');
        // }
        // return {
        //   id: cidadao.id,
        //   nome: cidadao.nome,
        //   cpf: cidadao.cpf,
        //   dataNascimento: cidadao.dataNascimento,
        //   endereco: cidadao.endereco,
        //   contato: {
        //     telefone: cidadao.telefone,
        //     email: cidadao.email
        //   }
        // };
        // Implementação de mock para desenvolvimento
        console.log(`[INTEGRAÇÃO] Obtendo dados pessoais do cidadão ${cidadaoId}`);
        // Dados fictícios para desenvolvimento
        return {
            id: cidadaoId,
            nome: 'Maria da Silva',
            cpf: '123.456.789-00',
            dataNascimento: '1985-05-10',
            endereco: {
                logradouro: 'Rua das Flores',
                numero: '123',
                complemento: 'Apto 101',
                bairro: 'Centro',
                cidade: 'Natal',
                uf: 'RN',
                cep: '59000-000'
            },
            contato: {
                telefone: '(84) 98765-4321',
                email: 'maria.silva@exemplo.com'
            }
        };
    }
    /**
     * Obtém informações bancárias de um cidadão
     *
     * @param cidadaoId ID do cidadão
     * @returns Lista de informações bancárias cadastradas
     */
    async obterInformacoesBancarias(cidadaoId) {
        // Em uma implementação real, chamaria o serviço de cidadão
        // const infoBancarias = await this.cidadaoService.getInformacoesBancarias(cidadaoId);
        // if (!infoBancarias || infoBancarias.length === 0) {
        //   return [];
        // }
        // return infoBancarias.map(info => ({
        //   id: info.id,
        //   banco: info.banco,
        //   agencia: info.agencia,
        //   conta: info.conta,
        //   tipoConta: info.tipoConta,
        //   pixTipo: info.pixTipo,
        //   pixChave: this.mascaraPixChave(info.pixChave, info.pixTipo),
        //   principal: info.principal,
        //   createdAt: info.createdAt
        // }));
        // Implementação de mock para desenvolvimento
        console.log(`[INTEGRAÇÃO] Obtendo informações bancárias do cidadão ${cidadaoId}`);
        // Dados fictícios para desenvolvimento
        return [
            {
                id: 'info-bancaria-1',
                banco: '001',
                nomeBanco: 'Banco do Brasil',
                agencia: '1234',
                conta: '12345-6',
                tipoConta: 'Corrente',
                principal: true,
                createdAt: '2025-01-15T10:30:00Z'
            },
            {
                id: 'info-bancaria-2',
                pixTipo: 'email',
                pixChave: 'm****@e****.com', // mascarado para segurança
                principal: false,
                createdAt: '2025-02-20T14:45:00Z'
            },
            {
                id: 'info-bancaria-3',
                banco: '104',
                nomeBanco: 'Caixa Econômica Federal',
                agencia: '5678',
                conta: '98765-4',
                tipoConta: 'Poupança',
                principal: false,
                createdAt: '2025-03-10T09:15:00Z'
            }
        ];
    }
    /**
     * Obtém uma informação bancária específica pelo ID
     *
     * @param infoBancariaId ID da informação bancária
     * @returns Dados da informação bancária
     * @throws NotFoundException se a informação bancária não for encontrada
     */
    async obterInfoBancariaPorId(infoBancariaId) {
        // Em uma implementação real, chamaria o serviço de cidadão
        // const infoBancaria = await this.cidadaoService.getInfoBancariaPorId(infoBancariaId);
        // if (!infoBancaria) {
        //   throw new NotFoundException('Informação bancária não encontrada');
        // }
        // return {
        //   id: infoBancaria.id,
        //   banco: infoBancaria.banco,
        //   agencia: infoBancaria.agencia,
        //   conta: infoBancaria.conta,
        //   tipoConta: infoBancaria.tipoConta,
        //   pixTipo: infoBancaria.pixTipo,
        //   pixChave: infoBancaria.pixChave, // não mascarado para uso interno
        //   principal: infoBancaria.principal,
        //   cidadaoId: infoBancaria.cidadaoId,
        //   createdAt: infoBancaria.createdAt
        // };
        // Implementação de mock para desenvolvimento
        console.log(`[INTEGRAÇÃO] Obtendo informação bancária ${infoBancariaId}`);
        // Dados fictícios para desenvolvimento
        const mockInfos = {
            'info-bancaria-1': {
                id: 'info-bancaria-1',
                banco: '001',
                nomeBanco: 'Banco do Brasil',
                agencia: '1234',
                conta: '12345-6',
                tipoConta: 'Corrente',
                principal: true,
                cidadaoId: 'mock-cidadao-id',
                createdAt: '2025-01-15T10:30:00Z'
            },
            'info-bancaria-2': {
                id: 'info-bancaria-2',
                pixTipo: 'email',
                pixChave: 'maria.silva@exemplo.com', // não mascarado para uso interno
                principal: false,
                cidadaoId: 'mock-cidadao-id',
                createdAt: '2025-02-20T14:45:00Z'
            },
            'info-bancaria-3': {
                id: 'info-bancaria-3',
                banco: '104',
                nomeBanco: 'Caixa Econômica Federal',
                agencia: '5678',
                conta: '98765-4',
                tipoConta: 'Poupança',
                principal: false,
                cidadaoId: 'mock-cidadao-id',
                createdAt: '2025-03-10T09:15:00Z'
            }
        };
        if (!mockInfos[infoBancariaId]) {
            throw new common_1.NotFoundException('Informação bancária não encontrada');
        }
        return mockInfos[infoBancariaId];
    }
    /**
     * Verifica se uma informação bancária pertence a um cidadão
     *
     * @param cidadaoId ID do cidadão
     * @param infoBancariaId ID da informação bancária
     * @returns true se a informação bancária pertence ao cidadão
     */
    async verificarPropriedadeInfoBancaria(cidadaoId, infoBancariaId) {
        // Em uma implementação real, chamaria o serviço de cidadão
        // const infoBancaria = await this.cidadaoService.getInfoBancariaPorId(infoBancariaId);
        // return infoBancaria && infoBancaria.cidadaoId === cidadaoId;
        // Implementação de mock para desenvolvimento
        console.log(`[INTEGRAÇÃO] Verificando se informação bancária ${infoBancariaId} pertence ao cidadão ${cidadaoId}`);
        // Simulação de verificação
        return true;
    }
    /**
     * Verifica se um cidadão é o beneficiário de uma solicitação
     *
     * @param solicitacaoId ID da solicitação
     * @param cidadaoId ID do cidadão
     * @returns true se o cidadão é o beneficiário da solicitação
     */
    async verificarBeneficiarioSolicitacao(solicitacaoId, cidadaoId) {
        // Em uma implementação real, chamaria o serviço de solicitação
        // const solicitacao = await this.solicitacaoService.findOne(solicitacaoId);
        // return solicitacao && solicitacao.cidadaoId === cidadaoId;
        // Implementação de mock para desenvolvimento
        console.log(`[INTEGRAÇÃO] Verificando se cidadão ${cidadaoId} é beneficiário da solicitação ${solicitacaoId}`);
        // Simulação de verificação
        return true;
    }
    /**
     * Verifica se existe relação familiar entre dois cidadãos
     *
     * @param cidadaoId ID do cidadão principal
     * @param familiarId ID do familiar
     * @returns true se existe relação familiar
     */
    async verificarRelacaoFamiliar(cidadaoId, familiarId) {
        // Em uma implementação real, chamaria o serviço de cidadão
        // const relacoes = await this.cidadaoService.getRelacoesFamiliares(cidadaoId);
        // return relacoes.some(relacao => relacao.familiarId === familiarId);
        // Implementação de mock para desenvolvimento
        console.log(`[INTEGRAÇÃO] Verificando relação familiar entre ${cidadaoId} e ${familiarId}`);
        // Simulação de verificação
        return true;
    }
    /**
     * Obtém o endereço de um cidadão para entrega de benefício
     *
     * @param cidadaoId ID do cidadão
     * @returns Endereço formatado
     */
    async obterEnderecoEntrega(cidadaoId) {
        // Em uma implementação real, chamaria o serviço de cidadão
        // const cidadao = await this.cidadaoService.findOne(cidadaoId);
        // if (!cidadao || !cidadao.endereco) {
        //   throw new NotFoundException('Endereço não encontrado para o cidadão');
        // }
        // const end = cidadao.endereco;
        // return `${end.logradouro}, ${end.numero}${end.complemento ? ', ' + end.complemento : ''}, ${end.bairro}, ${end.cidade} - ${end.uf}, CEP: ${end.cep}`;
        // Implementação de mock para desenvolvimento
        console.log(`[INTEGRAÇÃO] Obtendo endereço de entrega para o cidadão ${cidadaoId}`);
        // Endereço fictício para desenvolvimento
        return 'Rua das Flores, 123, Apto 101, Centro, Natal - RN, CEP: 59000-000';
    }
    /**
     * Mascara uma chave PIX para exibição segura
     *
     * @param chave Valor da chave PIX
     * @param tipo Tipo da chave (CPF, email, telefone, aleatoria)
     * @returns Chave PIX mascarada
     */
    mascaraPixChave(chave, tipo) {
        if (!chave) {
            return '';
        }
        switch (tipo?.toLowerCase()) {
            case 'cpf':
                // Formato: ***.123.456-**
                const cpfLimpo = chave.replace(/\D/g, '');
                if (cpfLimpo.length !== 11) {
                    return '***.***.***-**';
                }
                return `***.${cpfLimpo.substr(3, 3)}.${cpfLimpo.substr(6, 3)}-**`;
            case 'email':
                // Formato: a***@d***.com
                const partes = chave.split('@');
                if (partes.length !== 2) {
                    return chave.substring(0, 1) + '***@***';
                }
                const usuario = partes[0];
                const dominio = partes[1];
                const usuarioMascarado = usuario.substring(0, 1) + '*'.repeat(Math.max(1, usuario.length - 1));
                const dominioPartes = dominio.split('.');
                const dominioNome = dominioPartes[0];
                const dominioExtensao = dominioPartes.slice(1).join('.');
                const dominioMascarado = dominioNome.substring(0, 1) + '*'.repeat(Math.max(1, dominioNome.length - 1));
                return `${usuarioMascarado}@${dominioMascarado}.${dominioExtensao}`;
            case 'telefone':
                // Formato: (00) *****-6789
                const telLimpo = chave.replace(/\D/g, '');
                if (telLimpo.length < 8) {
                    return '(**) *****-****';
                }
                return `(**) *****-${telLimpo.slice(-4)}`;
            case 'aleatoria':
                // Formato: ********-****-****-****-************
                if (chave.length < 8) {
                    return '********';
                }
                return chave.substring(0, 8) + '****' + '*'.repeat(chave.length - 12);
            default:
                // Mascaramento genérico
                if (chave.length <= 4) {
                    return '****';
                }
                return chave.substring(0, 2) + '*'.repeat(chave.length - 4) + chave.slice(-2);
        }
    }
};
exports.IntegracaoCidadaoService = IntegracaoCidadaoService;
exports.IntegracaoCidadaoService = IntegracaoCidadaoService = __decorate([
    (0, common_1.Injectable)()
], IntegracaoCidadaoService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXHBhZ2FtZW50b1xcc2VydmljZXNcXGludGVncmFjYW8tY2lkYWRhby5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLDJDQUErRDtBQUUvRDs7Ozs7OztHQU9HO0FBRUksSUFBTSx3QkFBd0IsR0FBOUIsTUFBTSx3QkFBd0I7SUFDbkMsMEZBQTBGO0lBQzFGLGtFQUFrRTtJQUVsRTs7Ozs7O09BTUc7SUFDSCxLQUFLLENBQUMsa0JBQWtCLENBQUMsU0FBaUI7UUFDeEMsMkRBQTJEO1FBQzNELGdFQUFnRTtRQUVoRSxrQkFBa0I7UUFDbEIsMkRBQTJEO1FBQzNELElBQUk7UUFFSixXQUFXO1FBQ1gsb0JBQW9CO1FBQ3BCLHdCQUF3QjtRQUN4QixzQkFBc0I7UUFDdEIsNENBQTRDO1FBQzVDLGdDQUFnQztRQUNoQyxlQUFlO1FBQ2Ysa0NBQWtDO1FBQ2xDLDJCQUEyQjtRQUMzQixNQUFNO1FBQ04sS0FBSztRQUVMLDZDQUE2QztRQUM3QyxPQUFPLENBQUMsR0FBRyxDQUFDLGtEQUFrRCxTQUFTLEVBQUUsQ0FBQyxDQUFDO1FBRTNFLHVDQUF1QztRQUN2QyxPQUFPO1lBQ0wsRUFBRSxFQUFFLFNBQVM7WUFDYixJQUFJLEVBQUUsZ0JBQWdCO1lBQ3RCLEdBQUcsRUFBRSxnQkFBZ0I7WUFDckIsY0FBYyxFQUFFLFlBQVk7WUFDNUIsUUFBUSxFQUFFO2dCQUNSLFVBQVUsRUFBRSxnQkFBZ0I7Z0JBQzVCLE1BQU0sRUFBRSxLQUFLO2dCQUNiLFdBQVcsRUFBRSxVQUFVO2dCQUN2QixNQUFNLEVBQUUsUUFBUTtnQkFDaEIsTUFBTSxFQUFFLE9BQU87Z0JBQ2YsRUFBRSxFQUFFLElBQUk7Z0JBQ1IsR0FBRyxFQUFFLFdBQVc7YUFDakI7WUFDRCxPQUFPLEVBQUU7Z0JBQ1AsUUFBUSxFQUFFLGlCQUFpQjtnQkFDM0IsS0FBSyxFQUFF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RTVDLEtBQUssV0FBVztnQkFDZCxnREFBZ0Q7Z0JBQ2hELElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztvQkFBQSxPQUFPLFVBQVUsQ0FBQztnQkFBQSxDQUFDO2dCQUUxQyxPQUFPLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLE1BQU0sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFFeEU7Z0JBQ0Usd0JBQXdCO2dCQUN4QixJQUFJLEtBQUssQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFLENBQUM7b0JBQUEsT0FBTyxNQUFNLENBQUM7Z0JBQUEsQ0FBQztnQkFFdkMsT0FBTyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xGLENBQUM7SUFDSCxDQUFDO0NBQ0YsQ0FBQTtBQXRVWSw0REFBd0I7bUNBQXhCLHdCQUF3QjtJQURwQyxJQUFBLG1CQUFVLEdBQUU7R0FDQSx3QkFBd0IsQ0FzVXBDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxtb2R1bGVzXFxwYWdhbWVudG9cXHNlcnZpY2VzXFxpbnRlZ3JhY2FvLWNpZGFkYW8uc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBOb3RGb3VuZEV4Y2VwdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcblxuLyoqXG4gKiBTZXJ2acOnbyBkZSBpbnRlZ3Jhw6fDo28gY29tIG8gbcOzZHVsbyBkZSBDaWRhZMOjb1xuICogXG4gKiBJbXBsZW1lbnRhIGEgY29tdW5pY2HDp8OjbyBlbnRyZSBvIG3Ds2R1bG8gZGUgUGFnYW1lbnRvIGUgbyBtw7NkdWxvIGRlIENpZGFkw6NvLFxuICogcGVybWl0aW5kbyBvYnRlciBkYWRvcyBwZXNzb2FpcyBlIGluZm9ybWHDp8O1ZXMgYmFuY8OhcmlhcyBkb3MgYmVuZWZpY2nDoXJpb3MuXG4gKiBcbiAqIEBhdXRob3IgRXF1aXBlIFBHQmVuXG4gKi9cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBJbnRlZ3JhY2FvQ2lkYWRhb1NlcnZpY2Uge1xuICAvLyBFbSB1bWEgaW1wbGVtZW50YcOnw6NvIHJlYWwsIGVzdGUgc2VydmnDp28gaW5qZXRhcmlhIG8gQ2lkYWRhb1NlcnZpY2UgZG8gbcOzZHVsbyBkZSBjaWRhZMOjb1xuICAvLyBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNpZGFkYW9TZXJ2aWNlOiBDaWRhZGFvU2VydmljZSkge31cblxuICAvKipcbiAgICogT2J0w6ltIGRhZG9zIHBlc3NvYWlzIGRlIHVtIGNpZGFkw6NvIHBlbG8gSURcbiAgICogXG4gICAqIEBwYXJhbSBjaWRhZGFvSWQgSUQgZG8gY2lkYWTDo29cbiAgICogQHJldHVybnMgRGFkb3MgcGVzc29haXMgZG8gY2lkYWTDo29cbiAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBzZSBvIGNpZGFkw6NvIG7Do28gZm9yIGVuY29udHJhZG9cbiAgICovXG4gIGFzeW5jIG9idGVyRGFkb3NQZXNzb2FpcyhjaWRhZGFvSWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gRW0gdW1hIGltcGxlbWVudGHDp8OjbyByZWFsLCBjaGFtYXJpYSBvIHNlcnZpw6dvIGRlIGNpZGFkw6NvXG4gICAgLy8gY29uc3QgY2lkYWRhbyA9IGF3YWl0IHRoaXMuY2lkYWRhb1NlcnZpY2UuZmluZE9uZShjaWRhZGFvSWQpO1xuICAgIFxuICAgIC8vIGlmICghY2lkYWRhbykge1xuICAgIC8vICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdDaWRhZMOjbyBuw6NvIGVuY29udHJhZG8nKTtcbiAgICAvLyB9XG4gICAgXG4gICAgLy8gcmV0dXJuIHtcbiAgICAvLyAgIGlkOiBjaWRhZGFvLmlkLFxuICAgIC8vICAgbm9tZTogY2lkYWRhby5ub21lLFxuICAgIC8vICAgY3BmOiBjaWRhZGFvLmNwZixcbiAgICAvLyAgIGRhdGFOYXNjaW1lbnRvOiBjaWRhZGFvLmRhdGFOYXNjaW1lbnRvLFxuICAgIC8vICAgZW5kZXJlY286IGNpZGFkYW8uZW5kZXJlY28sXG4gICAgLy8gICBjb250YXRvOiB7XG4gICAgLy8gICAgIHRlbGVmb25lOiBjaWRhZGFvLnRlbGVmb25lLFxuICAgIC8vICAgICBlbWFpbDogY2lkYWRhby5lbWFpbFxuICAgIC8vICAgfVxuICAgIC8vIH07XG5cbiAgICAvLyBJbXBsZW1lbnRhw6fDo28gZGUgbW9jayBwYXJhIGRlc2Vudm9sdmltZW50b1xuICAgIGNvbnNvbGUubG9nKGBbSU5URUdSQcOHw4NPXSBPYnRlbmRvIGRhZG9zIHBlc3NvYWlzIGRvIGNpZGFkw6NvICR7Y2lkYWRhb0lkfWApO1xuICAgIFxuICAgIC8vIERhZG9zIGZpY3TDrWNpb3MgcGFyYSBkZXNlbnZvbHZpbWVudG9cbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGNpZGFkYW9JZCxcbiAgICAgIG5vbWU6ICdNYXJpYSBkYSBTaWx2YScsXG4gICAgICBjcGY6ICcxMjMuNDU2Ljc4OS0wMCcsXG4gICAgICBkYXRhTmFzY2ltZW50bzogJzE5ODUtMDUtMTAnLFxuICAgICAgZW5kZXJlY286IHtcbiAgICAgICAgbG9ncmFkb3VybzogJ1J1YSBkYXMgRmxvcmVzJyxcbiAgICAgICAgbnVtZXJvOiAnMTIzJyxcbiAgICAgICAgY29tcGxlbWVudG86ICdBcHRvIDEwMScsXG4gICAgICAgIGJhaXJybzogJ0NlbnRybycsXG4gICAgICAgIGNpZGFkZTogJ05hdGFsJyxcbiAgICAgICAgdWY6ICdSTicsXG4gICAgICAgIGNlcDogJzU5MDAwLTAwMCdcbiAgICAgIH0sXG4gICAgICBjb250YXRvOiB7XG4gICAgICAgIHRlbGVmb25lOiAnKDg0KSA5ODc2NS00MzIxJyxcbiAgICAgICAgZW1haWw6ICdtYXJpYS5zaWx2YUBleGVtcGxvLmNvbSdcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIE9idMOpbSBpbmZvcm1hw6fDtWVzIGJhbmPDoXJpYXMgZGUgdW0gY2lkYWTDo29cbiAgICogXG4gICAqIEBwYXJhbSBjaWRhZGFvSWQgSUQgZG8gY2lkYWTDo29cbiAgICogQHJldHVybnMgTGlzdGEgZGUgaW5mb3JtYcOnw7VlcyBiYW5jw6FyaWFzIGNhZGFzdHJhZGFzXG4gICAqL1xuICBhc3luYyBvYnRlckluZm9ybWFjb2VzQmFuY2FyaWFzKGNpZGFkYW9JZDogc3RyaW5nKTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIC8vIEVtIHVtYSBpbXBsZW1lbnRhw6fDo28gcmVhbCwgY2hhbWFyaWEgbyBzZXJ2acOnbyBkZSBjaWRhZMOjb1xuICAgIC8vIGNvbnN0IGluZm9CYW5jYXJpYXMgPSBhd2FpdCB0aGlzLmNpZGFkYW9TZXJ2aWNlLmdldEluZm9ybWFjb2VzQmFuY2FyaWFzKGNpZGFkYW9JZCk7XG4gICAgXG4gICAgLy8gaWYgKCFpbmZvQmFuY2FyaWFzIHx8IGluZm9CYW5jYXJpYXMubGVuZ3RoID09PSAwKSB7XG4gICAgLy8gICByZXR1cm4gW107XG4gICAgLy8gfVxuICAgIFxuICAgIC8vIHJldHVybiBpbmZvQmFuY2FyaWFzLm1hcChpbmZvID0+ICh7XG4gICAgLy8gICBpZDogaW5mby5pZCxcbiAgICAvLyAgIGJhbmNvOiBpbmZvLmJhbmNvLFxuICAgIC8vICAgYWdlbmNpYTogaW5mby5hZ2VuY2lhLFxuICAgIC8vICAgY29udGE6IGluZm8uY29udGEsXG4gICAgLy8gICB0aXBvQ29udGE6IGluZm8udGlwb0NvbnRhLFxuICAgIC8vICAgcGl4VGlwbzogaW5mby5waXhUaXBvLFxuICAgIC8vICAgcGl4Q2hhdmU6IHRoaXMubWFzY2FyYVBpeENoYXZlKGluZm8ucGl4Q2hhdmUsIGluZm8ucGl4VGlwbyksXG4gICAgLy8gICBwcmluY2lwYWw6IGluZm8ucHJpbmNpcGFsLFxuICAgIC8vICAgY3JlYXRlZEF0OiBpbmZvLmNyZWF0ZWRBdFxuICAgIC8vIH0pKTtcblxuICAgIC8vIEltcGxlbWVudGHDp8OjbyBkZSBtb2NrIHBhcmEgZGVzZW52b2x2aW1lbnRvXG4gICAgY29uc29sZS5sb2coYFtJTlRFR1JBw4fDg09dIE9idGVuZG8gaW5mb3JtYcOnw7VlcyBiYW5jw6FyaWFzIGRvIGNpZGFkw6NvICR7Y2lkYWRhb0lkfWApO1xuICAgIFxuICAgIC8vIERhZG9zIGZpY3TDrWNpb3MgcGFyYSBkZXNlbnZvbHZpbWVudG9cbiAgICByZXR1cm4gW1xuICAgICAge1xuICAgICAgICBpZDogJ2luZm8tYmFuY2FyaWEtMScsXG4gICAgICAgIGJhbmNvOiAnMDAxJyxcbiAgICAgICAgbm9tZUJhbmNvOiAnQmFuY28gZG8gQnJhc2lsJyxcbiAgICAgICAgYWdlbmNpYTogJzEyMzQnLFxuICAgICAgICBjb250YTogJzEyMzQ1LTYnLFxuICAgICAgICB0aXBvQ29udGE6ICdDb3JyZW50ZScsXG4gICAgICAgIHByaW5jaXBhbDogdHJ1ZSxcbiAgICAgICAgY3JlYXRlZEF0OiAnMjAyNS0wMS0xNVQxMDozMDowMFonXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBpZDogJ2luZm8tYmFuY2FyaWEtMicsXG4gICAgICAgIHBpeFRpcG86ICdlbWFpbCcsXG4gICAgICAgIHBpeENoYXZlOiAnbSoqKipAZSoqKiouY29tJywgLy8gbWFzY2FyYWRvIHBhcmEgc2VndXJhbsOnYVxuICAgICAgICBwcmluY2lwYWw6IGZhbHNlLFxuICAgICAgICBjcmVhdGVkQXQ6ICcyMDI1LTAyLTIwVDE0OjQ1OjAwWidcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGlkOiAnaW5mby1iYW5jYXJpYS0zJyxcbiAgICAgICAgYmFuY286ICcxMDQnLFxuICAgICAgICBub21lQmFuY286ICdDYWl4YSBFY29uw7RtaWNhIEZlZGVyYWwnLFxuICAgICAgICBhZ2VuY2lhOiAnNTY3OCcsXG4gICAgICAgIGNvbnRhOiAnOTg3NjUtNCcsXG4gICAgICAgIHRpcG9Db250YTogJ1BvdXBhbsOnYScsXG4gICAgICAgIHByaW5jaXBhbDogZmFsc2UsXG4gICAgICAgIGNyZWF0ZWRBdDogJzIwMjUtMDMtMTBUMDk6MTU6MDBaJ1xuICAgICAgfVxuICAgIF07XG4gIH1cblxuICAvKipcbiAgICogT2J0w6ltIHVtYSBpbmZvcm1hw6fDo28gYmFuY8OhcmlhIGVzcGVjw61maWNhIHBlbG8gSURcbiAgICogXG4gICAqIEBwYXJhbSBpbmZvQmFuY2FyaWFJZCBJRCBkYSBpbmZvcm1hw6fDo28gYmFuY8OhcmlhXG4gICAqIEByZXR1cm5zIERhZG9zIGRhIGluZm9ybWHDp8OjbyBiYW5jw6FyaWFcbiAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBzZSBhIGluZm9ybWHDp8OjbyBiYW5jw6FyaWEgbsOjbyBmb3IgZW5jb250cmFkYVxuICAgKi9cbiAgYXN5bmMgb2J0ZXJJbmZvQmFuY2FyaWFQb3JJZChpbmZvQmFuY2FyaWFJZDogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICAvLyBFbSB1bWEgaW1wbGVtZW50YcOnw6NvIHJlYWwsIGNoYW1hcmlhIG8gc2VydmnDp28gZGUgY2lkYWTDo29cbiAgICAvLyBjb25zdCBpbmZvQmFuY2FyaWEgPSBhd2FpdCB0aGlzLmNpZGFkYW9TZXJ2aWNlLmdldEluZm9CYW5jYXJpYVBvcklkKGluZm9CYW5jYXJpYUlkKTtcbiAgICBcbiAgICAvLyBpZiAoIWluZm9CYW5jYXJpYSkge1xuICAgIC8vICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdJbmZvcm1hw6fDo28gYmFuY8OhcmlhIG7Do28gZW5jb250cmFkYScpO1xuICAgIC8vIH1cbiAgICBcbiAgICAvLyByZXR1cm4ge1xuICAgIC8vICAgaWQ6IGluZm9CYW5jYXJpYS5pZCxcbiAgICAvLyAgIGJhbmNvOiBpbmZvQmFuY2FyaWEuYmFuY28sXG4gICAgLy8gICBhZ2VuY2lhOiBpbmZvQmFuY2FyaWEuYWdlbmNpYSxcbiAgICAvLyAgIGNvbnRhOiBpbmZvQmFuY2FyaWEuY29udGEsXG4gICAgLy8gICB0aXBvQ29udGE6IGluZm9CYW5jYXJpYS50aXBvQ29udGEsXG4gICAgLy8gICBwaXhUaXBvOiBpbmZvQmFuY2FyaWEucGl4VGlwbyxcbiAgICAvLyAgIHBpeENoYXZlOiBpbmZvQmFuY2FyaWEucGl4Q2hhdmUsIC8vIG7Do28gbWFzY2FyYWRvIHBhcmEgdXNvIGludGVybm9cbiAgICAvLyAgIHByaW5jaXBhbDogaW5mb0JhbmNhcmlhLnByaW5jaXBhbCxcbiAgICAvLyAgIGNpZGFkYW9JZDogaW5mb0JhbmNhcmlhLmNpZGFkYW9JZCxcbiAgICAvLyAgIGNyZWF0ZWRBdDogaW5mb0JhbmNhcmlhLmNyZWF0ZWRBdFxuICAgIC8vIH07XG5cbiAgICAvLyBJbXBsZW1lbnRhw6fDo28gZGUgbW9jayBwYXJhIGRlc2Vudm9sdmltZW50b1xuICAgIGNvbnNvbGUubG9nKGBbSU5URUdSQcOHw4NPXSBPYnRlbmRvIGluZm9ybWHDp8OjbyBiYW5jw6FyaWEgJHtpbmZvQmFuY2FyaWFJZH1gKTtcbiAgICBcbiAgICAvLyBEYWRvcyBmaWN0w61jaW9zIHBhcmEgZGVzZW52b2x2aW1lbnRvXG4gICAgY29uc3QgbW9ja0luZm9zID0ge1xuICAgICAgJ2luZm8tYmFuY2FyaWEtMSc6IHtcbiAgICAgICAgaWQ6ICdpbmZvLWJhbmNhcmlhLTEnLFxuICAgICAgICBiYW5jbzogJzAwMScsXG4gICAgICAgIG5vbWVCYW5jbzogJ0JhbmNvIGRvIEJyYXNpbCcsXG4gICAgICAgIGFnZW5jaWE6ICcxMjM0JyxcbiAgICAgICAgY29udGE6ICcxMjM0NS02JyxcbiAgICAgICAgdGlwb0NvbnRhOiAnQ29ycmVudGUnLFxuICAgICAgICBwcmluY2lwYWw6IHRydWUsXG4gICAgICAgIGNpZGFkYW9JZDogJ21vY2stY2lkYWRhby1pZCcsXG4gICAgICAgIGNyZWF0ZWRBdDogJzIwMjUtMDEtMTVUMTA6MzA6MDBaJ1xuICAgICAgfSxcbiAgICAgICdpbmZvLWJhbmNhcmlhLTInOiB7XG4gICAgICAgIGlkOiAnaW5mby1iYW5jYXJpYS0yJyxcbiAgICAgICAgcGl4VGlwbzogJ2VtYWlsJyxcbiAgICAgICAgcGl4Q2hhdmU6ICdtYXJpYS5zaWx2YUBleGVtcGxvLmNvbScsIC8vIG7Do28gbWFzY2FyYWRvIHBhcmEgdXNvIGludGVybm9cbiAgICAgICAgcHJpbmNpcGFsOiBmYWxzZSxcbiAgICAgICAgY2lkYWRhb0lkOiAnbW9jay1jaWRhZGFvLWlkJyxcbiAgICAgICAgY3JlYXRlZEF0OiAnMjAyNS0wMi0yMFQxNDo0NTowMFonXG4gICAgICB9LFxuICAgICAgJ2luZm8tYmFuY2FyaWEtMyc6IHtcbiAgICAgICAgaWQ6ICdpbmZvLWJhbmNhcmlhLTMnLFxuICAgICAgICBiYW5jbzogJzEwNCcsXG4gICAgICAgIG5vbWVCYW5jbzogJ0NhaXhhIEVjb27DtG1pY2EgRmVkZXJhbCcsXG4gICAgICAgIGFnZW5jaWE6ICc1Njc4JyxcbiAgICAgICAgY29udGE6ICc5ODc2NS00JyxcbiAgICAgICAgdGlwb0NvbnRhOiAnUG91cGFuw6dhJyxcbiAgICAgICAgcHJpbmNpcGFsOiBmYWxzZSxcbiAgICAgICAgY2lkYWRhb0lkOiAnbW9jay1jaWRhZGFvLWlkJyxcbiAgICAgICAgY3JlYXRlZEF0OiAnMjAyNS0wMy0xMFQwOToxNTowMFonXG4gICAgICB9XG4gICAgfTtcbiAgICBcbiAgICBpZiAoIW1vY2tJbmZvc1tpbmZvQmFuY2FyaWFJZF0pIHtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignSW5mb3JtYcOnw6NvIGJhbmPDoXJpYSBuw6NvIGVuY29udHJhZGEnKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIG1vY2tJbmZvc1tpbmZvQmFuY2FyaWFJZF07XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgdW1hIGluZm9ybWHDp8OjbyBiYW5jw6FyaWEgcGVydGVuY2UgYSB1bSBjaWRhZMOjb1xuICAgKiBcbiAgICogQHBhcmFtIGNpZGFkYW9JZCBJRCBkbyBjaWRhZMOjb1xuICAgKiBAcGFyYW0gaW5mb0JhbmNhcmlhSWQgSUQgZGEgaW5mb3JtYcOnw6NvIGJhbmPDoXJpYVxuICAgKiBAcmV0dXJucyB0cnVlIHNlIGEgaW5mb3JtYcOnw6NvIGJhbmPDoXJpYSBwZXJ0ZW5jZSBhbyBjaWRhZMOjb1xuICAgKi9cbiAgYXN5bmMgdmVyaWZpY2FyUHJvcHJpZWRhZGVJbmZvQmFuY2FyaWEoY2lkYWRhb0lkOiBzdHJpbmcsIGluZm9CYW5jYXJpYUlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAvLyBFbSB1bWEgaW1wbGVtZW50YcOnw6NvIHJlYWwsIGNoYW1hcmlhIG8gc2VydmnDp28gZGUgY2lkYWTDo29cbiAgICAvLyBjb25zdCBpbmZvQmFuY2FyaWEgPSBhd2FpdCB0aGlzLmNpZGFkYW9TZXJ2aWNlLmdldEluZm9CYW5jYXJpYVBvcklkKGluZm9CYW5jYXJpYUlkKTtcbiAgICAvLyByZXR1cm4gaW5mb0JhbmNhcmlhICYmIGluZm9CYW5jYXJpYS5jaWRhZGFvSWQgPT09IGNpZGFkYW9JZDtcblxuICAgIC8vIEltcGxlbWVudGHDp8OjbyBkZSBtb2NrIHBhcmEgZGVzZW52b2x2aW1lbnRvXG4gICAgY29uc29sZS5sb2coYFtJTlRFR1JBw4fDg09dIFZlcmlmaWNhbmRvIHNlIGluZm9ybWHDp8OjbyBiYW5jw6FyaWEgJHtpbmZvQmFuY2FyaWFJZH0gcGVydGVuY2UgYW8gY2lkYWTDo28gJHtjaWRhZGFvSWR9YCk7XG4gICAgXG4gICAgLy8gU2ltdWxhw6fDo28gZGUgdmVyaWZpY2HDp8Ojb1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIHVtIGNpZGFkw6NvIMOpIG8gYmVuZWZpY2nDoXJpbyBkZSB1bWEgc29saWNpdGHDp8Ojb1xuICAgKiBcbiAgICogQHBhcmFtIHNvbGljaXRhY2FvSWQgSUQgZGEgc29saWNpdGHDp8Ojb1xuICAgKiBAcGFyYW0gY2lkYWRhb0lkIElEIGRvIGNpZGFkw6NvXG4gICAqIEByZXR1cm5zIHRydWUgc2UgbyBjaWRhZMOjbyDDqSBvIGJlbmVmaWNpw6FyaW8gZGEgc29saWNpdGHDp8Ojb1xuICAgKi9cbiAgYXN5bmMgdmVyaWZpY2FyQmVuZWZpY2lhcmlvU29saWNpdGFjYW8oc29saWNpdGFjYW9JZDogc3RyaW5nLCBjaWRhZGFvSWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIC8vIEVtIHVtYSBpbXBsZW1lbnRhw6fDo28gcmVhbCwgY2hhbWFyaWEgbyBzZXJ2acOnbyBkZSBzb2xpY2l0YcOnw6NvXG4gICAgLy8gY29uc3Qgc29saWNpdGFjYW8gPSBhd2FpdCB0aGlzLnNvbGljaXRhY2FvU2VydmljZS5maW5kT25lKHNvbGljaXRhY2FvSWQpO1xuICAgIC8vIHJldHVybiBzb2xpY2l0YWNhbyAmJiBzb2xpY2l0YWNhby5jaWRhZGFvSWQgPT09IGNpZGFkYW9JZDtcblxuICAgIC8vIEltcGxlbWVudGHDp8OjbyBkZSBtb2NrIHBhcmEgZGVzZW52b2x2aW1lbnRvXG4gICAgY29uc29sZS5sb2coYFtJTlRFR1JBw4fDg09dIFZlcmlmaWNhbmRvIHNlIGNpZGFkw6NvICR7Y2lkYWRhb0lkfSDDqSBiZW5lZmljacOhcmlvIGRhIHNvbGljaXRhw6fDo28gJHtzb2xpY2l0YWNhb0lkfWApO1xuICAgIFxuICAgIC8vIFNpbXVsYcOnw6NvIGRlIHZlcmlmaWNhw6fDo29cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBleGlzdGUgcmVsYcOnw6NvIGZhbWlsaWFyIGVudHJlIGRvaXMgY2lkYWTDo29zXG4gICAqIFxuICAgKiBAcGFyYW0gY2lkYWRhb0lkIElEIGRvIGNpZGFkw6NvIHByaW5jaXBhbFxuICAgKiBAcGFyYW0gZmFtaWxpYXJJZCBJRCBkbyBmYW1pbGlhclxuICAgKiBAcmV0dXJucyB0cnVlIHNlIGV4aXN0ZSByZWxhw6fDo28gZmFtaWxpYXJcbiAgICovXG4gIGFzeW5jIHZlcmlmaWNhclJlbGFjYW9GYW1pbGlhcihjaWRhZGFvSWQ6IHN0cmluZywgZmFtaWxpYXJJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgLy8gRW0gdW1hIGltcGxlbWVudGHDp8OjbyByZWFsLCBjaGFtYXJpYSBvIHNlcnZpw6dvIGRlIGNpZGFkw6NvXG4gICAgLy8gY29uc3QgcmVsYWNvZXMgPSBhd2FpdCB0aGlzLmNpZGFkYW9TZXJ2aWNlLmdldFJlbGFjb2VzRmFtaWxpYXJlcyhjaWRhZGFvSWQpO1xuICAgIC8vIHJldHVybiByZWxhY29lcy5zb21lKHJlbGFjYW8gPT4gcmVsYWNhby5mYW1pbGlhcklkID09PSBmYW1pbGlhcklkKTtcblxuICAgIC8vIEltcGxlbWVudGHDp8OjbyBkZSBtb2NrIHBhcmEgZGVzZW52b2x2aW1lbnRvXG4gICAgY29uc29sZS5sb2coYFtJTlRFR1JBw4fDg09dIFZlcmlmaWNhbmRvIHJlbGHDp8OjbyBmYW1pbGlhciBlbnRyZSAke2NpZGFkYW9JZH0gZSAke2ZhbWlsaWFySWR9YCk7XG4gICAgXG4gICAgLy8gU2ltdWxhw6fDo28gZGUgdmVyaWZpY2HDp8Ojb1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIE9idMOpbSBvIGVuZGVyZcOnbyBkZSB1bSBjaWRhZMOjbyBwYXJhIGVudHJlZ2EgZGUgYmVuZWbDrWNpb1xuICAgKiBcbiAgICogQHBhcmFtIGNpZGFkYW9JZCBJRCBkbyBjaWRhZMOjb1xuICAgKiBAcmV0dXJucyBFbmRlcmXDp28gZm9ybWF0YWRvXG4gICAqL1xuICBhc3luYyBvYnRlckVuZGVyZWNvRW50cmVnYShjaWRhZGFvSWQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgLy8gRW0gdW1hIGltcGxlbWVudGHDp8OjbyByZWFsLCBjaGFtYXJpYSBvIHNlcnZpw6dvIGRlIGNpZGFkw6NvXG4gICAgLy8gY29uc3QgY2lkYWRhbyA9IGF3YWl0IHRoaXMuY2lkYWRhb1NlcnZpY2UuZmluZE9uZShjaWRhZGFvSWQpO1xuICAgIFxuICAgIC8vIGlmICghY2lkYWRhbyB8fCAhY2lkYWRhby5lbmRlcmVjbykge1xuICAgIC8vICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdFbmRlcmXDp28gbsOjbyBlbmNvbnRyYWRvIHBhcmEgbyBjaWRhZMOjbycpO1xuICAgIC8vIH1cbiAgICBcbiAgICAvLyBjb25zdCBlbmQgPSBjaWRhZGFvLmVuZGVyZWNvO1xuICAgIC8vIHJldHVybiBgJHtlbmQubG9ncmFkb3Vyb30sICR7ZW5kLm51bWVyb30ke2VuZC5jb21wbGVtZW50byA/ICcsICcgKyBlbmQuY29tcGxlbWVudG8gOiAnJ30sICR7ZW5kLmJhaXJyb30sICR7ZW5kLmNpZGFkZX0gLSAke2VuZC51Zn0sIENFUDogJHtlbmQuY2VwfWA7XG5cbiAgICAvLyBJbXBsZW1lbnRhw6fDo28gZGUgbW9jayBwYXJhIGRlc2Vudm9sdmltZW50b1xuICAgIGNvbnNvbGUubG9nKGBbSU5URUdSQcOHw4NPXSBPYnRlbmRvIGVuZGVyZcOnbyBkZSBlbnRyZWdhIHBhcmEgbyBjaWRhZMOjbyAke2NpZGFkYW9JZH1gKTtcbiAgICBcbiAgICAvLyBFbmRlcmXDp28gZmljdMOtY2lvIHBhcmEgZGVzZW52b2x2aW1lbnRvXG4gICAgcmV0dXJuICdSdWEgZGFzIEZsb3JlcywgMTIzLCBBcHRvIDEwMSwgQ2VudHJvLCBOYXRhbCAtIFJOLCBDRVA6IDU5MDAwLTAwMCc7XG4gIH1cblxuICAvKipcbiAgICogTWFzY2FyYSB1bWEgY2hhdmUgUElYIHBhcmEgZXhpYmnDp8OjbyBzZWd1cmFcbiAgICogXG4gICAqIEBwYXJhbSBjaGF2ZSBWYWxvciBkYSBjaGF2ZSBQSVhcbiAgICogQHBhcmFtIHRpcG8gVGlwbyBkYSBjaGF2ZSAoQ1BGLCBlbWFpbCwgdGVsZWZvbmUsIGFsZWF0b3JpYSlcbiAgICogQHJldHVybnMgQ2hhdmUgUElYIG1hc2NhcmFkYVxuICAgKi9cbiAgcHJpdmF0ZSBtYXNjYXJhUGl4Q2hhdmUoY2hhdmU6IHN0cmluZywgdGlwbzogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBpZiAoIWNoYXZlKSB7cmV0dXJuICcnO31cbiAgICBcbiAgICBzd2l0Y2ggKHRpcG8/LnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgIGNhc2UgJ2NwZic6XG4gICAgICAgIC8vIEZvcm1hdG86ICoqKi4xMjMuNDU2LSoqXG4gICAgICAgIGNvbnN0IGNwZkxpbXBvID0gY2hhdmUucmVwbGFjZSgvXFxEL2csICcnKTtcbiAgICAgICAgaWYgKGNwZkxpbXBvLmxlbmd0aCAhPT0gMTEpIHtyZXR1cm4gJyoqKi4qKiouKioqLSoqJzt9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gYCoqKi4ke2NwZkxpbXBvLnN1YnN0cigzLCAzKX0uJHtjcGZMaW1wby5zdWJzdHIoNiwgMyl9LSoqYDtcbiAgICAgICAgXG4gICAgICBjYXNlICdlbWFpbCc6XG4gICAgICAgIC8vIEZvcm1hdG86IGEqKipAZCoqKi5jb21cbiAgICAgICAgY29uc3QgcGFydGVzID0gY2hhdmUuc3BsaXQoJ0AnKTtcbiAgICAgICAgaWYgKHBhcnRlcy5sZW5ndGggIT09IDIpIHtyZXR1cm4gY2hhdmUuc3Vic3RyaW5nKDAsIDEpICsgJyoqKkAqKionO31cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVzdWFyaW8gPSBwYXJ0ZXNbMF07XG4gICAgICAgIGNvbnN0IGRvbWluaW8gPSBwYXJ0ZXNbMV07XG4gICAgICAgIFxuICAgICAgICBjb25zdCB1c3VhcmlvTWFzY2FyYWRvID0gdXN1YXJpby5zdWJzdHJpbmcoMCwgMSkgKyAnKicucmVwZWF0KE1hdGgubWF4KDEsIHVzdWFyaW8ubGVuZ3RoIC0gMSkpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZG9taW5pb1BhcnRlcyA9IGRvbWluaW8uc3BsaXQoJy4nKTtcbiAgICAgICAgY29uc3QgZG9taW5pb05vbWUgPSBkb21pbmlvUGFydGVzWzBdO1xuICAgICAgICBjb25zdCBkb21pbmlvRXh0ZW5zYW8gPSBkb21pbmlvUGFydGVzLnNsaWNlKDEpLmpvaW4oJy4nKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGRvbWluaW9NYXNjYXJhZG8gPSBkb21pbmlvTm9tZS5zdWJzdHJpbmcoMCwgMSkgKyAnKicucmVwZWF0KE1hdGgubWF4KDEsIGRvbWluaW9Ob21lLmxlbmd0aCAtIDEpKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBgJHt1c3VhcmlvTWFzY2FyYWRvfUAke2RvbWluaW9NYXNjYXJhZG99LiR7ZG9taW5pb0V4dGVuc2FvfWA7XG4gICAgICAgIFxuICAgICAgY2FzZSAndGVsZWZvbmUnOlxuICAgICAgICAvLyBGb3JtYXRvOiAoMDApICoqKioqLTY3ODlcbiAgICAgICAgY29uc3QgdGVsTGltcG8gPSBjaGF2ZS5yZXBsYWNlKC9cXEQvZywgJycpO1xuICAgICAgICBpZiAodGVsTGltcG8ubGVuZ3RoIDwgOCkge3JldHVybiAnKCoqKSAqKioqKi0qKioqJzt9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gYCgqKikgKioqKiotJHt0ZWxMaW1wby5zbGljZSgtNCl9YDtcbiAgICAgICAgXG4gICAgICBjYXNlICdhbGVhdG9yaWEnOlxuICAgICAgICAvLyBGb3JtYXRvOiAqKioqKioqKi0qKioqLSoqKiotKioqKi0qKioqKioqKioqKipcbiAgICAgICAgaWYgKGNoYXZlLmxlbmd0aCA8IDgpIHtyZXR1cm4gJyoqKioqKioqJzt9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gY2hhdmUuc3Vic3RyaW5nKDAsIDgpICsgJyoqKionICsgJyonLnJlcGVhdChjaGF2ZS5sZW5ndGggLSAxMik7XG4gICAgICAgIFxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgLy8gTWFzY2FyYW1lbnRvIGdlbsOpcmljb1xuICAgICAgICBpZiAoY2hhdmUubGVuZ3RoIDw9IDQpIHtyZXR1cm4gJyoqKionO31cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBjaGF2ZS5zdWJzdHJpbmcoMCwgMikgKyAnKicucmVwZWF0KGNoYXZlLmxlbmd0aCAtIDQpICsgY2hhdmUuc2xpY2UoLTIpO1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9