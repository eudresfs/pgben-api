2490d573a229570f64f3ba615c488311
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DadosBeneficioFactoryService = void 0;
const common_1 = require("@nestjs/common");
const dados_aluguel_social_service_1 = require("./dados-aluguel-social.service");
const dados_cesta_basica_service_1 = require("./dados-cesta-basica.service");
const dados_funeral_service_1 = require("./dados-funeral.service");
const dados_natalidade_service_1 = require("./dados-natalidade.service");
const dados_beneficio_interface_1 = require("../interfaces/dados-beneficio.interface");
/**
 * Factory service para gerenciar todos os tipos de dados de benefícios
 * de forma centralizada e type-safe
 */
let DadosBeneficioFactoryService = class DadosBeneficioFactoryService {
    dadosAluguelSocialService;
    dadosCestaBasicaService;
    dadosFuneralService;
    dadosNatalidadeService;
    serviceMap;
    constructor(dadosAluguelSocialService, dadosCestaBasicaService, dadosFuneralService, dadosNatalidadeService) {
        this.dadosAluguelSocialService = dadosAluguelSocialService;
        this.dadosCestaBasicaService = dadosCestaBasicaService;
        this.dadosFuneralService = dadosFuneralService;
        this.dadosNatalidadeService = dadosNatalidadeService;
        this.serviceMap = new Map([
            [dados_beneficio_interface_1.TipoDadosBeneficio.ALUGUEL_SOCIAL, this.dadosAluguelSocialService],
            [dados_beneficio_interface_1.TipoDadosBeneficio.CESTA_BASICA, this.dadosCestaBasicaService],
            [dados_beneficio_interface_1.TipoDadosBeneficio.FUNERAL, this.dadosFuneralService],
            [dados_beneficio_interface_1.TipoDadosBeneficio.NATALIDADE, this.dadosNatalidadeService],
        ]);
    }
    /**
     * Obter o serviço apropriado para o tipo de benefício
     */
    getService(tipo) {
        const service = this.serviceMap.get(tipo);
        if (!service) {
            throw new common_1.BadRequestException(`Tipo de benefício não suportado: ${tipo}`);
        }
        return service;
    }
    /**
     * Validar se o tipo de benefício é válido
     */
    validateTipo(tipo) {
        if (!Object.values(dados_beneficio_interface_1.TipoDadosBeneficio).includes(tipo)) {
            throw new common_1.BadRequestException(`Tipo de benefício inválido: ${tipo}`);
        }
        return tipo;
    }
    /**
     * Criar dados de benefício
     */
    async create(tipo, createDto) {
        const tipoBeneficio = this.validateTipo(tipo);
        const service = this.getService(tipoBeneficio);
        return service.create(createDto);
    }
    /**
     * Buscar dados de benefício por ID
     */
    async findOne(tipo, id) {
        const tipoBeneficio = this.validateTipo(tipo);
        const service = this.getService(tipoBeneficio);
        return service.findOne(id);
    }
    /**
     * Buscar dados de benefício por solicitação
     */
    async findBySolicitacao(tipo, solicitacaoId) {
        const tipoBeneficio = this.validateTipo(tipo);
        const service = this.getService(tipoBeneficio);
        return service.findBySolicitacao(solicitacaoId);
    }
    /**
     * Atualizar dados de benefício
     */
    async update(tipo, id, updateDto) {
        const tipoBeneficio = this.validateTipo(tipo);
        const service = this.getService(tipoBeneficio);
        return service.update(id, updateDto);
    }
    /**
     * Remover dados de benefício
     */
    async remove(tipo, id) {
        const tipoBeneficio = this.validateTipo(tipo);
        const service = this.getService(tipoBeneficio);
        return service.remove(id);
    }
    /**
     * Verificar se existem dados para uma solicitação
     */
    async existsBySolicitacao(tipo, solicitacaoId) {
        const tipoBeneficio = this.validateTipo(tipo);
        const service = this.getService(tipoBeneficio);
        return service.existsBySolicitacao(solicitacaoId);
    }
    /**
     * Obter todos os tipos de benefícios suportados
     */
    getSupportedTypes() {
        return Object.values(dados_beneficio_interface_1.TipoDadosBeneficio);
    }
    /**
     * Verificar se um tipo é suportado
     */
    isTypeSupported(tipo) {
        return Object.values(dados_beneficio_interface_1.TipoDadosBeneficio).includes(tipo);
    }
    /**
     * Obter metadados do tipo de benefício
     */
    getTypeMetadata(tipo) {
        const tipoBeneficio = this.validateTipo(tipo);
        const metadata = {
            [dados_beneficio_interface_1.TipoDadosBeneficio.ALUGUEL_SOCIAL]: {
                name: 'Aluguel Social',
                description: 'Dados específicos para solicitação de Aluguel Social',
            },
            [dados_beneficio_interface_1.TipoDadosBeneficio.CESTA_BASICA]: {
                name: 'Cesta Básica',
                description: 'Dados específicos para solicitação de Cesta Básica',
            },
            [dados_beneficio_interface_1.TipoDadosBeneficio.FUNERAL]: {
                name: 'Auxílio Funeral',
                description: 'Dados específicos para solicitação de Auxílio Funeral',
            },
            [dados_beneficio_interface_1.TipoDadosBeneficio.NATALIDADE]: {
                name: 'Auxílio Natalidade',
                description: 'Dados específicos para solicitação de Auxílio Natalidade',
            },
        };
        return metadata[tipoBeneficio];
    }
};
exports.DadosBeneficioFactoryService = DadosBeneficioFactoryService;
exports.DadosBeneficioFactoryService = DadosBeneficioFactoryService = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof dados_aluguel_social_service_1.DadosAluguelSocialService !== "undefined" && dados_aluguel_social_service_1.DadosAluguelSocialService) === "function" ? _a : Object, typeof (_b = typeof dados_cesta_basica_service_1.DadosCestaBasicaService !== "undefined" && dados_cesta_basica_service_1.DadosCestaBasicaService) === "function" ? _b : Object, typeof (_c = typeof dados_funeral_service_1.DadosFuneralService !== "undefined" && dados_funeral_service_1.DadosFuneralService) === "function" ? _c : Object, typeof (_d = typeof dados_natalidade_service_1.DadosNatalidadeService !== "undefined" && dados_natalidade_service_1.DadosNatalidadeService) === "function" ? _d : Object])
], DadosBeneficioFactoryService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGJlbmVmaWNpb1xcc2VydmljZXNcXGRhZG9zLWJlbmVmaWNpby1mYWN0b3J5LnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUl3QjtBQUN4QixpRkFBMkU7QUFDM0UsNkVBQXVFO0FBQ3ZFLG1FQUE4RDtBQUM5RCx5RUFBb0U7QUFDcEUsdUZBTWlEO0FBc0JqRDs7O0dBR0c7QUFFSSxJQUFNLDRCQUE0QixHQUFsQyxNQUFNLDRCQUE0QjtJQUlwQjtJQUNBO0lBQ0E7SUFDQTtJQU5GLFVBQVUsQ0FBK0I7SUFFMUQsWUFDbUIseUJBQW9ELEVBQ3BELHVCQUFnRCxFQUNoRCxtQkFBd0MsRUFDeEMsc0JBQThDO1FBSDlDLDhCQUF5QixHQUF6Qix5QkFBeUIsQ0FBMkI7UUFDcEQsNEJBQXVCLEdBQXZCLHVCQUF1QixDQUF5QjtRQUNoRCx3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO1FBQ3hDLDJCQUFzQixHQUF0QixzQkFBc0IsQ0FBd0I7UUFFL0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLEdBQUcsQ0FBMEI7WUFDakQsQ0FBQyw4Q0FBa0IsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLHlCQUF5QixDQUFDO1lBQ25FLENBQUMsOENBQWtCLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyx1QkFBdUIsQ0FBQztZQUMvRCxDQUFDLDhDQUFrQixDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDdEQsQ0FBQyw4Q0FBa0IsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLHNCQUFzQixDQUFDO1NBQzdELENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7T0FFRztJQUNLLFVBQVUsQ0FDaEIsSUFBd0I7UUFFeEIsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxD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ZUFBZSxDQUFDLElBQVk7UUFDMUIsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLDhDQUFrQixDQUFDLENBQUMsUUFBUSxDQUMvQyxJQUEwQixDQUMzQixDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0gsZUFBZSxDQUFDLElBQVk7UUFDMUIsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUU5QyxNQUFNLFFBQVEsR0FBRztZQUNmLENBQUMsOENBQWtCLENBQUMsY0FBYyxDQUFDLEVBQUU7Z0JBQ25DLElBQUksRUFBRSxnQkFBZ0I7Z0JBQ3RCLFdBQVcsRUFBRSxzREFBc0Q7YUFDcEU7WUFDRCxDQUFDLDhDQUFrQixDQUFDLFlBQVksQ0FBQyxFQUFFO2dCQUNqQyxJQUFJLEVBQUUsY0FBYztnQkFDcEIsV0FBVyxFQUFFLG9EQUFvRDthQUNsRTtZQUNELENBQUMsOENBQWtCLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQzVCLElBQUksRUFBRSxpQkFBaUI7Z0JBQ3ZCLFdBQVcsRUFBRSx1REFBdUQ7YUFDckU7WUFDRCxDQUFDLDhDQUFrQixDQUFDLFVBQVUsQ0FBQyxFQUFFO2dCQUMvQixJQUFJLEVBQUUsb0JBQW9CO2dCQUMxQixXQUFXLEVBQUUsMERBQTBEO2FBQ3hFO1NBQ0YsQ0FBQztRQUVGLE9BQU8sUUFBUSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ2pDLENBQUM7Q0FDRixDQUFBO0FBeEpZLG9FQUE0Qjt1Q0FBNUIsNEJBQTRCO0lBRHhDLElBQUEsbUJBQVUsR0FBRTt5REFLbUMsd0RBQXlCLG9CQUF6Qix3REFBeUIsb0RBQzNCLG9EQUF1QixvQkFBdkIsb0RBQXVCLG9EQUMzQiwyQ0FBbUIsb0JBQW5CLDJDQUFtQixvREFDaEIsaURBQXNCLG9CQUF0QixpREFBc0I7R0FQdEQsNEJBQTRCLENBd0p4QyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xcYmVuZWZpY2lvXFxzZXJ2aWNlc1xcZGFkb3MtYmVuZWZpY2lvLWZhY3Rvcnkuc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBJbmplY3RhYmxlLFxuICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgRGFkb3NBbHVndWVsU29jaWFsU2VydmljZSB9IGZyb20gJy4vZGFkb3MtYWx1Z3VlbC1zb2NpYWwuc2VydmljZSc7XG5pbXBvcnQgeyBEYWRvc0Nlc3RhQmFzaWNhU2VydmljZSB9IGZyb20gJy4vZGFkb3MtY2VzdGEtYmFzaWNhLnNlcnZpY2UnO1xuaW1wb3J0IHsgRGFkb3NGdW5lcmFsU2VydmljZSB9IGZyb20gJy4vZGFkb3MtZnVuZXJhbC5zZXJ2aWNlJztcbmltcG9ydCB7IERhZG9zTmF0YWxpZGFkZVNlcnZpY2UgfSBmcm9tICcuL2RhZG9zLW5hdGFsaWRhZGUuc2VydmljZSc7XG5pbXBvcnQge1xuICBUaXBvRGFkb3NCZW5lZmljaW8sXG4gIElEYWRvc0JlbmVmaWNpbyxcbiAgSUNyZWF0ZURhZG9zQmVuZWZpY2lvRHRvLFxuICBJVXBkYXRlRGFkb3NCZW5lZmljaW9EdG8sXG4gIElEYWRvc0JlbmVmaWNpb1NlcnZpY2UsXG59IGZyb20gJy4uL2ludGVyZmFjZXMvZGFkb3MtYmVuZWZpY2lvLmludGVyZmFjZSc7XG5pbXBvcnQgeyBEYWRvc0FsdWd1ZWxTb2NpYWwgfSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy9kYWRvcy1hbHVndWVsLXNvY2lhbC5lbnRpdHknO1xuaW1wb3J0IHsgRGFkb3NDZXN0YUJhc2ljYSB9IGZyb20gJy4uLy4uLy4uL2VudGl0aWVzL2RhZG9zLWNlc3RhLWJhc2ljYS5lbnRpdHknO1xuaW1wb3J0IHsgRGFkb3NGdW5lcmFsIH0gZnJvbSAnLi4vLi4vLi4vZW50aXRpZXMvZGFkb3MtZnVuZXJhbC5lbnRpdHknO1xuaW1wb3J0IHsgRGFkb3NOYXRhbGlkYWRlIH0gZnJvbSAnLi4vLi4vLi4vZW50aXRpZXMvZGFkb3MtbmF0YWxpZGFkZS5lbnRpdHknO1xuaW1wb3J0IHtcbiAgQ3JlYXRlRGFkb3NBbHVndWVsU29jaWFsRHRvLFxuICBVcGRhdGVEYWRvc0FsdWd1ZWxTb2NpYWxEdG8sXG59IGZyb20gJy4uL2R0by9jcmVhdGUtZGFkb3MtYWx1Z3VlbC1zb2NpYWwuZHRvJztcbmltcG9ydCB7XG4gIENyZWF0ZURhZG9zQ2VzdGFCYXNpY2FEdG8sXG4gIFVwZGF0ZURhZG9zQ2VzdGFCYXNpY2FEdG8sXG59IGZyb20gJy4uL2R0by9jcmVhdGUtZGFkb3MtY2VzdGEtYmFzaWNhLmR0byc7XG5pbXBvcnQge1xuICBDcmVhdGVEYWRvc0Z1bmVyYWxEdG8sXG4gIFVwZGF0ZURhZG9zRnVuZXJhbER0byxcbn0gZnJvbSAnLi4vZHRvL2NyZWF0ZS1kYWRvcy1mdW5lcmFsLmR0byc7XG5pbXBvcnQge1xuICBDcmVhdGVEYWRvc05hdGFsaWRhZGVEdG8sXG4gIFVwZGF0ZURhZG9zTmF0YWxpZGFkZUR0byxcbn0gZnJvbSAnLi4vZHRvL2NyZWF0ZS1kYWRvcy1uYXRhbGlkYWRlLmR0byc7XG5cbi8qKlxuICogRmFjdG9yeSBzZXJ2aWNlIHBhcmEgZ2VyZW5jaWFyIHRvZG9zIG9zIHRpcG9zIGRlIGRhZG9zIGRlIGJlbmVmw61jaW9zXG4gKiBkZSBmb3JtYSBjZW50cmFsaXphZGEgZSB0eXBlLXNhZmVcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIERhZG9zQmVuZWZpY2lvRmFjdG9yeVNlcnZpY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IHNlcnZpY2VNYXA6IE1hcDxUaXBvRGFkb3NCZW5lZmljaW8sIGFueT47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBkYWRvc0FsdWd1ZWxTb2NpYWxTZXJ2aWNlOiBEYWRvc0FsdWd1ZWxTb2NpYWxTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGFkb3NDZXN0YUJhc2ljYVNlcnZpY2U6IERhZG9zQ2VzdGFCYXNpY2FTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGFkb3NGdW5lcmFsU2VydmljZTogRGFkb3NGdW5lcmFsU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGRhZG9zTmF0YWxpZGFkZVNlcnZpY2U6IERhZG9zTmF0YWxpZGFkZVNlcnZpY2UsXG4gICkge1xuICAgIHRoaXMuc2VydmljZU1hcCA9IG5ldyBNYXA8VGlwb0RhZG9zQmVuZWZpY2lvLCBhbnk+KFtcbiAgICAgIFtUaXBvRGFkb3NCZW5lZmljaW8uQUxVR1VFTF9TT0NJQUwsIHRoaXMuZGFkb3NBbHVndWVsU29jaWFsU2VydmljZV0sXG4gICAgICBbVGlwb0RhZG9zQmVuZWZpY2lvLkNFU1RBX0JBU0lDQSwgdGhpcy5kYWRvc0Nlc3RhQmFzaWNhU2VydmljZV0sXG4gICAgICBbVGlwb0RhZG9zQmVuZWZpY2lvLkZVTkVSQUwsIHRoaXMuZGFkb3NGdW5lcmFsU2VydmljZV0sXG4gICAgICBbVGlwb0RhZG9zQmVuZWZpY2lvLk5BVEFMSURBREUsIHRoaXMuZGFkb3NOYXRhbGlkYWRlU2VydmljZV0sXG4gICAgXSk7XG4gIH1cblxuICAvKipcbiAgICogT2J0ZXIgbyBzZXJ2acOnbyBhcHJvcHJpYWRvIHBhcmEgbyB0aXBvIGRlIGJlbmVmw61jaW9cbiAgICovXG4gIHByaXZhdGUgZ2V0U2VydmljZShcbiAgICB0aXBvOiBUaXBvRGFkb3NCZW5lZmljaW8sXG4gICk6IElEYWRvc0JlbmVmaWNpb1NlcnZpY2U8YW55LCBhbnksIGFueT4ge1xuICAgIGNvbnN0IHNlcnZpY2UgPSB0aGlzLnNlcnZpY2VNYXAuZ2V0KHRpcG8pO1xuICAgIGlmICghc2VydmljZSkge1xuICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oYFRpcG8gZGUgYmVuZWbDrWNpbyBuw6NvIHN1cG9ydGFkbzogJHt0aXBvfWApO1xuICAgIH1cbiAgICByZXR1cm4gc2VydmljZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGFyIHNlIG8gdGlwbyBkZSBiZW5lZsOtY2lvIMOpIHbDoWxpZG9cbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVUaXBvKHRpcG86IHN0cmluZyk6IFRpcG9EYWRvc0JlbmVmaWNpbyB7XG4gICAgaWYgKFxuICAgICAgIU9iamVjdC52YWx1ZXMoVGlwb0RhZG9zQmVuZWZpY2lvKS5pbmNsdWRlcyh0aXBvIGFzIFRpcG9EYWRvc0JlbmVmaWNpbylcbiAgICApIHtcbiAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKGBUaXBvIGRlIGJlbmVmw61jaW8gaW52w6FsaWRvOiAke3RpcG99YCk7XG4gICAgfVxuICAgIHJldHVybiB0aXBvIGFzIFRpcG9EYWRvc0JlbmVmaWNpbztcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmlhciBkYWRvcyBkZSBiZW5lZsOtY2lvXG4gICAqL1xuICBhc3luYyBjcmVhdGUoXG4gICAgdGlwbzogc3RyaW5nLFxuICAgIGNyZWF0ZUR0bzogSUNyZWF0ZURhZG9zQmVuZWZpY2lvRHRvLFxuICApOiBQcm9taXNlPElEYWRvc0JlbmVmaWNpbz4ge1xuICAgIGNvbnN0IHRpcG9CZW5lZmljaW8gPSB0aGlzLnZhbGlkYXRlVGlwbyh0aXBvKTtcbiAgICBjb25zdCBzZXJ2aWNlID0gdGhpcy5nZXRTZXJ2aWNlKHRpcG9CZW5lZmljaW8pO1xuICAgIHJldHVybiBzZXJ2aWNlLmNyZWF0ZShjcmVhdGVEdG8pO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhciBkYWRvcyBkZSBiZW5lZsOtY2lvIHBvciBJRFxuICAgKi9cbiAgYXN5bmMgZmluZE9uZSh0aXBvOiBzdHJpbmcsIGlkOiBzdHJpbmcpOiBQcm9taXNlPElEYWRvc0JlbmVmaWNpbz4ge1xuICAgIGNvbnN0IHRpcG9CZW5lZmljaW8gPSB0aGlzLnZhbGlkYXRlVGlwbyh0aXBvKTtcbiAgICBjb25zdCBzZXJ2aWNlID0gdGhpcy5nZXRTZXJ2aWNlKHRpcG9CZW5lZmljaW8pO1xuICAgIHJldHVybiBzZXJ2aWNlLmZpbmRPbmUoaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhciBkYWRvcyBkZSBiZW5lZsOtY2lvIHBvciBzb2xpY2l0YcOnw6NvXG4gICAqL1xuICBhc3luYyBmaW5kQnlTb2xpY2l0YWNhbyhcbiAgICB0aXBvOiBzdHJpbmcsXG4gICAgc29saWNpdGFjYW9JZDogc3RyaW5nLFxuICApOiBQcm9taXNlPElEYWRvc0JlbmVmaWNpbz4ge1xuICAgIGNvbnN0IHRpcG9CZW5lZmljaW8gPSB0aGlzLnZhbGlkYXRlVGlwbyh0aXBvKTtcbiAgICBjb25zdCBzZXJ2aWNlID0gdGhpcy5nZXRTZXJ2aWNlKHRpcG9CZW5lZmljaW8pO1xuICAgIHJldHVybiBzZXJ2aWNlLmZpbmRCeVNvbGljaXRhY2FvKHNvbGljaXRhY2FvSWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEF0dWFsaXphciBkYWRvcyBkZSBiZW5lZsOtY2lvXG4gICAqL1xuICBhc3luYyB1cGRhdGUoXG4gICAgdGlwbzogc3RyaW5nLFxuICAgIGlkOiBzdHJpbmcsXG4gICAgdXBkYXRlRHRvOiBJVXBkYXRlRGFkb3NCZW5lZmljaW9EdG8sXG4gICk6IFByb21pc2U8SURhZG9zQmVuZWZpY2lvPiB7XG4gICAgY29uc3QgdGlwb0JlbmVmaWNpbyA9IHRoaXMudmFsaWRhdGVUaXBvKHRpcG8pO1xuICAgIGNvbnN0IHNlcnZpY2UgPSB0aGlzLmdldFNlcnZpY2UodGlwb0JlbmVmaWNpbyk7XG4gICAgcmV0dXJuIHNlcnZpY2UudXBkYXRlKGlkLCB1cGRhdGVEdG8pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXIgZGFkb3MgZGUgYmVuZWbDrWNpb1xuICAgKi9cbiAgYXN5bmMgcmVtb3ZlKHRpcG86IHN0cmluZywgaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHRpcG9CZW5lZmljaW8gPSB0aGlzLnZhbGlkYXRlVGlwbyh0aXBvKTtcbiAgICBjb25zdCBzZXJ2aWNlID0gdGhpcy5nZXRTZXJ2aWNlKHRpcG9CZW5lZmljaW8pO1xuICAgIHJldHVybiBzZXJ2aWNlLnJlbW92ZShpZCk7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2FyIHNlIGV4aXN0ZW0gZGFkb3MgcGFyYSB1bWEgc29saWNpdGHDp8Ojb1xuICAgKi9cbiAgYXN5bmMgZXhpc3RzQnlTb2xpY2l0YWNhbyhcbiAgICB0aXBvOiBzdHJpbmcsXG4gICAgc29saWNpdGFjYW9JZDogc3RyaW5nLFxuICApOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCB0aXBvQmVuZWZpY2lvID0gdGhpcy52YWxpZGF0ZVRpcG8odGlwbyk7XG4gICAgY29uc3Qgc2VydmljZSA9IHRoaXMuZ2V0U2VydmljZSh0aXBvQmVuZWZpY2lvKTtcbiAgICByZXR1cm4gc2VydmljZS5leGlzdHNCeVNvbGljaXRhY2FvKHNvbGljaXRhY2FvSWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIE9idGVyIHRvZG9zIG9zIHRpcG9zIGRlIGJlbmVmw61jaW9zIHN1cG9ydGFkb3NcbiAgICovXG4gIGdldFN1cHBvcnRlZFR5cGVzKCk6IFRpcG9EYWRvc0JlbmVmaWNpb1tdIHtcbiAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhUaXBvRGFkb3NCZW5lZmljaW8pO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhciBzZSB1bSB0aXBvIMOpIHN1cG9ydGFkb1xuICAgKi9cbiAgaXNUeXBlU3VwcG9ydGVkKHRpcG86IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBPYmplY3QudmFsdWVzKFRpcG9EYWRvc0JlbmVmaWNpbykuaW5jbHVkZXMoXG4gICAgICB0aXBvIGFzIFRpcG9EYWRvc0JlbmVmaWNpbyxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIE9idGVyIG1ldGFkYWRvcyBkbyB0aXBvIGRlIGJlbmVmw61jaW9cbiAgICovXG4gIGdldFR5cGVNZXRhZGF0YSh0aXBvOiBzdHJpbmcpOiB7IG5hbWU6IHN0cmluZzsgZGVzY3JpcHRpb246IHN0cmluZyB9IHtcbiAgICBjb25zdCB0aXBvQmVuZWZpY2lvID0gdGhpcy52YWxpZGF0ZVRpcG8odGlwbyk7XG5cbiAgICBjb25zdCBtZXRhZGF0YSA9IHtcbiAgICAgIFtUaXBvRGFkb3NCZW5lZmljaW8uQUxVR1VFTF9TT0NJQUxdOiB7XG4gICAgICAgIG5hbWU6ICdBbHVndWVsIFNvY2lhbCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnRGFkb3MgZXNwZWPDrWZpY29zIHBhcmEgc29saWNpdGHDp8OjbyBkZSBBbHVndWVsIFNvY2lhbCcsXG4gICAgICB9LFxuICAgICAgW1RpcG9EYWRvc0JlbmVmaWNpby5DRVNUQV9CQVNJQ0FdOiB7XG4gICAgICAgIG5hbWU6ICdDZXN0YSBCw6FzaWNhJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdEYWRvcyBlc3BlY8OtZmljb3MgcGFyYSBzb2xpY2l0YcOnw6NvIGRlIENlc3RhIELDoXNpY2EnLFxuICAgICAgfSxcbiAgICAgIFtUaXBvRGFkb3NCZW5lZmljaW8uRlVORVJBTF06IHtcbiAgICAgICAgbmFtZTogJ0F1eMOtbGlvIEZ1bmVyYWwnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0RhZG9zIGVzcGVjw61maWNvcyBwYXJhIHNvbGljaXRhw6fDo28gZGUgQXV4w61saW8gRnVuZXJhbCcsXG4gICAgICB9LFxuICAgICAgW1RpcG9EYWRvc0JlbmVmaWNpby5OQVRBTElEQURFXToge1xuICAgICAgICBuYW1lOiAnQXV4w61saW8gTmF0YWxpZGFkZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnRGFkb3MgZXNwZWPDrWZpY29zIHBhcmEgc29saWNpdGHDp8OjbyBkZSBBdXjDrWxpbyBOYXRhbGlkYWRlJyxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIHJldHVybiBtZXRhZGF0YVt0aXBvQmVuZWZpY2lvXTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9