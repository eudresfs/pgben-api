22cc061bde5ff5418771233f0aa23910
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// src/auth/controllers/password-reset.controller.spec.ts
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const throttler_1 = require("@nestjs/throttler");
const password_reset_controller_1 = require("./password-reset.controller");
const password_reset_service_1 = require("../services/password-reset.service");
describe('PasswordResetController', () => {
    let controller;
    let passwordResetService;
    const mockPasswordResetService = {
        requestPasswordReset: jest.fn(),
        resetPassword: jest.fn(),
        validateToken: jest.fn(),
        getStats: jest.fn(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            controllers: [password_reset_controller_1.PasswordResetController],
            providers: [
                {
                    provide: password_reset_service_1.PasswordResetService,
                    useValue: mockPasswordResetService,
                },
            ],
        })
            .overrideGuard(throttler_1.ThrottlerGuard)
            .useValue({ canActivate: () => true })
            .compile();
        controller = module.get(password_reset_controller_1.PasswordResetController);
        passwordResetService = module.get(password_reset_service_1.PasswordResetService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('forgotPassword', () => {
        const forgotPasswordDto = {
            email: 'test@semtas.gov.br',
        };
        it('deve solicitar recuperação de senha com sucesso', async () => {
            const mockResponse = {
                message: 'Se o email existir, um link de recuperação será enviado',
                timestamp: '2024-01-15T10:30:00Z',
                expiresInMinutes: 15,
            };
            mockPasswordResetService.requestPasswordReset.mockResolvedValue(mockResponse);
            const result = await controller.forgotPassword(forgotPasswordDto);
            expect(passwordResetService.requestPasswordReset).toHaveBeenCalledWith(forgotPasswordDto.email);
            expect(result).toEqual(mockResponse);
        });
        it('deve retornar erro para email inválido', async () => {
            const invalidDto = { email: 'email-invalido' };
            mockPasswordResetService.requestPasswordReset.mockRejectedValue(new common_1.BadRequestException('Email inválido'));
            await expect(controller.forgotPassword(invalidDto)).rejects.toThrow(common_1.BadRequestException);
        });
        it('deve aplicar rate limiting', async () => {
            // Este teste verifica se o decorator @Throttle está aplicado
            const metadata = Reflect.getMetadata('throttler:limit', controller.forgotPassword);
            expect(metadata).toBeDefined();
        });
    });
    describe('resetPassword', () => {
        const resetPasswordDto = {
            token: 'valid-token-123',
            newPassword: 'NovaSenh@123',
            confirmPassword: 'NovaSenh@123',
        };
        it('deve redefinir senha com sucesso', async () => {
            const mockResponse = {
                message: 'Senha redefinida com sucesso',
                timestamp: '2024-01-15T10:35:00Z',
                requiresReauth: true,
            };
            mockPasswordResetService.resetPassword.mockResolvedValue(mockResponse);
            const result = await controller.resetPassword(resetPasswordDto);
            expect(passwordResetService.resetPassword).toHaveBeenCalledWith(resetPasswordDto.token, resetPasswordDto.newPassword);
            expect(result).toEqual(mockResponse);
        });
        it('deve retornar erro para token inválido', async () => {
            mockPasswordResetService.resetPassword.mockRejectedValue(new common_1.BadRequestException('Token inválido ou expirado'));
            await expect(controller.resetPassword(resetPasswordDto)).rejects.toThrow(common_1.BadRequestException);
        });
        it('deve validar confirmação de senha', async () => {
            const invalidDto = {
                ...resetPasswordDto,
                confirmPassword: 'senha-diferente',
            };
            await expect(controller.resetPassword(invalidDto)).rejects.toThrow(common_1.BadRequestException);
        });
        it('deve validar força da senha', async () => {
            const weakPasswordDto = {
                ...resetPasswordDto,
                newPassword: '123456',
                confirmPassword: '123456',
            };
            // A validação deve falhar na camada de DTO
            // Este teste simula a validação do class-validator
            expect(weakPasswordDto.newPassword).not.toMatch(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/);
        });
    });
    describe('validateToken', () => {
        const validateTokenDto = {
            token: 'valid-token-123',
        };
        it('deve validar token com sucesso', async () => {
            const mockResponse = {
                valid: true,
                minutesRemaining: 12,
                email: 'test@semtas.gov.br',
            };
            mockPasswordResetService.validateToken.mockResolvedValue(mockResponse);
            const result = await controller.validateToken(validateTokenDto);
            expect(passwordResetService.validateToken).toHaveBeenCalledWith(validateTokenDto.token);
            expect(result).toEqual(mockResponse);
        });
        it('deve retornar inválido para token expirado', async () => {
            const mockResponse = {
                valid: false,
                error: 'Token expirado',
            };
            mockPasswordResetService.validateToken.mockResolvedValue(mockResponse);
            const result = await controller.validateToken(validateTokenDto);
            expect(result.valid).toBe(false);
            expect(result.error).toBeDefined();
        });
        it('deve retornar inválido para token não encontrado', async () => {
            mockPasswordResetService.validateToken.mockRejectedValue(new common_1.NotFoundException('Token não encontrado'));
            await expect(controller.validateToken(validateTokenDto)).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('getStats', () => {
        it('deve retornar estatísticas para administradores', async () => {
            const mockStats = {
                requestsLast24h: 15,
                successfulResetsLast24h: 12,
                activeTokens: 8,
                expiredTokensLast24h: 3,
                successRate: 80.0,
                uniqueUsersLast24h: 14,
            };
            mockPasswordResetService.getStats.mockResolvedValue(mockStats);
            const result = await controller.getStats();
            expect(passwordResetService.getStats).toHaveBeenCalled();
            expect(result).toEqual(mockStats);
        });
        it('deve ter proteção de acesso por papel', () => {
            // Verifica se o decorator @Roles está aplicado
            const metadata = Reflect.getMetadata('roles', controller.getStats);
            expect(metadata).toContain('ADMIN');
        });
    });
    describe('Validações de DTO', () => {
        it('deve validar formato de email', () => {
            const invalidEmails = [
                'email-sem-arroba',
                '@dominio.com',
                'email@',
                'email@dominio',
                '',
            ];
            invalidEmails.forEach((email) => {
                expect(email).not.toMatch(/^[^\s@]+@[^\s@]+\.[^\s@]+$/);
            });
        });
        it('deve validar tamanho mínimo do token', () => {
            const shortToken = 'abc123';
            expect(shortToken.length).toBeLessThan(32);
        });
        it('deve validar força da senha', () => {
            const validPasswords = ['MinhaSenh@123', 'Outr@Senha456', 'Segur@nca789'];
            const invalidPasswords = [
                '123456',
                'password',
                'PASSWORD',
                'Password',
                'Password123',
                'password@123',
            ];
            const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/;
            validPasswords.forEach((password) => {
                expect(password).toMatch(passwordRegex);
            });
            invalidPasswords.forEach((password) => {
                expect(password).not.toMatch(passwordRegex);
            });
        });
    });
    describe('Rate Limiting', () => {
        it('deve ter rate limiting configurado para forgot-password', () => {
            // Verifica se o decorator @Throttle está aplicado com os valores corretos
            const metadata = Reflect.getMetadata('throttler:limit', controller.forgotPassword);
            expect(metadata).toBeDefined();
        });
        it('deve ter rate limiting configurado para reset-password', () => {
            const metadata = Reflect.getMetadata('throttler:limit', controller.resetPassword);
            expect(metadata).toBeDefined();
        });
    });
    describe('Documentação Swagger', () => {
        it('deve ter documentação completa', () => {
            // Verifica se os decorators do Swagger estão aplicados
            const apiTags = Reflect.getMetadata('swagger/apiUseTags', password_reset_controller_1.PasswordResetController);
            expect(apiTags).toContain('Recuperação de Senha');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGF1dGhcXGNvbnRyb2xsZXJzXFxwYXNzd29yZC1yZXNldC5jb250cm9sbGVyLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSx5REFBeUQ7QUFDekQsNkNBQXNEO0FBQ3RELDJDQUF3RTtBQUN4RSxpREFBbUQ7QUFDbkQsMkVBQXNFO0FBQ3RFLCtFQUEwRTtBQU8xRSxRQUFRLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO0lBQ3ZDLElBQUksVUFBbUMsQ0FBQztJQUN4QyxJQUFJLG9CQUF1RCxDQUFDO0lBRTVELE1BQU0sd0JBQXdCLEdBQUc7UUFDL0Isb0JBQW9CLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUMvQixhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUN4QixhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUN4QixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNwQixDQUFDO0lBRUYsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxXQUFXLEVBQUUsQ0FBQyxtREFBdUIsQ0FBQztZQUN0QyxTQUFTLEVBQUU7Z0JBQ1Q7b0JBQ0UsT0FBTyxFQUFFLDZDQUFvQjtvQkFDN0IsUUFBUSxFQUFFLHdCQUF3QjtpQkFDbkM7YUFDRjtTQUNGLENBQUM7YUFDQyxhQUFhLENBQUMsMEJBQWMsQ0FBQzthQUM3QixRQUFRLENBQUMsRUFBRSxXQUFXLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7YUFDckMsT0FBTyxFQUFFLENBQUM7UUFFYixVQUFVLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBMEIsbURBQXVCLENBQUMsQ0FBQztRQUMxRSxvQkFBb0IsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLDZDQUFvQixD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N0IsRUFBRSxDQUFDLHlEQUF5RCxFQUFFLEdBQUcsRUFBRTtZQUNqRSwwRUFBMEU7WUFDMUUsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FDbEMsaUJBQWlCLEVBQ2pCLFVBQVUsQ0FBQyxjQUFjLENBQzFCLENBQUM7WUFDRixNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDakMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsd0RBQXdELEVBQUUsR0FBRyxFQUFFO1lBQ2hFLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQ2xDLGlCQUFpQixFQUNqQixVQUFVLENBQUMsYUFBYSxDQUN6QixDQUFDO1lBQ0YsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2pDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO1FBQ3BDLEVBQUUsQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7WUFDeEMsdURBQXVEO1lBQ3ZELE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQ2pDLG9CQUFvQixFQUNwQixtREFBdUIsQ0FDeEIsQ0FBQztZQUNGLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUNwRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGF1dGhcXGNvbnRyb2xsZXJzXFxwYXNzd29yZC1yZXNldC5jb250cm9sbGVyLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL2F1dGgvY29udHJvbGxlcnMvcGFzc3dvcmQtcmVzZXQuY29udHJvbGxlci5zcGVjLnRzXG5pbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IEJhZFJlcXVlc3RFeGNlcHRpb24sIE5vdEZvdW5kRXhjZXB0aW9uIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgVGhyb3R0bGVyR3VhcmQgfSBmcm9tICdAbmVzdGpzL3Rocm90dGxlcic7XG5pbXBvcnQgeyBQYXNzd29yZFJlc2V0Q29udHJvbGxlciB9IGZyb20gJy4vcGFzc3dvcmQtcmVzZXQuY29udHJvbGxlcic7XG5pbXBvcnQgeyBQYXNzd29yZFJlc2V0U2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3Bhc3N3b3JkLXJlc2V0LnNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgRm9yZ290UGFzc3dvcmREdG8sXG4gIFJlc2V0UGFzc3dvcmREdG8sXG4gIFZhbGlkYXRlVG9rZW5EdG8sXG59IGZyb20gJy4uL2R0by9wYXNzd29yZC1yZXNldC5kdG8nO1xuXG5kZXNjcmliZSgnUGFzc3dvcmRSZXNldENvbnRyb2xsZXInLCAoKSA9PiB7XG4gIGxldCBjb250cm9sbGVyOiBQYXNzd29yZFJlc2V0Q29udHJvbGxlcjtcbiAgbGV0IHBhc3N3b3JkUmVzZXRTZXJ2aWNlOiBqZXN0Lk1vY2tlZDxQYXNzd29yZFJlc2V0U2VydmljZT47XG5cbiAgY29uc3QgbW9ja1Bhc3N3b3JkUmVzZXRTZXJ2aWNlID0ge1xuICAgIHJlcXVlc3RQYXNzd29yZFJlc2V0OiBqZXN0LmZuKCksXG4gICAgcmVzZXRQYXNzd29yZDogamVzdC5mbigpLFxuICAgIHZhbGlkYXRlVG9rZW46IGplc3QuZm4oKSxcbiAgICBnZXRTdGF0czogamVzdC5mbigpLFxuICB9O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBjb250cm9sbGVyczogW1Bhc3N3b3JkUmVzZXRDb250cm9sbGVyXSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogUGFzc3dvcmRSZXNldFNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tQYXNzd29yZFJlc2V0U2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSlcbiAgICAgIC5vdmVycmlkZUd1YXJkKFRocm90dGxlckd1YXJkKVxuICAgICAgLnVzZVZhbHVlKHsgY2FuQWN0aXZhdGU6ICgpID0+IHRydWUgfSlcbiAgICAgIC5jb21waWxlKCk7XG5cbiAgICBjb250cm9sbGVyID0gbW9kdWxlLmdldDxQYXNzd29yZFJlc2V0Q29udHJvbGxlcj4oUGFzc3dvcmRSZXNldENvbnRyb2xsZXIpO1xuICAgIHBhc3N3b3JkUmVzZXRTZXJ2aWNlID0gbW9kdWxlLmdldChQYXNzd29yZFJlc2V0U2VydmljZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmb3Jnb3RQYXNzd29yZCcsICgpID0+IHtcbiAgICBjb25zdCBmb3Jnb3RQYXNzd29yZER0bzogRm9yZ290UGFzc3dvcmREdG8gPSB7XG4gICAgICBlbWFpbDogJ3Rlc3RAc2VtdGFzLmdvdi5icicsXG4gICAgfTtcblxuICAgIGl0KCdkZXZlIHNvbGljaXRhciByZWN1cGVyYcOnw6NvIGRlIHNlbmhhIGNvbSBzdWNlc3NvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc3BvbnNlID0ge1xuICAgICAgICBtZXNzYWdlOiAnU2UgbyBlbWFpbCBleGlzdGlyLCB1bSBsaW5rIGRlIHJlY3VwZXJhw6fDo28gc2Vyw6EgZW52aWFkbycsXG4gICAgICAgIHRpbWVzdGFtcDogJzIwMjQtMDEtMTVUMTA6MzA6MDBaJyxcbiAgICAgICAgZXhwaXJlc0luTWludXRlczogMTUsXG4gICAgICB9O1xuXG4gICAgICBtb2NrUGFzc3dvcmRSZXNldFNlcnZpY2UucmVxdWVzdFBhc3N3b3JkUmVzZXQubW9ja1Jlc29sdmVkVmFsdWUoXG4gICAgICAgIG1vY2tSZXNwb25zZSxcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZm9yZ290UGFzc3dvcmQoZm9yZ290UGFzc3dvcmREdG8pO1xuXG4gICAgICBleHBlY3QocGFzc3dvcmRSZXNldFNlcnZpY2UucmVxdWVzdFBhc3N3b3JkUmVzZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBmb3Jnb3RQYXNzd29yZER0by5lbWFpbCxcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tSZXNwb25zZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBlcnJvIHBhcmEgZW1haWwgaW52w6FsaWRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZER0byA9IHsgZW1haWw6ICdlbWFpbC1pbnZhbGlkbycgfTtcblxuICAgICAgbW9ja1Bhc3N3b3JkUmVzZXRTZXJ2aWNlLnJlcXVlc3RQYXNzd29yZFJlc2V0Lm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignRW1haWwgaW52w6FsaWRvJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIGNvbnRyb2xsZXIuZm9yZ290UGFzc3dvcmQoaW52YWxpZER0byBhcyBGb3Jnb3RQYXNzd29yZER0byksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhCYWRSZXF1ZXN0RXhjZXB0aW9uKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGFwbGljYXIgcmF0ZSBsaW1pdGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEVzdGUgdGVzdGUgdmVyaWZpY2Egc2UgbyBkZWNvcmF0b3IgQFRocm90dGxlIGVzdMOhIGFwbGljYWRvXG4gICAgICBjb25zdCBtZXRhZGF0YSA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoXG4gICAgICAgICd0aHJvdHRsZXI6bGltaXQnLFxuICAgICAgICBjb250cm9sbGVyLmZvcmdvdFBhc3N3b3JkLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChtZXRhZGF0YSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3Jlc2V0UGFzc3dvcmQnLCAoKSA9PiB7XG4gICAgY29uc3QgcmVzZXRQYXNzd29yZER0bzogUmVzZXRQYXNzd29yZER0byA9IHtcbiAgICAgIHRva2VuOiAndmFsaWQtdG9rZW4tMTIzJyxcbiAgICAgIG5ld1Bhc3N3b3JkOiAnTm92YVNlbmhAMTIzJyxcbiAgICAgIGNvbmZpcm1QYXNzd29yZDogJ05vdmFTZW5oQDEyMycsXG4gICAgfTtcblxuICAgIGl0KCdkZXZlIHJlZGVmaW5pciBzZW5oYSBjb20gc3VjZXNzbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXNwb25zZSA9IHtcbiAgICAgICAgbWVzc2FnZTogJ1NlbmhhIHJlZGVmaW5pZGEgY29tIHN1Y2Vzc28nLFxuICAgICAgICB0aW1lc3RhbXA6ICcyMDI0LTAxLTE1VDEwOjM1OjAwWicsXG4gICAgICAgIHJlcXVpcmVzUmVhdXRoOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Bhc3N3b3JkUmVzZXRTZXJ2aWNlLnJlc2V0UGFzc3dvcmQubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3BvbnNlKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5yZXNldFBhc3N3b3JkKHJlc2V0UGFzc3dvcmREdG8pO1xuXG4gICAgICBleHBlY3QocGFzc3dvcmRSZXNldFNlcnZpY2UucmVzZXRQYXNzd29yZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIHJlc2V0UGFzc3dvcmREdG8udG9rZW4sXG4gICAgICAgIHJlc2V0UGFzc3dvcmREdG8ubmV3UGFzc3dvcmQsXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUmVzcG9uc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgZXJybyBwYXJhIHRva2VuIGludsOhbGlkbycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQYXNzd29yZFJlc2V0U2VydmljZS5yZXNldFBhc3N3b3JkLm1vY2tSZWplY3RlZFZhbHVlKFxuICAgICAgICBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignVG9rZW4gaW52w6FsaWRvIG91IGV4cGlyYWRvJyksXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBleHBlY3QoY29udHJvbGxlci5yZXNldFBhc3N3b3JkKHJlc2V0UGFzc3dvcmREdG8pKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEJhZFJlcXVlc3RFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgdmFsaWRhciBjb25maXJtYcOnw6NvIGRlIHNlbmhhJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZER0byA9IHtcbiAgICAgICAgLi4ucmVzZXRQYXNzd29yZER0byxcbiAgICAgICAgY29uZmlybVBhc3N3b3JkOiAnc2VuaGEtZGlmZXJlbnRlJyxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLnJlc2V0UGFzc3dvcmQoaW52YWxpZER0bykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSB2YWxpZGFyIGZvcsOnYSBkYSBzZW5oYScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHdlYWtQYXNzd29yZER0byA9IHtcbiAgICAgICAgLi4ucmVzZXRQYXNzd29yZER0byxcbiAgICAgICAgbmV3UGFzc3dvcmQ6ICcxMjM0NTYnLFxuICAgICAgICBjb25maXJtUGFzc3dvcmQ6ICcxMjM0NTYnLFxuICAgICAgfTtcblxuICAgICAgLy8gQSB2YWxpZGHDp8OjbyBkZXZlIGZhbGhhciBuYSBjYW1hZGEgZGUgRFRPXG4gICAgICAvLyBFc3RlIHRlc3RlIHNpbXVsYSBhIHZhbGlkYcOnw6NvIGRvIGNsYXNzLXZhbGlkYXRvclxuICAgICAgZXhwZWN0KHdlYWtQYXNzd29yZER0by5uZXdQYXNzd29yZCkubm90LnRvTWF0Y2goXG4gICAgICAgIC9eKD89LipbYS16XSkoPz0uKltBLVpdKSg/PS4qXFxkKSg/PS4qW0AkISUqPyZdKVtBLVphLXpcXGRAJCElKj8mXS8sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndmFsaWRhdGVUb2tlbicsICgpID0+IHtcbiAgICBjb25zdCB2YWxpZGF0ZVRva2VuRHRvOiBWYWxpZGF0ZVRva2VuRHRvID0ge1xuICAgICAgdG9rZW46ICd2YWxpZC10b2tlbi0xMjMnLFxuICAgIH07XG5cbiAgICBpdCgnZGV2ZSB2YWxpZGFyIHRva2VuIGNvbSBzdWNlc3NvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc3BvbnNlID0ge1xuICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgbWludXRlc1JlbWFpbmluZzogMTIsXG4gICAgICAgIGVtYWlsOiAndGVzdEBzZW10YXMuZ292LmJyJyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQYXNzd29yZFJlc2V0U2VydmljZS52YWxpZGF0ZVRva2VuLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXNwb25zZSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIudmFsaWRhdGVUb2tlbih2YWxpZGF0ZVRva2VuRHRvKTtcblxuICAgICAgZXhwZWN0KHBhc3N3b3JkUmVzZXRTZXJ2aWNlLnZhbGlkYXRlVG9rZW4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB2YWxpZGF0ZVRva2VuRHRvLnRva2VuLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1Jlc3BvbnNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIGludsOhbGlkbyBwYXJhIHRva2VuIGV4cGlyYWRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc3BvbnNlID0ge1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnVG9rZW4gZXhwaXJhZG8nLFxuICAgICAgfTtcblxuICAgICAgbW9ja1Bhc3N3b3JkUmVzZXRTZXJ2aWNlLnZhbGlkYXRlVG9rZW4ubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3BvbnNlKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci52YWxpZGF0ZVRva2VuKHZhbGlkYXRlVG9rZW5EdG8pO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBpbnbDoWxpZG8gcGFyYSB0b2tlbiBuw6NvIGVuY29udHJhZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUGFzc3dvcmRSZXNldFNlcnZpY2UudmFsaWRhdGVUb2tlbi5tb2NrUmVqZWN0ZWRWYWx1ZShcbiAgICAgICAgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdUb2tlbiBuw6NvIGVuY29udHJhZG8nKSxcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChjb250cm9sbGVyLnZhbGlkYXRlVG9rZW4odmFsaWRhdGVUb2tlbkR0bykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgTm90Rm91bmRFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0U3RhdHMnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgZXN0YXTDrXN0aWNhcyBwYXJhIGFkbWluaXN0cmFkb3JlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tTdGF0cyA9IHtcbiAgICAgICAgcmVxdWVzdHNMYXN0MjRoOiAxNSxcbiAgICAgICAgc3VjY2Vzc2Z1bFJlc2V0c0xhc3QyNGg6IDEyLFxuICAgICAgICBhY3RpdmVUb2tlbnM6IDgsXG4gICAgICAgIGV4cGlyZWRUb2tlbnNMYXN0MjRoOiAzLFxuICAgICAgICBzdWNjZXNzUmF0ZTogODAuMCxcbiAgICAgICAgdW5pcXVlVXNlcnNMYXN0MjRoOiAxNCxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQYXNzd29yZFJlc2V0U2VydmljZS5nZXRTdGF0cy5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU3RhdHMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLmdldFN0YXRzKCk7XG5cbiAgICAgIGV4cGVjdChwYXNzd29yZFJlc2V0U2VydmljZS5nZXRTdGF0cykudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrU3RhdHMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgdGVyIHByb3Rlw6fDo28gZGUgYWNlc3NvIHBvciBwYXBlbCcsICgpID0+IHtcbiAgICAgIC8vIFZlcmlmaWNhIHNlIG8gZGVjb3JhdG9yIEBSb2xlcyBlc3TDoSBhcGxpY2Fkb1xuICAgICAgY29uc3QgbWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCdyb2xlcycsIGNvbnRyb2xsZXIuZ2V0U3RhdHMpO1xuICAgICAgZXhwZWN0KG1ldGFkYXRhKS50b0NvbnRhaW4oJ0FETUlOJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdWYWxpZGHDp8O1ZXMgZGUgRFRPJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHZhbGlkYXIgZm9ybWF0byBkZSBlbWFpbCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRFbWFpbHMgPSBbXG4gICAgICAgICdlbWFpbC1zZW0tYXJyb2JhJyxcbiAgICAgICAgJ0Bkb21pbmlvLmNvbScsXG4gICAgICAgICdlbWFpbEAnLFxuICAgICAgICAnZW1haWxAZG9taW5pbycsXG4gICAgICAgICcnLFxuICAgICAgXTtcblxuICAgICAgaW52YWxpZEVtYWlscy5mb3JFYWNoKChlbWFpbCkgPT4ge1xuICAgICAgICBleHBlY3QoZW1haWwpLm5vdC50b01hdGNoKC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgdmFsaWRhciB0YW1hbmhvIG3DrW5pbW8gZG8gdG9rZW4nLCAoKSA9PiB7XG4gICAgICBjb25zdCBzaG9ydFRva2VuID0gJ2FiYzEyMyc7XG4gICAgICBleHBlY3Qoc2hvcnRUb2tlbi5sZW5ndGgpLnRvQmVMZXNzVGhhbigzMik7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSB2YWxpZGFyIGZvcsOnYSBkYSBzZW5oYScsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbGlkUGFzc3dvcmRzID0gWydNaW5oYVNlbmhAMTIzJywgJ091dHJAU2VuaGE0NTYnLCAnU2VndXJAbmNhNzg5J107XG5cbiAgICAgIGNvbnN0IGludmFsaWRQYXNzd29yZHMgPSBbXG4gICAgICAgICcxMjM0NTYnLFxuICAgICAgICAncGFzc3dvcmQnLFxuICAgICAgICAnUEFTU1dPUkQnLFxuICAgICAgICAnUGFzc3dvcmQnLFxuICAgICAgICAnUGFzc3dvcmQxMjMnLFxuICAgICAgICAncGFzc3dvcmRAMTIzJyxcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHBhc3N3b3JkUmVnZXggPVxuICAgICAgICAvXig/PS4qW2Etel0pKD89LipbQS1aXSkoPz0uKlxcZCkoPz0uKltAJCElKj8mXSlbQS1aYS16XFxkQCQhJSo/Jl0vO1xuXG4gICAgICB2YWxpZFBhc3N3b3Jkcy5mb3JFYWNoKChwYXNzd29yZCkgPT4ge1xuICAgICAgICBleHBlY3QocGFzc3dvcmQpLnRvTWF0Y2gocGFzc3dvcmRSZWdleCk7XG4gICAgICB9KTtcblxuICAgICAgaW52YWxpZFBhc3N3b3Jkcy5mb3JFYWNoKChwYXNzd29yZCkgPT4ge1xuICAgICAgICBleHBlY3QocGFzc3dvcmQpLm5vdC50b01hdGNoKHBhc3N3b3JkUmVnZXgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSYXRlIExpbWl0aW5nJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHRlciByYXRlIGxpbWl0aW5nIGNvbmZpZ3VyYWRvIHBhcmEgZm9yZ290LXBhc3N3b3JkJywgKCkgPT4ge1xuICAgICAgLy8gVmVyaWZpY2Egc2UgbyBkZWNvcmF0b3IgQFRocm90dGxlIGVzdMOhIGFwbGljYWRvIGNvbSBvcyB2YWxvcmVzIGNvcnJldG9zXG4gICAgICBjb25zdCBtZXRhZGF0YSA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoXG4gICAgICAgICd0aHJvdHRsZXI6bGltaXQnLFxuICAgICAgICBjb250cm9sbGVyLmZvcmdvdFBhc3N3b3JkLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChtZXRhZGF0YSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHRlciByYXRlIGxpbWl0aW5nIGNvbmZpZ3VyYWRvIHBhcmEgcmVzZXQtcGFzc3dvcmQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtZXRhZGF0YSA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoXG4gICAgICAgICd0aHJvdHRsZXI6bGltaXQnLFxuICAgICAgICBjb250cm9sbGVyLnJlc2V0UGFzc3dvcmQsXG4gICAgICApO1xuICAgICAgZXhwZWN0KG1ldGFkYXRhKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRG9jdW1lbnRhw6fDo28gU3dhZ2dlcicsICgpID0+IHtcbiAgICBpdCgnZGV2ZSB0ZXIgZG9jdW1lbnRhw6fDo28gY29tcGxldGEnLCAoKSA9PiB7XG4gICAgICAvLyBWZXJpZmljYSBzZSBvcyBkZWNvcmF0b3JzIGRvIFN3YWdnZXIgZXN0w6NvIGFwbGljYWRvc1xuICAgICAgY29uc3QgYXBpVGFncyA9IFJlZmxlY3QuZ2V0TWV0YWRhdGEoXG4gICAgICAgICdzd2FnZ2VyL2FwaVVzZVRhZ3MnLFxuICAgICAgICBQYXNzd29yZFJlc2V0Q29udHJvbGxlcixcbiAgICAgICk7XG4gICAgICBleHBlY3QoYXBpVGFncykudG9Db250YWluKCdSZWN1cGVyYcOnw6NvIGRlIFNlbmhhJyk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=