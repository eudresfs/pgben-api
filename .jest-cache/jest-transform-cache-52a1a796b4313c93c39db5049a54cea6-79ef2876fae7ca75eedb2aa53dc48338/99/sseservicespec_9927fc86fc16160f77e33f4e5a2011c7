0a7127584704a58f7faa4cc103b4f7df
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const jwt_1 = require("@nestjs/jwt");
const config_1 = require("@nestjs/config");
const sse_service_1 = require("../services/sse.service");
const rxjs_1 = require("rxjs");
describe('SseService', () => {
    let service;
    let jwtService;
    let configService;
    const mockJwtService = {
        verifyAsync: jest.fn(),
    };
    const mockConfigService = {
        get: jest.fn((key) => {
            const config = {
                'sse.heartbeatInterval': 30000,
                'sse.connectionTimeout': 300000,
                'sse.maxConnectionsPerUser': 5,
                'sse.cleanupInterval': 60000,
            };
            return config[key];
        }),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                sse_service_1.SseService,
                {
                    provide: jwt_1.JwtService,
                    useValue: mockJwtService,
                },
                {
                    provide: config_1.ConfigService,
                    useValue: mockConfigService,
                },
            ],
        }).compile();
        service = module.get(sse_service_1.SseService);
        jwtService = module.get(jwt_1.JwtService);
        configService = module.get(config_1.ConfigService);
    });
    afterEach(() => {
        jest.clearAllMocks();
        // Limpar todas as conexões após cada teste
        service.removeAllConnections();
    });
    it('should be defined', () => {
        expect(service).toBeDefined();
    });
    describe('createConnection', () => {
        it('should create a new SSE connection', (done) => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            const observable = service.createConnection(userId, mockRequest);
            expect(observable).toBeInstanceOf(rxjs_1.Observable);
            // Verificar se a conexão foi adicionada
            const stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(1);
            expect(stats.activeConnections).toBe(1);
            expect(stats.connectionsByUser[userId]).toBe(1);
            done();
        });
        it('should limit connections per user', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            // Criar o máximo de conexões permitidas
            for (let i = 0; i < 5; i++) {
                service.createConnection(userId, mockRequest);
            }
            // Tentar criar uma conexão adicional
            expect(() => {
                service.createConnection(userId, mockRequest);
            }).toThrow('Máximo de conexões por usuário atingido');
        });
        it('should generate unique connection IDs', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            const connection1 = service.createConnection(userId, mockRequest);
            const connection2 = service.createConnection(userId, mockRequest);
            // As conexões devem ter IDs diferentes
            expect(connection1).not.toBe(connection2);
        });
    });
    describe('sendNotificationToUser', () => {
        it('should send notification to specific user', (done) => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            const notification = {
                id: 'notif-123',
                type: 'notification',
                data: {
                    id: 'notif-123',
                    titulo: 'Teste',
                    conteudo: 'Conteúdo de teste',
                    tipo: 'info',
                    prioridade: 'media',
                    data_criacao: new Date().toISOString(),
                    lida: false,
                },
            };
            // Criar conexão
            const observable = service.createConnection(userId, mockRequest);
            // Subscrever para receber notificações
            observable.subscribe({
                next: (event) => {
                    if (event.type === 'notification') {
                        expect(event.data.titulo).toBe('Teste');
                        done();
                    }
                },
            });
            // Enviar notificação
            const result = service.sendNotificationToUser(userId, notification);
            expect(result).toBe(true);
        });
        it('should return false when user has no connections', () => {
            const userId = 'user-without-connections';
            const notification = {
                id: 'notif-123',
                type: 'notification',
                data: {
                    id: 'notif-123',
                    titulo: 'Teste',
                    conteudo: 'Conteúdo de teste',
                    tipo: 'info',
                    prioridade: 'media',
                    data_criacao: new Date().toISOString(),
                    lida: false,
                },
            };
            const result = service.sendNotificationToUser(userId, notification);
            expect(result).toBe(false);
        });
    });
    describe('broadcastToAllUsers', () => {
        it('should send notification to all connected users', (done) => {
            const user1 = 'user-1';
            const user2 = 'user-2';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            const notification = {
                id: 'notif-broadcast',
                type: 'notification',
                data: {
                    id: 'notif-broadcast',
                    titulo: 'Broadcast',
                    conteudo: 'Mensagem para todos',
                    tipo: 'info',
                    prioridade: 'media',
                    data_criacao: new Date().toISOString(),
                    lida: false,
                },
            };
            let receivedCount = 0;
            const expectedCount = 2;
            // Criar conexões para dois usuários
            const obs1 = service.createConnection(user1, mockRequest);
            const obs2 = service.createConnection(user2, mockRequest);
            // Subscrever ambas as conexões
            [obs1, obs2].forEach((obs) => {
                obs.subscribe({
                    next: (event) => {
                        if (event.type === 'notification') {
                            receivedCount++;
                            if (receivedCount === expectedCount) {
                                done();
                            }
                        }
                    },
                });
            });
            // Enviar broadcast
            const result = service.broadcastToAllUsers(notification);
            expect(result).toBe(2); // Deve retornar o número de usuários que receberam
        });
    });
    describe('removeConnection', () => {
        it('should remove specific connection', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            // Criar conexão
            service.createConnection(userId, mockRequest);
            let stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(1);
            // Obter ID da conexão (simulado)
            const connections = service['connections'];
            const connectionId = Array.from(connections.keys())[0];
            // Remover conexão
            service.removeConnection(connectionId);
            stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(0);
            expect(stats.activeConnections).toBe(0);
        });
    });
    describe('removeUserConnections', () => {
        it('should remove all connections for a user', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            // Criar múltiplas conexões para o mesmo usuário
            service.createConnection(userId, mockRequest);
            service.createConnection(userId, mockRequest);
            service.createConnection(userId, mockRequest);
            let stats = service.getConnectionStats();
            expect(stats.connectionsByUser[userId]).toBe(3);
            // Remover todas as conexões do usuário
            const removedCount = service.removeUserConnections(userId);
            expect(removedCount).toBe(3);
            stats = service.getConnectionStats();
            expect(stats.connectionsByUser[userId]).toBeUndefined();
            expect(stats.totalConnections).toBe(0);
        });
    });
    describe('isUserConnected', () => {
        it('should return true when user has active connections', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            expect(service.isUserConnected(userId)).toBe(false);
            service.createConnection(userId, mockRequest);
            expect(service.isUserConnected(userId)).toBe(true);
        });
    });
    describe('getUserConnectionCount', () => {
        it('should return correct connection count for user', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            expect(service.getUserConnectionCount(userId)).toBe(0);
            service.createConnection(userId, mockRequest);
            expect(service.getUserConnectionCount(userId)).toBe(1);
            service.createConnection(userId, mockRequest);
            expect(service.getUserConnectionCount(userId)).toBe(2);
        });
    });
    describe('getConnectionStats', () => {
        it('should return accurate connection statistics', () => {
            const user1 = 'user-1';
            const user2 = 'user-2';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            // Estado inicial
            let stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(0);
            expect(stats.activeConnections).toBe(0);
            expect(stats.uniqueUsers).toBe(0);
            // Adicionar conexões
            service.createConnection(user1, mockRequest);
            service.createConnection(user1, mockRequest);
            service.createConnection(user2, mockRequest);
            stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(3);
            expect(stats.activeConnections).toBe(3);
            expect(stats.uniqueUsers).toBe(2);
            expect(stats.connectionsByUser[user1]).toBe(2);
            expect(stats.connectionsByUser[user2]).toBe(1);
        });
    });
    describe('heartbeat functionality', () => {
        it('should send heartbeat events', (done) => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            const observable = service.createConnection(userId, mockRequest);
            observable.subscribe({
                next: (event) => {
                    if (event.type === 'heartbeat') {
                        expect(event.data.timestamp).toBeDefined();
                        expect(event.data.server_time).toBeDefined();
                        done();
                    }
                },
            });
            // Simular envio de heartbeat
            service['sendHeartbeat']();
        });
    });
    describe('cleanup functionality', () => {
        it('should clean up inactive connections', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            // Criar conexão
            service.createConnection(userId, mockRequest);
            let stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(1);
            // Simular conexão inativa (modificar timestamp)
            const connections = service['connections'];
            const connection = Array.from(connections.values())[0];
            connection.lastActivity = new Date(Date.now() - 400000); // 6 minutos atrás
            // Executar limpeza
            service['cleanupInactiveConnections']();
            stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(0);
        });
    });
    describe('error handling', () => {
        it('should handle invalid notification data gracefully', () => {
            const userId = 'user-123';
            const invalidNotification = null;
            expect(() => {
                service.sendNotificationToUser(userId, invalidNotification);
            }).not.toThrow();
        });
        it('should handle connection errors gracefully', () => {
            const userId = 'user-123';
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            const observable = service.createConnection(userId, mockRequest);
            // Simular erro na conexão
            expect(() => {
                observable.subscribe({
                    error: (error) => {
                        expect(error).toBeDefined();
                    },
                });
            }).not.toThrow();
        });
    });
    describe('memory management', () => {
        it('should not exceed memory limits with many connections', () => {
            const mockRequest = {
                ip: '127.0.0.1',
                headers: { 'user-agent': 'test-agent' },
            };
            // Criar muitas conexões para usuários diferentes
            for (let i = 0; i < 100; i++) {
                const userId = `user-${i}`;
                service.createConnection(userId, mockRequest);
            }
            const stats = service.getConnectionStats();
            expect(stats.totalConnections).toBe(100);
            expect(stats.uniqueUsers).toBe(100);
            // Verificar se o serviço ainda está responsivo
            expect(service.isUserConnected('user-50')).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXG5vdGlmaWNhY2FvXFx0ZXN0c1xcc3NlLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCxxQ0FBeUM7QUFDekMsMkNBQStDO0FBQy9DLHlEQUFxRDtBQUtyRCwrQkFBa0M7QUFHbEMsUUFBUSxDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUU7SUFDMUIsSUFBSSxPQUFtQixDQUFDO0lBQ3hCLElBQUksVUFBc0IsQ0FBQztJQUMzQixJQUFJLGFBQTRCLENBQUM7SUFFakMsTUFBTSxjQUFjLEdBQUc7UUFDckIsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDdkIsQ0FBQztJQUVGLE1BQU0saUJBQWlCLEdBQUc7UUFDeEIsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFXLEVBQUUsRUFBRTtZQUMzQixNQUFNLE1BQU0sR0FBRztnQkFDYix1QkFBdUIsRUFBRSxLQUFLO2dCQUM5Qix1QkFBdUIsRUFBRSxNQUFNO2dCQUMvQiwyQkFBMkIsRUFBRSxDQUFDO2dCQUM5QixxQkFBcUIsRUFBRSxLQUFLO2FBQzdCLENBQUM7WUFDRixPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNyQixDQUFDLENBQUM7S0FDSCxDQUFDO0lBRUYsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUU7Z0JBQ1Qsd0JBQVU7Z0JBQ1Y7b0JBQ0UsT0FBTyxFQUFFLGdCQUFVO29CQUNuQixRQUFRLEVBQUUsY0FBYztpQkFDekI7Z0JBQ0Q7b0JBQ0UsT0FBTyxFQUFFLHNCQUFhO29CQUN0QixRQUFRLEVBQUUsaUJBQWlCO2lCQUM1QjthQUNGO1NBQ0YsQ0FBQyxDQUFDLE9BQU8sRUFBRSxD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UUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUNqQyxFQUFFLENBQUMsdURBQXVELEVBQUUsR0FBRyxFQUFFO1lBQy9ELE1BQU0sV0FBVyxHQUFHO2dCQUNsQixFQUFFLEVBQUUsV0FBVztnQkFDZixPQUFPLEVBQUUsRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFO2FBQzdCLENBQUM7WUFFYixpREFBaUQ7WUFDakQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUM3QixNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDO2dCQUMzQixPQUFPLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQ2hELENBQUM7WUFFRCxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUMzQyxNQUFNLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3pDLE1BQU0sQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRXBDLCtDQUErQztZQUMvQyxNQUFNLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXG5vdGlmaWNhY2FvXFx0ZXN0c1xcc3NlLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IEp3dFNlcnZpY2UgfSBmcm9tICdAbmVzdGpzL2p3dCc7XG5pbXBvcnQgeyBDb25maWdTZXJ2aWNlIH0gZnJvbSAnQG5lc3Rqcy9jb25maWcnO1xuaW1wb3J0IHsgU3NlU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3NzZS5zZXJ2aWNlJztcbmltcG9ydCB7XG4gIFNzZU5vdGlmaWNhdGlvbixcbiAgU3NlQ29ubmVjdGlvbixcbn0gZnJvbSAnLi4vaW50ZXJmYWNlcy9zc2Utbm90aWZpY2F0aW9uLmludGVyZmFjZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBSZXF1ZXN0IH0gZnJvbSAnZXhwcmVzcyc7XG5cbmRlc2NyaWJlKCdTc2VTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogU3NlU2VydmljZTtcbiAgbGV0IGp3dFNlcnZpY2U6IEp3dFNlcnZpY2U7XG4gIGxldCBjb25maWdTZXJ2aWNlOiBDb25maWdTZXJ2aWNlO1xuXG4gIGNvbnN0IG1vY2tKd3RTZXJ2aWNlID0ge1xuICAgIHZlcmlmeUFzeW5jOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgY29uc3QgbW9ja0NvbmZpZ1NlcnZpY2UgPSB7XG4gICAgZ2V0OiBqZXN0LmZuKChrZXk6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICAnc3NlLmhlYXJ0YmVhdEludGVydmFsJzogMzAwMDAsXG4gICAgICAgICdzc2UuY29ubmVjdGlvblRpbWVvdXQnOiAzMDAwMDAsXG4gICAgICAgICdzc2UubWF4Q29ubmVjdGlvbnNQZXJVc2VyJzogNSxcbiAgICAgICAgJ3NzZS5jbGVhbnVwSW50ZXJ2YWwnOiA2MDAwMCxcbiAgICAgIH07XG4gICAgICByZXR1cm4gY29uZmlnW2tleV07XG4gICAgfSksXG4gIH07XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICBTc2VTZXJ2aWNlLFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogSnd0U2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0p3dFNlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBDb25maWdTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrQ29uZmlnU2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8U3NlU2VydmljZT4oU3NlU2VydmljZSk7XG4gICAgand0U2VydmljZSA9IG1vZHVsZS5nZXQ8Snd0U2VydmljZT4oSnd0U2VydmljZSk7XG4gICAgY29uZmlnU2VydmljZSA9IG1vZHVsZS5nZXQ8Q29uZmlnU2VydmljZT4oQ29uZmlnU2VydmljZSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgLy8gTGltcGFyIHRvZGFzIGFzIGNvbmV4w7VlcyBhcMOzcyBjYWRhIHRlc3RlXG4gICAgc2VydmljZS5yZW1vdmVBbGxDb25uZWN0aW9ucygpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJlIGRlZmluZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjcmVhdGVDb25uZWN0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgbmV3IFNTRSBjb25uZWN0aW9uJywgKGRvbmUpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyLTEyMyc7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgaXA6ICcxMjcuMC4wLjEnLFxuICAgICAgICBoZWFkZXJzOiB7ICd1c2VyLWFnZW50JzogJ3Rlc3QtYWdlbnQnIH0sXG4gICAgICB9IGFzIFJlcXVlc3Q7XG5cbiAgICAgIGNvbnN0IG9ic2VydmFibGUgPSBzZXJ2aWNlLmNyZWF0ZUNvbm5lY3Rpb24odXNlcklkLCBtb2NrUmVxdWVzdCk7XG5cbiAgICAgIGV4cGVjdChvYnNlcnZhYmxlKS50b0JlSW5zdGFuY2VPZihPYnNlcnZhYmxlKTtcblxuICAgICAgLy8gVmVyaWZpY2FyIHNlIGEgY29uZXjDo28gZm9pIGFkaWNpb25hZGFcbiAgICAgIGNvbnN0IHN0YXRzID0gc2VydmljZS5nZXRDb25uZWN0aW9uU3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbENvbm5lY3Rpb25zKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHN0YXRzLmFjdGl2ZUNvbm5lY3Rpb25zKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHN0YXRzLmNvbm5lY3Rpb25zQnlVc2VyW3VzZXJJZF0pLnRvQmUoMSk7XG5cbiAgICAgIGRvbmUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbGltaXQgY29ubmVjdGlvbnMgcGVyIHVzZXInLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci0xMjMnO1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyB9LFxuICAgICAgfSBhcyBSZXF1ZXN0O1xuXG4gICAgICAvLyBDcmlhciBvIG3DoXhpbW8gZGUgY29uZXjDtWVzIHBlcm1pdGlkYXNcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICAgIHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VySWQsIG1vY2tSZXF1ZXN0KTtcbiAgICAgIH1cblxuICAgICAgLy8gVGVudGFyIGNyaWFyIHVtYSBjb25leMOjbyBhZGljaW9uYWxcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VySWQsIG1vY2tSZXF1ZXN0KTtcbiAgICAgIH0pLnRvVGhyb3coJ03DoXhpbW8gZGUgY29uZXjDtWVzIHBvciB1c3XDoXJpbyBhdGluZ2lkbycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSB1bmlxdWUgY29ubmVjdGlvbiBJRHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci0xMjMnO1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyB9LFxuICAgICAgfSBhcyBSZXF1ZXN0O1xuXG4gICAgICBjb25zdCBjb25uZWN0aW9uMSA9IHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VySWQsIG1vY2tSZXF1ZXN0KTtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb24yID0gc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXJJZCwgbW9ja1JlcXVlc3QpO1xuXG4gICAgICAvLyBBcyBjb25leMO1ZXMgZGV2ZW0gdGVyIElEcyBkaWZlcmVudGVzXG4gICAgICBleHBlY3QoY29ubmVjdGlvbjEpLm5vdC50b0JlKGNvbm5lY3Rpb24yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NlbmROb3RpZmljYXRpb25Ub1VzZXInLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzZW5kIG5vdGlmaWNhdGlvbiB0byBzcGVjaWZpYyB1c2VyJywgKGRvbmUpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyLTEyMyc7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgaXA6ICcxMjcuMC4wLjEnLFxuICAgICAgICBoZWFkZXJzOiB7ICd1c2VyLWFnZW50JzogJ3Rlc3QtYWdlbnQnIH0sXG4gICAgICB9IGFzIFJlcXVlc3Q7XG5cbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbjogU3NlTm90aWZpY2F0aW9uID0ge1xuICAgICAgICBpZDogJ25vdGlmLTEyMycsXG4gICAgICAgIHR5cGU6ICdub3RpZmljYXRpb24nLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaWQ6ICdub3RpZi0xMjMnLFxuICAgICAgICAgIHRpdHVsbzogJ1Rlc3RlJyxcbiAgICAgICAgICBjb250ZXVkbzogJ0NvbnRlw7pkbyBkZSB0ZXN0ZScsXG4gICAgICAgICAgdGlwbzogJ2luZm8nLFxuICAgICAgICAgIHByaW9yaWRhZGU6ICdtZWRpYScsXG4gICAgICAgICAgZGF0YV9jcmlhY2FvOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgbGlkYTogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICAvLyBDcmlhciBjb25leMOjb1xuICAgICAgY29uc3Qgb2JzZXJ2YWJsZSA9IHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VySWQsIG1vY2tSZXF1ZXN0KTtcblxuICAgICAgLy8gU3Vic2NyZXZlciBwYXJhIHJlY2ViZXIgbm90aWZpY2HDp8O1ZXNcbiAgICAgIG9ic2VydmFibGUuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09ICdub3RpZmljYXRpb24nKSB7XG4gICAgICAgICAgICBleHBlY3QoZXZlbnQuZGF0YS50aXR1bG8pLnRvQmUoJ1Rlc3RlJyk7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEVudmlhciBub3RpZmljYcOnw6NvXG4gICAgICBjb25zdCByZXN1bHQgPSBzZXJ2aWNlLnNlbmROb3RpZmljYXRpb25Ub1VzZXIodXNlcklkLCBub3RpZmljYXRpb24pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGZhbHNlIHdoZW4gdXNlciBoYXMgbm8gY29ubmVjdGlvbnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci13aXRob3V0LWNvbm5lY3Rpb25zJztcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbjogU3NlTm90aWZpY2F0aW9uID0ge1xuICAgICAgICBpZDogJ25vdGlmLTEyMycsXG4gICAgICAgIHR5cGU6ICdub3RpZmljYXRpb24nLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgaWQ6ICdub3RpZi0xMjMnLFxuICAgICAgICAgIHRpdHVsbzogJ1Rlc3RlJyxcbiAgICAgICAgICBjb250ZXVkbzogJ0NvbnRlw7pkbyBkZSB0ZXN0ZScsXG4gICAgICAgICAgdGlwbzogJ2luZm8nLFxuICAgICAgICAgIHByaW9yaWRhZGU6ICdtZWRpYScsXG4gICAgICAgICAgZGF0YV9jcmlhY2FvOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgbGlkYTogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBzZXJ2aWNlLnNlbmROb3RpZmljYXRpb25Ub1VzZXIodXNlcklkLCBub3RpZmljYXRpb24pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdicm9hZGNhc3RUb0FsbFVzZXJzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2VuZCBub3RpZmljYXRpb24gdG8gYWxsIGNvbm5lY3RlZCB1c2VycycsIChkb25lKSA9PiB7XG4gICAgICBjb25zdCB1c2VyMSA9ICd1c2VyLTEnO1xuICAgICAgY29uc3QgdXNlcjIgPSAndXNlci0yJztcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBpcDogJzEyNy4wLjAuMScsXG4gICAgICAgIGhlYWRlcnM6IHsgJ3VzZXItYWdlbnQnOiAndGVzdC1hZ2VudCcgfSxcbiAgICAgIH0gYXMgUmVxdWVzdDtcblxuICAgICAgY29uc3Qgbm90aWZpY2F0aW9uOiBTc2VOb3RpZmljYXRpb24gPSB7XG4gICAgICAgIGlkOiAnbm90aWYtYnJvYWRjYXN0JyxcbiAgICAgICAgdHlwZTogJ25vdGlmaWNhdGlvbicsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBpZDogJ25vdGlmLWJyb2FkY2FzdCcsXG4gICAgICAgICAgdGl0dWxvOiAnQnJvYWRjYXN0JyxcbiAgICAgICAgICBjb250ZXVkbzogJ01lbnNhZ2VtIHBhcmEgdG9kb3MnLFxuICAgICAgICAgIHRpcG86ICdpbmZvJyxcbiAgICAgICAgICBwcmlvcmlkYWRlOiAnbWVkaWEnLFxuICAgICAgICAgIGRhdGFfY3JpYWNhbzogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGxpZGE6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgbGV0IHJlY2VpdmVkQ291bnQgPSAwO1xuICAgICAgY29uc3QgZXhwZWN0ZWRDb3VudCA9IDI7XG5cbiAgICAgIC8vIENyaWFyIGNvbmV4w7VlcyBwYXJhIGRvaXMgdXN1w6FyaW9zXG4gICAgICBjb25zdCBvYnMxID0gc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXIxLCBtb2NrUmVxdWVzdCk7XG4gICAgICBjb25zdCBvYnMyID0gc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXIyLCBtb2NrUmVxdWVzdCk7XG5cbiAgICAgIC8vIFN1YnNjcmV2ZXIgYW1iYXMgYXMgY29uZXjDtWVzXG4gICAgICBbb2JzMSwgb2JzMl0uZm9yRWFjaCgob2JzKSA9PiB7XG4gICAgICAgIG9icy5zdWJzY3JpYmUoe1xuICAgICAgICAgIG5leHQ6IChldmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09ICdub3RpZmljYXRpb24nKSB7XG4gICAgICAgICAgICAgIHJlY2VpdmVkQ291bnQrKztcbiAgICAgICAgICAgICAgaWYgKHJlY2VpdmVkQ291bnQgPT09IGV4cGVjdGVkQ291bnQpIHtcbiAgICAgICAgICAgICAgICBkb25lKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBFbnZpYXIgYnJvYWRjYXN0XG4gICAgICBjb25zdCByZXN1bHQgPSBzZXJ2aWNlLmJyb2FkY2FzdFRvQWxsVXNlcnMobm90aWZpY2F0aW9uKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoMik7IC8vIERldmUgcmV0b3JuYXIgbyBuw7ptZXJvIGRlIHVzdcOhcmlvcyBxdWUgcmVjZWJlcmFtXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZW1vdmVDb25uZWN0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVtb3ZlIHNwZWNpZmljIGNvbm5lY3Rpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci0xMjMnO1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyB9LFxuICAgICAgfSBhcyBSZXF1ZXN0O1xuXG4gICAgICAvLyBDcmlhciBjb25leMOjb1xuICAgICAgc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXJJZCwgbW9ja1JlcXVlc3QpO1xuXG4gICAgICBsZXQgc3RhdHMgPSBzZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsQ29ubmVjdGlvbnMpLnRvQmUoMSk7XG5cbiAgICAgIC8vIE9idGVyIElEIGRhIGNvbmV4w6NvIChzaW11bGFkbylcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb25zID0gc2VydmljZVsnY29ubmVjdGlvbnMnXTtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb25JZCA9IEFycmF5LmZyb20oY29ubmVjdGlvbnMua2V5cygpKVswXTtcblxuICAgICAgLy8gUmVtb3ZlciBjb25leMOjb1xuICAgICAgc2VydmljZS5yZW1vdmVDb25uZWN0aW9uKGNvbm5lY3Rpb25JZCk7XG5cbiAgICAgIHN0YXRzID0gc2VydmljZS5nZXRDb25uZWN0aW9uU3RhdHMoKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbENvbm5lY3Rpb25zKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHN0YXRzLmFjdGl2ZUNvbm5lY3Rpb25zKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVtb3ZlVXNlckNvbm5lY3Rpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVtb3ZlIGFsbCBjb25uZWN0aW9ucyBmb3IgYSB1c2VyJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXItMTIzJztcbiAgICAgIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBpcDogJzEyNy4wLjAuMScsXG4gICAgICAgIGhlYWRlcnM6IHsgJ3VzZXItYWdlbnQnOiAndGVzdC1hZ2VudCcgfSxcbiAgICAgIH0gYXMgUmVxdWVzdDtcblxuICAgICAgLy8gQ3JpYXIgbcO6bHRpcGxhcyBjb25leMO1ZXMgcGFyYSBvIG1lc21vIHVzdcOhcmlvXG4gICAgICBzZXJ2aWNlLmNyZWF0ZUNvbm5lY3Rpb24odXNlcklkLCBtb2NrUmVxdWVzdCk7XG4gICAgICBzZXJ2aWNlLmNyZWF0ZUNvbm5lY3Rpb24odXNlcklkLCBtb2NrUmVxdWVzdCk7XG4gICAgICBzZXJ2aWNlLmNyZWF0ZUNvbm5lY3Rpb24odXNlcklkLCBtb2NrUmVxdWVzdCk7XG5cbiAgICAgIGxldCBzdGF0cyA9IHNlcnZpY2UuZ2V0Q29ubmVjdGlvblN0YXRzKCk7XG4gICAgICBleHBlY3Qoc3RhdHMuY29ubmVjdGlvbnNCeVVzZXJbdXNlcklkXSkudG9CZSgzKTtcblxuICAgICAgLy8gUmVtb3ZlciB0b2RhcyBhcyBjb25leMO1ZXMgZG8gdXN1w6FyaW9cbiAgICAgIGNvbnN0IHJlbW92ZWRDb3VudCA9IHNlcnZpY2UucmVtb3ZlVXNlckNvbm5lY3Rpb25zKHVzZXJJZCk7XG4gICAgICBleHBlY3QocmVtb3ZlZENvdW50KS50b0JlKDMpO1xuXG4gICAgICBzdGF0cyA9IHNlcnZpY2UuZ2V0Q29ubmVjdGlvblN0YXRzKCk7XG4gICAgICBleHBlY3Qoc3RhdHMuY29ubmVjdGlvbnNCeVVzZXJbdXNlcklkXSkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsQ29ubmVjdGlvbnMpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpc1VzZXJDb25uZWN0ZWQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdHJ1ZSB3aGVuIHVzZXIgaGFzIGFjdGl2ZSBjb25uZWN0aW9ucycsICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyLTEyMyc7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgaXA6ICcxMjcuMC4wLjEnLFxuICAgICAgICBoZWFkZXJzOiB7ICd1c2VyLWFnZW50JzogJ3Rlc3QtYWdlbnQnIH0sXG4gICAgICB9IGFzIFJlcXVlc3Q7XG5cbiAgICAgIGV4cGVjdChzZXJ2aWNlLmlzVXNlckNvbm5lY3RlZCh1c2VySWQpKS50b0JlKGZhbHNlKTtcblxuICAgICAgc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXJJZCwgbW9ja1JlcXVlc3QpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuaXNVc2VyQ29ubmVjdGVkKHVzZXJJZCkpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRVc2VyQ29ubmVjdGlvbkNvdW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgY29ubmVjdGlvbiBjb3VudCBmb3IgdXNlcicsICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyLTEyMyc7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgaXA6ICcxMjcuMC4wLjEnLFxuICAgICAgICBoZWFkZXJzOiB7ICd1c2VyLWFnZW50JzogJ3Rlc3QtYWdlbnQnIH0sXG4gICAgICB9IGFzIFJlcXVlc3Q7XG5cbiAgICAgIGV4cGVjdChzZXJ2aWNlLmdldFVzZXJDb25uZWN0aW9uQ291bnQodXNlcklkKSkudG9CZSgwKTtcblxuICAgICAgc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXJJZCwgbW9ja1JlcXVlc3QpO1xuICAgICAgZXhwZWN0KHNlcnZpY2UuZ2V0VXNlckNvbm5lY3Rpb25Db3VudCh1c2VySWQpKS50b0JlKDEpO1xuXG4gICAgICBzZXJ2aWNlLmNyZWF0ZUNvbm5lY3Rpb24odXNlcklkLCBtb2NrUmVxdWVzdCk7XG4gICAgICBleHBlY3Qoc2VydmljZS5nZXRVc2VyQ29ubmVjdGlvbkNvdW50KHVzZXJJZCkpLnRvQmUoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRDb25uZWN0aW9uU3RhdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYWNjdXJhdGUgY29ubmVjdGlvbiBzdGF0aXN0aWNzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcjEgPSAndXNlci0xJztcbiAgICAgIGNvbnN0IHVzZXIyID0gJ3VzZXItMic7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgaXA6ICcxMjcuMC4wLjEnLFxuICAgICAgICBoZWFkZXJzOiB7ICd1c2VyLWFnZW50JzogJ3Rlc3QtYWdlbnQnIH0sXG4gICAgICB9IGFzIFJlcXVlc3Q7XG5cbiAgICAgIC8vIEVzdGFkbyBpbmljaWFsXG4gICAgICBsZXQgc3RhdHMgPSBzZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsQ29ubmVjdGlvbnMpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3RhdHMuYWN0aXZlQ29ubmVjdGlvbnMpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3RhdHMudW5pcXVlVXNlcnMpLnRvQmUoMCk7XG5cbiAgICAgIC8vIEFkaWNpb25hciBjb25leMO1ZXNcbiAgICAgIHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VyMSwgbW9ja1JlcXVlc3QpO1xuICAgICAgc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXIxLCBtb2NrUmVxdWVzdCk7XG4gICAgICBzZXJ2aWNlLmNyZWF0ZUNvbm5lY3Rpb24odXNlcjIsIG1vY2tSZXF1ZXN0KTtcblxuICAgICAgc3RhdHMgPSBzZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsQ29ubmVjdGlvbnMpLnRvQmUoMyk7XG4gICAgICBleHBlY3Qoc3RhdHMuYWN0aXZlQ29ubmVjdGlvbnMpLnRvQmUoMyk7XG4gICAgICBleHBlY3Qoc3RhdHMudW5pcXVlVXNlcnMpLnRvQmUoMik7XG4gICAgICBleHBlY3Qoc3RhdHMuY29ubmVjdGlvbnNCeVVzZXJbdXNlcjFdKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHN0YXRzLmNvbm5lY3Rpb25zQnlVc2VyW3VzZXIyXSkudG9CZSgxKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hlYXJ0YmVhdCBmdW5jdGlvbmFsaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2VuZCBoZWFydGJlYXQgZXZlbnRzJywgKGRvbmUpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyLTEyMyc7XG4gICAgICBjb25zdCBtb2NrUmVxdWVzdCA9IHtcbiAgICAgICAgaXA6ICcxMjcuMC4wLjEnLFxuICAgICAgICBoZWFkZXJzOiB7ICd1c2VyLWFnZW50JzogJ3Rlc3QtYWdlbnQnIH0sXG4gICAgICB9IGFzIFJlcXVlc3Q7XG5cbiAgICAgIGNvbnN0IG9ic2VydmFibGUgPSBzZXJ2aWNlLmNyZWF0ZUNvbm5lY3Rpb24odXNlcklkLCBtb2NrUmVxdWVzdCk7XG5cbiAgICAgIG9ic2VydmFibGUuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKGV2ZW50KSA9PiB7XG4gICAgICAgICAgaWYgKGV2ZW50LnR5cGUgPT09ICdoZWFydGJlYXQnKSB7XG4gICAgICAgICAgICBleHBlY3QoZXZlbnQuZGF0YS50aW1lc3RhbXApLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICBleHBlY3QoZXZlbnQuZGF0YS5zZXJ2ZXJfdGltZSkudG9CZURlZmluZWQoKTtcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gU2ltdWxhciBlbnZpbyBkZSBoZWFydGJlYXRcbiAgICAgIHNlcnZpY2VbJ3NlbmRIZWFydGJlYXQnXSgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2xlYW51cCBmdW5jdGlvbmFsaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2xlYW4gdXAgaW5hY3RpdmUgY29ubmVjdGlvbnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci0xMjMnO1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyB9LFxuICAgICAgfSBhcyBSZXF1ZXN0O1xuXG4gICAgICAvLyBDcmlhciBjb25leMOjb1xuICAgICAgc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXJJZCwgbW9ja1JlcXVlc3QpO1xuXG4gICAgICBsZXQgc3RhdHMgPSBzZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsQ29ubmVjdGlvbnMpLnRvQmUoMSk7XG5cbiAgICAgIC8vIFNpbXVsYXIgY29uZXjDo28gaW5hdGl2YSAobW9kaWZpY2FyIHRpbWVzdGFtcClcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb25zID0gc2VydmljZVsnY29ubmVjdGlvbnMnXTtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBBcnJheS5mcm9tKGNvbm5lY3Rpb25zLnZhbHVlcygpKVswXTtcbiAgICAgIGNvbm5lY3Rpb24ubGFzdEFjdGl2aXR5ID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIDQwMDAwMCk7IC8vIDYgbWludXRvcyBhdHLDoXNcblxuICAgICAgLy8gRXhlY3V0YXIgbGltcGV6YVxuICAgICAgc2VydmljZVsnY2xlYW51cEluYWN0aXZlQ29ubmVjdGlvbnMnXSgpO1xuXG4gICAgICBzdGF0cyA9IHNlcnZpY2UuZ2V0Q29ubmVjdGlvblN0YXRzKCk7XG4gICAgICBleHBlY3Qoc3RhdHMudG90YWxDb25uZWN0aW9ucykudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Vycm9yIGhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgbm90aWZpY2F0aW9uIGRhdGEgZ3JhY2VmdWxseScsICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd1c2VyLTEyMyc7XG4gICAgICBjb25zdCBpbnZhbGlkTm90aWZpY2F0aW9uID0gbnVsbCBhcyBhbnk7XG5cbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIHNlcnZpY2Uuc2VuZE5vdGlmaWNhdGlvblRvVXNlcih1c2VySWQsIGludmFsaWROb3RpZmljYXRpb24pO1xuICAgICAgfSkubm90LnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbm5lY3Rpb24gZXJyb3JzIGdyYWNlZnVsbHknLCAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VySWQgPSAndXNlci0xMjMnO1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyB9LFxuICAgICAgfSBhcyBSZXF1ZXN0O1xuXG4gICAgICBjb25zdCBvYnNlcnZhYmxlID0gc2VydmljZS5jcmVhdGVDb25uZWN0aW9uKHVzZXJJZCwgbW9ja1JlcXVlc3QpO1xuXG4gICAgICAvLyBTaW11bGFyIGVycm8gbmEgY29uZXjDo29cbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIG9ic2VydmFibGUuc3Vic2NyaWJlKHtcbiAgICAgICAgICBlcnJvcjogKGVycm9yKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3IpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9KS5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbWVtb3J5IG1hbmFnZW1lbnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBub3QgZXhjZWVkIG1lbW9yeSBsaW1pdHMgd2l0aCBtYW55IGNvbm5lY3Rpb25zJywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczogeyAndXNlci1hZ2VudCc6ICd0ZXN0LWFnZW50JyB9LFxuICAgICAgfSBhcyBSZXF1ZXN0O1xuXG4gICAgICAvLyBDcmlhciBtdWl0YXMgY29uZXjDtWVzIHBhcmEgdXN1w6FyaW9zIGRpZmVyZW50ZXNcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTAwOyBpKyspIHtcbiAgICAgICAgY29uc3QgdXNlcklkID0gYHVzZXItJHtpfWA7XG4gICAgICAgIHNlcnZpY2UuY3JlYXRlQ29ubmVjdGlvbih1c2VySWQsIG1vY2tSZXF1ZXN0KTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3RhdHMgPSBzZXJ2aWNlLmdldENvbm5lY3Rpb25TdGF0cygpO1xuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsQ29ubmVjdGlvbnMpLnRvQmUoMTAwKTtcbiAgICAgIGV4cGVjdChzdGF0cy51bmlxdWVVc2VycykudG9CZSgxMDApO1xuXG4gICAgICAvLyBWZXJpZmljYXIgc2UgbyBzZXJ2acOnbyBhaW5kYSBlc3TDoSByZXNwb25zaXZvXG4gICAgICBleHBlY3Qoc2VydmljZS5pc1VzZXJDb25uZWN0ZWQoJ3VzZXItNTAnKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==