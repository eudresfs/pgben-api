7f8ac3365d924dc16086420a77fd33d7
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", { value: true });
exports.JwtBlacklist = void 0;
const typeorm_1 = require("typeorm");
const class_validator_1 = require("class-validator");
const swagger_1 = require("@nestjs/swagger");
/**
 * Entidade JWT Blacklist
 *
 * Armazena tokens JWT invalidados para prevenir reutilização
 * de tokens comprometidos ou revogados
 */
let JwtBlacklist = class JwtBlacklist {
    id;
    jti;
    usuario_id;
    token_type;
    expires_at;
    reason;
    client_ip;
    user_agent;
    metadata;
    created_at;
    updated_at;
    /**
     * Verifica se o token ainda está na blacklist (não expirou)
     * @returns true se ainda está blacklisted
     */
    isStillBlacklisted() {
        return new Date() < this.expires_at;
    }
    /**
     * Verifica se o token pode ser removido da blacklist
     * @returns true se pode ser removido
     */
    canBeRemoved() {
        return new Date() >= this.expires_at;
    }
    /**
     * Obtém o tempo restante até a expiração em minutos
     * @returns minutos até expiração
     */
    getMinutesUntilExpiration() {
        const now = new Date();
        const diffMs = this.expires_at.getTime() - now.getTime();
        return Math.max(0, Math.floor(diffMs / (1000 * 60)));
    }
    /**
     * Adiciona metadados ao registro
     * @param key Chave do metadado
     * @param value Valor do metadado
     */
    addMetadata(key, value) {
        if (!this.metadata) {
            this.metadata = {};
        }
        this.metadata[key] = value;
    }
    /**
     * Obtém um metadado específico
     * @param key Chave do metadado
     * @returns Valor do metadado ou undefined
     */
    getMetadata(key) {
        return this.metadata?.[key];
    }
    /**
     * Verifica se o token pertence a um usuário específico
     * @param usuarioId ID do usuário
     * @returns true se pertence ao usuário
     */
    belongsToUser(usuarioId) {
        return this.usuario_id === usuarioId;
    }
    /**
     * Verifica se é um token de acesso
     * @returns true se é access token
     */
    isAccessToken() {
        return this.token_type === 'access';
    }
    /**
     * Verifica se é um token de refresh
     * @returns true se é refresh token
     */
    isRefreshToken() {
        return this.token_type === 'refresh';
    }
    /**
     * Verifica se o token foi invalidado recentemente (últimas 24 horas)
     * @returns true se foi invalidado recentemente
     */
    wasRecentlyBlacklisted() {
        const now = new Date();
        const oneDayAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);
        return this.created_at > oneDayAgo;
    }
    /**
     * Calcula há quantos minutos o token foi blacklisted
     * @returns minutos desde a blacklist
     */
    getMinutesSinceBlacklisted() {
        const now = new Date();
        const diffMs = now.getTime() - this.created_at.getTime();
        return Math.floor(diffMs / (1000 * 60));
    }
    /**
     * Verifica se o token expira em breve (próximas 2 horas)
     * @returns true se expira em breve
     */
    expiresWithin(hours = 2) {
        const now = new Date();
        const futureTime = new Date(now.getTime() + hours * 60 * 60 * 1000);
        return this.expires_at <= futureTime;
    }
    /**
     * Obtém informações resumidas do token blacklisted
     * @returns objeto com informações resumidas
     */
    getSummary() {
        return {
            id: this.id,
            jti: this.jti,
            usuario_id: this.usuario_id,
            token_type: this.token_type,
            reason: this.reason,
            expires_at: this.expires_at,
            created_at: this.created_at,
            isStillBlacklisted: this.isStillBlacklisted(),
            minutesUntilExpiration: this.getMinutesUntilExpiration(),
        };
    }
    /**
     * Verifica se tem informações de cliente (IP e User Agent)
     * @returns true se tem informações de cliente
     */
    hasClientInfo() {
        return !!(this.client_ip || this.user_agent);
    }
    /**
     * Obtém uma descrição legível do motivo da blacklist
     * @returns descrição formatada
     */
    getReasonDescription() {
        const reasonMap = {
            user_logout: 'Logout do usuário',
            token_compromised: 'Token comprometido',
            password_changed: 'Senha alterada',
            account_suspended: 'Conta suspensa',
            security_breach: 'Violação de segurança',
            admin_revoke: 'Revogado pelo administrador',
            expired: 'Token expirado',
            invalid_use: 'Uso inválido',
        };
        return reasonMap[this.reason] || this.reason;
    }
    /**
     * Verifica se o token foi blacklisted por motivos de segurança
     * @returns true se foi por motivos de segurança
     */
    isSecurityRelated() {
        const securityReasons = [
            'token_compromised',
            'password_changed',
            'account_suspended',
            'security_breach',
            'admin_revoke',
        ];
        return securityReasons.includes(this.reason);
    }
    /**
     * Gera uma chave única para o token blacklisted
     * @returns chave única
     */
    getUniqueKey() {
        return `blacklist_${this.jti}_${this.usuario_id}`;
    }
    /**
     * Verifica se o registro está em estado consistente
     * @returns true se está consistente
     */
    isConsistent() {
        return (!!this.id &&
            !!this.jti &&
            !!this.usuario_id &&
            !!this.token_type &&
            !!this.reason &&
            !!this.expires_at &&
            !!this.created_at);
    }
    /**
     * Remove metadados sensíveis para logs
     * @returns objeto sanitizado
     */
    toSafeLog() {
        return {
            id: this.id,
            jti: this.jti.substring(0, 8) + '...',
            usuario_id: this.usuario_id,
            token_type: this.token_type,
            reason: this.reason,
            expires_at: this.expires_at,
            created_at: this.created_at,
            hasClientInfo: this.hasClientInfo(),
        };
    }
    /**
     * Formata a data de expiração para exibição
     * @returns data formatada
     */
    getExpiracaoFormatada() {
        return this.expires_at.toLocaleString('pt-BR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
        });
    }
    /**
     * Formata a data de criação para exibição
     * @returns data formatada
     */
    getCriacaoFormatada() {
        return this.created_at.toLocaleString('pt-BR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
        });
    }
};
exports.JwtBlacklist = JwtBlacklist;
__decorate([
    (0, swagger_1.ApiProperty)({
        description: 'ID único do registro',
        example: 'uuid-v4',
    }),
    (0, typeorm_1.PrimaryGeneratedColumn)('uuid'),
    __metadata("design:type", String)
], JwtBlacklist.prototype, "id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        description: 'JWT ID (jti) - Identificador único do token',
        example: 'jti-uuid-v4',
    }),
    (0, typeorm_1.Column)({ type: 'varchar', length: 255, unique: true }),
    (0, typeorm_1.Index)(),
    (0, class_validator_1.IsNotEmpty)({ message: 'JTI é obrigatório' }),
    (0, class_validator_1.IsString)({ message: 'JTI deve ser uma string' }),
    (0, class_validator_1.Length)(10, 255, { message: 'JTI deve ter entre 10 e 255 caracteres' }),
    __metadata("design:type", String)
], JwtBlacklist.prototype, "jti", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        description: 'ID do usuário proprietário do token',
        example: 'user-uuid-v4',
    }),
    (0, typeorm_1.Column)({ type: 'uuid' }),
    (0, class_validator_1.IsNotEmpty)({ message: 'ID do usuário é obrigatório' }),
    (0, class_validator_1.IsUUID)('4', { message: 'ID do usuário inválido' }),
    __metadata("design:type", String)
], JwtBlacklist.prototype, "usuario_id", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        description: 'Tipo do token (access, refresh)',
        example: 'access',
    }),
    (0, typeorm_1.Column)({
        type: 'enum',
        enum: ['access', 'refresh'],
        default: 'access',
    }),
    (0, class_validator_1.IsEnum)(['access', 'refresh'], {
        message: 'Tipo de token deve ser access ou refresh',
    }),
    __metadata("design:type", String)
], JwtBlacklist.prototype, "token_type", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        description: 'Data de expiração original do token',
        example: '2024-01-15T10:30:00Z',
    }),
    (0, typeorm_1.Column)({ type: 'timestamp with time zone' }),
    __metadata("design:type", typeof (_a = typeof Date !== "undefined" && Date) === "function" ? _a : Object)
], JwtBlacklist.prototype, "expires_at", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        description: 'Motivo da invalidação',
        example: 'user_logout',
    }),
    (0, typeorm_1.Column)({ type: 'varchar', length: 100 }),
    (0, class_validator_1.IsNotEmpty)({ message: 'Motivo da invalidação é obrigatório' }),
    (0, class_validator_1.IsString)({ message: 'Motivo deve ser uma string' }),
    (0, class_validator_1.Length)(3, 100, { message: 'Motivo deve ter entre 3 e 100 caracteres' }),
    __metadata("design:type", String)
], JwtBlacklist.prototype, "reason", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        description: 'IP do cliente quando o token foi invalidado',
        example: '192.168.1.100',
        required: false,
    }),
    (0, typeorm_1.Column)({ type: 'varchar', length: 45, nullable: true }),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsString)({ message: 'IP do cliente deve ser uma string' }),
    (0, class_validator_1.Length)(7, 45, { message: 'IP do cliente deve ter entre 7 e 45 caracteres' }),
    __metadata("design:type", String)
], JwtBlacklist.prototype, "client_ip", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        description: 'User Agent do cliente',
        required: false,
    }),
    (0, typeorm_1.Column)({ type: 'text', nullable: true }),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsString)({ message: 'User Agent deve ser uma string' }),
    __metadata("design:type", String)
], JwtBlacklist.prototype, "user_agent", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        description: 'Metadados adicionais em formato JSON',
        required: false,
    }),
    (0, typeorm_1.Column)({ type: 'jsonb', nullable: true }),
    __metadata("design:type", typeof (_b = typeof Record !== "undefined" && Record) === "function" ? _b : Object)
], JwtBlacklist.prototype, "metadata", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        description: 'Data de criação do registro',
        example: '2024-01-01T10:00:00Z',
    }),
    (0, typeorm_1.CreateDateColumn)({ type: 'timestamp with time zone' }),
    __metadata("design:type", typeof (_c = typeof Date !== "undefined" && Date) === "function" ? _c : Object)
], JwtBlacklist.prototype, "created_at", void 0);
__decorate([
    (0, swagger_1.ApiProperty)({
        description: 'Data da última atualização',
        example: '2024-01-01T10:00:00Z',
    }),
    (0, typeorm_1.UpdateDateColumn)({ type: 'timestamp with time zone' }),
    __metadata("design:type", typeof (_d = typeof Date !== "undefined" && Date) === "function" ? _d : Object)
], JwtBlacklist.prototype, "updated_at", void 0);
exports.JwtBlacklist = JwtBlacklist = __decorate([
    (0, typeorm_1.Entity)('jwt_blacklist'),
    (0, typeorm_1.Index)(['jti'], { unique: true }),
    (0, typeorm_1.Index)(['usuario_id']),
    (0, typeorm_1.Index)(['expires_at']),
    (0, typeorm_1.Index)(['created_at'])
], JwtBlacklist);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGVudGl0aWVzXFxqd3QtYmxhY2tsaXN0LmVudGl0eS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUEscUNBT2lCO0FBQ2pCLHFEQU95QjtBQUN6Qiw2Q0FBOEM7QUFFOUM7Ozs7O0dBS0c7QUFNSSxJQUFNLFlBQVksR0FBbEIsTUFBTSxZQUFZO0lBTXZCLEVBQUUsQ0FBUztJQVdYLEdBQUcsQ0FBUztJQVNaLFVBQVUsQ0FBUztJQWNuQixVQUFVLENBQXVCO0lBT2pDLFVBQVUsQ0FBTztJQVVqQixNQUFNLENBQVM7SUFXZixTQUFTLENBQVU7SUFTbkIsVUFBVSxDQUFVO0lBT3BCLFFBQVEsQ0FBdUI7SUFPL0IsVUFBVSxDQUFPO0lBT2pCLFVBQVUsQ0FBTztJQUVqQjs7O09BR0c7SUFDSCxrQkFBa0I7UUFDaEIsT0FBTyxJQUFJLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDdEMsQ0FBQztJQUVEOzs7T0FHRztJQUNILFlBQVk7UUFDVixPQUFPLElBQUksSUFBSSxFQUFFLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN2QyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gseUJBQXlCO1FBQ3ZCLE1BQU0sR0FBRyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDdkIsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDekQsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxXQUFXLENBQUMsR0FBVyxFQUFFLEtBQVU7UUFDakMsSUFBSSxDQUFDLElB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RUFBQztRQUNYLFdBQVcsRUFBRSxzQ0FBc0M7UUFDbkQsUUFBUSxFQUFFLEtBQUs7S0FDaEIsQ0FBQztJQUNELElBQUEsZ0JBQU0sRUFBQyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDO2tEQUMvQixNQUFNLG9CQUFOLE1BQU07OENBQWM7QUFPL0I7SUFMQyxJQUFBLHFCQUFXLEVBQUM7UUFDWCxXQUFXLEVBQUUsNkJBQTZCO1FBQzFDLE9BQU8sRUFBRSxzQkFBc0I7S0FDaEMsQ0FBQztJQUNELElBQUEsMEJBQWdCLEVBQUMsRUFBRSxJQUFJLEVBQUUsMEJBQTBCLEVBQUUsQ0FBQztrREFDM0MsSUFBSSxvQkFBSixJQUFJO2dEQUFDO0FBT2pCO0lBTEMsSUFBQSxxQkFBVyxFQUFDO1FBQ1gsV0FBVyxFQUFFLDRCQUE0QjtRQUN6QyxPQUFPLEVBQUUsc0JBQXNCO0tBQ2hDLENBQUM7SUFDRCxJQUFBLDBCQUFnQixFQUFDLEVBQUUsSUFBSSxFQUFFLDBCQUEwQixFQUFFLENBQUM7a0RBQzNDLElBQUksb0JBQUosSUFBSTtnREFBQzt1QkFsR04sWUFBWTtJQUx4QixJQUFBLGdCQUFNLEVBQUMsZUFBZSxDQUFDO0lBQ3ZCLElBQUEsZUFBSyxFQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7SUFDaEMsSUFBQSxlQUFLLEVBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUNyQixJQUFBLGVBQUssRUFBQyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ3JCLElBQUEsZUFBSyxFQUFDLENBQUMsWUFBWSxDQUFDLENBQUM7R0FDVCxZQUFZLENBOFZ4QiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcZW50aXRpZXNcXGp3dC1ibGFja2xpc3QuZW50aXR5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEVudGl0eSxcbiAgUHJpbWFyeUdlbmVyYXRlZENvbHVtbixcbiAgQ29sdW1uLFxuICBDcmVhdGVEYXRlQ29sdW1uLFxuICBVcGRhdGVEYXRlQ29sdW1uLFxuICBJbmRleCxcbn0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQge1xuICBJc05vdEVtcHR5LFxuICBJc1VVSUQsXG4gIElzU3RyaW5nLFxuICBJc0VudW0sXG4gIElzT3B0aW9uYWwsXG4gIExlbmd0aCxcbn0gZnJvbSAnY2xhc3MtdmFsaWRhdG9yJztcbmltcG9ydCB7IEFwaVByb3BlcnR5IH0gZnJvbSAnQG5lc3Rqcy9zd2FnZ2VyJztcblxuLyoqXG4gKiBFbnRpZGFkZSBKV1QgQmxhY2tsaXN0XG4gKlxuICogQXJtYXplbmEgdG9rZW5zIEpXVCBpbnZhbGlkYWRvcyBwYXJhIHByZXZlbmlyIHJldXRpbGl6YcOnw6NvXG4gKiBkZSB0b2tlbnMgY29tcHJvbWV0aWRvcyBvdSByZXZvZ2Fkb3NcbiAqL1xuQEVudGl0eSgnand0X2JsYWNrbGlzdCcpXG5ASW5kZXgoWydqdGknXSwgeyB1bmlxdWU6IHRydWUgfSlcbkBJbmRleChbJ3VzdWFyaW9faWQnXSlcbkBJbmRleChbJ2V4cGlyZXNfYXQnXSlcbkBJbmRleChbJ2NyZWF0ZWRfYXQnXSlcbmV4cG9ydCBjbGFzcyBKd3RCbGFja2xpc3Qge1xuICBAQXBpUHJvcGVydHkoe1xuICAgIGRlc2NyaXB0aW9uOiAnSUQgw7puaWNvIGRvIHJlZ2lzdHJvJyxcbiAgICBleGFtcGxlOiAndXVpZC12NCcsXG4gIH0pXG4gIEBQcmltYXJ5R2VuZXJhdGVkQ29sdW1uKCd1dWlkJylcbiAgaWQ6IHN0cmluZztcblxuICBAQXBpUHJvcGVydHkoe1xuICAgIGRlc2NyaXB0aW9uOiAnSldUIElEIChqdGkpIC0gSWRlbnRpZmljYWRvciDDum5pY28gZG8gdG9rZW4nLFxuICAgIGV4YW1wbGU6ICdqdGktdXVpZC12NCcsXG4gIH0pXG4gIEBDb2x1bW4oeyB0eXBlOiAndmFyY2hhcicsIGxlbmd0aDogMjU1LCB1bmlxdWU6IHRydWUgfSlcbiAgQEluZGV4KClcbiAgQElzTm90RW1wdHkoeyBtZXNzYWdlOiAnSlRJIMOpIG9icmlnYXTDs3JpbycgfSlcbiAgQElzU3RyaW5nKHsgbWVzc2FnZTogJ0pUSSBkZXZlIHNlciB1bWEgc3RyaW5nJyB9KVxuICBATGVuZ3RoKDEwLCAyNTUsIHsgbWVzc2FnZTogJ0pUSSBkZXZlIHRlciBlbnRyZSAxMCBlIDI1NSBjYXJhY3RlcmVzJyB9KVxuICBqdGk6IHN0cmluZztcblxuICBAQXBpUHJvcGVydHkoe1xuICAgIGRlc2NyaXB0aW9uOiAnSUQgZG8gdXN1w6FyaW8gcHJvcHJpZXTDoXJpbyBkbyB0b2tlbicsXG4gICAgZXhhbXBsZTogJ3VzZXItdXVpZC12NCcsXG4gIH0pXG4gIEBDb2x1bW4oeyB0eXBlOiAndXVpZCcgfSlcbiAgQElzTm90RW1wdHkoeyBtZXNzYWdlOiAnSUQgZG8gdXN1w6FyaW8gw6kgb2JyaWdhdMOzcmlvJyB9KVxuICBASXNVVUlEKCc0JywgeyBtZXNzYWdlOiAnSUQgZG8gdXN1w6FyaW8gaW52w6FsaWRvJyB9KVxuICB1c3VhcmlvX2lkOiBzdHJpbmc7XG5cbiAgQEFwaVByb3BlcnR5KHtcbiAgICBkZXNjcmlwdGlvbjogJ1RpcG8gZG8gdG9rZW4gKGFjY2VzcywgcmVmcmVzaCknLFxuICAgIGV4YW1wbGU6ICdhY2Nlc3MnLFxuICB9KVxuICBAQ29sdW1uKHtcbiAgICB0eXBlOiAnZW51bScsXG4gICAgZW51bTogWydhY2Nlc3MnLCAncmVmcmVzaCddLFxuICAgIGRlZmF1bHQ6ICdhY2Nlc3MnLFxuICB9KVxuICBASXNFbnVtKFsnYWNjZXNzJywgJ3JlZnJlc2gnXSwge1xuICAgIG1lc3NhZ2U6ICdUaXBvIGRlIHRva2VuIGRldmUgc2VyIGFjY2VzcyBvdSByZWZyZXNoJyxcbiAgfSlcbiAgdG9rZW5fdHlwZTogJ2FjY2VzcycgfCAncmVmcmVzaCc7XG5cbiAgQEFwaVByb3BlcnR5KHtcbiAgICBkZXNjcmlwdGlvbjogJ0RhdGEgZGUgZXhwaXJhw6fDo28gb3JpZ2luYWwgZG8gdG9rZW4nLFxuICAgIGV4YW1wbGU6ICcyMDI0LTAxLTE1VDEwOjMwOjAwWicsXG4gIH0pXG4gIEBDb2x1bW4oeyB0eXBlOiAndGltZXN0YW1wIHdpdGggdGltZSB6b25lJyB9KVxuICBleHBpcmVzX2F0OiBEYXRlO1xuXG4gIEBBcGlQcm9wZXJ0eSh7XG4gICAgZGVzY3JpcHRpb246ICdNb3Rpdm8gZGEgaW52YWxpZGHDp8OjbycsXG4gICAgZXhhbXBsZTogJ3VzZXJfbG9nb3V0JyxcbiAgfSlcbiAgQENvbHVtbih7IHR5cGU6ICd2YXJjaGFyJywgbGVuZ3RoOiAxMDAgfSlcbiAgQElzTm90RW1wdHkoeyBtZXNzYWdlOiAnTW90aXZvIGRhIGludmFsaWRhw6fDo28gw6kgb2JyaWdhdMOzcmlvJyB9KVxuICBASXNTdHJpbmcoeyBtZXNzYWdlOiAnTW90aXZvIGRldmUgc2VyIHVtYSBzdHJpbmcnIH0pXG4gIEBMZW5ndGgoMywgMTAwLCB7IG1lc3NhZ2U6ICdNb3Rpdm8gZGV2ZSB0ZXIgZW50cmUgMyBlIDEwMCBjYXJhY3RlcmVzJyB9KVxuICByZWFzb246IHN0cmluZztcblxuICBAQXBpUHJvcGVydHkoe1xuICAgIGRlc2NyaXB0aW9uOiAnSVAgZG8gY2xpZW50ZSBxdWFuZG8gbyB0b2tlbiBmb2kgaW52YWxpZGFkbycsXG4gICAgZXhhbXBsZTogJzE5Mi4xNjguMS4xMDAnLFxuICAgIHJlcXVpcmVkOiBmYWxzZSxcbiAgfSlcbiAgQENvbHVtbih7IHR5cGU6ICd2YXJjaGFyJywgbGVuZ3RoOiA0NSwgbnVsbGFibGU6IHRydWUgfSlcbiAgQElzT3B0aW9uYWwoKVxuICBASXNTdHJpbmcoeyBtZXNzYWdlOiAnSVAgZG8gY2xpZW50ZSBkZXZlIHNlciB1bWEgc3RyaW5nJyB9KVxuICBATGVuZ3RoKDcsIDQ1LCB7IG1lc3NhZ2U6ICdJUCBkbyBjbGllbnRlIGRldmUgdGVyIGVudHJlIDcgZSA0NSBjYXJhY3RlcmVzJyB9KVxuICBjbGllbnRfaXA/OiBzdHJpbmc7XG5cbiAgQEFwaVByb3BlcnR5KHtcbiAgICBkZXNjcmlwdGlvbjogJ1VzZXIgQWdlbnQgZG8gY2xpZW50ZScsXG4gICAgcmVxdWlyZWQ6IGZhbHNlLFxuICB9KVxuICBAQ29sdW1uKHsgdHlwZTogJ3RleHQnLCBudWxsYWJsZTogdHJ1ZSB9KVxuICBASXNPcHRpb25hbCgpXG4gIEBJc1N0cmluZyh7IG1lc3NhZ2U6ICdVc2VyIEFnZW50IGRldmUgc2VyIHVtYSBzdHJpbmcnIH0pXG4gIHVzZXJfYWdlbnQ/OiBzdHJpbmc7XG5cbiAgQEFwaVByb3BlcnR5KHtcbiAgICBkZXNjcmlwdGlvbjogJ01ldGFkYWRvcyBhZGljaW9uYWlzIGVtIGZvcm1hdG8gSlNPTicsXG4gICAgcmVxdWlyZWQ6IGZhbHNlLFxuICB9KVxuICBAQ29sdW1uKHsgdHlwZTogJ2pzb25iJywgbnVsbGFibGU6IHRydWUgfSlcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuXG4gIEBBcGlQcm9wZXJ0eSh7XG4gICAgZGVzY3JpcHRpb246ICdEYXRhIGRlIGNyaWHDp8OjbyBkbyByZWdpc3RybycsXG4gICAgZXhhbXBsZTogJzIwMjQtMDEtMDFUMTA6MDA6MDBaJyxcbiAgfSlcbiAgQENyZWF0ZURhdGVDb2x1bW4oeyB0eXBlOiAndGltZXN0YW1wIHdpdGggdGltZSB6b25lJyB9KVxuICBjcmVhdGVkX2F0OiBEYXRlO1xuXG4gIEBBcGlQcm9wZXJ0eSh7XG4gICAgZGVzY3JpcHRpb246ICdEYXRhIGRhIMO6bHRpbWEgYXR1YWxpemHDp8OjbycsXG4gICAgZXhhbXBsZTogJzIwMjQtMDEtMDFUMTA6MDA6MDBaJyxcbiAgfSlcbiAgQFVwZGF0ZURhdGVDb2x1bW4oeyB0eXBlOiAndGltZXN0YW1wIHdpdGggdGltZSB6b25lJyB9KVxuICB1cGRhdGVkX2F0OiBEYXRlO1xuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIHRva2VuIGFpbmRhIGVzdMOhIG5hIGJsYWNrbGlzdCAobsOjbyBleHBpcm91KVxuICAgKiBAcmV0dXJucyB0cnVlIHNlIGFpbmRhIGVzdMOhIGJsYWNrbGlzdGVkXG4gICAqL1xuICBpc1N0aWxsQmxhY2tsaXN0ZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIG5ldyBEYXRlKCkgPCB0aGlzLmV4cGlyZXNfYXQ7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyB0b2tlbiBwb2RlIHNlciByZW1vdmlkbyBkYSBibGFja2xpc3RcbiAgICogQHJldHVybnMgdHJ1ZSBzZSBwb2RlIHNlciByZW1vdmlkb1xuICAgKi9cbiAgY2FuQmVSZW1vdmVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBuZXcgRGF0ZSgpID49IHRoaXMuZXhwaXJlc19hdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gbyB0ZW1wbyByZXN0YW50ZSBhdMOpIGEgZXhwaXJhw6fDo28gZW0gbWludXRvc1xuICAgKiBAcmV0dXJucyBtaW51dG9zIGF0w6kgZXhwaXJhw6fDo29cbiAgICovXG4gIGdldE1pbnV0ZXNVbnRpbEV4cGlyYXRpb24oKTogbnVtYmVyIHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGRpZmZNcyA9IHRoaXMuZXhwaXJlc19hdC5nZXRUaW1lKCkgLSBub3cuZ2V0VGltZSgpO1xuICAgIHJldHVybiBNYXRoLm1heCgwLCBNYXRoLmZsb29yKGRpZmZNcyAvICgxMDAwICogNjApKSk7XG4gIH1cblxuICAvKipcbiAgICogQWRpY2lvbmEgbWV0YWRhZG9zIGFvIHJlZ2lzdHJvXG4gICAqIEBwYXJhbSBrZXkgQ2hhdmUgZG8gbWV0YWRhZG9cbiAgICogQHBhcmFtIHZhbHVlIFZhbG9yIGRvIG1ldGFkYWRvXG4gICAqL1xuICBhZGRNZXRhZGF0YShrZXk6IHN0cmluZywgdmFsdWU6IGFueSk6IHZvaWQge1xuICAgIGlmICghdGhpcy5tZXRhZGF0YSkge1xuICAgICAgdGhpcy5tZXRhZGF0YSA9IHt9O1xuICAgIH1cbiAgICB0aGlzLm1ldGFkYXRhW2tleV0gPSB2YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gdW0gbWV0YWRhZG8gZXNwZWPDrWZpY29cbiAgICogQHBhcmFtIGtleSBDaGF2ZSBkbyBtZXRhZGFkb1xuICAgKiBAcmV0dXJucyBWYWxvciBkbyBtZXRhZGFkbyBvdSB1bmRlZmluZWRcbiAgICovXG4gIGdldE1ldGFkYXRhKGtleTogc3RyaW5nKTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5tZXRhZGF0YT8uW2tleV07XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyB0b2tlbiBwZXJ0ZW5jZSBhIHVtIHVzdcOhcmlvIGVzcGVjw61maWNvXG4gICAqIEBwYXJhbSB1c3VhcmlvSWQgSUQgZG8gdXN1w6FyaW9cbiAgICogQHJldHVybnMgdHJ1ZSBzZSBwZXJ0ZW5jZSBhbyB1c3XDoXJpb1xuICAgKi9cbiAgYmVsb25nc1RvVXNlcih1c3VhcmlvSWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnVzdWFyaW9faWQgPT09IHVzdWFyaW9JZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSDDqSB1bSB0b2tlbiBkZSBhY2Vzc29cbiAgICogQHJldHVybnMgdHJ1ZSBzZSDDqSBhY2Nlc3MgdG9rZW5cbiAgICovXG4gIGlzQWNjZXNzVG9rZW4oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudG9rZW5fdHlwZSA9PT0gJ2FjY2Vzcyc7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2Ugw6kgdW0gdG9rZW4gZGUgcmVmcmVzaFxuICAgKiBAcmV0dXJucyB0cnVlIHNlIMOpIHJlZnJlc2ggdG9rZW5cbiAgICovXG4gIGlzUmVmcmVzaFRva2VuKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnRva2VuX3R5cGUgPT09ICdyZWZyZXNoJztcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIHRva2VuIGZvaSBpbnZhbGlkYWRvIHJlY2VudGVtZW50ZSAow7psdGltYXMgMjQgaG9yYXMpXG4gICAqIEByZXR1cm5zIHRydWUgc2UgZm9pIGludmFsaWRhZG8gcmVjZW50ZW1lbnRlXG4gICAqL1xuICB3YXNSZWNlbnRseUJsYWNrbGlzdGVkKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3Qgb25lRGF5QWdvID0gbmV3IERhdGUobm93LmdldFRpbWUoKSAtIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZWRfYXQgPiBvbmVEYXlBZ287XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYSBow6EgcXVhbnRvcyBtaW51dG9zIG8gdG9rZW4gZm9pIGJsYWNrbGlzdGVkXG4gICAqIEByZXR1cm5zIG1pbnV0b3MgZGVzZGUgYSBibGFja2xpc3RcbiAgICovXG4gIGdldE1pbnV0ZXNTaW5jZUJsYWNrbGlzdGVkKCk6IG51bWJlciB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBkaWZmTXMgPSBub3cuZ2V0VGltZSgpIC0gdGhpcy5jcmVhdGVkX2F0LmdldFRpbWUoKTtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihkaWZmTXMgLyAoMTAwMCAqIDYwKSk7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyB0b2tlbiBleHBpcmEgZW0gYnJldmUgKHByw7N4aW1hcyAyIGhvcmFzKVxuICAgKiBAcmV0dXJucyB0cnVlIHNlIGV4cGlyYSBlbSBicmV2ZVxuICAgKi9cbiAgZXhwaXJlc1dpdGhpbihob3VyczogbnVtYmVyID0gMik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgZnV0dXJlVGltZSA9IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgKyBob3VycyAqIDYwICogNjAgKiAxMDAwKTtcbiAgICByZXR1cm4gdGhpcy5leHBpcmVzX2F0IDw9IGZ1dHVyZVRpbWU7XG4gIH1cblxuICAvKipcbiAgICogT2J0w6ltIGluZm9ybWHDp8O1ZXMgcmVzdW1pZGFzIGRvIHRva2VuIGJsYWNrbGlzdGVkXG4gICAqIEByZXR1cm5zIG9iamV0byBjb20gaW5mb3JtYcOnw7VlcyByZXN1bWlkYXNcbiAgICovXG4gIGdldFN1bW1hcnkoKToge1xuICAgIGlkOiBzdHJpbmc7XG4gICAganRpOiBzdHJpbmc7XG4gICAgdXN1YXJpb19pZDogc3RyaW5nO1xuICAgIHRva2VuX3R5cGU6IHN0cmluZztcbiAgICByZWFzb246IHN0cmluZztcbiAgICBleHBpcmVzX2F0OiBEYXRlO1xuICAgIGNyZWF0ZWRfYXQ6IERhdGU7XG4gICAgaXNTdGlsbEJsYWNrbGlzdGVkOiBib29sZWFuO1xuICAgIG1pbnV0ZXNVbnRpbEV4cGlyYXRpb246IG51bWJlcjtcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiB0aGlzLmlkLFxuICAgICAganRpOiB0aGlzLmp0aSxcbiAgICAgIHVzdWFyaW9faWQ6IHRoaXMudXN1YXJpb19pZCxcbiAgICAgIHRva2VuX3R5cGU6IHRoaXMudG9rZW5fdHlwZSxcbiAgICAgIHJlYXNvbjogdGhpcy5yZWFzb24sXG4gICAgICBleHBpcmVzX2F0OiB0aGlzLmV4cGlyZXNfYXQsXG4gICAgICBjcmVhdGVkX2F0OiB0aGlzLmNyZWF0ZWRfYXQsXG4gICAgICBpc1N0aWxsQmxhY2tsaXN0ZWQ6IHRoaXMuaXNTdGlsbEJsYWNrbGlzdGVkKCksXG4gICAgICBtaW51dGVzVW50aWxFeHBpcmF0aW9uOiB0aGlzLmdldE1pbnV0ZXNVbnRpbEV4cGlyYXRpb24oKSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIHRlbSBpbmZvcm1hw6fDtWVzIGRlIGNsaWVudGUgKElQIGUgVXNlciBBZ2VudClcbiAgICogQHJldHVybnMgdHJ1ZSBzZSB0ZW0gaW5mb3JtYcOnw7VlcyBkZSBjbGllbnRlXG4gICAqL1xuICBoYXNDbGllbnRJbmZvKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhISh0aGlzLmNsaWVudF9pcCB8fCB0aGlzLnVzZXJfYWdlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIE9idMOpbSB1bWEgZGVzY3Jpw6fDo28gbGVnw612ZWwgZG8gbW90aXZvIGRhIGJsYWNrbGlzdFxuICAgKiBAcmV0dXJucyBkZXNjcmnDp8OjbyBmb3JtYXRhZGFcbiAgICovXG4gIGdldFJlYXNvbkRlc2NyaXB0aW9uKCk6IHN0cmluZyB7XG4gICAgY29uc3QgcmVhc29uTWFwOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgdXNlcl9sb2dvdXQ6ICdMb2dvdXQgZG8gdXN1w6FyaW8nLFxuICAgICAgdG9rZW5fY29tcHJvbWlzZWQ6ICdUb2tlbiBjb21wcm9tZXRpZG8nLFxuICAgICAgcGFzc3dvcmRfY2hhbmdlZDogJ1NlbmhhIGFsdGVyYWRhJyxcbiAgICAgIGFjY291bnRfc3VzcGVuZGVkOiAnQ29udGEgc3VzcGVuc2EnLFxuICAgICAgc2VjdXJpdHlfYnJlYWNoOiAnVmlvbGHDp8OjbyBkZSBzZWd1cmFuw6dhJyxcbiAgICAgIGFkbWluX3Jldm9rZTogJ1Jldm9nYWRvIHBlbG8gYWRtaW5pc3RyYWRvcicsXG4gICAgICBleHBpcmVkOiAnVG9rZW4gZXhwaXJhZG8nLFxuICAgICAgaW52YWxpZF91c2U6ICdVc28gaW52w6FsaWRvJyxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHJlYXNvbk1hcFt0aGlzLnJlYXNvbl0gfHwgdGhpcy5yZWFzb247XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyB0b2tlbiBmb2kgYmxhY2tsaXN0ZWQgcG9yIG1vdGl2b3MgZGUgc2VndXJhbsOnYVxuICAgKiBAcmV0dXJucyB0cnVlIHNlIGZvaSBwb3IgbW90aXZvcyBkZSBzZWd1cmFuw6dhXG4gICAqL1xuICBpc1NlY3VyaXR5UmVsYXRlZCgpOiBib29sZWFuIHtcbiAgICBjb25zdCBzZWN1cml0eVJlYXNvbnMgPSBbXG4gICAgICAndG9rZW5fY29tcHJvbWlzZWQnLFxuICAgICAgJ3Bhc3N3b3JkX2NoYW5nZWQnLFxuICAgICAgJ2FjY291bnRfc3VzcGVuZGVkJyxcbiAgICAgICdzZWN1cml0eV9icmVhY2gnLFxuICAgICAgJ2FkbWluX3Jldm9rZScsXG4gICAgXTtcblxuICAgIHJldHVybiBzZWN1cml0eVJlYXNvbnMuaW5jbHVkZXModGhpcy5yZWFzb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlcmEgdW1hIGNoYXZlIMO6bmljYSBwYXJhIG8gdG9rZW4gYmxhY2tsaXN0ZWRcbiAgICogQHJldHVybnMgY2hhdmUgw7puaWNhXG4gICAqL1xuICBnZXRVbmlxdWVLZXkoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYGJsYWNrbGlzdF8ke3RoaXMuanRpfV8ke3RoaXMudXN1YXJpb19pZH1gO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIG8gcmVnaXN0cm8gZXN0w6EgZW0gZXN0YWRvIGNvbnNpc3RlbnRlXG4gICAqIEByZXR1cm5zIHRydWUgc2UgZXN0w6EgY29uc2lzdGVudGVcbiAgICovXG4gIGlzQ29uc2lzdGVudCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgISF0aGlzLmlkICYmXG4gICAgICAhIXRoaXMuanRpICYmXG4gICAgICAhIXRoaXMudXN1YXJpb19pZCAmJlxuICAgICAgISF0aGlzLnRva2VuX3R5cGUgJiZcbiAgICAgICEhdGhpcy5yZWFzb24gJiZcbiAgICAgICEhdGhpcy5leHBpcmVzX2F0ICYmXG4gICAgICAhIXRoaXMuY3JlYXRlZF9hdFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIG1ldGFkYWRvcyBzZW5zw612ZWlzIHBhcmEgbG9nc1xuICAgKiBAcmV0dXJucyBvYmpldG8gc2FuaXRpemFkb1xuICAgKi9cbiAgdG9TYWZlTG9nKCk6IHtcbiAgICBpZDogc3RyaW5nO1xuICAgIGp0aTogc3RyaW5nO1xuICAgIHVzdWFyaW9faWQ6IHN0cmluZztcbiAgICB0b2tlbl90eXBlOiBzdHJpbmc7XG4gICAgcmVhc29uOiBzdHJpbmc7XG4gICAgZXhwaXJlc19hdDogRGF0ZTtcbiAgICBjcmVhdGVkX2F0OiBEYXRlO1xuICAgIGhhc0NsaWVudEluZm86IGJvb2xlYW47XG4gIH0ge1xuICAgIHJldHVybiB7XG4gICAgICBpZDogdGhpcy5pZCxcbiAgICAgIGp0aTogdGhpcy5qdGkuc3Vic3RyaW5nKDAsIDgpICsgJy4uLicsXG4gICAgICB1c3VhcmlvX2lkOiB0aGlzLnVzdWFyaW9faWQsXG4gICAgICB0b2tlbl90eXBlOiB0aGlzLnRva2VuX3R5cGUsXG4gICAgICByZWFzb246IHRoaXMucmVhc29uLFxuICAgICAgZXhwaXJlc19hdDogdGhpcy5leHBpcmVzX2F0LFxuICAgICAgY3JlYXRlZF9hdDogdGhpcy5jcmVhdGVkX2F0LFxuICAgICAgaGFzQ2xpZW50SW5mbzogdGhpcy5oYXNDbGllbnRJbmZvKCksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JtYXRhIGEgZGF0YSBkZSBleHBpcmHDp8OjbyBwYXJhIGV4aWJpw6fDo29cbiAgICogQHJldHVybnMgZGF0YSBmb3JtYXRhZGFcbiAgICovXG4gIGdldEV4cGlyYWNhb0Zvcm1hdGFkYSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmV4cGlyZXNfYXQudG9Mb2NhbGVTdHJpbmcoJ3B0LUJSJywge1xuICAgICAgeWVhcjogJ251bWVyaWMnLFxuICAgICAgbW9udGg6ICcyLWRpZ2l0JyxcbiAgICAgIGRheTogJzItZGlnaXQnLFxuICAgICAgaG91cjogJzItZGlnaXQnLFxuICAgICAgbWludXRlOiAnMi1kaWdpdCcsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRm9ybWF0YSBhIGRhdGEgZGUgY3JpYcOnw6NvIHBhcmEgZXhpYmnDp8Ojb1xuICAgKiBAcmV0dXJucyBkYXRhIGZvcm1hdGFkYVxuICAgKi9cbiAgZ2V0Q3JpYWNhb0Zvcm1hdGFkYSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZWRfYXQudG9Mb2NhbGVTdHJpbmcoJ3B0LUJSJywge1xuICAgICAgeWVhcjogJ251bWVyaWMnLFxuICAgICAgbW9udGg6ICcyLWRpZ2l0JyxcbiAgICAgIGRheTogJzItZGlnaXQnLFxuICAgICAgaG91cjogJzItZGlnaXQnLFxuICAgICAgbWludXRlOiAnMi1kaWdpdCcsXG4gICAgfSk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==