1d0e252e82c481bf609ed0cff15103f5
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a, _b, _c, _d, _e, _f, _g;
Object.defineProperty(exports, "__esModule", { value: true });
exports.PasswordResetToken = void 0;
const typeorm_1 = require("typeorm");
const class_validator_1 = require("class-validator");
const usuario_entity_1 = require("./usuario.entity");
/**
 * Entidade para Tokens de Recuperação de Senha
 *
 * Armazena tokens temporários para recuperação de senha com:
 * - Associação ao usuário
 * - Token único e seguro
 * - Controle de expiração
 * - Rastreamento de uso
 * - Auditoria de tentativas
 */
let PasswordResetToken = class PasswordResetToken {
    id;
    /**
     * Token único para recuperação de senha
     * Gerado com alta entropia para segurança
     */
    token;
    /**
     * Hash do token para verificação segura
     * Armazenamos o hash para evitar exposição do token original
     */
    token_hash;
    /**
     * Usuário associado ao token
     */
    usuario;
    usuario_id;
    /**
     * Data e hora de expiração do token
     * Padrão: 15 minutos após criação
     */
    expires_at;
    /**
     * Indica se o token já foi utilizado
     * Tokens são de uso único
     */
    is_used;
    /**
     * Data e hora em que o token foi utilizado
     */
    used_at;
    /**
     * IP do cliente que solicitou o token
     * Para auditoria e segurança
     */
    client_ip;
    /**
     * User Agent do cliente que solicitou o token
     * Para auditoria e detecção de anomalias
     */
    user_agent;
    /**
     * Número de tentativas de uso do token
     * Para detectar ataques de força bruta
     */
    attempts;
    /**
     * Data da última tentativa de uso
     */
    last_attempt_at;
    /**
     * Motivo da invalidação (se aplicável)
     * Ex: 'expired', 'used', 'revoked', 'suspicious_activity'
     */
    invalidation_reason;
    /**
     * Metadados adicionais em formato JSON
     * Para informações extras de auditoria
     */
    metadata;
    created_at;
    updated_at;
    /**
     * Verifica se o token está válido
     * @returns true se o token não expirou e não foi usado
     */
    isValid() {
        const now = new Date();
        return !this.is_used && this.expires_at > now;
    }
    /**
     * Verifica se o token expirou
     * @returns true se o token expirou
     */
    isExpired() {
        const now = new Date();
        return this.expires_at <= now;
    }
    /**
     * Marca o token como usado
     * @param reason Motivo da invalidação
     */
    markAsUsed(reason = 'used') {
        this.is_used = true;
        this.used_at = new Date();
        this.invalidation_reason = reason;
    }
    /**
     * Incrementa o contador de tentativas
     */
    incrementAttempts() {
        this.attempts += 1;
        this.last_attempt_at = new Date();
    }
    /**
     * Calcula o tempo restante até a expiração em minutos
     * @returns Minutos restantes ou 0 se expirado
     */
    getMinutesUntilExpiration() {
        const now = new Date();
        if (this.expires_at <= now) {
            return 0;
        }
        return Math.ceil((this.expires_at.getTime() - now.getTime()) / (1000 * 60));
    }
    /**
     * Verifica se o token pertence a um usuário específico
     * @param usuarioId ID do usuário
     * @returns true se pertence ao usuário
     */
    belongsToUser(usuarioId) {
        return this.usuario_id === usuarioId;
    }
    /**
     * Verifica se o token foi criado recentemente (últimas 24 horas)
     * @returns true se foi criado recentemente
     */
    isRecentlyCreated() {
        const now = new Date();
        const oneDayAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);
        return this.created_at > oneDayAgo;
    }
    /**
     * Verifica se há muitas tentativas de uso (possível ataque)
     * @param maxAttempts Número máximo de tentativas permitidas
     * @returns true se excedeu o limite
     */
    hasTooManyAttempts(maxAttempts = 5) {
        return this.attempts >= maxAttempts;
    }
    /**
     * Verifica se o token expira em breve (próximos 5 minutos)
     * @param minutes Minutos para considerar como "em breve"
     * @returns true se expira em breve
     */
    expiresWithin(minutes = 5) {
        const now = new Date();
        const futureTime = new Date(now.getTime() + minutes * 60 * 1000);
        return this.expires_at <= futureTime;
    }
    /**
     * Calcula há quantos minutos o token foi criado
     * @returns minutos desde a criação
     */
    getMinutesSinceCreation() {
        const now = new Date();
        const diffMs = now.getTime() - this.created_at.getTime();
        return Math.floor(diffMs / (1000 * 60));
    }
    /**
     * Obtém o status atual do token
     * @returns status do token
     */
    getStatus() {
        if (this.is_used)
            return 'used';
        if (this.isExpired())
            return 'expired';
        if (this.hasTooManyAttempts())
            return 'too_many_attempts';
        return 'valid';
    }
    /**
     * Verifica se tem informações de cliente (IP e User Agent)
     * @returns true se tem informações de cliente
     */
    hasClientInfo() {
        return !!(this.client_ip || this.user_agent);
    }
    /**
     * Adiciona metadados ao token
     * @param key Chave do metadado
     * @param value Valor do metadado
     */
    addMetadata(key, value) {
        if (!this.metadata) {
            this.metadata = {};
        }
        this.metadata[key] = value;
    }
    /**
     * Obtém um metadado específico
     * @param key Chave do metadado
     * @returns Valor do metadado ou undefined
     */
    getMetadata(key) {
        return this.metadata?.[key];
    }
    /**
     * Obtém informações resumidas do token
     * @returns objeto com informações resumidas
     */
    getSummary() {
        return {
            id: this.id,
            usuario_id: this.usuario_id,
            is_used: this.is_used,
            expires_at: this.expires_at,
            created_at: this.created_at,
            attempts: this.attempts,
            status: this.getStatus(),
            minutesUntilExpiration: this.getMinutesUntilExpiration(),
            hasClientInfo: this.hasClientInfo(),
        };
    }
    /**
     * Invalida o token com um motivo específico
     * @param reason Motivo da invalidação
     */
    invalidate(reason) {
        this.is_used = true;
        this.used_at = new Date();
        this.invalidation_reason = reason;
    }
    /**
     * Verifica se o token foi invalidado por motivos de segurança
     * @returns true se foi invalidado por segurança
     */
    isSecurityInvalidated() {
        const securityReasons = [
            'suspicious_activity',
            'too_many_attempts',
            'security_breach',
            'admin_revoke',
        ];
        return securityReasons.includes(this.invalidation_reason);
    }
    /**
     * Gera uma chave única para o token
     * @returns chave única
     */
    getUniqueKey() {
        return `password_reset_${this.usuario_id}_${this.id}`;
    }
    /**
     * Verifica se o token está em estado consistente
     * @returns true se está consistente
     */
    isConsistent() {
        return (!!this.id &&
            !!this.token &&
            !!this.token_hash &&
            !!this.usuario_id &&
            !!this.expires_at &&
            !!this.created_at &&
            typeof this.is_used === 'boolean' &&
            typeof this.attempts === 'number');
    }
    /**
     * Remove informações sensíveis para logs
     * @returns objeto sanitizado
     */
    toSafeLog() {
        return {
            id: this.id,
            usuario_id: this.usuario_id,
            token_preview: this.token.substring(0, 8) + '...',
            is_used: this.is_used,
            expires_at: this.expires_at,
            created_at: this.created_at,
            attempts: this.attempts,
            status: this.getStatus(),
            hasClientInfo: this.hasClientInfo(),
        };
    }
    /**
     * Formata a data de expiração para exibição
     * @returns data formatada
     */
    getExpiracaoFormatada() {
        return this.expires_at.toLocaleString('pt-BR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
        });
    }
    /**
     * Formata a data de criação para exibição
     * @returns data formatada
     */
    getCriacaoFormatada() {
        return this.created_at.toLocaleString('pt-BR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
        });
    }
    /**
     * Verifica se o token pode ser usado para reset de senha
     * @returns true se pode ser usado
     */
    canBeUsedForReset() {
        return (this.isValid() &&
            !this.hasTooManyAttempts() &&
            !this.isSecurityInvalidated());
    }
};
exports.PasswordResetToken = PasswordResetToken;
__decorate([
    (0, typeorm_1.PrimaryGeneratedColumn)('uuid'),
    __metadata("design:type", String)
], PasswordResetToken.prototype, "id", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'varchar',
        length: 255,
        unique: true,
        nullable: false,
        comment: 'Token único para recuperação de senha',
    }),
    (0, class_validator_1.IsNotEmpty)({ message: 'Token é obrigatório' }),
    (0, class_validator_1.IsString)({ message: 'Token deve ser uma string' }),
    (0, class_validator_1.Length)(10, 255, { message: 'Token deve ter entre 10 e 255 caracteres' }),
    __metadata("design:type", String)
], PasswordResetToken.prototype, "token", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'varchar',
        length: 255,
        nullable: false,
        comment: 'Hash do token para verificação segura',
    }),
    (0, class_validator_1.IsNotEmpty)({ message: 'Hash do token é obrigatório' }),
    (0, class_validator_1.IsString)({ message: 'Hash do token deve ser uma string' }),
    (0, class_validator_1.Length)(32, 255, {
        message: 'Hash do token deve ter entre 32 e 255 caracteres',
    }),
    __metadata("design:type", String)
], PasswordResetToken.prototype, "token_hash", void 0);
__decorate([
    (0, typeorm_1.ManyToOne)(() => usuario_entity_1.Usuario, { onDelete: 'CASCADE' }),
    (0, typeorm_1.JoinColumn)({ name: 'usuario_id' }),
    __metadata("design:type", typeof (_a = typeof usuario_entity_1.Usuario !== "undefined" && usuario_entity_1.Usuario) === "function" ? _a : Object)
], PasswordResetToken.prototype, "usuario", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'uuid',
        nullable: false,
        comment: 'ID do usuário associado ao token',
    }),
    (0, class_validator_1.IsNotEmpty)({ message: 'ID do usuário é obrigatório' }),
    (0, class_validator_1.IsUUID)('4', { message: 'ID do usuário inválido' }),
    __metadata("design:type", String)
], PasswordResetToken.prototype, "usuario_id", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'timestamp',
        nullable: false,
        comment: 'Data e hora de expiração do token',
    }),
    __metadata("design:type", typeof (_b = typeof Date !== "undefined" && Date) === "function" ? _b : Object)
], PasswordResetToken.prototype, "expires_at", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'boolean',
        default: false,
        nullable: false,
        comment: 'Indica se o token já foi utilizado',
    }),
    (0, class_validator_1.IsBoolean)({ message: 'Campo is_used deve ser um boolean' }),
    __metadata("design:type", Boolean)
], PasswordResetToken.prototype, "is_used", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'timestamp',
        nullable: true,
        comment: 'Data e hora em que o token foi utilizado',
    }),
    __metadata("design:type", typeof (_c = typeof Date !== "undefined" && Date) === "function" ? _c : Object)
], PasswordResetToken.prototype, "used_at", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'varchar',
        length: 45, // IPv6 max length
        nullable: true,
        comment: 'IP do cliente que solicitou o token',
    }),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsString)({ message: 'IP do cliente deve ser uma string' }),
    (0, class_validator_1.Length)(7, 45, { message: 'IP do cliente deve ter entre 7 e 45 caracteres' }),
    __metadata("design:type", String)
], PasswordResetToken.prototype, "client_ip", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'text',
        nullable: true,
        comment: 'User Agent do cliente que solicitou o token',
    }),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsString)({ message: 'User Agent deve ser uma string' }),
    __metadata("design:type", String)
], PasswordResetToken.prototype, "user_agent", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'integer',
        default: 0,
        nullable: false,
        comment: 'Número de tentativas de uso do token',
    }),
    (0, class_validator_1.IsNumber)({}, { message: 'Número de tentativas deve ser um número' }),
    (0, class_validator_1.Min)(0, { message: 'Número de tentativas não pode ser negativo' }),
    (0, class_validator_1.Max)(100, { message: 'Número de tentativas não pode exceder 100' }),
    __metadata("design:type", Number)
], PasswordResetToken.prototype, "attempts", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'timestamp',
        nullable: true,
        comment: 'Data da última tentativa de uso',
    }),
    __metadata("design:type", typeof (_d = typeof Date !== "undefined" && Date) === "function" ? _d : Object)
], PasswordResetToken.prototype, "last_attempt_at", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'varchar',
        length: 50,
        nullable: true,
        comment: 'Motivo da invalidação do token',
    }),
    (0, class_validator_1.IsOptional)(),
    (0, class_validator_1.IsString)({ message: 'Motivo da invalidação deve ser uma string' }),
    (0, class_validator_1.Length)(3, 50, {
        message: 'Motivo da invalidação deve ter entre 3 e 50 caracteres',
    }),
    __metadata("design:type", String)
], PasswordResetToken.prototype, "invalidation_reason", void 0);
__decorate([
    (0, typeorm_1.Column)({
        type: 'jsonb',
        nullable: true,
        comment: 'Metadados adicionais para auditoria',
    }),
    __metadata("design:type", typeof (_e = typeof Record !== "undefined" && Record) === "function" ? _e : Object)
], PasswordResetToken.prototype, "metadata", void 0);
__decorate([
    (0, typeorm_1.CreateDateColumn)({
        type: 'timestamp',
        default: () => 'CURRENT_TIMESTAMP',
        comment: 'Data de criação do registro',
    }),
    __metadata("design:type", typeof (_f = typeof Date !== "undefined" && Date) === "function" ? _f : Object)
], PasswordResetToken.prototype, "created_at", void 0);
__decorate([
    (0, typeorm_1.UpdateDateColumn)({
        type: 'timestamp',
        default: () => 'CURRENT_TIMESTAMP',
        onUpdate: 'CURRENT_TIMESTAMP',
        comment: 'Data da última atualização do registro',
    }),
    __metadata("design:type", typeof (_g = typeof Date !== "undefined" && Date) === "function" ? _g : Object)
], PasswordResetToken.prototype, "updated_at", void 0);
exports.PasswordResetToken = PasswordResetToken = __decorate([
    (0, typeorm_1.Entity)('password_reset_tokens'),
    (0, typeorm_1.Index)(['token'], { unique: true }),
    (0, typeorm_1.Index)(['usuario_id', 'is_used']),
    (0, typeorm_1.Index)(['expires_at']),
    (0, typeorm_1.Index)(['used_at'])
], PasswordResetToken);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGVudGl0aWVzXFxwYXNzd29yZC1yZXNldC10b2tlbi5lbnRpdHkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLHFDQVNpQjtBQUNqQixxREFVeUI7QUFDekIscURBQTJDO0FBRTNDOzs7Ozs7Ozs7R0FTRztBQU1JLElBQU0sa0JBQWtCLEdBQXhCLE1BQU0sa0JBQWtCO0lBRTdCLEVBQUUsQ0FBUztJQUVYOzs7T0FHRztJQVdILEtBQUssQ0FBUztJQUVkOzs7T0FHRztJQVlILFVBQVUsQ0FBUztJQUVuQjs7T0FFRztJQUdILE9BQU8sQ0FBVTtJQVNqQixVQUFVLENBQVM7SUFFbkI7OztPQUdHO0lBTUgsVUFBVSxDQUFPO0lBRWpCOzs7T0FHRztJQVFILE9BQU8sQ0FBVTtJQUVqQjs7T0FFRztJQU1ILE9BQU8sQ0FBTztJQUVkOzs7T0FHRztJQVVILFNBQVMsQ0FBUztJQUVsQjs7O09BR0c7SUFRSCxVQUFVLENBQVM7SUFFbkI7OztPQUdHO0lBVUgsUUFBUSxDQUFTO0lBRWpCOztPQUVHO0lBTUgsZUFBZSxDQUFPO0lBRXRCOzs7T0FHRztJQVlILG1CQUFtQixDQUFTO0lBRTVCOzs7T0FHRztJQU1ILFFBQVEsQ0FBc0I7SUFPOUIsVUFBVSxDQUFPO0lBUWpCLFVBQVUsQ0FBTztJQUVqQjs7O09BR0c7SUFDSCxPQUFPO1FBQ0wsTUFBTSxHQUFHLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUN2QixPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsVUFBVSxHQUFHLEdBQUcsQ0FBQztJQUNoRCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsU0FBUztRQUNQLE1BQU0sR0FBRyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDdkIsT0FBTyxJQUFJLENBQUMsVUFBVSxJQUFJLEdBQUcsQ0FBQztJQUNoQyxDQUFDO0lBRUQ7OztP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a0RBQ1UsSUFBSSxvQkFBSixJQUFJO3NEQUFDOzZCQXJMTixrQkFBa0I7SUFMOUIsSUFBQSxnQkFBTSxFQUFDLHVCQUF1QixDQUFDO0lBQy9CLElBQUEsZUFBSyxFQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUM7SUFDbEMsSUFBQSxlQUFLLEVBQUMsQ0FBQyxZQUFZLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDaEMsSUFBQSxlQUFLLEVBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUNyQixJQUFBLGVBQUssRUFBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0dBQ04sa0JBQWtCLENBaWQ5QiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcZW50aXRpZXNcXHBhc3N3b3JkLXJlc2V0LXRva2VuLmVudGl0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBFbnRpdHksXG4gIFByaW1hcnlHZW5lcmF0ZWRDb2x1bW4sXG4gIENvbHVtbixcbiAgTWFueVRvT25lLFxuICBKb2luQ29sdW1uLFxuICBDcmVhdGVEYXRlQ29sdW1uLFxuICBVcGRhdGVEYXRlQ29sdW1uLFxuICBJbmRleCxcbn0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQge1xuICBJc05vdEVtcHR5LFxuICBJc1VVSUQsXG4gIElzQm9vbGVhbixcbiAgSXNPcHRpb25hbCxcbiAgSXNTdHJpbmcsXG4gIElzTnVtYmVyLFxuICBMZW5ndGgsXG4gIE1pbixcbiAgTWF4LFxufSBmcm9tICdjbGFzcy12YWxpZGF0b3InO1xuaW1wb3J0IHsgVXN1YXJpbyB9IGZyb20gJy4vdXN1YXJpby5lbnRpdHknO1xuXG4vKipcbiAqIEVudGlkYWRlIHBhcmEgVG9rZW5zIGRlIFJlY3VwZXJhw6fDo28gZGUgU2VuaGFcbiAqXG4gKiBBcm1hemVuYSB0b2tlbnMgdGVtcG9yw6FyaW9zIHBhcmEgcmVjdXBlcmHDp8OjbyBkZSBzZW5oYSBjb206XG4gKiAtIEFzc29jaWHDp8OjbyBhbyB1c3XDoXJpb1xuICogLSBUb2tlbiDDum5pY28gZSBzZWd1cm9cbiAqIC0gQ29udHJvbGUgZGUgZXhwaXJhw6fDo29cbiAqIC0gUmFzdHJlYW1lbnRvIGRlIHVzb1xuICogLSBBdWRpdG9yaWEgZGUgdGVudGF0aXZhc1xuICovXG5ARW50aXR5KCdwYXNzd29yZF9yZXNldF90b2tlbnMnKVxuQEluZGV4KFsndG9rZW4nXSwgeyB1bmlxdWU6IHRydWUgfSlcbkBJbmRleChbJ3VzdWFyaW9faWQnLCAnaXNfdXNlZCddKVxuQEluZGV4KFsnZXhwaXJlc19hdCddKVxuQEluZGV4KFsndXNlZF9hdCddKVxuZXhwb3J0IGNsYXNzIFBhc3N3b3JkUmVzZXRUb2tlbiB7XG4gIEBQcmltYXJ5R2VuZXJhdGVkQ29sdW1uKCd1dWlkJylcbiAgaWQ6IHN0cmluZztcblxuICAvKipcbiAgICogVG9rZW4gw7puaWNvIHBhcmEgcmVjdXBlcmHDp8OjbyBkZSBzZW5oYVxuICAgKiBHZXJhZG8gY29tIGFsdGEgZW50cm9waWEgcGFyYSBzZWd1cmFuw6dhXG4gICAqL1xuICBAQ29sdW1uKHtcbiAgICB0eXBlOiAndmFyY2hhcicsXG4gICAgbGVuZ3RoOiAyNTUsXG4gICAgdW5pcXVlOiB0cnVlLFxuICAgIG51bGxhYmxlOiBmYWxzZSxcbiAgICBjb21tZW50OiAnVG9rZW4gw7puaWNvIHBhcmEgcmVjdXBlcmHDp8OjbyBkZSBzZW5oYScsXG4gIH0pXG4gIEBJc05vdEVtcHR5KHsgbWVzc2FnZTogJ1Rva2VuIMOpIG9icmlnYXTDs3JpbycgfSlcbiAgQElzU3RyaW5nKHsgbWVzc2FnZTogJ1Rva2VuIGRldmUgc2VyIHVtYSBzdHJpbmcnIH0pXG4gIEBMZW5ndGgoMTAsIDI1NSwgeyBtZXNzYWdlOiAnVG9rZW4gZGV2ZSB0ZXIgZW50cmUgMTAgZSAyNTUgY2FyYWN0ZXJlcycgfSlcbiAgdG9rZW46IHN0cmluZztcblxuICAvKipcbiAgICogSGFzaCBkbyB0b2tlbiBwYXJhIHZlcmlmaWNhw6fDo28gc2VndXJhXG4gICAqIEFybWF6ZW5hbW9zIG8gaGFzaCBwYXJhIGV2aXRhciBleHBvc2nDp8OjbyBkbyB0b2tlbiBvcmlnaW5hbFxuICAgKi9cbiAgQENvbHVtbih7XG4gICAgdHlwZTogJ3ZhcmNoYXInLFxuICAgIGxlbmd0aDogMjU1LFxuICAgIG51bGxhYmxlOiBmYWxzZSxcbiAgICBjb21tZW50OiAnSGFzaCBkbyB0b2tlbiBwYXJhIHZlcmlmaWNhw6fDo28gc2VndXJhJyxcbiAgfSlcbiAgQElzTm90RW1wdHkoeyBtZXNzYWdlOiAnSGFzaCBkbyB0b2tlbiDDqSBvYnJpZ2F0w7NyaW8nIH0pXG4gIEBJc1N0cmluZyh7IG1lc3NhZ2U6ICdIYXNoIGRvIHRva2VuIGRldmUgc2VyIHVtYSBzdHJpbmcnIH0pXG4gIEBMZW5ndGgoMzIsIDI1NSwge1xuICAgIG1lc3NhZ2U6ICdIYXNoIGRvIHRva2VuIGRldmUgdGVyIGVudHJlIDMyIGUgMjU1IGNhcmFjdGVyZXMnLFxuICB9KVxuICB0b2tlbl9oYXNoOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFVzdcOhcmlvIGFzc29jaWFkbyBhbyB0b2tlblxuICAgKi9cbiAgQE1hbnlUb09uZSgoKSA9PiBVc3VhcmlvLCB7IG9uRGVsZXRlOiAnQ0FTQ0FERScgfSlcbiAgQEpvaW5Db2x1bW4oeyBuYW1lOiAndXN1YXJpb19pZCcgfSlcbiAgdXN1YXJpbzogVXN1YXJpbztcblxuICBAQ29sdW1uKHtcbiAgICB0eXBlOiAndXVpZCcsXG4gICAgbnVsbGFibGU6IGZhbHNlLFxuICAgIGNvbW1lbnQ6ICdJRCBkbyB1c3XDoXJpbyBhc3NvY2lhZG8gYW8gdG9rZW4nLFxuICB9KVxuICBASXNOb3RFbXB0eSh7IG1lc3NhZ2U6ICdJRCBkbyB1c3XDoXJpbyDDqSBvYnJpZ2F0w7NyaW8nIH0pXG4gIEBJc1VVSUQoJzQnLCB7IG1lc3NhZ2U6ICdJRCBkbyB1c3XDoXJpbyBpbnbDoWxpZG8nIH0pXG4gIHVzdWFyaW9faWQ6IHN0cmluZztcblxuICAvKipcbiAgICogRGF0YSBlIGhvcmEgZGUgZXhwaXJhw6fDo28gZG8gdG9rZW5cbiAgICogUGFkcsOjbzogMTUgbWludXRvcyBhcMOzcyBjcmlhw6fDo29cbiAgICovXG4gIEBDb2x1bW4oe1xuICAgIHR5cGU6ICd0aW1lc3RhbXAnLFxuICAgIG51bGxhYmxlOiBmYWxzZSxcbiAgICBjb21tZW50OiAnRGF0YSBlIGhvcmEgZGUgZXhwaXJhw6fDo28gZG8gdG9rZW4nLFxuICB9KVxuICBleHBpcmVzX2F0OiBEYXRlO1xuXG4gIC8qKlxuICAgKiBJbmRpY2Egc2UgbyB0b2tlbiBqw6EgZm9pIHV0aWxpemFkb1xuICAgKiBUb2tlbnMgc8OjbyBkZSB1c28gw7puaWNvXG4gICAqL1xuICBAQ29sdW1uKHtcbiAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgZGVmYXVsdDogZmFsc2UsXG4gICAgbnVsbGFibGU6IGZhbHNlLFxuICAgIGNvbW1lbnQ6ICdJbmRpY2Egc2UgbyB0b2tlbiBqw6EgZm9pIHV0aWxpemFkbycsXG4gIH0pXG4gIEBJc0Jvb2xlYW4oeyBtZXNzYWdlOiAnQ2FtcG8gaXNfdXNlZCBkZXZlIHNlciB1bSBib29sZWFuJyB9KVxuICBpc191c2VkOiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBEYXRhIGUgaG9yYSBlbSBxdWUgbyB0b2tlbiBmb2kgdXRpbGl6YWRvXG4gICAqL1xuICBAQ29sdW1uKHtcbiAgICB0eXBlOiAndGltZXN0YW1wJyxcbiAgICBudWxsYWJsZTogdHJ1ZSxcbiAgICBjb21tZW50OiAnRGF0YSBlIGhvcmEgZW0gcXVlIG8gdG9rZW4gZm9pIHV0aWxpemFkbycsXG4gIH0pXG4gIHVzZWRfYXQ6IERhdGU7XG5cbiAgLyoqXG4gICAqIElQIGRvIGNsaWVudGUgcXVlIHNvbGljaXRvdSBvIHRva2VuXG4gICAqIFBhcmEgYXVkaXRvcmlhIGUgc2VndXJhbsOnYVxuICAgKi9cbiAgQENvbHVtbih7XG4gICAgdHlwZTogJ3ZhcmNoYXInLFxuICAgIGxlbmd0aDogNDUsIC8vIElQdjYgbWF4IGxlbmd0aFxuICAgIG51bGxhYmxlOiB0cnVlLFxuICAgIGNvbW1lbnQ6ICdJUCBkbyBjbGllbnRlIHF1ZSBzb2xpY2l0b3UgbyB0b2tlbicsXG4gIH0pXG4gIEBJc09wdGlvbmFsKClcbiAgQElzU3RyaW5nKHsgbWVzc2FnZTogJ0lQIGRvIGNsaWVudGUgZGV2ZSBzZXIgdW1hIHN0cmluZycgfSlcbiAgQExlbmd0aCg3LCA0NSwgeyBtZXNzYWdlOiAnSVAgZG8gY2xpZW50ZSBkZXZlIHRlciBlbnRyZSA3IGUgNDUgY2FyYWN0ZXJlcycgfSlcbiAgY2xpZW50X2lwOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFVzZXIgQWdlbnQgZG8gY2xpZW50ZSBxdWUgc29saWNpdG91IG8gdG9rZW5cbiAgICogUGFyYSBhdWRpdG9yaWEgZSBkZXRlY8Onw6NvIGRlIGFub21hbGlhc1xuICAgKi9cbiAgQENvbHVtbih7XG4gICAgdHlwZTogJ3RleHQnLFxuICAgIG51bGxhYmxlOiB0cnVlLFxuICAgIGNvbW1lbnQ6ICdVc2VyIEFnZW50IGRvIGNsaWVudGUgcXVlIHNvbGljaXRvdSBvIHRva2VuJyxcbiAgfSlcbiAgQElzT3B0aW9uYWwoKVxuICBASXNTdHJpbmcoeyBtZXNzYWdlOiAnVXNlciBBZ2VudCBkZXZlIHNlciB1bWEgc3RyaW5nJyB9KVxuICB1c2VyX2FnZW50OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIE7Dum1lcm8gZGUgdGVudGF0aXZhcyBkZSB1c28gZG8gdG9rZW5cbiAgICogUGFyYSBkZXRlY3RhciBhdGFxdWVzIGRlIGZvcsOnYSBicnV0YVxuICAgKi9cbiAgQENvbHVtbih7XG4gICAgdHlwZTogJ2ludGVnZXInLFxuICAgIGRlZmF1bHQ6IDAsXG4gICAgbnVsbGFibGU6IGZhbHNlLFxuICAgIGNvbW1lbnQ6ICdOw7ptZXJvIGRlIHRlbnRhdGl2YXMgZGUgdXNvIGRvIHRva2VuJyxcbiAgfSlcbiAgQElzTnVtYmVyKHt9LCB7IG1lc3NhZ2U6ICdOw7ptZXJvIGRlIHRlbnRhdGl2YXMgZGV2ZSBzZXIgdW0gbsO6bWVybycgfSlcbiAgQE1pbigwLCB7IG1lc3NhZ2U6ICdOw7ptZXJvIGRlIHRlbnRhdGl2YXMgbsOjbyBwb2RlIHNlciBuZWdhdGl2bycgfSlcbiAgQE1heCgxMDAsIHsgbWVzc2FnZTogJ07Dum1lcm8gZGUgdGVudGF0aXZhcyBuw6NvIHBvZGUgZXhjZWRlciAxMDAnIH0pXG4gIGF0dGVtcHRzOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIERhdGEgZGEgw7psdGltYSB0ZW50YXRpdmEgZGUgdXNvXG4gICAqL1xuICBAQ29sdW1uKHtcbiAgICB0eXBlOiAndGltZXN0YW1wJyxcbiAgICBudWxsYWJsZTogdHJ1ZSxcbiAgICBjb21tZW50OiAnRGF0YSBkYSDDumx0aW1hIHRlbnRhdGl2YSBkZSB1c28nLFxuICB9KVxuICBsYXN0X2F0dGVtcHRfYXQ6IERhdGU7XG5cbiAgLyoqXG4gICAqIE1vdGl2byBkYSBpbnZhbGlkYcOnw6NvIChzZSBhcGxpY8OhdmVsKVxuICAgKiBFeDogJ2V4cGlyZWQnLCAndXNlZCcsICdyZXZva2VkJywgJ3N1c3BpY2lvdXNfYWN0aXZpdHknXG4gICAqL1xuICBAQ29sdW1uKHtcbiAgICB0eXBlOiAndmFyY2hhcicsXG4gICAgbGVuZ3RoOiA1MCxcbiAgICBudWxsYWJsZTogdHJ1ZSxcbiAgICBjb21tZW50OiAnTW90aXZvIGRhIGludmFsaWRhw6fDo28gZG8gdG9rZW4nLFxuICB9KVxuICBASXNPcHRpb25hbCgpXG4gIEBJc1N0cmluZyh7IG1lc3NhZ2U6ICdNb3Rpdm8gZGEgaW52YWxpZGHDp8OjbyBkZXZlIHNlciB1bWEgc3RyaW5nJyB9KVxuICBATGVuZ3RoKDMsIDUwLCB7XG4gICAgbWVzc2FnZTogJ01vdGl2byBkYSBpbnZhbGlkYcOnw6NvIGRldmUgdGVyIGVudHJlIDMgZSA1MCBjYXJhY3RlcmVzJyxcbiAgfSlcbiAgaW52YWxpZGF0aW9uX3JlYXNvbjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBNZXRhZGFkb3MgYWRpY2lvbmFpcyBlbSBmb3JtYXRvIEpTT05cbiAgICogUGFyYSBpbmZvcm1hw6fDtWVzIGV4dHJhcyBkZSBhdWRpdG9yaWFcbiAgICovXG4gIEBDb2x1bW4oe1xuICAgIHR5cGU6ICdqc29uYicsXG4gICAgbnVsbGFibGU6IHRydWUsXG4gICAgY29tbWVudDogJ01ldGFkYWRvcyBhZGljaW9uYWlzIHBhcmEgYXVkaXRvcmlhJyxcbiAgfSlcbiAgbWV0YWRhdGE6IFJlY29yZDxzdHJpbmcsIGFueT47XG5cbiAgQENyZWF0ZURhdGVDb2x1bW4oe1xuICAgIHR5cGU6ICd0aW1lc3RhbXAnLFxuICAgIGRlZmF1bHQ6ICgpID0+ICdDVVJSRU5UX1RJTUVTVEFNUCcsXG4gICAgY29tbWVudDogJ0RhdGEgZGUgY3JpYcOnw6NvIGRvIHJlZ2lzdHJvJyxcbiAgfSlcbiAgY3JlYXRlZF9hdDogRGF0ZTtcblxuICBAVXBkYXRlRGF0ZUNvbHVtbih7XG4gICAgdHlwZTogJ3RpbWVzdGFtcCcsXG4gICAgZGVmYXVsdDogKCkgPT4gJ0NVUlJFTlRfVElNRVNUQU1QJyxcbiAgICBvblVwZGF0ZTogJ0NVUlJFTlRfVElNRVNUQU1QJyxcbiAgICBjb21tZW50OiAnRGF0YSBkYSDDumx0aW1hIGF0dWFsaXphw6fDo28gZG8gcmVnaXN0cm8nLFxuICB9KVxuICB1cGRhdGVkX2F0OiBEYXRlO1xuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIHRva2VuIGVzdMOhIHbDoWxpZG9cbiAgICogQHJldHVybnMgdHJ1ZSBzZSBvIHRva2VuIG7Do28gZXhwaXJvdSBlIG7Do28gZm9pIHVzYWRvXG4gICAqL1xuICBpc1ZhbGlkKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgcmV0dXJuICF0aGlzLmlzX3VzZWQgJiYgdGhpcy5leHBpcmVzX2F0ID4gbm93O1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIG8gdG9rZW4gZXhwaXJvdVxuICAgKiBAcmV0dXJucyB0cnVlIHNlIG8gdG9rZW4gZXhwaXJvdVxuICAgKi9cbiAgaXNFeHBpcmVkKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgcmV0dXJuIHRoaXMuZXhwaXJlc19hdCA8PSBub3c7XG4gIH1cblxuICAvKipcbiAgICogTWFyY2EgbyB0b2tlbiBjb21vIHVzYWRvXG4gICAqIEBwYXJhbSByZWFzb24gTW90aXZvIGRhIGludmFsaWRhw6fDo29cbiAgICovXG4gIG1hcmtBc1VzZWQocmVhc29uOiBzdHJpbmcgPSAndXNlZCcpOiB2b2lkIHtcbiAgICB0aGlzLmlzX3VzZWQgPSB0cnVlO1xuICAgIHRoaXMudXNlZF9hdCA9IG5ldyBEYXRlKCk7XG4gICAgdGhpcy5pbnZhbGlkYXRpb25fcmVhc29uID0gcmVhc29uO1xuICB9XG5cbiAgLyoqXG4gICAqIEluY3JlbWVudGEgbyBjb250YWRvciBkZSB0ZW50YXRpdmFzXG4gICAqL1xuICBpbmNyZW1lbnRBdHRlbXB0cygpOiB2b2lkIHtcbiAgICB0aGlzLmF0dGVtcHRzICs9IDE7XG4gICAgdGhpcy5sYXN0X2F0dGVtcHRfYXQgPSBuZXcgRGF0ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGEgbyB0ZW1wbyByZXN0YW50ZSBhdMOpIGEgZXhwaXJhw6fDo28gZW0gbWludXRvc1xuICAgKiBAcmV0dXJucyBNaW51dG9zIHJlc3RhbnRlcyBvdSAwIHNlIGV4cGlyYWRvXG4gICAqL1xuICBnZXRNaW51dGVzVW50aWxFeHBpcmF0aW9uKCk6IG51bWJlciB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICBpZiAodGhpcy5leHBpcmVzX2F0IDw9IG5vdykge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIHJldHVybiBNYXRoLmNlaWwoKHRoaXMuZXhwaXJlc19hdC5nZXRUaW1lKCkgLSBub3cuZ2V0VGltZSgpKSAvICgxMDAwICogNjApKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIHRva2VuIHBlcnRlbmNlIGEgdW0gdXN1w6FyaW8gZXNwZWPDrWZpY29cbiAgICogQHBhcmFtIHVzdWFyaW9JZCBJRCBkbyB1c3XDoXJpb1xuICAgKiBAcmV0dXJucyB0cnVlIHNlIHBlcnRlbmNlIGFvIHVzdcOhcmlvXG4gICAqL1xuICBiZWxvbmdzVG9Vc2VyKHVzdWFyaW9JZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudXN1YXJpb19pZCA9PT0gdXN1YXJpb0lkO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIG8gdG9rZW4gZm9pIGNyaWFkbyByZWNlbnRlbWVudGUgKMO6bHRpbWFzIDI0IGhvcmFzKVxuICAgKiBAcmV0dXJucyB0cnVlIHNlIGZvaSBjcmlhZG8gcmVjZW50ZW1lbnRlXG4gICAqL1xuICBpc1JlY2VudGx5Q3JlYXRlZCgpOiBib29sZWFuIHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IG9uZURheUFnbyA9IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgLSAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGVkX2F0ID4gb25lRGF5QWdvO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIGjDoSBtdWl0YXMgdGVudGF0aXZhcyBkZSB1c28gKHBvc3PDrXZlbCBhdGFxdWUpXG4gICAqIEBwYXJhbSBtYXhBdHRlbXB0cyBOw7ptZXJvIG3DoXhpbW8gZGUgdGVudGF0aXZhcyBwZXJtaXRpZGFzXG4gICAqIEByZXR1cm5zIHRydWUgc2UgZXhjZWRldSBvIGxpbWl0ZVxuICAgKi9cbiAgaGFzVG9vTWFueUF0dGVtcHRzKG1heEF0dGVtcHRzOiBudW1iZXIgPSA1KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuYXR0ZW1wdHMgPj0gbWF4QXR0ZW1wdHM7XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyB0b2tlbiBleHBpcmEgZW0gYnJldmUgKHByw7N4aW1vcyA1IG1pbnV0b3MpXG4gICAqIEBwYXJhbSBtaW51dGVzIE1pbnV0b3MgcGFyYSBjb25zaWRlcmFyIGNvbW8gXCJlbSBicmV2ZVwiXG4gICAqIEByZXR1cm5zIHRydWUgc2UgZXhwaXJhIGVtIGJyZXZlXG4gICAqL1xuICBleHBpcmVzV2l0aGluKG1pbnV0ZXM6IG51bWJlciA9IDUpOiBib29sZWFuIHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGZ1dHVyZVRpbWUgPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpICsgbWludXRlcyAqIDYwICogMTAwMCk7XG4gICAgcmV0dXJuIHRoaXMuZXhwaXJlc19hdCA8PSBmdXR1cmVUaW1lO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGEgaMOhIHF1YW50b3MgbWludXRvcyBvIHRva2VuIGZvaSBjcmlhZG9cbiAgICogQHJldHVybnMgbWludXRvcyBkZXNkZSBhIGNyaWHDp8Ojb1xuICAgKi9cbiAgZ2V0TWludXRlc1NpbmNlQ3JlYXRpb24oKTogbnVtYmVyIHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGRpZmZNcyA9IG5vdy5nZXRUaW1lKCkgLSB0aGlzLmNyZWF0ZWRfYXQuZ2V0VGltZSgpO1xuICAgIHJldHVybiBNYXRoLmZsb29yKGRpZmZNcyAvICgxMDAwICogNjApKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnTDqW0gbyBzdGF0dXMgYXR1YWwgZG8gdG9rZW5cbiAgICogQHJldHVybnMgc3RhdHVzIGRvIHRva2VuXG4gICAqL1xuICBnZXRTdGF0dXMoKTogJ3ZhbGlkJyB8ICdleHBpcmVkJyB8ICd1c2VkJyB8ICd0b29fbWFueV9hdHRlbXB0cycge1xuICAgIGlmICh0aGlzLmlzX3VzZWQpIHJldHVybiAndXNlZCc7XG4gICAgaWYgKHRoaXMuaXNFeHBpcmVkKCkpIHJldHVybiAnZXhwaXJlZCc7XG4gICAgaWYgKHRoaXMuaGFzVG9vTWFueUF0dGVtcHRzKCkpIHJldHVybiAndG9vX21hbnlfYXR0ZW1wdHMnO1xuICAgIHJldHVybiAndmFsaWQnO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIHRlbSBpbmZvcm1hw6fDtWVzIGRlIGNsaWVudGUgKElQIGUgVXNlciBBZ2VudClcbiAgICogQHJldHVybnMgdHJ1ZSBzZSB0ZW0gaW5mb3JtYcOnw7VlcyBkZSBjbGllbnRlXG4gICAqL1xuICBoYXNDbGllbnRJbmZvKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhISh0aGlzLmNsaWVudF9pcCB8fCB0aGlzLnVzZXJfYWdlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkaWNpb25hIG1ldGFkYWRvcyBhbyB0b2tlblxuICAgKiBAcGFyYW0ga2V5IENoYXZlIGRvIG1ldGFkYWRvXG4gICAqIEBwYXJhbSB2YWx1ZSBWYWxvciBkbyBtZXRhZGFkb1xuICAgKi9cbiAgYWRkTWV0YWRhdGEoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMubWV0YWRhdGEpIHtcbiAgICAgIHRoaXMubWV0YWRhdGEgPSB7fTtcbiAgICB9XG4gICAgdGhpcy5tZXRhZGF0YVtrZXldID0gdmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogT2J0w6ltIHVtIG1ldGFkYWRvIGVzcGVjw61maWNvXG4gICAqIEBwYXJhbSBrZXkgQ2hhdmUgZG8gbWV0YWRhZG9cbiAgICogQHJldHVybnMgVmFsb3IgZG8gbWV0YWRhZG8gb3UgdW5kZWZpbmVkXG4gICAqL1xuICBnZXRNZXRhZGF0YShrZXk6IHN0cmluZyk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMubWV0YWRhdGE/LltrZXldO1xuICB9XG5cbiAgLyoqXG4gICAqIE9idMOpbSBpbmZvcm1hw6fDtWVzIHJlc3VtaWRhcyBkbyB0b2tlblxuICAgKiBAcmV0dXJucyBvYmpldG8gY29tIGluZm9ybWHDp8O1ZXMgcmVzdW1pZGFzXG4gICAqL1xuICBnZXRTdW1tYXJ5KCk6IHtcbiAgICBpZDogc3RyaW5nO1xuICAgIHVzdWFyaW9faWQ6IHN0cmluZztcbiAgICBpc191c2VkOiBib29sZWFuO1xuICAgIGV4cGlyZXNfYXQ6IERhdGU7XG4gICAgY3JlYXRlZF9hdDogRGF0ZTtcbiAgICBhdHRlbXB0czogbnVtYmVyO1xuICAgIHN0YXR1czogc3RyaW5nO1xuICAgIG1pbnV0ZXNVbnRpbEV4cGlyYXRpb246IG51bWJlcjtcbiAgICBoYXNDbGllbnRJbmZvOiBib29sZWFuO1xuICB9IHtcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IHRoaXMuaWQsXG4gICAgICB1c3VhcmlvX2lkOiB0aGlzLnVzdWFyaW9faWQsXG4gICAgICBpc191c2VkOiB0aGlzLmlzX3VzZWQsXG4gICAgICBleHBpcmVzX2F0OiB0aGlzLmV4cGlyZXNfYXQsXG4gICAgICBjcmVhdGVkX2F0OiB0aGlzLmNyZWF0ZWRfYXQsXG4gICAgICBhdHRlbXB0czogdGhpcy5hdHRlbXB0cyxcbiAgICAgIHN0YXR1czogdGhpcy5nZXRTdGF0dXMoKSxcbiAgICAgIG1pbnV0ZXNVbnRpbEV4cGlyYXRpb246IHRoaXMuZ2V0TWludXRlc1VudGlsRXhwaXJhdGlvbigpLFxuICAgICAgaGFzQ2xpZW50SW5mbzogdGhpcy5oYXNDbGllbnRJbmZvKCksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbnZhbGlkYSBvIHRva2VuIGNvbSB1bSBtb3Rpdm8gZXNwZWPDrWZpY29cbiAgICogQHBhcmFtIHJlYXNvbiBNb3Rpdm8gZGEgaW52YWxpZGHDp8Ojb1xuICAgKi9cbiAgaW52YWxpZGF0ZShyZWFzb246IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuaXNfdXNlZCA9IHRydWU7XG4gICAgdGhpcy51c2VkX2F0ID0gbmV3IERhdGUoKTtcbiAgICB0aGlzLmludmFsaWRhdGlvbl9yZWFzb24gPSByZWFzb247XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2Egc2UgbyB0b2tlbiBmb2kgaW52YWxpZGFkbyBwb3IgbW90aXZvcyBkZSBzZWd1cmFuw6dhXG4gICAqIEByZXR1cm5zIHRydWUgc2UgZm9pIGludmFsaWRhZG8gcG9yIHNlZ3VyYW7Dp2FcbiAgICovXG4gIGlzU2VjdXJpdHlJbnZhbGlkYXRlZCgpOiBib29sZWFuIHtcbiAgICBjb25zdCBzZWN1cml0eVJlYXNvbnMgPSBbXG4gICAgICAnc3VzcGljaW91c19hY3Rpdml0eScsXG4gICAgICAndG9vX21hbnlfYXR0ZW1wdHMnLFxuICAgICAgJ3NlY3VyaXR5X2JyZWFjaCcsXG4gICAgICAnYWRtaW5fcmV2b2tlJyxcbiAgICBdO1xuXG4gICAgcmV0dXJuIHNlY3VyaXR5UmVhc29ucy5pbmNsdWRlcyh0aGlzLmludmFsaWRhdGlvbl9yZWFzb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlcmEgdW1hIGNoYXZlIMO6bmljYSBwYXJhIG8gdG9rZW5cbiAgICogQHJldHVybnMgY2hhdmUgw7puaWNhXG4gICAqL1xuICBnZXRVbmlxdWVLZXkoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYHBhc3N3b3JkX3Jlc2V0XyR7dGhpcy51c3VhcmlvX2lkfV8ke3RoaXMuaWR9YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZmljYSBzZSBvIHRva2VuIGVzdMOhIGVtIGVzdGFkbyBjb25zaXN0ZW50ZVxuICAgKiBAcmV0dXJucyB0cnVlIHNlIGVzdMOhIGNvbnNpc3RlbnRlXG4gICAqL1xuICBpc0NvbnNpc3RlbnQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgICEhdGhpcy5pZCAmJlxuICAgICAgISF0aGlzLnRva2VuICYmXG4gICAgICAhIXRoaXMudG9rZW5faGFzaCAmJlxuICAgICAgISF0aGlzLnVzdWFyaW9faWQgJiZcbiAgICAgICEhdGhpcy5leHBpcmVzX2F0ICYmXG4gICAgICAhIXRoaXMuY3JlYXRlZF9hdCAmJlxuICAgICAgdHlwZW9mIHRoaXMuaXNfdXNlZCA9PT0gJ2Jvb2xlYW4nICYmXG4gICAgICB0eXBlb2YgdGhpcy5hdHRlbXB0cyA9PT0gJ251bWJlcidcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBpbmZvcm1hw6fDtWVzIHNlbnPDrXZlaXMgcGFyYSBsb2dzXG4gICAqIEByZXR1cm5zIG9iamV0byBzYW5pdGl6YWRvXG4gICAqL1xuICB0b1NhZmVMb2coKToge1xuICAgIGlkOiBzdHJpbmc7XG4gICAgdXN1YXJpb19pZDogc3RyaW5nO1xuICAgIHRva2VuX3ByZXZpZXc6IHN0cmluZztcbiAgICBpc191c2VkOiBib29sZWFuO1xuICAgIGV4cGlyZXNfYXQ6IERhdGU7XG4gICAgY3JlYXRlZF9hdDogRGF0ZTtcbiAgICBhdHRlbXB0czogbnVtYmVyO1xuICAgIHN0YXR1czogc3RyaW5nO1xuICAgIGhhc0NsaWVudEluZm86IGJvb2xlYW47XG4gIH0ge1xuICAgIHJldHVybiB7XG4gICAgICBpZDogdGhpcy5pZCxcbiAgICAgIHVzdWFyaW9faWQ6IHRoaXMudXN1YXJpb19pZCxcbiAgICAgIHRva2VuX3ByZXZpZXc6IHRoaXMudG9rZW4uc3Vic3RyaW5nKDAsIDgpICsgJy4uLicsXG4gICAgICBpc191c2VkOiB0aGlzLmlzX3VzZWQsXG4gICAgICBleHBpcmVzX2F0OiB0aGlzLmV4cGlyZXNfYXQsXG4gICAgICBjcmVhdGVkX2F0OiB0aGlzLmNyZWF0ZWRfYXQsXG4gICAgICBhdHRlbXB0czogdGhpcy5hdHRlbXB0cyxcbiAgICAgIHN0YXR1czogdGhpcy5nZXRTdGF0dXMoKSxcbiAgICAgIGhhc0NsaWVudEluZm86IHRoaXMuaGFzQ2xpZW50SW5mbygpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRm9ybWF0YSBhIGRhdGEgZGUgZXhwaXJhw6fDo28gcGFyYSBleGliacOnw6NvXG4gICAqIEByZXR1cm5zIGRhdGEgZm9ybWF0YWRhXG4gICAqL1xuICBnZXRFeHBpcmFjYW9Gb3JtYXRhZGEoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5leHBpcmVzX2F0LnRvTG9jYWxlU3RyaW5nKCdwdC1CUicsIHtcbiAgICAgIHllYXI6ICdudW1lcmljJyxcbiAgICAgIG1vbnRoOiAnMi1kaWdpdCcsXG4gICAgICBkYXk6ICcyLWRpZ2l0JyxcbiAgICAgIGhvdXI6ICcyLWRpZ2l0JyxcbiAgICAgIG1pbnV0ZTogJzItZGlnaXQnLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcm1hdGEgYSBkYXRhIGRlIGNyaWHDp8OjbyBwYXJhIGV4aWJpw6fDo29cbiAgICogQHJldHVybnMgZGF0YSBmb3JtYXRhZGFcbiAgICovXG4gIGdldENyaWFjYW9Gb3JtYXRhZGEoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGVkX2F0LnRvTG9jYWxlU3RyaW5nKCdwdC1CUicsIHtcbiAgICAgIHllYXI6ICdudW1lcmljJyxcbiAgICAgIG1vbnRoOiAnMi1kaWdpdCcsXG4gICAgICBkYXk6ICcyLWRpZ2l0JyxcbiAgICAgIGhvdXI6ICcyLWRpZ2l0JyxcbiAgICAgIG1pbnV0ZTogJzItZGlnaXQnLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIHNlIG8gdG9rZW4gcG9kZSBzZXIgdXNhZG8gcGFyYSByZXNldCBkZSBzZW5oYVxuICAgKiBAcmV0dXJucyB0cnVlIHNlIHBvZGUgc2VyIHVzYWRvXG4gICAqL1xuICBjYW5CZVVzZWRGb3JSZXNldCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5pc1ZhbGlkKCkgJiZcbiAgICAgICF0aGlzLmhhc1Rvb01hbnlBdHRlbXB0cygpICYmXG4gICAgICAhdGhpcy5pc1NlY3VyaXR5SW52YWxpZGF0ZWQoKVxuICAgICk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==