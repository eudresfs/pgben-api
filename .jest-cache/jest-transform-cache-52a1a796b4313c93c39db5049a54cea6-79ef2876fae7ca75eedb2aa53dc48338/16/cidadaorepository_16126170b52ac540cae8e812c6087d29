1d610ff0dc4518c41de7b910458fed98
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CidadaoRepository = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("typeorm");
const cidadao_entity_1 = require("../../../entities/cidadao.entity");
const composicao_familiar_entity_1 = require("../../../entities/composicao-familiar.entity");
const exceptions_1 = require("../../../shared/exceptions");
/**
 * Repositório de cidadãos
 *
 * Responsável por operações de acesso a dados relacionadas a cidadãos
 */
let CidadaoRepository = class CidadaoRepository {
    dataSource;
    repository;
    constructor(dataSource) {
        this.dataSource = dataSource;
        this.repository = this.dataSource.getRepository(cidadao_entity_1.Cidadao);
    }
    /**
     * Busca todos os cidadãos com filtros e paginação tradicional por offset
     * @param options Opções de filtro e paginação
     * @returns Lista de cidadãos paginada e contagem total
     */
    async findAll(options) {
        const { skip = 0, take = 10, where = {}, order = { created_at: 'DESC' }, includeRelations = false, specificFields = [], } = options || {};
        const queryBuilder = this.repository.createQueryBuilder('cidadao');
        // Selecionar apenas campos necessários se especificados
        if (specificFields.length > 0) {
            const fields = specificFields.map((field) => `cidadao.${field}`);
            queryBuilder.select(fields);
        }
        // Aplicar filtros de busca otimizados
        if (where.$or) {
            const searchConditions = where.$or.map((condition, index) => {
                const paramKey = `search_${index}`;
                if (condition.nome) {
                    queryBuilder.setParameter(paramKey, condition.nome.$iLike.replace(/%/g, ''));
                    return `cidadao.nome ILIKE '%' || :${paramKey} || '%'`;
                }
                if (condition.cpf) {
                    queryBuilder.setParameter(paramKey, condition.cpf.$iLike.replace(/%/g, ''));
                    return `cidadao.cpf ILIKE '%' || :${paramKey} || '%'`;
                }
                if (condition.nis) {
                    queryBuilder.setParameter(paramKey, condition.nis.$iLike.replace(/%/g, ''));
                    return `cidadao.nis ILIKE '%' || :${paramKey} || '%'`;
                }
                return '1=0';
            });
            queryBuilder.andWhere(`(${searchConditions.join(' OR ')})`);
            delete where.$or;
        }
        // Aplicar filtros de endereço
        if (where['endereco.bairro']) {
            queryBuilder.andWhere("cidadao.endereco->>'bairro' ILIKE :bairro", {
                bairro: `%${where['endereco.bairro'].$iLike.replace(/%/g, '')}%`,
            });
            delete where['endereco.bairro'];
        }
        // Aplicar outros filtros
        Object.keys(where).forEach((key) => {
            if (where[key] !== undefined) {
                queryBuilder.andWhere(`cidadao.${key} = :${key}`, {
                    [key]: where[key],
                });
            }
        });
        // Incluir relacionamentos apenas se necessário
        if (includeRelations) {
            queryBuilder
                .leftJoinAndSelect('cidadao.papeis', 'papeis', 'papeis.ativo = :papelAtivo', { papelAtivo: true })
                .leftJoinAndSelect('cidadao.composicao_familiar', 'composicao_familiar')
                .leftJoinAndSelect('cidadao.unidade', 'unidade');
        }
        // Aplicar ordenação
        Object.keys(order).forEach((key) => {
            queryBuilder.addOrderBy(`cidadao.${key}`, order[key]);
        });
        // Aplicar paginação
        queryBuilder.skip(skip).take(take);
        // Gerar log da query em desenvolvimento para debug
        if (process.env.NODE_ENV === 'development') {
            const [query, parameters] = queryBuilder.getQueryAndParameters();
            console.log('Query gerada:', query);
            console.log('Parâmetros:', parameters);
        }
        return queryBuilder.getManyAndCount();
    }
    /**
     * Busca um cidadão pelo ID com relacionamentos otimizados
     * @param id ID do cidadão
     * @param includeRelations Se deve incluir relacionamentos (papéis, composição familiar)
     * @returns Cidadão encontrado ou null
     */
    async findById(id, includeRelations = false, specificFields) {
        const query = this.repository
            .createQueryBuilder('cidadao')
            .where('cidadao.id = :id', { id });
        // Selecionar apenas campos específicos se solicitado
        if (specificFields && specificFields.length > 0) {
            const fields = specificFields.map((field) => `cidadao.${field}`);
            query.select(fields);
        }
        if (includeRelations) {
            query
                .leftJoinAndSelect('cidadao.papeis', 'papeis', 'papeis.ativo = :papelAtivo', { papelAtivo: true })
                .leftJoinAndSelect('cidadao.composicao_familiar', 'composicao_familiar')
                .leftJoinAndSelect('cidadao.unidade', 'unidade');
        }
        // Log em ambiente de desenvolvimento
        if (process.env.NODE_ENV === 'development') {
            const [queryStr, parameters] = query.getQueryAndParameters();
            console.log('Query findById:', queryStr);
            console.log('Parâmetros:', parameters);
        }
        return query.getOne();
    }
    /**
     * Busca um cidadão pelo CPF
     * @param cpf CPF do cidadão
     * @param includeRelations Se deve incluir relacionamentos (papéis, composição familiar)
     * @returns Cidadão encontrado ou null
     */
    async findByCpf(cpf, includeRelations = false, specificFields) {
        // Normaliza o CPF removendo caracteres não numéricos
        const cpfNormalizado = cpf.replace(/\D/g, '');
        const query = this.repository
            .createQueryBuilder('cidadao')
            .where('cidadao.cpf = :cpf', { cpf: cpfNormalizado });
        // Selecionar apenas campos específicos se solicitado
        if (specificFields && specificFields.length > 0) {
            const fields = specificFields.map((field) => `cidadao.${field}`);
            query.select(fields);
        }
        if (includeRelations) {
            query
                .leftJoinAndSelect('cidadao.papeis', 'papeis', 'papeis.ativo = :papelAtivo', { papelAtivo: true })
                .leftJoinAndSelect('cidadao.composicao_familiar', 'composicao_familiar')
                .leftJoinAndSelect('cidadao.unidade', 'unidade');
        }
        // Usar cache para CPF (identificador único e frequentemente consultado)
        query.cache(true);
        return query.getOne();
    }
    /**
     * Busca cidadão por NIS
     * @param nis NIS do cidadão
     * @param includeRelations Se deve incluir relacionamentos
     * @returns Cidadão encontrado ou null
     */
    async findByNis(nis, includeRelations = false, specificFields) {
        // Normaliza o NIS removendo caracteres não numéricos
        const nisNormalizado = nis.replace(/\D/g, '');
        const query = this.repository
            .createQueryBuilder('cidadao')
            .where('cidadao.nis = :nis', { nis: nisNormalizado });
        // Selecionar apenas campos específicos se solicitado
        if (specificFields && specificFields.length > 0) {
            const fields = specificFields.map((field) => `cidadao.${field}`);
            query.select(fields);
        }
        if (includeRelations) {
            query
                .leftJoinAndSelect('cidadao.papeis', 'papeis', 'papeis.ativo = :papelAtivo', { papelAtivo: true })
                .leftJoinAndSelect('cidadao.composicao_familiar', 'composicao_familiar')
                .leftJoinAndSelect('cidadao.unidade', 'unidade');
        }
        // Usar cache para NIS (identificador único e frequentemente consultado)
        query.cache(true);
        return query.getOne();
    }
    /**
     * Busca cidadão por telefone
     * @param telefone Telefone do cidadão
     * @param includeRelations Se deve incluir relacionamentos
     * @returns Cidadão encontrado ou null
     */
    async findByTelefone(telefone, includeRelations = false, specificFields) {
        // Normaliza o telefone removendo caracteres não numéricos
        const telefoneNormalizado = telefone.replace(/\D/g, '');
        const query = this.repository
            .createQueryBuilder('cidadao')
            .where('cidadao.telefone = :telefone', { telefone: telefoneNormalizado });
        // Selecionar apenas campos específicos se solicitado
        if (specificFields && specificFields.length > 0) {
            const fields = specificFields.map((field) => `cidadao.${field}`);
            query.select(fields);
        }
        if (includeRelations) {
            query
                .leftJoinAndSelect('cidadao.papeis', 'papeis', 'papeis.ativo = :papelAtivo', { papelAtivo: true })
                .leftJoinAndSelect('cidadao.composicao_familiar', 'composicao_familiar')
                .leftJoinAndSelect('cidadao.unidade', 'unidade');
        }
        return query.getOne();
    }
    /**
     * Busca cidadão por nome (busca parcial)
     * @param nome Nome do cidadão
     * @param includeRelations Se deve incluir relacionamentos
     * @returns Lista de cidadãos encontrados
     */
    async findByNome(nome, includeRelations = false, specificFields) {
        const query = this.repository
            .createQueryBuilder('cidadao')
            .where('LOWER(cidadao.nome) ILIKE LOWER(:nome)', { nome: `%${nome}%` })
            .orderBy('cidadao.nome', 'ASC')
            .limit(50); // Limitar resultados para performance
        // Selecionar apenas campos específicos se solicitado
        if (specificFields && specificFields.length > 0) {
            const fields = specificFields.map((field) => `cidadao.${field}`);
            query.select(fields);
        }
        if (includeRelations) {
            query
                .leftJoinAndSelect('cidadao.papeis', 'papeis', 'papeis.ativo = :papelAtivo', { papelAtivo: true })
                .leftJoinAndSelect('cidadao.composicao_familiar', 'composicao_familiar')
                .leftJoinAndSelect('cidadao.unidade', 'unidade');
        }
        // Log em desenvolvimento
        if (process.env.NODE_ENV === 'development') {
            const [queryStr, parameters] = query.getQueryAndParameters();
            console.log('Query findByNome:', queryStr);
        }
        return query.getMany();
    }
    /**
     * Busca cidadãos com paginação via cursor para melhor performance com grandes volumes de dados
     *
     * @param options Opções de paginação e filtro
     * @returns Lista de cidadãos e informações de paginação via cursor
     */
    async findByCursor(options) {
        const { cursor, limit = 10, orderBy = 'created_at', orderDirection = 'DESC', where = {}, includeRelations = false, specificFields = [], } = options;
        // Validar limite máximo para evitar sobrecarga do banco
        const validLimit = Math.min(limit, 100);
        const queryBuilder = this.repository.createQueryBuilder('cidadao');
        // Selecionar apenas campos específicos se definidos
        if (specificFields.length > 0) {
            const fields = specificFields.map((field) => `cidadao.${field}`);
            queryBuilder.select(fields);
        }
        // Aplicar filtros
        Object.keys(where).forEach((key) => {
            if (where[key] !== undefined) {
                if (key === 'nome' && typeof where[key] === 'string') {
                    queryBuilder.andWhere(`LOWER(cidadao.${key}) ILIKE LOWER(:${key})`, {
                        [key]: `%${where[key]}%`,
                    });
                }
                else if (key === 'endereco.bairro' &&
                    typeof where[key] === 'string') {
                    queryBuilder.andWhere("cidadao.endereco->>'bairro' ILIKE :bairro", {
                        bairro: `%${where[key]}%`,
                    });
                }
                else if (key === 'endereco.cidade' &&
                    typeof where[key] === 'string') {
                    queryBuilder.andWhere("cidadao.endereco->>'cidade' ILIKE :cidade", {
                        cidade: `%${where[key]}%`,
                    });
                }
                else {
                    queryBuilder.andWhere(`cidadao.${key} = :${key}`, {
                        [key]: where[key],
                    });
                }
            }
        });
        // Aplicar filtro de cursor para paginação
        if (cursor) {
            // Para ordenamento DESC, precisamos obter registros < cursor
            // Para ordenamento ASC, precisamos obter registros > cursor
            const operator = orderDirection === 'DESC' ? '<' : '>';
            // Para timestamps
            if (orderBy === 'created_at' || orderBy === 'updated_at') {
                queryBuilder.andWhere(`cidadao.${orderBy} ${operator} (SELECT ${orderBy} FROM cidadao WHERE id = :cursorId)`, { cursorId: cursor });
            }
            // Para campos string ou numéricos
            else {
                queryBuilder.andWhere(`cidadao.${orderBy} ${operator} (SELECT ${orderBy} FROM cidadao WHERE id = :cursorId)`, { cursorId: cursor });
            }
        }
        // Incluir relacionamentos conforme solicitado
        if (includeRelations) {
            queryBuilder
                .leftJoinAndSelect('cidadao.papeis', 'papeis', 'papeis.ativo = :papelAtivo', { papelAtivo: true })
                .leftJoinAndSelect('cidadao.composicao_familiar', 'composicao_familiar')
                .leftJoinAndSelect('cidadao.unidade', 'unidade');
        }
        // Ordenar resultados
        queryBuilder.orderBy(`cidadao.${orderBy}`, orderDirection);
        // Adicionar ordenação secundária pelo ID para garantir determinismo quando há valores iguais
        queryBuilder.addOrderBy('cidadao.id', orderDirection);
        // Aplicar limite
        queryBuilder.take(validLimit + 1); // +1 para verificar se há mais páginas
        // Executar query
        const items = await queryBuilder.getMany();
        // Verificar se há mais páginas
        const hasNextPage = items.length > validLimit;
        if (hasNextPage) {
            items.pop(); // Remover o item extra que foi usado para verificar se há mais páginas
        }
        // Definir cursor para a próxima página
        const nextCursor = hasNextPage ? items[items.length - 1]?.id : undefined;
        // Obter contagem aproximada para metadados
        const countQuery = this.repository.createQueryBuilder('cidadao');
        // Aplicar os mesmos filtros que a query principal
        Object.keys(where).forEach((key) => {
            if (where[key] !== undefined) {
                if (key === 'nome' && typeof where[key] === 'string') {
                    countQuery.andWhere(`LOWER(cidadao.${key}) ILIKE LOWER(:${key})`, {
                        [key]: `%${where[key]}%`,
                    });
                }
                else if (key === 'endereco.bairro' &&
                    typeof where[key] === 'string') {
                    countQuery.andWhere("cidadao.endereco->>'bairro' ILIKE :bairro", {
                        bairro: `%${where[key]}%`,
                    });
                }
                else if (key === 'endereco.cidade' &&
                    typeof where[key] === 'string') {
                    countQuery.andWhere("cidadao.endereco->>'cidade' ILIKE :cidade", {
                        cidade: `%${where[key]}%`,
                    });
                }
                else {
                    countQuery.andWhere(`cidadao.${key} = :${key}`, {
                        [key]: where[key],
                    });
                }
            }
        });
        // Usar estimate quando possível para maior performance
        const count = await countQuery.getCount();
        return {
            items,
            count: items.length,
            nextCursor,
            hasNextPage,
        };
    }
    /**
     * Cria um novo cidadão
     * @param data Dados do cidadão
     * @returns Cidadão criado
     */
    async create(data) {
        // Normaliza o CPF removendo caracteres não numéricos
        if (data.cpf) {
            data.cpf = data.cpf.replace(/\D/g, '');
        }
        // Normaliza o NIS removendo caracteres não numéricos
        if (data.nis) {
            data.nis = data.nis.replace(/\D/g, '');
        }
        // Normaliza o enum sexo para minúsculo
        if (data.sexo) {
            data.sexo = data.sexo.toLowerCase();
        }
        const cidadao = this.repository.create(data);
        return this.repository.save(cidadao);
    }
    /**
     * Atualiza um cidadão existente
     * @param id ID do cidadão
     * @param data Dados a serem atualizados
     * @returns Cidadão atualizado
     * @throws NotFoundException se o cidadão não for encontrado
     */
    async update(id, data) {
        // Normaliza o CPF removendo caracteres não numéricos
        if (data.cpf) {
            data.cpf = data.cpf.replace(/\D/g, '');
        }
        // Normaliza o NIS removendo caracteres não numéricos
        if (data.nis) {
            data.nis = data.nis.replace(/\D/g, '');
        }
        // Normaliza o enum sexo para minúsculo
        if (data.sexo) {
            data.sexo = data.sexo.toLowerCase();
        }
        const updateResult = await this.repository.update(id, data);
        if (updateResult.affected === 0) {
            throw new common_1.NotFoundException('Cidadão não encontrado');
        }
        const cidadao = await this.findById(id, true);
        if (!cidadao) {
            throw new common_1.NotFoundException('Cidadão não encontrado após atualização');
        }
        return cidadao;
    }
    /**
     * Adiciona membro à composição familiar
     * @param id ID do cidadão
     * @param membro Dados do membro familiar
     * @returns Cidadão atualizado
     */
    async addComposicaoFamiliar(id, membro) {
        const cidadao = await this.findById(id, false); // Não precisa de relacionamentos para validação
        if (!cidadao) {
            throw new exceptions_1.EntityNotFoundException('Cidadão', id);
        }
        // Verificar se já existe membro com o mesmo nome na composição familiar
        const composicaoFamiliarRepository = this.dataSource.getRepository(composicao_familiar_entity_1.ComposicaoFamiliar);
        const membroExistente = await composicaoFamiliarRepository.findOne({
            where: {
                cidadao_id: id,
                nome: membro.nome,
            },
        });
        if (membroExistente) {
            throw new common_1.BadRequestException(`Já existe um membro com o nome '${membro.nome}' na composição familiar deste cidadão`);
        }
        // Verificar se já existe membro com o mesmo CPF na composição familiar
        const cpfFormatado = membro.cpf?.replace(/\D/g, '');
        if (cpfFormatado) {
            const membroComMesmoCpf = await composicaoFamiliarRepository.findOne({
                where: {
                    cidadao_id: id,
                    cpf: cpfFormatado,
                },
            });
            if (membroComMesmoCpf) {
                throw new common_1.BadRequestException(`Já existe um membro com o CPF '${cpfFormatado}' na composição familiar deste cidadão`);
            }
        }
        // Criar nova entrada na tabela composicao_familiar
        // O cidadao_id vem do parâmetro da rota, não do body
        const novoMembro = composicaoFamiliarRepository.create({
            cidadao_id: id,
            nome: membro.nome,
            cpf: cpfFormatado,
            nis: membro.nis?.replace(/\D/g, ''),
            idade: membro.idade,
            ocupacao: membro.ocupacao,
            escolaridade: membro.escolaridade,
            parentesco: membro.parentesco,
            renda: membro.renda || 0,
            observacoes: membro.observacoes,
        });
        try {
            await composicaoFamiliarRepository.save(novoMembro);
        }
        catch (error) {
            // Capturar erro específico da trigger de exclusividade de papel
            if (error.message &&
                error.message.includes('Cidadão não pode ser adicionado à composição familiar, pois já é beneficiário')) {
                throw new common_1.ConflictException('Cidadão não pode ser adicionado à composição familiar pois já possui papel de beneficiário.');
            }
            // Capturar erros de violação de restrição de unicidade
            if (error.code === '23505') {
                // Código PostgreSQL para violação de restrição única
                throw new common_1.BadRequestException(`Não foi possível adicionar o membro à composição familiar. Já existe um membro com o mesmo nome ou CPF.`);
            }
            // Capturar erros de violação de chave estrangeira
            if (error.code === '23503') {
                throw new common_1.BadRequestException('Dados inválidos fornecidos para o membro da composição familiar.');
            }
            throw error;
        }
        // Retornar cidadão atualizado com relacionamentos
        const cidadaoAtualizado = await this.findById(id, true);
        if (!cidadaoAtualizado) {
            throw new exceptions_1.EntityNotFoundException('Cidadão', id);
        }
        return cidadaoAtualizado;
    }
    /**
     * Remove um cidadão (soft delete)
     * @param id ID do cidadão
     * @returns Resultado da operação
     */
    async remove(id) {
        await this.repository.softDelete(id);
    }
};
exports.CidadaoRepository = CidadaoRepository;
exports.CidadaoRepository = CidadaoRepository = __decorate([
    (0, common_1.Injectable)(),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_1.DataSource !== "undefined" && typeorm_1.DataSource) === "function" ? _a : Object])
], CidadaoRepository);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGNpZGFkYW9cXHJlcG9zaXRvcmllc1xcY2lkYWRhby5yZXBvc2l0b3J5LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FLd0I7QUFDeEIscUNBQWlEO0FBQ2pELHFFQUEyRDtBQUMzRCw2RkFBa0Y7QUFDbEYsMkRBQXFFO0FBRXJFOzs7O0dBSUc7QUFFSSxJQUFNLGlCQUFpQixHQUF2QixNQUFNLGlCQUFpQjtJQUdSO0lBRlosVUFBVSxDQUFzQjtJQUV4QyxZQUFvQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3hDLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsd0JBQU8sQ0FBQyxDQUFDO0lBQzNELENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQU9iO1FBQ0MsTUFBTSxFQUNKLElBQUksR0FBRyxDQUFDLEVBQ1IsSUFBSSxHQUFHLEVBQUUsRUFDVCxLQUFLLEdBQUcsRUFBRSxFQUNWLEtBQUssR0FBRyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsRUFDOUIsZ0JBQWdCLEdBQUcsS0FBSyxFQUN4QixjQUFjLEdBQUcsRUFBRSxHQUNwQixHQUFHLE9BQU8sSUFBSSxFQUFFLENBQUM7UUFFbEIsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVuRSx3REFBd0Q7UUFDeEQsSUFBSSxjQUFjLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQzlCLE1BQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLFdBQVcsS0FBSyxFQUFFLENBQUMsQ0FBQztZQUNqRSxZQUFZLENBQUMsTUFBTSxDQUFDLE1BQU0s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RDtnQkFDckQsTUFBTSxJQUFJLDRCQUFtQixDQUMzQix5R0FBeUcsQ0FDMUcsQ0FBQztZQUNKLENBQUM7WUFFRCxrREFBa0Q7WUFDbEQsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLE9BQU8sRUFBRSxDQUFDO2dCQUMzQixNQUFNLElBQUksNEJBQW1CLENBQzNCLGtFQUFrRSxDQUNuRSxDQUFDO1lBQ0osQ0FBQztZQUVELE1BQU0sS0FBSyxDQUFDO1FBQ2QsQ0FBQztRQUVELGtEQUFrRDtRQUNsRCxNQUFNLGlCQUFpQixHQUFHLE1BQU0sSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDeEQsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDdkIsTUFBTSxJQUFJLG9DQUF1QixDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNuRCxDQUFDO1FBQ0QsT0FBTyxpQkFBaUIsQ0FBQztJQUMzQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBVTtRQUNyQixNQUFNLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7Q0FDRixDQUFBO0FBM3BCWSw4Q0FBaUI7NEJBQWpCLGlCQUFpQjtJQUQ3QixJQUFBLG1CQUFVLEdBQUU7eURBSXFCLG9CQUFVLG9CQUFWLG9CQUFVO0dBSC9CLGlCQUFpQixDQTJwQjdCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxtb2R1bGVzXFxjaWRhZGFvXFxyZXBvc2l0b3JpZXNcXGNpZGFkYW8ucmVwb3NpdG9yeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBJbmplY3RhYmxlLFxuICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxuICBDb25mbGljdEV4Y2VwdGlvbixcbiAgTm90Rm91bmRFeGNlcHRpb24sXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IFJlcG9zaXRvcnksIERhdGFTb3VyY2UgfSBmcm9tICd0eXBlb3JtJztcbmltcG9ydCB7IENpZGFkYW8gfSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy9jaWRhZGFvLmVudGl0eSc7XG5pbXBvcnQgeyBDb21wb3NpY2FvRmFtaWxpYXIgfSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy9jb21wb3NpY2FvLWZhbWlsaWFyLmVudGl0eSc7XG5pbXBvcnQgeyBFbnRpdHlOb3RGb3VuZEV4Y2VwdGlvbiB9IGZyb20gJy4uLy4uLy4uL3NoYXJlZC9leGNlcHRpb25zJztcblxuLyoqXG4gKiBSZXBvc2l0w7NyaW8gZGUgY2lkYWTDo29zXG4gKlxuICogUmVzcG9uc8OhdmVsIHBvciBvcGVyYcOnw7VlcyBkZSBhY2Vzc28gYSBkYWRvcyByZWxhY2lvbmFkYXMgYSBjaWRhZMOjb3NcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIENpZGFkYW9SZXBvc2l0b3J5IHtcbiAgcHJpdmF0ZSByZXBvc2l0b3J5OiBSZXBvc2l0b3J5PENpZGFkYW8+O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZGF0YVNvdXJjZTogRGF0YVNvdXJjZSkge1xuICAgIHRoaXMucmVwb3NpdG9yeSA9IHRoaXMuZGF0YVNvdXJjZS5nZXRSZXBvc2l0b3J5KENpZGFkYW8pO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhIHRvZG9zIG9zIGNpZGFkw6NvcyBjb20gZmlsdHJvcyBlIHBhZ2luYcOnw6NvIHRyYWRpY2lvbmFsIHBvciBvZmZzZXRcbiAgICogQHBhcmFtIG9wdGlvbnMgT3DDp8O1ZXMgZGUgZmlsdHJvIGUgcGFnaW5hw6fDo29cbiAgICogQHJldHVybnMgTGlzdGEgZGUgY2lkYWTDo29zIHBhZ2luYWRhIGUgY29udGFnZW0gdG90YWxcbiAgICovXG4gIGFzeW5jIGZpbmRBbGwob3B0aW9ucz86IHtcbiAgICBza2lwPzogbnVtYmVyO1xuICAgIHRha2U/OiBudW1iZXI7XG4gICAgd2hlcmU/OiBhbnk7XG4gICAgb3JkZXI/OiBhbnk7XG4gICAgaW5jbHVkZVJlbGF0aW9ucz86IGJvb2xlYW47XG4gICAgc3BlY2lmaWNGaWVsZHM/OiBzdHJpbmdbXTtcbiAgfSk6IFByb21pc2U8W0NpZGFkYW9bXSwgbnVtYmVyXT4ge1xuICAgIGNvbnN0IHtcbiAgICAgIHNraXAgPSAwLFxuICAgICAgdGFrZSA9IDEwLFxuICAgICAgd2hlcmUgPSB7fSxcbiAgICAgIG9yZGVyID0geyBjcmVhdGVkX2F0OiAnREVTQycgfSxcbiAgICAgIGluY2x1ZGVSZWxhdGlvbnMgPSBmYWxzZSxcbiAgICAgIHNwZWNpZmljRmllbGRzID0gW10sXG4gICAgfSA9IG9wdGlvbnMgfHwge307XG5cbiAgICBjb25zdCBxdWVyeUJ1aWxkZXIgPSB0aGlzLnJlcG9zaXRvcnkuY3JlYXRlUXVlcnlCdWlsZGVyKCdjaWRhZGFvJyk7XG5cbiAgICAvLyBTZWxlY2lvbmFyIGFwZW5hcyBjYW1wb3MgbmVjZXNzw6FyaW9zIHNlIGVzcGVjaWZpY2Fkb3NcbiAgICBpZiAoc3BlY2lmaWNGaWVsZHMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgZmllbGRzID0gc3BlY2lmaWNGaWVsZHMubWFwKChmaWVsZCkgPT4gYGNpZGFkYW8uJHtmaWVsZH1gKTtcbiAgICAgIHF1ZXJ5QnVpbGRlci5zZWxlY3QoZmllbGRzKTtcbiAgICB9XG5cbiAgICAvLyBBcGxpY2FyIGZpbHRyb3MgZGUgYnVzY2Egb3RpbWl6YWRvc1xuICAgIGlmICh3aGVyZS4kb3IpIHtcbiAgICAgIGNvbnN0IHNlYXJjaENvbmRpdGlvbnMgPSB3aGVyZS4kb3IubWFwKFxuICAgICAgICAoY29uZGl0aW9uOiBhbnksIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgICBjb25zdCBwYXJhbUtleSA9IGBzZWFyY2hfJHtpbmRleH1gO1xuICAgICAgICAgIGlmIChjb25kaXRpb24ubm9tZSkge1xuICAgICAgICAgICAgcXVlcnlCdWlsZGVyLnNldFBhcmFtZXRlcihcbiAgICAgICAgICAgICAgcGFyYW1LZXksXG4gICAgICAgICAgICAgIGNvbmRpdGlvbi5ub21lLiRpTGlrZS5yZXBsYWNlKC8lL2csICcnKSxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gYGNpZGFkYW8ubm9tZSBJTElLRSAnJScgfHwgOiR7cGFyYW1LZXl9IHx8ICclJ2A7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjb25kaXRpb24uY3BmKSB7XG4gICAgICAgICAgICBxdWVyeUJ1aWxkZXIuc2V0UGFyYW1ldGVyKFxuICAgICAgICAgICAgICBwYXJhbUtleSxcbiAgICAgICAgICAgICAgY29uZGl0aW9uLmNwZi4kaUxpa2UucmVwbGFjZSgvJS9nLCAnJyksXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIGBjaWRhZGFvLmNwZiBJTElLRSAnJScgfHwgOiR7cGFyYW1LZXl9IHx8ICclJ2A7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjb25kaXRpb24ubmlzKSB7XG4gICAgICAgICAgICBxdWVyeUJ1aWxkZXIuc2V0UGFyYW1ldGVyKFxuICAgICAgICAgICAgICBwYXJhbUtleSxcbiAgICAgICAgICAgICAgY29uZGl0aW9uLm5pcy4kaUxpa2UucmVwbGFjZSgvJS9nLCAnJyksXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIGBjaWRhZGFvLm5pcyBJTElLRSAnJScgfHwgOiR7cGFyYW1LZXl9IHx8ICclJ2A7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiAnMT0wJztcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgICBxdWVyeUJ1aWxkZXIuYW5kV2hlcmUoYCgke3NlYXJjaENvbmRpdGlvbnMuam9pbignIE9SICcpfSlgKTtcbiAgICAgIGRlbGV0ZSB3aGVyZS4kb3I7XG4gICAgfVxuXG4gICAgLy8gQXBsaWNhciBmaWx0cm9zIGRlIGVuZGVyZcOnb1xuICAgIGlmICh3aGVyZVsnZW5kZXJlY28uYmFpcnJvJ10pIHtcbiAgICAgIHF1ZXJ5QnVpbGRlci5hbmRXaGVyZShcImNpZGFkYW8uZW5kZXJlY28tPj4nYmFpcnJvJyBJTElLRSA6YmFpcnJvXCIsIHtcbiAgICAgICAgYmFpcnJvOiBgJSR7d2hlcmVbJ2VuZGVyZWNvLmJhaXJybyddLiRpTGlrZS5yZXBsYWNlKC8lL2csICcnKX0lYCxcbiAgICAgIH0pO1xuICAgICAgZGVsZXRlIHdoZXJlWydlbmRlcmVjby5iYWlycm8nXTtcbiAgICB9XG5cbiAgICAvLyBBcGxpY2FyIG91dHJvcyBmaWx0cm9zXG4gICAgT2JqZWN0LmtleXMod2hlcmUpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgaWYgKHdoZXJlW2tleV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBxdWVyeUJ1aWxkZXIuYW5kV2hlcmUoYGNpZGFkYW8uJHtrZXl9ID0gOiR7a2V5fWAsIHtcbiAgICAgICAgICBba2V5XTogd2hlcmVba2V5XSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBJbmNsdWlyIHJlbGFjaW9uYW1lbnRvcyBhcGVuYXMgc2UgbmVjZXNzw6FyaW9cbiAgICBpZiAoaW5jbHVkZVJlbGF0aW9ucykge1xuICAgICAgcXVlcnlCdWlsZGVyXG4gICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdChcbiAgICAgICAgICAnY2lkYWRhby5wYXBlaXMnLFxuICAgICAgICAgICdwYXBlaXMnLFxuICAgICAgICAgICdwYXBlaXMuYXRpdm8gPSA6cGFwZWxBdGl2bycsXG4gICAgICAgICAgeyBwYXBlbEF0aXZvOiB0cnVlIH0sXG4gICAgICAgIClcbiAgICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KCdjaWRhZGFvLmNvbXBvc2ljYW9fZmFtaWxpYXInLCAnY29tcG9zaWNhb19mYW1pbGlhcicpXG4gICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdCgnY2lkYWRhby51bmlkYWRlJywgJ3VuaWRhZGUnKTtcbiAgICB9XG5cbiAgICAvLyBBcGxpY2FyIG9yZGVuYcOnw6NvXG4gICAgT2JqZWN0LmtleXMob3JkZXIpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgcXVlcnlCdWlsZGVyLmFkZE9yZGVyQnkoYGNpZGFkYW8uJHtrZXl9YCwgb3JkZXJba2V5XSk7XG4gICAgfSk7XG5cbiAgICAvLyBBcGxpY2FyIHBhZ2luYcOnw6NvXG4gICAgcXVlcnlCdWlsZGVyLnNraXAoc2tpcCkudGFrZSh0YWtlKTtcblxuICAgIC8vIEdlcmFyIGxvZyBkYSBxdWVyeSBlbSBkZXNlbnZvbHZpbWVudG8gcGFyYSBkZWJ1Z1xuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAgICAgY29uc3QgW3F1ZXJ5LCBwYXJhbWV0ZXJzXSA9IHF1ZXJ5QnVpbGRlci5nZXRRdWVyeUFuZFBhcmFtZXRlcnMoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdRdWVyeSBnZXJhZGE6JywgcXVlcnkpO1xuICAgICAgY29uc29sZS5sb2coJ1BhcsOibWV0cm9zOicsIHBhcmFtZXRlcnMpO1xuICAgIH1cblxuICAgIHJldHVybiBxdWVyeUJ1aWxkZXIuZ2V0TWFueUFuZENvdW50KCk7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2EgdW0gY2lkYWTDo28gcGVsbyBJRCBjb20gcmVsYWNpb25hbWVudG9zIG90aW1pemFkb3NcbiAgICogQHBhcmFtIGlkIElEIGRvIGNpZGFkw6NvXG4gICAqIEBwYXJhbSBpbmNsdWRlUmVsYXRpb25zIFNlIGRldmUgaW5jbHVpciByZWxhY2lvbmFtZW50b3MgKHBhcMOpaXMsIGNvbXBvc2nDp8OjbyBmYW1pbGlhcilcbiAgICogQHJldHVybnMgQ2lkYWTDo28gZW5jb250cmFkbyBvdSBudWxsXG4gICAqL1xuICBhc3luYyBmaW5kQnlJZChcbiAgICBpZDogc3RyaW5nLFxuICAgIGluY2x1ZGVSZWxhdGlvbnMgPSBmYWxzZSxcbiAgICBzcGVjaWZpY0ZpZWxkcz86IHN0cmluZ1tdLFxuICApOiBQcm9taXNlPENpZGFkYW8gfCBudWxsPiB7XG4gICAgY29uc3QgcXVlcnkgPSB0aGlzLnJlcG9zaXRvcnlcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoJ2NpZGFkYW8nKVxuICAgICAgLndoZXJlKCdjaWRhZGFvLmlkID0gOmlkJywgeyBpZCB9KTtcblxuICAgIC8vIFNlbGVjaW9uYXIgYXBlbmFzIGNhbXBvcyBlc3BlY8OtZmljb3Mgc2Ugc29saWNpdGFkb1xuICAgIGlmIChzcGVjaWZpY0ZpZWxkcyAmJiBzcGVjaWZpY0ZpZWxkcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBmaWVsZHMgPSBzcGVjaWZpY0ZpZWxkcy5tYXAoKGZpZWxkKSA9PiBgY2lkYWRhby4ke2ZpZWxkfWApO1xuICAgICAgcXVlcnkuc2VsZWN0KGZpZWxkcyk7XG4gICAgfVxuXG4gICAgaWYgKGluY2x1ZGVSZWxhdGlvbnMpIHtcbiAgICAgIHF1ZXJ5XG4gICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdChcbiAgICAgICAgICAnY2lkYWRhby5wYXBlaXMnLFxuICAgICAgICAgICdwYXBlaXMnLFxuICAgICAgICAgICdwYXBlaXMuYXRpdm8gPSA6cGFwZWxBdGl2bycsXG4gICAgICAgICAgeyBwYXBlbEF0aXZvOiB0cnVlIH0sXG4gICAgICAgIClcbiAgICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KCdjaWRhZGFvLmNvbXBvc2ljYW9fZmFtaWxpYXInLCAnY29tcG9zaWNhb19mYW1pbGlhcicpXG4gICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdCgnY2lkYWRhby51bmlkYWRlJywgJ3VuaWRhZGUnKTtcbiAgICB9XG5cbiAgICAvLyBMb2cgZW0gYW1iaWVudGUgZGUgZGVzZW52b2x2aW1lbnRvXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XG4gICAgICBjb25zdCBbcXVlcnlTdHIsIHBhcmFtZXRlcnNdID0gcXVlcnkuZ2V0UXVlcnlBbmRQYXJhbWV0ZXJzKCk7XG4gICAgICBjb25zb2xlLmxvZygnUXVlcnkgZmluZEJ5SWQ6JywgcXVlcnlTdHIpO1xuICAgICAgY29uc29sZS5sb2coJ1BhcsOibWV0cm9zOicsIHBhcmFtZXRlcnMpO1xuICAgIH1cblxuICAgIHJldHVybiBxdWVyeS5nZXRPbmUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdXNjYSB1bSBjaWRhZMOjbyBwZWxvIENQRlxuICAgKiBAcGFyYW0gY3BmIENQRiBkbyBjaWRhZMOjb1xuICAgKiBAcGFyYW0gaW5jbHVkZVJlbGF0aW9ucyBTZSBkZXZlIGluY2x1aXIgcmVsYWNpb25hbWVudG9zIChwYXDDqWlzLCBjb21wb3Npw6fDo28gZmFtaWxpYXIpXG4gICAqIEByZXR1cm5zIENpZGFkw6NvIGVuY29udHJhZG8gb3UgbnVsbFxuICAgKi9cbiAgYXN5bmMgZmluZEJ5Q3BmKFxuICAgIGNwZjogc3RyaW5nLFxuICAgIGluY2x1ZGVSZWxhdGlvbnMgPSBmYWxzZSxcbiAgICBzcGVjaWZpY0ZpZWxkcz86IHN0cmluZ1tdLFxuICApOiBQcm9taXNlPENpZGFkYW8gfCBudWxsPiB7XG4gICAgLy8gTm9ybWFsaXphIG8gQ1BGIHJlbW92ZW5kbyBjYXJhY3RlcmVzIG7Do28gbnVtw6lyaWNvc1xuICAgIGNvbnN0IGNwZk5vcm1hbGl6YWRvID0gY3BmLnJlcGxhY2UoL1xcRC9nLCAnJyk7XG5cbiAgICBjb25zdCBxdWVyeSA9IHRoaXMucmVwb3NpdG9yeVxuICAgICAgLmNyZWF0ZVF1ZXJ5QnVpbGRlcignY2lkYWRhbycpXG4gICAgICAud2hlcmUoJ2NpZGFkYW8uY3BmID0gOmNwZicsIHsgY3BmOiBjcGZOb3JtYWxpemFkbyB9KTtcblxuICAgIC8vIFNlbGVjaW9uYXIgYXBlbmFzIGNhbXBvcyBlc3BlY8OtZmljb3Mgc2Ugc29saWNpdGFkb1xuICAgIGlmIChzcGVjaWZpY0ZpZWxkcyAmJiBzcGVjaWZpY0ZpZWxkcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBmaWVsZHMgPSBzcGVjaWZpY0ZpZWxkcy5tYXAoKGZpZWxkKSA9PiBgY2lkYWRhby4ke2ZpZWxkfWApO1xuICAgICAgcXVlcnkuc2VsZWN0KGZpZWxkcyk7XG4gICAgfVxuXG4gICAgaWYgKGluY2x1ZGVSZWxhdGlvbnMpIHtcbiAgICAgIHF1ZXJ5XG4gICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdChcbiAgICAgICAgICAnY2lkYWRhby5wYXBlaXMnLFxuICAgICAgICAgICdwYXBlaXMnLFxuICAgICAgICAgICdwYXBlaXMuYXRpdm8gPSA6cGFwZWxBdGl2bycsXG4gICAgICAgICAgeyBwYXBlbEF0aXZvOiB0cnVlIH0sXG4gICAgICAgIClcbiAgICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KCdjaWRhZGFvLmNvbXBvc2ljYW9fZmFtaWxpYXInLCAnY29tcG9zaWNhb19mYW1pbGlhcicpXG4gICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdCgnY2lkYWRhby51bmlkYWRlJywgJ3VuaWRhZGUnKTtcbiAgICB9XG5cbiAgICAvLyBVc2FyIGNhY2hlIHBhcmEgQ1BGIChpZGVudGlmaWNhZG9yIMO6bmljbyBlIGZyZXF1ZW50ZW1lbnRlIGNvbnN1bHRhZG8pXG4gICAgcXVlcnkuY2FjaGUodHJ1ZSk7XG5cbiAgICByZXR1cm4gcXVlcnkuZ2V0T25lKCk7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2EgY2lkYWTDo28gcG9yIE5JU1xuICAgKiBAcGFyYW0gbmlzIE5JUyBkbyBjaWRhZMOjb1xuICAgKiBAcGFyYW0gaW5jbHVkZVJlbGF0aW9ucyBTZSBkZXZlIGluY2x1aXIgcmVsYWNpb25hbWVudG9zXG4gICAqIEByZXR1cm5zIENpZGFkw6NvIGVuY29udHJhZG8gb3UgbnVsbFxuICAgKi9cbiAgYXN5bmMgZmluZEJ5TmlzKFxuICAgIG5pczogc3RyaW5nLFxuICAgIGluY2x1ZGVSZWxhdGlvbnMgPSBmYWxzZSxcbiAgICBzcGVjaWZpY0ZpZWxkcz86IHN0cmluZ1tdLFxuICApOiBQcm9taXNlPENpZGFkYW8gfCBudWxsPiB7XG4gICAgLy8gTm9ybWFsaXphIG8gTklTIHJlbW92ZW5kbyBjYXJhY3RlcmVzIG7Do28gbnVtw6lyaWNvc1xuICAgIGNvbnN0IG5pc05vcm1hbGl6YWRvID0gbmlzLnJlcGxhY2UoL1xcRC9nLCAnJyk7XG5cbiAgICBjb25zdCBxdWVyeSA9IHRoaXMucmVwb3NpdG9yeVxuICAgICAgLmNyZWF0ZVF1ZXJ5QnVpbGRlcignY2lkYWRhbycpXG4gICAgICAud2hlcmUoJ2NpZGFkYW8ubmlzID0gOm5pcycsIHsgbmlzOiBuaXNOb3JtYWxpemFkbyB9KTtcblxuICAgIC8vIFNlbGVjaW9uYXIgYXBlbmFzIGNhbXBvcyBlc3BlY8OtZmljb3Mgc2Ugc29saWNpdGFkb1xuICAgIGlmIChzcGVjaWZpY0ZpZWxkcyAmJiBzcGVjaWZpY0ZpZWxkcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBmaWVsZHMgPSBzcGVjaWZpY0ZpZWxkcy5tYXAoKGZpZWxkKSA9PiBgY2lkYWRhby4ke2ZpZWxkfWApO1xuICAgICAgcXVlcnkuc2VsZWN0KGZpZWxkcyk7XG4gICAgfVxuXG4gICAgaWYgKGluY2x1ZGVSZWxhdGlvbnMpIHtcbiAgICAgIHF1ZXJ5XG4gICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdChcbiAgICAgICAgICAnY2lkYWRhby5wYXBlaXMnLFxuICAgICAgICAgICdwYXBlaXMnLFxuICAgICAgICAgICdwYXBlaXMuYXRpdm8gPSA6cGFwZWxBdGl2bycsXG4gICAgICAgICAgeyBwYXBlbEF0aXZvOiB0cnVlIH0sXG4gICAgICAgIClcbiAgICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KCdjaWRhZGFvLmNvbXBvc2ljYW9fZmFtaWxpYXInLCAnY29tcG9zaWNhb19mYW1pbGlhcicpXG4gICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdCgnY2lkYWRhby51bmlkYWRlJywgJ3VuaWRhZGUnKTtcbiAgICB9XG5cbiAgICAvLyBVc2FyIGNhY2hlIHBhcmEgTklTIChpZGVudGlmaWNhZG9yIMO6bmljbyBlIGZyZXF1ZW50ZW1lbnRlIGNvbnN1bHRhZG8pXG4gICAgcXVlcnkuY2FjaGUodHJ1ZSk7XG5cbiAgICByZXR1cm4gcXVlcnkuZ2V0T25lKCk7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2EgY2lkYWTDo28gcG9yIHRlbGVmb25lXG4gICAqIEBwYXJhbSB0ZWxlZm9uZSBUZWxlZm9uZSBkbyBjaWRhZMOjb1xuICAgKiBAcGFyYW0gaW5jbHVkZVJlbGF0aW9ucyBTZSBkZXZlIGluY2x1aXIgcmVsYWNpb25hbWVudG9zXG4gICAqIEByZXR1cm5zIENpZGFkw6NvIGVuY29udHJhZG8gb3UgbnVsbFxuICAgKi9cbiAgYXN5bmMgZmluZEJ5VGVsZWZvbmUoXG4gICAgdGVsZWZvbmU6IHN0cmluZyxcbiAgICBpbmNsdWRlUmVsYXRpb25zID0gZmFsc2UsXG4gICAgc3BlY2lmaWNGaWVsZHM/OiBzdHJpbmdbXSxcbiAgKTogUHJvbWlzZTxDaWRhZGFvIHwgbnVsbD4ge1xuICAgIC8vIE5vcm1hbGl6YSBvIHRlbGVmb25lIHJlbW92ZW5kbyBjYXJhY3RlcmVzIG7Do28gbnVtw6lyaWNvc1xuICAgIGNvbnN0IHRlbGVmb25lTm9ybWFsaXphZG8gPSB0ZWxlZm9uZS5yZXBsYWNlKC9cXEQvZywgJycpO1xuXG4gICAgY29uc3QgcXVlcnkgPSB0aGlzLnJlcG9zaXRvcnlcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoJ2NpZGFkYW8nKVxuICAgICAgLndoZXJlKCdjaWRhZGFvLnRlbGVmb25lID0gOnRlbGVmb25lJywgeyB0ZWxlZm9uZTogdGVsZWZvbmVOb3JtYWxpemFkbyB9KTtcblxuICAgIC8vIFNlbGVjaW9uYXIgYXBlbmFzIGNhbXBvcyBlc3BlY8OtZmljb3Mgc2Ugc29saWNpdGFkb1xuICAgIGlmIChzcGVjaWZpY0ZpZWxkcyAmJiBzcGVjaWZpY0ZpZWxkcy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBmaWVsZHMgPSBzcGVjaWZpY0ZpZWxkcy5tYXAoKGZpZWxkKSA9PiBgY2lkYWRhby4ke2ZpZWxkfWApO1xuICAgICAgcXVlcnkuc2VsZWN0KGZpZWxkcyk7XG4gICAgfVxuXG4gICAgaWYgKGluY2x1ZGVSZWxhdGlvbnMpIHtcbiAgICAgIHF1ZXJ5XG4gICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdChcbiAgICAgICAgICAnY2lkYWRhby5wYXBlaXMnLFxuICAgICAgICAgICdwYXBlaXMnLFxuICAgICAgICAgICdwYXBlaXMuYXRpdm8gPSA6cGFwZWxBdGl2bycsXG4gICAgICAgICAgeyBwYXBlbEF0aXZvOiB0cnVlIH0sXG4gICAgICAgIClcbiAgICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KCdjaWRhZGFvLmNvbXBvc2ljYW9fZmFtaWxpYXInLCAnY29tcG9zaWNhb19mYW1pbGlhcicpXG4gICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdCgnY2lkYWRhby51bmlkYWRlJywgJ3VuaWRhZGUnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcXVlcnkuZ2V0T25lKCk7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2EgY2lkYWTDo28gcG9yIG5vbWUgKGJ1c2NhIHBhcmNpYWwpXG4gICAqIEBwYXJhbSBub21lIE5vbWUgZG8gY2lkYWTDo29cbiAgICogQHBhcmFtIGluY2x1ZGVSZWxhdGlvbnMgU2UgZGV2ZSBpbmNsdWlyIHJlbGFjaW9uYW1lbnRvc1xuICAgKiBAcmV0dXJucyBMaXN0YSBkZSBjaWRhZMOjb3MgZW5jb250cmFkb3NcbiAgICovXG4gIGFzeW5jIGZpbmRCeU5vbWUoXG4gICAgbm9tZTogc3RyaW5nLFxuICAgIGluY2x1ZGVSZWxhdGlvbnMgPSBmYWxzZSxcbiAgICBzcGVjaWZpY0ZpZWxkcz86IHN0cmluZ1tdLFxuICApOiBQcm9taXNlPENpZGFkYW9bXT4ge1xuICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5yZXBvc2l0b3J5XG4gICAgICAuY3JlYXRlUXVlcnlCdWlsZGVyKCdjaWRhZGFvJylcbiAgICAgIC53aGVyZSgnTE9XRVIoY2lkYWRhby5ub21lKSBJTElLRSBMT1dFUig6bm9tZSknLCB7IG5vbWU6IGAlJHtub21lfSVgIH0pXG4gICAgICAub3JkZXJCeSgnY2lkYWRhby5ub21lJywgJ0FTQycpXG4gICAgICAubGltaXQoNTApOyAvLyBMaW1pdGFyIHJlc3VsdGFkb3MgcGFyYSBwZXJmb3JtYW5jZVxuXG4gICAgLy8gU2VsZWNpb25hciBhcGVuYXMgY2FtcG9zIGVzcGVjw61maWNvcyBzZSBzb2xpY2l0YWRvXG4gICAgaWYgKHNwZWNpZmljRmllbGRzICYmIHNwZWNpZmljRmllbGRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGZpZWxkcyA9IHNwZWNpZmljRmllbGRzLm1hcCgoZmllbGQpID0+IGBjaWRhZGFvLiR7ZmllbGR9YCk7XG4gICAgICBxdWVyeS5zZWxlY3QoZmllbGRzKTtcbiAgICB9XG5cbiAgICBpZiAoaW5jbHVkZVJlbGF0aW9ucykge1xuICAgICAgcXVlcnlcbiAgICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KFxuICAgICAgICAgICdjaWRhZGFvLnBhcGVpcycsXG4gICAgICAgICAgJ3BhcGVpcycsXG4gICAgICAgICAgJ3BhcGVpcy5hdGl2byA9IDpwYXBlbEF0aXZvJyxcbiAgICAgICAgICB7IHBhcGVsQXRpdm86IHRydWUgfSxcbiAgICAgICAgKVxuICAgICAgICAubGVmdEpvaW5BbmRTZWxlY3QoJ2NpZGFkYW8uY29tcG9zaWNhb19mYW1pbGlhcicsICdjb21wb3NpY2FvX2ZhbWlsaWFyJylcbiAgICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KCdjaWRhZGFvLnVuaWRhZGUnLCAndW5pZGFkZScpO1xuICAgIH1cblxuICAgIC8vIExvZyBlbSBkZXNlbnZvbHZpbWVudG9cbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcpIHtcbiAgICAgIGNvbnN0IFtxdWVyeVN0ciwgcGFyYW1ldGVyc10gPSBxdWVyeS5nZXRRdWVyeUFuZFBhcmFtZXRlcnMoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdRdWVyeSBmaW5kQnlOb21lOicsIHF1ZXJ5U3RyKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcXVlcnkuZ2V0TWFueSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhIGNpZGFkw6NvcyBjb20gcGFnaW5hw6fDo28gdmlhIGN1cnNvciBwYXJhIG1lbGhvciBwZXJmb3JtYW5jZSBjb20gZ3JhbmRlcyB2b2x1bWVzIGRlIGRhZG9zXG4gICAqXG4gICAqIEBwYXJhbSBvcHRpb25zIE9ww6fDtWVzIGRlIHBhZ2luYcOnw6NvIGUgZmlsdHJvXG4gICAqIEByZXR1cm5zIExpc3RhIGRlIGNpZGFkw6NvcyBlIGluZm9ybWHDp8O1ZXMgZGUgcGFnaW5hw6fDo28gdmlhIGN1cnNvclxuICAgKi9cbiAgYXN5bmMgZmluZEJ5Q3Vyc29yKG9wdGlvbnM6IHtcbiAgICBjdXJzb3I/OiBzdHJpbmc7XG4gICAgbGltaXQ/OiBudW1iZXI7XG4gICAgb3JkZXJCeT86IHN0cmluZztcbiAgICBvcmRlckRpcmVjdGlvbj86ICdBU0MnIHwgJ0RFU0MnO1xuICAgIHdoZXJlPzogYW55O1xuICAgIGluY2x1ZGVSZWxhdGlvbnM/OiBib29sZWFuO1xuICAgIHNwZWNpZmljRmllbGRzPzogc3RyaW5nW107XG4gIH0pOiBQcm9taXNlPHtcbiAgICBpdGVtczogQ2lkYWRhb1tdO1xuICAgIGNvdW50OiBudW1iZXI7XG4gICAgbmV4dEN1cnNvcj86IHN0cmluZztcbiAgICBoYXNOZXh0UGFnZTogYm9vbGVhbjtcbiAgfT4ge1xuICAgIGNvbnN0IHtcbiAgICAgIGN1cnNvcixcbiAgICAgIGxpbWl0ID0gMTAsXG4gICAgICBvcmRlckJ5ID0gJ2NyZWF0ZWRfYXQnLFxuICAgICAgb3JkZXJEaXJlY3Rpb24gPSAnREVTQycsXG4gICAgICB3aGVyZSA9IHt9LFxuICAgICAgaW5jbHVkZVJlbGF0aW9ucyA9IGZhbHNlLFxuICAgICAgc3BlY2lmaWNGaWVsZHMgPSBbXSxcbiAgICB9ID0gb3B0aW9ucztcblxuICAgIC8vIFZhbGlkYXIgbGltaXRlIG3DoXhpbW8gcGFyYSBldml0YXIgc29icmVjYXJnYSBkbyBiYW5jb1xuICAgIGNvbnN0IHZhbGlkTGltaXQgPSBNYXRoLm1pbihsaW1pdCwgMTAwKTtcblxuICAgIGNvbnN0IHF1ZXJ5QnVpbGRlciA9IHRoaXMucmVwb3NpdG9yeS5jcmVhdGVRdWVyeUJ1aWxkZXIoJ2NpZGFkYW8nKTtcblxuICAgIC8vIFNlbGVjaW9uYXIgYXBlbmFzIGNhbXBvcyBlc3BlY8OtZmljb3Mgc2UgZGVmaW5pZG9zXG4gICAgaWYgKHNwZWNpZmljRmllbGRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGZpZWxkcyA9IHNwZWNpZmljRmllbGRzLm1hcCgoZmllbGQpID0+IGBjaWRhZGFvLiR7ZmllbGR9YCk7XG4gICAgICBxdWVyeUJ1aWxkZXIuc2VsZWN0KGZpZWxkcyk7XG4gICAgfVxuXG4gICAgLy8gQXBsaWNhciBmaWx0cm9zXG4gICAgT2JqZWN0LmtleXMod2hlcmUpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgaWYgKHdoZXJlW2tleV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoa2V5ID09PSAnbm9tZScgJiYgdHlwZW9mIHdoZXJlW2tleV0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgcXVlcnlCdWlsZGVyLmFuZFdoZXJlKGBMT1dFUihjaWRhZGFvLiR7a2V5fSkgSUxJS0UgTE9XRVIoOiR7a2V5fSlgLCB7XG4gICAgICAgICAgICBba2V5XTogYCUke3doZXJlW2tleV19JWAsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAga2V5ID09PSAnZW5kZXJlY28uYmFpcnJvJyAmJlxuICAgICAgICAgIHR5cGVvZiB3aGVyZVtrZXldID09PSAnc3RyaW5nJ1xuICAgICAgICApIHtcbiAgICAgICAgICBxdWVyeUJ1aWxkZXIuYW5kV2hlcmUoXCJjaWRhZGFvLmVuZGVyZWNvLT4+J2JhaXJybycgSUxJS0UgOmJhaXJyb1wiLCB7XG4gICAgICAgICAgICBiYWlycm86IGAlJHt3aGVyZVtrZXldfSVgLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgIGtleSA9PT0gJ2VuZGVyZWNvLmNpZGFkZScgJiZcbiAgICAgICAgICB0eXBlb2Ygd2hlcmVba2V5XSA9PT0gJ3N0cmluZydcbiAgICAgICAgKSB7XG4gICAgICAgICAgcXVlcnlCdWlsZGVyLmFuZFdoZXJlKFwiY2lkYWRhby5lbmRlcmVjby0+PidjaWRhZGUnIElMSUtFIDpjaWRhZGVcIiwge1xuICAgICAgICAgICAgY2lkYWRlOiBgJSR7d2hlcmVba2V5XX0lYCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBxdWVyeUJ1aWxkZXIuYW5kV2hlcmUoYGNpZGFkYW8uJHtrZXl9ID0gOiR7a2V5fWAsIHtcbiAgICAgICAgICAgIFtrZXldOiB3aGVyZVtrZXldLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBBcGxpY2FyIGZpbHRybyBkZSBjdXJzb3IgcGFyYSBwYWdpbmHDp8Ojb1xuICAgIGlmIChjdXJzb3IpIHtcbiAgICAgIC8vIFBhcmEgb3JkZW5hbWVudG8gREVTQywgcHJlY2lzYW1vcyBvYnRlciByZWdpc3Ryb3MgPCBjdXJzb3JcbiAgICAgIC8vIFBhcmEgb3JkZW5hbWVudG8gQVNDLCBwcmVjaXNhbW9zIG9idGVyIHJlZ2lzdHJvcyA+IGN1cnNvclxuICAgICAgY29uc3Qgb3BlcmF0b3IgPSBvcmRlckRpcmVjdGlvbiA9PT0gJ0RFU0MnID8gJzwnIDogJz4nO1xuXG4gICAgICAvLyBQYXJhIHRpbWVzdGFtcHNcbiAgICAgIGlmIChvcmRlckJ5ID09PSAnY3JlYXRlZF9hdCcgfHwgb3JkZXJCeSA9PT0gJ3VwZGF0ZWRfYXQnKSB7XG4gICAgICAgIHF1ZXJ5QnVpbGRlci5hbmRXaGVyZShcbiAgICAgICAgICBgY2lkYWRhby4ke29yZGVyQnl9ICR7b3BlcmF0b3J9IChTRUxFQ1QgJHtvcmRlckJ5fSBGUk9NIGNpZGFkYW8gV0hFUkUgaWQgPSA6Y3Vyc29ySWQpYCxcbiAgICAgICAgICB7IGN1cnNvcklkOiBjdXJzb3IgfSxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIC8vIFBhcmEgY2FtcG9zIHN0cmluZyBvdSBudW3DqXJpY29zXG4gICAgICBlbHNlIHtcbiAgICAgICAgcXVlcnlCdWlsZGVyLmFuZFdoZXJlKFxuICAgICAgICAgIGBjaWRhZGFvLiR7b3JkZXJCeX0gJHtvcGVyYXRvcn0gKFNFTEVDVCAke29yZGVyQnl9IEZST00gY2lkYWRhbyBXSEVSRSBpZCA9IDpjdXJzb3JJZClgLFxuICAgICAgICAgIHsgY3Vyc29ySWQ6IGN1cnNvciB9LFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEluY2x1aXIgcmVsYWNpb25hbWVudG9zIGNvbmZvcm1lIHNvbGljaXRhZG9cbiAgICBpZiAoaW5jbHVkZVJlbGF0aW9ucykge1xuICAgICAgcXVlcnlCdWlsZGVyXG4gICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdChcbiAgICAgICAgICAnY2lkYWRhby5wYXBlaXMnLFxuICAgICAgICAgICdwYXBlaXMnLFxuICAgICAgICAgICdwYXBlaXMuYXRpdm8gPSA6cGFwZWxBdGl2bycsXG4gICAgICAgICAgeyBwYXBlbEF0aXZvOiB0cnVlIH0sXG4gICAgICAgIClcbiAgICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KCdjaWRhZGFvLmNvbXBvc2ljYW9fZmFtaWxpYXInLCAnY29tcG9zaWNhb19mYW1pbGlhcicpXG4gICAgICAgIC5sZWZ0Sm9pbkFuZFNlbGVjdCgnY2lkYWRhby51bmlkYWRlJywgJ3VuaWRhZGUnKTtcbiAgICB9XG5cbiAgICAvLyBPcmRlbmFyIHJlc3VsdGFkb3NcbiAgICBxdWVyeUJ1aWxkZXIub3JkZXJCeShgY2lkYWRhby4ke29yZGVyQnl9YCwgb3JkZXJEaXJlY3Rpb24pO1xuXG4gICAgLy8gQWRpY2lvbmFyIG9yZGVuYcOnw6NvIHNlY3VuZMOhcmlhIHBlbG8gSUQgcGFyYSBnYXJhbnRpciBkZXRlcm1pbmlzbW8gcXVhbmRvIGjDoSB2YWxvcmVzIGlndWFpc1xuICAgIHF1ZXJ5QnVpbGRlci5hZGRPcmRlckJ5KCdjaWRhZGFvLmlkJywgb3JkZXJEaXJlY3Rpb24pO1xuXG4gICAgLy8gQXBsaWNhciBsaW1pdGVcbiAgICBxdWVyeUJ1aWxkZXIudGFrZSh2YWxpZExpbWl0ICsgMSk7IC8vICsxIHBhcmEgdmVyaWZpY2FyIHNlIGjDoSBtYWlzIHDDoWdpbmFzXG5cbiAgICAvLyBFeGVjdXRhciBxdWVyeVxuICAgIGNvbnN0IGl0ZW1zID0gYXdhaXQgcXVlcnlCdWlsZGVyLmdldE1hbnkoKTtcblxuICAgIC8vIFZlcmlmaWNhciBzZSBow6EgbWFpcyBww6FnaW5hc1xuICAgIGNvbnN0IGhhc05leHRQYWdlID0gaXRlbXMubGVuZ3RoID4gdmFsaWRMaW1pdDtcbiAgICBpZiAoaGFzTmV4dFBhZ2UpIHtcbiAgICAgIGl0ZW1zLnBvcCgpOyAvLyBSZW1vdmVyIG8gaXRlbSBleHRyYSBxdWUgZm9pIHVzYWRvIHBhcmEgdmVyaWZpY2FyIHNlIGjDoSBtYWlzIHDDoWdpbmFzXG4gICAgfVxuXG4gICAgLy8gRGVmaW5pciBjdXJzb3IgcGFyYSBhIHByw7N4aW1hIHDDoWdpbmFcbiAgICBjb25zdCBuZXh0Q3Vyc29yID0gaGFzTmV4dFBhZ2UgPyBpdGVtc1tpdGVtcy5sZW5ndGggLSAxXT8uaWQgOiB1bmRlZmluZWQ7XG5cbiAgICAvLyBPYnRlciBjb250YWdlbSBhcHJveGltYWRhIHBhcmEgbWV0YWRhZG9zXG4gICAgY29uc3QgY291bnRRdWVyeSA9IHRoaXMucmVwb3NpdG9yeS5jcmVhdGVRdWVyeUJ1aWxkZXIoJ2NpZGFkYW8nKTtcbiAgICAvLyBBcGxpY2FyIG9zIG1lc21vcyBmaWx0cm9zIHF1ZSBhIHF1ZXJ5IHByaW5jaXBhbFxuICAgIE9iamVjdC5rZXlzKHdoZXJlKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgIGlmICh3aGVyZVtrZXldICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKGtleSA9PT0gJ25vbWUnICYmIHR5cGVvZiB3aGVyZVtrZXldID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIGNvdW50UXVlcnkuYW5kV2hlcmUoYExPV0VSKGNpZGFkYW8uJHtrZXl9KSBJTElLRSBMT1dFUig6JHtrZXl9KWAsIHtcbiAgICAgICAgICAgIFtrZXldOiBgJSR7d2hlcmVba2V5XX0lYCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICBrZXkgPT09ICdlbmRlcmVjby5iYWlycm8nICYmXG4gICAgICAgICAgdHlwZW9mIHdoZXJlW2tleV0gPT09ICdzdHJpbmcnXG4gICAgICAgICkge1xuICAgICAgICAgIGNvdW50UXVlcnkuYW5kV2hlcmUoXCJjaWRhZGFvLmVuZGVyZWNvLT4+J2JhaXJybycgSUxJS0UgOmJhaXJyb1wiLCB7XG4gICAgICAgICAgICBiYWlycm86IGAlJHt3aGVyZVtrZXldfSVgLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgIGtleSA9PT0gJ2VuZGVyZWNvLmNpZGFkZScgJiZcbiAgICAgICAgICB0eXBlb2Ygd2hlcmVba2V5XSA9PT0gJ3N0cmluZydcbiAgICAgICAgKSB7XG4gICAgICAgICAgY291bnRRdWVyeS5hbmRXaGVyZShcImNpZGFkYW8uZW5kZXJlY28tPj4nY2lkYWRlJyBJTElLRSA6Y2lkYWRlXCIsIHtcbiAgICAgICAgICAgIGNpZGFkZTogYCUke3doZXJlW2tleV19JWAsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY291bnRRdWVyeS5hbmRXaGVyZShgY2lkYWRhby4ke2tleX0gPSA6JHtrZXl9YCwge1xuICAgICAgICAgICAgW2tleV06IHdoZXJlW2tleV0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFVzYXIgZXN0aW1hdGUgcXVhbmRvIHBvc3PDrXZlbCBwYXJhIG1haW9yIHBlcmZvcm1hbmNlXG4gICAgY29uc3QgY291bnQgPSBhd2FpdCBjb3VudFF1ZXJ5LmdldENvdW50KCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXRlbXMsXG4gICAgICBjb3VudDogaXRlbXMubGVuZ3RoLFxuICAgICAgbmV4dEN1cnNvcixcbiAgICAgIGhhc05leHRQYWdlLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JpYSB1bSBub3ZvIGNpZGFkw6NvXG4gICAqIEBwYXJhbSBkYXRhIERhZG9zIGRvIGNpZGFkw6NvXG4gICAqIEByZXR1cm5zIENpZGFkw6NvIGNyaWFkb1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlKGRhdGE6IFBhcnRpYWw8Q2lkYWRhbz4pOiBQcm9taXNlPENpZGFkYW8+IHtcbiAgICAvLyBOb3JtYWxpemEgbyBDUEYgcmVtb3ZlbmRvIGNhcmFjdGVyZXMgbsOjbyBudW3DqXJpY29zXG4gICAgaWYgKGRhdGEuY3BmKSB7XG4gICAgICBkYXRhLmNwZiA9IGRhdGEuY3BmLnJlcGxhY2UoL1xcRC9nLCAnJyk7XG4gICAgfVxuXG4gICAgLy8gTm9ybWFsaXphIG8gTklTIHJlbW92ZW5kbyBjYXJhY3RlcmVzIG7Do28gbnVtw6lyaWNvc1xuICAgIGlmIChkYXRhLm5pcykge1xuICAgICAgZGF0YS5uaXMgPSBkYXRhLm5pcy5yZXBsYWNlKC9cXEQvZywgJycpO1xuICAgIH1cblxuICAgIC8vIE5vcm1hbGl6YSBvIGVudW0gc2V4byBwYXJhIG1pbsO6c2N1bG9cbiAgICBpZiAoZGF0YS5zZXhvKSB7XG4gICAgICBkYXRhLnNleG8gPSBkYXRhLnNleG8udG9Mb3dlckNhc2UoKSBhcyBhbnk7XG4gICAgfVxuXG4gICAgY29uc3QgY2lkYWRhbyA9IHRoaXMucmVwb3NpdG9yeS5jcmVhdGUoZGF0YSk7XG4gICAgcmV0dXJuIHRoaXMucmVwb3NpdG9yeS5zYXZlKGNpZGFkYW8pO1xuICB9XG5cbiAgLyoqXG4gICAqIEF0dWFsaXphIHVtIGNpZGFkw6NvIGV4aXN0ZW50ZVxuICAgKiBAcGFyYW0gaWQgSUQgZG8gY2lkYWTDo29cbiAgICogQHBhcmFtIGRhdGEgRGFkb3MgYSBzZXJlbSBhdHVhbGl6YWRvc1xuICAgKiBAcmV0dXJucyBDaWRhZMOjbyBhdHVhbGl6YWRvXG4gICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gc2UgbyBjaWRhZMOjbyBuw6NvIGZvciBlbmNvbnRyYWRvXG4gICAqL1xuICBhc3luYyB1cGRhdGUoaWQ6IHN0cmluZywgZGF0YTogUGFydGlhbDxDaWRhZGFvPik6IFByb21pc2U8Q2lkYWRhbz4ge1xuICAgIC8vIE5vcm1hbGl6YSBvIENQRiByZW1vdmVuZG8gY2FyYWN0ZXJlcyBuw6NvIG51bcOpcmljb3NcbiAgICBpZiAoZGF0YS5jcGYpIHtcbiAgICAgIGRhdGEuY3BmID0gZGF0YS5jcGYucmVwbGFjZSgvXFxEL2csICcnKTtcbiAgICB9XG5cbiAgICAvLyBOb3JtYWxpemEgbyBOSVMgcmVtb3ZlbmRvIGNhcmFjdGVyZXMgbsOjbyBudW3DqXJpY29zXG4gICAgaWYgKGRhdGEubmlzKSB7XG4gICAgICBkYXRhLm5pcyA9IGRhdGEubmlzLnJlcGxhY2UoL1xcRC9nLCAnJyk7XG4gICAgfVxuXG4gICAgLy8gTm9ybWFsaXphIG8gZW51bSBzZXhvIHBhcmEgbWluw7pzY3Vsb1xuICAgIGlmIChkYXRhLnNleG8pIHtcbiAgICAgIGRhdGEuc2V4byA9IGRhdGEuc2V4by50b0xvd2VyQ2FzZSgpIGFzIGFueTtcbiAgICB9XG5cbiAgICBjb25zdCB1cGRhdGVSZXN1bHQgPSBhd2FpdCB0aGlzLnJlcG9zaXRvcnkudXBkYXRlKGlkLCBkYXRhKTtcblxuICAgIGlmICh1cGRhdGVSZXN1bHQuYWZmZWN0ZWQgPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignQ2lkYWTDo28gbsOjbyBlbmNvbnRyYWRvJyk7XG4gICAgfVxuXG4gICAgY29uc3QgY2lkYWRhbyA9IGF3YWl0IHRoaXMuZmluZEJ5SWQoaWQsIHRydWUpO1xuICAgIGlmICghY2lkYWRhbykge1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdDaWRhZMOjbyBuw6NvIGVuY29udHJhZG8gYXDDs3MgYXR1YWxpemHDp8OjbycpO1xuICAgIH1cbiAgICByZXR1cm4gY2lkYWRhbztcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGljaW9uYSBtZW1icm8gw6AgY29tcG9zacOnw6NvIGZhbWlsaWFyXG4gICAqIEBwYXJhbSBpZCBJRCBkbyBjaWRhZMOjb1xuICAgKiBAcGFyYW0gbWVtYnJvIERhZG9zIGRvIG1lbWJybyBmYW1pbGlhclxuICAgKiBAcmV0dXJucyBDaWRhZMOjbyBhdHVhbGl6YWRvXG4gICAqL1xuICBhc3luYyBhZGRDb21wb3NpY2FvRmFtaWxpYXIoaWQ6IHN0cmluZywgbWVtYnJvOiBhbnkpOiBQcm9taXNlPENpZGFkYW8+IHtcbiAgICBjb25zdCBjaWRhZGFvID0gYXdhaXQgdGhpcy5maW5kQnlJZChpZCwgZmFsc2UpOyAvLyBOw6NvIHByZWNpc2EgZGUgcmVsYWNpb25hbWVudG9zIHBhcmEgdmFsaWRhw6fDo29cblxuICAgIGlmICghY2lkYWRhbykge1xuICAgICAgdGhyb3cgbmV3IEVudGl0eU5vdEZvdW5kRXhjZXB0aW9uKCdDaWRhZMOjbycsIGlkKTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZmljYXIgc2UgasOhIGV4aXN0ZSBtZW1icm8gY29tIG8gbWVzbW8gbm9tZSBuYSBjb21wb3Npw6fDo28gZmFtaWxpYXJcbiAgICBjb25zdCBjb21wb3NpY2FvRmFtaWxpYXJSZXBvc2l0b3J5ID1cbiAgICAgIHRoaXMuZGF0YVNvdXJjZS5nZXRSZXBvc2l0b3J5KENvbXBvc2ljYW9GYW1pbGlhcik7XG4gICAgY29uc3QgbWVtYnJvRXhpc3RlbnRlID0gYXdhaXQgY29tcG9zaWNhb0ZhbWlsaWFyUmVwb3NpdG9yeS5maW5kT25lKHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGNpZGFkYW9faWQ6IGlkLFxuICAgICAgICBub21lOiBtZW1icm8ubm9tZSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAobWVtYnJvRXhpc3RlbnRlKSB7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbihcbiAgICAgICAgYErDoSBleGlzdGUgdW0gbWVtYnJvIGNvbSBvIG5vbWUgJyR7bWVtYnJvLm5vbWV9JyBuYSBjb21wb3Npw6fDo28gZmFtaWxpYXIgZGVzdGUgY2lkYWTDo29gLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZmljYXIgc2UgasOhIGV4aXN0ZSBtZW1icm8gY29tIG8gbWVzbW8gQ1BGIG5hIGNvbXBvc2nDp8OjbyBmYW1pbGlhclxuICAgIGNvbnN0IGNwZkZvcm1hdGFkbyA9IG1lbWJyby5jcGY/LnJlcGxhY2UoL1xcRC9nLCAnJyk7XG4gICAgaWYgKGNwZkZvcm1hdGFkbykge1xuICAgICAgY29uc3QgbWVtYnJvQ29tTWVzbW9DcGYgPSBhd2FpdCBjb21wb3NpY2FvRmFtaWxpYXJSZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGNpZGFkYW9faWQ6IGlkLFxuICAgICAgICAgIGNwZjogY3BmRm9ybWF0YWRvLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChtZW1icm9Db21NZXNtb0NwZikge1xuICAgICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbihcbiAgICAgICAgICBgSsOhIGV4aXN0ZSB1bSBtZW1icm8gY29tIG8gQ1BGICcke2NwZkZvcm1hdGFkb30nIG5hIGNvbXBvc2nDp8OjbyBmYW1pbGlhciBkZXN0ZSBjaWRhZMOjb2AsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ3JpYXIgbm92YSBlbnRyYWRhIG5hIHRhYmVsYSBjb21wb3NpY2FvX2ZhbWlsaWFyXG4gICAgLy8gTyBjaWRhZGFvX2lkIHZlbSBkbyBwYXLDom1ldHJvIGRhIHJvdGEsIG7Do28gZG8gYm9keVxuICAgIGNvbnN0IG5vdm9NZW1icm8gPSBjb21wb3NpY2FvRmFtaWxpYXJSZXBvc2l0b3J5LmNyZWF0ZSh7XG4gICAgICBjaWRhZGFvX2lkOiBpZCxcbiAgICAgIG5vbWU6IG1lbWJyby5ub21lLFxuICAgICAgY3BmOiBjcGZGb3JtYXRhZG8sXG4gICAgICBuaXM6IG1lbWJyby5uaXM/LnJlcGxhY2UoL1xcRC9nLCAnJyksXG4gICAgICBpZGFkZTogbWVtYnJvLmlkYWRlLFxuICAgICAgb2N1cGFjYW86IG1lbWJyby5vY3VwYWNhbyxcbiAgICAgIGVzY29sYXJpZGFkZTogbWVtYnJvLmVzY29sYXJpZGFkZSxcbiAgICAgIHBhcmVudGVzY286IG1lbWJyby5wYXJlbnRlc2NvLFxuICAgICAgcmVuZGE6IG1lbWJyby5yZW5kYSB8fCAwLFxuICAgICAgb2JzZXJ2YWNvZXM6IG1lbWJyby5vYnNlcnZhY29lcyxcbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBjb21wb3NpY2FvRmFtaWxpYXJSZXBvc2l0b3J5LnNhdmUobm92b01lbWJybyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIENhcHR1cmFyIGVycm8gZXNwZWPDrWZpY28gZGEgdHJpZ2dlciBkZSBleGNsdXNpdmlkYWRlIGRlIHBhcGVsXG4gICAgICBpZiAoXG4gICAgICAgIGVycm9yLm1lc3NhZ2UgJiZcbiAgICAgICAgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcbiAgICAgICAgICAnQ2lkYWTDo28gbsOjbyBwb2RlIHNlciBhZGljaW9uYWRvIMOgIGNvbXBvc2nDp8OjbyBmYW1pbGlhciwgcG9pcyBqw6Egw6kgYmVuZWZpY2nDoXJpbycsXG4gICAgICAgIClcbiAgICAgICkge1xuICAgICAgICB0aHJvdyBuZXcgQ29uZmxpY3RFeGNlcHRpb24oXG4gICAgICAgICAgJ0NpZGFkw6NvIG7Do28gcG9kZSBzZXIgYWRpY2lvbmFkbyDDoCBjb21wb3Npw6fDo28gZmFtaWxpYXIgcG9pcyBqw6EgcG9zc3VpIHBhcGVsIGRlIGJlbmVmaWNpw6FyaW8uJyxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2FwdHVyYXIgZXJyb3MgZGUgdmlvbGHDp8OjbyBkZSByZXN0cmnDp8OjbyBkZSB1bmljaWRhZGVcbiAgICAgIGlmIChlcnJvci5jb2RlID09PSAnMjM1MDUnKSB7XG4gICAgICAgIC8vIEPDs2RpZ28gUG9zdGdyZVNRTCBwYXJhIHZpb2xhw6fDo28gZGUgcmVzdHJpw6fDo28gw7puaWNhXG4gICAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKFxuICAgICAgICAgIGBOw6NvIGZvaSBwb3Nzw612ZWwgYWRpY2lvbmFyIG8gbWVtYnJvIMOgIGNvbXBvc2nDp8OjbyBmYW1pbGlhci4gSsOhIGV4aXN0ZSB1bSBtZW1icm8gY29tIG8gbWVzbW8gbm9tZSBvdSBDUEYuYCxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2FwdHVyYXIgZXJyb3MgZGUgdmlvbGHDp8OjbyBkZSBjaGF2ZSBlc3RyYW5nZWlyYVxuICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICcyMzUwMycpIHtcbiAgICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oXG4gICAgICAgICAgJ0RhZG9zIGludsOhbGlkb3MgZm9ybmVjaWRvcyBwYXJhIG8gbWVtYnJvIGRhIGNvbXBvc2nDp8OjbyBmYW1pbGlhci4nLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG5cbiAgICAvLyBSZXRvcm5hciBjaWRhZMOjbyBhdHVhbGl6YWRvIGNvbSByZWxhY2lvbmFtZW50b3NcbiAgICBjb25zdCBjaWRhZGFvQXR1YWxpemFkbyA9IGF3YWl0IHRoaXMuZmluZEJ5SWQoaWQsIHRydWUpO1xuICAgIGlmICghY2lkYWRhb0F0dWFsaXphZG8pIHtcbiAgICAgIHRocm93IG5ldyBFbnRpdHlOb3RGb3VuZEV4Y2VwdGlvbignQ2lkYWTDo28nLCBpZCk7XG4gICAgfVxuICAgIHJldHVybiBjaWRhZGFvQXR1YWxpemFkbztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgdW0gY2lkYWTDo28gKHNvZnQgZGVsZXRlKVxuICAgKiBAcGFyYW0gaWQgSUQgZG8gY2lkYWTDo29cbiAgICogQHJldHVybnMgUmVzdWx0YWRvIGRhIG9wZXJhw6fDo29cbiAgICovXG4gIGFzeW5jIHJlbW92ZShpZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5yZXBvc2l0b3J5LnNvZnREZWxldGUoaWQpO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=