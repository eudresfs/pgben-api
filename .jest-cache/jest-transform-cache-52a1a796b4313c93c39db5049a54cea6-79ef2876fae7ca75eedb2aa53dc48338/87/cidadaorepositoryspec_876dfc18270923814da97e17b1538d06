cbcc9d7e9160a84b315d04129c915004
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const typeorm_1 = require("typeorm");
const common_1 = require("@nestjs/common");
const cidadao_repository_1 = require("@modules/cidadao/repositories/cidadao.repository");
const cidadao_entity_1 = require("@modules/cidadao/entities/cidadao.entity");
describe('CidadaoRepository', () => {
    let repository;
    let dataSource;
    let typeormRepository;
    const mockTypeormRepository = {
        find: jest.fn(),
        findOne: jest.fn(),
        create: jest.fn(),
        save: jest.fn(),
        update: jest.fn(),
        softDelete: jest.fn(),
        findAndCount: jest.fn(),
    };
    const mockDataSource = {
        getRepository: jest.fn().mockReturnValue(mockTypeormRepository),
    };
    const mockCidadao = {
        id: '550e8400-e29b-41d4-a716-446655440000',
        nome: 'João da Silva',
        nome_social: 'João',
        cpf: '12345678901',
        rg: '123456789',
        nis: '12345678901',
        nome_mae: 'Maria da Silva',
        naturalidade: 'São Paulo',
        prontuario_suas: 'SUAS123456',
        data_nascimento: new Date('1990-01-01'),
        sexo: cidadao_entity_1.Sexo.MASCULINO,
        telefone: '11999999999',
        email: 'joao@example.com',
        endereco: {
            logradouro: 'Rua das Flores',
            numero: '123',
            bairro: 'Centro',
            cidade: 'São Paulo',
            estado: 'SP',
            cep: '01234567',
        },
        papeis: [],
        composicao_familiar: [],
        ativo: true,
        created_at: new Date(),
        updated_at: new Date(),
        removed_at: null,
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                cidadao_repository_1.CidadaoRepository,
                {
                    provide: typeorm_1.DataSource,
                    useValue: mockDataSource,
                },
            ],
        }).compile();
        repository = module.get(cidadao_repository_1.CidadaoRepository);
        dataSource = module.get(typeorm_1.DataSource);
        typeormRepository = mockTypeormRepository;
        jest.clearAllMocks();
    });
    it('deve estar definido', () => {
        expect(repository).toBeDefined();
    });
    describe('findById', () => {
        it('deve buscar cidadão por ID com relacionamentos por padrão', async () => {
            mockTypeormRepository.findOne.mockResolvedValue(mockCidadao);
            const result = await repository.findById('550e8400-e29b-41d4-a716-446655440000');
            expect(mockTypeormRepository.findOne).toHaveBeenCalledWith({
                where: { id: '550e8400-e29b-41d4-a716-446655440000' },
                relations: ['papeis', 'composicao_familiar'],
            });
            expect(result).toEqual(mockCidadao);
        });
        it('deve buscar cidadão por ID sem relacionamentos quando especificado', async () => {
            mockTypeormRepository.findOne.mockResolvedValue(mockCidadao);
            const result = await repository.findById('550e8400-e29b-41d4-a716-446655440000', false);
            expect(mockTypeormRepository.findOne).toHaveBeenCalledWith({
                where: { id: '550e8400-e29b-41d4-a716-446655440000' },
            });
            expect(result).toEqual(mockCidadao);
        });
        it('deve retornar null quando cidadão não for encontrado', async () => {
            mockTypeormRepository.findOne.mockResolvedValue(null);
            const result = await repository.findById('id-inexistente');
            expect(result).toBeNull();
        });
    });
    describe('findByCpf', () => {
        it('deve buscar cidadão por CPF normalizado', async () => {
            mockTypeormRepository.findOne.mockResolvedValue(mockCidadao);
            const result = await repository.findByCpf('123.456.789-01');
            expect(mockTypeormRepository.findOne).toHaveBeenCalledWith({
                where: { cpf: '12345678901' },
            });
            expect(result).toEqual(mockCidadao);
        });
        it('deve buscar cidadão por CPF com relacionamentos quando especificado', async () => {
            mockTypeormRepository.findOne.mockResolvedValue(mockCidadao);
            const result = await repository.findByCpf('12345678901', true);
            expect(mockTypeormRepository.findOne).toHaveBeenCalledWith({
                where: { cpf: '12345678901' },
                relations: ['papeis', 'composicao_familiar'],
            });
            expect(result).toEqual(mockCidadao);
        });
    });
    describe('findByNis', () => {
        it('deve buscar cidadão por NIS normalizado', async () => {
            mockTypeormRepository.findOne.mockResolvedValue(mockCidadao);
            const result = await repository.findByNis('123.456.789-01');
            expect(mockTypeormRepository.findOne).toHaveBeenCalledWith({
                where: { nis: '12345678901' },
            });
            expect(result).toEqual(mockCidadao);
        });
        it('deve buscar cidadão por NIS com relacionamentos quando especificado', async () => {
            mockTypeormRepository.findOne.mockResolvedValue(mockCidadao);
            const result = await repository.findByNis('12345678901', true);
            expect(mockTypeormRepository.findOne).toHaveBeenCalledWith({
                where: { nis: '12345678901' },
                relations: ['papeis', 'composicao_familiar'],
            });
            expect(result).toEqual(mockCidadao);
        });
    });
    describe('update', () => {
        it('deve atualizar cidadão e retornar dados atualizados', async () => {
            const updateData = { nome: 'João Silva Atualizado' };
            mockTypeormRepository.update.mockResolvedValue({ affected: 1 });
            mockTypeormRepository.findOne.mockResolvedValue({ ...mockCidadao, ...updateData });
            const result = await repository.update('550e8400-e29b-41d4-a716-446655440000', updateData);
            expect(mockTypeormRepository.update).toHaveBeenCalledWith('550e8400-e29b-41d4-a716-446655440000', updateData);
            expect(result.nome).toBe('João Silva Atualizado');
        });
        it('deve normalizar CPF antes de atualizar', async () => {
            const updateData = { cpf: '987.654.321-00' };
            mockTypeormRepository.update.mockResolvedValue({ affected: 1 });
            mockTypeormRepository.findOne.mockResolvedValue({ ...mockCidadao, cpf: '98765432100' });
            await repository.update('550e8400-e29b-41d4-a716-446655440000', updateData);
            expect(mockTypeormRepository.update).toHaveBeenCalledWith('550e8400-e29b-41d4-a716-446655440000', { cpf: '98765432100' });
        });
        it('deve normalizar NIS antes de atualizar', async () => {
            const updateData = { nis: '987.654.321-00' };
            mockTypeormRepository.update.mockResolvedValue({ affected: 1 });
            mockTypeormRepository.findOne.mockResolvedValue({ ...mockCidadao, nis: '98765432100' });
            await repository.update('550e8400-e29b-41d4-a716-446655440000', updateData);
            expect(mockTypeormRepository.update).toHaveBeenCalledWith('550e8400-e29b-41d4-a716-446655440000', { nis: '98765432100' });
        });
        it('deve lançar NotFoundException quando cidadão não for encontrado', async () => {
            mockTypeormRepository.update.mockResolvedValue({ affected: 0 });
            await expect(repository.update('id-inexistente', { nome: 'Teste' })).rejects.toThrow(common_1.NotFoundException);
        });
        it('deve lançar NotFoundException quando cidadão não for encontrado após atualização', async () => {
            mockTypeormRepository.update.mockResolvedValue({ affected: 1 });
            mockTypeormRepository.findOne.mockResolvedValue(null);
            await expect(repository.update('550e8400-e29b-41d4-a716-446655440000', { nome: 'Teste' })).rejects.toThrow(common_1.NotFoundException);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFx0ZXN0XFx1bml0XFxjaWRhZGFvXFxjaWRhZGFvLnJlcG9zaXRvcnkuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCxxQ0FBaUQ7QUFDakQsMkNBQW1EO0FBQ25ELHlGQUFxRjtBQUNyRiw2RUFBeUU7QUFFekUsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtJQUNqQyxJQUFJLFVBQTZCLENBQUM7SUFDbEMsSUFBSSxVQUFzQixDQUFDO0lBQzNCLElBQUksaUJBQXNDLENBQUM7SUFFM0MsTUFBTSxxQkFBcUIsR0FBRztRQUM1QixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2YsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDakIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDckIsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDeEIsQ0FBQztJQUVGLE1BQU0sY0FBYyxHQUFHO1FBQ3JCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLHFCQUFxQixDQUFDO0tBQ2hFLENBQUM7SUFFRixNQUFNLFdBQVcsR0FBWTtRQUMzQixFQUFFLEVBQUUsc0NBQXNDO1FBQzFDLElBQUksRUFBRSxlQUFlO1FBQ3JCLFdBQVcsRUFBRSxNQUFNO1FBQ25CLEdBQUcsRUFBRSxhQUFhO1FBQ2xCLEVBQUUsRUFBRSxXQUFXO1FBQ2YsR0FBRyxFQUFFLGFBQWE7UUFDbEIsUUFBUSxFQUFFLGdCQUFnQjtRQUMxQixZQUFZLEVBQUUsV0FBVztRQUN6QixlQUFlLEVBQUUsWUFBWTtR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QUFpQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXRELE1BQU0sTUFBTSxDQUNWLFVBQVUsQ0FBQyxNQUFNLENBQUMsc0NBQXNDLEVBQUUsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FDN0UsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDBCQUFpQixDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcdGVzdFxcdW5pdFxcY2lkYWRhb1xcY2lkYWRhby5yZXBvc2l0b3J5LnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBEYXRhU291cmNlLCBSZXBvc2l0b3J5IH0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQgeyBOb3RGb3VuZEV4Y2VwdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IENpZGFkYW9SZXBvc2l0b3J5IH0gZnJvbSAnQG1vZHVsZXMvY2lkYWRhby9yZXBvc2l0b3JpZXMvY2lkYWRhby5yZXBvc2l0b3J5JztcbmltcG9ydCB7IENpZGFkYW8sIFNleG8gfSBmcm9tICdAbW9kdWxlcy9jaWRhZGFvL2VudGl0aWVzL2NpZGFkYW8uZW50aXR5JztcblxuZGVzY3JpYmUoJ0NpZGFkYW9SZXBvc2l0b3J5JywgKCkgPT4ge1xuICBsZXQgcmVwb3NpdG9yeTogQ2lkYWRhb1JlcG9zaXRvcnk7XG4gIGxldCBkYXRhU291cmNlOiBEYXRhU291cmNlO1xuICBsZXQgdHlwZW9ybVJlcG9zaXRvcnk6IFJlcG9zaXRvcnk8Q2lkYWRhbz47XG5cbiAgY29uc3QgbW9ja1R5cGVvcm1SZXBvc2l0b3J5ID0ge1xuICAgIGZpbmQ6IGplc3QuZm4oKSxcbiAgICBmaW5kT25lOiBqZXN0LmZuKCksXG4gICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgc2F2ZTogamVzdC5mbigpLFxuICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgIHNvZnREZWxldGU6IGplc3QuZm4oKSxcbiAgICBmaW5kQW5kQ291bnQ6IGplc3QuZm4oKSxcbiAgfTtcblxuICBjb25zdCBtb2NrRGF0YVNvdXJjZSA9IHtcbiAgICBnZXRSZXBvc2l0b3J5OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tUeXBlb3JtUmVwb3NpdG9yeSksXG4gIH07XG5cbiAgY29uc3QgbW9ja0NpZGFkYW86IENpZGFkYW8gPSB7XG4gICAgaWQ6ICc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnLFxuICAgIG5vbWU6ICdKb8OjbyBkYSBTaWx2YScsXG4gICAgbm9tZV9zb2NpYWw6ICdKb8OjbycsXG4gICAgY3BmOiAnMTIzNDU2Nzg5MDEnLFxuICAgIHJnOiAnMTIzNDU2Nzg5JyxcbiAgICBuaXM6ICcxMjM0NTY3ODkwMScsXG4gICAgbm9tZV9tYWU6ICdNYXJpYSBkYSBTaWx2YScsXG4gICAgbmF0dXJhbGlkYWRlOiAnU8OjbyBQYXVsbycsXG4gICAgcHJvbnR1YXJpb19zdWFzOiAnU1VBUzEyMzQ1NicsXG4gICAgZGF0YV9uYXNjaW1lbnRvOiBuZXcgRGF0ZSgnMTk5MC0wMS0wMScpLFxuICAgIHNleG86IFNleG8uTUFTQ1VMSU5PLFxuICAgIHRlbGVmb25lOiAnMTE5OTk5OTk5OTknLFxuICAgIGVtYWlsOiAnam9hb0BleGFtcGxlLmNvbScsXG4gICAgZW5kZXJlY286IHtcbiAgICAgIGxvZ3JhZG91cm86ICdSdWEgZGFzIEZsb3JlcycsXG4gICAgICBudW1lcm86ICcxMjMnLFxuICAgICAgYmFpcnJvOiAnQ2VudHJvJyxcbiAgICAgIGNpZGFkZTogJ1PDo28gUGF1bG8nLFxuICAgICAgZXN0YWRvOiAnU1AnLFxuICAgICAgY2VwOiAnMDEyMzQ1NjcnLFxuICAgIH0sXG4gICAgcGFwZWlzOiBbXSxcbiAgICBjb21wb3NpY2FvX2ZhbWlsaWFyOiBbXSxcbiAgICBhdGl2bzogdHJ1ZSxcbiAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLFxuICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gICAgcmVtb3ZlZF9hdDogbnVsbCxcbiAgfSBhcyB1bmtub3duIGFzIENpZGFkYW87XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICBDaWRhZGFvUmVwb3NpdG9yeSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IERhdGFTb3VyY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tEYXRhU291cmNlLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICByZXBvc2l0b3J5ID0gbW9kdWxlLmdldDxDaWRhZGFvUmVwb3NpdG9yeT4oQ2lkYWRhb1JlcG9zaXRvcnkpO1xuICAgIGRhdGFTb3VyY2UgPSBtb2R1bGUuZ2V0PERhdGFTb3VyY2U+KERhdGFTb3VyY2UpO1xuICAgIHR5cGVvcm1SZXBvc2l0b3J5ID0gbW9ja1R5cGVvcm1SZXBvc2l0b3J5IGFzIGFueTtcblxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBpdCgnZGV2ZSBlc3RhciBkZWZpbmlkbycsICgpID0+IHtcbiAgICBleHBlY3QocmVwb3NpdG9yeSkudG9CZURlZmluZWQoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbmRCeUlkJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGJ1c2NhciBjaWRhZMOjbyBwb3IgSUQgY29tIHJlbGFjaW9uYW1lbnRvcyBwb3IgcGFkcsOjbycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tUeXBlb3JtUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDaWRhZGFvKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlJZCgnNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrVHlwZW9ybVJlcG9zaXRvcnkuZmluZE9uZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBpZDogJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcgfSxcbiAgICAgICAgcmVsYXRpb25zOiBbJ3BhcGVpcycsICdjb21wb3NpY2FvX2ZhbWlsaWFyJ10sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0NpZGFkYW8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgYnVzY2FyIGNpZGFkw6NvIHBvciBJRCBzZW0gcmVsYWNpb25hbWVudG9zIHF1YW5kbyBlc3BlY2lmaWNhZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrVHlwZW9ybVJlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2lkYWRhbyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlcG9zaXRvcnkuZmluZEJ5SWQoJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsIGZhbHNlKTtcblxuICAgICAgZXhwZWN0KG1vY2tUeXBlb3JtUmVwb3NpdG9yeS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiAnNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwJyB9LFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tDaWRhZGFvKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIG51bGwgcXVhbmRvIGNpZGFkw6NvIG7Do28gZm9yIGVuY29udHJhZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrVHlwZW9ybVJlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlJZCgnaWQtaW5leGlzdGVudGUnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbmRCeUNwZicsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBidXNjYXIgY2lkYWTDo28gcG9yIENQRiBub3JtYWxpemFkbycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tUeXBlb3JtUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDaWRhZGFvKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlDcGYoJzEyMy40NTYuNzg5LTAxJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrVHlwZW9ybVJlcG9zaXRvcnkuZmluZE9uZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBjcGY6ICcxMjM0NTY3ODkwMScgfSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQ2lkYWRhbyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBidXNjYXIgY2lkYWTDo28gcG9yIENQRiBjb20gcmVsYWNpb25hbWVudG9zIHF1YW5kbyBlc3BlY2lmaWNhZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrVHlwZW9ybVJlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2lkYWRhbyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlcG9zaXRvcnkuZmluZEJ5Q3BmKCcxMjM0NTY3ODkwMScsIHRydWUpO1xuXG4gICAgICBleHBlY3QobW9ja1R5cGVvcm1SZXBvc2l0b3J5LmZpbmRPbmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgY3BmOiAnMTIzNDU2Nzg5MDEnIH0sXG4gICAgICAgIHJlbGF0aW9uczogWydwYXBlaXMnLCAnY29tcG9zaWNhb19mYW1pbGlhciddLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tDaWRhZGFvKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbmRCeU5pcycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBidXNjYXIgY2lkYWTDo28gcG9yIE5JUyBub3JtYWxpemFkbycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tUeXBlb3JtUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDaWRhZGFvKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS5maW5kQnlOaXMoJzEyMy40NTYuNzg5LTAxJyk7XG5cbiAgICAgIGV4cGVjdChtb2NrVHlwZW9ybVJlcG9zaXRvcnkuZmluZE9uZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBuaXM6ICcxMjM0NTY3ODkwMScgfSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQ2lkYWRhbyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBidXNjYXIgY2lkYWTDo28gcG9yIE5JUyBjb20gcmVsYWNpb25hbWVudG9zIHF1YW5kbyBlc3BlY2lmaWNhZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrVHlwZW9ybVJlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2lkYWRhbyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlcG9zaXRvcnkuZmluZEJ5TmlzKCcxMjM0NTY3ODkwMScsIHRydWUpO1xuXG4gICAgICBleHBlY3QobW9ja1R5cGVvcm1SZXBvc2l0b3J5LmZpbmRPbmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgbmlzOiAnMTIzNDU2Nzg5MDEnIH0sXG4gICAgICAgIHJlbGF0aW9uczogWydwYXBlaXMnLCAnY29tcG9zaWNhb19mYW1pbGlhciddLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tDaWRhZGFvKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3VwZGF0ZScsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBhdHVhbGl6YXIgY2lkYWTDo28gZSByZXRvcm5hciBkYWRvcyBhdHVhbGl6YWRvcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGEgPSB7IG5vbWU6ICdKb8OjbyBTaWx2YSBBdHVhbGl6YWRvJyB9O1xuICAgICAgbW9ja1R5cGVvcm1SZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGFmZmVjdGVkOiAxIH0pO1xuICAgICAgbW9ja1R5cGVvcm1SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoeyAuLi5tb2NrQ2lkYWRhbywgLi4udXBkYXRlRGF0YSB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVwb3NpdG9yeS51cGRhdGUoJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsIHVwZGF0ZURhdGEpO1xuXG4gICAgICBleHBlY3QobW9ja1R5cGVvcm1SZXBvc2l0b3J5LnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnLFxuICAgICAgICB1cGRhdGVEYXRhLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubm9tZSkudG9CZSgnSm/Do28gU2lsdmEgQXR1YWxpemFkbycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbm9ybWFsaXphciBDUEYgYW50ZXMgZGUgYXR1YWxpemFyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHsgY3BmOiAnOTg3LjY1NC4zMjEtMDAnIH07XG4gICAgICBtb2NrVHlwZW9ybVJlcG9zaXRvcnkudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHsgYWZmZWN0ZWQ6IDEgfSk7XG4gICAgICBtb2NrVHlwZW9ybVJlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IC4uLm1vY2tDaWRhZGFvLCBjcGY6ICc5ODc2NTQzMjEwMCcgfSk7XG5cbiAgICAgIGF3YWl0IHJlcG9zaXRvcnkudXBkYXRlKCc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnLCB1cGRhdGVEYXRhKTtcblxuICAgICAgZXhwZWN0KG1vY2tUeXBlb3JtUmVwb3NpdG9yeS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwJyxcbiAgICAgICAgeyBjcGY6ICc5ODc2NTQzMjEwMCcgfSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBub3JtYWxpemFyIE5JUyBhbnRlcyBkZSBhdHVhbGl6YXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1cGRhdGVEYXRhID0geyBuaXM6ICc5ODcuNjU0LjMyMS0wMCcgfTtcbiAgICAgIG1vY2tUeXBlb3JtUmVwb3NpdG9yeS51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUoeyBhZmZlY3RlZDogMSB9KTtcbiAgICAgIG1vY2tUeXBlb3JtUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKHsgLi4ubW9ja0NpZGFkYW8sIG5pczogJzk4NzY1NDMyMTAwJyB9KTtcblxuICAgICAgYXdhaXQgcmVwb3NpdG9yeS51cGRhdGUoJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsIHVwZGF0ZURhdGEpO1xuXG4gICAgICBleHBlY3QobW9ja1R5cGVvcm1SZXBvc2l0b3J5LnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICc1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAnLFxuICAgICAgICB7IG5pczogJzk4NzY1NDMyMTAwJyB9LFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGxhbsOnYXIgTm90Rm91bmRFeGNlcHRpb24gcXVhbmRvIGNpZGFkw6NvIG7Do28gZm9yIGVuY29udHJhZG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrVHlwZW9ybVJlcG9zaXRvcnkudXBkYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHsgYWZmZWN0ZWQ6IDAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgcmVwb3NpdG9yeS51cGRhdGUoJ2lkLWluZXhpc3RlbnRlJywgeyBub21lOiAnVGVzdGUnIH0pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgbGFuw6dhciBOb3RGb3VuZEV4Y2VwdGlvbiBxdWFuZG8gY2lkYWTDo28gbsOjbyBmb3IgZW5jb250cmFkbyBhcMOzcyBhdHVhbGl6YcOnw6NvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1R5cGVvcm1SZXBvc2l0b3J5LnVwZGF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGFmZmVjdGVkOiAxIH0pO1xuICAgICAgbW9ja1R5cGVvcm1SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgcmVwb3NpdG9yeS51cGRhdGUoJzU1MGU4NDAwLWUyOWItNDFkNC1hNzE2LTQ0NjY1NTQ0MDAwMCcsIHsgbm9tZTogJ1Rlc3RlJyB9KSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=