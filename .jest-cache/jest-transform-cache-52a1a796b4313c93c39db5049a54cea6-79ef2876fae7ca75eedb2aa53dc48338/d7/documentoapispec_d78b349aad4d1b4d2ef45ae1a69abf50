95ec2682ee55e7af54235c61d4ebca19
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const request = __importStar(require("supertest"));
const app_module_1 = require("../../src/app.module");
const jwt_1 = require("@nestjs/jwt");
const typeorm_1 = require("@nestjs/typeorm");
const documento_entity_1 = require("../../src/modules/documento/entities/documento.entity");
const minio_service_1 = require("../../src/shared/services/minio.service");
const criptografia_service_1 = require("../../src/shared/services/criptografia.service");
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const crypto = __importStar(require("crypto"));
describe('Documento API', () => {
    let app;
    let documentoRepository;
    let minioService;
    let criptografiaService;
    let jwtService;
    let authToken;
    let testFilePath;
    beforeAll(async () => {
        const moduleFixture = await testing_1.Test.createTestingModule({
            imports: [app_module_1.AppModule],
        }).compile();
        app = moduleFixture.createNestApplication();
        app.useGlobalPipes(new common_1.ValidationPipe({ transform: true }));
        await app.init();
        documentoRepository = moduleFixture.get((0, typeorm_1.getRepositoryToken)(documento_entity_1.Documento));
        minioService = moduleFixture.get(minio_service_1.MinioService);
        criptografiaService =
            moduleFixture.get(criptografia_service_1.CriptografiaService);
        jwtService = moduleFixture.get(jwt_1.JwtService);
        // Gerar token de autenticação para testes
        authToken = jwtService.sign({
            id: 'test-user-id',
            nome: 'Usuário de Teste',
            email: 'teste@exemplo.com',
            roles: ['admin'],
        });
        // Criar arquivo temporário para testes
        testFilePath = path.join(__dirname, '..', 'temp-test-file.txt');
        fs.writeFileSync(testFilePath, 'Conteúdo de teste para upload de arquivo');
    });
    beforeEach(async () => {
        // Limpar documentos antes de cada teste
        await documentoRepository.clear();
        // Espiar o MinioService para evitar chamadas reais ao MinIO durante os testes
        jest
            .spyOn(minioService, 'uploadArquivo')
            .mockImplementation(async (arquivo, nomeArquivo, metadados) => {
            return {
                etag: 'mock-etag',
                versionId: 'mock-version-id',
            };
        });
        jest
            .spyOn(minioService, 'downloadArquivo')
            .mockImplementation(async (nomeArquivo) => {
            return Buffer.from('Conteúdo mockado do arquivo');
        });
        jest
            .spyOn(minioService, 'removerArquivo')
            .mockImplementation(async (nomeArquivo) => {
            return true;
        });
    });
    afterAll(async () => {
        // Remover arquivo temporário
        if (fs.existsSync(testFilePath)) {
            fs.unlinkSync(testFilePath);
        }
        await app.close();
    });
    describe('POST /api/documentos/upload', () => {
        it('deve fazer upload de um documento não sensível', async () => {
            // Act
            const response = await request(app.getHttpServer())
                .post('/api/documentos/upload')
                .set('Authorization', `Bearer ${authToken}`)
                .attach('arquivo', testFilePath)
                .field('nome', 'Documento de Teste')
                .field('tipo', 'contrato')
                .field('sensivel', 'false')
                .expect(201);
            // Assert
            expect(response.body).toHaveProperty('id');
            expect(response.body.nome).toBe('Documento de Teste');
            expect(response.body.tipo).toBe('contrato');
            expect(response.body.sensivel).toBe(false);
            expect(response.body.hash).toBeDefined();
            expect(response.body.tamanho).toBeGreaterThan(0);
            expect(response.body.usuario_id).toBe('test-user-id');
            // Verificar se o documento foi salvo no repositório
            const savedDoc = await documentoRepository.findOne({
                where: { id: response.body.id },
            });
            expect(savedDoc).toBeDefined();
        });
        it('deve fazer upload de um documento sensível com criptografia', async () => {
            // Espiar o CriptografiaService para verificar se a criptografia é chamada
            const spyCriptografar = jest.spyOn(criptografiaService, 'cryptografarBuffer');
            // Act
            const response = await request(app.getHttpServer())
                .post('/api/documentos/upload')
                .set('Authorization', `Bearer ${authToken}`)
                .attach('arquivo', testFilePath)
                .field('nome', 'Documento Sensível')
                .field('tipo', 'pessoal')
                .field('sensivel', 'true')
                .expect(201);
            // Assert
            expect(response.body).toHaveProperty('id');
            expect(response.body.nome).toBe('Documento Sensível');
            expect(response.body.tipo).toBe('pessoal');
            expect(response.body.sensivel).toBe(true);
            expect(response.body.criptografado).toBe(true);
            expect(response.body.iv).toBeDefined();
            expect(response.body.auth_tag).toBeDefined();
            // Verificar se a criptografia foi chamada
            expect(spyCriptografar).toHaveBeenCalled();
        });
        it('deve validar os campos obrigatórios', async () => {
            // Act & Assert
            await request(app.getHttpServer())
                .post('/api/documentos/upload')
                .set('Authorization', `Bearer ${authToken}`)
                .attach('arquivo', testFilePath)
                // Faltando campo nome, que é obrigatório
                .field('tipo', 'contrato')
                .expect(400);
        });
        it('deve requerer autenticação', async () => {
            // Act & Assert
            await request(app.getHttpServer())
                .post('/api/documentos/upload')
                .attach('arquivo', testFilePath)
                .field('nome', 'Documento de Teste')
                .field('tipo', 'contrato')
                .expect(401);
        });
    });
    describe('GET /api/documentos', () => {
        it('deve listar documentos paginados', async () => {
            // Arrange
            const documentos = [];
            for (let i = 0; i < 5; i++) {
                documentos.push(documentoRepository.create({
                    nome: `Documento ${i}`,
                    tipo: 'contrato',
                    caminho: `documentos/doc-${i}.pdf`,
                    mime_type: 'application/pdf',
                    tamanho: 1024,
                    hash: crypto.randomBytes(32).toString('hex'),
                    sensivel: false,
                    criptografado: false,
                    usuario_id: 'test-user-id',
                }));
            }
            await documentoRepository.save(documentos);
            // Act
            const response = await request(app.getHttpServer())
                .get('/api/documentos')
                .set('Authorization', `Bearer ${authToken}`)
                .query({ page: 1, limit: 3 })
                .expect(200);
            // Assert
            expect(response.body.data).toHaveLength(3);
            expect(response.body.total).toBe(5);
            expect(response.body.page).toBe(1);
            expect(response.body.limit).toBe(3);
            expect(response.body.totalPages).toBe(2);
        });
        it('deve filtrar documentos por tipo', async () => {
            // Arrange
            const documentos = [
                documentoRepository.create({
                    nome: 'Documento Contrato',
                    tipo: 'contrato',
                    caminho: 'documentos/contrato.pdf',
                    mime_type: 'application/pdf',
                    tamanho: 1024,
                    hash: crypto.randomBytes(32).toString('hex'),
                    sensivel: false,
                    criptografado: false,
                    usuario_id: 'test-user-id',
                }),
                documentoRepository.create({
                    nome: 'Documento Pessoal',
                    tipo: 'pessoal',
                    caminho: 'documentos/pessoal.pdf',
                    mime_type: 'application/pdf',
                    tamanho: 1024,
                    hash: crypto.randomBytes(32).toString('hex'),
                    sensivel: true,
                    criptografado: true,
                    iv: Buffer.from('iv-mock').toString('base64'),
                    auth_tag: Buffer.from('auth-tag-mock').toString('base64'),
                    usuario_id: 'test-user-id',
                }),
            ];
            await documentoRepository.save(documentos);
            // Act
            const response = await request(app.getHttpServer())
                .get('/api/documentos')
                .set('Authorization', `Bearer ${authToken}`)
                .query({ tipo: 'pessoal' })
                .expect(200);
            // Assert
            expect(response.body.data).toHaveLength(1);
            expect(response.body.data[0].tipo).toBe('pessoal');
        });
        it('deve filtrar documentos por sensibilidade', async () => {
            // Arrange
            const documentos = [
                documentoRepository.create({
                    nome: 'Documento Não Sensível',
                    tipo: 'contrato',
                    caminho: 'documentos/contrato.pdf',
                    mime_type: 'application/pdf',
                    tamanho: 1024,
                    hash: crypto.randomBytes(32).toString('hex'),
                    sensivel: false,
                    criptografado: false,
                    usuario_id: 'test-user-id',
                }),
                documentoRepository.create({
                    nome: 'Documento Sensível',
                    tipo: 'pessoal',
                    caminho: 'documentos/pessoal.pdf',
                    mime_type: 'application/pdf',
                    tamanho: 1024,
                    hash: crypto.randomBytes(32).toString('hex'),
                    sensivel: true,
                    criptografado: true,
                    iv: Buffer.from('iv-mock').toString('base64'),
                    auth_tag: Buffer.from('auth-tag-mock').toString('base64'),
                    usuario_id: 'test-user-id',
                }),
            ];
            await documentoRepository.save(documentos);
            // Act
            const response = await request(app.getHttpServer())
                .get('/api/documentos')
                .set('Authorization', `Bearer ${authToken}`)
                .query({ sensivel: 'true' })
                .expect(200);
            // Assert
            expect(response.body.data).toHaveLength(1);
            expect(response.body.data[0].sensivel).toBe(true);
        });
    });
    describe('GET /api/documentos/:id', () => {
        it('deve retornar um documento específico pelo ID', async () => {
            // Arrange
            const documento = documentoRepository.create({
                nome: 'Documento para Busca',
                tipo: 'contrato',
                caminho: 'documentos/busca.pdf',
                mime_type: 'application/pdf',
                tamanho: 1024,
                hash: crypto.randomBytes(32).toString('hex'),
                sensivel: false,
                criptografado: false,
                usuario_id: 'test-user-id',
            });
            await documentoRepository.save(documento);
            // Act
            const response = await request(app.getHttpServer())
                .get(`/api/documentos/${documento.id}`)
                .set('Authorization', `Bearer ${authToken}`)
                .expect(200);
            // Assert
            expect(response.body.id).toBe(documento.id);
            expect(response.body.nome).toBe('Documento para Busca');
        });
        it('deve retornar 404 para ID inexistente', async () => {
            // Act & Assert
            await request(app.getHttpServer())
                .get('/api/documentos/id-inexistente')
                .set('Authorization', `Bearer ${authToken}`)
                .expect(404);
        });
    });
    describe('GET /api/documentos/:id/download', () => {
        it('deve baixar um documento não sensível', async () => {
            // Arrange
            const documento = documentoRepository.create({
                nome: 'Documento para Download',
                tipo: 'contrato',
                caminho: 'documentos/download.pdf',
                mime_type: 'application/pdf',
                tamanho: 1024,
                hash: crypto.randomBytes(32).toString('hex'),
                sensivel: false,
                criptografado: false,
                usuario_id: 'test-user-id',
            });
            await documentoRepository.save(documento);
            // Act
            const response = await request(app.getHttpServer())
                .get(`/api/documentos/${documento.id}/download`)
                .set('Authorization', `Bearer ${authToken}`)
                .expect(200);
            // Assert
            expect(response.header['content-type']).toBe('application/pdf');
            expect(response.header['content-disposition']).toContain('attachment');
            expect(response.header['content-disposition']).toContain('download.pdf');
            expect(response.body).toBeInstanceOf(Buffer);
        });
        it('deve baixar e descriptografar um documento sensível', async () => {
            // Arrange
            const documento = documentoRepository.create({
                nome: 'Documento Sensível para Download',
                tipo: 'pessoal',
                caminho: 'documentos/sensivel.pdf',
                mime_type: 'application/pdf',
                tamanho: 1024,
                hash: crypto.randomBytes(32).toString('hex'),
                sensivel: true,
                criptografado: true,
                iv: Buffer.from('iv-mock').toString('base64'),
                auth_tag: Buffer.from('auth-tag-mock').toString('base64'),
                usuario_id: 'test-user-id',
            });
            await documentoRepository.save(documento);
            // Espiar o CriptografiaService para verificar se a descriptografia é chamada
            const spyDescriptografar = jest
                .spyOn(criptografiaService, 'descriptografarBuffer')
                .mockImplementation((dados, iv, authTag) => {
                return Buffer.from('Conteúdo descriptografado mockado');
            });
            // Act
            const response = await request(app.getHttpServer())
                .get(`/api/documentos/${documento.id}/download`)
                .set('Authorization', `Bearer ${authToken}`)
                .expect(200);
            // Assert
            expect(response.header['content-type']).toBe('application/pdf');
            expect(response.body).toBeInstanceOf(Buffer);
            expect(spyDescriptografar).toHaveBeenCalled();
        });
        it('deve requerer autenticação para download', async () => {
            // Arrange
            const documento = documentoRepository.create({
                nome: 'Documento para Download',
                tipo: 'contrato',
                caminho: 'documentos/download.pdf',
                mime_type: 'application/pdf',
                tamanho: 1024,
                hash: crypto.randomBytes(32).toString('hex'),
                sensivel: false,
                criptografado: false,
                usuario_id: 'test-user-id',
            });
            await documentoRepository.save(documento);
            // Act & Assert
            await request(app.getHttpServer())
                .get(`/api/documentos/${documento.id}/download`)
                .expect(401);
        });
    });
    describe('DELETE /api/documentos/:id', () => {
        it('deve excluir um documento', async () => {
            // Arrange
            const documento = documentoRepository.create({
                nome: 'Documento para Exclusão',
                tipo: 'contrato',
                caminho: 'documentos/exclusao.pdf',
                mime_type: 'application/pdf',
                tamanho: 1024,
                hash: crypto.randomBytes(32).toString('hex'),
                sensivel: false,
                criptografado: false,
                usuario_id: 'test-user-id',
            });
            await documentoRepository.save(documento);
            // Act
            await request(app.getHttpServer())
                .delete(`/api/documentos/${documento.id}`)
                .set('Authorization', `Bearer ${authToken}`)
                .expect(200);
            // Assert
            const deletedDoc = await documentoRepository.findOne({
                where: { id: documento.id },
            });
            expect(deletedDoc).toBeNull();
            expect(minioService.removerArquivo).toHaveBeenCalledWith('documentos/exclusao.pdf');
        });
        it('deve retornar 404 ao tentar excluir documento inexistente', async () => {
            // Act & Assert
            await request(app.getHttpServer())
                .delete('/api/documentos/id-inexistente')
                .set('Authorization', `Bearer ${authToken}`)
                .expect(404);
        });
        it('deve requerer autenticação para exclusão', async () => {
            // Arrange
            const documento = documentoRepository.create({
                nome: 'Documento para Exclusão',
                tipo: 'contrato',
                caminho: 'documentos/exclusao.pdf',
                mime_type: 'application/pdf',
                tamanho: 1024,
                hash: crypto.randomBytes(32).toString('hex'),
                sensivel: false,
                criptografado: false,
                usuario_id: 'test-user-id',
            });
            await documentoRepository.save(documento);
            // Act & Assert
            await request(app.getHttpServer())
                .delete(`/api/documentos/${documento.id}`)
                .expect(401);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFx0ZXN0XFxhcGlcXGRvY3VtZW50by5hcGkuc3BlYy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZDQUFzRDtBQUN0RCwyQ0FBa0U7QUFDbEUsbURBQXFDO0FBQ3JDLHFEQUFpRDtBQUNqRCxxQ0FBeUM7QUFDekMsNkNBQXFEO0FBRXJELDRGQUFrRjtBQUNsRiwyRUFBdUU7QUFDdkUseUZBQXFGO0FBQ3JGLHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUFDN0IsK0NBQWlDO0FBRWpDLFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO0lBQzdCLElBQUksR0FBcUIsQ0FBQztJQUMxQixJQUFJLG1CQUEwQyxDQUFDO0lBQy9DLElBQUksWUFBMEIsQ0FBQztJQUMvQixJQUFJLG1CQUF3QyxDQUFDO0lBQzdDLElBQUksVUFBc0IsQ0FBQztJQUMzQixJQUFJLFNBQWlCLENBQUM7SUFDdEIsSUFBSSxZQUFvQixDQUFDO0lBRXpCLFNBQVMsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNuQixNQUFNLGFBQWEsR0FBa0IsTUFBTSxjQUFJLENBQUMsbUJBQW1CLENBQUM7WUFDbEUsT0FBTyxFQUFFLENBQUMsc0JBQVMsQ0FBQztTQUNyQixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFYixHQUFHLEdBQUcsYUFBYSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDNUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxJQUFJLHVCQUFjLENBQUMsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzVELE1BQU0sR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO1FBRWpCLG1CQUFtQixHQUFHLGFBQWEsQ0FBQyxHQUFHLENBQ3JDLElBQUEsNEJBQWtCLEVBQUMsNEJBQVMsQ0FBQyxDQUM5QixDQUFDO1FBQ0YsWUFBWSxHQUFH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QyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFx0ZXN0XFxhcGlcXGRvY3VtZW50by5hcGkuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcbmltcG9ydCB7IElOZXN0QXBwbGljYXRpb24sIFZhbGlkYXRpb25QaXBlIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0ICogYXMgcmVxdWVzdCBmcm9tICdzdXBlcnRlc3QnO1xuaW1wb3J0IHsgQXBwTW9kdWxlIH0gZnJvbSAnLi4vLi4vc3JjL2FwcC5tb2R1bGUnO1xuaW1wb3J0IHsgSnd0U2VydmljZSB9IGZyb20gJ0BuZXN0anMvand0JztcbmltcG9ydCB7IGdldFJlcG9zaXRvcnlUb2tlbiB9IGZyb20gJ0BuZXN0anMvdHlwZW9ybSc7XG5pbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQgeyBEb2N1bWVudG8gfSBmcm9tICcuLi8uLi9zcmMvbW9kdWxlcy9kb2N1bWVudG8vZW50aXRpZXMvZG9jdW1lbnRvLmVudGl0eSc7XG5pbXBvcnQgeyBNaW5pb1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zcmMvc2hhcmVkL3NlcnZpY2VzL21pbmlvLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ3JpcHRvZ3JhZmlhU2VydmljZSB9IGZyb20gJy4uLy4uL3NyYy9zaGFyZWQvc2VydmljZXMvY3JpcHRvZ3JhZmlhLnNlcnZpY2UnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIGNyeXB0byBmcm9tICdjcnlwdG8nO1xuXG5kZXNjcmliZSgnRG9jdW1lbnRvIEFQSScsICgpID0+IHtcbiAgbGV0IGFwcDogSU5lc3RBcHBsaWNhdGlvbjtcbiAgbGV0IGRvY3VtZW50b1JlcG9zaXRvcnk6IFJlcG9zaXRvcnk8RG9jdW1lbnRvPjtcbiAgbGV0IG1pbmlvU2VydmljZTogTWluaW9TZXJ2aWNlO1xuICBsZXQgY3JpcHRvZ3JhZmlhU2VydmljZTogQ3JpcHRvZ3JhZmlhU2VydmljZTtcbiAgbGV0IGp3dFNlcnZpY2U6IEp3dFNlcnZpY2U7XG4gIGxldCBhdXRoVG9rZW46IHN0cmluZztcbiAgbGV0IHRlc3RGaWxlUGF0aDogc3RyaW5nO1xuXG4gIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlRml4dHVyZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBpbXBvcnRzOiBbQXBwTW9kdWxlXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBhcHAgPSBtb2R1bGVGaXh0dXJlLmNyZWF0ZU5lc3RBcHBsaWNhdGlvbigpO1xuICAgIGFwcC51c2VHbG9iYWxQaXBlcyhuZXcgVmFsaWRhdGlvblBpcGUoeyB0cmFuc2Zvcm06IHRydWUgfSkpO1xuICAgIGF3YWl0IGFwcC5pbml0KCk7XG5cbiAgICBkb2N1bWVudG9SZXBvc2l0b3J5ID0gbW9kdWxlRml4dHVyZS5nZXQ8UmVwb3NpdG9yeTxEb2N1bWVudG8+PihcbiAgICAgIGdldFJlcG9zaXRvcnlUb2tlbihEb2N1bWVudG8pLFxuICAgICk7XG4gICAgbWluaW9TZXJ2aWNlID0gbW9kdWxlRml4dHVyZS5nZXQ8TWluaW9TZXJ2aWNlPihNaW5pb1NlcnZpY2UpO1xuICAgIGNyaXB0b2dyYWZpYVNlcnZpY2UgPVxuICAgICAgbW9kdWxlRml4dHVyZS5nZXQ8Q3JpcHRvZ3JhZmlhU2VydmljZT4oQ3JpcHRvZ3JhZmlhU2VydmljZSk7XG4gICAgand0U2VydmljZSA9IG1vZHVsZUZpeHR1cmUuZ2V0PEp3dFNlcnZpY2U+KEp3dFNlcnZpY2UpO1xuXG4gICAgLy8gR2VyYXIgdG9rZW4gZGUgYXV0ZW50aWNhw6fDo28gcGFyYSB0ZXN0ZXNcbiAgICBhdXRoVG9rZW4gPSBqd3RTZXJ2aWNlLnNpZ24oe1xuICAgICAgaWQ6ICd0ZXN0LXVzZXItaWQnLFxuICAgICAgbm9tZTogJ1VzdcOhcmlvIGRlIFRlc3RlJyxcbiAgICAgIGVtYWlsOiAndGVzdGVAZXhlbXBsby5jb20nLFxuICAgICAgcm9sZXM6IFsnYWRtaW4nXSxcbiAgICB9KTtcblxuICAgIC8vIENyaWFyIGFycXVpdm8gdGVtcG9yw6FyaW8gcGFyYSB0ZXN0ZXNcbiAgICB0ZXN0RmlsZVBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAndGVtcC10ZXN0LWZpbGUudHh0Jyk7XG4gICAgZnMud3JpdGVGaWxlU3luYyh0ZXN0RmlsZVBhdGgsICdDb250ZcO6ZG8gZGUgdGVzdGUgcGFyYSB1cGxvYWQgZGUgYXJxdWl2bycpO1xuICB9KTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAvLyBMaW1wYXIgZG9jdW1lbnRvcyBhbnRlcyBkZSBjYWRhIHRlc3RlXG4gICAgYXdhaXQgZG9jdW1lbnRvUmVwb3NpdG9yeS5jbGVhcigpO1xuXG4gICAgLy8gRXNwaWFyIG8gTWluaW9TZXJ2aWNlIHBhcmEgZXZpdGFyIGNoYW1hZGFzIHJlYWlzIGFvIE1pbklPIGR1cmFudGUgb3MgdGVzdGVzXG4gICAgamVzdFxuICAgICAgLnNweU9uKG1pbmlvU2VydmljZSwgJ3VwbG9hZEFycXVpdm8nKVxuICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAoYXJxdWl2bywgbm9tZUFycXVpdm8sIG1ldGFkYWRvcykgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGV0YWc6ICdtb2NrLWV0YWcnLFxuICAgICAgICAgIHZlcnNpb25JZDogJ21vY2stdmVyc2lvbi1pZCcsXG4gICAgICAgIH07XG4gICAgICB9KTtcblxuICAgIGplc3RcbiAgICAgIC5zcHlPbihtaW5pb1NlcnZpY2UsICdkb3dubG9hZEFycXVpdm8nKVxuICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAobm9tZUFycXVpdm8pID0+IHtcbiAgICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKCdDb250ZcO6ZG8gbW9ja2FkbyBkbyBhcnF1aXZvJyk7XG4gICAgICB9KTtcblxuICAgIGplc3RcbiAgICAgIC5zcHlPbihtaW5pb1NlcnZpY2UsICdyZW1vdmVyQXJxdWl2bycpXG4gICAgICAubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChub21lQXJxdWl2bykgPT4ge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0pO1xuICB9KTtcblxuICBhZnRlckFsbChhc3luYyAoKSA9PiB7XG4gICAgLy8gUmVtb3ZlciBhcnF1aXZvIHRlbXBvcsOhcmlvXG4gICAgaWYgKGZzLmV4aXN0c1N5bmModGVzdEZpbGVQYXRoKSkge1xuICAgICAgZnMudW5saW5rU3luYyh0ZXN0RmlsZVBhdGgpO1xuICAgIH1cbiAgICBhd2FpdCBhcHAuY2xvc2UoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BPU1QgL2FwaS9kb2N1bWVudG9zL3VwbG9hZCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBmYXplciB1cGxvYWQgZGUgdW0gZG9jdW1lbnRvIG7Do28gc2Vuc8OtdmVsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLnBvc3QoJy9hcGkvZG9jdW1lbnRvcy91cGxvYWQnKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2F1dGhUb2tlbn1gKVxuICAgICAgICAuYXR0YWNoKCdhcnF1aXZvJywgdGVzdEZpbGVQYXRoKVxuICAgICAgICAuZmllbGQoJ25vbWUnLCAnRG9jdW1lbnRvIGRlIFRlc3RlJylcbiAgICAgICAgLmZpZWxkKCd0aXBvJywgJ2NvbnRyYXRvJylcbiAgICAgICAgLmZpZWxkKCdzZW5zaXZlbCcsICdmYWxzZScpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ2lkJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5ub21lKS50b0JlKCdEb2N1bWVudG8gZGUgVGVzdGUnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnRpcG8pLnRvQmUoJ2NvbnRyYXRvJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zZW5zaXZlbCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5oYXNoKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkudGFtYW5obykudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkudXN1YXJpb19pZCkudG9CZSgndGVzdC11c2VyLWlkJyk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciBzZSBvIGRvY3VtZW50byBmb2kgc2Fsdm8gbm8gcmVwb3NpdMOzcmlvXG4gICAgICBjb25zdCBzYXZlZERvYyA9IGF3YWl0IGRvY3VtZW50b1JlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiByZXNwb25zZS5ib2R5LmlkIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChzYXZlZERvYykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGZhemVyIHVwbG9hZCBkZSB1bSBkb2N1bWVudG8gc2Vuc8OtdmVsIGNvbSBjcmlwdG9ncmFmaWEnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBFc3BpYXIgbyBDcmlwdG9ncmFmaWFTZXJ2aWNlIHBhcmEgdmVyaWZpY2FyIHNlIGEgY3JpcHRvZ3JhZmlhIMOpIGNoYW1hZGFcbiAgICAgIGNvbnN0IHNweUNyaXB0b2dyYWZhciA9IGplc3Quc3B5T24oXG4gICAgICAgIGNyaXB0b2dyYWZpYVNlcnZpY2UsXG4gICAgICAgICdjcnlwdG9ncmFmYXJCdWZmZXInLFxuICAgICAgKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLnBvc3QoJy9hcGkvZG9jdW1lbnRvcy91cGxvYWQnKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2F1dGhUb2tlbn1gKVxuICAgICAgICAuYXR0YWNoKCdhcnF1aXZvJywgdGVzdEZpbGVQYXRoKVxuICAgICAgICAuZmllbGQoJ25vbWUnLCAnRG9jdW1lbnRvIFNlbnPDrXZlbCcpXG4gICAgICAgIC5maWVsZCgndGlwbycsICdwZXNzb2FsJylcbiAgICAgICAgLmZpZWxkKCdzZW5zaXZlbCcsICd0cnVlJylcbiAgICAgICAgLmV4cGVjdCgyMDEpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnaWQnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm5vbWUpLnRvQmUoJ0RvY3VtZW50byBTZW5zw612ZWwnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnRpcG8pLnRvQmUoJ3Blc3NvYWwnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnNlbnNpdmVsKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuY3JpcHRvZ3JhZmFkbykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lml2KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuYXV0aF90YWcpLnRvQmVEZWZpbmVkKCk7XG5cbiAgICAgIC8vIFZlcmlmaWNhciBzZSBhIGNyaXB0b2dyYWZpYSBmb2kgY2hhbWFkYVxuICAgICAgZXhwZWN0KHNweUNyaXB0b2dyYWZhcikudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgdmFsaWRhciBvcyBjYW1wb3Mgb2JyaWdhdMOzcmlvcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAucG9zdCgnL2FwaS9kb2N1bWVudG9zL3VwbG9hZCcpXG4gICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7YXV0aFRva2VufWApXG4gICAgICAgIC5hdHRhY2goJ2FycXVpdm8nLCB0ZXN0RmlsZVBhdGgpXG4gICAgICAgIC8vIEZhbHRhbmRvIGNhbXBvIG5vbWUsIHF1ZSDDqSBvYnJpZ2F0w7NyaW9cbiAgICAgICAgLmZpZWxkKCd0aXBvJywgJ2NvbnRyYXRvJylcbiAgICAgICAgLmV4cGVjdCg0MDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVxdWVyZXIgYXV0ZW50aWNhw6fDo28nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLnBvc3QoJy9hcGkvZG9jdW1lbnRvcy91cGxvYWQnKVxuICAgICAgICAuYXR0YWNoKCdhcnF1aXZvJywgdGVzdEZpbGVQYXRoKVxuICAgICAgICAuZmllbGQoJ25vbWUnLCAnRG9jdW1lbnRvIGRlIFRlc3RlJylcbiAgICAgICAgLmZpZWxkKCd0aXBvJywgJ2NvbnRyYXRvJylcbiAgICAgICAgLmV4cGVjdCg0MDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC9hcGkvZG9jdW1lbnRvcycsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBsaXN0YXIgZG9jdW1lbnRvcyBwYWdpbmFkb3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBkb2N1bWVudG9zID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykge1xuICAgICAgICBkb2N1bWVudG9zLnB1c2goXG4gICAgICAgICAgZG9jdW1lbnRvUmVwb3NpdG9yeS5jcmVhdGUoe1xuICAgICAgICAgICAgbm9tZTogYERvY3VtZW50byAke2l9YCxcbiAgICAgICAgICAgIHRpcG86ICdjb250cmF0bycsXG4gICAgICAgICAgICBjYW1pbmhvOiBgZG9jdW1lbnRvcy9kb2MtJHtpfS5wZGZgLFxuICAgICAgICAgICAgbWltZV90eXBlOiAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAgICAgICAgIHRhbWFuaG86IDEwMjQsXG4gICAgICAgICAgICBoYXNoOiBjcnlwdG8ucmFuZG9tQnl0ZXMoMzIpLnRvU3RyaW5nKCdoZXgnKSxcbiAgICAgICAgICAgIHNlbnNpdmVsOiBmYWxzZSxcbiAgICAgICAgICAgIGNyaXB0b2dyYWZhZG86IGZhbHNlLFxuICAgICAgICAgICAgdXN1YXJpb19pZDogJ3Rlc3QtdXNlci1pZCcsXG4gICAgICAgICAgfSksXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBhd2FpdCBkb2N1bWVudG9SZXBvc2l0b3J5LnNhdmUoZG9jdW1lbnRvcyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5nZXQoJy9hcGkvZG9jdW1lbnRvcycpXG4gICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7YXV0aFRva2VufWApXG4gICAgICAgIC5xdWVyeSh7IHBhZ2U6IDEsIGxpbWl0OiAzIH0pXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS50b3RhbCkudG9CZSg1KTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnBhZ2UpLnRvQmUoMSk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5saW1pdCkudG9CZSgzKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnRvdGFsUGFnZXMpLnRvQmUoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBmaWx0cmFyIGRvY3VtZW50b3MgcG9yIHRpcG8nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBkb2N1bWVudG9zID0gW1xuICAgICAgICBkb2N1bWVudG9SZXBvc2l0b3J5LmNyZWF0ZSh7XG4gICAgICAgICAgbm9tZTogJ0RvY3VtZW50byBDb250cmF0bycsXG4gICAgICAgICAgdGlwbzogJ2NvbnRyYXRvJyxcbiAgICAgICAgICBjYW1pbmhvOiAnZG9jdW1lbnRvcy9jb250cmF0by5wZGYnLFxuICAgICAgICAgIG1pbWVfdHlwZTogJ2FwcGxpY2F0aW9uL3BkZicsXG4gICAgICAgICAgdGFtYW5obzogMTAyNCxcbiAgICAgICAgICBoYXNoOiBjcnlwdG8ucmFuZG9tQnl0ZXMoMzIpLnRvU3RyaW5nKCdoZXgnKSxcbiAgICAgICAgICBzZW5zaXZlbDogZmFsc2UsXG4gICAgICAgICAgY3JpcHRvZ3JhZmFkbzogZmFsc2UsXG4gICAgICAgICAgdXN1YXJpb19pZDogJ3Rlc3QtdXNlci1pZCcsXG4gICAgICAgIH0pLFxuICAgICAgICBkb2N1bWVudG9SZXBvc2l0b3J5LmNyZWF0ZSh7XG4gICAgICAgICAgbm9tZTogJ0RvY3VtZW50byBQZXNzb2FsJyxcbiAgICAgICAgICB0aXBvOiAncGVzc29hbCcsXG4gICAgICAgICAgY2FtaW5obzogJ2RvY3VtZW50b3MvcGVzc29hbC5wZGYnLFxuICAgICAgICAgIG1pbWVfdHlwZTogJ2FwcGxpY2F0aW9uL3BkZicsXG4gICAgICAgICAgdGFtYW5obzogMTAyNCxcbiAgICAgICAgICBoYXNoOiBjcnlwdG8ucmFuZG9tQnl0ZXMoMzIpLnRvU3RyaW5nKCdoZXgnKSxcbiAgICAgICAgICBzZW5zaXZlbDogdHJ1ZSxcbiAgICAgICAgICBjcmlwdG9ncmFmYWRvOiB0cnVlLFxuICAgICAgICAgIGl2OiBCdWZmZXIuZnJvbSgnaXYtbW9jaycpLnRvU3RyaW5nKCdiYXNlNjQnKSxcbiAgICAgICAgICBhdXRoX3RhZzogQnVmZmVyLmZyb20oJ2F1dGgtdGFnLW1vY2snKS50b1N0cmluZygnYmFzZTY0JyksXG4gICAgICAgICAgdXN1YXJpb19pZDogJ3Rlc3QtdXNlci1pZCcsXG4gICAgICAgIH0pLFxuICAgICAgXTtcbiAgICAgIGF3YWl0IGRvY3VtZW50b1JlcG9zaXRvcnkuc2F2ZShkb2N1bWVudG9zKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLmdldCgnL2FwaS9kb2N1bWVudG9zJylcbiAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHthdXRoVG9rZW59YClcbiAgICAgICAgLnF1ZXJ5KHsgdGlwbzogJ3Blc3NvYWwnIH0pXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhWzBdLnRpcG8pLnRvQmUoJ3Blc3NvYWwnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGZpbHRyYXIgZG9jdW1lbnRvcyBwb3Igc2Vuc2liaWxpZGFkZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGRvY3VtZW50b3MgPSBbXG4gICAgICAgIGRvY3VtZW50b1JlcG9zaXRvcnkuY3JlYXRlKHtcbiAgICAgICAgICBub21lOiAnRG9jdW1lbnRvIE7Do28gU2Vuc8OtdmVsJyxcbiAgICAgICAgICB0aXBvOiAnY29udHJhdG8nLFxuICAgICAgICAgIGNhbWluaG86ICdkb2N1bWVudG9zL2NvbnRyYXRvLnBkZicsXG4gICAgICAgICAgbWltZV90eXBlOiAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAgICAgICB0YW1hbmhvOiAxMDI0LFxuICAgICAgICAgIGhhc2g6IGNyeXB0by5yYW5kb21CeXRlcygzMikudG9TdHJpbmcoJ2hleCcpLFxuICAgICAgICAgIHNlbnNpdmVsOiBmYWxzZSxcbiAgICAgICAgICBjcmlwdG9ncmFmYWRvOiBmYWxzZSxcbiAgICAgICAgICB1c3VhcmlvX2lkOiAndGVzdC11c2VyLWlkJyxcbiAgICAgICAgfSksXG4gICAgICAgIGRvY3VtZW50b1JlcG9zaXRvcnkuY3JlYXRlKHtcbiAgICAgICAgICBub21lOiAnRG9jdW1lbnRvIFNlbnPDrXZlbCcsXG4gICAgICAgICAgdGlwbzogJ3Blc3NvYWwnLFxuICAgICAgICAgIGNhbWluaG86ICdkb2N1bWVudG9zL3Blc3NvYWwucGRmJyxcbiAgICAgICAgICBtaW1lX3R5cGU6ICdhcHBsaWNhdGlvbi9wZGYnLFxuICAgICAgICAgIHRhbWFuaG86IDEwMjQsXG4gICAgICAgICAgaGFzaDogY3J5cHRvLnJhbmRvbUJ5dGVzKDMyKS50b1N0cmluZygnaGV4JyksXG4gICAgICAgICAgc2Vuc2l2ZWw6IHRydWUsXG4gICAgICAgICAgY3JpcHRvZ3JhZmFkbzogdHJ1ZSxcbiAgICAgICAgICBpdjogQnVmZmVyLmZyb20oJ2l2LW1vY2snKS50b1N0cmluZygnYmFzZTY0JyksXG4gICAgICAgICAgYXV0aF90YWc6IEJ1ZmZlci5mcm9tKCdhdXRoLXRhZy1tb2NrJykudG9TdHJpbmcoJ2Jhc2U2NCcpLFxuICAgICAgICAgIHVzdWFyaW9faWQ6ICd0ZXN0LXVzZXItaWQnLFxuICAgICAgICB9KSxcbiAgICAgIF07XG4gICAgICBhd2FpdCBkb2N1bWVudG9SZXBvc2l0b3J5LnNhdmUoZG9jdW1lbnRvcyk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5nZXQoJy9hcGkvZG9jdW1lbnRvcycpXG4gICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7YXV0aFRva2VufWApXG4gICAgICAgIC5xdWVyeSh7IHNlbnNpdmVsOiAndHJ1ZScgfSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGEpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGFbMF0uc2Vuc2l2ZWwpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdHRVQgL2FwaS9kb2N1bWVudG9zLzppZCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSByZXRvcm5hciB1bSBkb2N1bWVudG8gZXNwZWPDrWZpY28gcGVsbyBJRCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGRvY3VtZW50byA9IGRvY3VtZW50b1JlcG9zaXRvcnkuY3JlYXRlKHtcbiAgICAgICAgbm9tZTogJ0RvY3VtZW50byBwYXJhIEJ1c2NhJyxcbiAgICAgICAgdGlwbzogJ2NvbnRyYXRvJyxcbiAgICAgICAgY2FtaW5obzogJ2RvY3VtZW50b3MvYnVzY2EucGRmJyxcbiAgICAgICAgbWltZV90eXBlOiAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAgICAgdGFtYW5obzogMTAyNCxcbiAgICAgICAgaGFzaDogY3J5cHRvLnJhbmRvbUJ5dGVzKDMyKS50b1N0cmluZygnaGV4JyksXG4gICAgICAgIHNlbnNpdmVsOiBmYWxzZSxcbiAgICAgICAgY3JpcHRvZ3JhZmFkbzogZmFsc2UsXG4gICAgICAgIHVzdWFyaW9faWQ6ICd0ZXN0LXVzZXItaWQnLFxuICAgICAgfSk7XG4gICAgICBhd2FpdCBkb2N1bWVudG9SZXBvc2l0b3J5LnNhdmUoZG9jdW1lbnRvKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwLmdldEh0dHBTZXJ2ZXIoKSlcbiAgICAgICAgLmdldChgL2FwaS9kb2N1bWVudG9zLyR7ZG9jdW1lbnRvLmlkfWApXG4gICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7YXV0aFRva2VufWApXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5pZCkudG9CZShkb2N1bWVudG8uaWQpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubm9tZSkudG9CZSgnRG9jdW1lbnRvIHBhcmEgQnVzY2EnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJldG9ybmFyIDQwNCBwYXJhIElEIGluZXhpc3RlbnRlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5nZXQoJy9hcGkvZG9jdW1lbnRvcy9pZC1pbmV4aXN0ZW50ZScpXG4gICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7YXV0aFRva2VufWApXG4gICAgICAgIC5leHBlY3QoNDA0KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvYXBpL2RvY3VtZW50b3MvOmlkL2Rvd25sb2FkJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGJhaXhhciB1bSBkb2N1bWVudG8gbsOjbyBzZW5zw612ZWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBkb2N1bWVudG8gPSBkb2N1bWVudG9SZXBvc2l0b3J5LmNyZWF0ZSh7XG4gICAgICAgIG5vbWU6ICdEb2N1bWVudG8gcGFyYSBEb3dubG9hZCcsXG4gICAgICAgIHRpcG86ICdjb250cmF0bycsXG4gICAgICAgIGNhbWluaG86ICdkb2N1bWVudG9zL2Rvd25sb2FkLnBkZicsXG4gICAgICAgIG1pbWVfdHlwZTogJ2FwcGxpY2F0aW9uL3BkZicsXG4gICAgICAgIHRhbWFuaG86IDEwMjQsXG4gICAgICAgIGhhc2g6IGNyeXB0by5yYW5kb21CeXRlcygzMikudG9TdHJpbmcoJ2hleCcpLFxuICAgICAgICBzZW5zaXZlbDogZmFsc2UsXG4gICAgICAgIGNyaXB0b2dyYWZhZG86IGZhbHNlLFxuICAgICAgICB1c3VhcmlvX2lkOiAndGVzdC11c2VyLWlkJyxcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgZG9jdW1lbnRvUmVwb3NpdG9yeS5zYXZlKGRvY3VtZW50byk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5nZXQoYC9hcGkvZG9jdW1lbnRvcy8ke2RvY3VtZW50by5pZH0vZG93bmxvYWRgKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2F1dGhUb2tlbn1gKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmhlYWRlclsnY29udGVudC10eXBlJ10pLnRvQmUoJ2FwcGxpY2F0aW9uL3BkZicpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmhlYWRlclsnY29udGVudC1kaXNwb3NpdGlvbiddKS50b0NvbnRhaW4oJ2F0dGFjaG1lbnQnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5oZWFkZXJbJ2NvbnRlbnQtZGlzcG9zaXRpb24nXSkudG9Db250YWluKCdkb3dubG9hZC5wZGYnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0JlSW5zdGFuY2VPZihCdWZmZXIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgYmFpeGFyIGUgZGVzY3JpcHRvZ3JhZmFyIHVtIGRvY3VtZW50byBzZW5zw612ZWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBkb2N1bWVudG8gPSBkb2N1bWVudG9SZXBvc2l0b3J5LmNyZWF0ZSh7XG4gICAgICAgIG5vbWU6ICdEb2N1bWVudG8gU2Vuc8OtdmVsIHBhcmEgRG93bmxvYWQnLFxuICAgICAgICB0aXBvOiAncGVzc29hbCcsXG4gICAgICAgIGNhbWluaG86ICdkb2N1bWVudG9zL3NlbnNpdmVsLnBkZicsXG4gICAgICAgIG1pbWVfdHlwZTogJ2FwcGxpY2F0aW9uL3BkZicsXG4gICAgICAgIHRhbWFuaG86IDEwMjQsXG4gICAgICAgIGhhc2g6IGNyeXB0by5yYW5kb21CeXRlcygzMikudG9TdHJpbmcoJ2hleCcpLFxuICAgICAgICBzZW5zaXZlbDogdHJ1ZSxcbiAgICAgICAgY3JpcHRvZ3JhZmFkbzogdHJ1ZSxcbiAgICAgICAgaXY6IEJ1ZmZlci5mcm9tKCdpdi1tb2NrJykudG9TdHJpbmcoJ2Jhc2U2NCcpLFxuICAgICAgICBhdXRoX3RhZzogQnVmZmVyLmZyb20oJ2F1dGgtdGFnLW1vY2snKS50b1N0cmluZygnYmFzZTY0JyksXG4gICAgICAgIHVzdWFyaW9faWQ6ICd0ZXN0LXVzZXItaWQnLFxuICAgICAgfSk7XG4gICAgICBhd2FpdCBkb2N1bWVudG9SZXBvc2l0b3J5LnNhdmUoZG9jdW1lbnRvKTtcblxuICAgICAgLy8gRXNwaWFyIG8gQ3JpcHRvZ3JhZmlhU2VydmljZSBwYXJhIHZlcmlmaWNhciBzZSBhIGRlc2NyaXB0b2dyYWZpYSDDqSBjaGFtYWRhXG4gICAgICBjb25zdCBzcHlEZXNjcmlwdG9ncmFmYXIgPSBqZXN0XG4gICAgICAgIC5zcHlPbihjcmlwdG9ncmFmaWFTZXJ2aWNlLCAnZGVzY3JpcHRvZ3JhZmFyQnVmZmVyJylcbiAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoZGFkb3MsIGl2LCBhdXRoVGFnKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIEJ1ZmZlci5mcm9tKCdDb250ZcO6ZG8gZGVzY3JpcHRvZ3JhZmFkbyBtb2NrYWRvJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAuZ2V0KGAvYXBpL2RvY3VtZW50b3MvJHtkb2N1bWVudG8uaWR9L2Rvd25sb2FkYClcbiAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHthdXRoVG9rZW59YClcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChyZXNwb25zZS5oZWFkZXJbJ2NvbnRlbnQtdHlwZSddKS50b0JlKCdhcHBsaWNhdGlvbi9wZGYnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0JlSW5zdGFuY2VPZihCdWZmZXIpO1xuICAgICAgZXhwZWN0KHNweURlc2NyaXB0b2dyYWZhcikudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVxdWVyZXIgYXV0ZW50aWNhw6fDo28gcGFyYSBkb3dubG9hZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGRvY3VtZW50byA9IGRvY3VtZW50b1JlcG9zaXRvcnkuY3JlYXRlKHtcbiAgICAgICAgbm9tZTogJ0RvY3VtZW50byBwYXJhIERvd25sb2FkJyxcbiAgICAgICAgdGlwbzogJ2NvbnRyYXRvJyxcbiAgICAgICAgY2FtaW5obzogJ2RvY3VtZW50b3MvZG93bmxvYWQucGRmJyxcbiAgICAgICAgbWltZV90eXBlOiAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAgICAgdGFtYW5obzogMTAyNCxcbiAgICAgICAgaGFzaDogY3J5cHRvLnJhbmRvbUJ5dGVzKDMyKS50b1N0cmluZygnaGV4JyksXG4gICAgICAgIHNlbnNpdmVsOiBmYWxzZSxcbiAgICAgICAgY3JpcHRvZ3JhZmFkbzogZmFsc2UsXG4gICAgICAgIHVzdWFyaW9faWQ6ICd0ZXN0LXVzZXItaWQnLFxuICAgICAgfSk7XG4gICAgICBhd2FpdCBkb2N1bWVudG9SZXBvc2l0b3J5LnNhdmUoZG9jdW1lbnRvKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcC5nZXRIdHRwU2VydmVyKCkpXG4gICAgICAgIC5nZXQoYC9hcGkvZG9jdW1lbnRvcy8ke2RvY3VtZW50by5pZH0vZG93bmxvYWRgKVxuICAgICAgICAuZXhwZWN0KDQwMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdERUxFVEUgL2FwaS9kb2N1bWVudG9zLzppZCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBleGNsdWlyIHVtIGRvY3VtZW50bycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGRvY3VtZW50byA9IGRvY3VtZW50b1JlcG9zaXRvcnkuY3JlYXRlKHtcbiAgICAgICAgbm9tZTogJ0RvY3VtZW50byBwYXJhIEV4Y2x1c8OjbycsXG4gICAgICAgIHRpcG86ICdjb250cmF0bycsXG4gICAgICAgIGNhbWluaG86ICdkb2N1bWVudG9zL2V4Y2x1c2FvLnBkZicsXG4gICAgICAgIG1pbWVfdHlwZTogJ2FwcGxpY2F0aW9uL3BkZicsXG4gICAgICAgIHRhbWFuaG86IDEwMjQsXG4gICAgICAgIGhhc2g6IGNyeXB0by5yYW5kb21CeXRlcygzMikudG9TdHJpbmcoJ2hleCcpLFxuICAgICAgICBzZW5zaXZlbDogZmFsc2UsXG4gICAgICAgIGNyaXB0b2dyYWZhZG86IGZhbHNlLFxuICAgICAgICB1c3VhcmlvX2lkOiAndGVzdC11c2VyLWlkJyxcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgZG9jdW1lbnRvUmVwb3NpdG9yeS5zYXZlKGRvY3VtZW50byk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAuZGVsZXRlKGAvYXBpL2RvY3VtZW50b3MvJHtkb2N1bWVudG8uaWR9YClcbiAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHthdXRoVG9rZW59YClcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGNvbnN0IGRlbGV0ZWREb2MgPSBhd2FpdCBkb2N1bWVudG9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZTogeyBpZDogZG9jdW1lbnRvLmlkIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChkZWxldGVkRG9jKS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KG1pbmlvU2VydmljZS5yZW1vdmVyQXJxdWl2bykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdkb2N1bWVudG9zL2V4Y2x1c2FvLnBkZicsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgNDA0IGFvIHRlbnRhciBleGNsdWlyIGRvY3VtZW50byBpbmV4aXN0ZW50ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAuZGVsZXRlKCcvYXBpL2RvY3VtZW50b3MvaWQtaW5leGlzdGVudGUnKVxuICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2F1dGhUb2tlbn1gKVxuICAgICAgICAuZXhwZWN0KDQwNCk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXF1ZXJlciBhdXRlbnRpY2HDp8OjbyBwYXJhIGV4Y2x1c8OjbycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IGRvY3VtZW50byA9IGRvY3VtZW50b1JlcG9zaXRvcnkuY3JlYXRlKHtcbiAgICAgICAgbm9tZTogJ0RvY3VtZW50byBwYXJhIEV4Y2x1c8OjbycsXG4gICAgICAgIHRpcG86ICdjb250cmF0bycsXG4gICAgICAgIGNhbWluaG86ICdkb2N1bWVudG9zL2V4Y2x1c2FvLnBkZicsXG4gICAgICAgIG1pbWVfdHlwZTogJ2FwcGxpY2F0aW9uL3BkZicsXG4gICAgICAgIHRhbWFuaG86IDEwMjQsXG4gICAgICAgIGhhc2g6IGNyeXB0by5yYW5kb21CeXRlcygzMikudG9TdHJpbmcoJ2hleCcpLFxuICAgICAgICBzZW5zaXZlbDogZmFsc2UsXG4gICAgICAgIGNyaXB0b2dyYWZhZG86IGZhbHNlLFxuICAgICAgICB1c3VhcmlvX2lkOiAndGVzdC11c2VyLWlkJyxcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgZG9jdW1lbnRvUmVwb3NpdG9yeS5zYXZlKGRvY3VtZW50byk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgcmVxdWVzdChhcHAuZ2V0SHR0cFNlcnZlcigpKVxuICAgICAgICAuZGVsZXRlKGAvYXBpL2RvY3VtZW50b3MvJHtkb2N1bWVudG8uaWR9YClcbiAgICAgICAgLmV4cGVjdCg0MDEpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9