ed54c4a04f43658d97eeda0ea2ddc4e9
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var RenovacaoAutomaticaService_1;
var _a, _b, _c, _d, _e;
Object.defineProperty(exports, "__esModule", { value: true });
exports.RenovacaoAutomaticaService = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const configuracao_renovacao_entity_1 = require("../../../entities/configuracao-renovacao.entity");
const solicitacao_entity_1 = require("../../../entities/solicitacao.entity");
const workflow_solicitacao_service_1 = require("../../solicitacao/services/workflow-solicitacao.service");
const schedule_1 = require("@nestjs/schedule");
/**
 * Serviço de Renovação Automática
 *
 * Responsável por gerenciar as configurações de renovação automática de benefícios
 * e o processo de renovação automática mensal.
 */
let RenovacaoAutomaticaService = RenovacaoAutomaticaService_1 = class RenovacaoAutomaticaService {
    configuracaoRepository;
    solicitacaoRepository;
    workflowService;
    dataSource;
    logger = new common_1.Logger(RenovacaoAutomaticaService_1.name);
    constructor(configuracaoRepository, solicitacaoRepository, workflowService, dataSource) {
        this.configuracaoRepository = configuracaoRepository;
        this.solicitacaoRepository = solicitacaoRepository;
        this.workflowService = workflowService;
        this.dataSource = dataSource;
    }
    /**
     * Cria uma nova configuração de renovação automática
     * @param createConfiguracaoDto Dados da configuração
     * @param usuarioId ID do usuário que está criando a configuração
     * @returns Configuração criada
     */
    async create(createConfiguracaoDto, usuarioId) {
        try {
            // Verificar se já existe configuração para o tipo de benefício
            const configuracaoExistente = await this.configuracaoRepository.findOne({
                where: { tipo_beneficio_id: createConfiguracaoDto.tipo_beneficio_id },
            });
            if (configuracaoExistente) {
                throw new common_1.ConflictException('Já existe uma configuração de renovação para este tipo de benefício');
            }
            // Criar a configuração
            const novaConfiguracao = this.configuracaoRepository.create({
                ...createConfiguracaoDto,
                usuario_id: usuarioId,
                ativo: true,
            });
            return await this.configuracaoRepository.save(novaConfiguracao);
        }
        catch (error) {
            if (error instanceof common_1.ConflictException) {
                throw error;
            }
            this.logger.error(`Erro ao criar configuração de renovação: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao criar configuração de renovação');
        }
    }
    /**
     * Busca todas as configurações de renovação
     * @returns Lista de configurações
     */
    async findAll() {
        try {
            return this.configuracaoRepository.find({
                relations: ['tipo_beneficio'],
                order: { created_at: 'DESC' },
            });
        }
        catch (error) {
            this.logger.error(`Erro ao buscar configurações de renovação: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao buscar configurações de renovação');
        }
    }
    /**
     * Busca uma configuração de renovação pelo ID
     * @param id ID da configuração
     * @returns Configuração
     */
    async findById(id) {
        try {
            const configuracao = await this.configuracaoRepository.findOne({
                where: { id },
                relations: ['tipo_beneficio'],
            });
            if (!configuracao) {
                throw new common_1.NotFoundException('Configuração de renovação não encontrada');
            }
            return configuracao;
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            this.logger.error(`Erro ao buscar configuração de renovação: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao buscar configuração de renovação');
        }
    }
    /**
     * Busca uma configuração de renovação pelo tipo de benefício
     * @param tipoBeneficioId ID do tipo de benefício
     * @returns Configuração
     */
    async findByTipoBeneficio(tipoBeneficioId) {
        try {
            const configuracao = await this.configuracaoRepository.findOne({
                where: { tipo_beneficio_id: tipoBeneficioId },
                relations: ['tipo_beneficio'],
            });
            if (!configuracao) {
                throw new common_1.NotFoundException('Configuração de renovação não encontrada para este tipo de benefício');
            }
            return configuracao;
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            this.logger.error(`Erro ao buscar configuração de renovação por tipo de benefício: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao buscar configuração de renovação por tipo de benefício');
        }
    }
    /**
     * Atualiza uma configuração de renovação
     * @param id ID da configuração
     * @param updateConfiguracaoDto Dados para atualização
     * @returns Configuração atualizada
     */
    async update(id, updateConfiguracaoDto) {
        try {
            // Verificar se a configuração existe
            const configuracao = await this.configuracaoRepository.findOne({
                where: { id },
            });
            if (!configuracao) {
                throw new common_1.NotFoundException('Configuração de renovação não encontrada');
            }
            // Atualizar a configuração
            await this.configuracaoRepository.update(id, updateConfiguracaoDto);
            // Retornar a configuração atualizada
            return this.findById(id);
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            this.logger.error(`Erro ao atualizar configuração de renovação: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao atualizar configuração de renovação');
        }
    }
    /**
     * Remove uma configuração de renovação
     * @param id ID da configuração
     * @returns void
     */
    async remove(id) {
        try {
            // Verificar se a configuração existe
            const configuracao = await this.configuracaoRepository.findOne({
                where: { id },
            });
            if (!configuracao) {
                throw new common_1.NotFoundException('Configuração de renovação não encontrada');
            }
            // Remover a configuração
            await this.configuracaoRepository.remove(configuracao);
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            this.logger.error(`Erro ao remover configuração de renovação: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao remover configuração de renovação');
        }
    }
    /**
     * Ativa ou desativa uma configuração de renovação
     * @param id ID da configuração
     * @param ativo Status de ativação
     * @returns Configuração atualizada
     */
    async toggleAtivo(id, ativo) {
        try {
            // Verificar se a configuração existe
            const configuracao = await this.configuracaoRepository.findOne({
                where: { id },
            });
            if (!configuracao) {
                throw new common_1.NotFoundException('Configuração de renovação não encontrada');
            }
            // Atualizar o status de ativação
            await this.configuracaoRepository.update(id, { ativo });
            // Retornar a configuração atualizada
            return this.findById(id);
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            this.logger.error(`Erro ao atualizar status de ativação: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao atualizar status de ativação');
        }
    }
    /**
     * Configura a renovação automática para uma solicitação
     * @param solicitacaoId ID da solicitação
     * @param renovacaoAutomatica Flag indicando se a renovação automática está ativada
     * @param usuarioId ID do usuário que está configurando a renovação
     * @returns Solicitação atualizada
     */
    async configurarRenovacaoSolicitacao(solicitacaoId, renovacaoAutomatica, usuarioId) {
        try {
            // Verificar se a solicitação existe
            const solicitacao = await this.solicitacaoRepository.findOne({
                where: { id: solicitacaoId },
            });
            if (!solicitacao) {
                throw new common_1.NotFoundException('Solicitação de benefício não encontrada');
            }
            // Verificar se a solicitação está em um estado que permite renovação
            if (solicitacao.status !== solicitacao_entity_1.StatusSolicitacao.CONCLUIDA) {
                throw new common_1.BadRequestException('Apenas solicitações concluídas podem ser configuradas para renovação automática');
            }
            // Verificar se existe configuração de renovação para o tipo de benefício
            const configuracao = await this.configuracaoRepository.findOne({
                where: {
                    tipo_beneficio_id: solicitacao.tipo_beneficio_id,
                    ativo: true,
                },
            });
            if (!configuracao) {
                throw new common_1.BadRequestException('Não existe configuração de renovação ativa para este tipo de benefício');
            }
            if (!configuracao.renovacao_automatica) {
                throw new common_1.BadRequestException('A renovação automática não está habilitada para este tipo de benefício');
            }
            // Preparar os dados para atualização
            const updateData = {
                renovacao_automatica: renovacaoAutomatica,
            };
            // Adicionar a data da próxima renovação apenas se estiver ativada
            if (renovacaoAutomatica) {
                updateData.data_proxima_renovacao = this.calcularDataProximaRenovacao(configuracao.dias_antecedencia_renovacao);
            }
            else {
                // Usar SQL bruto para definir como NULL
                await this.dataSource
                    .createQueryBuilder()
                    .update(solicitacao_entity_1.Solicitacao)
                    .set({ renovacao_automatica: false })
                    .where('id = :id', { id: solicitacaoId })
                    .execute();
                await this.dataSource.query(`UPDATE solicitacao SET data_proxima_renovacao = NULL WHERE id = $1`, [solicitacaoId]);
                // Retornar mais cedo para evitar a segunda atualização
                const solicitacaoAtualizada = await this.solicitacaoRepository.findOne({
                    where: { id: solicitacaoId },
                });
                if (!solicitacaoAtualizada) {
                    throw new common_1.NotFoundException(`Solicitação com ID ${solicitacaoId} não encontrada após atualização`);
                }
                return solicitacaoAtualizada;
            }
            // Atualizar a solicitação se a renovação estiver ativada
            await this.solicitacaoRepository.update(solicitacaoId, updateData);
            // Retornar a solicitação atualizada
            const solicitacaoAtualizada = await this.solicitacaoRepository.findOne({
                where: { id: solicitacaoId },
            });
            if (!solicitacaoAtualizada) {
                throw new common_1.NotFoundException(`Solicitação com ID ${solicitacaoId} não encontrada após atualização`);
            }
            return solicitacaoAtualizada;
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException ||
                error instanceof common_1.BadRequestException) {
                throw error;
            }
            this.logger.error(`Erro ao configurar renovação automática: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao configurar renovação automática');
        }
    }
    /**
     * Calcula a data da próxima renovação
     * @param diasAntecedencia Dias de antecedência para a renovação
     * @returns Data da próxima renovação
     */
    calcularDataProximaRenovacao(diasAntecedencia) {
        const dataAtual = new Date();
        const dataProximaRenovacao = new Date(dataAtual);
        // Adicionar um mês à data atual
        dataProximaRenovacao.setMonth(dataProximaRenovacao.getMonth() + 1);
        // Subtrair os dias de antecedência
        dataProximaRenovacao.setDate(dataProximaRenovacao.getDate() - diasAntecedencia);
        return dataProximaRenovacao;
    }
    /**
     * Processa as renovações automáticas pendentes
     * Este método é executado automaticamente todos os dias à meia-noite
     */
    async processarRenovacoesAutomaticas() {
        this.logger.log('Iniciando processamento de renovações automáticas');
        const dataAtual = new Date();
        try {
            // Buscar solicitações com renovação automática ativada e data de renovação menor ou igual à data atual
            const solicitacoesPendentes = await this.solicitacaoRepository.find({
                where: {
                    renovacao_automatica: true,
                    data_proxima_renovacao: (0, typeorm_2.LessThanOrEqual)(dataAtual),
                    status: solicitacao_entity_1.StatusSolicitacao.CONCLUIDA,
                },
                relations: ['tipo_beneficio'],
            });
            this.logger.log(`Encontradas ${solicitacoesPendentes.length} solicitações pendentes de renovação`);
            for (const solicitacao of solicitacoesPendentes) {
                await this.processarRenovacaoSolicitacao(solicitacao);
            }
            this.logger.log('Processamento de renovações automáticas concluído');
        }
        catch (error) {
            this.logger.error(`Erro ao processar renovações automáticas: ${error.message}`, error.stack);
        }
    }
    /**
     * Processa a renovação de uma solicitação específica
     * @param solicitacao Solicitação a ser renovada
     */
    async processarRenovacaoSolicitacao(solicitacao) {
        const queryRunner = this.dataSource.createQueryRunner();
        await queryRunner.connect();
        await queryRunner.startTransaction();
        try {
            // Buscar configuração de renovação para o tipo de benefício
            const configuracao = await this.configuracaoRepository.findOne({
                where: {
                    tipo_beneficio_id: solicitacao.tipo_beneficio_id,
                    ativo: true,
                },
            });
            if (!configuracao || !configuracao.renovacao_automatica) {
                this.logger.warn(`Configuração de renovação não encontrada ou desativada para a solicitação ${solicitacao.id}`);
                return;
            }
            // Verificar se atingiu o número máximo de renovações
            const numeroMaximoRenovacoes = configuracao.numero_maximo_renovacoes || 0;
            if (numeroMaximoRenovacoes > 0 &&
                solicitacao.contador_renovacoes >= numeroMaximoRenovacoes) {
                this.logger.warn(`Solicitação ${solicitacao.id} atingiu o número máximo de renovações (${configuracao.numero_maximo_renovacoes})`);
                // Desativar renovação automática
                await queryRunner.manager.update(solicitacao_entity_1.Solicitacao, { id: solicitacao.id }, {
                    renovacao_automatica: false,
                    data_proxima_renovacao: undefined,
                });
                await queryRunner.commitTransaction();
                return;
            }
            // Criar nova solicitação como renovação
            const novaSolicitacao = this.solicitacaoRepository.create({
                tipo_beneficio_id: solicitacao.tipo_beneficio_id,
                dados_dinamicos: solicitacao.dados_dinamicos,
                observacoes: `Renovação automática da solicitação ${solicitacao.id}`,
                solicitacao_original_id: solicitacao.solicitacao_original_id || solicitacao.id,
                contador_renovacoes: solicitacao.contador_renovacoes + 1,
                renovacao_automatica: true,
            });
            // Definir o status inicial da nova solicitação
            if (configuracao.requer_aprovacao_renovacao) {
                novaSolicitacao.status = solicitacao_entity_1.StatusSolicitacao.PENDENTE;
            }
            else {
                novaSolicitacao.status = solicitacao_entity_1.StatusSolicitacao.APROVADA;
            }
            // Salvar a nova solicitação
            const novaSolicitacaoSalva = await queryRunner.manager.save(novaSolicitacao);
            // Calcular a data da próxima renovação
            const dataProximaRenovacao = this.calcularDataProximaRenovacao(configuracao.dias_antecedencia_renovacao);
            // Atualizar a solicitação original
            await queryRunner.manager.update(solicitacao_entity_1.Solicitacao, { id: solicitacao.id }, {
                data_proxima_renovacao: dataProximaRenovacao,
            });
            // Se não requer aprovação, avançar automaticamente para LIBERADA
            if (!configuracao.requer_aprovacao_renovacao) {
                await this.workflowService.liberarSolicitacao(novaSolicitacaoSalva.id, 'sistema');
            }
            this.logger.log(`Renovação automática processada com sucesso para a solicitação ${solicitacao.id}. Nova solicitação: ${novaSolicitacaoSalva.id}`);
            await queryRunner.commitTransaction();
        }
        catch (error) {
            await queryRunner.rollbackTransaction();
            this.logger.error(`Erro ao processar renovação da solicitação ${solicitacao.id}: ${error.message}`, error.stack);
        }
        finally {
            await queryRunner.release();
        }
    }
    /**
     * Verifica a configuração de renovação automática de uma solicitação
     * @param solicitacaoId ID da solicitação
     * @returns Informações sobre a configuração de renovação da solicitação
     */
    async verificarRenovacaoSolicitacao(solicitacaoId) {
        try {
            // Buscar solicitação
            const solicitacao = await this.solicitacaoRepository.findOne({
                where: { id: solicitacaoId },
                relations: ['tipo_beneficio'],
            });
            if (!solicitacao) {
                throw new common_1.NotFoundException('Solicitação não encontrada');
            }
            // Buscar configuração de renovação para o tipo de benefício
            const configuracao = await this.configuracaoRepository.findOne({
                where: { tipo_beneficio_id: solicitacao.tipo_beneficio_id },
            });
            // Preparar resposta
            return {
                renovacao_automatica: solicitacao.renovacao_automatica,
                contador_renovacoes: solicitacao.contador_renovacoes,
                data_proxima_renovacao: solicitacao.data_proxima_renovacao,
                solicitacao_original_id: solicitacao.solicitacao_original_id,
                configuracao_tipo_beneficio: configuracao
                    ? configuracao.renovacao_automatica && configuracao.ativo
                    : false,
                dias_antecedencia: configuracao
                    ? configuracao.dias_antecedencia_renovacao || null
                    : null,
                numero_maximo_renovacoes: configuracao
                    ? configuracao.numero_maximo_renovacoes || null
                    : null,
                requer_aprovacao: configuracao
                    ? configuracao.requer_aprovacao_renovacao
                    : null,
            };
        }
        catch (error) {
            if (error instanceof common_1.NotFoundException) {
                throw error;
            }
            this.logger.error(`Erro ao verificar configuração de renovação da solicitação ${solicitacaoId}: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao verificar configuração de renovação da solicitação');
        }
    }
    /**
     * Verifica e processa manualmente as renovações pendentes
     * @param usuarioId ID do usuário que está executando a verificação
     * @returns Número de solicitações renovadas
     */
    async verificarRenovacoesPendentes(usuarioId) {
        this.logger.log(`Verificação manual de renovações pendentes iniciada por ${usuarioId}`);
        const dataAtual = new Date();
        let renovacoesProcessadas = 0;
        try {
            // Buscar solicitações com renovação automática ativada e data de renovação menor ou igual à data atual
            const solicitacoesPendentes = await this.solicitacaoRepository.find({
                where: {
                    renovacao_automatica: true,
                    data_proxima_renovacao: (0, typeorm_2.LessThanOrEqual)(dataAtual),
                    status: solicitacao_entity_1.StatusSolicitacao.CONCLUIDA,
                },
                relations: ['tipo_beneficio'],
            });
            this.logger.log(`Encontradas ${solicitacoesPendentes.length} solicitações pendentes de renovação`);
            for (const solicitacao of solicitacoesPendentes) {
                await this.processarRenovacaoSolicitacao(solicitacao);
                renovacoesProcessadas++;
            }
            this.logger.log(`Verificação manual concluída. ${renovacoesProcessadas} renovações processadas.`);
            return renovacoesProcessadas;
        }
        catch (error) {
            this.logger.error(`Erro ao verificar renovações pendentes: ${error.message}`, error.stack);
            throw new common_1.InternalServerErrorException('Erro ao verificar renovações pendentes');
        }
    }
};
exports.RenovacaoAutomaticaService = RenovacaoAutomaticaService;
__decorate([
    (0, schedule_1.Cron)(schedule_1.CronExpression.EVERY_DAY_AT_MIDNIGHT),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_e = typeof Promise !== "undefined" && Promise) === "function" ? _e : Object)
], RenovacaoAutomaticaService.prototype, "processarRenovacoesAutomaticas", null);
exports.RenovacaoAutomaticaService = RenovacaoAutomaticaService = RenovacaoAutomaticaService_1 = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(configuracao_renovacao_entity_1.ConfiguracaoRenovacao)),
    __param(1, (0, typeorm_1.InjectRepository)(solicitacao_entity_1.Solicitacao)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object, typeof (_c = typeof workflow_solicitacao_service_1.WorkflowSolicitacaoService !== "undefined" && workflow_solicitacao_service_1.WorkflowSolicitacaoService) === "function" ? _c : Object, typeof (_d = typeof typeorm_2.DataSource !== "undefined" && typeorm_2.DataSource) === "function" ? _d : Object])
], RenovacaoAutomaticaService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGJlbmVmaWNpb1xcc2VydmljZXNcXHJlbm92YWNhby1hdXRvbWF0aWNhLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FPd0I7QUFDeEIsNkNBQW1EO0FBQ25ELHFDQUErRTtBQUMvRSxtR0FBd0Y7QUFDeEYsNkVBRzhDO0FBRzlDLDBHQUFxRztBQUNyRywrQ0FBd0Q7QUFFeEQ7Ozs7O0dBS0c7QUFFSSxJQUFNLDBCQUEwQixrQ0FBaEMsTUFBTSwwQkFBMEI7SUFLbEI7SUFFQTtJQUNBO0lBQ0E7SUFSRixNQUFNLEdBQUcsSUFBSSxlQUFNLENBQUMsNEJBQTBCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFdEUsWUFFbUIsc0JBQXlELEVBRXpELHFCQUE4QyxFQUM5QyxlQUEyQyxFQUMzQyxVQUFzQjtRQUp0QiwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQW1DO1FBRXpELDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBeUI7UUFDOUMsb0JBQWUsR0FBZixlQUFlLENBQTRCO1FBQzNDLGVBQVUsR0FBVixVQUFVLENBQVk7SUFDdEMsQ0FBQztJQUVKOzs7OztPQUtHO0lBQ0gsS0FBSyxDQUFDLE1BQU0sQ0FDVixxQkFBcUQsRUFDckQsU0FBaUI7UUFFakIsSUFBSSxDQUFDO1lBQ0gsK0RBQStEO1lBQy9ELE1BQU0scUJBQXFCLEdBQUcsTUFBTSxJQUFJLENBQUMsc0JBQXNCLENBQUMsT0FBTyxDQUFDO2dCQUN0RSxLQUFLLEVBQUUsRUFBRSxpQkFBaUIsRUFBRSxxQkFBcUIsQ0FBQyxpQkFBaUIsRUFBRTthQUN0RSxDQUFDLENBQUM7WUFFSCxJQUFJLHFCQUFxQixFQUFFLENBQUM7Z0JBQzFCLE1BQU0sSUFBSSwwQkFBaUIsQ0FDekIscUVBQXFFLENBQ3RFLENBQUM7WUFDSixDQUFDO1lBRUQsdUJBQXVCO1lBQ3ZC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LEtBQUssQ0FDWixDQUFDO1lBQ0YsTUFBTSxJQUFJLHFDQUE0QixDQUNwQyx3Q0FBd0MsQ0FDekMsQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0NBQ0YsQ0FBQTtBQXBwQlksZ0VBQTBCO0FBb1ovQjtJQURMLElBQUEsZUFBSSxFQUFDLHlCQUFjLENBQUMscUJBQXFCLENBQUM7Ozt3REFDSCxPQUFPLG9CQUFQLE9BQU87Z0ZBK0I5QztxQ0FuYlUsMEJBQTBCO0lBRHRDLElBQUEsbUJBQVUsR0FBRTtJQUtSLFdBQUEsSUFBQSwwQkFBZ0IsRUFBQyxxREFBcUIsQ0FBQyxDQUFBO0lBRXZDLFdBQUEsSUFBQSwwQkFBZ0IsRUFBQyxnQ0FBVyxDQUFDLENBQUE7eURBRFcsb0JBQVUsb0JBQVYsb0JBQVUsb0RBRVgsb0JBQVUsb0JBQVYsb0JBQVUsb0RBQ2hCLHlEQUEwQixvQkFBMUIseURBQTBCLG9EQUMvQixvQkFBVSxvQkFBVixvQkFBVTtHQVQ5QiwwQkFBMEIsQ0FvcEJ0QyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXGV1ZHJlXFxPbmVEcml2ZVxcRGVza3RvcFxcUHJvamV0b3NcXHBnYmVuXFxwZ2Jlbi1zZXJ2ZXJcXHNyY1xcbW9kdWxlc1xcYmVuZWZpY2lvXFxzZXJ2aWNlc1xccmVub3ZhY2FvLWF1dG9tYXRpY2Euc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBJbmplY3RhYmxlLFxuICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgQ29uZmxpY3RFeGNlcHRpb24sXG4gIEJhZFJlcXVlc3RFeGNlcHRpb24sXG4gIEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24sXG4gIExvZ2dlcixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgSW5qZWN0UmVwb3NpdG9yeSB9IGZyb20gJ0BuZXN0anMvdHlwZW9ybSc7XG5pbXBvcnQgeyBSZXBvc2l0b3J5LCBEYXRhU291cmNlLCBMZXNzVGhhbk9yRXF1YWwsIElzTnVsbCwgTm90IH0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQgeyBDb25maWd1cmFjYW9SZW5vdmFjYW8gfSBmcm9tICcuLi8uLi8uLi9lbnRpdGllcy9jb25maWd1cmFjYW8tcmVub3ZhY2FvLmVudGl0eSc7XG5pbXBvcnQge1xuICBTb2xpY2l0YWNhbyxcbiAgU3RhdHVzU29saWNpdGFjYW8sXG59IGZyb20gJy4uLy4uLy4uL2VudGl0aWVzL3NvbGljaXRhY2FvLmVudGl0eSc7XG5pbXBvcnQgeyBDcmVhdGVDb25maWd1cmFjYW9SZW5vdmFjYW9EdG8gfSBmcm9tICcuLi9kdG8vY3JlYXRlLWNvbmZpZ3VyYWNhby1yZW5vdmFjYW8uZHRvJztcbmltcG9ydCB7IFVwZGF0ZUNvbmZpZ3VyYWNhb1Jlbm92YWNhb0R0byB9IGZyb20gJy4uL2R0by91cGRhdGUtY29uZmlndXJhY2FvLXJlbm92YWNhby5kdG8nO1xuaW1wb3J0IHsgV29ya2Zsb3dTb2xpY2l0YWNhb1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zb2xpY2l0YWNhby9zZXJ2aWNlcy93b3JrZmxvdy1zb2xpY2l0YWNhby5zZXJ2aWNlJztcbmltcG9ydCB7IENyb24sIENyb25FeHByZXNzaW9uIH0gZnJvbSAnQG5lc3Rqcy9zY2hlZHVsZSc7XG5cbi8qKlxuICogU2VydmnDp28gZGUgUmVub3Zhw6fDo28gQXV0b23DoXRpY2FcbiAqXG4gKiBSZXNwb25zw6F2ZWwgcG9yIGdlcmVuY2lhciBhcyBjb25maWd1cmHDp8O1ZXMgZGUgcmVub3Zhw6fDo28gYXV0b23DoXRpY2EgZGUgYmVuZWbDrWNpb3NcbiAqIGUgbyBwcm9jZXNzbyBkZSByZW5vdmHDp8OjbyBhdXRvbcOhdGljYSBtZW5zYWwuXG4gKi9cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBSZW5vdmFjYW9BdXRvbWF0aWNhU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyID0gbmV3IExvZ2dlcihSZW5vdmFjYW9BdXRvbWF0aWNhU2VydmljZS5uYW1lKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBASW5qZWN0UmVwb3NpdG9yeShDb25maWd1cmFjYW9SZW5vdmFjYW8pXG4gICAgcHJpdmF0ZSByZWFkb25seSBjb25maWd1cmFjYW9SZXBvc2l0b3J5OiBSZXBvc2l0b3J5PENvbmZpZ3VyYWNhb1Jlbm92YWNhbz4sXG4gICAgQEluamVjdFJlcG9zaXRvcnkoU29saWNpdGFjYW8pXG4gICAgcHJpdmF0ZSByZWFkb25seSBzb2xpY2l0YWNhb1JlcG9zaXRvcnk6IFJlcG9zaXRvcnk8U29saWNpdGFjYW8+LFxuICAgIHByaXZhdGUgcmVhZG9ubHkgd29ya2Zsb3dTZXJ2aWNlOiBXb3JrZmxvd1NvbGljaXRhY2FvU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGRhdGFTb3VyY2U6IERhdGFTb3VyY2UsXG4gICkge31cblxuICAvKipcbiAgICogQ3JpYSB1bWEgbm92YSBjb25maWd1cmHDp8OjbyBkZSByZW5vdmHDp8OjbyBhdXRvbcOhdGljYVxuICAgKiBAcGFyYW0gY3JlYXRlQ29uZmlndXJhY2FvRHRvIERhZG9zIGRhIGNvbmZpZ3VyYcOnw6NvXG4gICAqIEBwYXJhbSB1c3VhcmlvSWQgSUQgZG8gdXN1w6FyaW8gcXVlIGVzdMOhIGNyaWFuZG8gYSBjb25maWd1cmHDp8Ojb1xuICAgKiBAcmV0dXJucyBDb25maWd1cmHDp8OjbyBjcmlhZGFcbiAgICovXG4gIGFzeW5jIGNyZWF0ZShcbiAgICBjcmVhdGVDb25maWd1cmFjYW9EdG86IENyZWF0ZUNvbmZpZ3VyYWNhb1Jlbm92YWNhb0R0byxcbiAgICB1c3VhcmlvSWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxDb25maWd1cmFjYW9SZW5vdmFjYW8+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVmVyaWZpY2FyIHNlIGrDoSBleGlzdGUgY29uZmlndXJhw6fDo28gcGFyYSBvIHRpcG8gZGUgYmVuZWbDrWNpb1xuICAgICAgY29uc3QgY29uZmlndXJhY2FvRXhpc3RlbnRlID0gYXdhaXQgdGhpcy5jb25maWd1cmFjYW9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZTogeyB0aXBvX2JlbmVmaWNpb19pZDogY3JlYXRlQ29uZmlndXJhY2FvRHRvLnRpcG9fYmVuZWZpY2lvX2lkIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKGNvbmZpZ3VyYWNhb0V4aXN0ZW50ZSkge1xuICAgICAgICB0aHJvdyBuZXcgQ29uZmxpY3RFeGNlcHRpb24oXG4gICAgICAgICAgJ0rDoSBleGlzdGUgdW1hIGNvbmZpZ3VyYcOnw6NvIGRlIHJlbm92YcOnw6NvIHBhcmEgZXN0ZSB0aXBvIGRlIGJlbmVmw61jaW8nLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBDcmlhciBhIGNvbmZpZ3VyYcOnw6NvXG4gICAgICBjb25zdCBub3ZhQ29uZmlndXJhY2FvID0gdGhpcy5jb25maWd1cmFjYW9SZXBvc2l0b3J5LmNyZWF0ZSh7XG4gICAgICAgIC4uLmNyZWF0ZUNvbmZpZ3VyYWNhb0R0byxcbiAgICAgICAgdXN1YXJpb19pZDogdXN1YXJpb0lkLFxuICAgICAgICBhdGl2bzogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5jb25maWd1cmFjYW9SZXBvc2l0b3J5LnNhdmUobm92YUNvbmZpZ3VyYWNhbyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIENvbmZsaWN0RXhjZXB0aW9uKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gY3JpYXIgY29uZmlndXJhw6fDo28gZGUgcmVub3Zhw6fDo286ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICBlcnJvci5zdGFjayxcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgJ0Vycm8gYW8gY3JpYXIgY29uZmlndXJhw6fDo28gZGUgcmVub3Zhw6fDo28nLFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQnVzY2EgdG9kYXMgYXMgY29uZmlndXJhw6fDtWVzIGRlIHJlbm92YcOnw6NvXG4gICAqIEByZXR1cm5zIExpc3RhIGRlIGNvbmZpZ3VyYcOnw7Vlc1xuICAgKi9cbiAgYXN5bmMgZmluZEFsbCgpOiBQcm9taXNlPENvbmZpZ3VyYWNhb1Jlbm92YWNhb1tdPiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB0aGlzLmNvbmZpZ3VyYWNhb1JlcG9zaXRvcnkuZmluZCh7XG4gICAgICAgIHJlbGF0aW9uczogWyd0aXBvX2JlbmVmaWNpbyddLFxuICAgICAgICBvcmRlcjogeyBjcmVhdGVkX2F0OiAnREVTQycgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gYnVzY2FyIGNvbmZpZ3VyYcOnw7VlcyBkZSByZW5vdmHDp8OjbzogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICAgIGVycm9yLnN0YWNrLFxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICAnRXJybyBhbyBidXNjYXIgY29uZmlndXJhw6fDtWVzIGRlIHJlbm92YcOnw6NvJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhIHVtYSBjb25maWd1cmHDp8OjbyBkZSByZW5vdmHDp8OjbyBwZWxvIElEXG4gICAqIEBwYXJhbSBpZCBJRCBkYSBjb25maWd1cmHDp8Ojb1xuICAgKiBAcmV0dXJucyBDb25maWd1cmHDp8Ojb1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8Q29uZmlndXJhY2FvUmVub3ZhY2FvPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbmZpZ3VyYWNhbyA9IGF3YWl0IHRoaXMuY29uZmlndXJhY2FvUmVwb3NpdG9yeS5maW5kT25lKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgICAgcmVsYXRpb25zOiBbJ3RpcG9fYmVuZWZpY2lvJ10sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFjb25maWd1cmFjYW8pIHtcbiAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdDb25maWd1cmHDp8OjbyBkZSByZW5vdmHDp8OjbyBuw6NvIGVuY29udHJhZGEnKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNvbmZpZ3VyYWNhbztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgTm90Rm91bmRFeGNlcHRpb24pIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJybyBhbyBidXNjYXIgY29uZmlndXJhw6fDo28gZGUgcmVub3Zhw6fDo286ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICBlcnJvci5zdGFjayxcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgJ0Vycm8gYW8gYnVzY2FyIGNvbmZpZ3VyYcOnw6NvIGRlIHJlbm92YcOnw6NvJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhIHVtYSBjb25maWd1cmHDp8OjbyBkZSByZW5vdmHDp8OjbyBwZWxvIHRpcG8gZGUgYmVuZWbDrWNpb1xuICAgKiBAcGFyYW0gdGlwb0JlbmVmaWNpb0lkIElEIGRvIHRpcG8gZGUgYmVuZWbDrWNpb1xuICAgKiBAcmV0dXJucyBDb25maWd1cmHDp8Ojb1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5VGlwb0JlbmVmaWNpbyhcbiAgICB0aXBvQmVuZWZpY2lvSWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxDb25maWd1cmFjYW9SZW5vdmFjYW8+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29uZmlndXJhY2FvID0gYXdhaXQgdGhpcy5jb25maWd1cmFjYW9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZTogeyB0aXBvX2JlbmVmaWNpb19pZDogdGlwb0JlbmVmaWNpb0lkIH0sXG4gICAgICAgIHJlbGF0aW9uczogWyd0aXBvX2JlbmVmaWNpbyddLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghY29uZmlndXJhY2FvKSB7XG4gICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihcbiAgICAgICAgICAnQ29uZmlndXJhw6fDo28gZGUgcmVub3Zhw6fDo28gbsOjbyBlbmNvbnRyYWRhIHBhcmEgZXN0ZSB0aXBvIGRlIGJlbmVmw61jaW8nLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gY29uZmlndXJhY2FvO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvIGFvIGJ1c2NhciBjb25maWd1cmHDp8OjbyBkZSByZW5vdmHDp8OjbyBwb3IgdGlwbyBkZSBiZW5lZsOtY2lvOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgZXJyb3Iuc3RhY2ssXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgICdFcnJvIGFvIGJ1c2NhciBjb25maWd1cmHDp8OjbyBkZSByZW5vdmHDp8OjbyBwb3IgdGlwbyBkZSBiZW5lZsOtY2lvJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEF0dWFsaXphIHVtYSBjb25maWd1cmHDp8OjbyBkZSByZW5vdmHDp8Ojb1xuICAgKiBAcGFyYW0gaWQgSUQgZGEgY29uZmlndXJhw6fDo29cbiAgICogQHBhcmFtIHVwZGF0ZUNvbmZpZ3VyYWNhb0R0byBEYWRvcyBwYXJhIGF0dWFsaXphw6fDo29cbiAgICogQHJldHVybnMgQ29uZmlndXJhw6fDo28gYXR1YWxpemFkYVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgdXBkYXRlQ29uZmlndXJhY2FvRHRvOiBVcGRhdGVDb25maWd1cmFjYW9SZW5vdmFjYW9EdG8sXG4gICk6IFByb21pc2U8Q29uZmlndXJhY2FvUmVub3ZhY2FvPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFZlcmlmaWNhciBzZSBhIGNvbmZpZ3VyYcOnw6NvIGV4aXN0ZVxuICAgICAgY29uc3QgY29uZmlndXJhY2FvID0gYXdhaXQgdGhpcy5jb25maWd1cmFjYW9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghY29uZmlndXJhY2FvKSB7XG4gICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignQ29uZmlndXJhw6fDo28gZGUgcmVub3Zhw6fDo28gbsOjbyBlbmNvbnRyYWRhJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEF0dWFsaXphciBhIGNvbmZpZ3VyYcOnw6NvXG4gICAgICBhd2FpdCB0aGlzLmNvbmZpZ3VyYWNhb1JlcG9zaXRvcnkudXBkYXRlKGlkLCB1cGRhdGVDb25maWd1cmFjYW9EdG8pO1xuXG4gICAgICAvLyBSZXRvcm5hciBhIGNvbmZpZ3VyYcOnw6NvIGF0dWFsaXphZGFcbiAgICAgIHJldHVybiB0aGlzLmZpbmRCeUlkKGlkKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgTm90Rm91bmRFeGNlcHRpb24pIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJybyBhbyBhdHVhbGl6YXIgY29uZmlndXJhw6fDo28gZGUgcmVub3Zhw6fDo286ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICBlcnJvci5zdGFjayxcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgJ0Vycm8gYW8gYXR1YWxpemFyIGNvbmZpZ3VyYcOnw6NvIGRlIHJlbm92YcOnw6NvJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSB1bWEgY29uZmlndXJhw6fDo28gZGUgcmVub3Zhw6fDo29cbiAgICogQHBhcmFtIGlkIElEIGRhIGNvbmZpZ3VyYcOnw6NvXG4gICAqIEByZXR1cm5zIHZvaWRcbiAgICovXG4gIGFzeW5jIHJlbW92ZShpZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFZlcmlmaWNhciBzZSBhIGNvbmZpZ3VyYcOnw6NvIGV4aXN0ZVxuICAgICAgY29uc3QgY29uZmlndXJhY2FvID0gYXdhaXQgdGhpcy5jb25maWd1cmFjYW9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghY29uZmlndXJhY2FvKSB7XG4gICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbignQ29uZmlndXJhw6fDo28gZGUgcmVub3Zhw6fDo28gbsOjbyBlbmNvbnRyYWRhJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlbW92ZXIgYSBjb25maWd1cmHDp8Ojb1xuICAgICAgYXdhaXQgdGhpcy5jb25maWd1cmFjYW9SZXBvc2l0b3J5LnJlbW92ZShjb25maWd1cmFjYW8pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbikge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvIGFvIHJlbW92ZXIgY29uZmlndXJhw6fDo28gZGUgcmVub3Zhw6fDo286ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICBlcnJvci5zdGFjayxcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbihcbiAgICAgICAgJ0Vycm8gYW8gcmVtb3ZlciBjb25maWd1cmHDp8OjbyBkZSByZW5vdmHDp8OjbycsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBdGl2YSBvdSBkZXNhdGl2YSB1bWEgY29uZmlndXJhw6fDo28gZGUgcmVub3Zhw6fDo29cbiAgICogQHBhcmFtIGlkIElEIGRhIGNvbmZpZ3VyYcOnw6NvXG4gICAqIEBwYXJhbSBhdGl2byBTdGF0dXMgZGUgYXRpdmHDp8Ojb1xuICAgKiBAcmV0dXJucyBDb25maWd1cmHDp8OjbyBhdHVhbGl6YWRhXG4gICAqL1xuICBhc3luYyB0b2dnbGVBdGl2byhcbiAgICBpZDogc3RyaW5nLFxuICAgIGF0aXZvOiBib29sZWFuLFxuICApOiBQcm9taXNlPENvbmZpZ3VyYWNhb1Jlbm92YWNhbz4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBWZXJpZmljYXIgc2UgYSBjb25maWd1cmHDp8OjbyBleGlzdGVcbiAgICAgIGNvbnN0IGNvbmZpZ3VyYWNhbyA9IGF3YWl0IHRoaXMuY29uZmlndXJhY2FvUmVwb3NpdG9yeS5maW5kT25lKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWNvbmZpZ3VyYWNhbykge1xuICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ0NvbmZpZ3VyYcOnw6NvIGRlIHJlbm92YcOnw6NvIG7Do28gZW5jb250cmFkYScpO1xuICAgICAgfVxuXG4gICAgICAvLyBBdHVhbGl6YXIgbyBzdGF0dXMgZGUgYXRpdmHDp8Ojb1xuICAgICAgYXdhaXQgdGhpcy5jb25maWd1cmFjYW9SZXBvc2l0b3J5LnVwZGF0ZShpZCwgeyBhdGl2byB9KTtcblxuICAgICAgLy8gUmV0b3JuYXIgYSBjb25maWd1cmHDp8OjbyBhdHVhbGl6YWRhXG4gICAgICByZXR1cm4gdGhpcy5maW5kQnlJZChpZCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIE5vdEZvdW5kRXhjZXB0aW9uKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gYXR1YWxpemFyIHN0YXR1cyBkZSBhdGl2YcOnw6NvOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgZXJyb3Iuc3RhY2ssXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgICdFcnJvIGFvIGF0dWFsaXphciBzdGF0dXMgZGUgYXRpdmHDp8OjbycsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb25maWd1cmEgYSByZW5vdmHDp8OjbyBhdXRvbcOhdGljYSBwYXJhIHVtYSBzb2xpY2l0YcOnw6NvXG4gICAqIEBwYXJhbSBzb2xpY2l0YWNhb0lkIElEIGRhIHNvbGljaXRhw6fDo29cbiAgICogQHBhcmFtIHJlbm92YWNhb0F1dG9tYXRpY2EgRmxhZyBpbmRpY2FuZG8gc2UgYSByZW5vdmHDp8OjbyBhdXRvbcOhdGljYSBlc3TDoSBhdGl2YWRhXG4gICAqIEBwYXJhbSB1c3VhcmlvSWQgSUQgZG8gdXN1w6FyaW8gcXVlIGVzdMOhIGNvbmZpZ3VyYW5kbyBhIHJlbm92YcOnw6NvXG4gICAqIEByZXR1cm5zIFNvbGljaXRhw6fDo28gYXR1YWxpemFkYVxuICAgKi9cbiAgYXN5bmMgY29uZmlndXJhclJlbm92YWNhb1NvbGljaXRhY2FvKFxuICAgIHNvbGljaXRhY2FvSWQ6IHN0cmluZyxcbiAgICByZW5vdmFjYW9BdXRvbWF0aWNhOiBib29sZWFuLFxuICAgIHVzdWFyaW9JZDogc3RyaW5nLFxuICApOiBQcm9taXNlPFNvbGljaXRhY2FvPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFZlcmlmaWNhciBzZSBhIHNvbGljaXRhw6fDo28gZXhpc3RlXG4gICAgICBjb25zdCBzb2xpY2l0YWNhbyA9IGF3YWl0IHRoaXMuc29saWNpdGFjYW9SZXBvc2l0b3J5LmZpbmRPbmUoe1xuICAgICAgICB3aGVyZTogeyBpZDogc29saWNpdGFjYW9JZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghc29saWNpdGFjYW8pIHtcbiAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCdTb2xpY2l0YcOnw6NvIGRlIGJlbmVmw61jaW8gbsOjbyBlbmNvbnRyYWRhJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZlcmlmaWNhciBzZSBhIHNvbGljaXRhw6fDo28gZXN0w6EgZW0gdW0gZXN0YWRvIHF1ZSBwZXJtaXRlIHJlbm92YcOnw6NvXG4gICAgICBpZiAoc29saWNpdGFjYW8uc3RhdHVzICE9PSBTdGF0dXNTb2xpY2l0YWNhby5DT05DTFVJREEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oXG4gICAgICAgICAgJ0FwZW5hcyBzb2xpY2l0YcOnw7VlcyBjb25jbHXDrWRhcyBwb2RlbSBzZXIgY29uZmlndXJhZGFzIHBhcmEgcmVub3Zhw6fDo28gYXV0b23DoXRpY2EnLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBWZXJpZmljYXIgc2UgZXhpc3RlIGNvbmZpZ3VyYcOnw6NvIGRlIHJlbm92YcOnw6NvIHBhcmEgbyB0aXBvIGRlIGJlbmVmw61jaW9cbiAgICAgIGNvbnN0IGNvbmZpZ3VyYWNhbyA9IGF3YWl0IHRoaXMuY29uZmlndXJhY2FvUmVwb3NpdG9yeS5maW5kT25lKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB0aXBvX2JlbmVmaWNpb19pZDogc29saWNpdGFjYW8udGlwb19iZW5lZmljaW9faWQsXG4gICAgICAgICAgYXRpdm86IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFjb25maWd1cmFjYW8pIHtcbiAgICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oXG4gICAgICAgICAgJ07Do28gZXhpc3RlIGNvbmZpZ3VyYcOnw6NvIGRlIHJlbm92YcOnw6NvIGF0aXZhIHBhcmEgZXN0ZSB0aXBvIGRlIGJlbmVmw61jaW8nLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWNvbmZpZ3VyYWNhby5yZW5vdmFjYW9fYXV0b21hdGljYSkge1xuICAgICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbihcbiAgICAgICAgICAnQSByZW5vdmHDp8OjbyBhdXRvbcOhdGljYSBuw6NvIGVzdMOhIGhhYmlsaXRhZGEgcGFyYSBlc3RlIHRpcG8gZGUgYmVuZWbDrWNpbycsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIFByZXBhcmFyIG9zIGRhZG9zIHBhcmEgYXR1YWxpemHDp8Ojb1xuICAgICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge1xuICAgICAgICByZW5vdmFjYW9fYXV0b21hdGljYTogcmVub3ZhY2FvQXV0b21hdGljYSxcbiAgICAgIH07XG5cbiAgICAgIC8vIEFkaWNpb25hciBhIGRhdGEgZGEgcHLDs3hpbWEgcmVub3Zhw6fDo28gYXBlbmFzIHNlIGVzdGl2ZXIgYXRpdmFkYVxuICAgICAgaWYgKHJlbm92YWNhb0F1dG9tYXRpY2EpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5kYXRhX3Byb3hpbWFfcmVub3ZhY2FvID0gdGhpcy5jYWxjdWxhckRhdGFQcm94aW1hUmVub3ZhY2FvKFxuICAgICAgICAgIGNvbmZpZ3VyYWNhby5kaWFzX2FudGVjZWRlbmNpYV9yZW5vdmFjYW8sXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBVc2FyIFNRTCBicnV0byBwYXJhIGRlZmluaXIgY29tbyBOVUxMXG4gICAgICAgIGF3YWl0IHRoaXMuZGF0YVNvdXJjZVxuICAgICAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoKVxuICAgICAgICAgIC51cGRhdGUoU29saWNpdGFjYW8pXG4gICAgICAgICAgLnNldCh7IHJlbm92YWNhb19hdXRvbWF0aWNhOiBmYWxzZSB9KVxuICAgICAgICAgIC53aGVyZSgnaWQgPSA6aWQnLCB7IGlkOiBzb2xpY2l0YWNhb0lkIH0pXG4gICAgICAgICAgLmV4ZWN1dGUoKTtcblxuICAgICAgICBhd2FpdCB0aGlzLmRhdGFTb3VyY2UucXVlcnkoXG4gICAgICAgICAgYFVQREFURSBzb2xpY2l0YWNhbyBTRVQgZGF0YV9wcm94aW1hX3Jlbm92YWNhbyA9IE5VTEwgV0hFUkUgaWQgPSAkMWAsXG4gICAgICAgICAgW3NvbGljaXRhY2FvSWRdLFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFJldG9ybmFyIG1haXMgY2VkbyBwYXJhIGV2aXRhciBhIHNlZ3VuZGEgYXR1YWxpemHDp8Ojb1xuICAgICAgICBjb25zdCBzb2xpY2l0YWNhb0F0dWFsaXphZGEgPSBhd2FpdCB0aGlzLnNvbGljaXRhY2FvUmVwb3NpdG9yeS5maW5kT25lKHtcbiAgICAgICAgICB3aGVyZTogeyBpZDogc29saWNpdGFjYW9JZCB9LFxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIXNvbGljaXRhY2FvQXR1YWxpemFkYSkge1xuICAgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihcbiAgICAgICAgICAgIGBTb2xpY2l0YcOnw6NvIGNvbSBJRCAke3NvbGljaXRhY2FvSWR9IG7Do28gZW5jb250cmFkYSBhcMOzcyBhdHVhbGl6YcOnw6NvYCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNvbGljaXRhY2FvQXR1YWxpemFkYTtcbiAgICAgIH1cblxuICAgICAgLy8gQXR1YWxpemFyIGEgc29saWNpdGHDp8OjbyBzZSBhIHJlbm92YcOnw6NvIGVzdGl2ZXIgYXRpdmFkYVxuICAgICAgYXdhaXQgdGhpcy5zb2xpY2l0YWNhb1JlcG9zaXRvcnkudXBkYXRlKHNvbGljaXRhY2FvSWQsIHVwZGF0ZURhdGEpO1xuXG4gICAgICAvLyBSZXRvcm5hciBhIHNvbGljaXRhw6fDo28gYXR1YWxpemFkYVxuICAgICAgY29uc3Qgc29saWNpdGFjYW9BdHVhbGl6YWRhID0gYXdhaXQgdGhpcy5zb2xpY2l0YWNhb1JlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBzb2xpY2l0YWNhb0lkIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFzb2xpY2l0YWNhb0F0dWFsaXphZGEpIHtcbiAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKFxuICAgICAgICAgIGBTb2xpY2l0YcOnw6NvIGNvbSBJRCAke3NvbGljaXRhY2FvSWR9IG7Do28gZW5jb250cmFkYSBhcMOzcyBhdHVhbGl6YcOnw6NvYCxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHNvbGljaXRhY2FvQXR1YWxpemFkYTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKFxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIE5vdEZvdW5kRXhjZXB0aW9uIHx8XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgQmFkUmVxdWVzdEV4Y2VwdGlvblxuICAgICAgKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gY29uZmlndXJhciByZW5vdmHDp8OjbyBhdXRvbcOhdGljYTogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICAgIGVycm9yLnN0YWNrLFxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKFxuICAgICAgICAnRXJybyBhbyBjb25maWd1cmFyIHJlbm92YcOnw6NvIGF1dG9tw6F0aWNhJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGEgYSBkYXRhIGRhIHByw7N4aW1hIHJlbm92YcOnw6NvXG4gICAqIEBwYXJhbSBkaWFzQW50ZWNlZGVuY2lhIERpYXMgZGUgYW50ZWNlZMOqbmNpYSBwYXJhIGEgcmVub3Zhw6fDo29cbiAgICogQHJldHVybnMgRGF0YSBkYSBwcsOzeGltYSByZW5vdmHDp8Ojb1xuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhckRhdGFQcm94aW1hUmVub3ZhY2FvKGRpYXNBbnRlY2VkZW5jaWE6IG51bWJlcik6IERhdGUge1xuICAgIGNvbnN0IGRhdGFBdHVhbCA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgZGF0YVByb3hpbWFSZW5vdmFjYW8gPSBuZXcgRGF0ZShkYXRhQXR1YWwpO1xuXG4gICAgLy8gQWRpY2lvbmFyIHVtIG3DqnMgw6AgZGF0YSBhdHVhbFxuICAgIGRhdGFQcm94aW1hUmVub3ZhY2FvLnNldE1vbnRoKGRhdGFQcm94aW1hUmVub3ZhY2FvLmdldE1vbnRoKCkgKyAxKTtcblxuICAgIC8vIFN1YnRyYWlyIG9zIGRpYXMgZGUgYW50ZWNlZMOqbmNpYVxuICAgIGRhdGFQcm94aW1hUmVub3ZhY2FvLnNldERhdGUoXG4gICAgICBkYXRhUHJveGltYVJlbm92YWNhby5nZXREYXRlKCkgLSBkaWFzQW50ZWNlZGVuY2lhLFxuICAgICk7XG5cbiAgICByZXR1cm4gZGF0YVByb3hpbWFSZW5vdmFjYW87XG4gIH1cblxuICAvKipcbiAgICogUHJvY2Vzc2EgYXMgcmVub3Zhw6fDtWVzIGF1dG9tw6F0aWNhcyBwZW5kZW50ZXNcbiAgICogRXN0ZSBtw6l0b2RvIMOpIGV4ZWN1dGFkbyBhdXRvbWF0aWNhbWVudGUgdG9kb3Mgb3MgZGlhcyDDoCBtZWlhLW5vaXRlXG4gICAqL1xuICBAQ3JvbihDcm9uRXhwcmVzc2lvbi5FVkVSWV9EQVlfQVRfTUlETklHSFQpXG4gIGFzeW5jIHByb2Nlc3NhclJlbm92YWNvZXNBdXRvbWF0aWNhcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmxvZ2dlci5sb2coJ0luaWNpYW5kbyBwcm9jZXNzYW1lbnRvIGRlIHJlbm92YcOnw7VlcyBhdXRvbcOhdGljYXMnKTtcblxuICAgIGNvbnN0IGRhdGFBdHVhbCA9IG5ldyBEYXRlKCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQnVzY2FyIHNvbGljaXRhw6fDtWVzIGNvbSByZW5vdmHDp8OjbyBhdXRvbcOhdGljYSBhdGl2YWRhIGUgZGF0YSBkZSByZW5vdmHDp8OjbyBtZW5vciBvdSBpZ3VhbCDDoCBkYXRhIGF0dWFsXG4gICAgICBjb25zdCBzb2xpY2l0YWNvZXNQZW5kZW50ZXMgPSBhd2FpdCB0aGlzLnNvbGljaXRhY2FvUmVwb3NpdG9yeS5maW5kKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICByZW5vdmFjYW9fYXV0b21hdGljYTogdHJ1ZSxcbiAgICAgICAgICBkYXRhX3Byb3hpbWFfcmVub3ZhY2FvOiBMZXNzVGhhbk9yRXF1YWwoZGF0YUF0dWFsKSxcbiAgICAgICAgICBzdGF0dXM6IFN0YXR1c1NvbGljaXRhY2FvLkNPTkNMVUlEQSxcbiAgICAgICAgfSxcbiAgICAgICAgcmVsYXRpb25zOiBbJ3RpcG9fYmVuZWZpY2lvJ10sXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgICBgRW5jb250cmFkYXMgJHtzb2xpY2l0YWNvZXNQZW5kZW50ZXMubGVuZ3RofSBzb2xpY2l0YcOnw7VlcyBwZW5kZW50ZXMgZGUgcmVub3Zhw6fDo29gLFxuICAgICAgKTtcblxuICAgICAgZm9yIChjb25zdCBzb2xpY2l0YWNhbyBvZiBzb2xpY2l0YWNvZXNQZW5kZW50ZXMpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5wcm9jZXNzYXJSZW5vdmFjYW9Tb2xpY2l0YWNhbyhzb2xpY2l0YWNhbyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nZ2VyLmxvZygnUHJvY2Vzc2FtZW50byBkZSByZW5vdmHDp8O1ZXMgYXV0b23DoXRpY2FzIGNvbmNsdcOtZG8nKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvIGFvIHByb2Nlc3NhciByZW5vdmHDp8O1ZXMgYXV0b23DoXRpY2FzOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgZXJyb3Iuc3RhY2ssXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNzYSBhIHJlbm92YcOnw6NvIGRlIHVtYSBzb2xpY2l0YcOnw6NvIGVzcGVjw61maWNhXG4gICAqIEBwYXJhbSBzb2xpY2l0YWNhbyBTb2xpY2l0YcOnw6NvIGEgc2VyIHJlbm92YWRhXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NhclJlbm92YWNhb1NvbGljaXRhY2FvKFxuICAgIHNvbGljaXRhY2FvOiBTb2xpY2l0YWNhbyxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgcXVlcnlSdW5uZXIgPSB0aGlzLmRhdGFTb3VyY2UuY3JlYXRlUXVlcnlSdW5uZXIoKTtcbiAgICBhd2FpdCBxdWVyeVJ1bm5lci5jb25uZWN0KCk7XG4gICAgYXdhaXQgcXVlcnlSdW5uZXIuc3RhcnRUcmFuc2FjdGlvbigpO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEJ1c2NhciBjb25maWd1cmHDp8OjbyBkZSByZW5vdmHDp8OjbyBwYXJhIG8gdGlwbyBkZSBiZW5lZsOtY2lvXG4gICAgICBjb25zdCBjb25maWd1cmFjYW8gPSBhd2FpdCB0aGlzLmNvbmZpZ3VyYWNhb1JlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgdGlwb19iZW5lZmljaW9faWQ6IHNvbGljaXRhY2FvLnRpcG9fYmVuZWZpY2lvX2lkLFxuICAgICAgICAgIGF0aXZvOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghY29uZmlndXJhY2FvIHx8ICFjb25maWd1cmFjYW8ucmVub3ZhY2FvX2F1dG9tYXRpY2EpIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybihcbiAgICAgICAgICBgQ29uZmlndXJhw6fDo28gZGUgcmVub3Zhw6fDo28gbsOjbyBlbmNvbnRyYWRhIG91IGRlc2F0aXZhZGEgcGFyYSBhIHNvbGljaXRhw6fDo28gJHtzb2xpY2l0YWNhby5pZH1gLFxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIFZlcmlmaWNhciBzZSBhdGluZ2l1IG8gbsO6bWVybyBtw6F4aW1vIGRlIHJlbm92YcOnw7Vlc1xuICAgICAgY29uc3QgbnVtZXJvTWF4aW1vUmVub3ZhY29lcyA9IGNvbmZpZ3VyYWNhby5udW1lcm9fbWF4aW1vX3Jlbm92YWNvZXMgfHwgMDtcbiAgICAgIGlmIChcbiAgICAgICAgbnVtZXJvTWF4aW1vUmVub3ZhY29lcyA+IDAgJiZcbiAgICAgICAgc29saWNpdGFjYW8uY29udGFkb3JfcmVub3ZhY29lcyA+PSBudW1lcm9NYXhpbW9SZW5vdmFjb2VzXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5sb2dnZXIud2FybihcbiAgICAgICAgICBgU29saWNpdGHDp8OjbyAke3NvbGljaXRhY2FvLmlkfSBhdGluZ2l1IG8gbsO6bWVybyBtw6F4aW1vIGRlIHJlbm92YcOnw7VlcyAoJHtjb25maWd1cmFjYW8ubnVtZXJvX21heGltb19yZW5vdmFjb2VzfSlgLFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIERlc2F0aXZhciByZW5vdmHDp8OjbyBhdXRvbcOhdGljYVxuICAgICAgICBhd2FpdCBxdWVyeVJ1bm5lci5tYW5hZ2VyLnVwZGF0ZShcbiAgICAgICAgICBTb2xpY2l0YWNhbyxcbiAgICAgICAgICB7IGlkOiBzb2xpY2l0YWNhby5pZCB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJlbm92YWNhb19hdXRvbWF0aWNhOiBmYWxzZSxcbiAgICAgICAgICAgIGRhdGFfcHJveGltYV9yZW5vdmFjYW86IHVuZGVmaW5lZCxcbiAgICAgICAgICB9LFxuICAgICAgICApO1xuXG4gICAgICAgIGF3YWl0IHF1ZXJ5UnVubmVyLmNvbW1pdFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JpYXIgbm92YSBzb2xpY2l0YcOnw6NvIGNvbW8gcmVub3Zhw6fDo29cbiAgICAgIGNvbnN0IG5vdmFTb2xpY2l0YWNhbyA9IHRoaXMuc29saWNpdGFjYW9SZXBvc2l0b3J5LmNyZWF0ZSh7XG4gICAgICAgIHRpcG9fYmVuZWZpY2lvX2lkOiBzb2xpY2l0YWNhby50aXBvX2JlbmVmaWNpb19pZCxcbiAgICAgICAgZGFkb3NfZGluYW1pY29zOiBzb2xpY2l0YWNhby5kYWRvc19kaW5hbWljb3MsXG4gICAgICAgIG9ic2VydmFjb2VzOiBgUmVub3Zhw6fDo28gYXV0b23DoXRpY2EgZGEgc29saWNpdGHDp8OjbyAke3NvbGljaXRhY2FvLmlkfWAsXG4gICAgICAgIHNvbGljaXRhY2FvX29yaWdpbmFsX2lkOlxuICAgICAgICAgIHNvbGljaXRhY2FvLnNvbGljaXRhY2FvX29yaWdpbmFsX2lkIHx8IHNvbGljaXRhY2FvLmlkLFxuICAgICAgICBjb250YWRvcl9yZW5vdmFjb2VzOiBzb2xpY2l0YWNhby5jb250YWRvcl9yZW5vdmFjb2VzICsgMSxcbiAgICAgICAgcmVub3ZhY2FvX2F1dG9tYXRpY2E6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgLy8gRGVmaW5pciBvIHN0YXR1cyBpbmljaWFsIGRhIG5vdmEgc29saWNpdGHDp8Ojb1xuICAgICAgaWYgKGNvbmZpZ3VyYWNhby5yZXF1ZXJfYXByb3ZhY2FvX3Jlbm92YWNhbykge1xuICAgICAgICBub3ZhU29saWNpdGFjYW8uc3RhdHVzID0gU3RhdHVzU29saWNpdGFjYW8uUEVOREVOVEU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBub3ZhU29saWNpdGFjYW8uc3RhdHVzID0gU3RhdHVzU29saWNpdGFjYW8uQVBST1ZBREE7XG4gICAgICB9XG5cbiAgICAgIC8vIFNhbHZhciBhIG5vdmEgc29saWNpdGHDp8Ojb1xuICAgICAgY29uc3Qgbm92YVNvbGljaXRhY2FvU2FsdmEgPVxuICAgICAgICBhd2FpdCBxdWVyeVJ1bm5lci5tYW5hZ2VyLnNhdmUobm92YVNvbGljaXRhY2FvKTtcblxuICAgICAgLy8gQ2FsY3VsYXIgYSBkYXRhIGRhIHByw7N4aW1hIHJlbm92YcOnw6NvXG4gICAgICBjb25zdCBkYXRhUHJveGltYVJlbm92YWNhbyA9IHRoaXMuY2FsY3VsYXJEYXRhUHJveGltYVJlbm92YWNhbyhcbiAgICAgICAgY29uZmlndXJhY2FvLmRpYXNfYW50ZWNlZGVuY2lhX3Jlbm92YWNhbyxcbiAgICAgICk7XG5cbiAgICAgIC8vIEF0dWFsaXphciBhIHNvbGljaXRhw6fDo28gb3JpZ2luYWxcbiAgICAgIGF3YWl0IHF1ZXJ5UnVubmVyLm1hbmFnZXIudXBkYXRlKFxuICAgICAgICBTb2xpY2l0YWNhbyxcbiAgICAgICAgeyBpZDogc29saWNpdGFjYW8uaWQgfSxcbiAgICAgICAge1xuICAgICAgICAgIGRhdGFfcHJveGltYV9yZW5vdmFjYW86IGRhdGFQcm94aW1hUmVub3ZhY2FvLFxuICAgICAgICB9LFxuICAgICAgKTtcblxuICAgICAgLy8gU2UgbsOjbyByZXF1ZXIgYXByb3Zhw6fDo28sIGF2YW7Dp2FyIGF1dG9tYXRpY2FtZW50ZSBwYXJhIExJQkVSQURBXG4gICAgICBpZiAoIWNvbmZpZ3VyYWNhby5yZXF1ZXJfYXByb3ZhY2FvX3Jlbm92YWNhbykge1xuICAgICAgICBhd2FpdCB0aGlzLndvcmtmbG93U2VydmljZS5saWJlcmFyU29saWNpdGFjYW8oXG4gICAgICAgICAgbm92YVNvbGljaXRhY2FvU2FsdmEuaWQsXG4gICAgICAgICAgJ3Npc3RlbWEnLCAvLyBJRCBkbyBzaXN0ZW1hIGNvbW8gdXN1w6FyaW9cbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgICBgUmVub3Zhw6fDo28gYXV0b23DoXRpY2EgcHJvY2Vzc2FkYSBjb20gc3VjZXNzbyBwYXJhIGEgc29saWNpdGHDp8OjbyAke3NvbGljaXRhY2FvLmlkfS4gTm92YSBzb2xpY2l0YcOnw6NvOiAke25vdmFTb2xpY2l0YWNhb1NhbHZhLmlkfWAsXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBxdWVyeVJ1bm5lci5jb21taXRUcmFuc2FjdGlvbigpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBhd2FpdCBxdWVyeVJ1bm5lci5yb2xsYmFja1RyYW5zYWN0aW9uKCk7XG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihcbiAgICAgICAgYEVycm8gYW8gcHJvY2Vzc2FyIHJlbm92YcOnw6NvIGRhIHNvbGljaXRhw6fDo28gJHtzb2xpY2l0YWNhby5pZH06ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICBlcnJvci5zdGFjayxcbiAgICAgICk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGF3YWl0IHF1ZXJ5UnVubmVyLnJlbGVhc2UoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmVyaWZpY2EgYSBjb25maWd1cmHDp8OjbyBkZSByZW5vdmHDp8OjbyBhdXRvbcOhdGljYSBkZSB1bWEgc29saWNpdGHDp8Ojb1xuICAgKiBAcGFyYW0gc29saWNpdGFjYW9JZCBJRCBkYSBzb2xpY2l0YcOnw6NvXG4gICAqIEByZXR1cm5zIEluZm9ybWHDp8O1ZXMgc29icmUgYSBjb25maWd1cmHDp8OjbyBkZSByZW5vdmHDp8OjbyBkYSBzb2xpY2l0YcOnw6NvXG4gICAqL1xuICBhc3luYyB2ZXJpZmljYXJSZW5vdmFjYW9Tb2xpY2l0YWNhbyhzb2xpY2l0YWNhb0lkOiBzdHJpbmcpOiBQcm9taXNlPHtcbiAgICByZW5vdmFjYW9fYXV0b21hdGljYTogYm9vbGVhbjtcbiAgICBjb250YWRvcl9yZW5vdmFjb2VzOiBudW1iZXI7XG4gICAgZGF0YV9wcm94aW1hX3Jlbm92YWNhbzogRGF0ZSB8IG51bGw7XG4gICAgc29saWNpdGFjYW9fb3JpZ2luYWxfaWQ6IHN0cmluZyB8IG51bGw7XG4gICAgY29uZmlndXJhY2FvX3RpcG9fYmVuZWZpY2lvOiBib29sZWFuO1xuICAgIGRpYXNfYW50ZWNlZGVuY2lhOiBudW1iZXIgfCBudWxsO1xuICAgIG51bWVyb19tYXhpbW9fcmVub3ZhY29lczogbnVtYmVyIHwgbnVsbDtcbiAgICByZXF1ZXJfYXByb3ZhY2FvOiBib29sZWFuIHwgbnVsbDtcbiAgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBCdXNjYXIgc29saWNpdGHDp8Ojb1xuICAgICAgY29uc3Qgc29saWNpdGFjYW8gPSBhd2FpdCB0aGlzLnNvbGljaXRhY2FvUmVwb3NpdG9yeS5maW5kT25lKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHNvbGljaXRhY2FvSWQgfSxcbiAgICAgICAgcmVsYXRpb25zOiBbJ3RpcG9fYmVuZWZpY2lvJ10sXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFzb2xpY2l0YWNhbykge1xuICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oJ1NvbGljaXRhw6fDo28gbsOjbyBlbmNvbnRyYWRhJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEJ1c2NhciBjb25maWd1cmHDp8OjbyBkZSByZW5vdmHDp8OjbyBwYXJhIG8gdGlwbyBkZSBiZW5lZsOtY2lvXG4gICAgICBjb25zdCBjb25maWd1cmFjYW8gPSBhd2FpdCB0aGlzLmNvbmZpZ3VyYWNhb1JlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICAgIHdoZXJlOiB7IHRpcG9fYmVuZWZpY2lvX2lkOiBzb2xpY2l0YWNhby50aXBvX2JlbmVmaWNpb19pZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFByZXBhcmFyIHJlc3Bvc3RhXG4gICAgICByZXR1cm4ge1xuICAgICAgICByZW5vdmFjYW9fYXV0b21hdGljYTogc29saWNpdGFjYW8ucmVub3ZhY2FvX2F1dG9tYXRpY2EsXG4gICAgICAgIGNvbnRhZG9yX3Jlbm92YWNvZXM6IHNvbGljaXRhY2FvLmNvbnRhZG9yX3Jlbm92YWNvZXMsXG4gICAgICAgIGRhdGFfcHJveGltYV9yZW5vdmFjYW86IHNvbGljaXRhY2FvLmRhdGFfcHJveGltYV9yZW5vdmFjYW8sXG4gICAgICAgIHNvbGljaXRhY2FvX29yaWdpbmFsX2lkOiBzb2xpY2l0YWNhby5zb2xpY2l0YWNhb19vcmlnaW5hbF9pZCxcbiAgICAgICAgY29uZmlndXJhY2FvX3RpcG9fYmVuZWZpY2lvOiBjb25maWd1cmFjYW9cbiAgICAgICAgICA/IGNvbmZpZ3VyYWNhby5yZW5vdmFjYW9fYXV0b21hdGljYSAmJiBjb25maWd1cmFjYW8uYXRpdm9cbiAgICAgICAgICA6IGZhbHNlLFxuICAgICAgICBkaWFzX2FudGVjZWRlbmNpYTogY29uZmlndXJhY2FvXG4gICAgICAgICAgPyBjb25maWd1cmFjYW8uZGlhc19hbnRlY2VkZW5jaWFfcmVub3ZhY2FvIHx8IG51bGxcbiAgICAgICAgICA6IG51bGwsXG4gICAgICAgIG51bWVyb19tYXhpbW9fcmVub3ZhY29lczogY29uZmlndXJhY2FvXG4gICAgICAgICAgPyBjb25maWd1cmFjYW8ubnVtZXJvX21heGltb19yZW5vdmFjb2VzIHx8IG51bGxcbiAgICAgICAgICA6IG51bGwsXG4gICAgICAgIHJlcXVlcl9hcHJvdmFjYW86IGNvbmZpZ3VyYWNhb1xuICAgICAgICAgID8gY29uZmlndXJhY2FvLnJlcXVlcl9hcHJvdmFjYW9fcmVub3ZhY2FvXG4gICAgICAgICAgOiBudWxsLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgTm90Rm91bmRFeGNlcHRpb24pIHtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFxuICAgICAgICBgRXJybyBhbyB2ZXJpZmljYXIgY29uZmlndXJhw6fDo28gZGUgcmVub3Zhw6fDo28gZGEgc29saWNpdGHDp8OjbyAke3NvbGljaXRhY2FvSWR9OiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgZXJyb3Iuc3RhY2ssXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgICdFcnJvIGFvIHZlcmlmaWNhciBjb25maWd1cmHDp8OjbyBkZSByZW5vdmHDp8OjbyBkYSBzb2xpY2l0YcOnw6NvJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWNhIGUgcHJvY2Vzc2EgbWFudWFsbWVudGUgYXMgcmVub3Zhw6fDtWVzIHBlbmRlbnRlc1xuICAgKiBAcGFyYW0gdXN1YXJpb0lkIElEIGRvIHVzdcOhcmlvIHF1ZSBlc3TDoSBleGVjdXRhbmRvIGEgdmVyaWZpY2HDp8Ojb1xuICAgKiBAcmV0dXJucyBOw7ptZXJvIGRlIHNvbGljaXRhw6fDtWVzIHJlbm92YWRhc1xuICAgKi9cbiAgYXN5bmMgdmVyaWZpY2FyUmVub3ZhY29lc1BlbmRlbnRlcyh1c3VhcmlvSWQ6IHN0cmluZyk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgYFZlcmlmaWNhw6fDo28gbWFudWFsIGRlIHJlbm92YcOnw7VlcyBwZW5kZW50ZXMgaW5pY2lhZGEgcG9yICR7dXN1YXJpb0lkfWAsXG4gICAgKTtcblxuICAgIGNvbnN0IGRhdGFBdHVhbCA9IG5ldyBEYXRlKCk7XG4gICAgbGV0IHJlbm92YWNvZXNQcm9jZXNzYWRhcyA9IDA7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQnVzY2FyIHNvbGljaXRhw6fDtWVzIGNvbSByZW5vdmHDp8OjbyBhdXRvbcOhdGljYSBhdGl2YWRhIGUgZGF0YSBkZSByZW5vdmHDp8OjbyBtZW5vciBvdSBpZ3VhbCDDoCBkYXRhIGF0dWFsXG4gICAgICBjb25zdCBzb2xpY2l0YWNvZXNQZW5kZW50ZXMgPSBhd2FpdCB0aGlzLnNvbGljaXRhY2FvUmVwb3NpdG9yeS5maW5kKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICByZW5vdmFjYW9fYXV0b21hdGljYTogdHJ1ZSxcbiAgICAgICAgICBkYXRhX3Byb3hpbWFfcmVub3ZhY2FvOiBMZXNzVGhhbk9yRXF1YWwoZGF0YUF0dWFsKSxcbiAgICAgICAgICBzdGF0dXM6IFN0YXR1c1NvbGljaXRhY2FvLkNPTkNMVUlEQSxcbiAgICAgICAgfSxcbiAgICAgICAgcmVsYXRpb25zOiBbJ3RpcG9fYmVuZWZpY2lvJ10sXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5sb2dnZXIubG9nKFxuICAgICAgICBgRW5jb250cmFkYXMgJHtzb2xpY2l0YWNvZXNQZW5kZW50ZXMubGVuZ3RofSBzb2xpY2l0YcOnw7VlcyBwZW5kZW50ZXMgZGUgcmVub3Zhw6fDo29gLFxuICAgICAgKTtcblxuICAgICAgZm9yIChjb25zdCBzb2xpY2l0YWNhbyBvZiBzb2xpY2l0YWNvZXNQZW5kZW50ZXMpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5wcm9jZXNzYXJSZW5vdmFjYW9Tb2xpY2l0YWNhbyhzb2xpY2l0YWNhbyk7XG4gICAgICAgIHJlbm92YWNvZXNQcm9jZXNzYWRhcysrO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ2dlci5sb2coXG4gICAgICAgIGBWZXJpZmljYcOnw6NvIG1hbnVhbCBjb25jbHXDrWRhLiAke3Jlbm92YWNvZXNQcm9jZXNzYWRhc30gcmVub3Zhw6fDtWVzIHByb2Nlc3NhZGFzLmAsXG4gICAgICApO1xuICAgICAgcmV0dXJuIHJlbm92YWNvZXNQcm9jZXNzYWRhcztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgIGBFcnJvIGFvIHZlcmlmaWNhciByZW5vdmHDp8O1ZXMgcGVuZGVudGVzOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgZXJyb3Iuc3RhY2ssXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEludGVybmFsU2VydmVyRXJyb3JFeGNlcHRpb24oXG4gICAgICAgICdFcnJvIGFvIHZlcmlmaWNhciByZW5vdmHDp8O1ZXMgcGVuZGVudGVzJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=