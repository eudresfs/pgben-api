2a3a0fa91edcd44d174b3e652361a696
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
Object.defineProperty(exports, "__esModule", { value: true });
exports.PasswordResetController = void 0;
const common_1 = require("@nestjs/common");
const swagger_1 = require("@nestjs/swagger");
const throttler_1 = require("@nestjs/throttler");
const password_reset_service_1 = require("../services/password-reset.service");
const password_reset_dto_1 = require("../dtos/password-reset.dto");
const get_client_info_decorator_1 = require("../../common/decorators/get-client-info.decorator");
const client_info_interface_1 = require("../../common/interfaces/client-info.interface");
const jwt_auth_guard_1 = require("../guards/jwt-auth.guard");
const roles_guard_1 = require("../guards/roles.guard");
const role_decorator_1 = require("../decorators/role.decorator");
const roles_constants_1 = require("../../shared/constants/roles.constants");
// Usando DTOs do arquivo password-reset.dto.ts
let PasswordResetController = class PasswordResetController {
    passwordResetService;
    constructor(passwordResetService) {
        this.passwordResetService = passwordResetService;
    }
    async requestPasswordReset(requestDto, clientInfo) {
        return this.passwordResetService.requestPasswordReset(requestDto, clientInfo);
    }
    async resetPassword(resetDto, clientInfo) {
        return this.passwordResetService.resetPassword(resetDto, clientInfo);
    }
    async validateToken(token) {
        if (!token) {
            throw new common_1.BadRequestException('Token é obrigatório');
        }
        return this.passwordResetService.validateToken(token);
    }
    async getPasswordResetStats() {
        // Convertendo o resultado para o formato esperado pelo DTO
        const stats = await this.passwordResetService.getPasswordResetStats();
        return {
            ...stats,
            successfulResetsLast24h: stats.usedTokens || 0,
            expiredTokensLast24h: stats.expiredTokens || 0,
            successRate: ((stats.usedTokens || 0) / (stats.totalRequests || 1)) * 100,
            uniqueUsersLast24h: stats.requestsLast24h || 0,
        };
    }
    async cleanupExpiredTokens() {
        const deletedCount = await this.passwordResetService.cleanupExpiredTokens();
        return {
            message: 'Tokens expirados removidos com sucesso',
            deletedCount,
            timestamp: new Date().toISOString(),
        };
    }
    async getTokenStats() {
        return this.passwordResetService.getTokenStats();
    }
};
exports.PasswordResetController = PasswordResetController;
__decorate([
    (0, common_1.Post)('request'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, throttler_1.Throttle)({ default: { limit: 3, ttl: 60000 } }) // 3 tentativas por minuto
    ,
    (0, swagger_1.ApiOperation)({
        summary: 'Solicitar recuperação de senha',
        description: 'Envia um email com link para redefinir a senha do usuário',
    }),
    (0, swagger_1.ApiBody)({ type: password_reset_dto_1.ForgotPasswordDto }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Solicitação processada com sucesso',
        type: password_reset_dto_1.ResetPasswordResponseDto,
    }),
    (0, swagger_1.ApiResponse)({
        status: 400,
        description: 'Dados inválidos ou muitas tentativas',
    }),
    (0, swagger_1.ApiResponse)({
        status: 429,
        description: 'Muitas tentativas - rate limit excedido',
    }),
    (0, swagger_1.ApiResponse)({
        status: 500,
        description: 'Erro interno do servidor',
    }),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, get_client_info_decorator_1.GetClientInfo)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_b = typeof password_reset_dto_1.ForgotPasswordDto !== "undefined" && password_reset_dto_1.ForgotPasswordDto) === "function" ? _b : Object, typeof (_c = typeof client_info_interface_1.ClientInfo !== "undefined" && client_info_interface_1.ClientInfo) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], PasswordResetController.prototype, "requestPasswordReset", null);
__decorate([
    (0, common_1.Post)('reset'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, throttler_1.Throttle)({ default: { limit: 5, ttl: 60000 } }) // 5 tentativas por minuto
    ,
    (0, swagger_1.ApiOperation)({
        summary: 'Redefinir senha',
        description: 'Redefine a senha do usuário usando o token recebido por email',
    }),
    (0, swagger_1.ApiBody)({ type: password_reset_dto_1.ResetPasswordDto }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Senha redefinida com sucesso',
        type: password_reset_dto_1.ResetPasswordResponseDto,
    }),
    (0, swagger_1.ApiResponse)({
        status: 400,
        description: 'Dados inválidos ou senhas não coincidem',
    }),
    (0, swagger_1.ApiResponse)({
        status: 401,
        description: 'Token inválido ou expirado',
    }),
    (0, swagger_1.ApiResponse)({
        status: 404,
        description: 'Usuário não encontrado',
    }),
    (0, swagger_1.ApiResponse)({
        status: 429,
        description: 'Muitas tentativas - rate limit excedido',
    }),
    (0, swagger_1.ApiResponse)({
        status: 500,
        description: 'Erro interno do servidor',
    }),
    __param(0, (0, common_1.Body)()),
    __param(1, (0, get_client_info_decorator_1.GetClientInfo)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof password_reset_dto_1.ResetPasswordDto !== "undefined" && password_reset_dto_1.ResetPasswordDto) === "function" ? _e : Object, typeof (_f = typeof client_info_interface_1.ClientInfo !== "undefined" && client_info_interface_1.ClientInfo) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], PasswordResetController.prototype, "resetPassword", null);
__decorate([
    (0, common_1.Get)('validate-token'),
    (0, common_1.HttpCode)(common_1.HttpStatus.OK),
    (0, throttler_1.Throttle)({ default: { limit: 10, ttl: 60000 } }) // 10 tentativas por minuto
    ,
    (0, swagger_1.ApiOperation)({
        summary: 'Validar token de recuperação',
        description: 'Verifica se um token de recuperação é válido e não expirado',
    }),
    (0, swagger_1.ApiQuery)({
        name: 'token',
        description: 'Token de recuperação para validação',
        example: 'abc123def456...',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Status de validação do token',
        type: password_reset_dto_1.ValidateTokenResponseDto,
    }),
    (0, swagger_1.ApiResponse)({
        status: 400,
        description: 'Token não fornecido',
    }),
    (0, swagger_1.ApiResponse)({
        status: 429,
        description: 'Muitas tentativas - rate limit excedido',
    }),
    __param(0, (0, common_1.Query)('token')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", typeof (_h = typeof Promise !== "undefined" && Promise) === "function" ? _h : Object)
], PasswordResetController.prototype, "validateToken", null);
__decorate([
    (0, common_1.Get)('stats'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, role_decorator_1.Roles)(roles_constants_1.ROLES.ADMIN, roles_constants_1.ROLES.GESTOR),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiOperation)({
        summary: 'Estatísticas de recuperação de senha',
        description: 'Obtém estatísticas sobre solicitações de recuperação de senha (apenas admins)',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Estatísticas obtidas com sucesso',
        type: password_reset_dto_1.PasswordResetStatsDto,
    }),
    (0, swagger_1.ApiResponse)({
        status: 401,
        description: 'Token de autenticação inválido',
    }),
    (0, swagger_1.ApiResponse)({
        status: 403,
        description: 'Acesso negado - permissões insuficientes',
    }),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_j = typeof Promise !== "undefined" && Promise) === "function" ? _j : Object)
], PasswordResetController.prototype, "getPasswordResetStats", null);
__decorate([
    (0, common_1.Post)('cleanup-expired'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, role_decorator_1.Roles)(roles_constants_1.ROLES.ADMIN, roles_constants_1.ROLES.SUPER_ADMIN),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiOperation)({
        summary: 'Limpar tokens expirados',
        description: 'Remove manualmente tokens de recuperação expirados (apenas admins)',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Tokens expirados removidos com sucesso',
        schema: {
            type: 'object',
            properties: {
                message: {
                    type: 'string',
                    example: 'Tokens expirados removidos com sucesso',
                },
                deletedCount: { type: 'number', example: 15 },
                timestamp: { type: 'string', example: '2024-01-15T10:30:00Z' },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({
        status: 401,
        description: 'Token de autenticação inválido',
    }),
    (0, swagger_1.ApiResponse)({
        status: 403,
        description: 'Acesso negado - permissões insuficientes',
    }),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_k = typeof Promise !== "undefined" && Promise) === "function" ? _k : Object)
], PasswordResetController.prototype, "cleanupExpiredTokens", null);
__decorate([
    (0, common_1.Get)('token-stats'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, role_decorator_1.Roles)(roles_constants_1.ROLES.ADMIN, roles_constants_1.ROLES.SUPER_ADMIN),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiOperation)({
        summary: 'Estatísticas detalhadas de tokens',
        description: 'Obtém estatísticas detalhadas sobre tokens de recuperação (apenas admins)',
    }),
    (0, swagger_1.ApiResponse)({
        status: 200,
        description: 'Estatísticas obtidas com sucesso',
        schema: {
            type: 'object',
            properties: {
                total: { type: 'number', example: 100 },
                active: { type: 'number', example: 5 },
                expired: { type: 'number', example: 80 },
                used: { type: 'number', example: 15 },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({
        status: 401,
        description: 'Token de autenticação inválido',
    }),
    (0, swagger_1.ApiResponse)({
        status: 403,
        description: 'Acesso negado - permissões insuficientes',
    }),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", typeof (_l = typeof Promise !== "undefined" && Promise) === "function" ? _l : Object)
], PasswordResetController.prototype, "getTokenStats", null);
exports.PasswordResetController = PasswordResetController = __decorate([
    (0, swagger_1.ApiTags)('Recuperação de Senha'),
    (0, common_1.Controller)('auth/password-reset'),
    (0, swagger_1.ApiExtraModels)(password_reset_dto_1.ForgotPasswordDto, password_reset_dto_1.ResetPasswordDto, password_reset_dto_1.ValidateTokenDto, password_reset_dto_1.ResetPasswordResponseDto, password_reset_dto_1.ValidateTokenResponseDto, password_reset_dto_1.PasswordResetStatsDto),
    (0, common_1.UsePipes)(new common_1.ValidationPipe({ transform: true, whitelist: true })),
    __metadata("design:paramtypes", [typeof (_a = typeof password_reset_service_1.PasswordResetService !== "undefined" && password_reset_service_1.PasswordResetService) === "function" ? _a : Object])
], PasswordResetController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGF1dGhcXGNvbnRyb2xsZXJzXFxwYXNzd29yZC1yZXNldC5jb250cm9sbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FZd0I7QUFDeEIsNkNBUXlCO0FBQ3pCLGlEQUE2QztBQUU3QywrRUFBMEU7QUFDMUUsbUVBT29DO0FBQ3BDLGlHQUFrRjtBQUNsRix5RkFBMkU7QUFDM0UsNkRBQXdEO0FBQ3hELHVEQUFtRDtBQUNuRCxpRUFBcUQ7QUFFckQsNEVBQStEO0FBRS9ELCtDQUErQztBQWF4QyxJQUFNLHVCQUF1QixHQUE3QixNQUFNLHVCQUF1QjtJQUNMO0lBQTdCLFlBQTZCLG9CQUEwQztRQUExQyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO0lBQUcsQ0FBQztJQTJCckUsQUFBTixLQUFLLENBQUMsb0JBQW9CLENBQ2hCLFVBQW1DLEVBQzFCLFVBQXNCO1FBRXZDLE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDLG9CQUFvQixDQUNuRCxVQUFVLEVBQ1YsVUFBVSxDQUNYLENBQUM7SUFDSixDQUFDO0lBb0NLLEFBQU4sS0FBSyxDQUFDLGFBQWEsQ0FDVCxRQUEwQixFQUNqQixVQUFzQjtRQUV2QyxPQUFPLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxhQUFhLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7SUEyQkssQUFBTixLQUFLLENBQUMsYUFBYSxDQUNELEtBQWE7UUFFN0IsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ1gsTUFBTSxJQUFJLDRCQUFtQixDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDdkQsQ0FBQztRQUVELE9BQU8sSUFBSSxDQUFDLG9CQUFvQixDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN4RCxDQUFDO0lBd0JLLEFBQU4sS0FBSyxDQUFDLHFCQUFxQjtRQUN6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QUFDO3lEQUVkLDZDQUFvQixvQkFBcEIsNkNBQW9CO0dBRDVELHVCQUF1QixDQXVPbkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXGF1dGhcXGNvbnRyb2xsZXJzXFxwYXNzd29yZC1yZXNldC5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbnRyb2xsZXIsXG4gIFBvc3QsXG4gIEJvZHksXG4gIEdldCxcbiAgUXVlcnksXG4gIEh0dHBDb2RlLFxuICBIdHRwU3RhdHVzLFxuICBVc2VHdWFyZHMsXG4gIFZhbGlkYXRpb25QaXBlLFxuICBVc2VQaXBlcyxcbiAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcbn0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHtcbiAgQXBpVGFncyxcbiAgQXBpT3BlcmF0aW9uLFxuICBBcGlSZXNwb25zZSxcbiAgQXBpQm9keSxcbiAgQXBpUXVlcnksXG4gIEFwaUJlYXJlckF1dGgsXG4gIEFwaUV4dHJhTW9kZWxzLFxufSBmcm9tICdAbmVzdGpzL3N3YWdnZXInO1xuaW1wb3J0IHsgVGhyb3R0bGUgfSBmcm9tICdAbmVzdGpzL3Rocm90dGxlcic7XG5pbXBvcnQgeyBJc0VtYWlsLCBJc1N0cmluZywgTWluTGVuZ3RoLCBNYXRjaGVzIH0gZnJvbSAnY2xhc3MtdmFsaWRhdG9yJztcbmltcG9ydCB7IFBhc3N3b3JkUmVzZXRTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvcGFzc3dvcmQtcmVzZXQuc2VydmljZSc7XG5pbXBvcnQge1xuICBSZXNldFBhc3N3b3JkRHRvLFxuICBGb3Jnb3RQYXNzd29yZER0byBhcyBSZXF1ZXN0UGFzc3dvcmRSZXNldER0byxcbiAgVmFsaWRhdGVUb2tlbkR0byxcbiAgUmVzZXRQYXNzd29yZFJlc3BvbnNlRHRvLFxuICBWYWxpZGF0ZVRva2VuUmVzcG9uc2VEdG8sXG4gIFBhc3N3b3JkUmVzZXRTdGF0c0R0byxcbn0gZnJvbSAnLi4vZHRvcy9wYXNzd29yZC1yZXNldC5kdG8nO1xuaW1wb3J0IHsgR2V0Q2xpZW50SW5mbyB9IGZyb20gJy4uLy4uL2NvbW1vbi9kZWNvcmF0b3JzL2dldC1jbGllbnQtaW5mby5kZWNvcmF0b3InO1xuaW1wb3J0IHsgQ2xpZW50SW5mbyB9IGZyb20gJy4uLy4uL2NvbW1vbi9pbnRlcmZhY2VzL2NsaWVudC1pbmZvLmludGVyZmFjZSc7XG5pbXBvcnQgeyBKd3RBdXRoR3VhcmQgfSBmcm9tICcuLi9ndWFyZHMvand0LWF1dGguZ3VhcmQnO1xuaW1wb3J0IHsgUm9sZXNHdWFyZCB9IGZyb20gJy4uL2d1YXJkcy9yb2xlcy5ndWFyZCc7XG5pbXBvcnQgeyBSb2xlcyB9IGZyb20gJy4uL2RlY29yYXRvcnMvcm9sZS5kZWNvcmF0b3InO1xuaW1wb3J0IHsgUm9sZSB9IGZyb20gJy4uL2VudW1zL3JvbGUuZW51bSc7XG5pbXBvcnQgeyBST0xFUyB9IGZyb20gJy4uLy4uL3NoYXJlZC9jb25zdGFudHMvcm9sZXMuY29uc3RhbnRzJztcblxuLy8gVXNhbmRvIERUT3MgZG8gYXJxdWl2byBwYXNzd29yZC1yZXNldC5kdG8udHNcblxuQEFwaVRhZ3MoJ1JlY3VwZXJhw6fDo28gZGUgU2VuaGEnKVxuQENvbnRyb2xsZXIoJ2F1dGgvcGFzc3dvcmQtcmVzZXQnKVxuQEFwaUV4dHJhTW9kZWxzKFxuICBSZXF1ZXN0UGFzc3dvcmRSZXNldER0byxcbiAgUmVzZXRQYXNzd29yZER0byxcbiAgVmFsaWRhdGVUb2tlbkR0byxcbiAgUmVzZXRQYXNzd29yZFJlc3BvbnNlRHRvLFxuICBWYWxpZGF0ZVRva2VuUmVzcG9uc2VEdG8sXG4gIFBhc3N3b3JkUmVzZXRTdGF0c0R0byxcbilcbkBVc2VQaXBlcyhuZXcgVmFsaWRhdGlvblBpcGUoeyB0cmFuc2Zvcm06IHRydWUsIHdoaXRlbGlzdDogdHJ1ZSB9KSlcbmV4cG9ydCBjbGFzcyBQYXNzd29yZFJlc2V0Q29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgcGFzc3dvcmRSZXNldFNlcnZpY2U6IFBhc3N3b3JkUmVzZXRTZXJ2aWNlKSB7fVxuXG4gIEBQb3N0KCdyZXF1ZXN0JylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIEBUaHJvdHRsZSh7IGRlZmF1bHQ6IHsgbGltaXQ6IDMsIHR0bDogNjAwMDAgfSB9KSAvLyAzIHRlbnRhdGl2YXMgcG9yIG1pbnV0b1xuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnU29saWNpdGFyIHJlY3VwZXJhw6fDo28gZGUgc2VuaGEnLFxuICAgIGRlc2NyaXB0aW9uOiAnRW52aWEgdW0gZW1haWwgY29tIGxpbmsgcGFyYSByZWRlZmluaXIgYSBzZW5oYSBkbyB1c3XDoXJpbycsXG4gIH0pXG4gIEBBcGlCb2R5KHsgdHlwZTogUmVxdWVzdFBhc3N3b3JkUmVzZXREdG8gfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBkZXNjcmlwdGlvbjogJ1NvbGljaXRhw6fDo28gcHJvY2Vzc2FkYSBjb20gc3VjZXNzbycsXG4gICAgdHlwZTogUmVzZXRQYXNzd29yZFJlc3BvbnNlRHRvLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNDAwLFxuICAgIGRlc2NyaXB0aW9uOiAnRGFkb3MgaW52w6FsaWRvcyBvdSBtdWl0YXMgdGVudGF0aXZhcycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiA0MjksXG4gICAgZGVzY3JpcHRpb246ICdNdWl0YXMgdGVudGF0aXZhcyAtIHJhdGUgbGltaXQgZXhjZWRpZG8nLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNTAwLFxuICAgIGRlc2NyaXB0aW9uOiAnRXJybyBpbnRlcm5vIGRvIHNlcnZpZG9yJyxcbiAgfSlcbiAgYXN5bmMgcmVxdWVzdFBhc3N3b3JkUmVzZXQoXG4gICAgQEJvZHkoKSByZXF1ZXN0RHRvOiBSZXF1ZXN0UGFzc3dvcmRSZXNldER0byxcbiAgICBAR2V0Q2xpZW50SW5mbygpIGNsaWVudEluZm86IENsaWVudEluZm8sXG4gICk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMucGFzc3dvcmRSZXNldFNlcnZpY2UucmVxdWVzdFBhc3N3b3JkUmVzZXQoXG4gICAgICByZXF1ZXN0RHRvLFxuICAgICAgY2xpZW50SW5mbyxcbiAgICApO1xuICB9XG5cbiAgQFBvc3QoJ3Jlc2V0JylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIEBUaHJvdHRsZSh7IGRlZmF1bHQ6IHsgbGltaXQ6IDUsIHR0bDogNjAwMDAgfSB9KSAvLyA1IHRlbnRhdGl2YXMgcG9yIG1pbnV0b1xuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnUmVkZWZpbmlyIHNlbmhhJyxcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgICdSZWRlZmluZSBhIHNlbmhhIGRvIHVzdcOhcmlvIHVzYW5kbyBvIHRva2VuIHJlY2ViaWRvIHBvciBlbWFpbCcsXG4gIH0pXG4gIEBBcGlCb2R5KHsgdHlwZTogUmVzZXRQYXNzd29yZER0byB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnU2VuaGEgcmVkZWZpbmlkYSBjb20gc3VjZXNzbycsXG4gICAgdHlwZTogUmVzZXRQYXNzd29yZFJlc3BvbnNlRHRvLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNDAwLFxuICAgIGRlc2NyaXB0aW9uOiAnRGFkb3MgaW52w6FsaWRvcyBvdSBzZW5oYXMgbsOjbyBjb2luY2lkZW0nLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNDAxLFxuICAgIGRlc2NyaXB0aW9uOiAnVG9rZW4gaW52w6FsaWRvIG91IGV4cGlyYWRvJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDQwNCxcbiAgICBkZXNjcmlwdGlvbjogJ1VzdcOhcmlvIG7Do28gZW5jb250cmFkbycsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiA0MjksXG4gICAgZGVzY3JpcHRpb246ICdNdWl0YXMgdGVudGF0aXZhcyAtIHJhdGUgbGltaXQgZXhjZWRpZG8nLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNTAwLFxuICAgIGRlc2NyaXB0aW9uOiAnRXJybyBpbnRlcm5vIGRvIHNlcnZpZG9yJyxcbiAgfSlcbiAgYXN5bmMgcmVzZXRQYXNzd29yZChcbiAgICBAQm9keSgpIHJlc2V0RHRvOiBSZXNldFBhc3N3b3JkRHRvLFxuICAgIEBHZXRDbGllbnRJbmZvKCkgY2xpZW50SW5mbzogQ2xpZW50SW5mbyxcbiAgKTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5wYXNzd29yZFJlc2V0U2VydmljZS5yZXNldFBhc3N3b3JkKHJlc2V0RHRvLCBjbGllbnRJbmZvKTtcbiAgfVxuXG4gIEBHZXQoJ3ZhbGlkYXRlLXRva2VuJylcbiAgQEh0dHBDb2RlKEh0dHBTdGF0dXMuT0spXG4gIEBUaHJvdHRsZSh7IGRlZmF1bHQ6IHsgbGltaXQ6IDEwLCB0dGw6IDYwMDAwIH0gfSkgLy8gMTAgdGVudGF0aXZhcyBwb3IgbWludXRvXG4gIEBBcGlPcGVyYXRpb24oe1xuICAgIHN1bW1hcnk6ICdWYWxpZGFyIHRva2VuIGRlIHJlY3VwZXJhw6fDo28nLFxuICAgIGRlc2NyaXB0aW9uOiAnVmVyaWZpY2Egc2UgdW0gdG9rZW4gZGUgcmVjdXBlcmHDp8OjbyDDqSB2w6FsaWRvIGUgbsOjbyBleHBpcmFkbycsXG4gIH0pXG4gIEBBcGlRdWVyeSh7XG4gICAgbmFtZTogJ3Rva2VuJyxcbiAgICBkZXNjcmlwdGlvbjogJ1Rva2VuIGRlIHJlY3VwZXJhw6fDo28gcGFyYSB2YWxpZGHDp8OjbycsXG4gICAgZXhhbXBsZTogJ2FiYzEyM2RlZjQ1Ni4uLicsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgZGVzY3JpcHRpb246ICdTdGF0dXMgZGUgdmFsaWRhw6fDo28gZG8gdG9rZW4nLFxuICAgIHR5cGU6IFZhbGlkYXRlVG9rZW5SZXNwb25zZUR0byxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDQwMCxcbiAgICBkZXNjcmlwdGlvbjogJ1Rva2VuIG7Do28gZm9ybmVjaWRvJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDQyOSxcbiAgICBkZXNjcmlwdGlvbjogJ011aXRhcyB0ZW50YXRpdmFzIC0gcmF0ZSBsaW1pdCBleGNlZGlkbycsXG4gIH0pXG4gIGFzeW5jIHZhbGlkYXRlVG9rZW4oXG4gICAgQFF1ZXJ5KCd0b2tlbicpIHRva2VuOiBzdHJpbmcsXG4gICk6IFByb21pc2U8VmFsaWRhdGVUb2tlblJlc3BvbnNlRHRvPiB7XG4gICAgaWYgKCF0b2tlbikge1xuICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ1Rva2VuIMOpIG9icmlnYXTDs3JpbycpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnBhc3N3b3JkUmVzZXRTZXJ2aWNlLnZhbGlkYXRlVG9rZW4odG9rZW4pO1xuICB9XG5cbiAgQEdldCgnc3RhdHMnKVxuICBAVXNlR3VhcmRzKEp3dEF1dGhHdWFyZCwgUm9sZXNHdWFyZClcbiAgQFJvbGVzKFJPTEVTLkFETUlOLCBST0xFUy5HRVNUT1IpXG4gIEBBcGlCZWFyZXJBdXRoKClcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0VzdGF0w61zdGljYXMgZGUgcmVjdXBlcmHDp8OjbyBkZSBzZW5oYScsXG4gICAgZGVzY3JpcHRpb246XG4gICAgICAnT2J0w6ltIGVzdGF0w61zdGljYXMgc29icmUgc29saWNpdGHDp8O1ZXMgZGUgcmVjdXBlcmHDp8OjbyBkZSBzZW5oYSAoYXBlbmFzIGFkbWlucyknLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnRXN0YXTDrXN0aWNhcyBvYnRpZGFzIGNvbSBzdWNlc3NvJyxcbiAgICB0eXBlOiBQYXNzd29yZFJlc2V0U3RhdHNEdG8sXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiA0MDEsXG4gICAgZGVzY3JpcHRpb246ICdUb2tlbiBkZSBhdXRlbnRpY2HDp8OjbyBpbnbDoWxpZG8nLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNDAzLFxuICAgIGRlc2NyaXB0aW9uOiAnQWNlc3NvIG5lZ2FkbyAtIHBlcm1pc3PDtWVzIGluc3VmaWNpZW50ZXMnLFxuICB9KVxuICBhc3luYyBnZXRQYXNzd29yZFJlc2V0U3RhdHMoKTogUHJvbWlzZTxhbnk+IHtcbiAgICAvLyBDb252ZXJ0ZW5kbyBvIHJlc3VsdGFkbyBwYXJhIG8gZm9ybWF0byBlc3BlcmFkbyBwZWxvIERUT1xuICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgdGhpcy5wYXNzd29yZFJlc2V0U2VydmljZS5nZXRQYXNzd29yZFJlc2V0U3RhdHMoKTtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uc3RhdHMsXG4gICAgICBzdWNjZXNzZnVsUmVzZXRzTGFzdDI0aDogc3RhdHMudXNlZFRva2VucyB8fCAwLFxuICAgICAgZXhwaXJlZFRva2Vuc0xhc3QyNGg6IHN0YXRzLmV4cGlyZWRUb2tlbnMgfHwgMCxcbiAgICAgIHN1Y2Nlc3NSYXRlOiAoKHN0YXRzLnVzZWRUb2tlbnMgfHwgMCkgLyAoc3RhdHMudG90YWxSZXF1ZXN0cyB8fCAxKSkgKiAxMDAsXG4gICAgICB1bmlxdWVVc2Vyc0xhc3QyNGg6IHN0YXRzLnJlcXVlc3RzTGFzdDI0aCB8fCAwLFxuICAgIH07XG4gIH1cblxuICBAUG9zdCgnY2xlYW51cC1leHBpcmVkJylcbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQsIFJvbGVzR3VhcmQpXG4gIEBSb2xlcyhST0xFUy5BRE1JTiwgUk9MRVMuU1VQRVJfQURNSU4pXG4gIEBBcGlCZWFyZXJBdXRoKClcbiAgQEFwaU9wZXJhdGlvbih7XG4gICAgc3VtbWFyeTogJ0xpbXBhciB0b2tlbnMgZXhwaXJhZG9zJyxcbiAgICBkZXNjcmlwdGlvbjpcbiAgICAgICdSZW1vdmUgbWFudWFsbWVudGUgdG9rZW5zIGRlIHJlY3VwZXJhw6fDo28gZXhwaXJhZG9zIChhcGVuYXMgYWRtaW5zKScsXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgZGVzY3JpcHRpb246ICdUb2tlbnMgZXhwaXJhZG9zIHJlbW92aWRvcyBjb20gc3VjZXNzbycsXG4gICAgc2NoZW1hOiB7XG4gICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgbWVzc2FnZToge1xuICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgIGV4YW1wbGU6ICdUb2tlbnMgZXhwaXJhZG9zIHJlbW92aWRvcyBjb20gc3VjZXNzbycsXG4gICAgICAgIH0sXG4gICAgICAgIGRlbGV0ZWRDb3VudDogeyB0eXBlOiAnbnVtYmVyJywgZXhhbXBsZTogMTUgfSxcbiAgICAgICAgdGltZXN0YW1wOiB7IHR5cGU6ICdzdHJpbmcnLCBleGFtcGxlOiAnMjAyNC0wMS0xNVQxMDozMDowMFonIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7XG4gICAgc3RhdHVzOiA0MDEsXG4gICAgZGVzY3JpcHRpb246ICdUb2tlbiBkZSBhdXRlbnRpY2HDp8OjbyBpbnbDoWxpZG8nLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNDAzLFxuICAgIGRlc2NyaXB0aW9uOiAnQWNlc3NvIG5lZ2FkbyAtIHBlcm1pc3PDtWVzIGluc3VmaWNpZW50ZXMnLFxuICB9KVxuICBhc3luYyBjbGVhbnVwRXhwaXJlZFRva2VucygpOiBQcm9taXNlPHtcbiAgICBtZXNzYWdlOiBzdHJpbmc7XG4gICAgZGVsZXRlZENvdW50OiBudW1iZXI7XG4gICAgdGltZXN0YW1wOiBzdHJpbmc7XG4gIH0+IHtcbiAgICBjb25zdCBkZWxldGVkQ291bnQgPSBhd2FpdCB0aGlzLnBhc3N3b3JkUmVzZXRTZXJ2aWNlLmNsZWFudXBFeHBpcmVkVG9rZW5zKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1lc3NhZ2U6ICdUb2tlbnMgZXhwaXJhZG9zIHJlbW92aWRvcyBjb20gc3VjZXNzbycsXG4gICAgICBkZWxldGVkQ291bnQsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9O1xuICB9XG5cbiAgQEdldCgndG9rZW4tc3RhdHMnKVxuICBAVXNlR3VhcmRzKEp3dEF1dGhHdWFyZCwgUm9sZXNHdWFyZClcbiAgQFJvbGVzKFJPTEVTLkFETUlOLCBST0xFUy5TVVBFUl9BRE1JTilcbiAgQEFwaUJlYXJlckF1dGgoKVxuICBAQXBpT3BlcmF0aW9uKHtcbiAgICBzdW1tYXJ5OiAnRXN0YXTDrXN0aWNhcyBkZXRhbGhhZGFzIGRlIHRva2VucycsXG4gICAgZGVzY3JpcHRpb246XG4gICAgICAnT2J0w6ltIGVzdGF0w61zdGljYXMgZGV0YWxoYWRhcyBzb2JyZSB0b2tlbnMgZGUgcmVjdXBlcmHDp8OjbyAoYXBlbmFzIGFkbWlucyknLFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogMjAwLFxuICAgIGRlc2NyaXB0aW9uOiAnRXN0YXTDrXN0aWNhcyBvYnRpZGFzIGNvbSBzdWNlc3NvJyxcbiAgICBzY2hlbWE6IHtcbiAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICB0b3RhbDogeyB0eXBlOiAnbnVtYmVyJywgZXhhbXBsZTogMTAwIH0sXG4gICAgICAgIGFjdGl2ZTogeyB0eXBlOiAnbnVtYmVyJywgZXhhbXBsZTogNSB9LFxuICAgICAgICBleHBpcmVkOiB7IHR5cGU6ICdudW1iZXInLCBleGFtcGxlOiA4MCB9LFxuICAgICAgICB1c2VkOiB7IHR5cGU6ICdudW1iZXInLCBleGFtcGxlOiAxNSB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KVxuICBAQXBpUmVzcG9uc2Uoe1xuICAgIHN0YXR1czogNDAxLFxuICAgIGRlc2NyaXB0aW9uOiAnVG9rZW4gZGUgYXV0ZW50aWNhw6fDo28gaW52w6FsaWRvJyxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHtcbiAgICBzdGF0dXM6IDQwMyxcbiAgICBkZXNjcmlwdGlvbjogJ0FjZXNzbyBuZWdhZG8gLSBwZXJtaXNzw7VlcyBpbnN1ZmljaWVudGVzJyxcbiAgfSlcbiAgYXN5bmMgZ2V0VG9rZW5TdGF0cygpOiBQcm9taXNlPHtcbiAgICB0b3RhbDogbnVtYmVyO1xuICAgIGFjdGl2ZTogbnVtYmVyO1xuICAgIGV4cGlyZWQ6IG51bWJlcjtcbiAgICB1c2VkOiBudW1iZXI7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy5wYXNzd29yZFJlc2V0U2VydmljZS5nZXRUb2tlblN0YXRzKCk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==