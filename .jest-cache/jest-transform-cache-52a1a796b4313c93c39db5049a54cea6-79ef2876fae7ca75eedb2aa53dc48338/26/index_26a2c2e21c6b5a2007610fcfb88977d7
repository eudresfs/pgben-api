375f292ce44e7b7152cb5535fee8dba3
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createRequestContext = createRequestContext;
const constants_1 = require("../../constants");
const request_context_dto_1 = require("../request-context.dto");
// Creates a RequestContext object from Request
function createRequestContext(request) {
    const ctx = new request_context_dto_1.RequestContext();
    ctx.requestID = request.header(constants_1.REQUEST_ID_TOKEN_HEADER);
    ctx.url = request.url;
    ctx.ip = request.header(constants_1.FORWARDED_FOR_TOKEN_HEADER)
        ? request.header(constants_1.FORWARDED_FOR_TOKEN_HEADER)
        : request.ip;
    // If request.user does not exist, we explicitly set it to null.
    ctx.user = request.user
        ? request.user
        : null;
    return ctx;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXHNoYXJlZFxccmVxdWVzdC1jb250ZXh0XFx1dGlsXFxpbmRleC50cyIsIm1hcHBpbmdzIjoiOztBQW9CQSxvREFjQztBQXJCRCwrQ0FHeUI7QUFDekIsZ0VBQXdEO0FBRXhELCtDQUErQztBQUMvQyxTQUFnQixvQkFBb0IsQ0FBQyxPQUFnQjtJQUNuRCxNQUFNLEdBQUcsR0FBRyxJQUFJLG9DQUFjLEVBQUUsQ0FBQztJQUNqQyxHQUFHLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsbUNBQXVCLENBQUMsQ0FBQztJQUN4RCxHQUFHLENBQUMsR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7SUFDdEIsR0FBRyxDQUFDLEVBQUUsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLHNDQUEwQixDQUFDO1FBQ2pELENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLHNDQUEwQixDQUFDO1FBQzVDLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO0lBRWYsZ0VBQWdFO0lBQ2hFLEdBQUcsQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUk7UUFDckIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUE2QjtRQUN2QyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBRVQsT0FBTyxHQUFHLENBQUM7QUFDYixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZXVkcmVcXE9uZURyaXZlXFxEZXNrdG9wXFxQcm9qZXRvc1xccGdiZW5cXHBnYmVuLXNlcnZlclxcc3JjXFxzaGFyZWRcXHJlcXVlc3QtY29udGV4dFxcdXRpbFxcaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGxhaW5Ub0NsYXNzIH0gZnJvbSAnY2xhc3MtdHJhbnNmb3JtZXInO1xuaW1wb3J0IHsgUmVxdWVzdCB9IGZyb20gJ2V4cHJlc3MnO1xuXG5pbXBvcnQgeyBVc2VyQWNjZXNzVG9rZW5DbGFpbXMgfSBmcm9tICcuLi8uLi8uLi9hdXRoL2R0b3MvYXV0aC10b2tlbi1vdXRwdXQuZHRvJztcblxuLy8gRXh0ZW5kIEV4cHJlc3MgUmVxdWVzdCBpbnRlcmZhY2UgdG8gaW5jbHVkZSB1c2VyIHByb3BlcnR5XG5kZWNsYXJlIGdsb2JhbCB7XG4gIG5hbWVzcGFjZSBFeHByZXNzIHtcbiAgICBpbnRlcmZhY2UgUmVxdWVzdCB7XG4gICAgICB1c2VyPzogVXNlckFjY2Vzc1Rva2VuQ2xhaW1zO1xuICAgIH1cbiAgfVxufVxuaW1wb3J0IHtcbiAgRk9SV0FSREVEX0ZPUl9UT0tFTl9IRUFERVIsXG4gIFJFUVVFU1RfSURfVE9LRU5fSEVBREVSLFxufSBmcm9tICcuLi8uLi9jb25zdGFudHMnO1xuaW1wb3J0IHsgUmVxdWVzdENvbnRleHQgfSBmcm9tICcuLi9yZXF1ZXN0LWNvbnRleHQuZHRvJztcblxuLy8gQ3JlYXRlcyBhIFJlcXVlc3RDb250ZXh0IG9iamVjdCBmcm9tIFJlcXVlc3RcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSZXF1ZXN0Q29udGV4dChyZXF1ZXN0OiBSZXF1ZXN0KTogUmVxdWVzdENvbnRleHQge1xuICBjb25zdCBjdHggPSBuZXcgUmVxdWVzdENvbnRleHQoKTtcbiAgY3R4LnJlcXVlc3RJRCA9IHJlcXVlc3QuaGVhZGVyKFJFUVVFU1RfSURfVE9LRU5fSEVBREVSKTtcbiAgY3R4LnVybCA9IHJlcXVlc3QudXJsO1xuICBjdHguaXAgPSByZXF1ZXN0LmhlYWRlcihGT1JXQVJERURfRk9SX1RPS0VOX0hFQURFUilcbiAgICA/IHJlcXVlc3QuaGVhZGVyKEZPUldBUkRFRF9GT1JfVE9LRU5fSEVBREVSKVxuICAgIDogcmVxdWVzdC5pcDtcblxuICAvLyBJZiByZXF1ZXN0LnVzZXIgZG9lcyBub3QgZXhpc3QsIHdlIGV4cGxpY2l0bHkgc2V0IGl0IHRvIG51bGwuXG4gIGN0eC51c2VyID0gcmVxdWVzdC51c2VyXG4gICAgPyByZXF1ZXN0LnVzZXIgYXMgVXNlckFjY2Vzc1Rva2VuQ2xhaW1zXG4gICAgOiBudWxsO1xuXG4gIHJldHVybiBjdHg7XG59XG4iXSwidmVyc2lvbiI6M30=