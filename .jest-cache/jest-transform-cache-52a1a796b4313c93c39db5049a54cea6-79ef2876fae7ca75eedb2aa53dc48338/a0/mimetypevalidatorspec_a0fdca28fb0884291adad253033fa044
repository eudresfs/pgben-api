fe9823f7e3b3ae623697bb18928fe77f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const mime_type_validator_1 = require("../mime-type.validator");
const documento_config_1 = require("../../config/documento.config");
describe('MimeTypeValidator', () => {
    let validator;
    beforeEach(() => {
        validator = new mime_type_validator_1.MimeTypeValidator();
    });
    describe('validateMimeType', () => {
        it('deve validar um PDF válido', async () => {
            // Criar um buffer que simula um PDF (com magic number correto)
            const pdfBuffer = Buffer.from([
                0x25, 0x50, 0x44, 0x46, // %PDF magic number
                ...Buffer.from('-1.4\n%âãÏÓ\n'), // PDF header
            ]);
            const result = await validator.validateMimeType(pdfBuffer, 'application/pdf', 'documento.pdf', pdfBuffer.length);
            expect(result.isValid).toBe(true);
            expect(result.detectedMimeType).toBe('application/pdf');
            expect(result.fileExtension).toBe('pdf');
        });
        it('deve rejeitar arquivo com extensão perigosa', async () => {
            const buffer = Buffer.from('conteúdo qualquer');
            const result = await validator.validateMimeType(buffer, 'application/octet-stream', 'malware.exe', buffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.hasDangerousExtension).toBe(true);
            expect(result.message).toContain('Extensão de arquivo não permitida');
        });
        it('deve rejeitar tipo MIME bloqueado', async () => {
            const buffer = Buffer.from('conteúdo');
            const result = await validator.validateMimeType(buffer, 'text/javascript', 'script.js', buffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.isBlockedMimeType).toBe(true);
            expect(result.message).toContain('Tipo MIME bloqueado');
        });
        it('deve rejeitar arquivo que excede tamanho máximo', async () => {
            const buffer = Buffer.from('conteúdo');
            const largeSize = 25 * 1024 * 1024; // 25MB (maior que o limite global)
            const result = await validator.validateMimeType(buffer, 'application/pdf', 'documento.pdf', largeSize);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.exceedsMaxSize).toBe(true);
            expect(result.message).toContain('excede o tamanho máximo');
        });
        it('deve detectar mismatch entre tipo declarado e detectado', async () => {
            // Buffer que simula uma imagem JPEG
            const jpegBuffer = Buffer.from([
                0xFF, 0xD8, 0xFF, 0xE0, // JPEG magic number
                ...Buffer.from('fake jpeg content'),
            ]);
            const result = await validator.validateMimeType(jpegBuffer, 'application/pdf', // Tipo declarado incorreto
            'imagem.jpg', jpegBuffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.magicNumberMismatch).toBe(true);
            expect(result.message).toContain('não corresponde ao tipo real');
        });
        it('deve validar arquivo de texto simples', async () => {
            const textBuffer = Buffer.from('Este é um arquivo de texto simples.\nCom quebras de linha.');
            const result = await validator.validateMimeType(textBuffer, 'text/plain', 'documento.txt', textBuffer.length);
            expect(result.isValid).toBe(true);
            expect(result.detectedMimeType).toBe('text/plain');
        });
        it('deve detectar conteúdo suspeito em arquivo', async () => {
            const suspiciousBuffer = Buffer.from(`
        Conteúdo normal do arquivo
        <script>alert('xss')</script>
        Mais conteúdo
      `);
            const result = await validator.validateMimeType(suspiciousBuffer, 'text/plain', 'arquivo.txt', suspiciousBuffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.isSuspicious).toBe(true);
            expect(result.securityFlags?.hasEmbeddedContent).toBe(true);
            expect(result.message).toContain('conteúdo suspeito');
        });
        it('deve detectar JavaScript em PDF', async () => {
            const pdfWithJsBuffer = Buffer.from(`
        %PDF-1.4
        /JavaScript (alert('malicious'))
        /JS (document.cookie)
        resto do conteúdo PDF
      `);
            const result = await validator.validateMimeType(pdfWithJsBuffer, 'application/pdf', 'documento.pdf', pdfWithJsBuffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.isSuspicious).toBe(true);
            expect(result.message).toContain('JavaScript incorporado');
        });
        it('deve detectar alta densidade de caracteres não-ASCII', async () => {
            // Criar buffer com muitos caracteres não-ASCII (possível ofuscação)
            const obfuscatedBuffer = Buffer.from('texto' + '\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89'.repeat(20));
            const result = await validator.validateMimeType(obfuscatedBuffer, 'text/plain', 'arquivo.txt', obfuscatedBuffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.isSuspicious).toBe(true);
            expect(result.message).toContain('caracteres não-ASCII');
        });
    });
    describe('generateFileHash', () => {
        it('deve gerar hash SHA256 consistente', () => {
            const buffer = Buffer.from('conteúdo de teste');
            const hash1 = validator.generateFileHash(buffer);
            const hash2 = validator.generateFileHash(buffer);
            expect(hash1).toBe(hash2);
            expect(hash1).toHaveLength(64); // SHA256 em hex
            expect(hash1).toMatch(/^[a-f0-9]{64}$/);
        });
        it('deve gerar hashes diferentes para conteúdos diferentes', () => {
            const buffer1 = Buffer.from('conteúdo 1');
            const buffer2 = Buffer.from('conteúdo 2');
            const hash1 = validator.generateFileHash(buffer1);
            const hash2 = validator.generateFileHash(buffer2);
            expect(hash1).not.toBe(hash2);
        });
    });
    describe('requiresEncryption', () => {
        it('deve retornar true para documentos sensíveis', () => {
            const sensitiveTypes = [
                'application/pdf',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
            ];
            sensitiveTypes.forEach(mimeType => {
                expect(validator.requiresEncryption(mimeType)).toBe(true);
            });
        });
        it('deve retornar false para imagens', () => {
            const imageTypes = [
                'image/jpeg',
                'image/png',
            ];
            imageTypes.forEach(mimeType => {
                expect(validator.requiresEncryption(mimeType)).toBe(false);
            });
        });
    });
    describe('allowsThumbnail', () => {
        it('deve retornar true para imagens', () => {
            const imageTypes = [
                'image/jpeg',
                'image/png',
            ];
            imageTypes.forEach(mimeType => {
                expect(validator.allowsThumbnail(mimeType)).toBe(true);
            });
        });
        it('deve retornar true para PDFs', () => {
            expect(validator.allowsThumbnail('application/pdf')).toBe(true);
        });
        it('deve retornar false para documentos do Office', () => {
            const officeTypes = [
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
            ];
            officeTypes.forEach(mimeType => {
                expect(validator.allowsThumbnail(mimeType)).toBe(false);
            });
        });
    });
    describe('analyzeFileContent', () => {
        it('deve detectar tags de script', () => {
            const content = Buffer.from('<script>alert("xss")</script>');
            const result = validator['analyzeFileContent'](content, 'text/html');
            expect(result.isSuspicious).toBe(true);
            expect(result.hasEmbeddedContent).toBe(true);
            expect(result.reason).toContain('script');
        });
        it('deve detectar URLs javascript', () => {
            const content = Buffer.from('href="javascript:alert(1)"');
            const result = validator['analyzeFileContent'](content, 'text/html');
            expect(result.isSuspicious).toBe(true);
            expect(result.hasEmbeddedContent).toBe(true);
        });
        it('deve detectar event handlers', () => {
            const content = Buffer.from('<img onload="malicious()" />');
            const result = validator['analyzeFileContent'](content, 'text/html');
            expect(result.isSuspicious).toBe(true);
            expect(result.hasEmbeddedContent).toBe(true);
        });
        it('deve detectar null bytes', () => {
            const content = Buffer.from('texto\x00com\x00null\x00bytes');
            const result = validator['analyzeFileContent'](content, 'text/plain');
            expect(result.isSuspicious).toBe(true);
        });
        it('não deve detectar conteúdo normal como suspeito', () => {
            const content = Buffer.from(`
        Este é um documento normal.
        Contém texto, números 123 e pontuação!
        Email: usuario@exemplo.com
        URL: https://exemplo.com
      `);
            const result = validator['analyzeFileContent'](content, 'text/plain');
            expect(result.isSuspicious).toBe(false);
            expect(result.hasEmbeddedContent).toBe(false);
        });
    });
    describe('extractFileExtension', () => {
        it('deve extrair extensão corretamente', () => {
            const testCases = [
                { filename: 'documento.pdf', expected: 'pdf' },
                { filename: 'imagem.JPEG', expected: 'jpeg' },
                { filename: 'arquivo.com.extensao.txt', expected: 'txt' },
                { filename: 'sem_extensao', expected: '' },
                { filename: '.hidden', expected: 'hidden' },
            ];
            testCases.forEach(({ filename, expected }) => {
                const result = validator['extractFileExtension'](filename);
                expect(result).toBe(expected);
            });
        });
    });
    describe('integração com configuração', () => {
        it('deve usar configurações do documento.config', () => {
            // Verificar se os tipos permitidos estão sendo usados
            const allowedTypes = Object.values(documento_config_1.MIME_TYPE_CONFIGS)
                .flatMap(config => config.mimeTypes);
            expect(allowedTypes).toContain('application/pdf');
            expect(allowedTypes).toContain('image/jpeg');
            expect(allowedTypes).toContain('text/plain');
        });
        it('deve usar tipos bloqueados da configuração', () => {
            expect(documento_config_1.BLOCKED_MIME_TYPES).toContain('text/javascript');
            expect(documento_config_1.BLOCKED_MIME_TYPES).toContain('application/zip');
            expect(documento_config_1.BLOCKED_MIME_TYPES).toContain('image/svg+xml');
        });
    });
    describe('casos de uso reais', () => {
        it('deve processar upload de certidão de nascimento (PDF)', async () => {
            const pdfBuffer = Buffer.from([
                0x25, 0x50, 0x44, 0x46, // %PDF
                ...Buffer.from('-1.4\nCertidão de Nascimento\nNome: João da Silva'),
            ]);
            const result = await validator.validateMimeType(pdfBuffer, 'application/pdf', 'certidao_nascimento.pdf', pdfBuffer.length);
            expect(result.isValid).toBe(true);
            expect(result.detectedMimeType).toBe('application/pdf');
        });
        it('deve processar upload de foto de documento (JPEG)', async () => {
            const jpegBuffer = Buffer.from([
                0xFF, 0xD8, 0xFF, 0xE0, // JPEG magic
                ...Buffer.from('fake jpeg image data'),
            ]);
            const result = await validator.validateMimeType(jpegBuffer, 'image/jpeg', 'foto_documento.jpg', jpegBuffer.length);
            expect(result.isValid).toBe(true);
            expect(result.detectedMimeType).toBe('image/jpeg');
        });
        it('deve rejeitar tentativa de upload de malware', async () => {
            const malwareBuffer = Buffer.from('MZ\x90\x00'); // PE header
            const result = await validator.validateMimeType(malwareBuffer, 'application/pdf', 'documento.exe', malwareBuffer.length);
            expect(result.isValid).toBe(false);
            expect(result.securityFlags?.hasDangerousExtension).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGRvY3VtZW50b1xcdmFsaWRhdG9yc1xcX190ZXN0c19fXFxtaW1lLXR5cGUudmFsaWRhdG9yLnNwZWMudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSxnRUFBMkQ7QUFDM0Qsb0VBQXNGO0FBSXRGLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsSUFBSSxTQUE0QixDQUFDO0lBRWpDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxTQUFTLEdBQUcsSUFBSSx1Q0FBaUIsRUFBRSxDQUFDO0lBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxFQUFFLENBQUMsNEJBQTRCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDMUMsK0RBQStEO1lBQy9ELE1BQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7Z0JBQzVCLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxvQkFBb0I7Z0JBQzVDLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsRUFBRSxhQUFhO2FBQy9DLENBQUMsQ0FBQztZQUVILE1BQU0sTUFBTSxHQUFHLE1BQU0sU0FBUyxDQUFDLGdCQUFnQixDQUM3QyxTQUFTLEVBQ1QsaUJBQWlCLEVBQ2pCLGVBQWUsRUFDZixTQUFTLENBQUMsTUFBTSxDQUNqQixDQUFDO1lBRUYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1lBQ3hELE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFD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LENBQUMsQ0FBQyxDQUFDLFlBQVk7WUFFN0QsTUFBTSxNQUFNLEdBQUcsTUFBTSxTQUFTLENBQUMsZ0JBQWdCLENBQzdDLGFBQWEsRUFDYixpQkFBaUIsRUFDakIsZUFBZSxFQUNmLGFBQWEsQ0FBQyxNQUFNLENBQ3JCLENBQUM7WUFFRixNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNuQyxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxxQkFBcUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGRvY3VtZW50b1xcdmFsaWRhdG9yc1xcX190ZXN0c19fXFxtaW1lLXR5cGUudmFsaWRhdG9yLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWltZVR5cGVWYWxpZGF0b3IgfSBmcm9tICcuLi9taW1lLXR5cGUudmFsaWRhdG9yJztcbmltcG9ydCB7IE1JTUVfVFlQRV9DT05GSUdTLCBCTE9DS0VEX01JTUVfVFlQRVMgfSBmcm9tICcuLi8uLi9jb25maWcvZG9jdW1lbnRvLmNvbmZpZyc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuXG5kZXNjcmliZSgnTWltZVR5cGVWYWxpZGF0b3InLCAoKSA9PiB7XG4gIGxldCB2YWxpZGF0b3I6IE1pbWVUeXBlVmFsaWRhdG9yO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHZhbGlkYXRvciA9IG5ldyBNaW1lVHlwZVZhbGlkYXRvcigpO1xuICB9KTtcblxuICBkZXNjcmliZSgndmFsaWRhdGVNaW1lVHlwZScsICgpID0+IHtcbiAgICBpdCgnZGV2ZSB2YWxpZGFyIHVtIFBERiB2w6FsaWRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ3JpYXIgdW0gYnVmZmVyIHF1ZSBzaW11bGEgdW0gUERGIChjb20gbWFnaWMgbnVtYmVyIGNvcnJldG8pXG4gICAgICBjb25zdCBwZGZCdWZmZXIgPSBCdWZmZXIuZnJvbShbXG4gICAgICAgIDB4MjUsIDB4NTAsIDB4NDQsIDB4NDYsIC8vICVQREYgbWFnaWMgbnVtYmVyXG4gICAgICAgIC4uLkJ1ZmZlci5mcm9tKCctMS40XFxuJcOiw6PDj8OTXFxuJyksIC8vIFBERiBoZWFkZXJcbiAgICAgIF0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0b3IudmFsaWRhdGVNaW1lVHlwZShcbiAgICAgICAgcGRmQnVmZmVyLFxuICAgICAgICAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAgICAgJ2RvY3VtZW50by5wZGYnLFxuICAgICAgICBwZGZCdWZmZXIubGVuZ3RoXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmlzVmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmRldGVjdGVkTWltZVR5cGUpLnRvQmUoJ2FwcGxpY2F0aW9uL3BkZicpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5maWxlRXh0ZW5zaW9uKS50b0JlKCdwZGYnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJlamVpdGFyIGFycXVpdm8gY29tIGV4dGVuc8OjbyBwZXJpZ29zYScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCdjb250ZcO6ZG8gcXVhbHF1ZXInKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdG9yLnZhbGlkYXRlTWltZVR5cGUoXG4gICAgICAgIGJ1ZmZlcixcbiAgICAgICAgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsXG4gICAgICAgICdtYWx3YXJlLmV4ZScsXG4gICAgICAgIGJ1ZmZlci5sZW5ndGhcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnNlY3VyaXR5RmxhZ3M/Lmhhc0Rhbmdlcm91c0V4dGVuc2lvbikudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9Db250YWluKCdFeHRlbnPDo28gZGUgYXJxdWl2byBuw6NvIHBlcm1pdGlkYScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmVqZWl0YXIgdGlwbyBNSU1FIGJsb3F1ZWFkbycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKCdjb250ZcO6ZG8nKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdG9yLnZhbGlkYXRlTWltZVR5cGUoXG4gICAgICAgIGJ1ZmZlcixcbiAgICAgICAgJ3RleHQvamF2YXNjcmlwdCcsXG4gICAgICAgICdzY3JpcHQuanMnLFxuICAgICAgICBidWZmZXIubGVuZ3RoXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmlzVmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zZWN1cml0eUZsYWdzPy5pc0Jsb2NrZWRNaW1lVHlwZSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9Db250YWluKCdUaXBvIE1JTUUgYmxvcXVlYWRvJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZWplaXRhciBhcnF1aXZvIHF1ZSBleGNlZGUgdGFtYW5obyBtw6F4aW1vJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20oJ2NvbnRlw7pkbycpO1xuICAgICAgY29uc3QgbGFyZ2VTaXplID0gMjUgKiAxMDI0ICogMTAyNDsgLy8gMjVNQiAobWFpb3IgcXVlIG8gbGltaXRlIGdsb2JhbClcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdG9yLnZhbGlkYXRlTWltZVR5cGUoXG4gICAgICAgIGJ1ZmZlcixcbiAgICAgICAgJ2FwcGxpY2F0aW9uL3BkZicsXG4gICAgICAgICdkb2N1bWVudG8ucGRmJyxcbiAgICAgICAgbGFyZ2VTaXplXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmlzVmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zZWN1cml0eUZsYWdzPy5leGNlZWRzTWF4U2l6ZSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9Db250YWluKCdleGNlZGUgbyB0YW1hbmhvIG3DoXhpbW8nKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGRldGVjdGFyIG1pc21hdGNoIGVudHJlIHRpcG8gZGVjbGFyYWRvIGUgZGV0ZWN0YWRvJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQnVmZmVyIHF1ZSBzaW11bGEgdW1hIGltYWdlbSBKUEVHXG4gICAgICBjb25zdCBqcGVnQnVmZmVyID0gQnVmZmVyLmZyb20oW1xuICAgICAgICAweEZGLCAweEQ4LCAweEZGLCAweEUwLCAvLyBKUEVHIG1hZ2ljIG51bWJlclxuICAgICAgICAuLi5CdWZmZXIuZnJvbSgnZmFrZSBqcGVnIGNvbnRlbnQnKSxcbiAgICAgIF0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0b3IudmFsaWRhdGVNaW1lVHlwZShcbiAgICAgICAganBlZ0J1ZmZlcixcbiAgICAgICAgJ2FwcGxpY2F0aW9uL3BkZicsIC8vIFRpcG8gZGVjbGFyYWRvIGluY29ycmV0b1xuICAgICAgICAnaW1hZ2VtLmpwZycsXG4gICAgICAgIGpwZWdCdWZmZXIubGVuZ3RoXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmlzVmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zZWN1cml0eUZsYWdzPy5tYWdpY051bWJlck1pc21hdGNoKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZXNzYWdlKS50b0NvbnRhaW4oJ27Do28gY29ycmVzcG9uZGUgYW8gdGlwbyByZWFsJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSB2YWxpZGFyIGFycXVpdm8gZGUgdGV4dG8gc2ltcGxlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRleHRCdWZmZXIgPSBCdWZmZXIuZnJvbSgnRXN0ZSDDqSB1bSBhcnF1aXZvIGRlIHRleHRvIHNpbXBsZXMuXFxuQ29tIHF1ZWJyYXMgZGUgbGluaGEuJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZhbGlkYXRvci52YWxpZGF0ZU1pbWVUeXBlKFxuICAgICAgICB0ZXh0QnVmZmVyLFxuICAgICAgICAndGV4dC9wbGFpbicsXG4gICAgICAgICdkb2N1bWVudG8udHh0JyxcbiAgICAgICAgdGV4dEJ1ZmZlci5sZW5ndGhcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGV0ZWN0ZWRNaW1lVHlwZSkudG9CZSgndGV4dC9wbGFpbicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZGV0ZWN0YXIgY29udGXDumRvIHN1c3BlaXRvIGVtIGFycXVpdm8nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdXNwaWNpb3VzQnVmZmVyID0gQnVmZmVyLmZyb20oYFxuICAgICAgICBDb250ZcO6ZG8gbm9ybWFsIGRvIGFycXVpdm9cbiAgICAgICAgPHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD5cbiAgICAgICAgTWFpcyBjb250ZcO6ZG9cbiAgICAgIGApO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0b3IudmFsaWRhdGVNaW1lVHlwZShcbiAgICAgICAgc3VzcGljaW91c0J1ZmZlcixcbiAgICAgICAgJ3RleHQvcGxhaW4nLFxuICAgICAgICAnYXJxdWl2by50eHQnLFxuICAgICAgICBzdXNwaWNpb3VzQnVmZmVyLmxlbmd0aFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc2VjdXJpdHlGbGFncz8uaXNTdXNwaWNpb3VzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zZWN1cml0eUZsYWdzPy5oYXNFbWJlZGRlZENvbnRlbnQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbignY29udGXDumRvIHN1c3BlaXRvJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBkZXRlY3RhciBKYXZhU2NyaXB0IGVtIFBERicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBkZldpdGhKc0J1ZmZlciA9IEJ1ZmZlci5mcm9tKGBcbiAgICAgICAgJVBERi0xLjRcbiAgICAgICAgL0phdmFTY3JpcHQgKGFsZXJ0KCdtYWxpY2lvdXMnKSlcbiAgICAgICAgL0pTIChkb2N1bWVudC5jb29raWUpXG4gICAgICAgIHJlc3RvIGRvIGNvbnRlw7pkbyBQREZcbiAgICAgIGApO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0b3IudmFsaWRhdGVNaW1lVHlwZShcbiAgICAgICAgcGRmV2l0aEpzQnVmZmVyLFxuICAgICAgICAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAgICAgJ2RvY3VtZW50by5wZGYnLFxuICAgICAgICBwZGZXaXRoSnNCdWZmZXIubGVuZ3RoXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmlzVmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zZWN1cml0eUZsYWdzPy5pc1N1c3BpY2lvdXMpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbignSmF2YVNjcmlwdCBpbmNvcnBvcmFkbycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZGV0ZWN0YXIgYWx0YSBkZW5zaWRhZGUgZGUgY2FyYWN0ZXJlcyBuw6NvLUFTQ0lJJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ3JpYXIgYnVmZmVyIGNvbSBtdWl0b3MgY2FyYWN0ZXJlcyBuw6NvLUFTQ0lJIChwb3Nzw612ZWwgb2Z1c2Nhw6fDo28pXG4gICAgICBjb25zdCBvYmZ1c2NhdGVkQnVmZmVyID0gQnVmZmVyLmZyb20oXG4gICAgICAgICd0ZXh0bycgKyAnXFx4ODBcXHg4MVxceDgyXFx4ODNcXHg4NFxceDg1XFx4ODZcXHg4N1xceDg4XFx4ODknLnJlcGVhdCgyMClcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZhbGlkYXRvci52YWxpZGF0ZU1pbWVUeXBlKFxuICAgICAgICBvYmZ1c2NhdGVkQnVmZmVyLFxuICAgICAgICAndGV4dC9wbGFpbicsXG4gICAgICAgICdhcnF1aXZvLnR4dCcsXG4gICAgICAgIG9iZnVzY2F0ZWRCdWZmZXIubGVuZ3RoXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmlzVmFsaWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zZWN1cml0eUZsYWdzPy5pc1N1c3BpY2lvdXMpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQ29udGFpbignY2FyYWN0ZXJlcyBuw6NvLUFTQ0lJJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZW5lcmF0ZUZpbGVIYXNoJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIGdlcmFyIGhhc2ggU0hBMjU2IGNvbnNpc3RlbnRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20oJ2NvbnRlw7pkbyBkZSB0ZXN0ZScpO1xuICAgICAgXG4gICAgICBjb25zdCBoYXNoMSA9IHZhbGlkYXRvci5nZW5lcmF0ZUZpbGVIYXNoKGJ1ZmZlcik7XG4gICAgICBjb25zdCBoYXNoMiA9IHZhbGlkYXRvci5nZW5lcmF0ZUZpbGVIYXNoKGJ1ZmZlcik7XG4gICAgICBcbiAgICAgIGV4cGVjdChoYXNoMSkudG9CZShoYXNoMik7XG4gICAgICBleHBlY3QoaGFzaDEpLnRvSGF2ZUxlbmd0aCg2NCk7IC8vIFNIQTI1NiBlbSBoZXhcbiAgICAgIGV4cGVjdChoYXNoMSkudG9NYXRjaCgvXlthLWYwLTldezY0fSQvKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGdlcmFyIGhhc2hlcyBkaWZlcmVudGVzIHBhcmEgY29udGXDumRvcyBkaWZlcmVudGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgYnVmZmVyMSA9IEJ1ZmZlci5mcm9tKCdjb250ZcO6ZG8gMScpO1xuICAgICAgY29uc3QgYnVmZmVyMiA9IEJ1ZmZlci5mcm9tKCdjb250ZcO6ZG8gMicpO1xuICAgICAgXG4gICAgICBjb25zdCBoYXNoMSA9IHZhbGlkYXRvci5nZW5lcmF0ZUZpbGVIYXNoKGJ1ZmZlcjEpO1xuICAgICAgY29uc3QgaGFzaDIgPSB2YWxpZGF0b3IuZ2VuZXJhdGVGaWxlSGFzaChidWZmZXIyKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGhhc2gxKS5ub3QudG9CZShoYXNoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdyZXF1aXJlc0VuY3J5cHRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgdHJ1ZSBwYXJhIGRvY3VtZW50b3Mgc2Vuc8OtdmVpcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNlbnNpdGl2ZVR5cGVzID0gW1xuICAgICAgICAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAgICAgJ2FwcGxpY2F0aW9uL21zd29yZCcsXG4gICAgICAgICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudCcsXG4gICAgICBdO1xuXG4gICAgICBzZW5zaXRpdmVUeXBlcy5mb3JFYWNoKG1pbWVUeXBlID0+IHtcbiAgICAgICAgZXhwZWN0KHZhbGlkYXRvci5yZXF1aXJlc0VuY3J5cHRpb24obWltZVR5cGUpKS50b0JlKHRydWUpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBmYWxzZSBwYXJhIGltYWdlbnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbWFnZVR5cGVzID0gW1xuICAgICAgICAnaW1hZ2UvanBlZycsXG4gICAgICAgICdpbWFnZS9wbmcnLFxuICAgICAgXTtcblxuICAgICAgaW1hZ2VUeXBlcy5mb3JFYWNoKG1pbWVUeXBlID0+IHtcbiAgICAgICAgZXhwZWN0KHZhbGlkYXRvci5yZXF1aXJlc0VuY3J5cHRpb24obWltZVR5cGUpKS50b0JlKGZhbHNlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYWxsb3dzVGh1bWJuYWlsJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHJldG9ybmFyIHRydWUgcGFyYSBpbWFnZW5zJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW1hZ2VUeXBlcyA9IFtcbiAgICAgICAgJ2ltYWdlL2pwZWcnLFxuICAgICAgICAnaW1hZ2UvcG5nJyxcbiAgICAgIF07XG5cbiAgICAgIGltYWdlVHlwZXMuZm9yRWFjaChtaW1lVHlwZSA9PiB7XG4gICAgICAgIGV4cGVjdCh2YWxpZGF0b3IuYWxsb3dzVGh1bWJuYWlsKG1pbWVUeXBlKSkudG9CZSh0cnVlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgcmV0b3JuYXIgdHJ1ZSBwYXJhIFBERnMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodmFsaWRhdG9yLmFsbG93c1RodW1ibmFpbCgnYXBwbGljYXRpb24vcGRmJykpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZXRvcm5hciBmYWxzZSBwYXJhIGRvY3VtZW50b3MgZG8gT2ZmaWNlJywgKCkgPT4ge1xuICAgICAgY29uc3Qgb2ZmaWNlVHlwZXMgPSBbXG4gICAgICAgICdhcHBsaWNhdGlvbi9tc3dvcmQnLFxuICAgICAgICAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQnLFxuICAgICAgICAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwuc2hlZXQnLFxuICAgICAgXTtcblxuICAgICAgb2ZmaWNlVHlwZXMuZm9yRWFjaChtaW1lVHlwZSA9PiB7XG4gICAgICAgIGV4cGVjdCh2YWxpZGF0b3IuYWxsb3dzVGh1bWJuYWlsKG1pbWVUeXBlKSkudG9CZShmYWxzZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FuYWx5emVGaWxlQ29udGVudCcsICgpID0+IHtcbiAgICBpdCgnZGV2ZSBkZXRlY3RhciB0YWdzIGRlIHNjcmlwdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBCdWZmZXIuZnJvbSgnPHNjcmlwdD5hbGVydChcInhzc1wiKTwvc2NyaXB0PicpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0b3JbJ2FuYWx5emVGaWxlQ29udGVudCddKGNvbnRlbnQsICd0ZXh0L2h0bWwnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1N1c3BpY2lvdXMpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lmhhc0VtYmVkZGVkQ29udGVudCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVhc29uKS50b0NvbnRhaW4oJ3NjcmlwdCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZGV0ZWN0YXIgVVJMcyBqYXZhc2NyaXB0JywgKCkgPT4ge1xuICAgICAgY29uc3QgY29udGVudCA9IEJ1ZmZlci5mcm9tKCdocmVmPVwiamF2YXNjcmlwdDphbGVydCgxKVwiJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRvclsnYW5hbHl6ZUZpbGVDb250ZW50J10oY29udGVudCwgJ3RleHQvaHRtbCcpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LmlzU3VzcGljaW91cykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuaGFzRW1iZWRkZWRDb250ZW50KS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RldmUgZGV0ZWN0YXIgZXZlbnQgaGFuZGxlcnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb250ZW50ID0gQnVmZmVyLmZyb20oJzxpbWcgb25sb2FkPVwibWFsaWNpb3VzKClcIiAvPicpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSB2YWxpZGF0b3JbJ2FuYWx5emVGaWxlQ29udGVudCddKGNvbnRlbnQsICd0ZXh0L2h0bWwnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1N1c3BpY2lvdXMpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lmhhc0VtYmVkZGVkQ29udGVudCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGRldGVjdGFyIG51bGwgYnl0ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb250ZW50ID0gQnVmZmVyLmZyb20oJ3RleHRvXFx4MDBjb21cXHgwMG51bGxcXHgwMGJ5dGVzJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRvclsnYW5hbHl6ZUZpbGVDb250ZW50J10oY29udGVudCwgJ3RleHQvcGxhaW4nKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1N1c3BpY2lvdXMpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnbsOjbyBkZXZlIGRldGVjdGFyIGNvbnRlw7pkbyBub3JtYWwgY29tbyBzdXNwZWl0bycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBCdWZmZXIuZnJvbShgXG4gICAgICAgIEVzdGUgw6kgdW0gZG9jdW1lbnRvIG5vcm1hbC5cbiAgICAgICAgQ29udMOpbSB0ZXh0bywgbsO6bWVyb3MgMTIzIGUgcG9udHVhw6fDo28hXG4gICAgICAgIEVtYWlsOiB1c3VhcmlvQGV4ZW1wbG8uY29tXG4gICAgICAgIFVSTDogaHR0cHM6Ly9leGVtcGxvLmNvbVxuICAgICAgYCk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHZhbGlkYXRvclsnYW5hbHl6ZUZpbGVDb250ZW50J10oY29udGVudCwgJ3RleHQvcGxhaW4nKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1N1c3BpY2lvdXMpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5oYXNFbWJlZGRlZENvbnRlbnQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXh0cmFjdEZpbGVFeHRlbnNpb24nLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgZXh0cmFpciBleHRlbnPDo28gY29ycmV0YW1lbnRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdENhc2VzID0gW1xuICAgICAgICB7IGZpbGVuYW1lOiAnZG9jdW1lbnRvLnBkZicsIGV4cGVjdGVkOiAncGRmJyB9LFxuICAgICAgICB7IGZpbGVuYW1lOiAnaW1hZ2VtLkpQRUcnLCBleHBlY3RlZDogJ2pwZWcnIH0sXG4gICAgICAgIHsgZmlsZW5hbWU6ICdhcnF1aXZvLmNvbS5leHRlbnNhby50eHQnLCBleHBlY3RlZDogJ3R4dCcgfSxcbiAgICAgICAgeyBmaWxlbmFtZTogJ3NlbV9leHRlbnNhbycsIGV4cGVjdGVkOiAnJyB9LFxuICAgICAgICB7IGZpbGVuYW1lOiAnLmhpZGRlbicsIGV4cGVjdGVkOiAnaGlkZGVuJyB9LFxuICAgICAgXTtcblxuICAgICAgdGVzdENhc2VzLmZvckVhY2goKHsgZmlsZW5hbWUsIGV4cGVjdGVkIH0pID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdmFsaWRhdG9yWydleHRyYWN0RmlsZUV4dGVuc2lvbiddKGZpbGVuYW1lKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShleHBlY3RlZCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ludGVncmHDp8OjbyBjb20gY29uZmlndXJhw6fDo28nLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgdXNhciBjb25maWd1cmHDp8O1ZXMgZG8gZG9jdW1lbnRvLmNvbmZpZycsICgpID0+IHtcbiAgICAgIC8vIFZlcmlmaWNhciBzZSBvcyB0aXBvcyBwZXJtaXRpZG9zIGVzdMOjbyBzZW5kbyB1c2Fkb3NcbiAgICAgIGNvbnN0IGFsbG93ZWRUeXBlcyA9IE9iamVjdC52YWx1ZXMoTUlNRV9UWVBFX0NPTkZJR1MpXG4gICAgICAgIC5mbGF0TWFwKGNvbmZpZyA9PiBjb25maWcubWltZVR5cGVzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGFsbG93ZWRUeXBlcykudG9Db250YWluKCdhcHBsaWNhdGlvbi9wZGYnKTtcbiAgICAgIGV4cGVjdChhbGxvd2VkVHlwZXMpLnRvQ29udGFpbignaW1hZ2UvanBlZycpO1xuICAgICAgZXhwZWN0KGFsbG93ZWRUeXBlcykudG9Db250YWluKCd0ZXh0L3BsYWluJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSB1c2FyIHRpcG9zIGJsb3F1ZWFkb3MgZGEgY29uZmlndXJhw6fDo28nLCAoKSA9PiB7XG4gICAgICBleHBlY3QoQkxPQ0tFRF9NSU1FX1RZUEVTKS50b0NvbnRhaW4oJ3RleHQvamF2YXNjcmlwdCcpO1xuICAgICAgZXhwZWN0KEJMT0NLRURfTUlNRV9UWVBFUykudG9Db250YWluKCdhcHBsaWNhdGlvbi96aXAnKTtcbiAgICAgIGV4cGVjdChCTE9DS0VEX01JTUVfVFlQRVMpLnRvQ29udGFpbignaW1hZ2Uvc3ZnK3htbCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY2Fzb3MgZGUgdXNvIHJlYWlzJywgKCkgPT4ge1xuICAgIGl0KCdkZXZlIHByb2Nlc3NhciB1cGxvYWQgZGUgY2VydGlkw6NvIGRlIG5hc2NpbWVudG8gKFBERiknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwZGZCdWZmZXIgPSBCdWZmZXIuZnJvbShbXG4gICAgICAgIDB4MjUsIDB4NTAsIDB4NDQsIDB4NDYsIC8vICVQREZcbiAgICAgICAgLi4uQnVmZmVyLmZyb20oJy0xLjRcXG5DZXJ0aWTDo28gZGUgTmFzY2ltZW50b1xcbk5vbWU6IEpvw6NvIGRhIFNpbHZhJyksXG4gICAgICBdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdG9yLnZhbGlkYXRlTWltZVR5cGUoXG4gICAgICAgIHBkZkJ1ZmZlcixcbiAgICAgICAgJ2FwcGxpY2F0aW9uL3BkZicsXG4gICAgICAgICdjZXJ0aWRhb19uYXNjaW1lbnRvLnBkZicsXG4gICAgICAgIHBkZkJ1ZmZlci5sZW5ndGhcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGV0ZWN0ZWRNaW1lVHlwZSkudG9CZSgnYXBwbGljYXRpb24vcGRmJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSBwcm9jZXNzYXIgdXBsb2FkIGRlIGZvdG8gZGUgZG9jdW1lbnRvIChKUEVHKScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGpwZWdCdWZmZXIgPSBCdWZmZXIuZnJvbShbXG4gICAgICAgIDB4RkYsIDB4RDgsIDB4RkYsIDB4RTAsIC8vIEpQRUcgbWFnaWNcbiAgICAgICAgLi4uQnVmZmVyLmZyb20oJ2Zha2UganBlZyBpbWFnZSBkYXRhJyksXG4gICAgICBdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmFsaWRhdG9yLnZhbGlkYXRlTWltZVR5cGUoXG4gICAgICAgIGpwZWdCdWZmZXIsXG4gICAgICAgICdpbWFnZS9qcGVnJyxcbiAgICAgICAgJ2ZvdG9fZG9jdW1lbnRvLmpwZycsXG4gICAgICAgIGpwZWdCdWZmZXIubGVuZ3RoXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmlzVmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmRldGVjdGVkTWltZVR5cGUpLnRvQmUoJ2ltYWdlL2pwZWcnKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIHJlamVpdGFyIHRlbnRhdGl2YSBkZSB1cGxvYWQgZGUgbWFsd2FyZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1hbHdhcmVCdWZmZXIgPSBCdWZmZXIuZnJvbSgnTVpcXHg5MFxceDAwJyk7IC8vIFBFIGhlYWRlclxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB2YWxpZGF0b3IudmFsaWRhdGVNaW1lVHlwZShcbiAgICAgICAgbWFsd2FyZUJ1ZmZlcixcbiAgICAgICAgJ2FwcGxpY2F0aW9uL3BkZicsXG4gICAgICAgICdkb2N1bWVudG8uZXhlJyxcbiAgICAgICAgbWFsd2FyZUJ1ZmZlci5sZW5ndGhcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnNlY3VyaXR5RmxhZ3M/Lmhhc0Rhbmdlcm91c0V4dGVuc2lvbikudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=