79e5870975baf2c1429350996221c86b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const auditoria_middleware_1 = require("../../middlewares/auditoria.middleware");
const auditoria_service_1 = require("../../services/auditoria.service");
const auditoria_queue_service_1 = require("../../services/auditoria-queue.service");
const tipo_operacao_enum_1 = require("../../../auditoria/enums/tipo-operacao.enum");
const create_log_auditoria_dto_1 = require("../../dto/create-log-auditoria.dto");
const entities_1 = require("../../entities");
// Função auxiliar para criar um mock do objeto Request do Express
function createMockRequest(options = {}) {
    const mockRequest = {
        get: jest.fn(),
        header: jest.fn(),
        accepts: jest.fn(),
        acceptsCharsets: jest.fn(),
        acceptsEncodings: jest.fn(),
        acceptsLanguages: jest.fn(),
        acceptsTypes: jest.fn(),
        range: jest.fn(),
        param: jest.fn(),
        is: jest.fn(),
        cookies: {},
        signedCookies: {},
        query: {},
        params: {},
        route: {},
        secure: false,
        stale: false,
        xhr: false,
        fresh: false,
        protocol: 'http',
        hostname: 'localhost',
        subdomains: [],
        baseUrl: '',
        path: '',
        url: '',
        app: {},
        res: {},
        next: jest.fn(),
        ...options,
    };
    return mockRequest;
}
// Função auxiliar para criar um mock do objeto Response do Express
function createMockResponse(options = {}) {
    const mockResponse = {
        status: jest.fn().mockReturnThis(),
        sendStatus: jest.fn().mockReturnThis(),
        json: jest.fn().mockReturnThis(),
        send: jest.fn().mockReturnThis(),
        end: jest.fn().mockReturnThis(),
        type: jest.fn().mockReturnThis(),
        cookie: jest.fn().mockReturnThis(),
        clearCookie: jest.fn().mockReturnThis(),
        redirect: jest.fn().mockReturnThis(),
        render: jest.fn().mockReturnThis(),
        set: jest.fn().mockReturnThis(),
        setHeader: jest.fn().mockReturnThis(),
        get: jest.fn(),
        getHeader: jest.fn(),
        getHeaders: jest.fn(),
        contentType: jest.fn().mockReturnThis(),
        format: jest.fn(),
        attachment: jest.fn().mockReturnThis(),
        append: jest.fn().mockReturnThis(),
        header: jest.fn().mockReturnThis(),
        headersSent: false,
        locals: {},
        charset: '',
        app: {},
        req: {},
        on: jest.fn().mockImplementation((event, callback) => {
            if (event === 'finish') {
                callback();
            }
            return mockResponse;
        }),
        ...options,
    };
    return mockResponse;
}
describe('AuditoriaMiddleware', () => {
    let middleware;
    let auditoriaService;
    const mockAuditoriaService = {
        create: jest.fn(),
    };
    const mockAuditoriaQueueService = {
        enfileirarLogAuditoria: jest.fn(),
        enfileirarAcessoDadosSensiveis: jest.fn(),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                auditoria_middleware_1.AuditoriaMiddleware,
                {
                    provide: auditoria_service_1.AuditoriaService,
                    useValue: mockAuditoriaService,
                },
                {
                    provide: auditoria_queue_service_1.AuditoriaQueueService,
                    useValue: mockAuditoriaQueueService,
                },
            ],
        }).compile();
        middleware = module.get(auditoria_middleware_1.AuditoriaMiddleware);
        auditoriaService = module.get(auditoria_service_1.AuditoriaService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    it('deve ser definido', () => {
        expect(middleware).toBeDefined();
    });
    describe('use', () => {
        it('deve registrar operação GET', () => {
            // Arrange
            const req = createMockRequest({
                method: 'GET',
                originalUrl: '/api/documentos/123',
                user: { id: 'user-123', nome: 'Usuário Teste' },
                ip: '127.0.0.1',
                headers: {},
            });
            const res = createMockResponse({
                statusCode: 200,
            });
            const next = jest.fn();
            const expectedLogDto = new create_log_auditoria_dto_1.CreateLogAuditoriaDto();
            expectedLogDto.tipo_operacao = tipo_operacao_enum_1.TipoOperacao.READ;
            expectedLogDto.entidade_afetada = 'documentos';
            expectedLogDto.entidade_id = '123';
            expectedLogDto.descricao = 'Consulta de documento';
            expectedLogDto.dados_anteriores = {};
            expectedLogDto.dados_novos = {};
            expectedLogDto.usuario_id = 'user-123';
            expectedLogDto.ip_origem = '127.0.0.1';
            const mockLogAuditoria = new entities_1.LogAuditoria();
            mockAuditoriaService.create.mockResolvedValue(mockLogAuditoria);
            // Act
            middleware.use(req, res, next);
            // Assert
            expect(next).toHaveBeenCalled();
            expect(res.on).toHaveBeenCalledWith('finish', expect.any(Function));
            expect(auditoriaService.create).toHaveBeenCalledWith(expect.objectContaining({
                tipo_operacao: tipo_operacao_enum_1.TipoOperacao.READ,
                entidade_afetada: 'documentos',
                entidade_id: '123',
                usuario_id: 'user-123',
                ip_origem: '127.0.0.1',
            }));
        });
        it('deve registrar operação POST', () => {
            // Arrange
            const req = createMockRequest({
                method: 'POST',
                originalUrl: '/api/documentos',
                user: { id: 'user-123', nome: 'Usuário Teste' },
                ip: '127.0.0.1',
                headers: {},
                body: { nome: 'Documento Teste', conteudo: 'Conteúdo do documento' },
            });
            const res = createMockResponse({
                statusCode: 201,
            });
            const next = jest.fn();
            const mockLogAuditoria = new entities_1.LogAuditoria();
            mockAuditoriaService.create.mockResolvedValue(mockLogAuditoria);
            // Act
            middleware.use(req, res, next);
            // Assert
            expect(next).toHaveBeenCalled();
            expect(res.on).toHaveBeenCalledWith('finish', expect.any(Function));
            expect(auditoriaService.create).toHaveBeenCalledWith(expect.objectContaining({
                tipo_operacao: tipo_operacao_enum_1.TipoOperacao.CREATE,
                entidade_afetada: 'documentos',
                dados_novos: req.body,
                usuario_id: 'user-123',
                ip_origem: '127.0.0.1',
            }));
        });
        it('deve registrar operação PUT', () => {
            // Arrange
            const req = createMockRequest({
                method: 'PUT',
                originalUrl: '/api/documentos/123',
                user: { id: 'user-123', nome: 'Usuário Teste' },
                ip: '127.0.0.1',
                headers: {},
                body: { nome: 'Documento Atualizado', conteudo: 'Novo conteúdo' },
            });
            const res = createMockResponse({
                statusCode: 200,
            });
            const next = jest.fn();
            const mockLogAuditoria = new entities_1.LogAuditoria();
            mockAuditoriaService.create.mockResolvedValue(mockLogAuditoria);
            // Act
            middleware.use(req, res, next);
            // Assert
            expect(next).toHaveBeenCalled();
            expect(res.on).toHaveBeenCalledWith('finish', expect.any(Function));
            expect(auditoriaService.create).toHaveBeenCalledWith(expect.objectContaining({
                tipo_operacao: tipo_operacao_enum_1.TipoOperacao.UPDATE,
                entidade_afetada: 'documentos',
                entidade_id: '123',
                dados_novos: req.body,
                usuario_id: 'user-123',
                ip_origem: '127.0.0.1',
            }));
        });
        it('deve registrar operação DELETE', () => {
            // Arrange
            const req = createMockRequest({
                method: 'DELETE',
                originalUrl: '/api/documentos/123',
                user: { id: 'user-123', nome: 'Usuário Teste' },
                ip: '127.0.0.1',
                headers: {},
            });
            const res = createMockResponse({
                statusCode: 204,
            });
            const next = jest.fn();
            const mockLogAuditoria = new entities_1.LogAuditoria();
            mockAuditoriaService.create.mockResolvedValue(mockLogAuditoria);
            // Act
            middleware.use(req, res, next);
            // Assert
            expect(next).toHaveBeenCalled();
            expect(res.on).toHaveBeenCalledWith('finish', expect.any(Function));
            expect(auditoriaService.create).toHaveBeenCalledWith(expect.objectContaining({
                tipo_operacao: tipo_operacao_enum_1.TipoOperacao.DELETE,
                entidade_afetada: 'documentos',
                entidade_id: '123',
                usuario_id: 'user-123',
                ip_origem: '127.0.0.1',
            }));
        });
        it('deve registrar operação PATCH', () => {
            // Arrange
            const req = createMockRequest({
                method: 'PATCH',
                originalUrl: '/api/documentos/123',
                user: { id: 'user-123', nome: 'Usuário Teste' },
                ip: '127.0.0.1',
                headers: {},
            });
            const res = createMockResponse({
                statusCode: 200,
            });
            const next = jest.fn();
            // Act
            middleware.use(req, res, next);
            // Assert
            expect(next).toHaveBeenCalled();
            expect(res.on).toHaveBeenCalledWith('finish', expect.any(Function));
            expect(auditoriaService.create).toHaveBeenCalledWith(expect.objectContaining({
                tipo_operacao: tipo_operacao_enum_1.TipoOperacao.UPDATE,
                entidade_afetada: 'documentos',
                entidade_id: '123',
                usuario_id: 'user-123',
                ip_origem: '127.0.0.1',
            }));
        });
        it('não deve registrar operações para rotas ignoradas', () => {
            // Arrange
            const req = createMockRequest({
                method: 'GET',
                originalUrl: '/api/health',
                user: { id: 'user-123', nome: 'Usuário Teste' },
                ip: '127.0.0.1',
                headers: {},
            });
            const res = createMockResponse({
                statusCode: 200,
            });
            const next = jest.fn();
            // Act
            middleware.use(req, res, next);
            // Assert
            expect(next).toHaveBeenCalled();
            expect(auditoriaService.create).not.toHaveBeenCalled();
        });
        it('deve lidar com requisições sem usuário autenticado', () => {
            // Arrange
            const req = createMockRequest({
                method: 'GET',
                originalUrl: '/api/documentos/123',
                user: null,
                ip: '127.0.0.1',
                headers: {},
            });
            const res = createMockResponse({
                statusCode: 200,
            });
            const next = jest.fn();
            const mockLogAuditoria = new entities_1.LogAuditoria();
            mockAuditoriaService.create.mockResolvedValue(mockLogAuditoria);
            // Act
            middleware.use(req, res, next);
            // Assert
            expect(next).toHaveBeenCalled();
            expect(res.on).toHaveBeenCalledWith('finish', expect.any(Function));
            expect(auditoriaService.create).toHaveBeenCalledWith(expect.objectContaining({
                tipo_operacao: tipo_operacao_enum_1.TipoOperacao.READ,
                entidade_afetada: 'documentos',
                entidade_id: '123',
                usuario_id: null,
                ip_origem: '127.0.0.1',
            }));
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGF1ZGl0b3JpYVxcdGVzdHNcXG1pZGRsZXdhcmVzXFxhdWRpdG9yaWEubWlkZGxld2FyZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELGlGQUE2RTtBQUM3RSx3RUFBb0U7QUFDcEUsb0ZBQStFO0FBQy9FLG9GQUEyRTtBQUMzRSxpRkFBMkU7QUFDM0UsNkNBQThDO0FBRzlDLGtFQUFrRTtBQUNsRSxTQUFTLGlCQUFpQixDQUFDLFVBQWUsRUFBRTtJQUMxQyxNQUFNLFdBQVcsR0FBRztRQUNsQixHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNkLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2pCLE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2xCLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQzFCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDM0IsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUMzQixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUN2QixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNoQixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNoQixFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNiLE9BQU8sRUFBRSxFQUFFO1FBQ1gsYUFBYSxFQUFFLEVBQUU7UUFDakIsS0FBSyxFQUFFLEVBQUU7UUFDVCxNQUFNLEVBQUUsRUFBRTtRQUNWLEtBQUssRUFBRSxFQUFFO1FBQ1QsTUFBTSxFQUFFLEtBQUs7UUFDYixLQUFLLEVBQUUsS0FBSztRQUNaLEdBQUcsRUFBRSxLQUFLO1FBQ1YsS0FBSyxFQUFFLEtBQUs7UUFDWixRQUFRLEVBQUUsTUFBTTtRQUNoQixRQUFRLEVB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QUNILENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGF1ZGl0b3JpYVxcdGVzdHNcXG1pZGRsZXdhcmVzXFxhdWRpdG9yaWEubWlkZGxld2FyZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgQXVkaXRvcmlhTWlkZGxld2FyZSB9IGZyb20gJy4uLy4uL21pZGRsZXdhcmVzL2F1ZGl0b3JpYS5taWRkbGV3YXJlJztcbmltcG9ydCB7IEF1ZGl0b3JpYVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9hdWRpdG9yaWEuc2VydmljZSc7XG5pbXBvcnQgeyBBdWRpdG9yaWFRdWV1ZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9hdWRpdG9yaWEtcXVldWUuc2VydmljZSc7XG5pbXBvcnQgeyBUaXBvT3BlcmFjYW8gfSBmcm9tICcuLi8uLi8uLi9hdWRpdG9yaWEvZW51bXMvdGlwby1vcGVyYWNhby5lbnVtJztcbmltcG9ydCB7IENyZWF0ZUxvZ0F1ZGl0b3JpYUR0byB9IGZyb20gJy4uLy4uL2R0by9jcmVhdGUtbG9nLWF1ZGl0b3JpYS5kdG8nO1xuaW1wb3J0IHsgTG9nQXVkaXRvcmlhIH0gZnJvbSAnLi4vLi4vZW50aXRpZXMnO1xuaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJztcblxuLy8gRnVuw6fDo28gYXV4aWxpYXIgcGFyYSBjcmlhciB1bSBtb2NrIGRvIG9iamV0byBSZXF1ZXN0IGRvIEV4cHJlc3NcbmZ1bmN0aW9uIGNyZWF0ZU1vY2tSZXF1ZXN0KG9wdGlvbnM6IGFueSA9IHt9KTogUmVxdWVzdCB7XG4gIGNvbnN0IG1vY2tSZXF1ZXN0ID0ge1xuICAgIGdldDogamVzdC5mbigpLFxuICAgIGhlYWRlcjogamVzdC5mbigpLFxuICAgIGFjY2VwdHM6IGplc3QuZm4oKSxcbiAgICBhY2NlcHRzQ2hhcnNldHM6IGplc3QuZm4oKSxcbiAgICBhY2NlcHRzRW5jb2RpbmdzOiBqZXN0LmZuKCksXG4gICAgYWNjZXB0c0xhbmd1YWdlczogamVzdC5mbigpLFxuICAgIGFjY2VwdHNUeXBlczogamVzdC5mbigpLFxuICAgIHJhbmdlOiBqZXN0LmZuKCksXG4gICAgcGFyYW06IGplc3QuZm4oKSxcbiAgICBpczogamVzdC5mbigpLFxuICAgIGNvb2tpZXM6IHt9LFxuICAgIHNpZ25lZENvb2tpZXM6IHt9LFxuICAgIHF1ZXJ5OiB7fSxcbiAgICBwYXJhbXM6IHt9LFxuICAgIHJvdXRlOiB7fSxcbiAgICBzZWN1cmU6IGZhbHNlLFxuICAgIHN0YWxlOiBmYWxzZSxcbiAgICB4aHI6IGZhbHNlLFxuICAgIGZyZXNoOiBmYWxzZSxcbiAgICBwcm90b2NvbDogJ2h0dHAnLFxuICAgIGhvc3RuYW1lOiAnbG9jYWxob3N0JyxcbiAgICBzdWJkb21haW5zOiBbXSxcbiAgICBiYXNlVXJsOiAnJyxcbiAgICBwYXRoOiAnJyxcbiAgICB1cmw6ICcnLFxuICAgIGFwcDoge30sXG4gICAgcmVzOiB7fSxcbiAgICBuZXh0OiBqZXN0LmZuKCksXG4gICAgLi4ub3B0aW9ucyxcbiAgfTtcblxuICByZXR1cm4gbW9ja1JlcXVlc3QgYXMgdW5rbm93biBhcyBSZXF1ZXN0O1xufVxuXG4vLyBGdW7Dp8OjbyBhdXhpbGlhciBwYXJhIGNyaWFyIHVtIG1vY2sgZG8gb2JqZXRvIFJlc3BvbnNlIGRvIEV4cHJlc3NcbmZ1bmN0aW9uIGNyZWF0ZU1vY2tSZXNwb25zZShvcHRpb25zOiBhbnkgPSB7fSk6IFJlc3BvbnNlIHtcbiAgY29uc3QgbW9ja1Jlc3BvbnNlID0ge1xuICAgIHN0YXR1czogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgc2VuZFN0YXR1czogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAganNvbjogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgc2VuZDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgZW5kOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICB0eXBlOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICBjb29raWU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgIGNsZWFyQ29va2llOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICByZWRpcmVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgcmVuZGVyOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICBzZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgIHNldEhlYWRlcjogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgZ2V0SGVhZGVyOiBqZXN0LmZuKCksXG4gICAgZ2V0SGVhZGVyczogamVzdC5mbigpLFxuICAgIGNvbnRlbnRUeXBlOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICBmb3JtYXQ6IGplc3QuZm4oKSxcbiAgICBhdHRhY2htZW50OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICBhcHBlbmQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgIGhlYWRlcjogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgaGVhZGVyc1NlbnQ6IGZhbHNlLFxuICAgIGxvY2Fsczoge30sXG4gICAgY2hhcnNldDogJycsXG4gICAgYXBwOiB7fSxcbiAgICByZXE6IHt9LFxuICAgIG9uOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChldmVudCwgY2FsbGJhY2spID0+IHtcbiAgICAgIGlmIChldmVudCA9PT0gJ2ZpbmlzaCcpIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtb2NrUmVzcG9uc2U7XG4gICAgfSksXG4gICAgLi4ub3B0aW9ucyxcbiAgfTtcblxuICByZXR1cm4gbW9ja1Jlc3BvbnNlIGFzIHVua25vd24gYXMgUmVzcG9uc2U7XG59XG5cbmRlc2NyaWJlKCdBdWRpdG9yaWFNaWRkbGV3YXJlJywgKCkgPT4ge1xuICBsZXQgbWlkZGxld2FyZTogQXVkaXRvcmlhTWlkZGxld2FyZTtcbiAgbGV0IGF1ZGl0b3JpYVNlcnZpY2U6IEF1ZGl0b3JpYVNlcnZpY2U7XG5cbiAgY29uc3QgbW9ja0F1ZGl0b3JpYVNlcnZpY2UgPSB7XG4gICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgY29uc3QgbW9ja0F1ZGl0b3JpYVF1ZXVlU2VydmljZSA9IHtcbiAgICBlbmZpbGVpcmFyTG9nQXVkaXRvcmlhOiBqZXN0LmZuKCksXG4gICAgZW5maWxlaXJhckFjZXNzb0RhZG9zU2Vuc2l2ZWlzOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICBBdWRpdG9yaWFNaWRkbGV3YXJlLFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQXVkaXRvcmlhU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0F1ZGl0b3JpYVNlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBBdWRpdG9yaWFRdWV1ZVNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tBdWRpdG9yaWFRdWV1ZVNlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIG1pZGRsZXdhcmUgPSBtb2R1bGUuZ2V0PEF1ZGl0b3JpYU1pZGRsZXdhcmU+KEF1ZGl0b3JpYU1pZGRsZXdhcmUpO1xuICAgIGF1ZGl0b3JpYVNlcnZpY2UgPSBtb2R1bGUuZ2V0PEF1ZGl0b3JpYVNlcnZpY2U+KEF1ZGl0b3JpYVNlcnZpY2UpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBpdCgnZGV2ZSBzZXIgZGVmaW5pZG8nLCAoKSA9PiB7XG4gICAgZXhwZWN0KG1pZGRsZXdhcmUpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd1c2UnLCAoKSA9PiB7XG4gICAgaXQoJ2RldmUgcmVnaXN0cmFyIG9wZXJhw6fDo28gR0VUJywgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcmVxID0gY3JlYXRlTW9ja1JlcXVlc3Qoe1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBvcmlnaW5hbFVybDogJy9hcGkvZG9jdW1lbnRvcy8xMjMnLFxuICAgICAgICB1c2VyOiB7IGlkOiAndXNlci0xMjMnLCBub21lOiAnVXN1w6FyaW8gVGVzdGUnIH0sXG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczoge30sXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHJlcyA9IGNyZWF0ZU1vY2tSZXNwb25zZSh7XG4gICAgICAgIHN0YXR1c0NvZGU6IDIwMCxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgbmV4dCA9IGplc3QuZm4oKTtcblxuICAgICAgY29uc3QgZXhwZWN0ZWRMb2dEdG8gPSBuZXcgQ3JlYXRlTG9nQXVkaXRvcmlhRHRvKCk7XG4gICAgICBleHBlY3RlZExvZ0R0by50aXBvX29wZXJhY2FvID0gVGlwb09wZXJhY2FvLlJFQUQ7XG4gICAgICBleHBlY3RlZExvZ0R0by5lbnRpZGFkZV9hZmV0YWRhID0gJ2RvY3VtZW50b3MnO1xuICAgICAgZXhwZWN0ZWRMb2dEdG8uZW50aWRhZGVfaWQgPSAnMTIzJztcbiAgICAgIGV4cGVjdGVkTG9nRHRvLmRlc2NyaWNhbyA9ICdDb25zdWx0YSBkZSBkb2N1bWVudG8nO1xuICAgICAgZXhwZWN0ZWRMb2dEdG8uZGFkb3NfYW50ZXJpb3JlcyA9IHt9O1xuICAgICAgZXhwZWN0ZWRMb2dEdG8uZGFkb3Nfbm92b3MgPSB7fTtcbiAgICAgIGV4cGVjdGVkTG9nRHRvLnVzdWFyaW9faWQgPSAndXNlci0xMjMnO1xuICAgICAgZXhwZWN0ZWRMb2dEdG8uaXBfb3JpZ2VtID0gJzEyNy4wLjAuMSc7XG5cbiAgICAgIGNvbnN0IG1vY2tMb2dBdWRpdG9yaWEgPSBuZXcgTG9nQXVkaXRvcmlhKCk7XG4gICAgICBtb2NrQXVkaXRvcmlhU2VydmljZS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja0xvZ0F1ZGl0b3JpYSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgbWlkZGxld2FyZS51c2UocmVxLCByZXMsIG5leHQpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChuZXh0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QocmVzLm9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZmluaXNoJywgZXhwZWN0LmFueShGdW5jdGlvbikpO1xuICAgICAgZXhwZWN0KGF1ZGl0b3JpYVNlcnZpY2UuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHRpcG9fb3BlcmFjYW86IFRpcG9PcGVyYWNhby5SRUFELFxuICAgICAgICAgIGVudGlkYWRlX2FmZXRhZGE6ICdkb2N1bWVudG9zJyxcbiAgICAgICAgICBlbnRpZGFkZV9pZDogJzEyMycsXG4gICAgICAgICAgdXN1YXJpb19pZDogJ3VzZXItMTIzJyxcbiAgICAgICAgICBpcF9vcmlnZW06ICcxMjcuMC4wLjEnLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZWdpc3RyYXIgb3BlcmHDp8OjbyBQT1NUJywgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgcmVxID0gY3JlYXRlTW9ja1JlcXVlc3Qoe1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgb3JpZ2luYWxVcmw6ICcvYXBpL2RvY3VtZW50b3MnLFxuICAgICAgICB1c2VyOiB7IGlkOiAndXNlci0xMjMnLCBub21lOiAnVXN1w6FyaW8gVGVzdGUnIH0sXG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczoge30sXG4gICAgICAgIGJvZHk6IHsgbm9tZTogJ0RvY3VtZW50byBUZXN0ZScsIGNvbnRldWRvOiAnQ29udGXDumRvIGRvIGRvY3VtZW50bycgfSxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgcmVzID0gY3JlYXRlTW9ja1Jlc3BvbnNlKHtcbiAgICAgICAgc3RhdHVzQ29kZTogMjAxLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBuZXh0ID0gamVzdC5mbigpO1xuXG4gICAgICBjb25zdCBtb2NrTG9nQXVkaXRvcmlhID0gbmV3IExvZ0F1ZGl0b3JpYSgpO1xuICAgICAgbW9ja0F1ZGl0b3JpYVNlcnZpY2UuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tMb2dBdWRpdG9yaWEpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIG1pZGRsZXdhcmUudXNlKHJlcSwgcmVzLCBuZXh0KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobmV4dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KHJlcy5vbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2ZpbmlzaCcsIGV4cGVjdC5hbnkoRnVuY3Rpb24pKTtcbiAgICAgIGV4cGVjdChhdWRpdG9yaWFTZXJ2aWNlLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICB0aXBvX29wZXJhY2FvOiBUaXBvT3BlcmFjYW8uQ1JFQVRFLFxuICAgICAgICAgIGVudGlkYWRlX2FmZXRhZGE6ICdkb2N1bWVudG9zJyxcbiAgICAgICAgICBkYWRvc19ub3ZvczogcmVxLmJvZHksXG4gICAgICAgICAgdXN1YXJpb19pZDogJ3VzZXItMTIzJyxcbiAgICAgICAgICBpcF9vcmlnZW06ICcxMjcuMC4wLjEnLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZWdpc3RyYXIgb3BlcmHDp8OjbyBQVVQnLCAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCByZXEgPSBjcmVhdGVNb2NrUmVxdWVzdCh7XG4gICAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICAgIG9yaWdpbmFsVXJsOiAnL2FwaS9kb2N1bWVudG9zLzEyMycsXG4gICAgICAgIHVzZXI6IHsgaWQ6ICd1c2VyLTEyMycsIG5vbWU6ICdVc3XDoXJpbyBUZXN0ZScgfSxcbiAgICAgICAgaXA6ICcxMjcuMC4wLjEnLFxuICAgICAgICBoZWFkZXJzOiB7fSxcbiAgICAgICAgYm9keTogeyBub21lOiAnRG9jdW1lbnRvIEF0dWFsaXphZG8nLCBjb250ZXVkbzogJ05vdm8gY29udGXDumRvJyB9LFxuICAgICAgfSk7XG4gICAgICBjb25zdCByZXMgPSBjcmVhdGVNb2NrUmVzcG9uc2Uoe1xuICAgICAgICBzdGF0dXNDb2RlOiAyMDAsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IG5leHQgPSBqZXN0LmZuKCk7XG5cbiAgICAgIGNvbnN0IG1vY2tMb2dBdWRpdG9yaWEgPSBuZXcgTG9nQXVkaXRvcmlhKCk7XG4gICAgICBtb2NrQXVkaXRvcmlhU2VydmljZS5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja0xvZ0F1ZGl0b3JpYSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgbWlkZGxld2FyZS51c2UocmVxLCByZXMsIG5leHQpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChuZXh0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QocmVzLm9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZmluaXNoJywgZXhwZWN0LmFueShGdW5jdGlvbikpO1xuICAgICAgZXhwZWN0KGF1ZGl0b3JpYVNlcnZpY2UuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHRpcG9fb3BlcmFjYW86IFRpcG9PcGVyYWNhby5VUERBVEUsXG4gICAgICAgICAgZW50aWRhZGVfYWZldGFkYTogJ2RvY3VtZW50b3MnLFxuICAgICAgICAgIGVudGlkYWRlX2lkOiAnMTIzJyxcbiAgICAgICAgICBkYWRvc19ub3ZvczogcmVxLmJvZHksXG4gICAgICAgICAgdXN1YXJpb19pZDogJ3VzZXItMTIzJyxcbiAgICAgICAgICBpcF9vcmlnZW06ICcxMjcuMC4wLjEnLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZWdpc3RyYXIgb3BlcmHDp8OjbyBERUxFVEUnLCAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCByZXEgPSBjcmVhdGVNb2NrUmVxdWVzdCh7XG4gICAgICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgICAgIG9yaWdpbmFsVXJsOiAnL2FwaS9kb2N1bWVudG9zLzEyMycsXG4gICAgICAgIHVzZXI6IHsgaWQ6ICd1c2VyLTEyMycsIG5vbWU6ICdVc3XDoXJpbyBUZXN0ZScgfSxcbiAgICAgICAgaXA6ICcxMjcuMC4wLjEnLFxuICAgICAgICBoZWFkZXJzOiB7fSxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgcmVzID0gY3JlYXRlTW9ja1Jlc3BvbnNlKHtcbiAgICAgICAgc3RhdHVzQ29kZTogMjA0LFxuICAgICAgfSk7XG4gICAgICBjb25zdCBuZXh0ID0gamVzdC5mbigpO1xuXG4gICAgICBjb25zdCBtb2NrTG9nQXVkaXRvcmlhID0gbmV3IExvZ0F1ZGl0b3JpYSgpO1xuICAgICAgbW9ja0F1ZGl0b3JpYVNlcnZpY2UuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tMb2dBdWRpdG9yaWEpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIG1pZGRsZXdhcmUudXNlKHJlcSwgcmVzLCBuZXh0KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobmV4dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KHJlcy5vbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2ZpbmlzaCcsIGV4cGVjdC5hbnkoRnVuY3Rpb24pKTtcbiAgICAgIGV4cGVjdChhdWRpdG9yaWFTZXJ2aWNlLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICB0aXBvX29wZXJhY2FvOiBUaXBvT3BlcmFjYW8uREVMRVRFLFxuICAgICAgICAgIGVudGlkYWRlX2FmZXRhZGE6ICdkb2N1bWVudG9zJyxcbiAgICAgICAgICBlbnRpZGFkZV9pZDogJzEyMycsXG4gICAgICAgICAgdXN1YXJpb19pZDogJ3VzZXItMTIzJyxcbiAgICAgICAgICBpcF9vcmlnZW06ICcxMjcuMC4wLjEnLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnZGV2ZSByZWdpc3RyYXIgb3BlcmHDp8OjbyBQQVRDSCcsICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHJlcSA9IGNyZWF0ZU1vY2tSZXF1ZXN0KHtcbiAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxuICAgICAgICBvcmlnaW5hbFVybDogJy9hcGkvZG9jdW1lbnRvcy8xMjMnLFxuICAgICAgICB1c2VyOiB7IGlkOiAndXNlci0xMjMnLCBub21lOiAnVXN1w6FyaW8gVGVzdGUnIH0sXG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczoge30sXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHJlcyA9IGNyZWF0ZU1vY2tSZXNwb25zZSh7XG4gICAgICAgIHN0YXR1c0NvZGU6IDIwMCxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgbmV4dCA9IGplc3QuZm4oKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBtaWRkbGV3YXJlLnVzZShyZXEsIHJlcywgbmV4dCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG5leHQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChyZXMub24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdmaW5pc2gnLCBleHBlY3QuYW55KEZ1bmN0aW9uKSk7XG4gICAgICBleHBlY3QoYXVkaXRvcmlhU2VydmljZS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgdGlwb19vcGVyYWNhbzogVGlwb09wZXJhY2FvLlVQREFURSxcbiAgICAgICAgICBlbnRpZGFkZV9hZmV0YWRhOiAnZG9jdW1lbnRvcycsXG4gICAgICAgICAgZW50aWRhZGVfaWQ6ICcxMjMnLFxuICAgICAgICAgIHVzdWFyaW9faWQ6ICd1c2VyLTEyMycsXG4gICAgICAgICAgaXBfb3JpZ2VtOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ27Do28gZGV2ZSByZWdpc3RyYXIgb3BlcmHDp8O1ZXMgcGFyYSByb3RhcyBpZ25vcmFkYXMnLCAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCByZXEgPSBjcmVhdGVNb2NrUmVxdWVzdCh7XG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIG9yaWdpbmFsVXJsOiAnL2FwaS9oZWFsdGgnLFxuICAgICAgICB1c2VyOiB7IGlkOiAndXNlci0xMjMnLCBub21lOiAnVXN1w6FyaW8gVGVzdGUnIH0sXG4gICAgICAgIGlwOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgaGVhZGVyczoge30sXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHJlcyA9IGNyZWF0ZU1vY2tSZXNwb25zZSh7XG4gICAgICAgIHN0YXR1c0NvZGU6IDIwMCxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgbmV4dCA9IGplc3QuZm4oKTtcblxuICAgICAgLy8gQWN0XG4gICAgICBtaWRkbGV3YXJlLnVzZShyZXEsIHJlcywgbmV4dCk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG5leHQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIGV4cGVjdChhdWRpdG9yaWFTZXJ2aWNlLmNyZWF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdkZXZlIGxpZGFyIGNvbSByZXF1aXNpw6fDtWVzIHNlbSB1c3XDoXJpbyBhdXRlbnRpY2FkbycsICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IHJlcSA9IGNyZWF0ZU1vY2tSZXF1ZXN0KHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgb3JpZ2luYWxVcmw6ICcvYXBpL2RvY3VtZW50b3MvMTIzJyxcbiAgICAgICAgdXNlcjogbnVsbCxcbiAgICAgICAgaXA6ICcxMjcuMC4wLjEnLFxuICAgICAgICBoZWFkZXJzOiB7fSxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgcmVzID0gY3JlYXRlTW9ja1Jlc3BvbnNlKHtcbiAgICAgICAgc3RhdHVzQ29kZTogMjAwLFxuICAgICAgfSk7XG4gICAgICBjb25zdCBuZXh0ID0gamVzdC5mbigpO1xuXG4gICAgICBjb25zdCBtb2NrTG9nQXVkaXRvcmlhID0gbmV3IExvZ0F1ZGl0b3JpYSgpO1xuICAgICAgbW9ja0F1ZGl0b3JpYVNlcnZpY2UuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tMb2dBdWRpdG9yaWEpO1xuXG4gICAgICAvLyBBY3RcbiAgICAgIG1pZGRsZXdhcmUudXNlKHJlcSwgcmVzLCBuZXh0KTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobmV4dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KHJlcy5vbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2ZpbmlzaCcsIGV4cGVjdC5hbnkoRnVuY3Rpb24pKTtcbiAgICAgIGV4cGVjdChhdWRpdG9yaWFTZXJ2aWNlLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICB0aXBvX29wZXJhY2FvOiBUaXBvT3BlcmFjYW8uUkVBRCxcbiAgICAgICAgICBlbnRpZGFkZV9hZmV0YWRhOiAnZG9jdW1lbnRvcycsXG4gICAgICAgICAgZW50aWRhZGVfaWQ6ICcxMjMnLFxuICAgICAgICAgIHVzdWFyaW9faWQ6IG51bGwsXG4gICAgICAgICAgaXBfb3JpZ2VtOiAnMTI3LjAuMC4xJyxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9