035dc08c8f2b1a090e5e2d2d85138511
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DeterminacaoJudicialRepository = void 0;
const common_1 = require("@nestjs/common");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const determinacao_judicial_entity_1 = require("../../../entities/determinacao-judicial.entity");
/**
 * Repositório para operações relacionadas às determinações judiciais
 */
let DeterminacaoJudicialRepository = class DeterminacaoJudicialRepository {
    repository;
    constructor(repository) {
        this.repository = repository;
    }
    /**
     * Cria uma nova determinação judicial
     * @param data Dados da determinação
     * @param usuarioId ID do usuário que está criando
     * @returns Determinação criada
     */
    async create(data, usuarioId) {
        const determinacao = this.repository.create({
            ...data,
            created_by: usuarioId,
            updated_by: usuarioId,
        });
        return this.repository.save(determinacao);
    }
    /**
     * Busca todas as determinações judiciais
     * @param includeInactive Se deve incluir determinações inativas
     * @returns Lista de determinações
     */
    async findAll(includeInactive = false) {
        const query = this.repository
            .createQueryBuilder('determinacao')
            .leftJoinAndSelect('determinacao.processo_judicial', 'processo');
        if (!includeInactive) {
            query.where('determinacao.ativo = :ativo', { ativo: true });
        }
        return query.orderBy('determinacao.created_at', 'DESC').getMany();
    }
    /**
     * Busca uma determinação pelo ID
     * @param id ID da determinação
     * @returns Determinação encontrada ou null
     */
    async findById(id) {
        return this.repository.findOne({
            where: { id },
            relations: ['processo_judicial'],
        });
    }
    /**
     * Busca determinações por processo judicial
     * @param processoId ID do processo judicial
     * @param includeInactive Se deve incluir determinações inativas
     * @returns Lista de determinações
     */
    async findByProcesso(processoId, includeInactive = false) {
        const query = this.repository
            .createQueryBuilder('determinacao')
            .leftJoinAndSelect('determinacao.processo_judicial', 'processo')
            .where('determinacao.processo_judicial_id = :processoId', { processoId });
        if (!includeInactive) {
            query.andWhere('determinacao.ativo = :ativo', { ativo: true });
        }
        return query.orderBy('determinacao.created_at', 'DESC').getMany();
    }
    /**
     * Busca determinações por cidadão
     * @param cidadaoId ID do cidadão
     * @param includeInactive Se deve incluir determinações inativas
     * @returns Lista de determinações
     */
    async findByCidadao(cidadaoId, includeInactive = false) {
        const query = this.repository
            .createQueryBuilder('determinacao')
            .leftJoinAndSelect('determinacao.processo_judicial', 'processo')
            .where('determinacao.cidadao_id = :cidadaoId', { cidadaoId });
        if (!includeInactive) {
            query.andWhere('determinacao.ativo = :ativo', { ativo: true });
        }
        return query.orderBy('determinacao.created_at', 'DESC').getMany();
    }
    /**
     * Busca determinações por solicitação
     * @param solicitacaoId ID da solicitação
     * @param includeInactive Se deve incluir determinações inativas
     * @returns Lista de determinações
     */
    async findBySolicitacao(solicitacaoId, includeInactive = false) {
        const query = this.repository
            .createQueryBuilder('determinacao')
            .leftJoinAndSelect('determinacao.processo_judicial', 'processo')
            .where('determinacao.solicitacao_id = :solicitacaoId', { solicitacaoId });
        if (!includeInactive) {
            query.andWhere('determinacao.ativo = :ativo', { ativo: true });
        }
        return query.orderBy('determinacao.created_at', 'DESC').getMany();
    }
    /**
     * Busca determinações pendentes de cumprimento
     * @param includeInactive Se deve incluir determinações inativas
     * @returns Lista de determinações
     */
    async findPendentes(includeInactive = false) {
        const query = this.repository
            .createQueryBuilder('determinacao')
            .leftJoinAndSelect('determinacao.processo_judicial', 'processo')
            .where('determinacao.cumprida = :cumprida', { cumprida: false });
        if (!includeInactive) {
            query.andWhere('determinacao.ativo = :ativo', { ativo: true });
        }
        return query.orderBy('determinacao.data_prazo', 'ASC').getMany();
    }
    /**
     * Atualiza uma determinação existente
     * @param id ID da determinação
     * @param data Dados para atualização
     * @param usuarioId ID do usuário que está atualizando
     * @returns Determinação atualizada
     */
    async update(id, data, usuarioId) {
        await this.repository.update(id, {
            ...data,
            updated_by: usuarioId,
        });
        const determinacao = await this.findById(id);
        if (!determinacao) {
            throw new common_1.NotFoundException(`Determinação judicial com ID ${id} não encontrada`);
        }
        return determinacao;
    }
    /**
     * Marca uma determinação como cumprida
     * @param id ID da determinação
     * @param observacao Observação sobre o cumprimento
     * @param usuarioId ID do usuário que está marcando como cumprida
     * @returns Determinação atualizada
     */
    async marcarComoCumprida(id, observacao, usuarioId) {
        await this.repository.update(id, {
            cumprida: true,
            data_cumprimento: new Date(),
            observacao_cumprimento: observacao,
            updated_by: usuarioId,
        });
        const determinacao = await this.findById(id);
        if (!determinacao) {
            throw new common_1.NotFoundException(`Determinação judicial com ID ${id} não encontrada`);
        }
        return determinacao;
    }
    /**
     * Ativa ou desativa uma determinação
     * @param id ID da determinação
     * @param ativo Status de ativação
     * @param usuarioId ID do usuário que está alterando o status
     * @returns Determinação atualizada
     */
    async toggleAtivo(id, ativo, usuarioId) {
        await this.repository.update(id, {
            ativo,
            updated_by: usuarioId,
        });
        const determinacao = await this.findById(id);
        if (!determinacao) {
            throw new common_1.NotFoundException(`Determinação judicial com ID ${id} não encontrada`);
        }
        return determinacao;
    }
    /**
     * Remove uma determinação
     * @param id ID da determinação
     */
    async remove(id) {
        await this.repository.delete(id);
    }
};
exports.DeterminacaoJudicialRepository = DeterminacaoJudicialRepository;
exports.DeterminacaoJudicialRepository = DeterminacaoJudicialRepository = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, typeorm_1.InjectRepository)(determinacao_judicial_entity_1.DeterminacaoJudicial)),
    __metadata("design:paramtypes", [typeof (_a = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _a : Object])
], DeterminacaoJudicialRepository);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGp1ZGljaWFsXFxyZXBvc2l0b3JpZXNcXGRldGVybWluYWNhby1qdWRpY2lhbC5yZXBvc2l0b3J5LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBK0Q7QUFDL0QsNkNBQW1EO0FBQ25ELHFDQUFxQztBQUNyQyxpR0FBc0Y7QUFNdEY7O0dBRUc7QUFFSSxJQUFNLDhCQUE4QixHQUFwQyxNQUFNLDhCQUE4QjtJQUd0QjtJQUZuQixZQUVtQixVQUE0QztRQUE1QyxlQUFVLEdBQVYsVUFBVSxDQUFrQztJQUM1RCxDQUFDO0lBRUo7Ozs7O09BS0c7SUFDSCxLQUFLLENBQUMsTUFBTSxDQUNWLElBQW1DLEVBQ25DLFNBQWlCO1FBRWpCLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1lBQzFDLEdBQUcsSUFBSTtZQUNQLFVBQVUsRUFBRSxTQUFTO1lBQ3JCLFVBQVUsRUFBRSxTQUFTO1NBQ3RCLENBQUMsQ0FBQztRQUNILE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxLQUFLLENBQUMsT0FBTyxDQUFDLGVBQWUsR0FBRyxLQUFLO1FBQ25DLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxVQUFVO2FBQzFCLGtCQUFrQixDQUFDLGNBQWMsQ0FBQzthQUNsQyxpQkFBaUIsQ0FBQyxnQ0FBZ0MsRUFBRSxVQUFVLENBQUMsQ0FBQztRQUVuRSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDckIsS0FBSyxDQUFDLEtBQUssQ0FBQyw2QkFBNkIsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQzlELENBQUM7UUFFRCxPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMseUJBQXlC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Ozs7OztPQU1HO0lBQ0gsS0FBSyxDQUFDLFdBQVcsQ0FDZixFQUFVLEVBQ1YsS0FBYyxFQUNkLFNBQWlCO1FBRWpCLE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFO1lBQy9CLEtBQUs7WUFDTCxVQUFVLEVBQUUsU0FBUztTQUN0QixDQUFDLENBQUM7UUFDSCxNQUFNLFlBQVksR0FBRyxNQUFNLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDN0MsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ2xCLE1BQU0sSUFBSSwwQkFBaUIsQ0FDekIsZ0NBQWdDLEVBQUUsaUJBQWlCLENBQ3BELENBQUM7UUFDSixDQUFDO1FBQ0QsT0FBTyxZQUFZLENBQUM7SUFDdEIsQ0FBQztJQUVEOzs7T0FHRztJQUNILEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBVTtRQUNyQixNQUFNLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ25DLENBQUM7Q0FDRixDQUFBO0FBL05ZLHdFQUE4Qjt5Q0FBOUIsOEJBQThCO0lBRDFDLElBQUEsbUJBQVUsR0FBRTtJQUdSLFdBQUEsSUFBQSwwQkFBZ0IsRUFBQyxtREFBb0IsQ0FBQyxDQUFBO3lEQUNWLG9CQUFVLG9CQUFWLG9CQUFVO0dBSDlCLDhCQUE4QixDQStOMUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxldWRyZVxcT25lRHJpdmVcXERlc2t0b3BcXFByb2pldG9zXFxwZ2JlblxccGdiZW4tc2VydmVyXFxzcmNcXG1vZHVsZXNcXGp1ZGljaWFsXFxyZXBvc2l0b3JpZXNcXGRldGVybWluYWNhby1qdWRpY2lhbC5yZXBvc2l0b3J5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE5vdEZvdW5kRXhjZXB0aW9uIH0gZnJvbSAnQG5lc3Rqcy9jb21tb24nO1xuaW1wb3J0IHsgSW5qZWN0UmVwb3NpdG9yeSB9IGZyb20gJ0BuZXN0anMvdHlwZW9ybSc7XG5pbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSAndHlwZW9ybSc7XG5pbXBvcnQgeyBEZXRlcm1pbmFjYW9KdWRpY2lhbCB9IGZyb20gJy4uLy4uLy4uL2VudGl0aWVzL2RldGVybWluYWNhby1qdWRpY2lhbC5lbnRpdHknO1xuaW1wb3J0IHtcbiAgQ3JlYXRlRGV0ZXJtaW5hY2FvSnVkaWNpYWxEdG8sXG4gIFVwZGF0ZURldGVybWluYWNhb0p1ZGljaWFsRHRvLFxufSBmcm9tICcuLi9kdG9zL2RldGVybWluYWNhby1qdWRpY2lhbC5kdG8nO1xuXG4vKipcbiAqIFJlcG9zaXTDs3JpbyBwYXJhIG9wZXJhw6fDtWVzIHJlbGFjaW9uYWRhcyDDoHMgZGV0ZXJtaW5hw6fDtWVzIGp1ZGljaWFpc1xuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgRGV0ZXJtaW5hY2FvSnVkaWNpYWxSZXBvc2l0b3J5IHtcbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdFJlcG9zaXRvcnkoRGV0ZXJtaW5hY2FvSnVkaWNpYWwpXG4gICAgcHJpdmF0ZSByZWFkb25seSByZXBvc2l0b3J5OiBSZXBvc2l0b3J5PERldGVybWluYWNhb0p1ZGljaWFsPixcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBDcmlhIHVtYSBub3ZhIGRldGVybWluYcOnw6NvIGp1ZGljaWFsXG4gICAqIEBwYXJhbSBkYXRhIERhZG9zIGRhIGRldGVybWluYcOnw6NvXG4gICAqIEBwYXJhbSB1c3VhcmlvSWQgSUQgZG8gdXN1w6FyaW8gcXVlIGVzdMOhIGNyaWFuZG9cbiAgICogQHJldHVybnMgRGV0ZXJtaW5hw6fDo28gY3JpYWRhXG4gICAqL1xuICBhc3luYyBjcmVhdGUoXG4gICAgZGF0YTogQ3JlYXRlRGV0ZXJtaW5hY2FvSnVkaWNpYWxEdG8sXG4gICAgdXN1YXJpb0lkOiBzdHJpbmcsXG4gICk6IFByb21pc2U8RGV0ZXJtaW5hY2FvSnVkaWNpYWw+IHtcbiAgICBjb25zdCBkZXRlcm1pbmFjYW8gPSB0aGlzLnJlcG9zaXRvcnkuY3JlYXRlKHtcbiAgICAgIC4uLmRhdGEsXG4gICAgICBjcmVhdGVkX2J5OiB1c3VhcmlvSWQsXG4gICAgICB1cGRhdGVkX2J5OiB1c3VhcmlvSWQsXG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXMucmVwb3NpdG9yeS5zYXZlKGRldGVybWluYWNhbyk7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2EgdG9kYXMgYXMgZGV0ZXJtaW5hw6fDtWVzIGp1ZGljaWFpc1xuICAgKiBAcGFyYW0gaW5jbHVkZUluYWN0aXZlIFNlIGRldmUgaW5jbHVpciBkZXRlcm1pbmHDp8O1ZXMgaW5hdGl2YXNcbiAgICogQHJldHVybnMgTGlzdGEgZGUgZGV0ZXJtaW5hw6fDtWVzXG4gICAqL1xuICBhc3luYyBmaW5kQWxsKGluY2x1ZGVJbmFjdGl2ZSA9IGZhbHNlKTogUHJvbWlzZTxEZXRlcm1pbmFjYW9KdWRpY2lhbFtdPiB7XG4gICAgY29uc3QgcXVlcnkgPSB0aGlzLnJlcG9zaXRvcnlcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoJ2RldGVybWluYWNhbycpXG4gICAgICAubGVmdEpvaW5BbmRTZWxlY3QoJ2RldGVybWluYWNhby5wcm9jZXNzb19qdWRpY2lhbCcsICdwcm9jZXNzbycpO1xuXG4gICAgaWYgKCFpbmNsdWRlSW5hY3RpdmUpIHtcbiAgICAgIHF1ZXJ5LndoZXJlKCdkZXRlcm1pbmFjYW8uYXRpdm8gPSA6YXRpdm8nLCB7IGF0aXZvOiB0cnVlIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBxdWVyeS5vcmRlckJ5KCdkZXRlcm1pbmFjYW8uY3JlYXRlZF9hdCcsICdERVNDJykuZ2V0TWFueSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhIHVtYSBkZXRlcm1pbmHDp8OjbyBwZWxvIElEXG4gICAqIEBwYXJhbSBpZCBJRCBkYSBkZXRlcm1pbmHDp8Ojb1xuICAgKiBAcmV0dXJucyBEZXRlcm1pbmHDp8OjbyBlbmNvbnRyYWRhIG91IG51bGxcbiAgICovXG4gIGFzeW5jIGZpbmRCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPERldGVybWluYWNhb0p1ZGljaWFsIHwgbnVsbD4ge1xuICAgIHJldHVybiB0aGlzLnJlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgcmVsYXRpb25zOiBbJ3Byb2Nlc3NvX2p1ZGljaWFsJ10sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQnVzY2EgZGV0ZXJtaW5hw6fDtWVzIHBvciBwcm9jZXNzbyBqdWRpY2lhbFxuICAgKiBAcGFyYW0gcHJvY2Vzc29JZCBJRCBkbyBwcm9jZXNzbyBqdWRpY2lhbFxuICAgKiBAcGFyYW0gaW5jbHVkZUluYWN0aXZlIFNlIGRldmUgaW5jbHVpciBkZXRlcm1pbmHDp8O1ZXMgaW5hdGl2YXNcbiAgICogQHJldHVybnMgTGlzdGEgZGUgZGV0ZXJtaW5hw6fDtWVzXG4gICAqL1xuICBhc3luYyBmaW5kQnlQcm9jZXNzbyhcbiAgICBwcm9jZXNzb0lkOiBzdHJpbmcsXG4gICAgaW5jbHVkZUluYWN0aXZlID0gZmFsc2UsXG4gICk6IFByb21pc2U8RGV0ZXJtaW5hY2FvSnVkaWNpYWxbXT4ge1xuICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5yZXBvc2l0b3J5XG4gICAgICAuY3JlYXRlUXVlcnlCdWlsZGVyKCdkZXRlcm1pbmFjYW8nKVxuICAgICAgLmxlZnRKb2luQW5kU2VsZWN0KCdkZXRlcm1pbmFjYW8ucHJvY2Vzc29fanVkaWNpYWwnLCAncHJvY2Vzc28nKVxuICAgICAgLndoZXJlKCdkZXRlcm1pbmFjYW8ucHJvY2Vzc29fanVkaWNpYWxfaWQgPSA6cHJvY2Vzc29JZCcsIHsgcHJvY2Vzc29JZCB9KTtcblxuICAgIGlmICghaW5jbHVkZUluYWN0aXZlKSB7XG4gICAgICBxdWVyeS5hbmRXaGVyZSgnZGV0ZXJtaW5hY2FvLmF0aXZvID0gOmF0aXZvJywgeyBhdGl2bzogdHJ1ZSB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcXVlcnkub3JkZXJCeSgnZGV0ZXJtaW5hY2FvLmNyZWF0ZWRfYXQnLCAnREVTQycpLmdldE1hbnkoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdXNjYSBkZXRlcm1pbmHDp8O1ZXMgcG9yIGNpZGFkw6NvXG4gICAqIEBwYXJhbSBjaWRhZGFvSWQgSUQgZG8gY2lkYWTDo29cbiAgICogQHBhcmFtIGluY2x1ZGVJbmFjdGl2ZSBTZSBkZXZlIGluY2x1aXIgZGV0ZXJtaW5hw6fDtWVzIGluYXRpdmFzXG4gICAqIEByZXR1cm5zIExpc3RhIGRlIGRldGVybWluYcOnw7Vlc1xuICAgKi9cbiAgYXN5bmMgZmluZEJ5Q2lkYWRhbyhcbiAgICBjaWRhZGFvSWQ6IHN0cmluZyxcbiAgICBpbmNsdWRlSW5hY3RpdmUgPSBmYWxzZSxcbiAgKTogUHJvbWlzZTxEZXRlcm1pbmFjYW9KdWRpY2lhbFtdPiB7XG4gICAgY29uc3QgcXVlcnkgPSB0aGlzLnJlcG9zaXRvcnlcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoJ2RldGVybWluYWNhbycpXG4gICAgICAubGVmdEpvaW5BbmRTZWxlY3QoJ2RldGVybWluYWNhby5wcm9jZXNzb19qdWRpY2lhbCcsICdwcm9jZXNzbycpXG4gICAgICAud2hlcmUoJ2RldGVybWluYWNhby5jaWRhZGFvX2lkID0gOmNpZGFkYW9JZCcsIHsgY2lkYWRhb0lkIH0pO1xuXG4gICAgaWYgKCFpbmNsdWRlSW5hY3RpdmUpIHtcbiAgICAgIHF1ZXJ5LmFuZFdoZXJlKCdkZXRlcm1pbmFjYW8uYXRpdm8gPSA6YXRpdm8nLCB7IGF0aXZvOiB0cnVlIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBxdWVyeS5vcmRlckJ5KCdkZXRlcm1pbmFjYW8uY3JlYXRlZF9hdCcsICdERVNDJykuZ2V0TWFueSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhIGRldGVybWluYcOnw7VlcyBwb3Igc29saWNpdGHDp8Ojb1xuICAgKiBAcGFyYW0gc29saWNpdGFjYW9JZCBJRCBkYSBzb2xpY2l0YcOnw6NvXG4gICAqIEBwYXJhbSBpbmNsdWRlSW5hY3RpdmUgU2UgZGV2ZSBpbmNsdWlyIGRldGVybWluYcOnw7VlcyBpbmF0aXZhc1xuICAgKiBAcmV0dXJucyBMaXN0YSBkZSBkZXRlcm1pbmHDp8O1ZXNcbiAgICovXG4gIGFzeW5jIGZpbmRCeVNvbGljaXRhY2FvKFxuICAgIHNvbGljaXRhY2FvSWQ6IHN0cmluZyxcbiAgICBpbmNsdWRlSW5hY3RpdmUgPSBmYWxzZSxcbiAgKTogUHJvbWlzZTxEZXRlcm1pbmFjYW9KdWRpY2lhbFtdPiB7XG4gICAgY29uc3QgcXVlcnkgPSB0aGlzLnJlcG9zaXRvcnlcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoJ2RldGVybWluYWNhbycpXG4gICAgICAubGVmdEpvaW5BbmRTZWxlY3QoJ2RldGVybWluYWNhby5wcm9jZXNzb19qdWRpY2lhbCcsICdwcm9jZXNzbycpXG4gICAgICAud2hlcmUoJ2RldGVybWluYWNhby5zb2xpY2l0YWNhb19pZCA9IDpzb2xpY2l0YWNhb0lkJywgeyBzb2xpY2l0YWNhb0lkIH0pO1xuXG4gICAgaWYgKCFpbmNsdWRlSW5hY3RpdmUpIHtcbiAgICAgIHF1ZXJ5LmFuZFdoZXJlKCdkZXRlcm1pbmFjYW8uYXRpdm8gPSA6YXRpdm8nLCB7IGF0aXZvOiB0cnVlIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBxdWVyeS5vcmRlckJ5KCdkZXRlcm1pbmFjYW8uY3JlYXRlZF9hdCcsICdERVNDJykuZ2V0TWFueSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1c2NhIGRldGVybWluYcOnw7VlcyBwZW5kZW50ZXMgZGUgY3VtcHJpbWVudG9cbiAgICogQHBhcmFtIGluY2x1ZGVJbmFjdGl2ZSBTZSBkZXZlIGluY2x1aXIgZGV0ZXJtaW5hw6fDtWVzIGluYXRpdmFzXG4gICAqIEByZXR1cm5zIExpc3RhIGRlIGRldGVybWluYcOnw7Vlc1xuICAgKi9cbiAgYXN5bmMgZmluZFBlbmRlbnRlcyhcbiAgICBpbmNsdWRlSW5hY3RpdmUgPSBmYWxzZSxcbiAgKTogUHJvbWlzZTxEZXRlcm1pbmFjYW9KdWRpY2lhbFtdPiB7XG4gICAgY29uc3QgcXVlcnkgPSB0aGlzLnJlcG9zaXRvcnlcbiAgICAgIC5jcmVhdGVRdWVyeUJ1aWxkZXIoJ2RldGVybWluYWNhbycpXG4gICAgICAubGVmdEpvaW5BbmRTZWxlY3QoJ2RldGVybWluYWNhby5wcm9jZXNzb19qdWRpY2lhbCcsICdwcm9jZXNzbycpXG4gICAgICAud2hlcmUoJ2RldGVybWluYWNhby5jdW1wcmlkYSA9IDpjdW1wcmlkYScsIHsgY3VtcHJpZGE6IGZhbHNlIH0pO1xuXG4gICAgaWYgKCFpbmNsdWRlSW5hY3RpdmUpIHtcbiAgICAgIHF1ZXJ5LmFuZFdoZXJlKCdkZXRlcm1pbmFjYW8uYXRpdm8gPSA6YXRpdm8nLCB7IGF0aXZvOiB0cnVlIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBxdWVyeS5vcmRlckJ5KCdkZXRlcm1pbmFjYW8uZGF0YV9wcmF6bycsICdBU0MnKS5nZXRNYW55KCk7XG4gIH1cblxuICAvKipcbiAgICogQXR1YWxpemEgdW1hIGRldGVybWluYcOnw6NvIGV4aXN0ZW50ZVxuICAgKiBAcGFyYW0gaWQgSUQgZGEgZGV0ZXJtaW5hw6fDo29cbiAgICogQHBhcmFtIGRhdGEgRGFkb3MgcGFyYSBhdHVhbGl6YcOnw6NvXG4gICAqIEBwYXJhbSB1c3VhcmlvSWQgSUQgZG8gdXN1w6FyaW8gcXVlIGVzdMOhIGF0dWFsaXphbmRvXG4gICAqIEByZXR1cm5zIERldGVybWluYcOnw6NvIGF0dWFsaXphZGFcbiAgICovXG4gIGFzeW5jIHVwZGF0ZShcbiAgICBpZDogc3RyaW5nLFxuICAgIGRhdGE6IFVwZGF0ZURldGVybWluYWNhb0p1ZGljaWFsRHRvLFxuICAgIHVzdWFyaW9JZDogc3RyaW5nLFxuICApOiBQcm9taXNlPERldGVybWluYWNhb0p1ZGljaWFsPiB7XG4gICAgYXdhaXQgdGhpcy5yZXBvc2l0b3J5LnVwZGF0ZShpZCwge1xuICAgICAgLi4uZGF0YSxcbiAgICAgIHVwZGF0ZWRfYnk6IHVzdWFyaW9JZCxcbiAgICB9KTtcbiAgICBjb25zdCBkZXRlcm1pbmFjYW8gPSBhd2FpdCB0aGlzLmZpbmRCeUlkKGlkKTtcbiAgICBpZiAoIWRldGVybWluYWNhbykge1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKFxuICAgICAgICBgRGV0ZXJtaW5hw6fDo28ganVkaWNpYWwgY29tIElEICR7aWR9IG7Do28gZW5jb250cmFkYWAsXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gZGV0ZXJtaW5hY2FvO1xuICB9XG5cbiAgLyoqXG4gICAqIE1hcmNhIHVtYSBkZXRlcm1pbmHDp8OjbyBjb21vIGN1bXByaWRhXG4gICAqIEBwYXJhbSBpZCBJRCBkYSBkZXRlcm1pbmHDp8Ojb1xuICAgKiBAcGFyYW0gb2JzZXJ2YWNhbyBPYnNlcnZhw6fDo28gc29icmUgbyBjdW1wcmltZW50b1xuICAgKiBAcGFyYW0gdXN1YXJpb0lkIElEIGRvIHVzdcOhcmlvIHF1ZSBlc3TDoSBtYXJjYW5kbyBjb21vIGN1bXByaWRhXG4gICAqIEByZXR1cm5zIERldGVybWluYcOnw6NvIGF0dWFsaXphZGFcbiAgICovXG4gIGFzeW5jIG1hcmNhckNvbW9DdW1wcmlkYShcbiAgICBpZDogc3RyaW5nLFxuICAgIG9ic2VydmFjYW86IHN0cmluZyxcbiAgICB1c3VhcmlvSWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxEZXRlcm1pbmFjYW9KdWRpY2lhbD4ge1xuICAgIGF3YWl0IHRoaXMucmVwb3NpdG9yeS51cGRhdGUoaWQsIHtcbiAgICAgIGN1bXByaWRhOiB0cnVlLFxuICAgICAgZGF0YV9jdW1wcmltZW50bzogbmV3IERhdGUoKSxcbiAgICAgIG9ic2VydmFjYW9fY3VtcHJpbWVudG86IG9ic2VydmFjYW8sXG4gICAgICB1cGRhdGVkX2J5OiB1c3VhcmlvSWQsXG4gICAgfSk7XG4gICAgY29uc3QgZGV0ZXJtaW5hY2FvID0gYXdhaXQgdGhpcy5maW5kQnlJZChpZCk7XG4gICAgaWYgKCFkZXRlcm1pbmFjYW8pIHtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihcbiAgICAgICAgYERldGVybWluYcOnw6NvIGp1ZGljaWFsIGNvbSBJRCAke2lkfSBuw6NvIGVuY29udHJhZGFgLFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGRldGVybWluYWNhbztcbiAgfVxuXG4gIC8qKlxuICAgKiBBdGl2YSBvdSBkZXNhdGl2YSB1bWEgZGV0ZXJtaW5hw6fDo29cbiAgICogQHBhcmFtIGlkIElEIGRhIGRldGVybWluYcOnw6NvXG4gICAqIEBwYXJhbSBhdGl2byBTdGF0dXMgZGUgYXRpdmHDp8Ojb1xuICAgKiBAcGFyYW0gdXN1YXJpb0lkIElEIGRvIHVzdcOhcmlvIHF1ZSBlc3TDoSBhbHRlcmFuZG8gbyBzdGF0dXNcbiAgICogQHJldHVybnMgRGV0ZXJtaW5hw6fDo28gYXR1YWxpemFkYVxuICAgKi9cbiAgYXN5bmMgdG9nZ2xlQXRpdm8oXG4gICAgaWQ6IHN0cmluZyxcbiAgICBhdGl2bzogYm9vbGVhbixcbiAgICB1c3VhcmlvSWQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxEZXRlcm1pbmFjYW9KdWRpY2lhbD4ge1xuICAgIGF3YWl0IHRoaXMucmVwb3NpdG9yeS51cGRhdGUoaWQsIHtcbiAgICAgIGF0aXZvLFxuICAgICAgdXBkYXRlZF9ieTogdXN1YXJpb0lkLFxuICAgIH0pO1xuICAgIGNvbnN0IGRldGVybWluYWNhbyA9IGF3YWl0IHRoaXMuZmluZEJ5SWQoaWQpO1xuICAgIGlmICghZGV0ZXJtaW5hY2FvKSB7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oXG4gICAgICAgIGBEZXRlcm1pbmHDp8OjbyBqdWRpY2lhbCBjb20gSUQgJHtpZH0gbsOjbyBlbmNvbnRyYWRhYCxcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBkZXRlcm1pbmFjYW87XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIHVtYSBkZXRlcm1pbmHDp8Ojb1xuICAgKiBAcGFyYW0gaWQgSUQgZGEgZGV0ZXJtaW5hw6fDo29cbiAgICovXG4gIGFzeW5jIHJlbW92ZShpZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5yZXBvc2l0b3J5LmRlbGV0ZShpZCk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==